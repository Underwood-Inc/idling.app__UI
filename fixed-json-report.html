<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Coverage Report - 2025-07-09T07:57:51.180331</title>
    <!-- Highlight.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/vs2015.min.css">
    <style>
        /* Main CSS for Documentation Coverage Report */
/* Complete CSS with Idling.app Golden Brand Theme */

/* CSS Custom Properties - Idling.app Design System */
:root {
  /* Brand Colors - Primary Palette */
  --brand-primary: #edae49;
  --brand-primary-dark: #c68214;
  --brand-primary-light: #f9df74;
  --brand-secondary: #f9df74;
  --brand-secondary-dark: #f5c60c;
  --brand-tertiary: #f9edcc;
  --brand-quaternary: #ea2b1f;
  --brand-quinary: #61210f;

  /* Semantic Colors */
  --color-success: #22c55e;
  --color-warning: #f59e0b;
  --color-error: #ef4444;
  --color-info: #3b82f6;

  /* Light Theme Colors */
  --light-bg-primary: #fff8e1;
  --light-bg-secondary: #ffe4b5;
  --light-bg-tertiary: #ffdab9;
  --light-text-primary: #2a150d;
  --light-text-secondary: #8b4513;
  --light-border: #e2e8f0;
  --light-file-path: #4a5568;
  --light-file-directory: #718096;
  --light-hover-bg: #f7fafc;

  /* Dark Theme Colors */
  --dark-bg-primary: #1a1611;
  --dark-bg-secondary: #252017;
  --dark-bg-tertiary: #2f2a1d;
  --dark-text-primary: #ffffff;
  --dark-text-secondary: #fff8e1;
  --dark-border: #4a5568;
  --dark-file-path: #e2e8f0;
  --dark-file-directory: #a0aec0;
  --dark-hover-bg: #2d3748;

  /* Theme Variables - Default Light */
  --bg-primary: var(--light-bg-primary);
  --bg-secondary: var(--light-bg-secondary);
  --bg-tertiary: var(--light-bg-tertiary);
  --text-primary: var(--light-text-primary);
  --text-secondary: var(--light-text-secondary);
  --border-color: var(--light-border);
  --file-path-color: var(--light-file-path);
  --file-directory-color: var(--light-file-directory);
  --hover-bg: var(--light-hover-bg);
  --card-bg: var(--light-bg-secondary);
  --code-bg: var(--light-bg-tertiary);
  --code-text: var(--light-text-primary);

  /* Typography */
  --font-family: 'Fira Code', 'SF Mono', Monaco, Inconsolata, 'Roboto Mono',
    monospace;
  --font-mono: 'Fira Code', 'SF Mono', Monaco, Inconsolata, 'Roboto Mono',
    monospace;
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-base: 1rem;
  --font-size-lg: 1.125rem;
  --font-size-xl: 1.25rem;
  --font-size-2xl: 1.5rem;
  --font-size-3xl: 1.875rem;

  /* Spacing */
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  --spacing-2xl: 3rem;

  /* Border Radius */
  --radius-sm: 0.25rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;

  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
  --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.1);

  /* Transitions */
  --transition-fast: 0.15s ease-out;
  --transition-normal: 0.3s ease-out;
  --transition-slow: 0.5s ease-out;
}

/* Dark Theme */
[data-theme='dark'] {
  --bg-primary: var(--dark-bg-primary);
  --bg-secondary: var(--dark-bg-secondary);
  --bg-tertiary: var(--dark-bg-tertiary);
  --text-primary: var(--dark-text-primary);
  --text-secondary: var(--dark-text-secondary);
  --border-color: var(--dark-border);
  --file-path-color: var(--dark-file-path);
  --file-directory-color: var(--dark-file-directory);
  --hover-bg: var(--dark-hover-bg);
  --card-bg: var(--dark-bg-secondary);
  --code-bg: var(--dark-bg-tertiary);
  --code-text: var(--dark-text-primary);
}

/* Auto Theme Detection */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) {
    --bg-primary: var(--dark-bg-primary);
    --bg-secondary: var(--dark-bg-secondary);
    --bg-tertiary: var(--dark-bg-tertiary);
    --text-primary: var(--dark-text-primary);
    --text-secondary: var(--dark-text-secondary);
    --border-color: var(--dark-border);
    --file-path-color: var(--dark-file-path);
    --file-directory-color: var(--dark-file-directory);
    --hover-bg: var(--dark-hover-bg);
    --card-bg: var(--dark-bg-secondary);
    --code-bg: var(--dark-bg-tertiary);
    --code-text: var(--dark-text-primary);
  }
}

/* Base Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background: var(--bg-primary);
  transition:
    color var(--transition-normal),
    background var(--transition-normal);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

/* Theme Toggle */
.theme-toggle {
  position: fixed;
  top: var(--spacing-lg);
  right: var(--spacing-lg);
  z-index: 1000;
}

.theme-toggle-btn {
  background: var(--bg-secondary);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-xl);
  padding: var(--spacing-sm);
  cursor: pointer;
  transition: all var(--transition-normal);
  box-shadow: var(--shadow-md);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.theme-toggle-btn:hover {
  background: var(--brand-primary);
  border-color: var(--brand-primary);
  transform: scale(1.05);
}

.theme-icon {
  font-size: var(--font-size-lg);
  display: inline-block;
  transition: opacity var(--transition-fast);
}

[data-theme='dark'] .light-icon,
:root:not([data-theme='light']) .light-icon {
  opacity: 0;
}

[data-theme='dark'] .dark-icon,
:root:not([data-theme='light']) .dark-icon {
  opacity: 1;
}

[data-theme='light'] .light-icon {
  opacity: 1;
}

[data-theme='light'] .dark-icon {
  opacity: 0;
}

@media (prefers-color-scheme: dark) {
  .light-icon {
    opacity: 0;
  }
  .dark-icon {
    opacity: 1;
  }
}

/* Header */
.header {
  background: linear-gradient(
    135deg,
    var(--brand-primary) 0%,
    var(--brand-secondary) 100%
  );
  color: white;
  padding: 2rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-lg);
}

.header h1 {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
}

.header p {
  font-size: 1.1rem;
  opacity: 0.9;
}

/* Cards */
.card {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-lg);
  box-shadow: var(--shadow-md);
  transition: all var(--transition-normal);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.card h2 {
  color: var(--brand-primary);
  font-size: var(--font-size-xl);
  margin-bottom: var(--spacing-md);
  font-weight: 600;
}

.card h3 {
  color: var(--text-primary);
  font-size: var(--font-size-lg);
  margin-bottom: var(--spacing-sm);
  font-weight: 500;
}

/* Overview Cards Grid */
.overview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.metric-card {
  background: var(--card-bg);
  padding: var(--spacing-lg);
  border-radius: var(--radius-lg);
  text-align: center;
  border: 1px solid var(--border-color);
  transition: all var(--transition-normal);
  position: relative;
  overflow: hidden;
}

.metric-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(
    90deg,
    var(--brand-primary),
    var(--brand-secondary)
  );
}

.metric-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-xl);
}

.metric-value {
  font-size: var(--font-size-2xl);
  font-weight: 700;
  color: var(--brand-primary);
  margin-bottom: var(--spacing-xs);
}

.metric-label {
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Progress Bars */
.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  overflow: hidden;
  margin: var(--spacing-sm) 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(
    90deg,
    var(--brand-primary),
    var(--brand-secondary)
  );
  transition: width var(--transition-slow);
  border-radius: var(--radius-sm);
}

/* Quality Indicators */
.quality-excellent {
  color: var(--color-success);
}
.quality-good {
  color: var(--brand-primary);
}
.quality-fair {
  color: var(--color-warning);
}
.quality-poor {
  color: var(--color-error);
}

/* Code Preview - Clean Editor Style */
.hljs-code-preview {
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 14px;
  line-height: 1.4;
  overflow: auto;
  max-height: 70vh;
}

.hljs-lines {
  margin: 0;
  padding: var(--spacing-md);
  white-space: pre;
  overflow: auto;
}

.line-wrapper {
  display: block;
  line-height: 1.4;
  margin: 0;
  padding: 2px 0;
  white-space: pre;
}

.line-number {
  display: inline-block;
  width: 40px;
  color: var(--text-secondary);
  text-align: right;
  margin-right: 16px;
  padding-right: 8px;
  border-right: 1px solid var(--border-color);
  user-select: none;
  font-weight: 400;
  opacity: 0.6;
}

.line-content {
  display: inline;
  color: var(--text-primary);
  white-space: pre;
}

/* Highlight.js Syntax Colors - Clean Theme */
.hljs-keyword {
  color: #0066cc;
  font-weight: 600;
}

.hljs-string {
  color: #008000;
}

.hljs-number {
  color: #cc6600;
}

.hljs-comment {
  color: #999999;
  font-style: italic;
}

.hljs-function,
.hljs-title.function_ {
  color: #0066cc;
  font-weight: 500;
}

.hljs-variable {
  color: var(--text-primary);
}

.hljs-variable.language_ {
  color: #6600cc;
  font-weight: 500;
}

.hljs-title.class_ {
  color: #cc6600;
  font-weight: 600;
}

.hljs-title.class_.inherited__ {
  color: #cc6600;
  opacity: 0.8;
}

.hljs-property {
  color: #0099cc;
}

.hljs-attr {
  color: #0099cc;
}

.hljs-built_in {
  color: #6600cc;
  font-weight: 500;
}

.hljs-literal {
  color: #cc6600;
}

.hljs-operator {
  color: #666666;
}

.hljs-punctuation {
  color: var(--text-primary);
}

.hljs-tag {
  color: #cc0000;
}

.hljs-name {
  color: #cc0000;
  font-weight: 500;
}

.hljs-params {
  color: var(--text-primary);
}

.hljs-meta {
  color: var(--text-secondary);
}

.hljs-selector-tag {
  color: #cc0000;
}

.hljs-selector-class {
  color: #cc6600;
}

.hljs-selector-id {
  color: #cc6600;
}

.hljs-regexp {
  color: #008000;
}

.hljs-deletion {
  background: rgba(255, 0, 0, 0.1);
  color: #cc0000;
}

.hljs-addition {
  background: rgba(0, 128, 0, 0.1);
  color: #008000;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: 700;
}

/* JSX/TSX specific highlighting */
.language-xml .hljs-tag {
  color: #cc0000;
}

.language-xml .hljs-name {
  color: #cc0000;
  font-weight: 500;
}

.language-xml .hljs-attr {
  color: #0099cc;
}

.language-xml .hljs-string {
  color: #008000;
}

/* Dark theme code preview */
[data-theme='dark'] .hljs-code-preview {
  background: var(--bg-secondary);
  border-color: var(--border-color);
}

[data-theme='dark'] .line-number {
  color: var(--text-secondary);
  border-right-color: var(--border-color);
}

[data-theme='dark'] .line-content {
  color: var(--text-primary);
}

[data-theme='dark'] .hljs-keyword {
  color: #66b3ff;
}

[data-theme='dark'] .hljs-string {
  color: #66ff66;
}

[data-theme='dark'] .hljs-number {
  color: #ffaa66;
}

[data-theme='dark'] .hljs-comment {
  color: #888888;
}

[data-theme='dark'] .hljs-function,
[data-theme='dark'] .hljs-title.function_ {
  color: #66b3ff;
}

[data-theme='dark'] .hljs-variable.language_ {
  color: #cc99ff;
}

[data-theme='dark'] .hljs-title.class_ {
  color: #ffaa66;
}

[data-theme='dark'] .hljs-property,
[data-theme='dark'] .hljs-attr {
  color: #66ccff;
}

[data-theme='dark'] .hljs-built_in {
  color: #cc99ff;
}

[data-theme='dark'] .hljs-literal {
  color: #ffaa66;
}

[data-theme='dark'] .hljs-operator {
  color: #aaaaaa;
}

[data-theme='dark'] .hljs-tag,
[data-theme='dark'] .hljs-name,
[data-theme='dark'] .hljs-selector-tag {
  color: #ff6666;
}

[data-theme='dark'] .hljs-selector-class,
[data-theme='dark'] .hljs-selector-id {
  color: #ffaa66;
}

[data-theme='dark'] .hljs-regexp {
  color: #66ff66;
}

/* Auto theme detection for syntax highlighting */

/* Footer - Beautiful Enhanced Design */
.footer {
  margin-top: var(--spacing-2xl);
  background: var(--bg-secondary);
  border-radius: var(--radius-xl);
  border: 1px solid var(--border-color);
  box-shadow: var(--shadow-light);
  overflow: hidden;
}

/* Footer Hero Section */
.footer-hero {
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  padding: var(--spacing-xl) var(--spacing-2xl);
  text-align: center;
  color: #000;
  position: relative;
}

.footer-hero::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
  pointer-events: none;
}

.footer-hero-content {
  position: relative;
  z-index: 1;
}

.footer-title {
  font-size: var(--font-size-2xl);
  font-weight: 700;
  margin: 0 0 var(--spacing-sm) 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-md);
}

.footer-icon {
  font-size: 1.5em;
  animation: pulse-glow 2s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.05); opacity: 0.8; }
}

.footer-subtitle {
  font-size: var(--font-size-lg);
  margin: 0;
  opacity: 0.9;
  font-weight: 500;
}

/* Footer Content Grid */
.footer-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--spacing-xl);
  padding: var(--spacing-2xl);
  background: var(--bg-tertiary);
}

.footer-section {
  background: var(--bg-secondary);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  border: 1px solid var(--border-color);
  transition: all var(--transition-fast);
}

.footer-section:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-medium);
  border-color: var(--brand-primary);
}

.footer-section-header {
  margin-bottom: var(--spacing-lg);
}

.footer-section-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

/* Footer Statistics */
.footer-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  gap: var(--spacing-md);
}

.footer-stat {
  text-align: center;
  padding: var(--spacing-md);
  background: var(--bg-primary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-color);
  transition: all var(--transition-fast);
}

.footer-stat:hover {
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  color: #000;
  transform: translateY(-1px);
}

.footer-stat-value {
  display: block;
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--brand-primary);
  margin-bottom: var(--spacing-xs);
}

.footer-stat:hover .footer-stat-value {
  color: #000;
}

.footer-stat-label {
  display: block;
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.footer-stat:hover .footer-stat-label {
  color: rgba(0, 0, 0, 0.8);
}

/* Footer Info Items */
.footer-info {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.footer-info-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--bg-primary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-color);
  transition: all var(--transition-fast);
}

.footer-info-item:hover {
  background: var(--bg-tertiary);
  border-color: var(--brand-primary);
}

.footer-info-label {
  font-weight: 600;
  color: var(--text-primary);
  font-size: var(--font-size-sm);
}

.footer-info-value {
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  background: var(--bg-tertiary);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-color);
}

/* Footer Configuration */
.footer-config {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.footer-config-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--bg-primary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-color);
  transition: all var(--transition-fast);
}

.footer-config-item:hover {
  background: var(--bg-tertiary);
  border-color: var(--brand-primary);
}

.footer-config-label {
  font-weight: 600;
  color: var(--text-primary);
  font-size: var(--font-size-sm);
}

.footer-config-value {
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  color: var(--brand-primary);
  background: var(--bg-tertiary);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-color);
  font-weight: 600;
}

/* Footer Bottom Section */
.footer-bottom {
  background: var(--bg-tertiary);
  padding: var(--spacing-xl);
  border-top: 1px solid var(--border-color);
}

.footer-tips {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-lg);
  align-items: center;
}

.footer-tip {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  background: var(--bg-secondary);
  padding: var(--spacing-md) var(--spacing-lg);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-color);
  max-width: 600px;
  text-align: center;
}

.footer-tip-icon {
  font-size: var(--font-size-xl);
  flex-shrink: 0;
}

.footer-tip-text {
  font-size: var(--font-size-md);
  color: var(--text-primary);
  line-height: 1.5;
}

.footer-shortcuts {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-md);
  justify-content: center;
}

.footer-shortcut-group {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  background: var(--bg-secondary);
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-color);
  transition: all var(--transition-fast);
}

.footer-shortcut-group:hover {
  background: var(--bg-primary);
  border-color: var(--brand-primary);
  transform: translateY(-1px);
}

.footer-kbd {
  background: var(--bg-primary);
  color: var(--text-primary);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-color);
  font-family: var(--font-mono);
  font-size: var(--font-size-xs);
  font-weight: 600;
  min-width: 40px;
  text-align: center;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.footer-shortcut-desc {
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  font-weight: 500;
}

/* Footer Brand */
.footer-brand {
  background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
  padding: var(--spacing-lg);
  border-top: 1px solid var(--border-color);
  text-align: center;
}

.footer-brand-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 600px;
  margin: 0 auto;
}

.footer-brand-text {
  font-size: var(--font-size-md);
  color: var(--text-primary);
  font-weight: 500;
}

.footer-heart {
  color: #e74c3c;
  animation: heartbeat 1.5s ease-in-out infinite;
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.footer-version {
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  background: var(--bg-tertiary);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-color);
}

/* Responsive Footer */
@media (max-width: 768px) {
  .footer-hero {
    padding: var(--spacing-lg) var(--spacing-xl);
  }
  
  .footer-title {
    font-size: var(--font-size-xl);
    flex-direction: column;
    gap: var(--spacing-sm);
  }
  
  .footer-content {
    grid-template-columns: 1fr;
    padding: var(--spacing-xl);
    gap: var(--spacing-lg);
  }
  
  .footer-stats {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .footer-brand-content {
    flex-direction: column;
    gap: var(--spacing-sm);
  }
  
  .footer-shortcuts {
    flex-direction: column;
    gap: var(--spacing-sm);
  }
  
  .footer-shortcut-group {
    justify-content: center;
    min-width: 120px;
  }
}

/* Dark Theme Adjustments */
[data-theme='dark'] .footer-hero {
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  color: #000;
}

[data-theme='dark'] .footer-hero::before {
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.05));
}

[data-theme='dark'] .footer-stat:hover {
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  color: #000;
}

[data-theme='dark'] .footer-stat:hover .footer-stat-value,
[data-theme='dark'] .footer-stat:hover .footer-stat-label {
  color: #000;
}

/* Timestamp Tooltip Integration */
.footer .timestamp-with-tooltip {
  cursor: help;
  position: relative;
  transition: all var(--transition-fast);
}

.footer .timestamp-with-tooltip:hover {
  color: var(--brand-primary);
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    padding: 1rem;
  }

  .header {
    padding: 1rem;
  }

  .header h1 {
    font-size: 1.8rem;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }
}

/* Stats Grid - FROM OLD WORKING SCRIPT */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.stat-card h3 {
  color: #495057;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-value {
  font-size: 2rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.stat-value.success {
  color: #28a745;
}

.stat-value.warning {
  color: #ffc107;
}

.stat-value.danger {
  color: #dc3545;
}

.progress-bar {
  background: #e9ecef;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  transition: width 0.3s ease;
}

.progress-fill.success {
  background: #28a745;
}

.progress-fill.warning {
  background: #ffc107;
}

.progress-fill.danger {
  background: #dc3545;
}

/* Section - FROM OLD WORKING SCRIPT */
.section {
  background: white;
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 2rem;
}

.section h2 {
  color: #495057;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* Priority Grid - FROM OLD WORKING SCRIPT */
.priority-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.priority-card {
  padding: 1rem;
  border-radius: 6px;
  text-align: center;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  transition: all var(--transition-normal);
}

.priority-card.critical {
  background: rgba(220, 53, 69, 0.1);
  border: 1px solid rgba(220, 53, 69, 0.3);
  color: #dc3545;
}

.priority-card.high {
  background: rgba(255, 193, 7, 0.1);
  border: 1px solid rgba(255, 193, 7, 0.3);
  color: #ffc107;
}

.priority-card.medium {
  background: rgba(40, 167, 69, 0.1);
  border: 1px solid rgba(40, 167, 69, 0.3);
  color: #28a745;
}

.priority-card.low {
  background: rgba(0, 123, 255, 0.1);
  border: 1px solid rgba(0, 123, 255, 0.3);
  color: #007bff;
}

.priority-number {
  font-size: 1.5rem;
  font-weight: bold;
}

/* Filter Tabs - FROM OLD WORKING SCRIPT */
.filter-tabs {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.filter-tab {
  padding: 0.5rem 1rem;
  border: 1px solid var(--border-color);
  background: var(--bg-secondary);
  cursor: pointer;
  border-radius: 4px;
  color: var(--text-primary);
  transition: all var(--transition-normal);
}

.filter-tab.active {
  background: var(--brand-primary);
  color: white;
  border-color: var(--brand-primary);
}

/* Gap Table - FROM OLD WORKING SCRIPT */
.gap-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
}

.gap-table th,
.gap-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
  color: var(--text-primary);
}

.gap-table th {
  background: var(--bg-secondary);
  font-weight: 600;
  color: var(--text-primary);
}

.gap-table tr:hover {
  background: var(--hover-bg);
}

.gap-table tbody tr:last-child td {
  border-bottom: none;
}

/* Badges - FROM OLD WORKING SCRIPT */
.badge {
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
}

.badge.missing {
  background: rgba(220, 53, 69, 0.1);
  color: #dc3545;
  border: 1px solid rgba(220, 53, 69, 0.3);
}

.badge.inadequate {
  background: rgba(255, 193, 7, 0.1);
  color: #ffc107;
  border: 1px solid rgba(255, 193, 7, 0.3);
}

/* Code Spans - FROM OLD WORKING SCRIPT */
.code {
  background: var(--code-bg);
  padding: 0.2rem 0.4rem;
  border-radius: 3px;
  font-family: 'Monaco', 'Menlo', monospace;
  font-size: 0.9rem;
  color: var(--code-text);
  border: 1px solid var(--border-color);
}

/* Utility Classes */
.hidden {
  display: none;
}

/* Typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  font-weight: 600;
  line-height: 1.2;
  margin-bottom: var(--spacing-md);
  color: var(--text-primary);
}

h1 {
  font-size: var(--font-size-3xl);
}

h2 {
  font-size: var(--font-size-2xl);
}

h3 {
  font-size: var(--font-size-xl);
}

p {
  margin-bottom: var(--spacing-md);
  color: var(--text-secondary);
}

/* Links */
a {
  color: var(--brand-primary);
  text-decoration: none;
  transition: color var(--transition-fast);
}

a:hover {
  color: var(--brand-primary-dark);
  text-decoration: underline;
}

/* Code Blocks */
pre {
  background: var(--code-bg);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: var(--spacing-md);
  overflow-x: auto;
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  line-height: 1.5;
  color: var(--code-text);
}

code {
  background: var(--code-bg);
  padding: 0.1em 0.3em;
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: 0.9em;
  color: var(--code-text);
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-sm) var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  font-weight: 500;
  text-decoration: none;
  cursor: pointer;
  transition: all var(--transition-fast);
  user-select: none;
}

.btn:hover {
  background: var(--hover-bg);
  transform: translateY(-1px);
  box-shadow: var(--shadow-sm);
}

.btn-primary {
  background: var(--brand-primary);
  color: white;
  border-color: var(--brand-primary);
}

.btn-primary:hover {
  background: var(--brand-primary-dark);
  border-color: var(--brand-primary-dark);
}

/* File Paths */
.file-path {
  color: var(--file-path-color);
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
}

.file-directory {
  color: var(--file-directory-color);
}

.file-name {
  color: var(--file-path-color);
  font-weight: 500;
}

/* Lists */
ul,
ol {
  margin-bottom: var(--spacing-md);
  padding-left: var(--spacing-lg);
}

li {
  margin-bottom: var(--spacing-xs);
  color: var(--text-secondary);
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: var(--spacing-lg);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  overflow: hidden;
}

th,
td {
  padding: var(--spacing-sm) var(--spacing-md);
  text-align: left;
  border-bottom: 1px solid var(--border-color);
}

th {
  background: var(--bg-secondary);
  font-weight: 600;
  color: var(--text-primary);
  border-bottom: 2px solid var(--border-color);
}

tr:hover {
  background: var(--hover-bg);
}

/* Utility Classes */
.text-center {
  text-align: center;
}

.text-right {
  text-align: right;
}

.text-muted {
  color: var(--text-secondary);
}

.text-small {
  font-size: var(--font-size-sm);
}

.mt-0 {
  margin-top: 0;
}

.mb-0 {
  margin-bottom: 0;
}

.p-0 {
  padding: 0;
}

/* Loading States */
.loading {
  opacity: 0.6;
  pointer-events: none;
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in {
  animation: fadeIn var(--transition-normal) ease-out;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--brand-primary);
  border-radius: var(--radius-xl);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--brand-primary-dark);
}

/* Advanced Filter Controls */
.advanced-filter-controls {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

.filter-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-md);
  flex-wrap: wrap;
}

.search-container {
  position: relative;
  flex: 1;
  min-width: 200px;
}

.search-input {
  width: 100%;
  padding: var(--spacing-sm) var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  transition: border-color var(--transition-fast);
}

.search-input:focus {
  outline: none;
  border-color: var(--brand-primary);
  box-shadow: 0 0 0 2px rgba(237, 174, 73, 0.2);
}

.search-clear {
  position: absolute;
  right: var(--spacing-sm);
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-secondary);
  font-size: var(--font-size-lg);
  padding: var(--spacing-xs);
  border-radius: var(--radius-sm);
  transition: all var(--transition-fast);
}

.search-clear:hover {
  color: var(--brand-primary);
  background: var(--bg-tertiary);
}

.table-controls {
  display: flex;
  gap: var(--spacing-sm);
  align-items: center;
}

.control-btn {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-sm) var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.control-btn:hover {
  background: var(--brand-primary);
  color: white;
  border-color: var(--brand-primary);
}

.btn-icon {
  font-size: var(--font-size-sm);
}

.filter-tags {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-md);
}

.filter-group {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
}

.filter-label {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--text-primary);
  min-width: 60px;
}

.filter-tag {
  padding: var(--spacing-xs) var(--spacing-sm);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--font-size-xs);
  cursor: pointer;
  transition: all var(--transition-fast);
  white-space: nowrap;
  font-family: inherit;
  font-weight: 500;
  outline: none;
  user-select: none;
}

.filter-tag:hover {
  background: var(--bg-tertiary);
  border-color: var(--brand-primary);
}

.filter-tag:focus {
  outline: none;
  border-color: var(--brand-primary);
  box-shadow: 0 0 0 2px rgba(237, 174, 73, 0.2);
}

.filter-tag.active {
  background: var(--brand-primary);
  color: white;
  border-color: var(--brand-primary);
}

.filter-status-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: var(--spacing-sm);
  border-top: 1px solid var(--border-color);
}

.results-summary {
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
}

.clear-btn {
  padding: var(--spacing-xs) var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.clear-btn:hover {
  background: var(--color-error);
  color: white;
  border-color: var(--color-error);
}

/* Priority and Effort Indicators */
.priority-indicator {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.priority-critical {
  color: var(--color-error);
}

.priority-high {
  color: var(--color-warning);
}

.priority-medium {
  color: var(--brand-primary);
}

.priority-low {
  color: var(--color-info);
}

.effort-indicator {
  font-size: var(--font-size-xs);
  font-weight: 600;
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  text-transform: uppercase;
}

.effort-high {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-error);
}

.effort-medium {
  background: rgba(255, 193, 7, 0.1);
  color: var(--color-warning);
}

.effort-low {
  background: rgba(34, 197, 94, 0.1);
  color: var(--color-success);
}

/* Issues Text */
.issues-text {
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
  line-height: 1.3;
}

/* Preview Footer */
.preview-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--bg-tertiary);
  border-top: 1px solid var(--border-color);
  border-radius: 0 0 var(--radius-md) var(--radius-md);
  margin-top: var(--spacing-sm);
}

.file-info {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--text-primary);
  font-family: var(--font-mono);
}

.view-source-hint {
  font-size: var(--font-size-xs);
  color: var(--text-secondary);
  font-style: italic;
}

/* Sortable Headers */
.sortable {
  cursor: pointer;
  user-select: none;
  position: relative;
  transition: background var(--transition-fast);
}

.sortable:hover {
  background: var(--hover-bg);
}

.sort-indicator {
  margin-left: var(--spacing-xs);
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
}

/* Pagination */
.pagination-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--bg-tertiary);
  border-top: 1px solid var(--border-color);
  border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  flex-wrap: wrap;
  gap: var(--spacing-md);
}

.pagination-info {
  display: flex;
  align-items: center;
  gap: var(--spacing-lg);
  font-size: var(--font-size-sm);
  color: var(--text-secondary);
}

.items-per-page {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.items-select {
  padding: var(--spacing-xs) var(--spacing-sm);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  cursor: pointer;
}

.pagination-controls {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.pagination-btn {
  padding: var(--spacing-xs) var(--spacing-sm);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
  min-width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.pagination-btn:hover:not(:disabled) {
  background: var(--brand-primary);
  color: white;
  border-color: var(--brand-primary);
}

.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.pagination-pages {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: var(--font-size-sm);
  color: var(--text-primary);
}

.page-input {
  width: 60px;
  padding: var(--spacing-xs);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: var(--font-size-sm);
  text-align: center;
}

.page-input:focus {
  outline: none;
  border-color: var(--brand-primary);
}

/* Table Styles for Documentation Coverage Report */

/* Table Container */
.table-container {
  background: var(--bg-secondary);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--shadow-light);
  border: 1px solid var(--border-color);
  margin-bottom: 2rem;
}

.table-header {
  background: linear-gradient(
    135deg,
    var(--golden-primary),
    var(--golden-secondary)
  );
  color: #000;
  padding: 1rem 1.5rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1rem;
}

.table-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin: 0;
}

.table-controls {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
}

/* Search and Filter Controls */
.search-container {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.search-input {
  padding: 0.5rem 1rem;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 0.9rem;
  transition: border-color var(--transition-fast);
  min-width: 200px;
}

.search-input:focus {
  outline: none;
  border-color: var(--golden-primary);
  box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
}

.search-clear {
  position: absolute;
  right: 8px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-muted);
  font-size: 1.2rem;
}

.filter-select {
  padding: 0.5rem;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 0.9rem;
  cursor: pointer;
}

/* Table Wrapper */
.table-wrapper {
  position: relative;
  overflow: auto;
  max-height: 70vh;
}

/* Enhanced Scrollbar */
.table-wrapper::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

.table-wrapper::-webkit-scrollbar-track {
  background: var(--bg-tertiary);
  border-radius: 6px;
}

.table-wrapper::-webkit-scrollbar-thumb {
  background: linear-gradient(
    135deg,
    var(--golden-primary),
    var(--golden-secondary)
  );
  border-radius: 6px;
  border: 2px solid var(--bg-tertiary);
}

.table-wrapper::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(
    135deg,
    var(--golden-secondary),
    var(--golden-accent)
  );
}

.table-wrapper::-webkit-scrollbar-corner {
  background: var(--bg-tertiary);
}

/* Main Table */
.coverage-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
  background: var(--bg-secondary);
}

.coverage-table th,
.coverage-table td {
  padding: 0.75rem 1rem;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
  vertical-align: middle;
}

/* Table Header */
.coverage-table th {
  background: var(--bg-tertiary);
  font-weight: 600;
  color: var(--text-primary);
  position: sticky;
  top: 0;
  z-index: 10;
  user-select: none;
  cursor: pointer;
  transition: background-color var(--transition-fast);
}

.coverage-table th:hover {
  background: var(--border-color);
}

/* Sortable Headers */
.sortable {
  position: relative;
  padding-right: 2rem;
}

.sortable::after {
  content: '↕️';
  position: absolute;
  right: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0.5;
  transition: opacity var(--transition-fast);
}

.sortable:hover::after {
  opacity: 1;
}

.sortable.sort-asc::after {
  content: '↑';
  opacity: 1;
  color: var(--golden-primary);
}

.sortable.sort-desc::after {
  content: '↓';
  opacity: 1;
  color: var(--golden-primary);
}

/* Multi-sort indicators - Enhanced for better visibility */
.sort-primary::before {
  content: '1';
  position: absolute;
  left: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.75rem;
  font-weight: bold;
  background: var(--golden-primary);
  color: #000;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.sort-secondary::before {
  content: '2';
  position: absolute;
  left: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.75rem;
  font-weight: bold;
  background: var(--golden-secondary, #f39c12);
  color: #000;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Adjust sortable padding to accommodate multi-sort indicators */
.sort-primary {
  padding-left: 2.5rem;
}

.sort-secondary {
  padding-left: 2.5rem;
}

/* Table Body */
.coverage-table tbody tr {
  transition: background-color var(--transition-fast);
  cursor: pointer;
}

.coverage-table tbody tr:hover {
  background: var(--bg-tertiary);
}

.coverage-table tbody tr:nth-child(even) {
  background: rgba(0, 0, 0, 0.02);
}

[data-theme='dark'] .coverage-table tbody tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.02);
}

/* File Path Column */
.file-path {
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 0.85rem;
  color: var(--text-primary);
  font-weight: 500;
  max-width: 300px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  transition: all var(--transition-fast);
}

.file-path:hover {
  color: var(--link-color);
  max-width: none;
  white-space: normal;
  word-break: break-all;
}

/* Cell Content */
.cell-content {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  min-height: 1.5rem;
}

.cell-text {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.cell-expand {
  opacity: 0;
  transition: opacity var(--transition-fast);
  cursor: pointer;
  font-size: 0.8rem;
}

.cell-content:hover .cell-expand {
  opacity: 1;
}

/* Priority and Status Columns */
.priority-cell,
.status-cell {
  text-align: center;
  width: 120px;
}

/* Badges in Table */
.coverage-table .status-badge {
  font-size: 0.7rem;
  padding: 0.2rem 0.6rem;
}

/* Pagination */
.pagination-container {
  display: flex;
  justify-content: between;
  align-items: center;
  padding: 1rem 1.5rem;
  background: var(--bg-tertiary);
  border-top: 1px solid var(--border-color);
  flex-wrap: wrap;
  gap: 1rem;
}

.pagination-info {
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.pagination-controls {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.pagination-btn {
  padding: 0.4rem 0.8rem;
  border: 1px solid var(--border-color);
  background: var(--bg-secondary);
  color: var(--text-primary);
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.8rem;
  transition: all var(--transition-fast);
}

.pagination-btn:hover:not(:disabled) {
  background: var(--golden-primary);
  color: #000;
  border-color: var(--golden-primary);
}

.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.pagination-btn.active {
  background: var(--golden-primary);
  color: #000;
  border-color: var(--golden-primary);
}

/* Page Size Selector */
.page-size-container {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.page-size-select {
  padding: 0.3rem 0.5rem;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  font-size: 0.8rem;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--text-muted);
}

.empty-state-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
}

.empty-state-text {
  font-size: 1.1rem;
  margin-bottom: 0.5rem;
}

.empty-state-subtext {
  font-size: 0.9rem;
}

/* Loading State */
.table-loading {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 3rem;
  flex-direction: column;
  gap: 1rem;
}

/* Responsive Table */
@media (max-width: 768px) {
  .table-header {
    flex-direction: column;
    align-items: stretch;
  }

  .table-controls {
    justify-content: space-between;
  }

  .search-input {
    min-width: 150px;
  }

  .coverage-table {
    font-size: 0.8rem;
  }

  .coverage-table th,
  .coverage-table td {
    padding: 0.5rem 0.75rem;
  }

  .file-path {
    max-width: 200px;
  }

  .pagination-container {
    flex-direction: column;
    gap: 0.5rem;
  }
}

/* Table-specific CSS styles for HTML Documentation Coverage Report */
/* Enhanced table styling with proper column widths and layout */

/* Advanced Table Container */
.advanced-table-container {
  overflow: auto;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  background: var(--bg-secondary);
  margin: 1rem 0;
  max-height: 80vh;
}

/* Main Table - CRITICAL FIXED LAYOUT */
.advanced-table {
  width: 100%;
  min-width: 1200px;
  border-collapse: collapse;
  font-size: 14px;
  background: var(--bg-secondary);
  table-layout: fixed !important;
}

/* Table Cells - Base Styling */
.advanced-table th,
.advanced-table td {
  padding: 12px 16px;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
  vertical-align: top;
  box-sizing: border-box;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Table Headers */
.advanced-table th {
  background: var(--bg-tertiary);
  font-weight: 600;
  color: var(--text-primary);
  position: sticky;
  top: 0;
  z-index: 10;
  border-bottom: 2px solid var(--border-color);
  user-select: none;
}

/* COLUMN WIDTHS - FIXED AND ENFORCED */
.advanced-table .col-file {
  width: 25% !important;
  min-width: 250px !important;
  max-width: 350px !important;
}

.advanced-table .col-status {
  width: 10% !important;
  min-width: 100px !important;
  max-width: 120px !important;
}

.advanced-table .col-priority {
  width: 8% !important;
  min-width: 80px !important;
  max-width: 100px !important;
}

.advanced-table .col-size {
  width: 8% !important;
  min-width: 80px !important;
  max-width: 100px !important;
}

.advanced-table .col-expected {
  width: 20% !important;
  min-width: 200px !important;
  max-width: 300px !important;
}

.advanced-table .col-effort {
  width: 8% !important;
  min-width: 80px !important;
  max-width: 100px !important;
}

.advanced-table .col-issues {
  width: 15% !important;
  min-width: 150px !important;
  max-width: 200px !important;
}

.advanced-table .col-type {
  width: 6% !important;
  min-width: 60px !important;
  max-width: 80px !important;
}

/* File Path Specific Styling */
.advanced-table .col-file {
  white-space: normal !important;
  word-break: break-word !important;
  overflow-wrap: break-word !important;
}

.file-path-container {
  font-family: var(--font-mono);
  font-size: 13px;
  line-height: 1.4;
  display: block;
  width: 100%;
}

.file-directory {
  color: var(--text-secondary);
  opacity: 0.7;
  font-weight: 400;
}

.file-name {
  color: var(--brand-primary);
  font-weight: 600;
}

.clickable-filename {
  cursor: pointer;
  text-decoration: underline;
  transition: all 0.2s ease;
}

.clickable-filename:hover {
  color: var(--brand-secondary);
  text-shadow: 0 0 4px rgba(237, 174, 73, 0.3);
}

/* Row Hover Effects */
.advanced-table tbody tr:hover {
  background: var(--hover-bg) !important;
  cursor: pointer;
}

.advanced-table tbody tr.clickable-row:hover {
  background: linear-gradient(
    135deg,
    var(--hover-bg),
    rgba(237, 174, 73, 0.05)
  ) !important;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(237, 174, 73, 0.1);
}

/* Badge Styling */
.badge {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  white-space: nowrap;
}

.badge-error {
  background: #ef4444;
  color: white;
}

.badge-warning {
  background: #f59e0b;
  color: white;
}

.badge-info {
  background: #3b82f6;
  color: white;
}

.badge-success {
  background: #22c55e;
  color: white;
}

/* Code Path Styling */
.doc-path {
  font-family: var(--font-mono);
  font-size: 12px;
  background: var(--bg-primary);
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid var(--border-color);
  display: inline-block;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Effort Badges */
.effort-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  text-transform: capitalize;
}

.effort-low {
  background: #22c55e;
  color: white;
}
.effort-medium {
  background: #f59e0b;
  color: white;
}
.effort-high {
  background: #ef4444;
  color: white;
}

/* File Type Badges */
.file-type-badge {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  border: 1px solid var(--border-color);
}

/* Sort Indicators */
.sortable {
  cursor: pointer;
  position: relative;
}

.sortable:hover {
  background: var(--hover-bg);
}

.sort-indicators {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 12px;
}

/* Header Content Layout */
.header-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  position: relative;
}

.header-text {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Responsive Adjustments */
@media (max-width: 1400px) {
  .advanced-table {
    font-size: 13px;
  }

  .advanced-table th,
  .advanced-table td {
    padding: 10px 12px;
  }
}

@media (max-width: 1200px) {
  .advanced-table {
    font-size: 12px;
  }

  .advanced-table th,
  .advanced-table td {
    padding: 8px 10px;
  }
}

/* Scrollbar Styling */
.advanced-table-container::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

.advanced-table-container::-webkit-scrollbar-track {
  background: var(--bg-secondary);
  border-radius: 6px;
}

.advanced-table-container::-webkit-scrollbar-thumb {
  background: var(--brand-primary);
  border-radius: 6px;
  border: 2px solid var(--bg-secondary);
}

.advanced-table-container::-webkit-scrollbar-thumb:hover {
  background: var(--brand-secondary);
}

/* Firefox Scrollbars */
.advanced-table-container {
  scrollbar-width: auto;
  scrollbar-color: var(--brand-primary) var(--bg-secondary);
}

/* Modal Styles for Documentation Coverage Report - REBUILT FROM SCRATCH */

/* Modal Overlay - Fixed to actually work */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.8);
  z-index: 9999;
  backdrop-filter: blur(4px);
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.modal.show {
  display: flex !important;
  opacity: 1;
}

/* Modal Content Container */
.modal-content {
  background: var(--bg-secondary, #2a2a2a);
  border-radius: 12px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  border: 1px solid var(--border-color, #444);
  width: 90vw;
  height: 80vh;
  max-width: 1200px;
  max-height: 800px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.modal.show .modal-content {
  transform: scale(1);
}

/* Source Code Modal Specific */
.source-modal .modal-content {
  width: 95vw;
  height: 95vh;
  max-height: none;
}

/* Modal Header */
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1.5rem;
  border-bottom: 1px solid var(--border-color, #444);
  background: linear-gradient(135deg, #f4d03f, #f7dc6f);
  color: #000;
  flex-shrink: 0;
}

.modal-header h3 {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  flex: 1;
}

.modal-header-actions {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

/* GitHub Button */
#open-github-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 6px;
  padding: 0.4rem 0.8rem;
  color: #000;
  font-weight: 500;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
}

#open-github-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: translateY(-1px);
}

/* Close Button */
.modal-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #000;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background-color 0.2s ease;
}

.modal-close:hover {
  background: rgba(0, 0, 0, 0.1);
}

/* Modal Body */
.modal-body {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 0;
  padding: 1.5rem;
}

.source-modal-body {
  padding: 0;
  height: 100%;
}

/* Source Code Display */
.source-code {
  flex: 1;
  margin: 0;
  padding: 0;
  overflow: auto;
  background: var(--bg-primary, #1a1a1a);
  font-family: 'Consolas', 'Monaco', 'Ubuntu Mono', 'Courier New', monospace;
  font-size: 0.9rem;
  line-height: 1.4;
  border: none;
  color: var(--text-primary, #e0e0e0);
  white-space: pre;
  height: 100%;
  min-height: 0;
  display: flex;
  flex-direction: column;
}

.source-code code {
  background: var(--bg-primary, #1a1a1a);
  padding: 1rem;
  font-size: inherit;
  color: var(--text-primary, #e0e0e0);
  display: block;
  white-space: pre;
  flex: 1;
  overflow: auto;
  margin: 0;
  font-family: inherit;
  line-height: inherit;
}

/* Ensure the specific source-code-text element has proper scrolling */
#source-code-text {
  overflow: auto !important;
  height: 100% !important;
  width: 100% !important;
  display: block !important;
  white-space: pre !important;
  padding: 1rem !important;
  margin: 0 !important;
  font-family: 'Consolas', 'Monaco', 'Ubuntu Mono', 'Courier New', monospace !important;
  font-size: 0.9rem !important;
  line-height: 1.4 !important;
  background: var(--bg-primary, #1a1a1a) !important;
  color: var(--text-primary, #e0e0e0) !important;
  border: none !important;
  outline: none !important;
  flex: 1 !important;
  min-height: 0 !important;
}

/* Make sure modal content container allows proper scrolling */
#source-code-content {
  flex: 1;
  min-height: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Ensure no double scrollbars */
.hljs-code-preview {
  height: 100%;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.hljs-lines {
  flex: 1;
  overflow: auto;
  padding: 1rem;
  margin: 0;
  font-family: 'Consolas', 'Monaco', 'Ubuntu Mono', 'Courier New', monospace;
  font-size: 0.9rem;
  line-height: 1.4;
  background: var(--bg-primary, #1a1a1a);
  color: var(--text-primary, #e0e0e0);
}

.line-wrapper {
  display: flex;
  min-height: 1.4em;
  align-items: flex-start;
}

.line-number {
  display: inline-block;
  width: 3em;
  text-align: right;
  color: var(--text-secondary, #666);
  background: var(--bg-secondary, #2a2a2a);
  padding: 0 0.5rem;
  margin-right: 1rem;
  font-weight: 500;
  flex-shrink: 0;
  user-select: none;
  border-right: 1px solid var(--border-color, #444);
}

.line-content {
  flex: 1;
  padding-left: 1rem;
  white-space: pre;
  color: var(--text-primary, #e0e0e0);
  font-family: inherit;
  background: none;
}

/* Comprehensive Syntax Highlighting */
.hljs-keyword,
.hljs-built_in,
.hljs-type {
  color: #569cd6; /* Blue for keywords like 'import', 'export', 'function', 'const' */
  font-weight: 500;
}

.hljs-string,
.hljs-template-string {
  color: #ce9178; /* Orange for strings */
}

.hljs-comment {
  color: #6a9955; /* Green for comments */
  font-style: italic;
}

.hljs-number {
  color: #b5cea8; /* Light green for numbers */
}

.hljs-class,
.hljs-title {
  color: #4ec9b0; /* Teal for class names and function names */
  font-weight: 500;
}

.hljs-variable,
.hljs-property {
  color: #9cdcfe; /* Light blue for variables */
}

.hljs-function .hljs-title {
  color: #dcdcaa; /* Yellow for function names */
  font-weight: 500;
}

.hljs-tag {
  color: #569cd6; /* Blue for JSX tags */
}

.hljs-name {
  color: #4ec9b0; /* Teal for JSX component names */
}

.hljs-attr {
  color: #92c5f7; /* Light blue for JSX attributes */
}

.hljs-value {
  color: #ce9178; /* Orange for attribute values */
}

.hljs-punctuation {
  color: #d4d4d4; /* Light gray for punctuation */
}

.hljs-operator {
  color: #d4d4d4; /* Light gray for operators */
}

.hljs-literal,
.hljs-boolean {
  color: #569cd6; /* Blue for true/false/null */
}

/* TypeScript specific */
.hljs-interface,
.hljs-enum {
  color: #4ec9b0; /* Teal for interfaces and enums */
  font-weight: 500;
}

.hljs-decorator {
  color: #c586c0; /* Purple for decorators */
}

/* JSX specific highlighting */
.hljs-jsx .hljs-tag {
  color: #569cd6;
}

.hljs-jsx .hljs-name {
  color: #4ec9b0;
}

.hljs-jsx .hljs-attr {
  color: #92c5f7;
}

/* React specific */
.react-hook,
.hljs-hook {
  color: #c586c0; /* Purple for React hooks */
  font-weight: 500;
}

/* Additional refinements */
.hljs-symbol {
  color: #b5cea8;
}

.hljs-bullet {
  color: #d7ba7d;
}

.hljs-built_in {
  color: #569cd6;
}

.hljs-title.function_ {
  color: #dcdcaa;
}

.hljs-section {
  color: #e9c46a;
}

/* Loading and Error States */
.source-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem;
  color: var(--text-secondary, #888);
  height: 100%;
}

.source-error {
  text-align: center;
  padding: 3rem;
  color: var(--status-error, #f87171);
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.loading-spinner {
  border: 3px solid var(--border-color, #444);
  border-top: 3px solid var(--brand-primary, #f4d03f);
  border-radius: 50%;
  width: 30px;
  height: 30px;
  animation: spin 1s linear infinite;
  margin-bottom: 1rem;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Modal Footer */
.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  padding: 1rem 1.5rem;
  border-top: 1px solid var(--border-color, #444);
  background: var(--bg-tertiary, #333);
  flex-shrink: 0;
}

.modal-footer .btn-secondary,
.modal-footer .btn-primary {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.modal-footer .btn-secondary {
  background: var(--bg-tertiary, #555);
  color: var(--text-primary, #e0e0e0);
  border: 1px solid var(--border-color, #666);
}

.modal-footer .btn-secondary:hover {
  background: var(--bg-hover, #666);
}

.modal-footer .btn-primary {
  background: var(--brand-primary, #f4d03f);
  color: #000;
}

.modal-footer .btn-primary:hover {
  background: #f1c40f;
  transform: translateY(-1px);
}

/* Column Picker Styles */
.column-picker {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
  max-height: 400px;
  overflow-y: auto;
  padding: 0.5rem;
}

.column-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  border: 1px solid var(--border-color, #444);
  border-radius: 8px;
  background: var(--bg-tertiary, #333);
  transition: all 0.2s ease;
  position: relative;
}

.column-item:hover {
  background: var(--bg-hover, #404040);
  border-color: var(--brand-primary, #f4d03f);
}

.column-item.essential {
  background: var(--bg-primary, #1a1a1a);
  border-color: var(--brand-primary, #f4d03f);
  opacity: 0.7;
}

.column-item.essential:hover {
  background: var(--bg-primary, #1a1a1a);
  border-color: var(--brand-primary, #f4d03f);
  opacity: 0.8;
}

.column-checkbox {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: var(--brand-primary, #f4d03f);
}

.column-checkbox:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

.column-label {
  flex: 1;
  font-weight: 500;
  cursor: pointer;
  color: var(--text-primary, #e0e0e0);
}

.column-label:has(+ .column-checkbox:disabled) {
  cursor: not-allowed;
  opacity: 0.7;
}

.column-essential {
  font-size: 0.75rem;
  color: var(--brand-primary, #f4d03f);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: 0.25rem 0.5rem;
  background: rgba(244, 208, 63, 0.1);
  border-radius: 4px;
  margin-left: auto;
}

/* Column Picker Modal Specific */
#column-picker-modal .modal-content {
  width: 70vw;
  height: 60vh;
  max-width: 800px;
  max-height: 600px;
}

#column-picker-modal .modal-body {
  padding: 1.5rem;
}

#column-picker-modal .modal-body > p {
  margin-bottom: 1rem;
  color: var(--text-secondary, #888);
}

/* Dark/Light Theme Support */
[data-theme='light'] .modal-content {
  background: #ffffff;
  border-color: #e0e0e0;
  color: #333;
}

[data-theme='light'] .modal-header {
  border-bottom-color: #e0e0e0;
}

[data-theme='light'] .source-code {
  background: #f8f9fa;
  color: #333;
}

[data-theme='light'] .column-item {
  background: #f8f9fa;
  border-color: #e0e0e0;
}

[data-theme='light'] .column-item.essential {
  background: #fff;
  border-color: #f4d03f;
}

[data-theme='light'] .column-label {
  color: #333;
}

[data-theme='light'] .modal-footer {
  background: #f8f9fa;
  border-top-color: #e0e0e0;
}

[data-theme='light'] .modal-footer .btn-secondary {
  background: #e9ecef;
  color: #333;
  border-color: #d1d5db;
}

[data-theme='light'] .modal-footer .btn-secondary:hover {
  background: #d1d5db;
}

[data-theme='light'] .column-essential {
  background: rgba(244, 208, 63, 0.2);
  color: #b7950b;
}


        /* Advanced Filter Controls */
        .advanced-filter-controls {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .filter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        
        .search-container {
            position: relative;
            flex: 1;
            min-width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            padding-right: 40px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            transition: border-color 0.2s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.1);
        }
        
        .search-clear {
            position: absolute;
            right: var(--spacing-sm);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .search-clear:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .table-controls {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        
        .control-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .control-btn:hover {
            background: var(--bg-hover);
            border-color: var(--color-primary);
        }
        
        .btn-icon {
            font-size: var(--font-size-sm);
        }
        
        .btn-text {
            font-weight: 500;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
        }
        
        .filter-tag {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all 0.2s ease;
            white-space: nowrap;
            font-family: inherit;
            font-weight: 500;
            outline: none;
            user-select: none;
        }
        
        .filter-tag:hover {
            background: var(--bg-hover);
            border-color: var(--color-primary);
        }
        
        .filter-tag:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.1);
        }
        
        .filter-tag.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        .filter-status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        
        .clear-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--color-secondary);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--color-secondary);
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all 0.2s ease;
        }
        
        .clear-btn:hover {
            background: var(--color-secondary);
            color: white;
        }
        
        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .suggestions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }
        
        .suggestions-title {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .suggestions-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .suggestions-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .suggestion-group {
            padding: var(--spacing-sm) 0;
        }
        
        .suggestion-group-title {
            padding: var(--spacing-xs) var(--spacing-md);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: var(--font-size-xs);
            text-transform: uppercase;
        }
        
        .suggestion-item {
            padding: var(--spacing-xs) var(--spacing-md);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .suggestion-item:hover {
            background: var(--bg-hover);
        }
        
        /* Active Filters Summary */
        .active-filters-summary {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin-bottom: var(--spacing-sm);
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }
        
        .summary-title {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .summary-clear {
            background: none;
            border: none;
            color: var(--color-secondary);
            cursor: pointer;
            font-size: var(--font-size-sm);
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }
        
        .summary-clear:hover {
            background: var(--color-secondary);
            color: white;
        }
        
        .active-filters-list {
            padding: var(--spacing-sm) var(--spacing-md);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-container {
                min-width: unset;
            }
            
            .table-controls {
                justify-content: center;
            }
            
            .filter-tags {
                justify-content: center;
            }
            
            .filter-status-row {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
        }
        

        /* Pagination Controls */
        .pagination-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: var(--spacing-md) 0;
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }
        
        .pagination-info {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .pagination-controls-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .page-size-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .page-size-select {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }
        
        .pagination-buttons {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
        }
        
        .pagination-btn {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: var(--bg-tertiary);
            border-color: var(--brand-primary);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-indicator {
            padding: var(--spacing-xs) var(--spacing-sm);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            font-weight: 500;
        }
        
        /* Filter Controls */
        .advanced-filter-controls {
            margin-bottom: var(--spacing-lg);
        }
        
        .filter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            gap: var(--spacing-md);
        }
        
        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
        }
        
        .search-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            transition: all var(--transition-fast);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 2px var(--brand-primary-light);
        }
        
        .search-clear {
            position: absolute;
            right: var(--spacing-sm);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .search-clear:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .table-controls {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .control-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
        }
        
        .control-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--brand-primary);
        }
        
        .btn-icon {
            font-size: var(--font-size-sm);
        }
        
        .btn-text {
            font-weight: 500;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }
        
        .filter-tag {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
            user-select: none;
        }
        
        .filter-tag:hover {
            background: var(--bg-tertiary);
            border-color: var(--brand-primary);
        }
        
        .filter-tag.active {
            background: var(--brand-primary);
            color: var(--dark-text-primary);
            border-color: var(--brand-primary);
        }
        
        .filter-status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm);
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
        }
        
        .clear-btn {
            background: none;
            border: none;
            color: var(--brand-primary);
            cursor: pointer;
            font-size: var(--font-size-sm);
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .clear-btn:hover {
            background: var(--bg-tertiary);
        }
        
        /* Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            margin-top: var(--spacing-xs);
        }
        
        .suggestions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            border-radius: var(--radius-md) var(--radius-md) 0 0;
        }
        
        .suggestions-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }
        
        .suggestions-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .suggestions-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .suggestions-content {
            padding: var(--spacing-md);
        }
        
        .suggestion-group {
            margin-bottom: var(--spacing-md);
        }
        
        .suggestion-group:last-child {
            margin-bottom: 0;
        }
        
        .suggestion-group-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-sm);
        }
        
        .suggestion-items {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }
        
        .suggestion-item {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        .suggestion-item:hover {
            background: var(--brand-primary);
            color: var(--dark-text-primary);
        }
        
        /* Active Filters Summary */
        .active-filters-summary {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }
        
        .summary-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }
        
        .summary-clear {
            background: none;
            border: none;
            color: var(--brand-primary);
            cursor: pointer;
            font-size: var(--font-size-sm);
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .summary-clear:hover {
            background: var(--bg-tertiary);
        }
        
        .active-filters-list {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .pagination-controls {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .pagination-controls-group {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .filter-row {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .search-container {
                max-width: none;
            }
            
            .table-controls {
                justify-content: center;
            }
            
            .filter-tags {
                justify-content: center;
            }
            
            .filter-status-row {
                flex-direction: column;
                gap: var(--spacing-sm);
                text-align: center;
            }
        }
        
    </style>
</head>
<body>
    <div class="theme-toggle">
        <button id="theme-toggle-btn" class="theme-toggle-btn" aria-label="Toggle theme">
            <span class="theme-icon light-icon">☀️</span>
            <span class="theme-icon dark-icon">🌙</span>
        </button>
    </div>
    
    <div class="container">

        <div class="header">
            <h1>📊 Documentation Coverage Report</h1>
            <p>Comprehensive analysis of documentation coverage across the Idling.app codebase</p>
            <p>Generated: 2025-07-09T07:57:51.180331</p>
        </div>

        <div class="overview-grid">
            <div class="metric-card" data-metric="total-files">
                <div class="metric-value">510</div>
                <div class="metric-label">TOTAL FILES</div>
            </div>
            <div class="metric-card" data-metric="documented-files">
                <div class="metric-value">6</div>
                <div class="metric-label">DOCUMENTED FILES</div>
            </div>
            <div class="metric-card" data-metric="coverage">
                <div class="metric-value quality-poor">1.2%</div>
                <div class="metric-label">COVERAGE</div>
            </div>
            <div class="metric-card" data-metric="quality">
                <div class="metric-value quality-good">0.73</div>
                <div class="metric-label">QUALITY SCORE</div>
                <div class="metric-subtitle">Shows files needing quality improvements</div>
            </div>
        </div>
        
        <!-- Second row with missing/inadequate documentation -->
        <div class="overview-grid">
            <div class="metric-card" data-metric="missing">
                <div class="metric-value quality-poor">440</div>
                <div class="metric-label">MISSING DOCUMENTATION</div>
                <div class="metric-subtitle">Files without any documentation</div>
            </div>
            <div class="metric-card" data-metric="inadequate">
                <div class="metric-value quality-fair">64</div>
                <div class="metric-label">INADEQUATE DOCUMENTATION</div>
                <div class="metric-subtitle">Files with incomplete documentation</div>
            </div>
        </div>

        <div class="card">
            <h2>📈 Quality Metrics</h2>
            <div class="overview-grid">
                <div class="metric-card clickable-card" data-filter="missing" title="Click to show missing documentation">
                    <div class="metric-value quality-poor">440</div>
                    <div class="metric-label">Missing Documentation</div>
                </div>
                <div class="metric-card clickable-card" data-filter="inadequate" title="Click to show inadequate documentation">
                    <div class="metric-value quality-poor">64</div>
                    <div class="metric-label">Inadequate Documentation</div>
                </div>
                <div class="metric-card clickable-card" data-filter="all" title="Click to show all issues">
                    <div class="metric-value quality-good">504</div>
                    <div class="metric-label">Total Issues</div>
                </div>
            </div>
        </div>
        

        <div class="card">
            <h2>🎯 Priority Breakdown</h2>
            <div class="overview-grid">
                
                <div class="metric-card clickable-card" data-filter="critical" title="🚨 Click to filter and show only critical priority items - Immediate action required">
                    <div class="metric-value quality-poor">133</div>
                    <div class="metric-label">🚨 Critical</div>
                    <p style="font-size: var(--font-size-xs); margin-top: var(--spacing-xs);">Immediate action required</p>
                </div>
                <div class="metric-card clickable-card" data-filter="high" title="⚠️ Click to filter and show only high priority items - Action needed soon">
                    <div class="metric-value quality-fair">129</div>
                    <div class="metric-label">⚠️ High</div>
                    <p style="font-size: var(--font-size-xs); margin-top: var(--spacing-xs);">Action needed soon</p>
                </div>
                <div class="metric-card clickable-card" data-filter="medium" title="📝 Click to filter and show only medium priority items - Should be documented">
                    <div class="metric-value quality-good">119</div>
                    <div class="metric-label">📝 Medium</div>
                    <p style="font-size: var(--font-size-xs); margin-top: var(--spacing-xs);">Should be documented</p>
                </div>
                <div class="metric-card clickable-card" data-filter="low" title="💡 Click to filter and show only low priority items - Nice to have">
                    <div class="metric-value quality-excellent">123</div>
                    <div class="metric-label">💡 Low</div>
                    <p style="font-size: var(--font-size-xs); margin-top: var(--spacing-xs);">Nice to have</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>📄 Advanced Documentation Gaps Analysis</h2>
            
            <!-- Enhanced Filter Controls -->
            <div class="advanced-filter-controls">
                <div class="filter-row">
                    <div class="search-container">
                        <input type="text" id="gap-search" placeholder="🔍 Search files, paths, or issues..." class="search-input">
                        <button class="search-clear" id="search-clear" title="Clear search">✕</button>
                    </div>
                    <div class="table-controls">
                        <button id="column-picker-btn" class="control-btn" title="Show/Hide Columns">
                            <span class="btn-icon">⚙️</span>
                            <span class="btn-text">Columns</span>
                        </button>
                        <button id="reset-table-btn" class="control-btn" title="Reset Table Settings">
                            <span class="btn-icon">🔄</span>
                            <span class="btn-text">Reset</span>
                        </button>
                    </div>
                </div>
                
                <div class="filter-tags">
                    <div class="filter-group">
                        <span class="filter-label">Priority:</span>
                        <button class="filter-tag active" data-filter="priority" data-value="">All (504)</button>
                        <button class="filter-tag" data-filter="priority" data-value="critical">🚨 Critical (133)</button>
                        <button class="filter-tag" data-filter="priority" data-value="high">⚠️ High (129)</button>
                        <button class="filter-tag" data-filter="priority" data-value="medium">📝 Medium (119)</button>
                        <button class="filter-tag" data-filter="priority" data-value="low">💡 Low (123)</button>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Status:</span>
                        <button class="filter-tag active" data-filter="status" data-value="">All</button>
                        <button class="filter-tag" data-filter="status" data-value="missing">❌ Missing</button>
                        <button class="filter-tag" data-filter="status" data-value="inadequate">⚠️ Inadequate</button>
                    </div>
                </div>
                
                <div class="filter-status-row">
                    <div class="results-summary">
                        <span id="filtered-count">504</span> of <span id="total-count">504</span> items
                    </div>
                    <button class="clear-btn" id="clear-all-filters">Clear All Filters 🧹</button>
                </div>
            </div>
            
            <!-- Advanced Table Container -->
            <div class="advanced-table-container">
                <table class="advanced-table" id="gaps-table">
                    <thead>
                        <tr>
                            <th class="sortable col-file" data-column="file">📁 File <span class="sort-indicator"></span></th>
                            <th class="sortable col-lines" data-column="lines">📏 Lines <span class="sort-indicator"></span></th>
                            <th class="sortable col-status" data-column="status">📊 Status <span class="sort-indicator"></span></th>
                            <th class="sortable col-priority" data-column="priority">🎯 Priority <span class="sort-indicator"></span></th>
                            <th class="sortable col-doc" data-column="doc">📄 Expected Doc <span class="sort-indicator"></span></th>
                            <th class="sortable col-effort" data-column="effort">⏱️ Effort <span class="sort-indicator"></span></th>
                            <th class="sortable col-issues" data-column="issues">⚠️ Issues <span class="sort-indicator"></span></th>
                        </tr>
                    </thead>
                    <tbody id="gaps-table-body">
                        
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/ErrorBoundary.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ErrorBoundary.tsx"
                    data-expected-doc="src/app/components/ErrorBoundary.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ErrorBoundary.tsx"
                    data-line-count="29">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ErrorBoundary.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">29</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ErrorBoundary.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/fade-in/FadeIn.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/fade-in/FadeIn.test.tsx"
                    data-expected-doc="src/app/components/fade-in/FadeIn.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/fade-in/FadeIn.test.tsx"
                    data-line-count="65">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/fade-in/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FadeIn.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">65</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FadeIn.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/fade-in/FadeIn.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/fade-in/FadeIn.tsx"
                    data-expected-doc="src/app/components/fade-in/FadeIn.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/fade-in/FadeIn.tsx"
                    data-line-count="56">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/fade-in/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FadeIn.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">56</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FadeIn.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/user-profile/UserProfile.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/user-profile/UserProfile.tsx"
                    data-expected-doc="src/app/components/user-profile/UserProfile.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/user-profile/UserProfile.tsx"
                    data-line-count="365">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/user-profile/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserProfile.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">365</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserProfile.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/page-header/PageHeader.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-header/PageHeader.tsx"
                    data-expected-doc="src/app/components/page-header/PageHeader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-header/PageHeader.tsx"
                    data-line-count="10">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-header/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageHeader.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">10</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageHeader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/page-header/PageHeader.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-header/PageHeader.test.tsx"
                    data-expected-doc="src/app/components/page-header/PageHeader.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-header/PageHeader.test.tsx"
                    data-line-count="22">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-header/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageHeader.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">22</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageHeader.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/post/CreatePostForm.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/post/CreatePostForm.tsx"
                    data-expected-doc="src/app/components/post/CreatePostForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/post/CreatePostForm.tsx"
                    data-line-count="98">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/post/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CreatePostForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">98</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CreatePostForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/post/PostItem.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/post/PostItem.tsx"
                    data-expected-doc="src/app/components/post/PostItem.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/post/PostItem.tsx"
                    data-line-count="27">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/post/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostItem.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">27</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostItem.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/post/PostList.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/post/PostList.tsx"
                    data-expected-doc="src/app/components/post/PostList.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/post/PostList.tsx"
                    data-line-count="44">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/post/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostList.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">44</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostList.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/cache-status/CacheStatus.test.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/cache-status/CacheStatus.test.tsx"
                    data-expected-doc="src/app/components/cache-status/CacheStatus.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/cache-status/CacheStatus.test.tsx"
                    data-line-count="234">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/cache-status/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CacheStatus.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">234</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CacheStatus.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/cache-status/SmartCacheStatus.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/cache-status/SmartCacheStatus.tsx"
                    data-expected-doc="src/app/components/cache-status/SmartCacheStatus.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/cache-status/SmartCacheStatus.tsx"
                    data-line-count="560">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/cache-status/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartCacheStatus.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">560</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartCacheStatus.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/cache-status/NoCacheStatus.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/cache-status/NoCacheStatus.tsx"
                    data-expected-doc="src/app/components/cache-status/NoCacheStatus.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/cache-status/NoCacheStatus.tsx"
                    data-line-count="287">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/cache-status/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NoCacheStatus.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">287</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NoCacheStatus.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/cache-status/CacheStatus.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/cache-status/CacheStatus.tsx"
                    data-expected-doc="src/app/components/cache-status/CacheStatus.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/cache-status/CacheStatus.tsx"
                    data-line-count="379">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/cache-status/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CacheStatus.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">379</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CacheStatus.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/gitlab-link/GitLabLink.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/gitlab-link/GitLabLink.test.tsx"
                    data-expected-doc="src/app/components/gitlab-link/GitLabLink.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/gitlab-link/GitLabLink.test.tsx"
                    data-line-count="17">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/gitlab-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GitLabLink.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">17</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GitLabLink.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/gitlab-link/GitLabLink.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/gitlab-link/GitLabLink.tsx"
                    data-expected-doc="src/app/components/gitlab-link/GitLabLink.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/gitlab-link/GitLabLink.tsx"
                    data-line-count="16">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/gitlab-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GitLabLink.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">16</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GitLabLink.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/floating-add-post/FloatingAddPost.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/floating-add-post/FloatingAddPost.tsx"
                    data-expected-doc="src/app/components/floating-add-post/FloatingAddPost.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/floating-add-post/FloatingAddPost.tsx"
                    data-line-count="106">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/floating-add-post/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FloatingAddPost.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">106</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FloatingAddPost.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/author/Author.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/author/Author.tsx"
                    data-expected-doc="src/app/components/author/Author.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/author/Author.tsx"
                    data-line-count="554">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/author/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Author.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">554</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Author.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/empty/Empty.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/empty/Empty.tsx"
                    data-expected-doc="src/app/components/empty/Empty.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/empty/Empty.tsx"
                    data-line-count="18">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/empty/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Empty.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">18</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Empty.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/empty/Empty.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/empty/Empty.test.tsx"
                    data-expected-doc="src/app/components/empty/Empty.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/empty/Empty.test.tsx"
                    data-line-count="34">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/empty/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Empty.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">34</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Empty.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/page-aside/PageAside.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-aside/PageAside.tsx"
                    data-expected-doc="src/app/components/page-aside/PageAside.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-aside/PageAside.tsx"
                    data-line-count="25">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-aside/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageAside.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">25</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageAside.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/page-aside/PageAside.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-aside/PageAside.test.tsx"
                    data-expected-doc="src/app/components/page-aside/PageAside.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-aside/PageAside.test.tsx"
                    data-line-count="55">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-aside/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageAside.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">55</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageAside.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/message-ticker/MessageTicker.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/message-ticker/MessageTicker.tsx"
                    data-expected-doc="src/app/components/message-ticker/MessageTicker.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/message-ticker/MessageTicker.tsx"
                    data-line-count="59">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/message-ticker/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">MessageTicker.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">59</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">MessageTicker.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/message-ticker/MessageTickerWithInterval.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/message-ticker/MessageTickerWithInterval.tsx"
                    data-expected-doc="src/app/components/message-ticker/MessageTickerWithInterval.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/message-ticker/MessageTickerWithInterval.tsx"
                    data-line-count="34">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/message-ticker/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">MessageTickerWithInterval.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">34</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">MessageTickerWithInterval.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/auth-buttons/AuthButtons.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/auth-buttons/AuthButtons.tsx"
                    data-expected-doc="src/app/components/auth-buttons/AuthButtons.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-buttons/AuthButtons.tsx"
                    data-line-count="44">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-buttons/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AuthButtons.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">44</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AuthButtons.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/auth-buttons/ClientAuthButtons.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/auth-buttons/ClientAuthButtons.tsx"
                    data-expected-doc="src/app/components/auth-buttons/ClientAuthButtons.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-buttons/ClientAuthButtons.tsx"
                    data-line-count="69">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-buttons/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ClientAuthButtons.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">69</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ClientAuthButtons.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/auth-buttons/SessionRefreshHandler.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/auth-buttons/SessionRefreshHandler.tsx"
                    data-expected-doc="src/app/components/auth-buttons/SessionRefreshHandler.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-buttons/SessionRefreshHandler.tsx"
                    data-line-count="252">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-buttons/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SessionRefreshHandler.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">252</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SessionRefreshHandler.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/auth-buttons/AuthButtons.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/auth-buttons/AuthButtons.test.tsx"
                    data-expected-doc="src/app/components/auth-buttons/AuthButtons.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-buttons/AuthButtons.test.tsx"
                    data-line-count="65">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-buttons/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AuthButtons.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">65</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AuthButtons.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/discord-link/DiscordLink.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/discord-link/DiscordLink.tsx"
                    data-expected-doc="src/app/components/discord-link/DiscordLink.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/discord-link/DiscordLink.tsx"
                    data-line-count="30">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/discord-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DiscordLink.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">30</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DiscordLink.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/discord-link/DiscordLink.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/discord-link/DiscordLink.test.tsx"
                    data-expected-doc="src/app/components/discord-link/DiscordLink.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/discord-link/DiscordLink.test.tsx"
                    data-line-count="53">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/discord-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DiscordLink.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">53</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DiscordLink.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/discord-link/Discord.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/discord-link/Discord.test.tsx"
                    data-expected-doc="src/app/components/discord-link/Discord.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/discord-link/Discord.test.tsx"
                    data-line-count="17">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/discord-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Discord.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">17</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Discord.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/infinite-scroll-trigger/InfiniteScrollTrigger.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/infinite-scroll-trigger/InfiniteScrollTrigger.tsx"
                    data-expected-doc="src/app/components/infinite-scroll-trigger/InfiniteScrollTrigger.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/infinite-scroll-trigger/InfiniteScrollTrigger.tsx"
                    data-line-count="110">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/infinite-scroll-trigger/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">InfiniteScrollTrigger.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">110</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">InfiniteScrollTrigger.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submission-forms/edit-submission-form/EditSubmissionForm.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/edit-submission-form/EditSubmissionForm.tsx"
                    data-expected-doc="src/app/components/submission-forms/edit-submission-form/EditSubmissionForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/edit-submission-form/EditSubmissionForm.tsx"
                    data-line-count="50">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/edit-submission-form/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EditSubmissionForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">50</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EditSubmissionForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submission-forms/add-submission-form/AddSubmissionForm.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/add-submission-form/AddSubmissionForm.tsx"
                    data-expected-doc="src/app/components/submission-forms/add-submission-form/AddSubmissionForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/add-submission-form/AddSubmissionForm.tsx"
                    data-line-count="279">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/add-submission-form/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AddSubmissionForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">279</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AddSubmissionForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submission-forms/add-submission-form/AddSubmissionForm.test.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/add-submission-form/AddSubmissionForm.test.tsx"
                    data-expected-doc="src/app/components/submission-forms/add-submission-form/AddSubmissionForm.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/add-submission-form/AddSubmissionForm.test.tsx"
                    data-line-count="181">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/add-submission-form/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AddSubmissionForm.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">181</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AddSubmissionForm.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submission-forms/shared-submission-form/SharedSubmissionForm.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/SharedSubmissionForm.tsx"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/SharedSubmissionForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/SharedSubmissionForm.tsx"
                    data-line-count="269">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SharedSubmissionForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">269</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SharedSubmissionForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.tsx"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.tsx"
                    data-line-count="399">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RichInputAdapter.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">399</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RichInputAdapter.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.tsx"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.tsx"
                    data-line-count="419">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FloatingToolbar.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">419</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FloatingToolbar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.tsx"
                    data-expected-doc="src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.tsx"
                    data-line-count="159">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/delete-submission-form/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DeleteSubmissionForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">159</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DeleteSubmissionForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.test.tsx"
                    data-expected-doc="src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.test.tsx"
                    data-line-count="124">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/delete-submission-form/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DeleteSubmissionForm.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">124</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DeleteSubmissionForm.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/pagination/PageSizeSelector.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/pagination/PageSizeSelector.tsx"
                    data-expected-doc="src/app/components/pagination/PageSizeSelector.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/pagination/PageSizeSelector.tsx"
                    data-line-count="40">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/pagination/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageSizeSelector.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">40</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageSizeSelector.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/pagination/StickyPagination.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/pagination/StickyPagination.tsx"
                    data-expected-doc="src/app/components/pagination/StickyPagination.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/pagination/StickyPagination.tsx"
                    data-line-count="94">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/pagination/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">StickyPagination.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">94</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">StickyPagination.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/pagination/Pagination.test.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/pagination/Pagination.test.tsx"
                    data-expected-doc="src/app/components/pagination/Pagination.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/pagination/Pagination.test.tsx"
                    data-line-count="187">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/pagination/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Pagination.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">187</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Pagination.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/pagination/PageSizeSelector.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/pagination/PageSizeSelector.test.tsx"
                    data-expected-doc="src/app/components/pagination/PageSizeSelector.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/pagination/PageSizeSelector.test.tsx"
                    data-line-count="83">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/pagination/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageSizeSelector.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">83</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageSizeSelector.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/pagination/Pagination.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/pagination/Pagination.tsx"
                    data-expected-doc="src/app/components/pagination/Pagination.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/pagination/Pagination.tsx"
                    data-line-count="142">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/pagination/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Pagination.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">142</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Pagination.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/filter-bar/FilterBar.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/filter-bar/FilterBar.tsx"
                    data-expected-doc="src/app/components/filter-bar/FilterBar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/FilterBar.tsx"
                    data-line-count="392">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FilterBar.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">392</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FilterBar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/filter-bar/FilterBar.test.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/filter-bar/FilterBar.test.tsx"
                    data-expected-doc="src/app/components/filter-bar/FilterBar.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/FilterBar.test.tsx"
                    data-line-count="597">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FilterBar.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">597</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FilterBar.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/filter-bar/CustomFilterInput.test.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/filter-bar/CustomFilterInput.test.tsx"
                    data-expected-doc="src/app/components/filter-bar/CustomFilterInput.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/CustomFilterInput.test.tsx"
                    data-line-count="309">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CustomFilterInput.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">309</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CustomFilterInput.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/filter-bar/CustomFilterInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/filter-bar/CustomFilterInput.tsx"
                    data-expected-doc="src/app/components/filter-bar/CustomFilterInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/CustomFilterInput.tsx"
                    data-line-count="400">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CustomFilterInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">400</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CustomFilterInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/filter-bar/FilterLabel.test.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/filter-bar/FilterLabel.test.tsx"
                    data-expected-doc="src/app/components/filter-bar/FilterLabel.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/FilterLabel.test.tsx"
                    data-line-count="533">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FilterLabel.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">533</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FilterLabel.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/filter-bar/FilterLabel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/filter-bar/FilterLabel.tsx"
                    data-expected-doc="src/app/components/filter-bar/FilterLabel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/FilterLabel.tsx"
                    data-line-count="396">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FilterLabel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">396</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FilterLabel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/timeout-banner/TimeoutBanner.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/timeout-banner/TimeoutBanner.tsx"
                    data-expected-doc="src/app/components/timeout-banner/TimeoutBanner.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/timeout-banner/TimeoutBanner.tsx"
                    data-line-count="149">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/timeout-banner/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TimeoutBanner.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">149</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TimeoutBanner.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/docs-link/DocsLink.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/docs-link/DocsLink.tsx"
                    data-expected-doc="src/app/components/docs-link/DocsLink.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/docs-link/DocsLink.tsx"
                    data-line-count="20">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/docs-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DocsLink.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">20</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DocsLink.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/docs-link/DocsLink.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/docs-link/DocsLink.test.tsx"
                    data-expected-doc="src/app/components/docs-link/DocsLink.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/docs-link/DocsLink.test.tsx"
                    data-line-count="27">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/docs-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DocsLink.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">27</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DocsLink.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/docs-link/Docs.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/docs-link/Docs.test.tsx"
                    data-expected-doc="src/app/components/docs-link/Docs.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/docs-link/Docs.test.tsx"
                    data-line-count="20">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/docs-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Docs.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">20</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Docs.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/nav/NavPaths.test.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/nav/NavPaths.test.tsx"
                    data-expected-doc="src/app/components/nav/NavPaths.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/nav/NavPaths.test.tsx"
                    data-line-count="162">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavPaths.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">162</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavPaths.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/nav/NavPaths.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/nav/NavPaths.tsx"
                    data-expected-doc="src/app/components/nav/NavPaths.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/nav/NavPaths.tsx"
                    data-line-count="91">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavPaths.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">91</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavPaths.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/nav/Nav.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/nav/Nav.tsx"
                    data-expected-doc="src/app/components/nav/Nav.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/nav/Nav.tsx"
                    data-line-count="48">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Nav.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">48</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Nav.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/nav/NavAuth.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/nav/NavAuth.tsx"
                    data-expected-doc="src/app/components/nav/NavAuth.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/nav/NavAuth.tsx"
                    data-line-count="42">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavAuth.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">42</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavAuth.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/nav/Nav.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/nav/Nav.test.tsx"
                    data-expected-doc="src/app/components/nav/Nav.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/nav/Nav.test.tsx"
                    data-line-count="139">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Nav.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">139</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Nav.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/nav/NavUserProfile.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/nav/NavUserProfile.tsx"
                    data-expected-doc="src/app/components/nav/NavUserProfile.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/nav/NavUserProfile.tsx"
                    data-line-count="31">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavUserProfile.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">31</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavUserProfile.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/loader/Loader.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/loader/Loader.test.tsx"
                    data-expected-doc="src/app/components/loader/Loader.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/loader/Loader.test.tsx"
                    data-line-count="23">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/loader/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Loader.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">23</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Loader.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/loader/Loader.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/loader/Loader.tsx"
                    data-expected-doc="src/app/components/loader/Loader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/loader/Loader.tsx"
                    data-line-count="19">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/loader/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Loader.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">19</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Loader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/user-search/UserSearch.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/user-search/UserSearch.tsx"
                    data-expected-doc="src/app/components/user-search/UserSearch.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/user-search/UserSearch.tsx"
                    data-line-count="208">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/user-search/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserSearch.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">208</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserSearch.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/vote-buttons/VoteButtons.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/vote-buttons/VoteButtons.tsx"
                    data-expected-doc="src/app/components/vote-buttons/VoteButtons.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/vote-buttons/VoteButtons.tsx"
                    data-line-count="65">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/vote-buttons/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">VoteButtons.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">65</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">VoteButtons.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/pwa-install/PWAInstallPrompt.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/pwa-install/PWAInstallPrompt.tsx"
                    data-expected-doc="src/app/components/pwa-install/PWAInstallPrompt.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/pwa-install/PWAInstallPrompt.tsx"
                    data-line-count="154">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/pwa-install/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PWAInstallPrompt.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">154</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PWAInstallPrompt.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/SubmissionItem.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/SubmissionItem.tsx"
                    data-expected-doc="src/app/components/submissions-list/SubmissionItem.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/SubmissionItem.tsx"
                    data-line-count="509">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SubmissionItem.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">509</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SubmissionItem.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/StickyPostsControls.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/StickyPostsControls.tsx"
                    data-expected-doc="src/app/components/submissions-list/StickyPostsControls.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/StickyPostsControls.tsx"
                    data-line-count="198">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">StickyPostsControls.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">198</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">StickyPostsControls.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/SubmissionsList.test.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/SubmissionsList.test.tsx"
                    data-expected-doc="src/app/components/submissions-list/SubmissionsList.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/SubmissionsList.test.tsx"
                    data-line-count="172">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SubmissionsList.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">172</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SubmissionsList.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/SubmissionsList.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/SubmissionsList.tsx"
                    data-expected-doc="src/app/components/submissions-list/SubmissionsList.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/SubmissionsList.tsx"
                    data-line-count="452">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SubmissionsList.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">452</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SubmissionsList.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/SubmissionThread.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/SubmissionThread.tsx"
                    data-expected-doc="src/app/components/submissions-list/SubmissionThread.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/SubmissionThread.tsx"
                    data-line-count="128">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SubmissionThread.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">128</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SubmissionThread.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/PostsManager.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/PostsManager.tsx"
                    data-expected-doc="src/app/components/submissions-list/PostsManager.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/PostsManager.tsx"
                    data-line-count="444">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostsManager.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">444</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostsManager.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submissions-list/components/SearchStatus.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SearchStatus.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SearchStatus.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SearchStatus.tsx"
                    data-line-count="13">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SearchStatus.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">13</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SearchStatus.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/components/SmartFilterInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SmartFilterInput.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SmartFilterInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SmartFilterInput.tsx"
                    data-line-count="328">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartFilterInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">328</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartFilterInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/components/TextSearchInput.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/TextSearchInput.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/TextSearchInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/TextSearchInput.tsx"
                    data-line-count="135">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TextSearchInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">135</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TextSearchInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/components/SearchInputContainer.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SearchInputContainer.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SearchInputContainer.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SearchInputContainer.tsx"
                    data-line-count="271">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SearchInputContainer.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">271</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SearchInputContainer.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/PostsManagerFilters.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/PostsManagerFilters.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/PostsManagerFilters.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/PostsManagerFilters.tsx"
                    data-line-count="86">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostsManagerFilters.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">86</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostsManagerFilters.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/PostsManagerControls.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/PostsManagerControls.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/PostsManagerControls.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/PostsManagerControls.tsx"
                    data-line-count="148">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostsManagerControls.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">148</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostsManagerControls.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/PostsManagerPagination.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/PostsManagerPagination.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/PostsManagerPagination.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/PostsManagerPagination.tsx"
                    data-line-count="73">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostsManagerPagination.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">73</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostsManagerPagination.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/components/SmartTextSearchInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SmartTextSearchInput.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SmartTextSearchInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SmartTextSearchInput.tsx"
                    data-line-count="545">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartTextSearchInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">545</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartTextSearchInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submissions-list/components/TextSearchInput.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/TextSearchInput.test.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/TextSearchInput.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/TextSearchInput.test.tsx"
                    data-line-count="12">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TextSearchInput.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">12</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TextSearchInput.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/card/Card.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/card/Card.tsx"
                    data-expected-doc="src/app/components/card/Card.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/card/Card.tsx"
                    data-line-count="22">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/card/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Card.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">22</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Card.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/card/Card.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/card/Card.test.tsx"
                    data-expected-doc="src/app/components/card/Card.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/card/Card.test.tsx"
                    data-line-count="42">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/card/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Card.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">42</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Card.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/avatar/Avatar.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/avatar/Avatar.test.tsx"
                    data-expected-doc="src/app/components/avatar/Avatar.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/avatar/Avatar.test.tsx"
                    data-line-count="67">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/avatar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Avatar.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">67</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Avatar.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/avatar/Avatar.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/avatar/Avatar.tsx"
                    data-expected-doc="src/app/components/avatar/Avatar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/avatar/Avatar.tsx"
                    data-line-count="158">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/avatar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Avatar.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">158</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Avatar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/URLPill.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/URLPill.tsx"
                    data-expected-doc="src/app/components/ui/URLPill.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/URLPill.tsx"
                    data-line-count="534">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">URLPill.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">534</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">URLPill.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/FooterBadge.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/FooterBadge.tsx"
                    data-expected-doc="src/app/components/ui/FooterBadge.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/FooterBadge.tsx"
                    data-line-count="130">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FooterBadge.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">130</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FooterBadge.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/ui/ImageEmbed.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/ImageEmbed.tsx"
                    data-expected-doc="src/app/components/ui/ImageEmbed.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/ImageEmbed.tsx"
                    data-line-count="192">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ImageEmbed.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">192</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ImageEmbed.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/YouTubeModal.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/YouTubeModal.tsx"
                    data-expected-doc="src/app/components/ui/YouTubeModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/YouTubeModal.tsx"
                    data-line-count="82">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">YouTubeModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">82</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">YouTubeModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/BackButton.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/BackButton.tsx"
                    data-expected-doc="src/app/components/ui/BackButton.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/BackButton.tsx"
                    data-line-count="111">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">BackButton.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">111</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">BackButton.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/GrammarlyCleanup.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/GrammarlyCleanup.tsx"
                    data-expected-doc="src/app/components/ui/GrammarlyCleanup.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/GrammarlyCleanup.tsx"
                    data-line-count="55">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GrammarlyCleanup.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">55</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GrammarlyCleanup.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/ui/LoadingButton.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/LoadingButton.tsx"
                    data-expected-doc="src/app/components/ui/LoadingButton.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/LoadingButton.tsx"
                    data-line-count="160">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">LoadingButton.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">160</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">LoadingButton.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/InlineSuggestionInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/InlineSuggestionInput.tsx"
                    data-expected-doc="src/app/components/ui/InlineSuggestionInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/InlineSuggestionInput.tsx"
                    data-line-count="801">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">InlineSuggestionInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">801</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">InlineSuggestionInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/ui/SmartPillInput.test.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/SmartPillInput.test.tsx"
                    data-expected-doc="src/app/components/ui/SmartPillInput.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/SmartPillInput.test.tsx"
                    data-line-count="225">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartPillInput.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">225</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartPillInput.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/ui/OverlayRenderer.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/OverlayRenderer.tsx"
                    data-expected-doc="src/app/components/ui/OverlayRenderer.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/OverlayRenderer.tsx"
                    data-line-count="255">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">OverlayRenderer.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">255</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">OverlayRenderer.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/TimestampWithTooltip.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/TimestampWithTooltip.tsx"
                    data-expected-doc="src/app/components/ui/TimestampWithTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/TimestampWithTooltip.tsx"
                    data-line-count="354">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TimestampWithTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">354</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TimestampWithTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/SmartPillInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/SmartPillInput.tsx"
                    data-expected-doc="src/app/components/ui/SmartPillInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/SmartPillInput.tsx"
                    data-line-count="820">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartPillInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">820</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartPillInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/NavigationLoadingBar.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/NavigationLoadingBar.tsx"
                    data-expected-doc="src/app/components/ui/NavigationLoadingBar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/NavigationLoadingBar.tsx"
                    data-line-count="79">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavigationLoadingBar.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">79</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavigationLoadingBar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/SmartInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/SmartInput.tsx"
                    data-expected-doc="src/app/components/ui/SmartInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/SmartInput.tsx"
                    data-line-count="408">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">408</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/PostModal.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/PostModal.tsx"
                    data-expected-doc="src/app/components/ui/PostModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/PostModal.tsx"
                    data-line-count="112">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">112</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/ContentWithPills.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/ContentWithPills.tsx"
                    data-expected-doc="src/app/components/ui/ContentWithPills.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/ContentWithPills.tsx"
                    data-line-count="694">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ContentWithPills.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">694</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ContentWithPills.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/RefreshButton.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/RefreshButton.tsx"
                    data-expected-doc="src/app/components/ui/RefreshButton.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/RefreshButton.tsx"
                    data-line-count="69">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RefreshButton.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">69</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RefreshButton.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/ui/PillInput.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/PillInput.tsx"
                    data-expected-doc="src/app/components/ui/PillInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/PillInput.tsx"
                    data-line-count="217">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PillInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">217</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PillInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/ContentWithPills.test.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/ContentWithPills.test.tsx"
                    data-expected-doc="src/app/components/ui/ContentWithPills.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/ContentWithPills.test.tsx"
                    data-line-count="541">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ContentWithPills.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">541</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ContentWithPills.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/ui/InstantLink.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/InstantLink.tsx"
                    data-expected-doc="src/app/components/ui/InstantLink.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/InstantLink.tsx"
                    data-line-count="124">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">InstantLink.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">124</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">InstantLink.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/ui/EmojiPicker.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/EmojiPicker.tsx"
                    data-expected-doc="src/app/components/ui/EmojiPicker.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/EmojiPicker.tsx"
                    data-line-count="489">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EmojiPicker.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">489</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EmojiPicker.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/ui/YouTubeEmbed.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/ui/YouTubeEmbed.tsx"
                    data-expected-doc="src/app/components/ui/YouTubeEmbed.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/ui/YouTubeEmbed.tsx"
                    data-line-count="110">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/ui/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">YouTubeEmbed.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">110</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">YouTubeEmbed.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/avatars-background/AvatarsBackground.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/avatars-background/AvatarsBackground.test.tsx"
                    data-expected-doc="src/app/components/avatars-background/AvatarsBackground.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/avatars-background/AvatarsBackground.test.tsx"
                    data-line-count="89">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/avatars-background/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AvatarsBackground.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">89</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AvatarsBackground.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/avatars-background/AvatarsBackground.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/avatars-background/AvatarsBackground.tsx"
                    data-expected-doc="src/app/components/avatars-background/AvatarsBackground.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/avatars-background/AvatarsBackground.tsx"
                    data-line-count="187">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/avatars-background/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AvatarsBackground.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">187</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AvatarsBackground.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/NavbarContent.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarContent.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarContent.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarContent.tsx"
                    data-line-count="37">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarContent.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">37</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarContent.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/NavbarBody.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarBody.test.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarBody.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarBody.test.tsx"
                    data-line-count="28">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarBody.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">28</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarBody.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/NavbarItem.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarItem.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarItem.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarItem.tsx"
                    data-line-count="24">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarItem.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">24</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarItem.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/NavbarBrand.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarBrand.test.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarBrand.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarBrand.test.tsx"
                    data-line-count="19">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarBrand.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">19</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarBrand.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/navbar/NavbarBrand.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarBrand.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarBrand.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarBrand.tsx"
                    data-line-count="58">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarBrand.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">58</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarBrand.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/Navbar.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/Navbar.test.tsx"
                    data-expected-doc="src/app/components/navbar/Navbar.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/Navbar.test.tsx"
                    data-line-count="49">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Navbar.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">49</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Navbar.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/NavbarBody.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarBody.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarBody.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarBody.tsx"
                    data-line-count="11">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarBody.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">11</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarBody.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/navbar/NavbarContent.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarContent.test.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarContent.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarContent.test.tsx"
                    data-line-count="53">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarContent.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">53</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarContent.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/NavbarItem.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/NavbarItem.test.tsx"
                    data-expected-doc="src/app/components/navbar/NavbarItem.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/NavbarItem.test.tsx"
                    data-line-count="34">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NavbarItem.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">34</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NavbarItem.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/navbar/Navbar.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/navbar/Navbar.tsx"
                    data-expected-doc="src/app/components/navbar/Navbar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/navbar/Navbar.tsx"
                    data-line-count="17">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/navbar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Navbar.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">17</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Navbar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/twitch-chat/TwitchChat.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/twitch-chat/TwitchChat.tsx"
                    data-expected-doc="src/app/components/twitch-chat/TwitchChat.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/twitch-chat/TwitchChat.tsx"
                    data-line-count="96">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/twitch-chat/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TwitchChat.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">96</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TwitchChat.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/rich-text/RichTextRenderer.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/rich-text/RichTextRenderer.tsx"
                    data-expected-doc="src/app/components/rich-text/RichTextRenderer.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/rich-text/RichTextRenderer.tsx"
                    data-line-count="261">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/rich-text/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RichTextRenderer.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">261</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RichTextRenderer.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/tooltip/InteractiveTooltip.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tooltip/InteractiveTooltip.tsx"
                    data-expected-doc="src/app/components/tooltip/InteractiveTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/InteractiveTooltip.tsx"
                    data-line-count="463">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">InteractiveTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">463</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">InteractiveTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/tooltip/LinkTooltip.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tooltip/LinkTooltip.tsx"
                    data-expected-doc="src/app/components/tooltip/LinkTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/LinkTooltip.tsx"
                    data-line-count="251">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">LinkTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">251</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">LinkTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/tooltip/TooltipContent.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tooltip/TooltipContent.tsx"
                    data-expected-doc="src/app/components/tooltip/TooltipContent.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/TooltipContent.tsx"
                    data-line-count="171">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TooltipContent.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">171</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TooltipContent.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/tooltip/TooltipModal.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tooltip/TooltipModal.tsx"
                    data-expected-doc="src/app/components/tooltip/TooltipModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/TooltipModal.tsx"
                    data-line-count="127">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TooltipModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">127</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TooltipModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/tooltip/MentionTooltip.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tooltip/MentionTooltip.tsx"
                    data-expected-doc="src/app/components/tooltip/MentionTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/MentionTooltip.tsx"
                    data-line-count="91">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">MentionTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">91</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">MentionTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/tooltip/WebPreviewPortal.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tooltip/WebPreviewPortal.tsx"
                    data-expected-doc="src/app/components/tooltip/WebPreviewPortal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/WebPreviewPortal.tsx"
                    data-line-count="64">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">WebPreviewPortal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">64</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">WebPreviewPortal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/tooltip/InfoTooltip.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tooltip/InfoTooltip.tsx"
                    data-expected-doc="src/app/components/tooltip/InfoTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/InfoTooltip.tsx"
                    data-line-count="224">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">InfoTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">224</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">InfoTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/app-version/AppVersion.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/app-version/AppVersion.test.tsx"
                    data-expected-doc="src/app/components/app-version/AppVersion.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/app-version/AppVersion.test.tsx"
                    data-line-count="42">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/app-version/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AppVersion.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">42</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AppVersion.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/app-version/AppVersion.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/app-version/AppVersion.tsx"
                    data-expected-doc="src/app/components/app-version/AppVersion.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/app-version/AppVersion.tsx"
                    data-line-count="48">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/app-version/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AppVersion.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">48</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AppVersion.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/fancy-border/FancyBorder.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/fancy-border/FancyBorder.tsx"
                    data-expected-doc="src/app/components/fancy-border/FancyBorder.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/fancy-border/FancyBorder.tsx"
                    data-line-count="15">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/fancy-border/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FancyBorder.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">15</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FancyBorder.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/fancy-border/FancyBorder.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/fancy-border/FancyBorder.test.tsx"
                    data-expected-doc="src/app/components/fancy-border/FancyBorder.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/fancy-border/FancyBorder.test.tsx"
                    data-line-count="31">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/fancy-border/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FancyBorder.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">31</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FancyBorder.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/page-container/PageContainer.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-container/PageContainer.test.tsx"
                    data-expected-doc="src/app/components/page-container/PageContainer.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-container/PageContainer.test.tsx"
                    data-line-count="103">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-container/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageContainer.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">103</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageContainer.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/page-container/PageContainer.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-container/PageContainer.tsx"
                    data-expected-doc="src/app/components/page-container/PageContainer.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-container/PageContainer.tsx"
                    data-line-count="7">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-container/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageContainer.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">7</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageContainer.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/game/GameWrapper.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/game/GameWrapper.tsx"
                    data-expected-doc="src/app/components/game/GameWrapper.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/game/GameWrapper.tsx"
                    data-line-count="27">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/game/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GameWrapper.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">27</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GameWrapper.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/game/GameWrapper.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/game/GameWrapper.test.tsx"
                    data-expected-doc="src/app/components/game/GameWrapper.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/game/GameWrapper.test.tsx"
                    data-line-count="28">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/game/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GameWrapper.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">28</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GameWrapper.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/spacing-theme-toggle/SpacingThemeToggle.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/spacing-theme-toggle/SpacingThemeToggle.tsx"
                    data-expected-doc="src/app/components/spacing-theme-toggle/SpacingThemeToggle.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/spacing-theme-toggle/SpacingThemeToggle.tsx"
                    data-line-count="30">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/spacing-theme-toggle/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SpacingThemeToggle.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">30</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SpacingThemeToggle.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/service-worker/HardResetManager.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/service-worker/HardResetManager.tsx"
                    data-expected-doc="src/app/components/service-worker/HardResetManager.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/service-worker/HardResetManager.tsx"
                    data-line-count="122">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/service-worker/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">HardResetManager.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">122</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">HardResetManager.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/service-worker/ServiceWorkerRegistration.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/service-worker/ServiceWorkerRegistration.tsx"
                    data-expected-doc="src/app/components/service-worker/ServiceWorkerRegistration.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/service-worker/ServiceWorkerRegistration.tsx"
                    data-line-count="182">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/service-worker/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ServiceWorkerRegistration.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">182</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ServiceWorkerRegistration.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/error-boundary/NotFoundErrorBoundary.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/error-boundary/NotFoundErrorBoundary.tsx"
                    data-expected-doc="src/app/components/error-boundary/NotFoundErrorBoundary.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/error-boundary/NotFoundErrorBoundary.tsx"
                    data-line-count="49">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/error-boundary/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">NotFoundErrorBoundary.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">49</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">NotFoundErrorBoundary.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/coin/Coin.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/coin/Coin.tsx"
                    data-expected-doc="src/app/components/coin/Coin.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/coin/Coin.tsx"
                    data-line-count="52">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/coin/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Coin.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">52</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Coin.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/coin/Coin.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/coin/Coin.test.tsx"
                    data-expected-doc="src/app/components/coin/Coin.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/coin/Coin.test.tsx"
                    data-line-count="46">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/coin/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Coin.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">46</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Coin.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/footer/Footer.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/footer/Footer.tsx"
                    data-expected-doc="src/app/components/footer/Footer.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/footer/Footer.tsx"
                    data-line-count="19">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/footer/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Footer.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">19</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Footer.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/footer/Footer.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/footer/Footer.test.tsx"
                    data-expected-doc="src/app/components/footer/Footer.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/footer/Footer.test.tsx"
                    data-line-count="31">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/footer/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Footer.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">31</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Footer.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/tag-link/TagLink.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tag-link/TagLink.test.tsx"
                    data-expected-doc="src/app/components/tag-link/TagLink.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tag-link/TagLink.test.tsx"
                    data-line-count="122">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tag-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TagLink.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">122</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TagLink.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/tag-link/TagLink.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/tag-link/TagLink.tsx"
                    data-expected-doc="src/app/components/tag-link/TagLink.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tag-link/TagLink.tsx"
                    data-line-count="149">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tag-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TagLink.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">149</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TagLink.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/badge/Badge.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/badge/Badge.test.tsx"
                    data-expected-doc="src/app/components/badge/Badge.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/badge/Badge.test.tsx"
                    data-line-count="116">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/badge/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Badge.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">116</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Badge.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/badge/Badge.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/badge/Badge.tsx"
                    data-expected-doc="src/app/components/badge/Badge.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/badge/Badge.tsx"
                    data-line-count="38">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/badge/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Badge.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">38</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Badge.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/threaded/Threaded.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/threaded/Threaded.tsx"
                    data-expected-doc="src/app/components/threaded/Threaded.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/threaded/Threaded.tsx"
                    data-line-count="0">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/threaded/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Threaded.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">0</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Threaded.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/thread/Thread.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/thread/Thread.tsx"
                    data-expected-doc="src/app/components/thread/Thread.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/thread/Thread.tsx"
                    data-line-count="668">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Thread.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">668</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Thread.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/thread/ThreadTags.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/thread/ThreadTags.tsx"
                    data-expected-doc="src/app/components/thread/ThreadTags.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/thread/ThreadTags.tsx"
                    data-line-count="141">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ThreadTags.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">141</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ThreadTags.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/thread/ThreadBreadcrumb.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/thread/ThreadBreadcrumb.tsx"
                    data-expected-doc="src/app/components/thread/ThreadBreadcrumb.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/thread/ThreadBreadcrumb.tsx"
                    data-line-count="137">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ThreadBreadcrumb.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">137</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ThreadBreadcrumb.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/thread/ParentPostLink.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/thread/ParentPostLink.tsx"
                    data-expected-doc="src/app/components/thread/ParentPostLink.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/thread/ParentPostLink.tsx"
                    data-line-count="61">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ParentPostLink.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">61</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ParentPostLink.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/thread/ReplyForm.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/thread/ReplyForm.tsx"
                    data-expected-doc="src/app/components/thread/ReplyForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/thread/ReplyForm.tsx"
                    data-line-count="25">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ReplyForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">25</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ReplyForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/thread/CollapsibleReplyForm.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/thread/CollapsibleReplyForm.tsx"
                    data-expected-doc="src/app/components/thread/CollapsibleReplyForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/thread/CollapsibleReplyForm.tsx"
                    data-line-count="77">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CollapsibleReplyForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">77</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CollapsibleReplyForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/font-picker/FontPicker.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/font-picker/FontPicker.tsx"
                    data-expected-doc="src/app/components/font-picker/FontPicker.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/font-picker/FontPicker.tsx"
                    data-line-count="169">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/font-picker/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FontPicker.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">169</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FontPicker.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/dev-tools/HardResetPanel.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/dev-tools/HardResetPanel.tsx"
                    data-expected-doc="src/app/components/dev-tools/HardResetPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/dev-tools/HardResetPanel.tsx"
                    data-line-count="283">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/dev-tools/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">HardResetPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">283</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">HardResetPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/dev-tools/PWATestPanel.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/dev-tools/PWATestPanel.tsx"
                    data-expected-doc="src/app/components/dev-tools/PWATestPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/dev-tools/PWATestPanel.tsx"
                    data-line-count="116">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/dev-tools/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PWATestPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">116</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PWATestPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/dev-tools/DevSkeletonToggle.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/dev-tools/DevSkeletonToggle.tsx"
                    data-expected-doc="src/app/components/dev-tools/DevSkeletonToggle.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/dev-tools/DevSkeletonToggle.tsx"
                    data-line-count="274">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/dev-tools/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DevSkeletonToggle.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">274</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DevSkeletonToggle.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/auth-avatar/AuthAvatarServer.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/auth-avatar/AuthAvatarServer.tsx"
                    data-expected-doc="src/app/components/auth-avatar/AuthAvatarServer.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-avatar/AuthAvatarServer.tsx"
                    data-line-count="46">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-avatar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AuthAvatarServer.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">46</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AuthAvatarServer.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/auth-avatar/AuthAvatar.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/auth-avatar/AuthAvatar.tsx"
                    data-expected-doc="src/app/components/auth-avatar/AuthAvatar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-avatar/AuthAvatar.tsx"
                    data-line-count="83">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-avatar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AuthAvatar.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">83</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AuthAvatar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/auth-avatar/AuthAvatar.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/auth-avatar/AuthAvatar.test.tsx"
                    data-expected-doc="src/app/components/auth-avatar/AuthAvatar.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-avatar/AuthAvatar.test.tsx"
                    data-line-count="140">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-avatar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AuthAvatar.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">140</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AuthAvatar.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/header/Header.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/header/Header.tsx"
                    data-expected-doc="src/app/components/header/Header.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/header/Header.tsx"
                    data-line-count="10">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/header/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Header.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">10</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Header.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/header/Header.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/header/Header.test.tsx"
                    data-expected-doc="src/app/components/header/Header.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/header/Header.test.tsx"
                    data-line-count="31">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/header/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Header.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">31</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Header.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/about/About.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/about/About.test.tsx"
                    data-expected-doc="src/app/components/about/About.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/about/About.test.tsx"
                    data-line-count="25">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/about/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">About.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">25</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">About.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/about/About.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/about/About.tsx"
                    data-expected-doc="src/app/components/about/About.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/about/About.tsx"
                    data-line-count="59">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/about/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">About.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">59</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">About.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/skeleton/SmartSkeletonLoader.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/skeleton/SmartSkeletonLoader.tsx"
                    data-expected-doc="src/app/components/skeleton/SmartSkeletonLoader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/skeleton/SmartSkeletonLoader.tsx"
                    data-line-count="723">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/skeleton/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartSkeletonLoader.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">723</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartSkeletonLoader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/skeleton/useSmartPostsSkeleton.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/skeleton/useSmartPostsSkeleton.tsx"
                    data-expected-doc="src/app/components/skeleton/useSmartPostsSkeleton.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/skeleton/useSmartPostsSkeleton.tsx"
                    data-line-count="331">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/skeleton/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useSmartPostsSkeleton.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">331</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useSmartPostsSkeleton.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/skeleton/SimpleSkeletonWrapper.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/skeleton/SimpleSkeletonWrapper.tsx"
                    data-expected-doc="src/app/components/skeleton/SimpleSkeletonWrapper.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/skeleton/SimpleSkeletonWrapper.tsx"
                    data-line-count="90">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/skeleton/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SimpleSkeletonWrapper.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">90</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SimpleSkeletonWrapper.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/skeleton/IntelligentSkeletonWrapper.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/skeleton/IntelligentSkeletonWrapper.tsx"
                    data-expected-doc="src/app/components/skeleton/IntelligentSkeletonWrapper.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/skeleton/IntelligentSkeletonWrapper.tsx"
                    data-line-count="902">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/skeleton/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">IntelligentSkeletonWrapper.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">902</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">IntelligentSkeletonWrapper.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/skeleton/SkeletonLoader.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/skeleton/SkeletonLoader.tsx"
                    data-expected-doc="src/app/components/skeleton/SkeletonLoader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/skeleton/SkeletonLoader.tsx"
                    data-line-count="531">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/skeleton/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SkeletonLoader.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">531</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SkeletonLoader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/skeleton/SkeletonExamples.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/skeleton/SkeletonExamples.tsx"
                    data-expected-doc="src/app/components/skeleton/SkeletonExamples.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/skeleton/SkeletonExamples.tsx"
                    data-line-count="419">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/skeleton/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SkeletonExamples.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">419</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SkeletonExamples.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/banner-system/SimpleBannerSystem.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/banner-system/SimpleBannerSystem.tsx"
                    data-expected-doc="src/app/components/banner-system/SimpleBannerSystem.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/banner-system/SimpleBannerSystem.tsx"
                    data-line-count="748">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/banner-system/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SimpleBannerSystem.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">748</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SimpleBannerSystem.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/comment/CommentForm.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/comment/CommentForm.tsx"
                    data-expected-doc="src/app/components/comment/CommentForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/comment/CommentForm.tsx"
                    data-line-count="40">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/comment/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CommentForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">40</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CommentForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/comment/CommentItem.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/comment/CommentItem.tsx"
                    data-expected-doc="src/app/components/comment/CommentItem.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/comment/CommentItem.tsx"
                    data-line-count="21">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/comment/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CommentItem.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">21</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CommentItem.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/comment/CommentList.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/comment/CommentList.tsx"
                    data-expected-doc="src/app/components/comment/CommentList.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/comment/CommentList.tsx"
                    data-line-count="18">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/comment/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CommentList.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">18</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CommentList.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/galaxy-link/GalaxyLink.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/galaxy-link/GalaxyLink.tsx"
                    data-expected-doc="src/app/components/galaxy-link/GalaxyLink.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/galaxy-link/GalaxyLink.tsx"
                    data-line-count="16">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/galaxy-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GalaxyLink.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">16</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GalaxyLink.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/page-content/PageContent.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-content/PageContent.test.tsx"
                    data-expected-doc="src/app/components/page-content/PageContent.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-content/PageContent.test.tsx"
                    data-line-count="25">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-content/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageContent.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">25</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageContent.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/page-content/PageContent.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/page-content/PageContent.tsx"
                    data-expected-doc="src/app/components/page-content/PageContent.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/page-content/PageContent.tsx"
                    data-line-count="10">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/page-content/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PageContent.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">10</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PageContent.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/discord-embed/DiscordEmbed.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/discord-embed/DiscordEmbed.test.tsx"
                    data-expected-doc="src/app/components/discord-embed/DiscordEmbed.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/discord-embed/DiscordEmbed.test.tsx"
                    data-line-count="25">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/discord-embed/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DiscordEmbed.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">25</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DiscordEmbed.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/discord-embed/DiscordEmbed.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/discord-embed/DiscordEmbed.tsx"
                    data-expected-doc="src/app/components/discord-embed/DiscordEmbed.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/discord-embed/DiscordEmbed.tsx"
                    data-line-count="20">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/discord-embed/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DiscordEmbed.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">20</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DiscordEmbed.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/recent-tags/RecentTags.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/recent-tags/RecentTags.tsx"
                    data-expected-doc="src/app/components/recent-tags/RecentTags.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/recent-tags/RecentTags.tsx"
                    data-line-count="28">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/recent-tags/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RecentTags.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">28</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RecentTags.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/recent-tags/RecentTags.test.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/recent-tags/RecentTags.test.tsx"
                    data-expected-doc="src/app/components/recent-tags/RecentTags.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/recent-tags/RecentTags.test.tsx"
                    data-line-count="562">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/recent-tags/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RecentTags.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">562</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RecentTags.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/recent-tags/RecentTagsClient.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/recent-tags/RecentTagsClient.tsx"
                    data-expected-doc="src/app/components/recent-tags/RecentTagsClient.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/recent-tags/RecentTagsClient.tsx"
                    data-line-count="309">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/recent-tags/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RecentTagsClient.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">309</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RecentTagsClient.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/footer-nav/FooterNav.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/footer-nav/FooterNav.test.tsx"
                    data-expected-doc="src/app/components/footer-nav/FooterNav.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/footer-nav/FooterNav.test.tsx"
                    data-line-count="31">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/footer-nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FooterNav.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">31</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FooterNav.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/footer-nav/FooterNav.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/footer-nav/FooterNav.tsx"
                    data-expected-doc="src/app/components/footer-nav/FooterNav.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/footer-nav/FooterNav.tsx"
                    data-line-count="21">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/footer-nav/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FooterNav.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">21</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FooterNav.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/EmojiApprovalPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/EmojiApprovalPanel.tsx"
                    data-expected-doc="src/app/admin/components/EmojiApprovalPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/EmojiApprovalPanel.tsx"
                    data-line-count="422">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EmojiApprovalPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">422</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EmojiApprovalPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/SubscriptionManagementPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/SubscriptionManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/SubscriptionManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/SubscriptionManagementPanel.tsx"
                    data-line-count="894">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SubscriptionManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">894</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SubscriptionManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/AdminSubmissionItem.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AdminSubmissionItem.tsx"
                    data-expected-doc="src/app/admin/components/AdminSubmissionItem.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AdminSubmissionItem.tsx"
                    data-line-count="185">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AdminSubmissionItem.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">185</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AdminSubmissionItem.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/AlertStatusTooltip.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AlertStatusTooltip.tsx"
                    data-expected-doc="src/app/admin/components/AlertStatusTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AlertStatusTooltip.tsx"
                    data-line-count="232">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AlertStatusTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">232</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AlertStatusTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/components/AdminPostsList.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AdminPostsList.tsx"
                    data-expected-doc="src/app/admin/components/AdminPostsList.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AdminPostsList.tsx"
                    data-line-count="14">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AdminPostsList.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">14</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AdminPostsList.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/CreatePermissionModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/CreatePermissionModal.tsx"
                    data-expected-doc="src/app/admin/components/CreatePermissionModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/CreatePermissionModal.tsx"
                    data-line-count="541">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CreatePermissionModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">541</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CreatePermissionModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/PermissionManagementPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/PermissionManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/PermissionManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/PermissionManagementPanel.tsx"
                    data-line-count="859">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PermissionManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">859</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PermissionManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/components/UserManagementPanel.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel.tsx"
                    data-line-count="9">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">9</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/GlobalGuestQuotaPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/GlobalGuestQuotaPanel.tsx"
                    data-expected-doc="src/app/admin/components/GlobalGuestQuotaPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/GlobalGuestQuotaPanel.tsx"
                    data-line-count="867">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GlobalGuestQuotaPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">867</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GlobalGuestQuotaPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/CustomAlertsPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/CustomAlertsPanel.tsx"
                    data-expected-doc="src/app/admin/components/CustomAlertsPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/CustomAlertsPanel.tsx"
                    data-line-count="1053">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CustomAlertsPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">1,053</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CustomAlertsPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/AdminUserTooltip.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AdminUserTooltip.tsx"
                    data-expected-doc="src/app/admin/components/AdminUserTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AdminUserTooltip.tsx"
                    data-line-count="208">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AdminUserTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">208</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AdminUserTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/admin/components/UserManagementPanel/HeaderSection.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/HeaderSection.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/HeaderSection.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/HeaderSection.tsx"
                    data-line-count="107">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">HeaderSection.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">107</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">HeaderSection.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/UserManagementPanel/FilterPanel.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/FilterPanel.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/FilterPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/FilterPanel.tsx"
                    data-line-count="241">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FilterPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">241</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FilterPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/UserManagementPanel/utils.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/utils.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/utils.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/utils.tsx"
                    data-line-count="136">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">utils.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">136</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">utils.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/UserManagementPanel/UserManagementPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/UserManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/UserManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/UserManagementPanel.tsx"
                    data-line-count="480">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">480</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/UserManagementPanel/components.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/components.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/components.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/components.tsx"
                    data-line-count="372">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">components.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">372</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">components.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/admin/components/UserManagementPanel/PaginationSection.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/PaginationSection.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/PaginationSection.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/PaginationSection.tsx"
                    data-line-count="116">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PaginationSection.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">116</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PaginationSection.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/UserManagementPanel/QuotaManagement.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/QuotaManagement.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/QuotaManagement.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/QuotaManagement.tsx"
                    data-line-count="1067">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">QuotaManagement.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">1,067</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">QuotaManagement.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/UserManagementPanel/UserTable.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/UserTable.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/UserTable.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/UserTable.tsx"
                    data-line-count="164">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserTable.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">164</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserTable.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/TimeoutModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/TimeoutModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/TimeoutModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/TimeoutModal.tsx"
                    data-line-count="365">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TimeoutModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">365</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TimeoutModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/AssignSubscriptionModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/AssignSubscriptionModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/AssignSubscriptionModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/AssignSubscriptionModal.tsx"
                    data-line-count="379">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AssignSubscriptionModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">379</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AssignSubscriptionModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/UserDetailsModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/UserDetailsModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/UserDetailsModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/UserDetailsModal.tsx"
                    data-line-count="303">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserDetailsModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">303</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserDetailsModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/modals/AssignRoleModal.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/AssignRoleModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/AssignRoleModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/AssignRoleModal.tsx"
                    data-line-count="264">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AssignRoleModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">264</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AssignRoleModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/modals/EditPlanModal.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/EditPlanModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/EditPlanModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/EditPlanModal.tsx"
                    data-line-count="255">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EditPlanModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">255</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EditPlanModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/ExportModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/ExportModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/ExportModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/ExportModal.tsx"
                    data-line-count="538">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ExportModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">538</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ExportModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/modals/EditSubscriptionModal.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/EditSubscriptionModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/EditSubscriptionModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/EditSubscriptionModal.tsx"
                    data-line-count="230">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EditSubscriptionModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">230</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EditSubscriptionModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/card-generator/components/MysticalLoader.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/MysticalLoader.tsx"
                    data-expected-doc="src/app/card-generator/components/MysticalLoader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/MysticalLoader.tsx"
                    data-line-count="48">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">MysticalLoader.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">48</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">MysticalLoader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/components/WelcomeInterface.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/WelcomeInterface.tsx"
                    data-expected-doc="src/app/card-generator/components/WelcomeInterface.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/WelcomeInterface.tsx"
                    data-line-count="117">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">WelcomeInterface.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">117</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">WelcomeInterface.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/components/QuotaDisplay.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/QuotaDisplay.tsx"
                    data-expected-doc="src/app/card-generator/components/QuotaDisplay.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/QuotaDisplay.tsx"
                    data-line-count="108">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">QuotaDisplay.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">108</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">QuotaDisplay.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/card-generator/components/AdvancedControls.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/AdvancedControls.tsx"
                    data-expected-doc="src/app/card-generator/components/AdvancedControls.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/AdvancedControls.tsx"
                    data-line-count="295">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AdvancedControls.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">295</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AdvancedControls.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/components/AspectRatioSelector.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/AspectRatioSelector.tsx"
                    data-expected-doc="src/app/card-generator/components/AspectRatioSelector.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/AspectRatioSelector.tsx"
                    data-line-count="57">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AspectRatioSelector.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">57</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AspectRatioSelector.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/card-generator/components/GenerationForm.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/GenerationForm.tsx"
                    data-expected-doc="src/app/card-generator/components/GenerationForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/GenerationForm.tsx"
                    data-line-count="468">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GenerationForm.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">468</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GenerationForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/card-generator/components/GenerationDisplay.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/GenerationDisplay.tsx"
                    data-expected-doc="src/app/card-generator/components/GenerationDisplay.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/GenerationDisplay.tsx"
                    data-line-count="48">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GenerationDisplay.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">48</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GenerationDisplay.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/components/RegenerationDialog.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/components/RegenerationDialog.tsx"
                    data-expected-doc="src/app/card-generator/components/RegenerationDialog.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/components/RegenerationDialog.tsx"
                    data-line-count="65">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RegenerationDialog.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">65</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RegenerationDialog.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.tsx"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.tsx"
                    data-line-count="399">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RichInputAdapter.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">399</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RichInputAdapter.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.tsx"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.tsx"
                    data-line-count="419">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FloatingToolbar.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">419</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FloatingToolbar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submissions-list/components/SearchStatus.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SearchStatus.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SearchStatus.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SearchStatus.tsx"
                    data-line-count="13">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SearchStatus.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">13</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SearchStatus.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/components/SmartFilterInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SmartFilterInput.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SmartFilterInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SmartFilterInput.tsx"
                    data-line-count="328">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartFilterInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">328</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartFilterInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/components/TextSearchInput.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/TextSearchInput.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/TextSearchInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/TextSearchInput.tsx"
                    data-line-count="135">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TextSearchInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">135</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TextSearchInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/components/SearchInputContainer.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SearchInputContainer.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SearchInputContainer.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SearchInputContainer.tsx"
                    data-line-count="271">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SearchInputContainer.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">271</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SearchInputContainer.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/PostsManagerFilters.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/PostsManagerFilters.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/PostsManagerFilters.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/PostsManagerFilters.tsx"
                    data-line-count="86">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostsManagerFilters.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">86</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostsManagerFilters.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/PostsManagerControls.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/PostsManagerControls.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/PostsManagerControls.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/PostsManagerControls.tsx"
                    data-line-count="148">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostsManagerControls.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">148</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostsManagerControls.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/PostsManagerPagination.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/PostsManagerPagination.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/PostsManagerPagination.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/PostsManagerPagination.tsx"
                    data-line-count="73">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PostsManagerPagination.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">73</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PostsManagerPagination.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/components/SmartTextSearchInput.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/SmartTextSearchInput.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/SmartTextSearchInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/SmartTextSearchInput.tsx"
                    data-line-count="545">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SmartTextSearchInput.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">545</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SmartTextSearchInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submissions-list/components/TextSearchInput.test.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/components/submissions-list/components/TextSearchInput.test.tsx"
                    data-expected-doc="src/app/components/submissions-list/components/TextSearchInput.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/TextSearchInput.test.tsx"
                    data-line-count="12">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TextSearchInput.test.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">12</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TextSearchInput.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/page.tsx"
                    data-expected-doc="src/app/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/page.tsx"
                    data-line-count="50">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">50</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/test-banners/page.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/test-banners/page.tsx"
                    data-expected-doc="src/app/test-banners/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/test-banners/page.tsx"
                    data-line-count="268">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/test-banners/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">268</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/page.tsx"
                    data-expected-doc="src/app/admin/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/page.tsx"
                    data-line-count="32">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">32</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/card-generator/page.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/page.tsx"
                    data-expected-doc="src/app/card-generator/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/page.tsx"
                    data-line-count="488">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">488</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/coins/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/coins/page.tsx"
                    data-expected-doc="src/app/coins/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/coins/page.tsx"
                    data-line-count="15">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/coins/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">15</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/profile/[username]/page.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/profile/[username]/page.tsx"
                    data-expected-doc="src/app/profile/[username]/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/profile/[username]/page.tsx"
                    data-line-count="424">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/profile/[username]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">424</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/test-redirect/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/test-redirect/page.tsx"
                    data-expected-doc="src/app/test-redirect/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/test-redirect/page.tsx"
                    data-line-count="90">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/test-redirect/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">90</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/subscription/page.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/subscription/page.tsx"
                    data-expected-doc="src/app/subscription/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/subscription/page.tsx"
                    data-line-count="196">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/subscription/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">196</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/posts/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/posts/page.tsx"
                    data-expected-doc="src/app/posts/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/posts/page.tsx"
                    data-line-count="73">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/posts/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">73</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/t/[submissionId]/page.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/t/[submissionId]/page.tsx"
                    data-expected-doc="src/app/t/[submissionId]/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/t/[submissionId]/page.tsx"
                    data-line-count="296">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/t/[submissionId]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">296</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/game/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/game/page.tsx"
                    data-expected-doc="src/app/game/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/game/page.tsx"
                    data-line-count="17">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/game/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">17</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/auth/callback/page.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/auth/callback/page.tsx"
                    data-expected-doc="src/app/auth/callback/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/auth/callback/page.tsx"
                    data-line-count="207">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/auth/callback/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">207</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/auth/signin/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/auth/signin/page.tsx"
                    data-expected-doc="src/app/auth/signin/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/auth/signin/page.tsx"
                    data-line-count="59">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/auth/signin/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">59</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/auth/unlink-account/page.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/auth/unlink-account/page.tsx"
                    data-expected-doc="src/app/auth/unlink-account/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/auth/unlink-account/page.tsx"
                    data-line-count="186">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/auth/unlink-account/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">186</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/my-posts/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/my-posts/page.tsx"
                    data-expected-doc="src/app/my-posts/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/my-posts/page.tsx"
                    data-line-count="81">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/my-posts/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">81</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/test-thread/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/test-thread/page.tsx"
                    data-expected-doc="src/app/test-thread/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/test-thread/page.tsx"
                    data-line-count="29">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/test-thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">29</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/test-dismissal/page.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/test-dismissal/page.tsx"
                    data-expected-doc="src/app/test-dismissal/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/test-dismissal/page.tsx"
                    data-line-count="174">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/test-dismissal/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">174</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/settings/page.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/settings/page.tsx"
                    data-expected-doc="src/app/settings/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/settings/page.tsx"
                    data-line-count="586">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/settings/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">586</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/layout.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/layout.tsx"
                    data-expected-doc="src/app/layout.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/layout.tsx"
                    data-line-count="322">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">layout.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">322</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">layout.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/layout.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/layout.tsx"
                    data-expected-doc="src/app/admin/layout.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/layout.tsx"
                    data-line-count="47">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">layout.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">47</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">layout.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/card-generator/layout.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/card-generator/layout.tsx"
                    data-expected-doc="src/app/card-generator/layout.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/layout.tsx"
                    data-line-count="19">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">layout.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">19</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">layout.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/layout.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/layout.tsx"
                    data-expected-doc="src/app/admin/layout.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/layout.tsx"
                    data-line-count="47">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">layout.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">47</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">layout.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/page.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/page.tsx"
                    data-expected-doc="src/app/admin/page.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/page.tsx"
                    data-line-count="32">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">32</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/EmojiApprovalPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/EmojiApprovalPanel.tsx"
                    data-expected-doc="src/app/admin/components/EmojiApprovalPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/EmojiApprovalPanel.tsx"
                    data-line-count="422">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EmojiApprovalPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">422</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EmojiApprovalPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/SubscriptionManagementPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/SubscriptionManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/SubscriptionManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/SubscriptionManagementPanel.tsx"
                    data-line-count="894">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SubscriptionManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">894</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SubscriptionManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/AdminSubmissionItem.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AdminSubmissionItem.tsx"
                    data-expected-doc="src/app/admin/components/AdminSubmissionItem.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AdminSubmissionItem.tsx"
                    data-line-count="185">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AdminSubmissionItem.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">185</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AdminSubmissionItem.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/AlertStatusTooltip.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AlertStatusTooltip.tsx"
                    data-expected-doc="src/app/admin/components/AlertStatusTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AlertStatusTooltip.tsx"
                    data-line-count="232">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AlertStatusTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">232</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AlertStatusTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/components/AdminPostsList.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AdminPostsList.tsx"
                    data-expected-doc="src/app/admin/components/AdminPostsList.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AdminPostsList.tsx"
                    data-line-count="14">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AdminPostsList.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">14</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AdminPostsList.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/CreatePermissionModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/CreatePermissionModal.tsx"
                    data-expected-doc="src/app/admin/components/CreatePermissionModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/CreatePermissionModal.tsx"
                    data-line-count="541">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CreatePermissionModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">541</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CreatePermissionModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/PermissionManagementPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/PermissionManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/PermissionManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/PermissionManagementPanel.tsx"
                    data-line-count="859">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PermissionManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">859</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PermissionManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/components/UserManagementPanel.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel.tsx"
                    data-line-count="9">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">9</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/GlobalGuestQuotaPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/GlobalGuestQuotaPanel.tsx"
                    data-expected-doc="src/app/admin/components/GlobalGuestQuotaPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/GlobalGuestQuotaPanel.tsx"
                    data-line-count="867">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">GlobalGuestQuotaPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">867</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">GlobalGuestQuotaPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/CustomAlertsPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/CustomAlertsPanel.tsx"
                    data-expected-doc="src/app/admin/components/CustomAlertsPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/CustomAlertsPanel.tsx"
                    data-line-count="1053">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">CustomAlertsPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">1,053</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">CustomAlertsPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/AdminUserTooltip.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/AdminUserTooltip.tsx"
                    data-expected-doc="src/app/admin/components/AdminUserTooltip.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/AdminUserTooltip.tsx"
                    data-line-count="208">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AdminUserTooltip.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">208</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AdminUserTooltip.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/admin/components/UserManagementPanel/HeaderSection.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/HeaderSection.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/HeaderSection.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/HeaderSection.tsx"
                    data-line-count="107">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">HeaderSection.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">107</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">HeaderSection.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/UserManagementPanel/FilterPanel.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/FilterPanel.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/FilterPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/FilterPanel.tsx"
                    data-line-count="241">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">FilterPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">241</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">FilterPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/UserManagementPanel/utils.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/utils.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/utils.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/utils.tsx"
                    data-line-count="136">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">utils.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">136</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">utils.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/UserManagementPanel/UserManagementPanel.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/UserManagementPanel.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/UserManagementPanel.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/UserManagementPanel.tsx"
                    data-line-count="480">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserManagementPanel.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">480</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserManagementPanel.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/UserManagementPanel/components.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/components.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/components.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/components.tsx"
                    data-line-count="372">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">components.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">372</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">components.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/admin/components/UserManagementPanel/PaginationSection.tsx" 
                    data-status="missing" data-effort="low"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/PaginationSection.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/PaginationSection.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/PaginationSection.tsx"
                    data-line-count="116">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">PaginationSection.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">116</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">PaginationSection.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/UserManagementPanel/QuotaManagement.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/QuotaManagement.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/QuotaManagement.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/QuotaManagement.tsx"
                    data-line-count="1067">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">QuotaManagement.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">1,067</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">QuotaManagement.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/UserManagementPanel/UserTable.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/UserManagementPanel/UserTable.tsx"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/UserTable.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/UserTable.tsx"
                    data-line-count="164">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserTable.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">164</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserTable.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/TimeoutModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/TimeoutModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/TimeoutModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/TimeoutModal.tsx"
                    data-line-count="365">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">TimeoutModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">365</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">TimeoutModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/AssignSubscriptionModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/AssignSubscriptionModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/AssignSubscriptionModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/AssignSubscriptionModal.tsx"
                    data-line-count="379">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AssignSubscriptionModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">379</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AssignSubscriptionModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/UserDetailsModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/UserDetailsModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/UserDetailsModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/UserDetailsModal.tsx"
                    data-line-count="303">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">UserDetailsModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">303</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">UserDetailsModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/modals/AssignRoleModal.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/AssignRoleModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/AssignRoleModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/AssignRoleModal.tsx"
                    data-line-count="264">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">AssignRoleModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">264</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">AssignRoleModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/modals/EditPlanModal.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/EditPlanModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/EditPlanModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/EditPlanModal.tsx"
                    data-line-count="255">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EditPlanModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">255</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EditPlanModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/modals/ExportModal.tsx" 
                    data-status="missing" data-effort="high"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/ExportModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/ExportModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/ExportModal.tsx"
                    data-line-count="538">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ExportModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">538</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ExportModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/modals/EditSubscriptionModal.tsx" 
                    data-status="missing" data-effort="medium"
                    data-file-type="tsx"
                    data-file-name="src/app/admin/components/modals/EditSubscriptionModal.tsx"
                    data-expected-doc="src/app/admin/components/modals/EditSubscriptionModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/modals/EditSubscriptionModal.tsx"
                    data-line-count="230">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/modals/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EditSubscriptionModal.tsx</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">230</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EditSubscriptionModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/utils/fileUtils.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/utils/fileUtils.ts"
                    data-expected-doc="src/app/card-generator/utils/fileUtils.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/utils/fileUtils.ts"
                    data-line-count="64">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">fileUtils.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">64</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">fileUtils.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submission-forms/shared-submission-form/utils/imageUpload.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/utils/imageUpload.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/utils/imageUpload.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/utils/imageUpload.ts"
                    data-line-count="28">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">imageUpload.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">28</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">imageUpload.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/filter-bar/utils/get-tags.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/filter-bar/utils/get-tags.ts"
                    data-expected-doc="src/app/components/filter-bar/utils/get-tags.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/utils/get-tags.ts"
                    data-line-count="14">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">get-tags.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">14</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">get-tags.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useTooltipState.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipState.ts"
                    data-expected-doc="src/app/hooks/useTooltipState.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipState.ts"
                    data-line-count="43">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipState.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">43</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipState.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useLinkPreview.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useLinkPreview.ts"
                    data-expected-doc="src/app/hooks/useLinkPreview.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useLinkPreview.ts"
                    data-line-count="60">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useLinkPreview.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">60</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useLinkPreview.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useTooltipPosition.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipPosition.ts"
                    data-expected-doc="src/app/hooks/useTooltipPosition.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipPosition.ts"
                    data-line-count="58">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipPosition.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">58</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipPosition.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useTooltipHandlers.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipHandlers.ts"
                    data-expected-doc="src/app/hooks/useTooltipHandlers.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipHandlers.ts"
                    data-line-count="182">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipHandlers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">182</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipHandlers.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/usePaginationPreRequest.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/usePaginationPreRequest.ts"
                    data-expected-doc="src/app/hooks/usePaginationPreRequest.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/usePaginationPreRequest.ts"
                    data-line-count="150">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePaginationPreRequest.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">150</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePaginationPreRequest.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/usePostModal.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/usePostModal.ts"
                    data-expected-doc="src/app/hooks/usePostModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/usePostModal.ts"
                    data-line-count="88">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePostModal.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">88</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePostModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/hooks/useEmojis.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useEmojis.ts"
                    data-expected-doc="src/app/hooks/useEmojis.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useEmojis.ts"
                    data-line-count="471">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useEmojis.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">471</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useEmojis.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/hooks/useTooltipCache.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipCache.ts"
                    data-expected-doc="src/app/hooks/useTooltipCache.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipCache.ts"
                    data-line-count="266">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipCache.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">266</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipCache.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/card-generator/hooks/useQuotaTracking.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useQuotaTracking.ts"
                    data-expected-doc="src/app/card-generator/hooks/useQuotaTracking.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useQuotaTracking.ts"
                    data-line-count="111">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useQuotaTracking.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">111</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useQuotaTracking.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/card-generator/hooks/useImageGeneration.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useImageGeneration.ts"
                    data-expected-doc="src/app/card-generator/hooks/useImageGeneration.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useImageGeneration.ts"
                    data-line-count="293">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useImageGeneration.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">293</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useImageGeneration.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useAspectRatioSync.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useAspectRatioSync.ts"
                    data-expected-doc="src/app/card-generator/hooks/useAspectRatioSync.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useAspectRatioSync.ts"
                    data-line-count="46">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useAspectRatioSync.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">46</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useAspectRatioSync.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useWelcomeFlow.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useWelcomeFlow.ts"
                    data-expected-doc="src/app/card-generator/hooks/useWelcomeFlow.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useWelcomeFlow.ts"
                    data-line-count="52">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useWelcomeFlow.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">52</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useWelcomeFlow.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useGenerationLoader.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useGenerationLoader.ts"
                    data-expected-doc="src/app/card-generator/hooks/useGenerationLoader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useGenerationLoader.ts"
                    data-line-count="95">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useGenerationLoader.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">95</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useGenerationLoader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useFormState.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useFormState.ts"
                    data-expected-doc="src/app/card-generator/hooks/useFormState.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useFormState.ts"
                    data-line-count="33">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFormState.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">33</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFormState.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.ts"
                    data-line-count="99">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTextInsertion.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">99</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTextInsertion.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.ts"
                    data-line-count="256">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useSearchOverlay.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">256</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useSearchOverlay.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.ts"
                    data-line-count="75">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFocusManagement.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">75</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFocusManagement.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.ts"
                    data-line-count="163">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFloatingToolbar.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">163</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFloatingToolbar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.ts"
                    data-line-count="32">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useValueExtraction.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">32</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useValueExtraction.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.ts"
                    data-line-count="326">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useSubmissionForm.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">326</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useSubmissionForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.ts"
                    data-line-count="128">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useUrlAutoConversion.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">128</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useUrlAutoConversion.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/hooks/usePostsManagerState.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/hooks/usePostsManagerState.ts"
                    data-expected-doc="src/app/components/submissions-list/hooks/usePostsManagerState.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/hooks/usePostsManagerState.ts"
                    data-line-count="78">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePostsManagerState.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">78</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePostsManagerState.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/hooks/usePostsManagerHandlers.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/hooks/usePostsManagerHandlers.ts"
                    data-expected-doc="src/app/components/submissions-list/hooks/usePostsManagerHandlers.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/hooks/usePostsManagerHandlers.ts"
                    data-line-count="207">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePostsManagerHandlers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">207</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePostsManagerHandlers.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/hooks/useScrollRestoration.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/hooks/useScrollRestoration.ts"
                    data-expected-doc="src/app/components/submissions-list/hooks/useScrollRestoration.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/hooks/useScrollRestoration.ts"
                    data-line-count="497">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useScrollRestoration.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">497</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useScrollRestoration.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/hooks/useTextSearchInput.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/components/hooks/useTextSearchInput.ts"
                    data-expected-doc="src/app/components/submissions-list/components/hooks/useTextSearchInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/hooks/useTextSearchInput.ts"
                    data-line-count="142">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTextSearchInput.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">142</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTextSearchInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/hooks/useFilterStatus.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/components/hooks/useFilterStatus.ts"
                    data-expected-doc="src/app/components/submissions-list/components/hooks/useFilterStatus.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/hooks/useFilterStatus.ts"
                    data-line-count="59">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFilterStatus.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">59</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFilterStatus.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/MachineFingerprint.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/MachineFingerprint.ts"
                    data-expected-doc="src/app/api/og-image/services/MachineFingerprint.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/MachineFingerprint.ts"
                    data-line-count="285">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">MachineFingerprint.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">285</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">MachineFingerprint.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/DatabaseService.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/DatabaseService.ts"
                    data-expected-doc="src/app/api/og-image/services/DatabaseService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/DatabaseService.ts"
                    data-line-count="398">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DatabaseService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">398</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DatabaseService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/QuoteService.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/QuoteService.ts"
                    data-expected-doc="src/app/api/og-image/services/QuoteService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/QuoteService.ts"
                    data-line-count="115">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">QuoteService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">115</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">QuoteService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/SVGGenerator.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/SVGGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/SVGGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/SVGGenerator.ts"
                    data-line-count="302">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SVGGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">302</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SVGGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/OGImageService.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/OGImageService.ts"
                    data-expected-doc="src/app/api/og-image/services/OGImageService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/OGImageService.ts"
                    data-line-count="545">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">OGImageService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">545</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">OGImageService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/patterns/ShapePatternGenerator.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/ShapePatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/ShapePatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/ShapePatternGenerator.ts"
                    data-line-count="279">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ShapePatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">279</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ShapePatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/patterns/BasePatternGenerator.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/BasePatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/BasePatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/BasePatternGenerator.ts"
                    data-line-count="201">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">BasePatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">201</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">BasePatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/patterns/OrganicPatternGenerator.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/OrganicPatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/OrganicPatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/OrganicPatternGenerator.ts"
                    data-line-count="200">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">OrganicPatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">200</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">OrganicPatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/patterns/LinePatternGenerator.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/LinePatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/LinePatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/LinePatternGenerator.ts"
                    data-line-count="160">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">LinePatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">160</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">LinePatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/admin/components/UserManagementPanel/index.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/admin/components/UserManagementPanel/index.ts"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/index.ts"
                    data-line-count="31">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">index.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">31</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/admin/components/UserManagementPanel/hooks.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/admin/components/UserManagementPanel/hooks.ts"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/hooks.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/hooks.ts"
                    data-line-count="379">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">hooks.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">379</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">hooks.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/admin/components/UserManagementPanel/constants.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/admin/components/UserManagementPanel/constants.ts"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/constants.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/constants.ts"
                    data-line-count="263">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">constants.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">263</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">constants.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/admin/components/UserManagementPanel/types.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/admin/components/UserManagementPanel/types.ts"
                    data-expected-doc="src/app/admin/components/UserManagementPanel/types.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/admin/components/UserManagementPanel/types.ts"
                    data-line-count="140">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/admin/components/UserManagementPanel/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">types.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">140</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">types.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/utils/fileUtils.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/utils/fileUtils.ts"
                    data-expected-doc="src/app/card-generator/utils/fileUtils.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/utils/fileUtils.ts"
                    data-line-count="64">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">fileUtils.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">64</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">fileUtils.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/card-generator/hooks/useQuotaTracking.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useQuotaTracking.ts"
                    data-expected-doc="src/app/card-generator/hooks/useQuotaTracking.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useQuotaTracking.ts"
                    data-line-count="111">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useQuotaTracking.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">111</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useQuotaTracking.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/card-generator/hooks/useImageGeneration.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useImageGeneration.ts"
                    data-expected-doc="src/app/card-generator/hooks/useImageGeneration.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useImageGeneration.ts"
                    data-line-count="293">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useImageGeneration.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">293</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useImageGeneration.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useAspectRatioSync.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useAspectRatioSync.ts"
                    data-expected-doc="src/app/card-generator/hooks/useAspectRatioSync.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useAspectRatioSync.ts"
                    data-line-count="46">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useAspectRatioSync.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">46</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useAspectRatioSync.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useWelcomeFlow.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useWelcomeFlow.ts"
                    data-expected-doc="src/app/card-generator/hooks/useWelcomeFlow.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useWelcomeFlow.ts"
                    data-line-count="52">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useWelcomeFlow.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">52</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useWelcomeFlow.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useGenerationLoader.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useGenerationLoader.ts"
                    data-expected-doc="src/app/card-generator/hooks/useGenerationLoader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useGenerationLoader.ts"
                    data-line-count="95">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useGenerationLoader.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">95</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useGenerationLoader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/card-generator/hooks/useFormState.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/card-generator/hooks/useFormState.ts"
                    data-expected-doc="src/app/card-generator/hooks/useFormState.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/card-generator/hooks/useFormState.ts"
                    data-line-count="33">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/card-generator/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFormState.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">33</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFormState.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/gitlab-link/gitlab-link-test-ids.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/gitlab-link/gitlab-link-test-ids.ts"
                    data-expected-doc="src/app/components/gitlab-link/gitlab-link-test-ids.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/gitlab-link/gitlab-link-test-ids.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/gitlab-link/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">gitlab-link-test-ids.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">gitlab-link-test-ids.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/message-ticker/actions.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/message-ticker/actions.ts"
                    data-expected-doc="src/app/components/message-ticker/actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/message-ticker/actions.ts"
                    data-line-count="22">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/message-ticker/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">22</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/auth-buttons/actions.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/auth-buttons/actions.ts"
                    data-expected-doc="src/app/components/auth-buttons/actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-buttons/actions.ts"
                    data-line-count="29">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-buttons/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">29</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/auth-buttons/types.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/auth-buttons/types.ts"
                    data-expected-doc="src/app/components/auth-buttons/types.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-buttons/types.ts"
                    data-line-count="1">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-buttons/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">types.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">1</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">types.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/schema.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/schema.ts"
                    data-expected-doc="src/app/components/submission-forms/schema.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/schema.ts"
                    data-line-count="131">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">schema.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">131</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">schema.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/actions.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/actions.ts"
                    data-expected-doc="src/app/components/submission-forms/actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/actions.ts"
                    data-line-count="497">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">497</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/actions.test.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/actions.test.ts"
                    data-expected-doc="src/app/components/submission-forms/actions.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/actions.test.ts"
                    data-line-count="385">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.test.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">385</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submission-forms/shared-submission-form/utils/imageUpload.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/utils/imageUpload.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/utils/imageUpload.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/utils/imageUpload.ts"
                    data-line-count="28">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">imageUpload.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">28</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">imageUpload.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.ts"
                    data-line-count="99">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTextInsertion.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">99</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTextInsertion.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.ts"
                    data-line-count="256">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useSearchOverlay.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">256</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useSearchOverlay.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.ts"
                    data-line-count="75">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFocusManagement.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">75</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFocusManagement.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.ts"
                    data-line-count="163">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFloatingToolbar.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">163</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFloatingToolbar.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.ts"
                    data-line-count="32">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useValueExtraction.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">32</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useValueExtraction.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.ts"
                    data-line-count="326">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useSubmissionForm.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">326</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useSubmissionForm.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.ts"
                    data-expected-doc="src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.ts"
                    data-line-count="128">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submission-forms/shared-submission-form/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useUrlAutoConversion.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">128</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useUrlAutoConversion.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/filter-bar/utils/get-tags.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/filter-bar/utils/get-tags.ts"
                    data-expected-doc="src/app/components/filter-bar/utils/get-tags.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/filter-bar/utils/get-tags.ts"
                    data-line-count="14">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/filter-bar/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">get-tags.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">14</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">get-tags.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/actions.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/actions.ts"
                    data-expected-doc="src/app/components/submissions-list/actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/actions.ts"
                    data-line-count="1109">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">1,109</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/actions.test.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/actions.test.ts"
                    data-expected-doc="src/app/components/submissions-list/actions.test.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/actions.test.ts"
                    data-line-count="757">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.test.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">757</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.test.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/hooks/useTextSearchInput.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/components/hooks/useTextSearchInput.ts"
                    data-expected-doc="src/app/components/submissions-list/components/hooks/useTextSearchInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/hooks/useTextSearchInput.ts"
                    data-line-count="142">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTextSearchInput.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">142</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTextSearchInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/components/hooks/useFilterStatus.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/components/hooks/useFilterStatus.ts"
                    data-expected-doc="src/app/components/submissions-list/components/hooks/useFilterStatus.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/components/hooks/useFilterStatus.ts"
                    data-line-count="59">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/components/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useFilterStatus.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">59</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useFilterStatus.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/submissions-list/hooks/usePostsManagerState.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/hooks/usePostsManagerState.ts"
                    data-expected-doc="src/app/components/submissions-list/hooks/usePostsManagerState.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/hooks/usePostsManagerState.ts"
                    data-line-count="78">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePostsManagerState.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">78</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePostsManagerState.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/components/submissions-list/hooks/usePostsManagerHandlers.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/hooks/usePostsManagerHandlers.ts"
                    data-expected-doc="src/app/components/submissions-list/hooks/usePostsManagerHandlers.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/hooks/usePostsManagerHandlers.ts"
                    data-line-count="207">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePostsManagerHandlers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">207</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePostsManagerHandlers.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/components/submissions-list/hooks/useScrollRestoration.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/components/submissions-list/hooks/useScrollRestoration.ts"
                    data-expected-doc="src/app/components/submissions-list/hooks/useScrollRestoration.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/submissions-list/hooks/useScrollRestoration.ts"
                    data-line-count="497">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/submissions-list/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useScrollRestoration.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">497</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useScrollRestoration.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/twitch-chat/index.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/twitch-chat/index.ts"
                    data-expected-doc="src/app/components/twitch-chat/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/twitch-chat/index.ts"
                    data-line-count="2">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/twitch-chat/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">index.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">2</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/tooltip/index.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/tooltip/index.ts"
                    data-expected-doc="src/app/components/tooltip/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/index.ts"
                    data-line-count="5">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">index.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">5</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/tooltip/link-tooltip-modal-atom.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/tooltip/link-tooltip-modal-atom.ts"
                    data-expected-doc="src/app/components/tooltip/link-tooltip-modal-atom.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/tooltip/link-tooltip-modal-atom.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/tooltip/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">link-tooltip-modal-atom.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">link-tooltip-modal-atom.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/thread/actions.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/thread/actions.ts"
                    data-expected-doc="src/app/components/thread/actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/thread/actions.ts"
                    data-line-count="118">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/thread/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">118</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/auth-avatar/index.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/auth-avatar/index.ts"
                    data-expected-doc="src/app/components/auth-avatar/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/auth-avatar/index.ts"
                    data-line-count="2">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/auth-avatar/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">index.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">2</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/components/recent-tags/schema.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/recent-tags/schema.ts"
                    data-expected-doc="src/app/components/recent-tags/schema.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/recent-tags/schema.ts"
                    data-line-count="5">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/recent-tags/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">schema.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">5</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">schema.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/components/recent-tags/actions.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/components/recent-tags/actions.ts"
                    data-expected-doc="src/app/components/recent-tags/actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/components/recent-tags/actions.ts"
                    data-line-count="108">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/components/recent-tags/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">108</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/app/lib/test-selectors/components/avatar.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/lib/test-selectors/components/avatar.selectors.ts"
                    data-expected-doc="src/app/lib/test-selectors/components/avatar.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/lib/test-selectors/components/avatar.selectors.ts"
                    data-line-count="5">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">avatar.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">5</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">avatar.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useTooltipState.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipState.ts"
                    data-expected-doc="src/app/hooks/useTooltipState.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipState.ts"
                    data-line-count="43">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipState.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">43</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipState.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useLinkPreview.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useLinkPreview.ts"
                    data-expected-doc="src/app/hooks/useLinkPreview.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useLinkPreview.ts"
                    data-line-count="60">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useLinkPreview.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">60</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useLinkPreview.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useTooltipPosition.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipPosition.ts"
                    data-expected-doc="src/app/hooks/useTooltipPosition.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipPosition.ts"
                    data-line-count="58">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipPosition.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">58</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipPosition.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/useTooltipHandlers.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipHandlers.ts"
                    data-expected-doc="src/app/hooks/useTooltipHandlers.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipHandlers.ts"
                    data-line-count="182">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipHandlers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">182</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipHandlers.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/usePaginationPreRequest.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/usePaginationPreRequest.ts"
                    data-expected-doc="src/app/hooks/usePaginationPreRequest.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/usePaginationPreRequest.ts"
                    data-line-count="150">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePaginationPreRequest.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">150</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePaginationPreRequest.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/hooks/usePostModal.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/usePostModal.ts"
                    data-expected-doc="src/app/hooks/usePostModal.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/usePostModal.ts"
                    data-line-count="88">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">usePostModal.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">88</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">usePostModal.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/hooks/useEmojis.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useEmojis.ts"
                    data-expected-doc="src/app/hooks/useEmojis.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useEmojis.ts"
                    data-line-count="471">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useEmojis.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">471</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useEmojis.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/hooks/useTooltipCache.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/hooks/useTooltipCache.ts"
                    data-expected-doc="src/app/hooks/useTooltipCache.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/hooks/useTooltipCache.ts"
                    data-line-count="266">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useTooltipCache.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">266</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useTooltipCache.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/quotas/global/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/quotas/global/route.ts"
                    data-expected-doc="src/app/api/admin/quotas/global/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/quotas/global/route.ts"
                    data-line-count="362">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/quotas/global/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">362</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/quotas/global/[id]/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/quotas/global/[id]/route.ts"
                    data-expected-doc="src/app/api/admin/quotas/global/[id]/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/quotas/global/[id]/route.ts"
                    data-line-count="389">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/quotas/global/[id]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">389</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/admin/emojis/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/emojis/route.ts"
                    data-expected-doc="src/app/api/admin/emojis/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/emojis/route.ts"
                    data-line-count="277">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/emojis/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">277</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/permissions/[id]/route.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/permissions/[id]/route.ts"
                    data-expected-doc="src/app/api/admin/permissions/[id]/route.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/permissions/[id]/route.ts"
                    data-line-count="378">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/permissions/[id]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">378</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">route.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/permissions/roles/route.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/permissions/roles/route.ts"
                    data-expected-doc="src/app/api/admin/permissions/roles/route.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/permissions/roles/route.ts"
                    data-line-count="345">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/permissions/roles/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">345</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">route.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/route.ts"
                    data-expected-doc="src/app/api/admin/users/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/route.ts"
                    data-line-count="299">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">299</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/quotas/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/quotas/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/quotas/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/quotas/route.ts"
                    data-line-count="412">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/quotas/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">412</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/quotas/reset/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/quotas/reset/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/quotas/reset/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/quotas/reset/route.ts"
                    data-line-count="227">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/quotas/reset/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">227</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/assign-subscription/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/assign-subscription/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/assign-subscription/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/assign-subscription/route.ts"
                    data-line-count="284">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/assign-subscription/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">284</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/quota-overrides/route.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/quota-overrides/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/quota-overrides/route.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/quota-overrides/route.ts"
                    data-line-count="406">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/quota-overrides/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">406</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">route.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/alerts/[id]/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/alerts/[id]/route.ts"
                    data-expected-doc="src/app/api/admin/alerts/[id]/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/alerts/[id]/route.ts"
                    data-line-count="221">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/alerts/[id]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">221</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/emojis/route.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/emojis/route.ts"
                    data-expected-doc="src/app/api/emojis/index.md"
                    data-issues-count="4"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/emojis/route.ts"
                    data-line-count="438">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/emojis/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">438</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, api_reference, examples">overview, usage, api_reference +1 more</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/app/api/og-image/utils.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/utils.ts"
                    data-expected-doc="src/app/api/og-image/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/utils.ts"
                    data-line-count="65">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">utils.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">65</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/types.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/types.ts"
                    data-expected-doc="src/app/api/og-image/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/types.ts"
                    data-line-count="147">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">types.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">147</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/MachineFingerprint.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/MachineFingerprint.ts"
                    data-expected-doc="src/app/api/og-image/services/MachineFingerprint.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/MachineFingerprint.ts"
                    data-line-count="285">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">MachineFingerprint.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">285</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">MachineFingerprint.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/DatabaseService.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/DatabaseService.ts"
                    data-expected-doc="src/app/api/og-image/services/DatabaseService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/DatabaseService.ts"
                    data-line-count="398">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DatabaseService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">398</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DatabaseService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/QuoteService.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/QuoteService.ts"
                    data-expected-doc="src/app/api/og-image/services/QuoteService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/QuoteService.ts"
                    data-line-count="115">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">QuoteService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">115</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">QuoteService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/SVGGenerator.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/SVGGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/SVGGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/SVGGenerator.ts"
                    data-line-count="302">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">SVGGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">302</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">SVGGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/OGImageService.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/OGImageService.ts"
                    data-expected-doc="src/app/api/og-image/services/OGImageService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/OGImageService.ts"
                    data-line-count="545">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">OGImageService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">545</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">OGImageService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/og-image/services/patterns/ShapePatternGenerator.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/ShapePatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/ShapePatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/ShapePatternGenerator.ts"
                    data-line-count="279">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ShapePatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">279</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ShapePatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/patterns/BasePatternGenerator.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/BasePatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/BasePatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/BasePatternGenerator.ts"
                    data-line-count="201">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">BasePatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">201</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">BasePatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/patterns/OrganicPatternGenerator.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/OrganicPatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/OrganicPatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/OrganicPatternGenerator.ts"
                    data-line-count="200">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">OrganicPatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">200</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">OrganicPatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/og-image/services/patterns/LinePatternGenerator.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/og-image/services/patterns/LinePatternGenerator.ts"
                    data-expected-doc="src/app/api/og-image/services/patterns/LinePatternGenerator.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/og-image/services/patterns/LinePatternGenerator.ts"
                    data-line-count="160">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/og-image/services/patterns/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">LinePatternGenerator.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">160</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">LinePatternGenerator.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/services/EnhancedQuotaService.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/services/EnhancedQuotaService.ts"
                    data-expected-doc="src/lib/services/EnhancedQuotaService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/services/EnhancedQuotaService.ts"
                    data-line-count="619">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EnhancedQuotaService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">619</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EnhancedQuotaService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/service-worker-cleanup.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/service-worker-cleanup.ts"
                    data-expected-doc="src/lib/utils/service-worker-cleanup.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/service-worker-cleanup.ts"
                    data-line-count="610">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">service-worker-cleanup.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">610</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">service-worker-cleanup.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/content-parsers.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/content-parsers.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/content-parsers.ts"
                    data-line-count="876">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">content-parsers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">876</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/os-detection.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/os-detection.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/os-detection.ts"
                    data-line-count="303">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">os-detection.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">303</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/utils/privacy.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/privacy.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/privacy.ts"
                    data-line-count="147">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">privacy.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">147</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/scroll-highlight-demo.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/scroll-highlight-demo.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/scroll-highlight-demo.ts"
                    data-line-count="540">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">scroll-highlight-demo.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">540</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/social-sharing.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/social-sharing.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/social-sharing.ts"
                    data-line-count="130">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">social-sharing.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">130</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/cache-manager.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/cache-manager.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/cache-manager.ts"
                    data-line-count="499">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">cache-manager.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">499</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/scroll-position.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/scroll-position.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/scroll-position.ts"
                    data-line-count="287">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">scroll-position.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">287</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/utils/timeFormatting.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/timeFormatting.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/timeFormatting.ts"
                    data-line-count="55">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">timeFormatting.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">55</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/hard-reset-manager.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/hard-reset-manager.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/hard-reset-manager.ts"
                    data-line-count="604">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">hard-reset-manager.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">604</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/requestIdentifier.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/requestIdentifier.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/requestIdentifier.ts"
                    data-line-count="181">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">requestIdentifier.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">181</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/string/tag-regex.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/string/tag-regex.ts"
                    data-expected-doc="src/lib/utils/string/tag-regex.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/string/tag-regex.ts"
                    data-line-count="133">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/string/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">tag-regex.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">133</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">tag-regex.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/utils/string/tag-utils.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/string/tag-utils.ts"
                    data-expected-doc="src/lib/utils/string/tag-utils.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/string/tag-utils.ts"
                    data-line-count="83">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/string/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">tag-utils.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">83</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">tag-utils.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/parsers/emoji-parser.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/emoji-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/emoji-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/emoji-parser.ts"
                    data-line-count="795">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">emoji-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">795</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">emoji-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/parsers/image-parser.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/image-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/image-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/image-parser.ts"
                    data-line-count="405">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">image-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">405</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">image-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/parsers/markdown-parser.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/markdown-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/markdown-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/markdown-parser.ts"
                    data-line-count="282">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">markdown-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">282</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">markdown-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/parsers/rich-text-parser.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/rich-text-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/rich-text-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/rich-text-parser.ts"
                    data-line-count="416">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">rich-text-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">416</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">rich-text-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/hooks/useNavigationLoader.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/hooks/useNavigationLoader.ts"
                    data-expected-doc="src/lib/hooks/useNavigationLoader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/hooks/useNavigationLoader.ts"
                    data-line-count="7">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useNavigationLoader.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">7</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useNavigationLoader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/service-worker-cleanup.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/service-worker-cleanup.ts"
                    data-expected-doc="src/lib/utils/service-worker-cleanup.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/service-worker-cleanup.ts"
                    data-line-count="610">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">service-worker-cleanup.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">610</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">service-worker-cleanup.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/content-parsers.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/content-parsers.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/content-parsers.ts"
                    data-line-count="876">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">content-parsers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">876</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/os-detection.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/os-detection.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/os-detection.ts"
                    data-line-count="303">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">os-detection.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">303</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/utils/privacy.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/privacy.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/privacy.ts"
                    data-line-count="147">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">privacy.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">147</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/scroll-highlight-demo.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/scroll-highlight-demo.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/scroll-highlight-demo.ts"
                    data-line-count="540">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">scroll-highlight-demo.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">540</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/social-sharing.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/social-sharing.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/social-sharing.ts"
                    data-line-count="130">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">social-sharing.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">130</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/cache-manager.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/cache-manager.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/cache-manager.ts"
                    data-line-count="499">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">cache-manager.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">499</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/scroll-position.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/scroll-position.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/scroll-position.ts"
                    data-line-count="287">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">scroll-position.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">287</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/utils/timeFormatting.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/timeFormatting.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/timeFormatting.ts"
                    data-line-count="55">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">timeFormatting.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">55</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/hard-reset-manager.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/hard-reset-manager.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/hard-reset-manager.ts"
                    data-line-count="604">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">hard-reset-manager.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">604</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/requestIdentifier.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/requestIdentifier.ts"
                    data-expected-doc="src/lib/utils/index.md"
                    data-issues-count="3"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/requestIdentifier.ts"
                    data-line-count="181">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">requestIdentifier.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">181</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, examples">overview, usage, examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/string/tag-regex.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/string/tag-regex.ts"
                    data-expected-doc="src/lib/utils/string/tag-regex.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/string/tag-regex.ts"
                    data-line-count="133">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/string/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">tag-regex.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">133</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">tag-regex.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/utils/string/tag-utils.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/string/tag-utils.ts"
                    data-expected-doc="src/lib/utils/string/tag-utils.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/string/tag-utils.ts"
                    data-line-count="83">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/string/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">tag-utils.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">83</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">tag-utils.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/parsers/emoji-parser.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/emoji-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/emoji-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/emoji-parser.ts"
                    data-line-count="795">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">emoji-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">795</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">emoji-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/parsers/image-parser.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/image-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/image-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/image-parser.ts"
                    data-line-count="405">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">image-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">405</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">image-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/utils/parsers/markdown-parser.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/markdown-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/markdown-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/markdown-parser.ts"
                    data-line-count="282">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">markdown-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">282</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">markdown-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/utils/parsers/rich-text-parser.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/utils/parsers/rich-text-parser.ts"
                    data-expected-doc="src/lib/utils/parsers/rich-text-parser.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/utils/parsers/rich-text-parser.ts"
                    data-line-count="416">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/utils/parsers/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">rich-text-parser.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">416</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">rich-text-parser.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/logging/factories.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/logging/factories.ts"
                    data-expected-doc="src/lib/logging/factories.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/logging/factories.ts"
                    data-line-count="105">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/logging/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">factories.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">105</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">factories.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/logging/types.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/logging/types.ts"
                    data-expected-doc="src/lib/logging/types.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/logging/types.ts"
                    data-line-count="180">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/logging/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">types.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">180</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">types.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/logging/core/Logger.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/logging/core/Logger.ts"
                    data-expected-doc="src/lib/logging/core/Logger.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/logging/core/Logger.ts"
                    data-line-count="336">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/logging/core/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">Logger.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">336</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">Logger.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/logging/adapters/ServiceWorkerLogger.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/logging/adapters/ServiceWorkerLogger.ts"
                    data-expected-doc="src/lib/logging/adapters/ServiceWorkerLogger.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/logging/adapters/ServiceWorkerLogger.ts"
                    data-line-count="196">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/logging/adapters/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ServiceWorkerLogger.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">196</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ServiceWorkerLogger.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/logging/adapters/DebugLogger.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/logging/adapters/DebugLogger.ts"
                    data-expected-doc="src/lib/logging/adapters/DebugLogger.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/logging/adapters/DebugLogger.ts"
                    data-line-count="380">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/logging/adapters/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">DebugLogger.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">380</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">DebugLogger.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/logging/adapters/ClientLogger.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/logging/adapters/ClientLogger.ts"
                    data-expected-doc="src/lib/logging/adapters/ClientLogger.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/logging/adapters/ClientLogger.ts"
                    data-line-count="239">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/logging/adapters/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ClientLogger.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">239</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ClientLogger.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/logging/adapters/ServerLogger.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/logging/adapters/ServerLogger.ts"
                    data-expected-doc="src/lib/logging/adapters/ServerLogger.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/logging/adapters/ServerLogger.ts"
                    data-line-count="173">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/logging/adapters/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">ServerLogger.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">173</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">ServerLogger.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/encryption/emoji-encryption.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/encryption/emoji-encryption.ts"
                    data-expected-doc="src/lib/encryption/emoji-encryption.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/encryption/emoji-encryption.ts"
                    data-line-count="280">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/encryption/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">emoji-encryption.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">280</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">emoji-encryption.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/encryption/base-encryption.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/encryption/base-encryption.ts"
                    data-expected-doc="src/lib/encryption/base-encryption.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/encryption/base-encryption.ts"
                    data-line-count="564">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/encryption/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">base-encryption.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">564</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">base-encryption.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/services/EnhancedQuotaService.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/services/EnhancedQuotaService.ts"
                    data-expected-doc="src/lib/services/EnhancedQuotaService.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/services/EnhancedQuotaService.ts"
                    data-line-count="619">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/services/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">EnhancedQuotaService.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">619</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">EnhancedQuotaService.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="configuration">configuration</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/middleware/withRateLimit.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/middleware/withRateLimit.ts"
                    data-expected-doc="src/lib/middleware/withRateLimit.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/middleware/withRateLimit.ts"
                    data-line-count="178">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/middleware/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">withRateLimit.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">178</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">withRateLimit.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/cron/refresh-materialized-views.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/cron/refresh-materialized-views.ts"
                    data-expected-doc="src/lib/cron/refresh-materialized-views.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/cron/refresh-materialized-views.ts"
                    data-line-count="220">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/cron/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">refresh-materialized-views.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">220</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">refresh-materialized-views.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/permissions/permissions.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/permissions/permissions.ts"
                    data-expected-doc="src/lib/permissions/permissions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/permissions/permissions.ts"
                    data-line-count="790">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/permissions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">permissions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">790</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">permissions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/actions/quota.actions.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/actions/quota.actions.ts"
                    data-expected-doc="src/lib/actions/quota.actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/actions/quota.actions.ts"
                    data-line-count="463">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/actions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">quota.actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">463</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">quota.actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/actions/permissions.actions.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/actions/permissions.actions.ts"
                    data-expected-doc="src/lib/actions/permissions.actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/actions/permissions.actions.ts"
                    data-line-count="383">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/actions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">permissions.actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">383</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">permissions.actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/actions/emoji.actions.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/actions/emoji.actions.ts"
                    data-expected-doc="src/lib/actions/emoji.actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/actions/emoji.actions.ts"
                    data-line-count="656">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/actions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">emoji.actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">656</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">emoji.actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/actions/profile.actions.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/actions/profile.actions.ts"
                    data-expected-doc="src/lib/actions/profile.actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/actions/profile.actions.ts"
                    data-line-count="532">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/actions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">profile.actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">532</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">profile.actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/actions/search.actions.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/actions/search.actions.ts"
                    data-expected-doc="src/lib/actions/search.actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/actions/search.actions.ts"
                    data-line-count="438">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/actions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">search.actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">438</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">search.actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/actions/post.actions.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/actions/post.actions.ts"
                    data-expected-doc="src/lib/actions/post.actions.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/actions/post.actions.ts"
                    data-line-count="124">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/actions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">post.actions.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">124</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">post.actions.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/state/atoms.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/state/atoms.ts"
                    data-expected-doc="src/lib/state/atoms.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/state/atoms.ts"
                    data-line-count="1626">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/state/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">atoms.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">1,626</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">atoms.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/state/batchedUpdater.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/state/batchedUpdater.ts"
                    data-expected-doc="src/lib/state/batchedUpdater.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/state/batchedUpdater.ts"
                    data-line-count="272">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/state/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">batchedUpdater.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">272</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">batchedUpdater.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/state/submissions/useUrlSync.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/state/submissions/useUrlSync.ts"
                    data-expected-doc="src/lib/state/submissions/useUrlSync.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/state/submissions/useUrlSync.ts"
                    data-line-count="150">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/state/submissions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useUrlSync.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">150</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useUrlSync.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/state/submissions/useSubmissionsFetch.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/state/submissions/useSubmissionsFetch.ts"
                    data-expected-doc="src/lib/state/submissions/useSubmissionsFetch.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/state/submissions/useSubmissionsFetch.ts"
                    data-line-count="267">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/state/submissions/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useSubmissionsFetch.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">267</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useSubmissionsFetch.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/rich-input/types.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/types.ts"
                    data-expected-doc="src/lib/rich-input/types.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/types.ts"
                    data-line-count="277">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">types.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">277</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">types.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/rich-input/utils/clickPositioning.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/clickPositioning.ts"
                    data-expected-doc="src/lib/rich-input/utils/clickPositioning.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/clickPositioning.ts"
                    data-line-count="858">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">clickPositioning.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">858</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">clickPositioning.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/rich-input/utils/navigationUtils.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/navigationUtils.ts"
                    data-expected-doc="src/lib/rich-input/utils/navigationUtils.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/navigationUtils.ts"
                    data-line-count="255">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">navigationUtils.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">255</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">navigationUtils.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/rich-input/utils/measurementHelpers.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/measurementHelpers.ts"
                    data-expected-doc="src/lib/rich-input/utils/measurementHelpers.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/measurementHelpers.ts"
                    data-line-count="111">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">measurementHelpers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">111</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">measurementHelpers.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/rich-input/utils/tokenPositioning.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/tokenPositioning.ts"
                    data-expected-doc="src/lib/rich-input/utils/tokenPositioning.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/tokenPositioning.ts"
                    data-line-count="165">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">tokenPositioning.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">165</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">tokenPositioning.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/rich-input/utils/selectionCalculations.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/selectionCalculations.ts"
                    data-expected-doc="src/lib/rich-input/utils/selectionCalculations.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/selectionCalculations.ts"
                    data-line-count="199">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">selectionCalculations.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">199</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">selectionCalculations.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/rich-input/utils/enhancedCursorPositioning.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/enhancedCursorPositioning.ts"
                    data-expected-doc="src/lib/rich-input/utils/enhancedCursorPositioning.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/enhancedCursorPositioning.ts"
                    data-line-count="253">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">enhancedCursorPositioning.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">253</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">enhancedCursorPositioning.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/rich-input/utils/enhancedTokenization.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/enhancedTokenization.ts"
                    data-expected-doc="src/lib/rich-input/utils/enhancedTokenization.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/enhancedTokenization.ts"
                    data-line-count="266">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">enhancedTokenization.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">266</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">enhancedTokenization.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/rich-input/utils/coordinateCalculations.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/coordinateCalculations.ts"
                    data-expected-doc="src/lib/rich-input/utils/coordinateCalculations.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/coordinateCalculations.ts"
                    data-line-count="483">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">coordinateCalculations.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">483</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">coordinateCalculations.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/rich-input/utils/logger.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/logger.ts"
                    data-expected-doc="src/lib/rich-input/utils/logger.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/logger.ts"
                    data-line-count="763">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">logger.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">763</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">logger.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/rich-input/utils/cursorCalculations.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/utils/cursorCalculations.ts"
                    data-expected-doc="src/lib/rich-input/utils/cursorCalculations.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/utils/cursorCalculations.ts"
                    data-line-count="692">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/utils/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">cursorCalculations.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">692</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">cursorCalculations.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/rich-input/core/WidthMeasurement.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/core/WidthMeasurement.ts"
                    data-expected-doc="src/lib/rich-input/core/WidthMeasurement.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/core/WidthMeasurement.ts"
                    data-line-count="293">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/core/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">WidthMeasurement.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">293</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">WidthMeasurement.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/rich-input/core/RichInputEngine.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/core/RichInputEngine.ts"
                    data-expected-doc="src/lib/rich-input/core/RichInputEngine.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/core/RichInputEngine.ts"
                    data-line-count="839">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/core/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">RichInputEngine.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">839</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">RichInputEngine.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/rich-input/hooks/useRichInput.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/hooks/useRichInput.ts"
                    data-expected-doc="src/lib/rich-input/hooks/useRichInput.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/hooks/useRichInput.ts"
                    data-line-count="133">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useRichInput.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">133</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useRichInput.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/rich-input/hooks/useKeyboardHandlers.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/hooks/useKeyboardHandlers.ts"
                    data-expected-doc="src/lib/rich-input/hooks/useKeyboardHandlers.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/hooks/useKeyboardHandlers.ts"
                    data-line-count="337">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useKeyboardHandlers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">337</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useKeyboardHandlers.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/rich-input/hooks/useMouseHandlers.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/rich-input/hooks/useMouseHandlers.ts"
                    data-expected-doc="src/lib/rich-input/hooks/useMouseHandlers.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/rich-input/hooks/useMouseHandlers.ts"
                    data-line-count="172">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/rich-input/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useMouseHandlers.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">172</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useMouseHandlers.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/security/validation.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/security/validation.ts"
                    data-expected-doc="src/lib/security/validation.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/security/validation.ts"
                    data-line-count="251">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/security/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">validation.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">251</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">validation.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/coin.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/coin.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/coin.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/coin.selectors.ts"
                    data-line-count="7">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">coin.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">7</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">coin.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/pagination.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/pagination.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/pagination.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/pagination.selectors.ts"
                    data-line-count="8">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">pagination.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">8</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">pagination.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/submissions-list.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/submissions-list.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/submissions-list.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/submissions-list.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">submissions-list.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">submissions-list.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/discord-link.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/discord-link.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/discord-link.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/discord-link.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">discord-link.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">discord-link.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/docs-link.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/docs-link.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/docs-link.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/docs-link.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">docs-link.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">docs-link.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/add-submission-form.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/add-submission-form.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/add-submission-form.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/add-submission-form.selectors.ts"
                    data-line-count="7">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">add-submission-form.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">7</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">add-submission-form.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/auth-buttons.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/auth-buttons.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/auth-buttons.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/auth-buttons.selectors.ts"
                    data-line-count="4">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">auth-buttons.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">4</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">auth-buttons.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/nav.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/nav.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/nav.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/nav.selectors.ts"
                    data-line-count="9">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">nav.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">9</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">nav.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/loader.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/loader.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/loader.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/loader.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">loader.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">loader.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/recent-tags.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/recent-tags.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/recent-tags.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/recent-tags.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">recent-tags.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">recent-tags.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/card.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/card.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/card.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/card.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">card.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">card.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/discord-embed.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/discord-embed.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/discord-embed.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/discord-embed.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">discord-embed.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">discord-embed.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/page-aside.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/page-aside.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/page-aside.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/page-aside.selectors.ts"
                    data-line-count="4">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">page-aside.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">4</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">page-aside.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/fade-in.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/fade-in.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/fade-in.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/fade-in.selectors.ts"
                    data-line-count="7">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">fade-in.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">7</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">fade-in.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/empty.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/empty.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/empty.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/empty.selectors.ts"
                    data-line-count="4">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">empty.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">4</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">empty.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/nav-paths.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/nav-paths.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/nav-paths.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/nav-paths.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">nav-paths.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">nav-paths.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/badge.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/badge.ts"
                    data-expected-doc="src/lib/test-selectors/components/badge.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/badge.ts"
                    data-line-count="4">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">badge.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">4</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">badge.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/app-version.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/app-version.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/app-version.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/app-version.selectors.ts"
                    data-line-count="3">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">app-version.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">3</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">app-version.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/game-wrapper.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/game-wrapper.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/game-wrapper.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/game-wrapper.selectors.ts"
                    data-line-count="4">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">game-wrapper.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">4</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">game-wrapper.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="low" data-file-path="src/lib/test-selectors/components/avatar.selectors.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/test-selectors/components/avatar.selectors.ts"
                    data-expected-doc="src/lib/test-selectors/components/avatar.selectors.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/test-selectors/components/avatar.selectors.ts"
                    data-line-count="5">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/test-selectors/components/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">avatar.selectors.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">5</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-low">💡 Low</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">avatar.selectors.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="medium" data-file-path="src/lib/hooks/useNavigationLoader.ts" 
                    data-status="missing" data-effort="low"
                    data-file-type="ts"
                    data-file-name="src/lib/hooks/useNavigationLoader.ts"
                    data-expected-doc="src/lib/hooks/useNavigationLoader.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/hooks/useNavigationLoader.ts"
                    data-line-count="7">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/hooks/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">useNavigationLoader.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">7</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-medium">📝 Medium</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">useNavigationLoader.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-low">Low</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/api/withValidation.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/api/withValidation.ts"
                    data-expected-doc="src/lib/api/withValidation.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/api/withValidation.ts"
                    data-line-count="222">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/api/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">withValidation.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">222</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">withValidation.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/lib/config/media-domains.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/lib/config/media-domains.ts"
                    data-expected-doc="src/lib/config/media-domains.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/config/media-domains.ts"
                    data-line-count="286">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/config/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">media-domains.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">286</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">media-domains.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/lib/config/url-pills.ts" 
                    data-status="missing" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/lib/config/url-pills.ts"
                    data-expected-doc="src/lib/config/url-pills.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/lib/config/url-pills.ts"
                    data-line-count="453">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/lib/config/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">url-pills.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">453</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">url-pills.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/quotas/global/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/quotas/global/route.ts"
                    data-expected-doc="src/app/api/admin/quotas/global/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/quotas/global/route.ts"
                    data-line-count="362">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/quotas/global/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">362</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/quotas/global/[id]/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/quotas/global/[id]/route.ts"
                    data-expected-doc="src/app/api/admin/quotas/global/[id]/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/quotas/global/[id]/route.ts"
                    data-line-count="389">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/quotas/global/[id]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">389</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="critical" data-file-path="src/app/api/admin/emojis/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/emojis/route.ts"
                    data-expected-doc="src/app/api/admin/emojis/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/emojis/route.ts"
                    data-line-count="277">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/emojis/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">277</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-critical">🚨 Critical</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/permissions/[id]/route.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/permissions/[id]/route.ts"
                    data-expected-doc="src/app/api/admin/permissions/[id]/route.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/permissions/[id]/route.ts"
                    data-line-count="378">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/permissions/[id]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">378</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">route.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/permissions/roles/route.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/permissions/roles/route.ts"
                    data-expected-doc="src/app/api/admin/permissions/roles/route.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/permissions/roles/route.ts"
                    data-line-count="345">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/permissions/roles/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">345</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">route.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/route.ts"
                    data-expected-doc="src/app/api/admin/users/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/route.ts"
                    data-line-count="299">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">299</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/quotas/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/quotas/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/quotas/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/quotas/route.ts"
                    data-line-count="412">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/quotas/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">412</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/quotas/reset/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/quotas/reset/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/quotas/reset/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/quotas/reset/route.ts"
                    data-line-count="227">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/quotas/reset/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">227</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/assign-subscription/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/assign-subscription/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/assign-subscription/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/assign-subscription/route.ts"
                    data-line-count="284">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/assign-subscription/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">284</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/users/[id]/quota-overrides/route.ts" 
                    data-status="missing" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/users/[id]/quota-overrides/route.ts"
                    data-expected-doc="src/app/api/admin/users/[id]/quota-overrides/route.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/users/[id]/quota-overrides/route.ts"
                    data-line-count="406">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/users/[id]/quota-overrides/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">406</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-missing">Missing</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">route.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="Documentation file does not exist">Documentation file does not exist</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/admin/alerts/[id]/route.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/app/api/admin/alerts/[id]/route.ts"
                    data-expected-doc="src/app/api/admin/alerts/[id]/index.md"
                    data-issues-count="1"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/admin/alerts/[id]/route.ts"
                    data-line-count="221">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/admin/alerts/[id]/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">221</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="examples">examples</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/app/api/emojis/route.ts" 
                    data-status="inadequate" data-effort="medium"
                    data-file-type="ts"
                    data-file-name="src/app/api/emojis/route.ts"
                    data-expected-doc="src/app/api/emojis/index.md"
                    data-issues-count="4"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/app/api/emojis/route.ts"
                    data-line-count="438">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/app/api/emojis/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">route.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">438</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-medium">Medium</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title="overview, usage, api_reference, examples">overview, usage, api_reference +1 more</span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/auth.config.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/auth.config.ts"
                    data-expected-doc="src/index.md"
                    data-issues-count="0"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/auth.config.ts"
                    data-line-count="126">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">auth.config.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">126</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title=""></span>
                    </td>
                </tr>
                <tr class="clickable-row gap-row" data-priority="high" data-file-path="src/auth.config.ts" 
                    data-status="inadequate" data-effort="high"
                    data-file-type="ts"
                    data-file-name="src/auth.config.ts"
                    data-expected-doc="src/index.md"
                    data-issues-count="0"
                    data-github-url="https://github.com/Underwood-Inc/idling.app__UI/blob/master/src/auth.config.ts"
                    data-line-count="126">
                    <td class="col-file">
                        <div class="file-path-container">
                            <span class="file-directory">src/</span>
                            <span class="file-name clickable-filename" title="Click to preview source code">auth.config.ts</span>
                        </div>
                    </td>
                    <td class="col-lines">
                        <span class="line-count">126</span>
                    </td>
                    <td class="col-status">
                        <span class="badge badge-inadequate">Inadequate</span>
                    </td>
                    <td class="col-priority">
                        <span class="priority-indicator priority-high">⚠️ High</span>
                    </td>
                    <td class="col-doc">
                        <span class="code">index.md</span>
                    </td>
                    <td class="col-effort">
                        <span class="effort-indicator effort-high">High</span>
                    </td>
                    <td class="col-issues">
                        <span class="issues-text" title=""></span>
                    </td>
                </tr>
                    </tbody>
                </table>
                
                <!-- Empty State View -->
                <div id="empty-state" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">🔍</div>
                    <div class="empty-state-text">No Records Found</div>
                    <div class="empty-state-subtext">
                        <p>No documentation gaps match your current filters.</p>
                        <p>Try adjusting your search criteria or clearing filters to see more results.</p>
                        <button class="clear-btn" id="clear-filters-empty">Clear All Filters</button>
                    </div>
                </div>
            </div>
            
            <!-- Pagination Controls -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span>Showing <span id="showing-start">1</span>-<span id="showing-end">50</span> of <span id="showing-total">504</span> items</span>
                    <div class="items-per-page">
                        <label for="items-per-page">Items per page:</label>
                        <select id="items-per-page" class="items-select">
                            <option value="25">25</option>
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="all">All</option>
                        </select>
                    </div>
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="first-page" title="First page">⏮️</button>
                    <button class="pagination-btn" id="prev-page" title="Previous page">◀️</button>
                    <span class="pagination-pages">
                        <span>Page </span>
                        <input type="number" id="current-page" value="1" min="1" max="11" class="page-input">
                        <span> of 11</span>
                    </span>
                    <button class="pagination-btn" id="next-page" title="Next page">▶️</button>
                    <button class="pagination-btn" id="last-page" title="Last page">⏭️</button>
                </div>
            </div>
        </div>
        

        <div class="card">
            <h2>💡 Recommendations</h2>
            
            <div class="recommendation">
                <h4>Low Documentation Coverage</h4>
                <p>Current coverage (1.2%) is below the minimum requirement (85.0%). Focus on creating documentation for critical files.</p>
            </div>
            
            <div class="recommendation">
                <h4>Missing Documentation Files</h4>
                <p>440 files lack documentation entirely. Prioritize creating index.md files for these.</p>
            </div>
            
            <div class="recommendation">
                <h4>Inadequate Documentation</h4>
                <p>64 files have incomplete documentation. Review and enhance these files.</p>
            </div>
            
        </div>
        

        <div class="footer">
            <div class="footer-hero">
                <div class="footer-hero-content">
                    <h3 class="footer-title">
                        <span class="footer-icon">📊</span>
                        Documentation Coverage Analysis Complete
                    </h3>
                    <p class="footer-subtitle">
                        Powered by <strong>Idling.app Documentation Coverage Tool</strong>
                    </p>
                </div>
            </div>
            
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-section-header">
                        <h4 class="footer-section-title">📋 Report Summary</h4>
                </div>
                    <div class="footer-stats">
                        <div class="footer-stat">
                            <span class="footer-stat-value">510</span>
                            <span class="footer-stat-label">Total Files</span>
                        </div>
                        <div class="footer-stat">
                            <span class="footer-stat-value">504</span>
                            <span class="footer-stat-label">Documentation Gaps</span>
                        </div>
                        <div class="footer-stat">
                            <span class="footer-stat-value">1.2%</span>
                            <span class="footer-stat-label">Coverage</span>
                        </div>
                    </div>
                </div>
                
                <div class="footer-section">
                    <div class="footer-section-header">
                        <h4 class="footer-section-title">🕒 Generation Info</h4>
                    </div>
                    <div class="footer-info">
                        <div class="footer-info-item">
                            <span class="footer-info-label">Generated:</span>
                            <span class="footer-info-value timestamp-with-tooltip" data-timestamp="2025-07-09T07:57:51.180331">
                        <span class="relative-time">Loading...</span>
                            </span>
                        </div>
                        <div class="footer-info-item">
                            <span class="footer-info-label">Analysis:</span>
                            <span class="footer-info-value timestamp-with-tooltip" data-timestamp="2025-07-09T07:57:51.180331">
                        <span class="relative-time">Loading...</span>
                            </span>
                </div>
                    </div>
                </div>
                
                <div class="footer-section">
                    <div class="footer-section-header">
                        <h4 class="footer-section-title">⚙️ Configuration</h4>
                </div>
                    <div class="footer-config">
                        <div class="footer-config-item">
                            <span class="footer-config-label">Coverage Threshold:</span>
                            <span class="footer-config-value">85.0%</span>
            </div>
                        <div class="footer-config-item">
                            <span class="footer-config-label">Quality Threshold:</span>
                            <span class="footer-config-value">0.7</span>
            </div>
        </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-tips">
                    <div class="footer-tip">
                        <span class="footer-tip-icon">💡</span>
                        <span class="footer-tip-text">
                            <strong>Tip:</strong> Click on table rows to view source code, click filenames to open on GitHub
                        </span>
                            </div>
                    <div class="footer-shortcuts">
                        <span class="footer-shortcut-group">
                            <kbd class="footer-kbd">Ctrl+F</kbd>
                            <span class="footer-shortcut-desc">Search</span>
                        </span>
                        <span class="footer-shortcut-group">
                            <kbd class="footer-kbd">Ctrl+K</kbd>
                            <span class="footer-shortcut-desc">Columns</span>
                        </span>
                        <span class="footer-shortcut-group">
                            <kbd class="footer-kbd">Ctrl+Shift+D</kbd>
                            <span class="footer-shortcut-desc">Theme</span>
                        </span>
                        </div>
                </div>
            </div>
            
            <div class="footer-brand">
                <div class="footer-brand-content">
                    <span class="footer-brand-text">
                        Made with <span class="footer-heart">❤️</span> by <strong>Idling.app</strong>
                    </span>
                    <span class="footer-version">v1.0.0</span>
                    </div>
                    </div>
                </div>
        
    </div>
<!-- Source Code Modal -->
<div id="source-code-modal" class="modal source-modal">
    <div class="modal-content source-modal-content">
        <div class="modal-header">
            <h3 id="source-modal-title">📄 Source Code Preview</h3>
            <div class="modal-header-actions">
                <button id="open-github-btn" class="btn-secondary" title="Open on GitHub">
                    <span class="btn-icon">🔗</span>
                    <span class="btn-text">GitHub</span>
                </button>
                <button class="modal-close">&times;</button>
            </div>
        </div>
        <div class="modal-body source-modal-body">
            <div id="source-loading" class="source-loading">
                <div class="loading-spinner"></div>
                <p>Loading source code...</p>
            </div>
            <div id="source-error" class="source-error" style="display: none;">
                <p>❌ Could not load source code</p>
                <p id="source-error-message"></p>
            </div>
            <pre id="source-code-content" class="source-code" style="display: none;"><code id="source-code-text"></code></pre>
        </div>
    </div>
</div>

<!-- Column Picker Modal -->
<div id="column-picker-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>🎛️ Column Visibility</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <p>Select which columns to display in the table:</p>
            <div class="column-picker">
                
                <div class="column-item essential">
                    <input type="checkbox" class="column-checkbox" id="col-file" 
                           checked disabled>
                    <label for="col-file" class="column-label">📁 File</label>
                    <span class="column-essential">Essential</span>
                </div>
            

                <div class="column-item ">
                    <input type="checkbox" class="column-checkbox" id="col-lines" 
                           checked >
                    <label for="col-lines" class="column-label">📏 Lines</label>
                    
                </div>
            

                <div class="column-item essential">
                    <input type="checkbox" class="column-checkbox" id="col-status" 
                           checked disabled>
                    <label for="col-status" class="column-label">📊 Status</label>
                    <span class="column-essential">Essential</span>
                </div>
            

                <div class="column-item essential">
                    <input type="checkbox" class="column-checkbox" id="col-priority" 
                           checked disabled>
                    <label for="col-priority" class="column-label">🎯 Priority</label>
                    <span class="column-essential">Essential</span>
                </div>
            

                <div class="column-item ">
                    <input type="checkbox" class="column-checkbox" id="col-doc" 
                           checked >
                    <label for="col-doc" class="column-label">📄 Expected Doc</label>
                    
                </div>
            

                <div class="column-item ">
                    <input type="checkbox" class="column-checkbox" id="col-effort" 
                           checked >
                    <label for="col-effort" class="column-label">⏱️ Effort</label>
                    
                </div>
            

                <div class="column-item ">
                    <input type="checkbox" class="column-checkbox" id="col-issues" 
                           checked >
                    <label for="col-issues" class="column-label">⚠️ Issues</label>
                    
                </div>
            
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-columns-btn" class="btn-secondary">Reset to Default</button>
            <button id="apply-columns-btn" class="btn-primary">Apply Changes</button>
        </div>
    </div>
</div>

<!-- Timestamp Tooltip Template -->
<div id="timestamp-tooltip" class="timestamp-tooltip" style="display: none;">
    <div class="tooltip-header">
        <h4>🕒 Exact Time</h4>
        <div class="tooltip-relative-time"></div>
    </div>
    <div class="tooltip-section">
        <div class="tooltip-label">UTC Time</div>
        <div class="tooltip-utc-time"></div>
    </div>
    <div class="tooltip-section">
        <div class="tooltip-label">Your Local Time</div>
        <div class="tooltip-local-time"></div>
    </div>
</div>

<!-- Help Modal -->
<div id="help-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>❓ Help & Keyboard Shortcuts</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="help-section">
                <h4>⌨️ Keyboard Shortcuts</h4>
                <div class="shortcut-grid">
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>F</kbd>
                        <span>Focus search input</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>K</kbd>
                        <span>Open column picker</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>T</kbd>
                        <span>Toggle theme</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Escape</kbd>
                        <span>Close modals</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 

    <script type="application/json" data-source-code="true">
{
  "src/app/components/ErrorBoundary.tsx":{
    "content":"'use client';\nimport { Component, ReactNode } from 'react';\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n}\n\nexport default class ErrorBoundary extends Component<Props, State> {\n  state = { hasError: false };\n\n  static getDerivedStateFromError() {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error) {\n    console.error('ErrorBoundary caught:', error);\n  }\n\n  render() {\n    return this.state.hasError\n      ? this.props.fallback || <div>Error loading content</div>\n      : this.props.children;\n  }\n}\n",
    "language":"typescript",
    "lines":30,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/fade-in/FadeIn.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { FADE_IN_SELECTORS } from 'src/lib/test-selectors/components/fade-in.selectors';\nimport FadeIn, { DisplayType } from './FadeIn';\n\ndescribe('FadeIn Component', () => {\n  it('renders children correctly', () => {\n    render(<FadeIn>Test Content</FadeIn>);\n    expect(screen.getByText('Test Content')).toBeInTheDocument();\n  });\n\n  it('applies the fade-in class', () => {\n    render(<FadeIn>Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    expect(element).toHaveClass('fade-in');\n  });\n\n  it('applies the visible class after mount', () => {\n    jest.useFakeTimers();\n    render(<FadeIn>Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    jest.runAllTimers();\n    expect(element).toHaveClass('visible');\n  });\n\n  it('applies additional class names', () => {\n    render(<FadeIn className=\\\"additional-class\\\">Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    expect(element).toHaveClass('additional-class');\n  });\n\n  it('renders as a div by default', () => {\n    render(<FadeIn>Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    expect(element.tagName).toBe('DIV');\n    expect(element).toHaveAttribute('data-testid', FADE_IN_SELECTORS.DIV);\n  });\n\n  it('renders as a span when display is span', () => {\n    render(<FadeIn display={DisplayType.SPAN}>Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    expect(element.tagName).toBe('SPAN');\n    expect(element).toHaveAttribute('data-testid', FADE_IN_SELECTORS.SPAN);\n  });\n\n  it('renders as a p when display is p', () => {\n    render(<FadeIn display={DisplayType.P}>Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    expect(element.tagName).toBe('P');\n    expect(element).toHaveAttribute('data-testid', FADE_IN_SELECTORS.P);\n  });\n\n  it('renders as a code when display is code', () => {\n    render(<FadeIn display={DisplayType.CODE}>Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    expect(element.tagName).toBe('CODE');\n    expect(element).toHaveAttribute('data-testid', FADE_IN_SELECTORS.CODE);\n  });\n\n  it('renders as a li when display is li', () => {\n    render(<FadeIn display={DisplayType.LI}>Test Content</FadeIn>);\n    const element = screen.getByText('Test Content');\n    expect(element.tagName).toBe('LI');\n    expect(element).toHaveAttribute('data-testid', FADE_IN_SELECTORS.LI);\n  });\n});\n",
    "language":"typescript",
    "lines":66,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/fade-in/FadeIn.tsx":{
    "content":"'use client';\nimport React, { CSSProperties, useEffect, useState } from 'react';\nimport { FADE_IN_SELECTORS } from 'src/lib/test-selectors/components/fade-in.selectors';\nimport './FadeIn.css';\n\nexport const enum DisplayType {\n  DIV = 'DIV',\n  SPAN = 'SPAN',\n  P = 'P',\n  CODE = 'CODE',\n  LI = 'LI'\n}\n\ninterface FadeInProps {\n  children: React.ReactNode;\n  className?: string;\n  display?: DisplayType;\n  style?: CSSProperties;\n}\n\nconst FadeIn: React.FC<FadeInProps> = ({\n  children,\n  className,\n  display = DisplayType.DIV,\n  style\n}) => {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    setIsVisible(true);\n  }, []);\n\n  const cssName = `fade-in${isVisible ? ' visible' : ''}${className ? ` ${className}` : ''}`;\n\n  const props = {\n    className: cssName,\n    style,\n    'data-testid': FADE_IN_SELECTORS[display]\n  };\n\n  // Update the switch statement to use DisplayType\n  switch (display) {\n    case DisplayType.CODE:\n      return <code {...props}>{children}</code>;\n    case DisplayType.LI:\n      return <li {...props}>{children}</li>;\n    case DisplayType.P:\n      return <p {...props}>{children}</p>;\n    case DisplayType.SPAN:\n      return <span {...props}>{children}</span>;\n    default:\n      return <div {...props}>{children}</div>;\n  }\n};\n\nexport default FadeIn;\n",
    "language":"typescript",
    "lines":57,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/user-profile/UserProfile.tsx":{
    "content":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useEffect, useState } from 'react';\nimport { UserProfileData } from '../../../lib/types/profile';\nimport { getEffectiveCharacterCount } from '../../../lib/utils/string';\nimport { Avatar } from '../avatar/Avatar';\nimport { ContentWithPills } from '../ui/ContentWithPills';\nimport { InstantLink } from '../ui/InstantLink';\nimport { SmartInput } from '../ui/SmartInput';\n\nimport './UserProfile.css';\n\n// Re-export for backward compatibility\nexport type { UserProfileData };\n\ninterface UserProfileProps {\n  user: UserProfileData;\n  variant?: 'full' | 'compact' | 'tooltip';\n  className?: string;\n  showStats?: boolean;\n  isOwnProfile?: boolean;\n  onBioUpdate?: (newBio: string) => Promise<void>;\n  isPending?: boolean;\n}\n\nexport function UserProfile({\n  user,\n  variant = 'full',\n  className = '',\n  showStats = false,\n  isOwnProfile = false,\n  onBioUpdate,\n  isPending = false\n}: UserProfileProps) {\n  const [isEditingBio, setIsEditingBio] = useState(false);\n  const [bioText, setBioText] = useState(user.bio || '');\n  const [isSaving, setIsSaving] = useState(false);\n  const [hasAdminAccess, setHasAdminAccess] = useState(false);\n  const { data: session } = useSession();\n\n  // Sync bioText when user profile changes\n  useEffect(() => {\n    setBioText(user.bio || '');\n  }, [user.bio]);\n\n  // Check admin access for current user\n  useEffect(() => {\n    async function checkAdminAccess() {\n      if (!session?.user?.id) {\n        setHasAdminAccess(false);\n        return;\n      }\n\n      try {\n        const response = await fetch('/api/test/admin-check');\n        if (response.ok) {\n          const data = await response.json();\n          setHasAdminAccess(data.hasAdminAccess);\n        }\n      } catch (error) {\n        console.error('Error checking admin access:', error);\n        setHasAdminAccess(false);\n      }\n    }\n\n    checkAdminAccess();\n  }, [session]);\n\n  const displayName = user.username || user.name || 'Anonymous';\n  const joinDate = user.created_at\n    ? new Date(user.created_at).toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'long'\n      })\n    : null;\n\n  const handleBioSave = async () => {\n    if (!onBioUpdate) return;\n\n    setIsSaving(true);\n    try {\n      await onBioUpdate(bioText);\n      setIsEditingBio(false);\n    } catch (error) {\n      console.error('Failed to update bio:', error);\n      // Reset to original bio on error\n      setBioText(user.bio || '');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleBioCancel = () => {\n    setBioText(user.bio || '');\n    setIsEditingBio(false);\n  };\n\n  const isDisabled = isSaving || isPending;\n\n  if (variant === 'tooltip') {\n    return (\n      <div className={`user-profile user-profile--tooltip ${className}`}>\n        <div className=\\\"user-profile__header\\\">\n          <div>\n            <Avatar seed={user.id} size=\\\"md\\\" />\n          </div>\n          <div className=\\\"user-profile__header-info\\\">\n            <div className=\\\"user-profile__header-top\\\">\n              <h4 className=\\\"user-profile__name\\\">{displayName}</h4>\n              {isOwnProfile && !isEditingBio && (\n                <button\n                  className=\\\"user-profile__edit-bio-btn user-profile__edit-bio-btn--header\\\"\n                  onClick={() => setIsEditingBio(true)}\n                  title=\\\"Edit bio\\\"\n                >\n                  Edit Bio\n                </button>\n              )}\n            </div>\n            {joinDate && (\n              <span className=\\\"user-profile__join-date\\\">Joined {joinDate}</span>\n            )}\n            {user.location && (\n              <p className=\\\"user-profile__location\\\">\ud83d\udccd {user.location}</p>\n            )}\n          </div>\n        </div>\n\n        <div className=\\\"user-profile__bio\\\">\n          {isEditingBio ? (\n            <div className=\\\"user-profile__bio-editor\\\">\n              <SmartInput\n                value={bioText}\n                onChange={setBioText}\n                placeholder=\\\"Tell us about yourself... Use #hashtags, @mentions, and paste URLs!\\\"\n                className=\\\"user-profile__bio-smart-input\\\"\n                as=\\\"textarea\\\"\n                rows={3}\n                disabled={isDisabled}\n                enableHashtags\n                enableUserMentions\n              />\n              <div className=\\\"user-profile__bio-actions\\\">\n                <button\n                  className=\\\"user-profile__bio-save\\\"\n                  onClick={handleBioSave}\n                  disabled={isDisabled}\n                >\n                  {isDisabled ? 'Saving...' : 'Save'}\n                </button>\n                <button\n                  className=\\\"user-profile__bio-cancel\\\"\n                  onClick={handleBioCancel}\n                  disabled={isDisabled}\n                >\n                  Cancel\n                </button>\n              </div>\n              <div className=\\\"user-profile__bio-counter\\\">\n                {getEffectiveCharacterCount(bioText)}/500 characters\n              </div>\n            </div>\n          ) : (\n            <div className=\\\"user-profile__bio-content\\\">\n              {user.bio ? (\n                <ContentWithPills\n                  content={user.bio}\n                  contextId={`user-profile-bio-${user.id}`}\n                  className=\\\"user-profile__bio-pills\\\"\n                />\n              ) : isOwnProfile ? (\n                <p className=\\\"user-profile__bio-placeholder\\\">\n                  Click &quot;Edit Bio&quot; to add your bio and tell others\n                  about yourself.\n                </p>\n              ) : (\n                <p className=\\\"user-profile__bio-placeholder\\\">\n                  {displayName} hasn&apos;t added a bio yet.\n                </p>\n              )}\n            </div>\n          )}\n        </div>\n\n        {showStats && (\n          <div className=\\\"user-profile__stats\\\">\n            <div className=\\\"user-profile__stat\\\">\n              <span className=\\\"user-profile__stat-number\\\">\n                {user.posts_count || 0}\n              </span>\n              <span className=\\\"user-profile__stat-label\\\">Posts</span>\n            </div>\n            <div className=\\\"user-profile__stat\\\">\n              <span className=\\\"user-profile__stat-number\\\">\n                {user.replies_count || 0}\n              </span>\n              <span className=\\\"user-profile__stat-label\\\">Replies</span>\n            </div>\n            <div className=\\\"user-profile__stat\\\">\n              <span className=\\\"user-profile__stat-number\\\">\n                {user.total_submissions || 0}\n              </span>\n              <span className=\\\"user-profile__stat-label\\\">Total</span>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  if (variant === 'compact') {\n    return (\n      <div className={`user-profile user-profile--compact ${className}`}>\n        <Avatar seed={user.id} size=\\\"sm\\\" />\n        <div className=\\\"user-profile__info\\\">\n          <span className=\\\"user-profile__name\\\">{displayName}</span>\n          {user.location && (\n            <span className=\\\"user-profile__location\\\">{user.location}</span>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`user-profile user-profile--full ${className}`}>\n      <div className=\\\"user-profile__header\\\">\n        <div className=\\\"user-profile__avatar-container\\\">\n          <Avatar seed={user.id} size=\\\"lg\\\" />\n          <div className=\\\"user-profile__avatar-badge\\\">\n            {user.profile_public !== false ? '\ud83c\udf1f' : '\ud83d\udd12'}\n          </div>\n        </div>\n        <div className=\\\"user-profile__header-info\\\">\n          <h2 className=\\\"user-profile__name\\\">{displayName}</h2>\n          <div className=\\\"user-profile__meta-row\\\">\n            {user.location && (\n              <p className=\\\"user-profile__location\\\">\ud83d\udccd {user.location}</p>\n            )}\n            {joinDate && (\n              <p className=\\\"user-profile__join-date\\\">\n                \ud83d\udc64 Member since {joinDate}\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\\\"user-profile__bio\\\">\n        <div className=\\\"user-profile__bio-header\\\">\n          <h3>About</h3>\n          <div className=\\\"user-profile__bio-actions\\\">\n            {isOwnProfile && !isEditingBio && (\n              <button\n                className=\\\"user-profile__edit-bio-btn\\\"\n                onClick={() => setIsEditingBio(true)}\n                title=\\\"Edit bio\\\"\n              >\n                \u270f\ufe0f Edit\n              </button>\n            )}\n            {isOwnProfile && (\n              <InstantLink\n                href=\\\"/settings\\\"\n                className=\\\"user-profile__settings-link\\\"\n                title=\\\"User settings\\\"\n              >\n                \u2699\ufe0f Settings\n              </InstantLink>\n            )}\n            {hasAdminAccess && (\n              <InstantLink\n                href=\\\"/admin\\\"\n                className=\\\"user-profile__admin-link\\\"\n                title=\\\"Admin Dashboard\\\"\n              >\n                \ud83d\udee1\ufe0f Admin\n              </InstantLink>\n            )}\n          </div>\n        </div>\n\n        {isEditingBio ? (\n          <div className=\\\"user-profile__bio-editor\\\">\n            <SmartInput\n              value={bioText}\n              onChange={setBioText}\n              placeholder=\\\"Tell us about yourself... Use #hashtags, @mentions, and paste URLs!\\\"\n              className=\\\"user-profile__bio-smart-input\\\"\n              as=\\\"textarea\\\"\n              rows={4}\n              disabled={isDisabled}\n              enableHashtags={true}\n              enableUserMentions={true}\n            />\n            <div className=\\\"user-profile__bio-actions\\\">\n              <button\n                className=\\\"user-profile__bio-save\\\"\n                onClick={handleBioSave}\n                disabled={isDisabled}\n              >\n                {isDisabled ? 'Saving...' : 'Save'}\n              </button>\n              <button\n                className=\\\"user-profile__bio-cancel\\\"\n                onClick={handleBioCancel}\n                disabled={isDisabled}\n              >\n                Cancel\n              </button>\n            </div>\n            <div className=\\\"user-profile__bio-counter\\\">\n              {getEffectiveCharacterCount(bioText)}/500 characters\n            </div>\n          </div>\n        ) : (\n          <div className=\\\"user-profile__bio-content\\\">\n            {user.bio ? (\n              <ContentWithPills\n                content={user.bio}\n                contextId={`user-profile-bio-${user.id}`}\n                className=\\\"user-profile__bio-pills\\\"\n              />\n            ) : isOwnProfile ? (\n              <p className=\\\"user-profile__bio-placeholder\\\">\n                Click &quot;Edit&quot; to add your bio and tell others about\n                yourself.\n              </p>\n            ) : (\n              <p className=\\\"user-profile__bio-placeholder\\\">\n                {displayName} hasn&apos;t added a bio yet.\n              </p>\n            )}\n          </div>\n        )}\n      </div>\n\n      {showStats && (\n        <div className=\\\"user-profile__stats\\\">\n          <div className=\\\"user-profile__stat\\\">\n            <span className=\\\"user-profile__stat-number\\\">\n              {user.total_submissions || 0}\n            </span>\n            <span className=\\\"user-profile__stat-label\\\">\n              Total Contributions\n            </span>\n          </div>\n          <div className=\\\"user-profile__stat\\\">\n            <span className=\\\"user-profile__stat-number\\\">\n              {user.posts_count || 0}\n            </span>\n            <span className=\\\"user-profile__stat-label\\\">Posts</span>\n          </div>\n          <div className=\\\"user-profile__stat\\\">\n            <span className=\\\"user-profile__stat-number\\\">\n              {user.replies_count || 0}\n            </span>\n            <span className=\\\"user-profile__stat-label\\\">Replies</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":366,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-header/PageHeader.tsx":{
    "content":"import React from 'react';\nimport './PageHeader.css';\n\nexport default function PageHeader({\n  children\n}: {\n  children: React.ReactNode;\n}) {\n  return <section className=\\\"page-header__section\\\">{children}</section>;\n}\n",
    "language":"typescript",
    "lines":11,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-header/PageHeader.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport PageHeader from './PageHeader';\n\ndescribe('PageHeader', () => {\n  it('renders children correctly', () => {\n    const { getByText } = render(\n      <PageHeader>\n        <div>Test Content</div>\n      </PageHeader>\n    );\n    expect(getByText('Test Content')).toBeInTheDocument();\n  });\n\n  it('has the correct CSS class', () => {\n    const { container } = render(\n      <PageHeader>\n        <div>Test Content</div>\n      </PageHeader>\n    );\n    expect(container.firstChild).toHaveClass('page-header__section');\n  });\n});\n",
    "language":"typescript",
    "lines":23,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/post/CreatePostForm.tsx":{
    "content":"'use client';\nimport { createLogger } from '@/lib/logging';\nimport { useRouter } from 'next/navigation';\nimport { useState } from 'react';\nimport { createPost } from 'src/lib/actions/post.actions';\nimport './CreatePostForm.css';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'CreatePostForm',\n    module: 'components/post'\n  },\n  enabled: false\n});\n\nexport default function CreatePostForm({ subthread }: { subthread: string }) {\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [subThread, setSubthread] = useState('');\n  const router = useRouter();\n  const [error, setError] = useState('');\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    try {\n      const post = await createPost({\n        title,\n        content,\n        subthread: subthread ?? subThread\n      });\n      router.push(`/t/${post.subthread}/comments/${post.id}`);\n    } catch (error) {\n      logger.error('Error creating post', error as Error, {\n        title,\n        subthread: subthread ?? subThread,\n        contentLength: content.length\n      });\n      setError(\n        error instanceof Error\n          ? error.message\n          : 'An error occurred while creating the post'\n      );\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\\\"create-post-form\\\">\n      <div className=\\\"create-post-form__field\\\">\n        <label htmlFor=\\\"title\\\" className=\\\"create-post-form__label\\\">\n          Title\n        </label>\n        <input\n          type=\\\"text\\\"\n          id=\\\"title\\\"\n          name=\\\"title\\\"\n          value={title}\n          onChange={(e) => setTitle(e.target.value)}\n          required\n          className=\\\"create-post-form__input\\\"\n        />\n      </div>\n      <div className=\\\"create-post-form__field\\\">\n        <label htmlFor=\\\"content\\\" className=\\\"create-post-form__label\\\">\n          Content\n        </label>\n        <textarea\n          id=\\\"content\\\"\n          name=\\\"content\\\"\n          value={content}\n          onChange={(e) => setContent(e.target.value)}\n          required\n          className=\\\"create-post-form__textarea\\\"\n        />\n      </div>\n      {!subthread && (\n        <div>\n          <label htmlFor=\\\"subthread\\\" className=\\\"block mb-1\\\">\n            Subthread\n          </label>\n          <input\n            type=\\\"text\\\"\n            id=\\\"subthread\\\"\n            value={subThread}\n            onChange={(e) => setSubthread(e.target.value)}\n            className=\\\"w-full p-2 border rounded\\\"\n            required\n          />\n        </div>\n      )}\n      <button type=\\\"submit\\\" className=\\\"create-post-form__submit\\\">\n        Create Post\n      </button>\n      {error && <p className=\\\"text-red-500\\\">{error}</p>}\n    </form>\n  );\n}\n",
    "language":"typescript",
    "lines":99,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/post/PostItem.tsx":{
    "content":"import { Post } from 'src/lib/schemas/post.schemas';\nimport { InstantLink } from '../ui/InstantLink';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport './PostItem.css';\n\ninterface PostItemProps {\n  post: Post;\n}\n\nexport default function PostItem({ post }: PostItemProps) {\n  return (\n    <li className=\\\"post-item\\\">\n      <div className=\\\"post-item__content\\\">\n        <h2 className=\\\"post-item__title\\\">\n          <InstantLink href={`/t/${post.subthread}/comments/${post.id}`}>\n            {post.title}\n          </InstantLink>\n        </h2>\n        <p className=\\\"post-item__meta\\\">\n          Posted by {post.authorId} in {post.subthread} \u2022&nbsp;\n          <TimestampWithTooltip date={post.createdAt} />\n        </p>\n        <p className=\\\"post-item__description\\\">{post.content}</p>\n      </div>\n    </li>\n  );\n}\n",
    "language":"typescript",
    "lines":28,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/post/PostList.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { getPosts } from 'src/lib/actions/post.actions';\nimport { Post } from 'src/lib/schemas/post.schemas';\nimport PostItem from './PostItem';\n\ninterface PostListProps {\n  subthread?: string;\n}\n\nexport default function PostList({ subthread }: PostListProps) {\n  const [posts, setPosts] = useState<Post[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    async function fetchPosts() {\n      try {\n        const fetchedPosts = await getPosts(subthread);\n        setPosts(fetchedPosts);\n      } catch (error) {\n        console.error('Error fetching posts:', error);\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    if (subthread) {\n      fetchPosts();\n    }\n  }, [subthread]);\n\n  if (loading) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <ul className=\\\"space-y-4\\\">\n      {posts.map((post) => (\n        <PostItem key={post.id} post={post} />\n      ))}\n    </ul>\n  );\n}\n",
    "language":"typescript",
    "lines":45,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/cache-status/CacheStatus.test.tsx":{
    "content":"import { fireEvent, render, screen, waitFor } from '@testing-library/react';\nimport CacheStatus from './CacheStatus';\n\n// Mock MessageChannel for tests\n(global as any).MessageChannel = class MockMessageChannel {\n  port1 = {\n    onmessage: null as ((event: MessageEvent) => void) | null,\n    postMessage: jest.fn()\n  };\n  port2 = {\n    onmessage: null as ((event: MessageEvent) => void) | null,\n    postMessage: jest.fn()\n  };\n};\n\n// Mock the caches API\nconst mockCache = {\n  match: jest.fn(),\n  put: jest.fn(),\n  delete: jest.fn()\n};\n\nconst mockCaches = {\n  open: jest.fn().mockResolvedValue(mockCache)\n};\n\nObject.defineProperty(global, 'caches', {\n  value: mockCaches,\n  writable: true\n});\n\n// Mock navigator.serviceWorker\nconst mockServiceWorker = {\n  controller: {\n    postMessage: jest.fn()\n  }\n};\n\nObject.defineProperty(navigator, 'serviceWorker', {\n  value: mockServiceWorker,\n  writable: true\n});\n\n// Mock location\nconst mockLocation = {\n  pathname: '/',\n  href: 'https://example.com/',\n  reload: jest.fn()\n};\n\nObject.defineProperty(window, 'location', {\n  value: mockLocation,\n  writable: true\n});\n\n// Mock Response with json method\nclass MockResponse {\n  headers: Map<string, string>;\n\n  constructor(body: any, init?: { headers?: Record<string, string> }) {\n    this.headers = new Map();\n    if (init?.headers) {\n      Object.entries(init.headers).forEach(([key, value]) => {\n        this.headers.set(key, value);\n      });\n    }\n  }\n\n  json() {\n    return Promise.resolve({\n      url: '/',\n      timestamp: Date.now(),\n      cachedAt: new Date().toISOString()\n    });\n  }\n\n  get(header: string) {\n    return this.headers.get(header) || null;\n  }\n}\n\ndescribe('CacheStatus', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // Suppress console warnings in tests\n    jest.spyOn(console, 'warn').mockImplementation(() => {});\n    jest.spyOn(console, 'error').mockImplementation(() => {});\n  });\n\n  afterEach(() => {\n    jest.restoreAllMocks();\n  });\n\n  it('should display \\\"Live\\\" when content is not cached', async () => {\n    mockCache.match.mockResolvedValue(null);\n\n    render(<CacheStatus />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Live')).toBeInTheDocument();\n    });\n\n    expect(screen.getByText('\u25cf')).toHaveClass('cache-status__indicator--live');\n  });\n\n  it('should display cache age when content is cached', async () => {\n    const mockResponse = {\n      headers: {\n        get: jest.fn().mockImplementation((header) => {\n          if (header === 'Cache-Timestamp') {\n            return (Date.now() - 60000).toString(); // 1 minute ago\n          }\n          return null;\n        })\n      }\n    };\n\n    mockCache.match.mockResolvedValue(mockResponse);\n\n    render(<CacheStatus />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/Cached/)).toBeInTheDocument();\n    });\n\n    expect(screen.getByText('\u25cf')).toHaveClass(\n      'cache-status__indicator--cached'\n    );\n    expect(\n      screen.getByRole('button', { name: /refresh cache/i })\n    ).toBeInTheDocument();\n  });\n\n  it('should show refresh button when content is cached', async () => {\n    const mockResponse = {\n      headers: {\n        get: jest.fn().mockReturnValue(Date.now().toString())\n      }\n    };\n\n    mockCache.match.mockResolvedValue(mockResponse);\n\n    render(<CacheStatus />);\n\n    await waitFor(() => {\n      const refreshButton = screen.getByRole('button', {\n        name: /refresh cache/i\n      });\n      expect(refreshButton).toBeInTheDocument();\n      expect(refreshButton).toHaveTextContent('\u21bb');\n    });\n  });\n\n  it('should handle refresh button click', async () => {\n    const mockResponse = {\n      headers: {\n        get: jest.fn().mockReturnValue(Date.now().toString())\n      }\n    };\n\n    mockCache.match.mockResolvedValue(mockResponse);\n\n    render(<CacheStatus />);\n\n    await waitFor(() => {\n      const refreshButton = screen.getByRole('button', {\n        name: /refresh cache/i\n      });\n      fireEvent.click(refreshButton);\n      expect(refreshButton).toHaveTextContent('\u27f3');\n    });\n  });\n\n  it('should handle cache check errors gracefully', async () => {\n    mockCache.match.mockRejectedValue(new Error('Cache error'));\n\n    render(<CacheStatus />);\n\n    await waitFor(() => {\n      expect(screen.getByText('Live')).toBeInTheDocument();\n    });\n  });\n\n  it('should format time ago correctly', async () => {\n    const oneHourAgo = Date.now() - 60 * 60 * 1000; // 1 hour ago\n    const mockResponse = {\n      headers: {\n        get: jest.fn().mockImplementation((header) => {\n          if (header === 'Cache-Timestamp') {\n            return oneHourAgo.toString();\n          }\n          return null;\n        })\n      }\n    };\n\n    mockCache.match.mockResolvedValue(mockResponse);\n\n    render(<CacheStatus />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/Cached/)).toBeInTheDocument();\n      expect(screen.getByText(/1h/)).toBeInTheDocument();\n    });\n  });\n\n  it('should fallback to response headers when metadata is not available', async () => {\n    const mockResponse = new MockResponse(null, {\n      headers: {\n        'Cache-Date': new Date().toISOString()\n      }\n    });\n\n    // Mock the metadata cache to return null (no metadata)\n    const mockMetadataCache = {\n      match: jest.fn().mockResolvedValue(null)\n    };\n\n    mockCaches.open.mockImplementation((cacheName) => {\n      if (cacheName === 'idling-app-cache-metadata-v1') {\n        return Promise.resolve(mockMetadataCache);\n      }\n      return Promise.resolve(mockCache);\n    });\n\n    mockCache.match.mockResolvedValue(mockResponse);\n\n    render(<CacheStatus />);\n\n    await waitFor(() => {\n      expect(screen.getByText(/Cached/)).toBeInTheDocument();\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":235,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/cache-status/SmartCacheStatus.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport './CacheStatus.css';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'SmartCacheStatus',\n    module: 'components/cache-status'\n  },\n  enabled: false\n});\n\ninterface CacheInfo {\n  isCached: boolean;\n  cacheTimestamp?: Date;\n  version?: string;\n  cacheVersion?: string;\n  isStale?: boolean;\n  ttl?: number;\n  details?: {\n    serviceWorker: boolean;\n    cacheCount: number;\n    cacheSize: number;\n    localStorageSize: number;\n  };\n}\n\ninterface ServiceWorkerCacheInfo {\n  version: string;\n  totalEntries: number;\n  ttls: {\n    api: number;\n    dynamic: number;\n    static: number;\n    images: number;\n  };\n}\n\ninterface CacheMetadata {\n  timestamp: Date;\n  version?: string;\n  cacheVersion?: string;\n  isStale: boolean;\n  ttl: number;\n}\n\nfunction formatTimeAgo(timestamp: number): string {\n  const now = Date.now();\n  const diff = Math.max(0, now - timestamp); // Ensure non-negative\n\n  const seconds = Math.floor(diff / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n  const days = Math.floor(hours / 24);\n\n  if (days > 0) return `${days}d ago`;\n  if (hours > 0) return `${hours}h ago`;\n  if (minutes > 0) return `${minutes}m ago`;\n  return `${seconds}s ago`;\n}\n\nconst SmartCacheStatus: React.FC = () => {\n  const [cacheInfo, setCacheInfo] = useState<CacheInfo>({ isCached: false });\n  const [swCacheInfo, setSwCacheInfo] = useState<ServiceWorkerCacheInfo | null>(\n    null\n  );\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [isClearing, setIsClearing] = useState(false);\n  const [showDetails, setShowDetails] = useState(false);\n\n  const getCacheMetadata = useCallback(async () => {\n    try {\n      if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {\n        const messageChannel = new MessageChannel();\n\n        const metadataPromise = new Promise<CacheMetadata>(\n          (resolve, reject) => {\n            messageChannel.port1.onmessage = (event) => {\n              if (event.data.success) {\n                resolve(event.data.metadata);\n              } else {\n                reject(new Error(event.data.error));\n              }\n            };\n          }\n        );\n\n        navigator.serviceWorker.controller.postMessage(\n          { type: 'GET_CACHE_METADATA', url: window.location.href },\n          [messageChannel.port2]\n        );\n\n        return await metadataPromise;\n      }\n    } catch (error) {\n      logger.group('getCacheMetadata');\n      logger.warn('Failed to get cache metadata', {\n        error: error instanceof Error ? error.message : String(error),\n        hasServiceWorker: 'serviceWorker' in navigator,\n        hasController: navigator.serviceWorker?.controller !== null\n      });\n      logger.groupEnd();\n      return null;\n    }\n  }, []);\n\n  const getServiceWorkerCacheInfo =\n    useCallback(async (): Promise<ServiceWorkerCacheInfo | null> => {\n      try {\n        if (\n          'serviceWorker' in navigator &&\n          navigator.serviceWorker.controller\n        ) {\n          const messageChannel = new MessageChannel();\n\n          return new Promise((resolve) => {\n            messageChannel.port1.onmessage = (event) => {\n              resolve(event.data);\n            };\n\n            navigator.serviceWorker.controller!.postMessage(\n              { type: 'GET_CACHE_INFO' },\n              [messageChannel.port2]\n            );\n\n            // Timeout after 2 seconds\n            setTimeout(() => resolve(null), 2000);\n          });\n        }\n        return null;\n      } catch (error) {\n        logger.group('getServiceWorkerCacheInfo');\n        logger.warn('Failed to get service worker cache info', {\n          error: error instanceof Error ? error.message : String(error),\n          hasCaches: 'caches' in window\n        });\n        logger.groupEnd();\n        return null;\n      }\n    }, []);\n\n  const checkCacheStatus = useCallback(async () => {\n    try {\n      // Check current page cache metadata\n      const pageMetadata = await getCacheMetadata();\n\n      // Get service worker cache info\n      const swInfo = await getServiceWorkerCacheInfo();\n      setSwCacheInfo(swInfo);\n\n      // Check if service worker is available\n      if ('serviceWorker' in navigator) {\n        const registration = await navigator.serviceWorker.getRegistration();\n        const hasServiceWorker = !!registration;\n\n        // Check cache storage\n        let cacheSize = 0;\n        let cacheCount = 0;\n        let appVersion = 'unknown';\n        let cacheVersion = 'unknown';\n        let currentPageCached = false;\n        let currentPageTimestamp: Date | undefined;\n\n        if ('caches' in window) {\n          try {\n            const cacheNames = await caches.keys();\n            cacheCount = cacheNames.length;\n\n            // Check if current page is cached and get app version info\n            for (const cacheName of cacheNames) {\n              const cache = await caches.open(cacheName);\n              const requests = await cache.keys();\n              cacheSize += requests.length;\n\n              // Check if current page URL is in this cache\n              const currentPageResponse = await cache.match(\n                window.location.href\n              );\n              if (currentPageResponse) {\n                currentPageCached = true;\n                // Try to get timestamp from response headers\n                const cacheTimestamp =\n                  currentPageResponse.headers.get('Cache-Timestamp');\n                const cacheDate = currentPageResponse.headers.get('Cache-Date');\n                const responseDate = currentPageResponse.headers.get('date');\n\n                if (cacheTimestamp) {\n                  currentPageTimestamp = new Date(parseInt(cacheTimestamp));\n                } else if (cacheDate) {\n                  currentPageTimestamp = new Date(cacheDate);\n                } else if (responseDate) {\n                  currentPageTimestamp = new Date(responseDate);\n                }\n              }\n\n              // Try to get version info from any cached response\n              if (requests.length > 0) {\n                const response = await cache.match(requests[0]);\n                if (response) {\n                  appVersion =\n                    response.headers.get('X-App-Version') || appVersion;\n                  cacheVersion =\n                    response.headers.get('SW-Cache-Version') || cacheVersion;\n                }\n              }\n            }\n          } catch (e) {\n            logger.warn('Error checking cache storage', {\n              error: e instanceof Error ? e.message : String(e)\n            });\n          }\n        }\n\n        // Check localStorage size\n        let localStorageSize = 0;\n        try {\n          for (const key in localStorage) {\n            if (Object.prototype.hasOwnProperty.call(localStorage, key)) {\n              localStorageSize += localStorage[key].length + key.length;\n            }\n          }\n        } catch (e) {\n          logger.warn('Error checking localStorage', {\n            error: e instanceof Error ? e.message : String(e)\n          });\n        }\n\n        // Use page metadata if available, otherwise use detected cache info\n        const finalTimestamp = pageMetadata?.timestamp || currentPageTimestamp;\n\n        // Ensure we have a timestamp for cached content - use current time as fallback\n        const isCachedContent =\n          currentPageCached ||\n          hasServiceWorker ||\n          cacheCount > 0 ||\n          localStorageSize > 0;\n        const cacheTimestamp =\n          finalTimestamp || (isCachedContent ? new Date() : undefined);\n\n        const newCacheInfo = {\n          isCached: isCachedContent,\n          cacheTimestamp: cacheTimestamp,\n          version: appVersion,\n          cacheVersion,\n          isStale: pageMetadata?.isStale || false,\n          ttl: pageMetadata?.ttl || 300000, // 5 min default\n          details: {\n            serviceWorker: hasServiceWorker,\n            cacheCount,\n            cacheSize,\n            localStorageSize: Math.round(localStorageSize / 1024) // KB\n          }\n        };\n\n        // Debug logging to help diagnose timestamp issues\n        if (process.env.NODE_ENV === 'development') {\n          logger.group('checkCacheStatus');\n          logger.debug('Cache Status Debug', {\n            isCachedContent,\n            finalTimestamp,\n            cacheTimestamp,\n            currentPageCached,\n            hasServiceWorker,\n            cacheCount,\n            localStorageSize\n          });\n          logger.groupEnd();\n        }\n\n        setCacheInfo(newCacheInfo);\n      }\n    } catch (error) {\n      logger.group('checkCacheStatus');\n      logger.warn('Failed to check cache status', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n      logger.groupEnd();\n      // Set fallback cache info\n      setCacheInfo({\n        isCached: false,\n        version: 'unknown',\n        cacheVersion: 'unknown',\n        ttl: 300000\n      });\n    }\n  }, [getCacheMetadata, getServiceWorkerCacheInfo]);\n\n  /**\n   * Refresh current page cache - equivalent to \\\"Empty cache and hard refresh\\\"\n   */\n  const handleRefreshCurrentPage = async () => {\n    setIsRefreshing(true);\n    try {\n      // Force a hard refresh of the current page\n      window.location.reload();\n    } catch (error) {\n      // Silent error handling\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  /**\n   * Clear all cache - logout user, unregister service workers, clear all caches, and re-register\n   */\n  const handleClearAllCache = async () => {\n    if (isClearing) return;\n\n    setIsClearing(true);\n\n    try {\n      // 1. Clear all browser storage\n      localStorage.clear();\n      sessionStorage.clear();\n\n      // 2. Clear IndexedDB\n      if ('indexedDB' in window) {\n        try {\n          const databases = await indexedDB.databases();\n          await Promise.all(\n            databases.map((db) => {\n              if (db.name) {\n                return new Promise<void>((resolve, reject) => {\n                  const deleteReq = indexedDB.deleteDatabase(db.name!);\n                  deleteReq.onsuccess = () => resolve();\n                  deleteReq.onerror = () => reject(deleteReq.error);\n                });\n              }\n              return Promise.resolve();\n            })\n          );\n        } catch (e) {\n          // Silent error handling\n        }\n      }\n\n      // 3. Clear WebSQL (deprecated but still present in some browsers)\n      if ('webkitStorageInfo' in window) {\n        try {\n          const webkitStorageInfo = (window as any).webkitStorageInfo;\n          if (webkitStorageInfo && webkitStorageInfo.requestQuota) {\n            webkitStorageInfo.requestQuota(\n              0,\n              0,\n              () => {},\n              () => {}\n            );\n          }\n        } catch (e) {\n          // Silent error handling\n        }\n      }\n\n      // 4. Send message to service worker to clear all caches\n      if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {\n        try {\n          const messageChannel = new MessageChannel();\n\n          const clearPromise = new Promise((resolve, reject) => {\n            messageChannel.port1.onmessage = (event) => {\n              if (event.data.success) {\n                resolve(event.data);\n              } else {\n                reject(new Error(event.data.error));\n              }\n            };\n          });\n\n          navigator.serviceWorker.controller.postMessage(\n            { type: 'REFRESH_CACHE' }, // No URL = clear all\n            [messageChannel.port2]\n          );\n\n          await clearPromise;\n        } catch (e) {\n          // Silent error handling\n        }\n      }\n\n      // 5. Unregister ALL service workers\n      if ('serviceWorker' in navigator) {\n        try {\n          const registrations =\n            await navigator.serviceWorker.getRegistrations();\n          await Promise.all(\n            registrations.map((registration) => registration.unregister())\n          );\n        } catch (e) {\n          // Silent error handling\n        }\n      }\n\n      // 6. Clear browser caches if available\n      if ('caches' in window) {\n        try {\n          const cacheNames = await caches.keys();\n          await Promise.all(\n            cacheNames.map((cacheName) => caches.delete(cacheName))\n          );\n        } catch (e) {\n          // Silent error handling\n        }\n      }\n\n      // 7. Re-register service worker with fresh state\n      if ('serviceWorker' in navigator) {\n        try {\n          await navigator.serviceWorker.register('/sw.js', {\n            scope: '/',\n            updateViaCache: 'none'\n          });\n        } catch (e) {\n          // Silent error handling\n        }\n      }\n\n      // 8. Force hard refresh to complete the reset\n      window.location.href = '/';\n    } catch (error) {\n      // Silent error handling\n    } finally {\n      setIsClearing(false);\n    }\n  };\n\n  useEffect(() => {\n    checkCacheStatus();\n\n    // Listen for cache updates\n    const handleCacheUpdate = () => {\n      checkCacheStatus();\n    };\n\n    window.addEventListener('cache-updated', handleCacheUpdate);\n\n    return () => {\n      window.removeEventListener('cache-updated', handleCacheUpdate);\n    };\n  }, []); // Remove checkCacheStatus dependency to prevent infinite loop\n\n  const getCacheStatusColor = () => {\n    if (!cacheInfo.isCached) return 'cache-status__indicator--live';\n    if (cacheInfo.isStale) return 'cache-status__indicator--stale';\n    return 'cache-status__indicator--cached';\n  };\n\n  const getCacheStatusText = () => {\n    if (!cacheInfo.isCached) return 'Live';\n\n    // If we have cache storage but no specific page cache timestamp, show general cache status\n    if (!cacheInfo.cacheTimestamp) {\n      return 'Cached';\n    }\n\n    // Use the abbreviated timestamp component for compact footer display\n    return (\n      <span\n        style={{ display: 'inline-flex', alignItems: 'center', gap: '0.25rem' }}\n      >\n        Cached{' '}\n        <TimestampWithTooltip date={cacheInfo.cacheTimestamp} abbreviated />\n      </span>\n    );\n  };\n\n  return (\n    <div className=\\\"cache-status\\\">\n      <span className={`cache-status__indicator ${getCacheStatusColor()}`}>\n        \u25cf\n      </span>\n      <span\n        className=\\\"cache-status__text\\\"\n        onClick={() => setShowDetails(!showDetails)}\n        style={{ cursor: 'pointer' }}\n        title=\\\"Click for cache details\\\"\n      >\n        {getCacheStatusText()}\n      </span>\n\n      <button\n        className=\\\"cache-status__refresh\\\"\n        onClick={handleRefreshCurrentPage}\n        disabled={isRefreshing || isClearing}\n        title=\\\"Refresh current page cache (hard refresh)\\\"\n        aria-label=\\\"Empty cache and hard refresh current page\\\"\n      >\n        {isRefreshing ? '\u27f3' : '\u21bb'}\n      </button>\n\n      <button\n        className=\\\"cache-status__refresh\\\"\n        onClick={handleClearAllCache}\n        disabled={isRefreshing || isClearing}\n        title=\\\"Logout user, clear all site data (cache, storage, cookies), and restart service workers\\\"\n        aria-label=\\\"Complete logout and clear all site data\\\"\n        style={{ marginLeft: '4px' }}\n      >\n        {isClearing ? '\u27f3' : '\ud83e\uddf9'}\n      </button>\n\n      {showDetails && (cacheInfo.isCached || swCacheInfo) && (\n        <div className=\\\"cache-status__details\\\">\n          <div className=\\\"cache-status__detail-item\\\">\n            <strong>Page Cache:</strong>\n            <div>Version: {cacheInfo.version || 'unknown'}</div>\n            <div>Cache Version: {cacheInfo.cacheVersion || 'unknown'}</div>\n            <div>\n              TTL: {cacheInfo.ttl ? Math.round(cacheInfo.ttl / 1000 / 60) : '?'}{' '}\n              min\n            </div>\n            <div>Status: {cacheInfo.isStale ? '\u26a0\ufe0f Stale' : '\u2705 Fresh'}</div>\n            {cacheInfo.cacheTimestamp && (\n              <div>\n                Last cached:{' '}\n                <TimestampWithTooltip date={cacheInfo.cacheTimestamp} />\n              </div>\n            )}\n          </div>\n\n          {swCacheInfo && (\n            <div className=\\\"cache-status__detail-item\\\">\n              <strong>Service Worker:</strong>\n              <div>Cache Version: {swCacheInfo.version}</div>\n              <div>Total Entries: {swCacheInfo.totalEntries}</div>\n              <div>\n                TTLs: API {Math.round(swCacheInfo.ttls.api / 1000 / 60)}m,\n                Dynamic {Math.round(swCacheInfo.ttls.dynamic / 1000 / 60)}m\n              </div>\n            </div>\n          )}\n\n          {cacheInfo.details && (\n            <div className=\\\"cache-status__detail-item\\\">\n              <strong>Storage Details:</strong>\n              <div>Cache Count: {cacheInfo.details.cacheCount}</div>\n              <div>Cache Size: {cacheInfo.details.cacheSize} entries</div>\n              <div>LocalStorage: {cacheInfo.details.localStorageSize} KB</div>\n              <div>\n                Service Worker:{' '}\n                {cacheInfo.details.serviceWorker ? '\u2705 Active' : '\u274c Inactive'}\n              </div>\n            </div>\n          )}\n\n          <div className=\\\"cache-status__detail-item\\\">\n            <strong>Actions:</strong>\n            <div>\u21bb Hard refresh current page</div>\n            <div>\ud83e\uddf9 Logout + clear all + restart SW</div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SmartCacheStatus;\n",
    "language":"typescript",
    "lines":561,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/cache-status/NoCacheStatus.tsx":{
    "content":"'use client';\n\n/* eslint-disable no-console */\nimport { signOut } from 'next-auth/react';\nimport React, { useState } from 'react';\nimport './CacheStatus.css';\n\nconst NoCacheStatus: React.FC = () => {\n  const [isClearing, setIsClearing] = useState(false);\n\n  const clearAllCaches = async () => {\n    if (isClearing) return;\n\n    setIsClearing(true);\n    console.log(\n      '\ud83e\uddf9 Clearing ALL site data, logging out user, and restarting service workers...'\n    );\n\n    try {\n      // Step 1: Logout user properly (server + client + JWT + cookies)\n      console.log('\ud83d\udeaa Logging out user...');\n      try {\n        await signOut({\n          redirect: false, // Don't redirect, we'll handle the refresh manually\n          callbackUrl: '/' // Set callback URL for after refresh\n        });\n        console.log('\u2705 User logged out from NextAuth');\n      } catch (error) {\n        console.warn(\n          '\u26a0\ufe0f NextAuth logout failed, continuing with cache clear:',\n          error\n        );\n      }\n\n      // Step 2: Get storage estimate before clearing (for logging)\n      let storageBeforeClear = null;\n      if ('storage' in navigator && 'estimate' in navigator.storage) {\n        try {\n          storageBeforeClear = await navigator.storage.estimate();\n          const usedMB =\n            Math.round(((storageBeforeClear.usage || 0) / 1024 / 1024) * 100) /\n            100;\n          const quotaMB =\n            Math.round(((storageBeforeClear.quota || 0) / 1024 / 1024) * 100) /\n            100;\n          console.log(\n            `\ud83d\udcca Storage before clear: ${usedMB}MB used of ${quotaMB}MB available`\n          );\n        } catch (e) {\n          console.log('\u2139\ufe0f Could not get storage estimate');\n        }\n      }\n\n      // Step 3: Clear site data using modern Storage API (if available)\n      if ('storage' in navigator && 'persist' in navigator.storage) {\n        try {\n          // Request persistent storage (helps with clearing)\n          await navigator.storage.persist();\n          console.log('\u2705 Storage persistence requested');\n        } catch (e) {\n          console.log('\u2139\ufe0f Storage persistence not available');\n        }\n      }\n\n      // Step 4: Unregister all service workers\n      if ('serviceWorker' in navigator) {\n        const registrations = await navigator.serviceWorker.getRegistrations();\n        for (let registration of registrations) {\n          await registration.unregister();\n          console.log('\u2705 Service worker unregistered');\n        }\n      }\n\n      // Step 5: Clear all cache storage\n      if ('caches' in window) {\n        const cacheNames = await caches.keys();\n        await Promise.all(\n          cacheNames.map((cacheName) => {\n            console.log(`\ud83d\uddd1\ufe0f Deleting cache: ${cacheName}`);\n            return caches.delete(cacheName);\n          })\n        );\n        console.log('\u2705 All cache storage cleared');\n      }\n\n      // Step 6: Clear ALL application storage (including auth data)\n      console.log('\ud83d\uddd1\ufe0f Clearing ALL application storage...');\n\n      // Clear localStorage completely (including auth tokens)\n      localStorage.clear();\n      console.log('\u2705 localStorage cleared completely');\n\n      // Clear sessionStorage completely\n      sessionStorage.clear();\n      console.log('\u2705 sessionStorage cleared');\n\n      // Step 7: Clear all cookies (auth-related and others)\n      if (typeof document !== 'undefined') {\n        const cookies = document.cookie.split(';');\n        for (let cookie of cookies) {\n          const eqPos = cookie.indexOf('=');\n          const name =\n            eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();\n          // Clear cookie for current domain and all possible paths\n          document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;\n          document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=${window.location.hostname}`;\n          document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.${window.location.hostname}`;\n        }\n        console.log('\u2705 All cookies cleared');\n      }\n\n      // Step 8: Clear IndexedDB completely\n      if ('indexedDB' in window) {\n        try {\n          const databases = await indexedDB.databases();\n          await Promise.all(\n            databases.map((db) => {\n              if (db.name) {\n                return new Promise((resolve, reject) => {\n                  const deleteReq = indexedDB.deleteDatabase(db.name!);\n                  deleteReq.onsuccess = () => {\n                    console.log(`\u2705 IndexedDB ${db.name} cleared`);\n                    resolve(undefined);\n                  };\n                  deleteReq.onerror = () => reject(deleteReq.error);\n                });\n              }\n              return Promise.resolve();\n            })\n          );\n        } catch (e) {\n          console.log(\n            '\u2139\ufe0f IndexedDB clearing not supported or no databases found'\n          );\n        }\n      }\n\n      // Step 9: Clear WebSQL (if supported - deprecated but still present in some browsers)\n      if ('webkitStorageInfo' in window) {\n        try {\n          const webkitStorageInfo = (window as any).webkitStorageInfo;\n          if (webkitStorageInfo && webkitStorageInfo.requestQuota) {\n            console.log('\ud83d\uddd1\ufe0f Attempting to clear WebSQL...');\n            webkitStorageInfo.requestQuota(\n              0,\n              0,\n              () => {\n                console.log('\u2705 WebSQL cleared');\n              },\n              () => {\n                console.log('\u2139\ufe0f WebSQL clearing failed or not supported');\n              }\n            );\n          }\n        } catch (e) {\n          console.log('\u2139\ufe0f WebSQL not available');\n        }\n      }\n\n      // Step 10: Clear Application Cache (if supported - deprecated but still present)\n      if ('applicationCache' in window && window.applicationCache) {\n        try {\n          (window.applicationCache as any).update();\n          console.log('\u2705 Application cache updated');\n        } catch (e) {\n          console.log('\u2139\ufe0f Application cache not available');\n        }\n      }\n\n      console.log(\n        '\ud83c\udf89 All site data and user session cleared! Re-registering service worker...'\n      );\n\n      // Step 11: Re-register service worker with better error handling\n      if ('serviceWorker' in navigator) {\n        try {\n          // Clear any existing service worker controller\n          if (navigator.serviceWorker.controller) {\n            navigator.serviceWorker.controller.postMessage({\n              type: 'SKIP_WAITING'\n            });\n          }\n\n          const registration = await navigator.serviceWorker.register(\n            '/sw.js',\n            {\n              scope: '/',\n              updateViaCache: 'none' // Ensure fresh service worker\n            }\n          );\n          console.log('\u2705 Service worker re-registered:', registration.scope);\n\n          // Wait for the new service worker to be ready\n          await new Promise((resolve) => {\n            if (registration.active) {\n              resolve(undefined);\n            } else {\n              registration.addEventListener('statechange', () => {\n                if (registration.active) {\n                  resolve(undefined);\n                }\n              });\n            }\n          });\n        } catch (error) {\n          console.warn('\u26a0\ufe0f Failed to re-register service worker:', error);\n          console.log(\n            '\u2139\ufe0f This may be due to redirect issues - will continue with refresh'\n          );\n        }\n      }\n\n      // Step 12: Get storage estimate after clearing (for verification)\n      if ('storage' in navigator && 'estimate' in navigator.storage) {\n        try {\n          const storageAfterClear = await navigator.storage.estimate();\n          const usedAfterMB =\n            Math.round(((storageAfterClear.usage || 0) / 1024 / 1024) * 100) /\n            100;\n          const quotaAfterMB =\n            Math.round(((storageAfterClear.quota || 0) / 1024 / 1024) * 100) /\n            100;\n          console.log(\n            `\ud83d\udcca Storage after clear: ${usedAfterMB}MB used of ${quotaAfterMB}MB available`\n          );\n\n          if (\n            storageBeforeClear &&\n            storageAfterClear.usage !== undefined &&\n            storageBeforeClear.usage !== undefined\n          ) {\n            const clearedMB =\n              Math.round(\n                ((storageBeforeClear.usage - storageAfterClear.usage) /\n                  1024 /\n                  1024) *\n                  100\n              ) / 100;\n            console.log(`\ud83d\uddd1\ufe0f Successfully cleared ${clearedMB}MB of site data`);\n          }\n        } catch (e) {\n          console.log('\u2139\ufe0f Could not verify storage clearing');\n        }\n      }\n\n      // Step 13: Perform hard refresh to complete logout and restart\n      setTimeout(() => {\n        console.log(\n          '\ud83d\udd04 Performing final hard refresh with complete session reset...'\n        );\n        // Use replace to avoid back button issues and ensure clean state\n        window.location.replace('/');\n      }, 1000);\n    } catch (error) {\n      console.error(\n        '\u274c Error during complete site data and session clear:',\n        error\n      );\n      // Fallback: force hard refresh to home page anyway\n      setTimeout(() => {\n        window.location.replace('/');\n      }, 1000);\n    } finally {\n      setIsClearing(false);\n    }\n  };\n\n  return (\n    <div className=\\\"cache-status\\\">\n      <span className=\\\"cache-status__indicator cache-status__indicator--live\\\">\n        \u25cf\n      </span>\n      <span className=\\\"cache-status__text\\\">No Cache</span>\n      <button\n        className=\\\"cache-status__refresh\\\"\n        onClick={clearAllCaches}\n        disabled={isClearing}\n        title=\\\"Logout user, clear all site data (cache, storage, cookies), and re-register service workers\\\"\n        aria-label=\\\"Complete logout and clear all site data\\\"\n      >\n        {isClearing ? '\u27f3' : '\ud83e\uddf9'}\n      </button>\n    </div>\n  );\n};\n\nexport default NoCacheStatus;\n",
    "language":"typescript",
    "lines":288,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/cache-status/CacheStatus.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport './CacheStatus.css';\n\ninterface CacheInfo {\n  isCached: boolean;\n  cacheTimestamp?: Date;\n  cacheAge?: string;\n  version?: string;\n  cacheVersion?: string;\n  details?: {\n    serviceWorker: boolean;\n    cacheCount: number;\n    cacheSize: number;\n    localStorageSize: number;\n  };\n}\n\nconst formatTimeAgo = (timestamp: Date): string => {\n  const now = Date.now();\n  const then = timestamp.getTime();\n  if (then > now) return '0s ago';\n\n  let remaining = now - then;\n\n  const years = Math.floor(remaining / (365 * 24 * 60 * 60 * 1000));\n  remaining -= years * 365 * 24 * 60 * 60 * 1000;\n\n  const months = Math.floor(remaining / (30 * 24 * 60 * 60 * 1000));\n  remaining -= months * 30 * 24 * 60 * 60 * 1000;\n\n  const weeks = Math.floor(remaining / (7 * 24 * 60 * 60 * 1000));\n  remaining -= weeks * 7 * 24 * 60 * 60 * 1000;\n\n  const days = Math.floor(remaining / (24 * 60 * 60 * 1000));\n  remaining -= days * 24 * 60 * 60 * 1000;\n\n  const hours = Math.floor(remaining / (60 * 60 * 1000));\n  remaining -= hours * 60 * 60 * 1000;\n\n  const minutes = Math.floor(remaining / (60 * 1000));\n  remaining -= minutes * 60 * 1000;\n\n  const seconds = Math.floor(remaining / 1000);\n\n  const parts: string[] = [];\n  if (years) parts.push(`${years}y`);\n  if (months) parts.push(`${months}mo`);\n  if (weeks) parts.push(`${weeks}w`);\n  if (days) parts.push(`${days}d`);\n  if (hours) parts.push(`${hours}h`);\n  if (minutes) parts.push(`${minutes}m`);\n  if (seconds || parts.length === 0) parts.push(`${seconds}s`);\n\n  return parts.slice(0, 2).join(' ') + ' ago';\n};\n\nconst CacheStatus: React.FC = () => {\n  const [cacheInfo, setCacheInfo] = useState<CacheInfo>({ isCached: false });\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [showDetails, setShowDetails] = useState(false);\n\n  const getCacheMetadata = async (url: string) => {\n    try {\n      if ('caches' in window) {\n        const metadataCache = await caches.open('idling-app-cache-metadata-v1');\n        const metadataResponse = await metadataCache.match(`metadata-${url}`);\n\n        if (metadataResponse) {\n          const metadata = await metadataResponse.json();\n          return {\n            timestamp: new Date(metadata.cachedAt),\n            originalTimestamp: metadata.timestamp\n          };\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to get cache metadata:', error);\n    }\n    return null;\n  };\n\n  const checkCacheStatus = async () => {\n    try {\n      if ('caches' in window) {\n        const cache = await caches.open('idling-app-cache-v1');\n        const cachedResponse = await cache.match(window.location.pathname);\n\n        if (cachedResponse) {\n          // Try to get timestamp from enhanced metadata first\n          const metadata = await getCacheMetadata(window.location.pathname);\n          let timestamp: Date;\n\n          if (metadata) {\n            timestamp = metadata.timestamp;\n          } else {\n            // Fallback to response headers\n            const cacheTimestampHeader =\n              cachedResponse.headers.get('Cache-Timestamp');\n            const cacheDateHeader = cachedResponse.headers.get('Cache-Date');\n\n            if (cacheTimestampHeader) {\n              timestamp = new Date(parseInt(cacheTimestampHeader));\n            } else if (cacheDateHeader) {\n              timestamp = new Date(cacheDateHeader);\n            } else {\n              // Last fallback to response date header\n              const responseDate = cachedResponse.headers.get('date');\n              timestamp = responseDate ? new Date(responseDate) : new Date();\n            }\n          }\n\n          // Get additional cache details\n          let cacheCount = 0;\n          let cacheSize = 0;\n          let appVersion = 'unknown';\n          let cacheVersion = 'unknown';\n          let hasServiceWorker = false;\n\n          try {\n            // Check service worker status\n            if ('serviceWorker' in navigator) {\n              const registration =\n                await navigator.serviceWorker.getRegistration();\n              hasServiceWorker = !!registration;\n            }\n\n            // Get cache storage info\n            const cacheNames = await caches.keys();\n            cacheCount = cacheNames.length;\n\n            for (const cacheName of cacheNames) {\n              const cache = await caches.open(cacheName);\n              const requests = await cache.keys();\n              cacheSize += requests.length;\n\n              // Try to get version info from any cached response\n              if (requests.length > 0) {\n                const response = await cache.match(requests[0]);\n                if (response) {\n                  appVersion =\n                    response.headers.get('X-App-Version') || appVersion;\n                  cacheVersion =\n                    response.headers.get('SW-Cache-Version') || cacheVersion;\n                }\n              }\n            }\n          } catch (e) {\n            console.warn('Error getting cache details:', e);\n          }\n\n          // Check localStorage size\n          let localStorageSize = 0;\n          try {\n            for (const key in localStorage) {\n              if (Object.prototype.hasOwnProperty.call(localStorage, key)) {\n                localStorageSize += localStorage[key].length + key.length;\n              }\n            }\n          } catch (e) {\n            console.warn('Error checking localStorage:', e);\n          }\n\n          setCacheInfo({\n            isCached: true,\n            cacheTimestamp: timestamp,\n            cacheAge: formatTimeAgo(timestamp),\n            version: appVersion,\n            cacheVersion,\n            details: {\n              serviceWorker: hasServiceWorker,\n              cacheCount,\n              cacheSize,\n              localStorageSize: Math.round(localStorageSize / 1024) // KB\n            }\n          });\n        } else {\n          setCacheInfo({ isCached: false });\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to check cache status:', error);\n      setCacheInfo({ isCached: false });\n    }\n  };\n\n  const refreshCache = async () => {\n    if (isRefreshing) return;\n\n    setIsRefreshing(true);\n\n    try {\n      if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {\n        // Use service worker messaging for more reliable cache refresh\n        const messageChannel = new MessageChannel();\n\n        const refreshPromise = new Promise((resolve, reject) => {\n          messageChannel.port1.onmessage = (event) => {\n            if (event.data.success) {\n              resolve(event.data);\n            } else {\n              reject(new Error(event.data.error));\n            }\n          };\n        });\n\n        navigator.serviceWorker.controller.postMessage(\n          {\n            type: 'REFRESH_CACHE',\n            url: window.location.href\n          },\n          [messageChannel.port2]\n        );\n\n        await refreshPromise;\n\n        // Update cache info after successful refresh\n        await checkCacheStatus();\n\n        // Dispatch event to notify other components\n        window.dispatchEvent(new CustomEvent('cache-updated'));\n\n        // Small delay to show the updated cache status before reload\n        setTimeout(() => {\n          window.location.reload();\n        }, 500);\n      } else {\n        // Fallback to manual cache refresh\n        const response = await fetch(window.location.href, {\n          cache: 'no-cache',\n          headers: {\n            'Cache-Control': 'no-cache, no-store, must-revalidate'\n          }\n        });\n\n        if (response.ok) {\n          // Update cache status to show it's now fresh\n          await checkCacheStatus();\n\n          // Dispatch event to notify other components\n          window.dispatchEvent(new CustomEvent('cache-updated'));\n\n          // Small delay to show the updated status\n          setTimeout(() => {\n            window.location.reload();\n          }, 500);\n        }\n      }\n    } catch (error) {\n      console.error('Failed to refresh cache:', error);\n      // Fallback: hard reload\n      window.location.reload();\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  useEffect(() => {\n    checkCacheStatus();\n\n    // Listen for cache updates from service worker or other sources\n    const handleCacheUpdate = () => {\n      checkCacheStatus();\n    };\n\n    window.addEventListener('cache-updated', handleCacheUpdate);\n\n    return () => {\n      window.removeEventListener('cache-updated', handleCacheUpdate);\n    };\n  }, []); // Run once on mount\n\n  useEffect(() => {\n    // Update cache age every 30 seconds\n    const interval = setInterval(() => {\n      if (cacheInfo.isCached && cacheInfo.cacheTimestamp) {\n        setCacheInfo((prev) => ({\n          ...prev,\n          cacheAge: formatTimeAgo(prev.cacheTimestamp!)\n        }));\n      }\n    }, 30000);\n\n    return () => clearInterval(interval);\n  }, [cacheInfo.isCached, cacheInfo.cacheTimestamp]);\n\n  const getCacheStatusText = () => {\n    if (!cacheInfo.isCached) return 'Live';\n\n    // If we have cache storage but no specific page cache timestamp, show general cache status\n    if (!cacheInfo.cacheTimestamp) {\n      return 'Cached';\n    }\n\n    // Use the abbreviated timestamp component for compact footer display\n    return (\n      <span\n        style={{ display: 'inline-flex', alignItems: 'center', gap: '0.25rem' }}\n      >\n        Cached{' '}\n        <TimestampWithTooltip date={cacheInfo.cacheTimestamp} abbreviated />\n      </span>\n    );\n  };\n\n  if (!cacheInfo.isCached) {\n    return (\n      <div className=\\\"cache-status\\\">\n        <span className=\\\"cache-status__indicator cache-status__indicator--live\\\">\n          \u25cf\n        </span>\n        <span className=\\\"cache-status__text\\\">Live</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\\\"cache-status\\\">\n      <span className=\\\"cache-status__indicator cache-status__indicator--cached\\\">\n        \u25cf\n      </span>\n      <span\n        className=\\\"cache-status__text\\\"\n        onClick={() => setShowDetails(!showDetails)}\n        style={{ cursor: 'pointer' }}\n        title=\\\"Click for cache details\\\"\n      >\n        {getCacheStatusText()}\n      </span>\n      <button\n        className=\\\"cache-status__refresh\\\"\n        onClick={refreshCache}\n        disabled={isRefreshing}\n        title=\\\"Refresh to latest version\\\"\n        aria-label=\\\"Refresh cache to get latest version\\\"\n      >\n        {isRefreshing ? '\u27f3' : '\u21bb'}\n      </button>\n\n      {showDetails && cacheInfo.isCached && (\n        <div className=\\\"cache-status__details\\\">\n          <div className=\\\"cache-status__detail-item\\\">\n            <strong>Page Cache:</strong>\n            <div>Version: {cacheInfo.version || 'unknown'}</div>\n            <div>Cache Version: {cacheInfo.cacheVersion || 'unknown'}</div>\n            {cacheInfo.cacheTimestamp && (\n              <div>\n                Last cached:{' '}\n                <TimestampWithTooltip date={cacheInfo.cacheTimestamp} />\n              </div>\n            )}\n          </div>\n\n          {cacheInfo.details && (\n            <div className=\\\"cache-status__detail-item\\\">\n              <strong>Storage Details:</strong>\n              <div>Cache Count: {cacheInfo.details.cacheCount}</div>\n              <div>Cache Size: {cacheInfo.details.cacheSize} entries</div>\n              <div>LocalStorage: {cacheInfo.details.localStorageSize} KB</div>\n              <div>\n                Service Worker:{' '}\n                {cacheInfo.details.serviceWorker ? '\u2705 Active' : '\u274c Inactive'}\n              </div>\n            </div>\n          )}\n\n          <div className=\\\"cache-status__detail-item\\\">\n            <strong>Actions:</strong>\n            <div>\u21bb Refresh to latest version</div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CacheStatus;\n",
    "language":"typescript",
    "lines":380,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/gitlab-link/GitLabLink.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { GitLabLink } from './GitLabLink';\nimport { GITLAB_LINK_TEST_IDS } from './gitlab-link-test-ids';\n\ndescribe('GitLab Link', () => {\n  it('renders the GitLab link', () => {\n    render(<GitLabLink />);\n\n    screen.findByRole('heading');\n\n    expect(screen.getByTestId(GITLAB_LINK_TEST_IDS.LINK))\n      .toBeVisible()\n      .toBeEnabled()\n      .toHaveAttribute('href', 'https://gitlab.com/underwood_inc/idling-app')\n      .toHaveAttribute('target', '_blank');\n  });\n});\n",
    "language":"typescript",
    "lines":18,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/gitlab-link/GitLabLink.tsx":{
    "content":"import React from 'react';\nimport { GITLAB_LINK_TEST_IDS } from './gitlab-link-test-ids';\n\nexport const GitLabLink: React.FC = () => {\n  return (\n    <a\n      data-testid={GITLAB_LINK_TEST_IDS.LINK}\n      href=\\\"https://gitlab.com/underwood_inc/idling-app\\\"\n      target=\\\"_blank\\\"\n      rel=\\\"noopener noreferrer\\\"\n      className=\\\"text-[#8B5A2B] hover:text-[#A67B5B] underline\\\"\n    >\n      GitLab\n    </a>\n  );\n};\n",
    "language":"typescript",
    "lines":17,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/floating-add-post/FloatingAddPost.tsx":{
    "content":"'use client';\n\nimport { useAtom } from 'jotai';\nimport { useSession } from 'next-auth/react';\nimport React, { useEffect } from 'react';\nimport { GiQuill } from 'react-icons/gi';\nimport { CONTEXT_IDS } from '../../../lib/context-ids';\nimport { useOverlay } from '../../../lib/context/OverlayContext';\nimport { shouldUpdateAtom } from '../../../lib/state/atoms';\nimport { SharedSubmissionForm } from '../submission-forms/shared-submission-form/SharedSubmissionForm';\nimport './FloatingAddPost.css';\n\ninterface FloatingAddPostProps {\n  onPostCreated?: (result?: {\n    status: number;\n    message?: string;\n    error?: string;\n    submission?: any;\n  }) => void;\n  externalTrigger?: boolean;\n  onTriggerHandled?: () => void;\n}\n\nconst AddPostModalContent: React.FC<{ onClose?: () => void }> = ({\n  onClose\n}) => {\n  const [, setShouldUpdate] = useAtom(shouldUpdateAtom);\n\n  const handleSuccess = (result?: {\n    status: number;\n    message?: string;\n    error?: string;\n    submission?: any;\n  }) => {\n    // Trigger global refresh\n    setShouldUpdate(true);\n    onClose?.();\n  };\n\n  return (\n    <div className=\\\"floating-add-post__modal-content\\\">\n      <div className=\\\"floating-add-post__header\\\">\n        <h2 className=\\\"floating-add-post__title\\\">\u2728 Share Something New</h2>\n      </div>\n      <SharedSubmissionForm\n        mode=\\\"create\\\"\n        onSuccess={handleSuccess}\n        contextId={CONTEXT_IDS.POSTS.toString()}\n      />\n    </div>\n  );\n};\n\nconst FloatingAddPost: React.FC<FloatingAddPostProps> = ({\n  onPostCreated,\n  externalTrigger = false,\n  onTriggerHandled\n}) => {\n  const { data: session } = useSession();\n  const { openOverlay, closeOverlay } = useOverlay();\n  const isAuthorized = !!session?.user;\n\n  const modalId = 'floating-add-post-modal';\n\n  // Handle external trigger\n  useEffect(() => {\n    if (externalTrigger && isAuthorized) {\n      handleOpenModal();\n      onTriggerHandled?.();\n    }\n  }, [externalTrigger, isAuthorized, onTriggerHandled]);\n\n  const handleOpenModal = () => {\n    if (isAuthorized) {\n      openOverlay({\n        id: modalId,\n        type: 'modal',\n        component: AddPostModalContent,\n        props: {\n          onClose: () => {\n            closeOverlay(modalId);\n            onPostCreated?.();\n          }\n        }\n      });\n    }\n  };\n\n  // Don't render if not authorized\n  if (!isAuthorized) {\n    return null;\n  }\n\n  return (\n    <button\n      className=\\\"floating-add-post__button\\\"\n      onClick={handleOpenModal}\n      aria-label=\\\"Create new post\\\"\n      title=\\\"Create new post\\\"\n    >\n      <GiQuill className=\\\"floating-add-post__icon\\\" />\n    </button>\n  );\n};\n\nexport default FloatingAddPost;\n",
    "language":"typescript",
    "lines":107,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/author/Author.tsx":{
    "content":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport React, { useEffect, useState } from 'react';\nimport { useOverlay } from '../../../lib/context/OverlayContext';\nimport { Avatar, AvatarPropSizes } from '../avatar/Avatar';\nimport { InteractiveTooltip } from '../tooltip/InteractiveTooltip';\nimport { InstantLink } from '../ui/InstantLink';\nimport { UserProfile, UserProfileData } from '../user-profile/UserProfile';\nimport './Author.css';\n\nexport interface AuthorProps {\n  authorId: string;\n  authorName: string;\n  size?: AvatarPropSizes;\n  showFullName?: boolean;\n  onClick?: (authorId: string) => void;\n  className?: string;\n  enableTooltip?: boolean;\n  bio?: string | null; // Optional bio data to avoid API call\n}\n\n// Enhanced User Profile Modal Component\nconst UserProfileModal: React.FC<{\n  user: UserProfileData;\n  onClose: () => void;\n}> = ({ user, onClose }) => {\n  const { data: session } = useSession();\n  const [isOwnProfile, setIsOwnProfile] = useState(false);\n\n  useEffect(() => {\n    // Check if this matches the current user\n    if (session?.user) {\n      const currentUserId = session.user.id;\n\n      // Convert both IDs to strings for proper comparison\n      const isOwner = currentUserId?.toString() === user.id?.toString();\n\n      setIsOwnProfile(Boolean(isOwner));\n    } else {\n      setIsOwnProfile(false);\n    }\n  }, [user, session]);\n\n  const handleBioUpdate = async (newBio: string): Promise<void> => {\n    try {\n      // Use the same server action as the profile page for consistency\n      const { updateBioAction } = await import(\n        '../../../lib/actions/profile.actions'\n      );\n\n      // \u2705 CRITICAL: Use database ID only for bio updates (after migration 0011)\n      // This ensures bio updates work reliably regardless of username changes\n      const identifier = user.id;\n\n      const result = await updateBioAction(newBio, identifier);\n\n      if (!result.success) {\n        throw new Error(result.error || 'Failed to update bio');\n      }\n\n      // Update the user object locally for immediate UI feedback\n      user.bio = newBio;\n\n      // Success - bio updated (no return value needed)\n      // Note: Profile page cache is invalidated by the server action\n    } catch (error) {\n      console.error('Error updating bio:', error);\n      throw error;\n    }\n  };\n\n  return (\n    <div className=\\\"user-profile-modal\\\">\n      <div className=\\\"user-profile-modal__header\\\">\n        <h2 className=\\\"user-profile-modal__title\\\">\n          {user.username || user.name || 'User Profile'}\n        </h2>\n        <button\n          className=\\\"user-profile-modal__close\\\"\n          onClick={onClose}\n          aria-label=\\\"Close modal\\\"\n        >\n          \u00d7\n        </button>\n      </div>\n      <div className=\\\"user-profile-modal__content\\\">\n        <UserProfile\n          user={user}\n          variant=\\\"tooltip\\\"\n          showStats={true}\n          isOwnProfile={isOwnProfile}\n          onBioUpdate={isOwnProfile ? handleBioUpdate : undefined}\n          className=\\\"user-profile-modal__profile\\\"\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced User Profile Tooltip Component\nconst UserProfileTooltipContent: React.FC<{\n  user: UserProfileData;\n  onViewProfile: () => void;\n  onViewInModal: () => void;\n}> = ({ user, onViewProfile, onViewInModal }) => {\n  const displayName = user.username || user.name || 'Anonymous';\n  const joinDate = user.created_at\n    ? new Date(user.created_at).toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'long'\n      })\n    : null;\n\n  return (\n    <div className=\\\"author-tooltip\\\">\n      <div className=\\\"author-tooltip__content\\\">\n        <div className=\\\"author-tooltip__header\\\">\n          <div>\n            <Avatar seed={user.id} size=\\\"sm\\\" />\n          </div>\n          <div className=\\\"author-tooltip__header-info\\\">\n            <h4 className=\\\"author-tooltip__name\\\">{displayName}</h4>\n            {user.location && (\n              <p className=\\\"author-tooltip__location\\\">\ud83d\udccd {user.location}</p>\n            )}\n            {joinDate && (\n              <div className=\\\"author-tooltip__footer\\\">\n                <span className=\\\"author-tooltip__join-date\\\">\n                  Joined {joinDate}\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n        {user.bio && (\n          <div className=\\\"author-tooltip__bio\\\">\n            <p>{user.bio}</p>\n          </div>\n        )}\n\n        {(user.total_submissions !== undefined ||\n          user.posts_count !== undefined ||\n          user.replies_count !== undefined) && (\n          <div className=\\\"author-tooltip__stats\\\">\n            <div className=\\\"author-tooltip__stat\\\">\n              <span className=\\\"author-tooltip__stat-number\\\">\n                {user.posts_count || 0}\n              </span>\n              <span className=\\\"author-tooltip__stat-label\\\">Posts</span>\n            </div>\n            <div className=\\\"author-tooltip__stat\\\">\n              <span className=\\\"author-tooltip__stat-number\\\">\n                {user.replies_count || 0}\n              </span>\n              <span className=\\\"author-tooltip__stat-label\\\">Replies</span>\n            </div>\n            <div className=\\\"author-tooltip__stat\\\">\n              <span className=\\\"author-tooltip__stat-number\\\">\n                {user.total_submissions || 0}\n              </span>\n              <span className=\\\"author-tooltip__stat-label\\\">Total</span>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className=\\\"author-tooltip__actions\\\">\n        <button\n          className=\\\"author-tooltip__action-button primary\\\"\n          onClick={onViewProfile}\n        >\n          View Profile\n        </button>\n        <button\n          className=\\\"author-tooltip__action-button secondary\\\"\n          onClick={onViewInModal}\n        >\n          Open in Modal\n        </button>\n        <div className=\\\"author-tooltip__hint\\\">\n          Hold Ctrl and click author to open modal directly\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Private Profile Tooltip Component - matches regular tooltip styling\nconst UserProfileTooltipPrivate: React.FC<{\n  authorName: string;\n  onViewProfile: () => void;\n}> = ({ authorName, onViewProfile }) => {\n  return (\n    <div className=\\\"author-tooltip\\\">\n      <div className=\\\"author-tooltip__content\\\">\n        <div className=\\\"author-tooltip__header\\\">\n          <div>\n            <div className=\\\"author-tooltip__private-icon\\\">\ud83d\udd12</div>\n          </div>\n          <div className=\\\"author-tooltip__header-info\\\">\n            <h4 className=\\\"author-tooltip__name\\\">{authorName}</h4>\n            <p className=\\\"author-tooltip__private-status\\\">Private Profile</p>\n          </div>\n        </div>\n\n        <div className=\\\"author-tooltip__private-message\\\">\n          <p>\n            This user has set their profile to private. Only they can view their\n            profile information.\n          </p>\n        </div>\n      </div>\n\n      {/* No actions section for private profiles - removed View Profile Page button */}\n    </div>\n  );\n};\n\n// Loading state component that matches the actual tooltip structure\nconst UserProfileTooltipLoading: React.FC = () => {\n  return (\n    <div className=\\\"author-tooltip\\\">\n      <div className=\\\"author-tooltip__content\\\">\n        <div className=\\\"author-tooltip__header\\\">\n          <div>\n            {/* Avatar skeleton */}\n            <div\n              className=\\\"skeleton skeleton--avatar\\\"\n              style={{\n                width: '32px',\n                height: '32px',\n                borderRadius: '50%',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n          </div>\n          <div className=\\\"author-tooltip__header-info\\\">\n            {/* Name skeleton */}\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '120px',\n                height: '18px',\n                marginBottom: '4px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n            {/* Location skeleton */}\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '80px',\n                height: '14px',\n                marginBottom: '4px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n            <div className=\\\"author-tooltip__footer\\\">\n              {/* Join date skeleton */}\n              <div\n                className=\\\"skeleton skeleton--text\\\"\n                style={{\n                  width: '100px',\n                  height: '12px',\n                  backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n                }}\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Compact bio skeleton - only 2 lines instead of full bio section */}\n        <div\n          className=\\\"skeleton skeleton--text\\\"\n          style={{\n            width: '100%',\n            height: '14px',\n            marginBottom: '6px',\n            marginTop: '8px',\n            backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n          }}\n        />\n        <div\n          className=\\\"skeleton skeleton--text\\\"\n          style={{\n            width: '75%',\n            height: '14px',\n            backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n          }}\n        />\n\n        {/* Compact stats skeleton - smaller and more compact */}\n        <div className=\\\"author-tooltip__stats\\\">\n          <div className=\\\"author-tooltip__stat\\\">\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '20px',\n                height: '16px',\n                marginBottom: '2px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '30px',\n                height: '10px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n          </div>\n          <div className=\\\"author-tooltip__stat\\\">\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '20px',\n                height: '16px',\n                marginBottom: '2px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '35px',\n                height: '10px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n          </div>\n          <div className=\\\"author-tooltip__stat\\\">\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '20px',\n                height: '16px',\n                marginBottom: '2px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{\n                width: '25px',\n                height: '10px',\n                backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n              }}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Compact action buttons skeleton - smaller and better spaced */}\n      <div className=\\\"author-tooltip__actions\\\">\n        <div\n          className=\\\"skeleton skeleton--button\\\"\n          style={{\n            width: '90px',\n            height: '28px',\n            borderRadius: '6px',\n            backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n          }}\n        />\n        <div\n          className=\\\"skeleton skeleton--button\\\"\n          style={{\n            width: '110px',\n            height: '28px',\n            borderRadius: '6px',\n            backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n          }}\n        />\n        <div className=\\\"author-tooltip__hint\\\">\n          <div\n            className=\\\"skeleton skeleton--text\\\"\n            style={{\n              width: '180px',\n              height: '10px',\n              backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const Author: React.FC<AuthorProps> = ({\n  authorId,\n  authorName,\n  size = 'xs',\n  showFullName = true,\n  onClick,\n  className = '',\n  enableTooltip = true,\n  bio\n}) => {\n  const [userProfile, setUserProfile] = useState<UserProfileData | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [hasAttemptedFetch, setHasAttemptedFetch] = useState(false);\n  const [isPrivateProfile, setIsPrivateProfile] = useState(false);\n  const [fetchError, setFetchError] = useState<string | null>(null);\n  const { openOverlay, closeOverlay } = useOverlay();\n\n  const displayName = showFullName ? authorName : `@${authorName}`;\n\n  // \u2705 CRITICAL: Always use database ID for profile URLs\n  // This ensures profile URLs remain stable even when OAuth provider usernames change\n  const profileUrl = `/profile/${authorId}`;\n\n  // Fetch user profile for tooltip - only when tooltip is triggered\n  const fetchUserProfile = async () => {\n    if (hasAttemptedFetch || isLoading) return;\n\n    setIsLoading(true);\n    setHasAttemptedFetch(true);\n    setFetchError(null);\n    setIsPrivateProfile(false);\n\n    try {\n      // \u2705 Only database ID lookup supported after migration 0010\n      const fetchUrl = `/api/profile/id/${encodeURIComponent(authorId)}`;\n\n      const response = await fetch(fetchUrl);\n      if (response.ok) {\n        const profile: UserProfileData = await response.json();\n        setUserProfile(profile);\n      } else if (response.status === 403) {\n        // Profile is private\n        const errorData = await response.json();\n        if (errorData.error === 'This profile is private') {\n          setIsPrivateProfile(true);\n        } else {\n          setFetchError(errorData.error || 'Access denied');\n        }\n      } else if (response.status === 404) {\n        setFetchError('User not found');\n      } else {\n        setFetchError('Failed to fetch profile');\n      }\n    } catch (error) {\n      console.error('Error fetching user profile:', error);\n      setFetchError('Unable to load profile');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleClick = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    // Handle Ctrl+Click for modal\n    if (event.ctrlKey || event.metaKey) {\n      event.preventDefault();\n      if (userProfile) {\n        openModal();\n      } else {\n        // Fetch profile first, then open modal\n        fetchUserProfile().then(() => {\n          if (userProfile) {\n            openModal();\n          }\n        });\n      }\n      return;\n    }\n\n    // Handle custom onClick if provided\n    if (onClick) {\n      event.preventDefault();\n      onClick(authorId);\n    }\n\n    // Otherwise, let Link handle normal navigation\n  };\n\n  const openModal = () => {\n    if (!userProfile) return;\n\n    const modalId = `user-profile-modal-${authorId}`;\n    openOverlay({\n      id: modalId,\n      type: 'modal',\n      component: UserProfileModal,\n      props: {\n        user: userProfile,\n        onClose: () => closeOverlay(modalId)\n      }\n    });\n  };\n\n  const handleViewProfile = () => {\n    // Let the link handle navigation naturally\n    window.location.href = profileUrl;\n  };\n\n  const containerClass = `author ${size} clickable ${className}`;\n\n  const authorElement = (\n    <InstantLink\n      href={profileUrl}\n      className={containerClass}\n      onClick={handleClick}\n      title={`View ${authorName}'s profile`}\n      aria-label={`View ${authorName}'s profile`}\n    >\n      <div className=\\\"author__name\\\">\n        <Avatar\n          seed={userProfile?.id || authorId}\n          size={size}\n          enableTooltip={false} // Disable avatar tooltip since we have user profile tooltip\n        />\n        <span>{displayName}</span>\n      </div>\n    </InstantLink>\n  );\n\n  // If tooltip is disabled, return plain element\n  if (!enableTooltip) {\n    return authorElement;\n  }\n\n  // Create tooltip content with profile preview and actions\n  const tooltipContent = userProfile ? (\n    <UserProfileTooltipContent\n      user={userProfile}\n      onViewProfile={handleViewProfile}\n      onViewInModal={openModal}\n    />\n  ) : isLoading ? (\n    <UserProfileTooltipLoading />\n  ) : isPrivateProfile ? (\n    <UserProfileTooltipPrivate\n      authorName={authorName}\n      onViewProfile={handleViewProfile}\n    />\n  ) : (\n    <div className=\\\"author-tooltip__error\\\">\n      <p>{fetchError || 'Unable to load profile'}</p>\n    </div>\n  );\n\n  // Return element wrapped in enhanced tooltip with lazy loading\n  return (\n    <InteractiveTooltip\n      content={tooltipContent}\n      delay={500}\n      className=\\\"author-tooltip-wrapper\\\"\n      onShow={fetchUserProfile} // Trigger fetch when tooltip is about to show\n    >\n      {authorElement}\n    </InteractiveTooltip>\n  );\n};\n",
    "language":"typescript",
    "lines":555,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/empty/Empty.tsx":{
    "content":"import { EMPTY_SELECTORS } from 'src/lib/test-selectors/components/empty.selectors';\nimport './Empty.css';\n\nexport default function Empty({ label = '' }: { label: string }) {\n  return (\n    <div className=\\\"empty\\\" data-testid={EMPTY_SELECTORS.CONTAINER}>\n      <p data-testid={EMPTY_SELECTORS.LABEL}>\n        {label && (\n          <>\n            {label}\n            <br />\n          </>\n        )}\n        \uff1e\ufe3f\uff1c\n      </p>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":19,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/empty/Empty.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { EMPTY_SELECTORS } from 'src/lib/test-selectors/components/empty.selectors';\nimport Empty from './Empty';\n\ndescribe('Empty component', () => {\n  test('renders with default label', () => {\n    render(<Empty label=\\\"\\\" />);\n    expect(screen.getByTestId(EMPTY_SELECTORS.CONTAINER)).toBeInTheDocument();\n  });\n\n  test('renders with provided label', () => {\n    const label = 'No Data';\n    render(<Empty label={label} />);\n    const labelElement = screen.getByTestId(EMPTY_SELECTORS.LABEL);\n    expect(labelElement).toBeInTheDocument();\n    expect(labelElement).toHaveTextContent('\uff1e\ufe3f\uff1c');\n  });\n\n  test('renders label with line break', () => {\n    const label = 'No Data';\n    render(<Empty label={label} />);\n    const lineBreak = screen.getByText(\n      (content, element) => element?.tagName.toLowerCase() === 'br'\n    );\n    expect(lineBreak).toBeInTheDocument();\n  });\n\n  test('renders with default empty label', () => {\n    // @ts-expect-error\n    render(<Empty />);\n    const labelElement = screen.getByTestId(EMPTY_SELECTORS.LABEL);\n    expect(labelElement).toHaveTextContent('\uff1e\ufe3f\uff1c');\n  });\n});\n",
    "language":"typescript",
    "lines":35,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-aside/PageAside.tsx":{
    "content":"'use client';\nimport React from 'react';\nimport { PAGE_ASIDE_SELECTORS } from '../../../lib/test-selectors/components/page-aside.selectors';\nimport './PageAside.module.css';\n\nexport function PageAside({\n  bottomMargin = 0,\n  children,\n  className\n}: {\n  children: React.ReactNode;\n  bottomMargin?: number;\n  className?: string;\n}) {\n  return (\n    <div className=\\\"page-aside__container\\\" data-testid=\\\"page-aside-container\\\">\n      <aside className={className} data-testid={PAGE_ASIDE_SELECTORS.ASIDE}>\n        {children}\n      </aside>\n      {bottomMargin ? (\n        <div style={{ height: `${bottomMargin}rem`, display: 'block' }} />\n      ) : null}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":26,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-aside/PageAside.test.tsx":{
    "content":"import '@testing-library/jest-dom';\nimport { render, screen, within } from '@testing-library/react';\nimport { PAGE_ASIDE_SELECTORS } from '../../../lib/test-selectors/components/page-aside.selectors';\nimport { PageAside } from './PageAside';\n\ndescribe('PageAside', () => {\n  it('renders the layout correctly', () => {\n    render(<PageAside>Test Content</PageAside>);\n    expect(\n      screen.getByTestId(PAGE_ASIDE_SELECTORS.CONTAINER)\n    ).toBeInTheDocument();\n    expect(screen.getByTestId(PAGE_ASIDE_SELECTORS.CONTAINER)).toHaveProperty(\n      'tagName',\n      'DIV'\n    );\n\n    expect(\n      within(screen.getByTestId(PAGE_ASIDE_SELECTORS.CONTAINER)).getByTestId(\n        PAGE_ASIDE_SELECTORS.ASIDE\n      )\n    ).toBeVisible();\n    expect(\n      within(screen.getByTestId(PAGE_ASIDE_SELECTORS.CONTAINER)).getByTestId(\n        PAGE_ASIDE_SELECTORS.ASIDE\n      )\n    ).toHaveProperty('tagName', 'ASIDE');\n    expect(\n      within(screen.getByTestId(PAGE_ASIDE_SELECTORS.CONTAINER)).getByTestId(\n        PAGE_ASIDE_SELECTORS.ASIDE\n      )\n    ).toHaveTextContent('Test Content');\n  });\n\n  it('applies custom className', () => {\n    render(<PageAside className=\\\"custom-class\\\">Test Content</PageAside>);\n    expect(screen.getByTestId(PAGE_ASIDE_SELECTORS.ASIDE)).toHaveClass(\n      'custom-class'\n    );\n  });\n\n  it('renders without bottom margin by default', () => {\n    const { container } = render(<PageAside>Test Content</PageAside>);\n    expect(container.querySelector('div[style]')).not.toBeInTheDocument();\n  });\n\n  it('renders with bottom margin when specified', () => {\n    const { container } = render(\n      <PageAside bottomMargin={5}>Test Content</PageAside>\n    );\n    const marginDiv = container.querySelector('div[style]');\n    expect(marginDiv).toBeInTheDocument();\n    expect(marginDiv).toHaveStyle('height: 5rem');\n    expect(marginDiv).toHaveStyle('display: block');\n  });\n});\n",
    "language":"typescript",
    "lines":56,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/message-ticker/MessageTicker.tsx":{
    "content":"'use client';\nimport { useEffect, useRef, useState } from 'react';\nimport FadeIn, { DisplayType } from '../fade-in/FadeIn';\nimport './MessageTicker.css';\n\ninterface MessageTickerProps {\n  messages?: string[];\n}\n\nexport function MessageTicker({ messages = [] }: MessageTickerProps) {\n  const tickerRef = useRef<HTMLDivElement>(null);\n  const [animationDuration, setAnimationDuration] = useState('120s');\n\n  useEffect(() => {\n    if (tickerRef.current) {\n      const tickerWidth = tickerRef.current.scrollWidth;\n      const containerWidth = tickerRef.current.parentElement?.offsetWidth || 0;\n      const duration = (tickerWidth / containerWidth) * 20;\n      setAnimationDuration(`${duration}s`);\n    }\n  }, [messages]);\n\n  const repeatedMessages =\n    messages.length === 1\n      ? [\n          ...messages,\n          ...messages,\n          ...messages,\n          ...messages,\n          ...messages,\n          ...messages\n        ] // replicate to ensure maximised use of horizontal empty space\n      : messages;\n\n  return (\n    <div className=\\\"message-ticker__container\\\">\n      <div\n        className=\\\"message-ticker__content\\\"\n        ref={tickerRef}\n        style={{ animationDuration }}\n      >\n        {repeatedMessages.map((message, index) => (\n          <span className=\\\"message-ticker__message\\\" key={message + index}>\n            <FadeIn display={DisplayType.SPAN}>{message}</FadeIn>\n          </span>\n        ))}\n        {/* render a second set with offset to ensure seamless infinite animation */}\n        {repeatedMessages.map((message, index) => (\n          <span\n            className=\\\"message-ticker__message message-ticker__message--offset\\\"\n            key={message + index + 'offset'}\n          >\n            <FadeIn display={DisplayType.SPAN}>{message}</FadeIn>\n          </span>\n        ))}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":60,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/message-ticker/MessageTickerWithInterval.tsx":{
    "content":"'use client';\nimport { useEffect, useState } from 'react';\nimport { MessageTicker } from './MessageTicker';\nimport { fetchBuddha } from './actions';\n\nexport default function MessageTickerWithInterval() {\n  const [message, setMessage] = useState<string[]>([]);\n\n  useEffect(() => {\n    const fetchData = () => {\n      fetchBuddha()\n        .then((result) => {\n          if (result?.text) {\n            setMessage([result.text]);\n          }\n        })\n        .catch((error) => {\n          console.error('Error fetching data:', error);\n        });\n    };\n\n    fetchData(); // Initial fetch\n\n    const intervalId = setInterval(fetchData, 108000); // Fetch data every 108 seconds\n\n    return () => clearInterval(intervalId); // Cleanup interval on component unmount\n  }, []);\n\n  return (\n    <>\n      {message ? <MessageTicker messages={message} /> : <span>Loading...</span>}\n    </>\n  );\n}\n",
    "language":"typescript",
    "lines":35,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-buttons/AuthButtons.tsx":{
    "content":"import { AUTH_BUTTON_SELECTORS } from 'src/lib/test-selectors/components/auth-buttons.selectors';\nimport { signInAction, signOutAction } from './actions';\nimport './AuthButtons.css';\nimport { SignInProviders } from './types';\n\n// Export SignInProviders for use in tests\nexport type { SignInProviders } from './types';\n\nexport function SignIn({\n  provider,\n  redirectTo\n}: Readonly<{\n  provider: SignInProviders;\n  redirectTo?: string;\n}>) {\n  return (\n    <form action={signInAction.bind(null, provider, redirectTo)}>\n      <button\n        type=\\\"submit\\\"\n        className=\\\"auth-button\\\"\n        data-testid={AUTH_BUTTON_SELECTORS.SIGN_IN}\n      >\n        Login with <span className=\\\"capitalize\\\">{provider}</span>\n      </button>\n    </form>\n  );\n}\n\nexport function SignOut({\n  'data-testid': dataTestId\n}: {\n  'data-testid'?: string;\n} = {}) {\n  return (\n    <form action={signOutAction}>\n      <button\n        type=\\\"submit\\\"\n        data-testid={dataTestId || AUTH_BUTTON_SELECTORS.SIGN_OUT}\n      >\n        Sign Out\n      </button>\n    </form>\n  );\n}\n",
    "language":"typescript",
    "lines":45,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-buttons/ClientAuthButtons.tsx":{
    "content":"'use client';\n\nimport { signIn, signOut } from 'next-auth/react';\nimport { NAV_PATHS } from 'src/lib/routes';\nimport { AUTH_BUTTON_SELECTORS } from 'src/lib/test-selectors/components/auth-buttons.selectors';\nimport './AuthButtons.css';\nimport { SignInProviders } from './types';\n\nexport function ClientSignIn({\n  provider,\n  redirectTo\n}: Readonly<{\n  provider: SignInProviders;\n  redirectTo?: string;\n}>) {\n  const handleSignIn = async () => {\n    await signIn(provider, {\n      callbackUrl: redirectTo || NAV_PATHS.ROOT,\n      redirect: true\n    });\n  };\n\n  return (\n    <button\n      type=\\\"button\\\"\n      onClick={handleSignIn}\n      className=\\\"auth-button\\\"\n      data-testid={AUTH_BUTTON_SELECTORS.SIGN_IN}\n    >\n      Login with <span className=\\\"capitalize\\\">{provider}</span>\n    </button>\n  );\n}\n\nexport function ClientSignOut({\n  'data-testid': dataTestId\n}: {\n  'data-testid'?: string;\n}) {\n  const handleSignOut = async () => {\n    // Clear route-scoped filters before signing out\n    try {\n      const { clearAllRouteFilters } = await import('src/lib/state/atoms');\n      clearAllRouteFilters();\n    } catch (error) {\n      console.warn('Failed to clear route filters on signout:', error);\n    }\n\n    await signOut({\n      callbackUrl: NAV_PATHS.ROOT,\n      redirect: true\n    });\n  };\n\n  return (\n    <button\n      style={{\n        fontSize: 'var(--font-size-lg)',\n        top: '0.25rem',\n        position: 'relative'\n      }}\n      type=\\\"button\\\"\n      onClick={handleSignOut}\n      data-testid={dataTestId || AUTH_BUTTON_SELECTORS.SIGN_OUT}\n    >\n      Sign Out\n    </button>\n  );\n}\n",
    "language":"typescript",
    "lines":70,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-buttons/SessionRefreshHandler.tsx":{
    "content":"'use client';\n\n/* eslint-disable no-console */\n\nimport { signOut, useSession } from 'next-auth/react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { Suspense, useEffect, useRef } from 'react';\n\n/**\n * Internal SessionRefreshHandler that uses useSearchParams\n */\nfunction SessionRefreshHandlerInternal() {\n  const { data: session, status, update } = useSession();\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const hasProcessedCallback = useRef(false);\n  const refreshAttempts = useRef(0);\n  const maxRefreshAttempts = 3;\n\n  useEffect(() => {\n    // Skip if we've already processed a callback in this session\n    if (hasProcessedCallback.current) return;\n\n    // Check if this looks like an OAuth callback with more comprehensive detection\n    const isCallback =\n      searchParams.get('code') ||\n      searchParams.get('state') ||\n      searchParams.get('oauth_token') ||\n      searchParams.get('oauth_verifier') ||\n      searchParams.get('session_state') ||\n      // Check for NextAuth callback URL patterns\n      window.location.pathname.includes('/api/auth/callback');\n\n    // If we detect OAuth callback parameters and session needs refresh\n    if (\n      isCallback &&\n      (status === 'loading' ||\n        (status === 'unauthenticated' &&\n          refreshAttempts.current < maxRefreshAttempts))\n    ) {\n      // Set a flag to prevent multiple refresh attempts\n      hasProcessedCallback.current = true;\n      refreshAttempts.current += 1;\n\n      // console.log(\n      //   `\ud83d\udd04 OAuth callback detected (attempt ${refreshAttempts.current}/${maxRefreshAttempts}), refreshing session...`\n      // );\n\n      // Force session refresh after a short delay to allow NextAuth to process\n      const refreshTimer = setTimeout(async () => {\n        try {\n          const updatedSession = await update();\n\n          // Wait a bit more and check if session was updated\n          setTimeout(() => {\n            // Re-check session status after update\n            if (updatedSession?.user) {\n              // console.log('\u2705 Session refresh successful after OAuth callback');\n\n              // Clear URL parameters after successful refresh\n              if (typeof window !== 'undefined' && window.location.search) {\n                const url = new URL(window.location.href);\n                const cleanUrl = `${url.origin}${url.pathname}`;\n                window.history.replaceState({}, '', cleanUrl);\n              }\n\n              // Reset counters for future use\n              refreshAttempts.current = 0;\n              hasProcessedCallback.current = false;\n            } else if (refreshAttempts.current < maxRefreshAttempts) {\n              // If still not authenticated, try again\n              // console.log(\n              //   `\u26a0\ufe0f Session still not authenticated after refresh attempt ${refreshAttempts.current}, will retry...`\n              // );\n              hasProcessedCallback.current = false; // Allow retry\n            } else {\n              console.warn(\n                '\u274c Failed to authenticate after maximum refresh attempts'\n              );\n            }\n          }, 1000);\n        } catch (error) {\n          console.error(\n            'Failed to refresh session after OAuth callback:',\n            error\n          );\n          hasProcessedCallback.current = false; // Allow retry on error\n        }\n      }, 1500); // 1.5 second delay to allow NextAuth processing\n\n      return () => clearTimeout(refreshTimer);\n    }\n\n    // Reset the flag when we have a successful session\n    if (status === 'authenticated' && session?.user) {\n      hasProcessedCallback.current = false;\n      refreshAttempts.current = 0;\n    }\n  }, [searchParams, status, session, update, router]);\n\n  // This component doesn't render anything\n  return null;\n}\n\n/**\n * SessionRefreshHandler - Handles OAuth callback session refresh\n *\n * This component detects when a user returns from OAuth provider\n * and forces a session refresh to ensure the UI reflects the new\n * authentication state without requiring a hard refresh.\n */\nexport function SessionRefreshHandler() {\n  const { data: session, status } = useSession();\n  const lastRefreshRef = useRef<number>(0);\n\n  useEffect(() => {\n    if (status !== 'authenticated' || !session) return;\n\n    const refreshInterval = 30 * 60 * 1000; // 30 minutes\n    const now = Date.now();\n\n    // Only refresh if enough time has passed\n    if (now - lastRefreshRef.current < refreshInterval) return;\n\n    let isRefreshing = false;\n\n    const refreshSession = async () => {\n      if (isRefreshing) return;\n      isRefreshing = true;\n\n      try {\n        // Test if the session is still valid by making a lightweight API call\n        const response = await fetch('/api/user/timeout?type=post_creation', {\n          method: 'GET',\n          credentials: 'include'\n        });\n\n        // Check if server indicates session should be cleared\n        const clearSession = response.headers.get('X-Clear-Session') === 'true';\n\n        if (\n          clearSession ||\n          response.status === 404 ||\n          response.status === 401\n        ) {\n          console.log('\ud83d\udd12 Session invalidated by server, signing out...');\n          await signOut({\n            redirect: true,\n            callbackUrl: '/auth/signin?reason=session_invalid'\n          });\n          return;\n        }\n\n        // If response indicates user validation failure, check the response body\n        if (!response.ok) {\n          try {\n            const errorData = await response.json();\n            if (errorData.clearSession || errorData.requiresReauth) {\n              console.log(\n                '\ud83d\udd12 Server requested session clearing, signing out...'\n              );\n              await signOut({\n                redirect: true,\n                callbackUrl: '/auth/signin?reason=user_not_found'\n              });\n              return;\n            }\n          } catch (e) {\n            // If we can't parse the response, but it's not ok, sign out anyway\n            console.log('\ud83d\udd12 Invalid session response, signing out...');\n            await signOut({\n              redirect: true,\n              callbackUrl: '/auth/signin?reason=invalid_response'\n            });\n            return;\n          }\n        }\n\n        lastRefreshRef.current = now;\n      } catch (error) {\n        console.error('Session refresh failed:', error);\n        // On network error, don't sign out automatically - could be temporary\n      } finally {\n        isRefreshing = false;\n      }\n    };\n\n    // Initial refresh check\n    refreshSession();\n\n    // Set up interval for periodic checks\n    const interval = setInterval(refreshSession, refreshInterval);\n\n    return () => clearInterval(interval);\n  }, [session, status]);\n\n  // Also set up a global fetch interceptor to catch session invalidation responses\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const originalFetch = window.fetch;\n\n    window.fetch = async function (...args) {\n      const response = await originalFetch.apply(this, args);\n\n      // Check for session invalidation headers\n      if (response.headers.get('X-Clear-Session') === 'true') {\n        console.log('\ud83d\udd12 Global session invalidation detected, signing out...');\n        await signOut({\n          redirect: true,\n          callbackUrl: '/auth/signin?reason=global_invalidation'\n        });\n        return response;\n      }\n\n      // Check for specific error responses that indicate session issues\n      if (\n        (response.status === 404 || response.status === 401) &&\n        response.url.includes('/api/')\n      ) {\n        try {\n          const clonedResponse = response.clone();\n          const errorData = await clonedResponse.json();\n\n          if (errorData.clearSession || errorData.requiresReauth) {\n            console.log(\n              '\ud83d\udd12 API response requested session clearing, signing out...'\n            );\n            await signOut({\n              redirect: true,\n              callbackUrl: '/auth/signin?reason=api_invalidation'\n            });\n          }\n        } catch (e) {\n          // Ignore JSON parsing errors\n        }\n      }\n\n      return response;\n    };\n\n    return () => {\n      window.fetch = originalFetch;\n    };\n  }, []);\n\n  return (\n    <Suspense fallback={null}>\n      <SessionRefreshHandlerInternal />\n    </Suspense>\n  );\n}\n",
    "language":"typescript",
    "lines":253,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-buttons/AuthButtons.test.tsx":{
    "content":"import { act, fireEvent, render, screen } from '@testing-library/react';\nimport { AUTH_BUTTON_SELECTORS } from 'src/lib/test-selectors/components/auth-buttons.selectors';\nimport { SignIn, SignInProviders, SignOut } from './AuthButtons';\nimport { signInAction, signOutAction } from './actions';\n\njest.mock('./actions', () => ({\n  signInAction: jest.fn(),\n  signOutAction: jest.fn()\n}));\n\njest.mock('next/navigation', () => ({\n  useRouter: jest.fn(() => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    refresh: jest.fn()\n  }))\n}));\n\ndescribe('AuthButtons', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('SignIn component', () => {\n    it.each([\n      ['twitch' as SignInProviders, 'Login with twitch'],\n      ['google' as SignInProviders, 'Login with google']\n    ])(\n      'renders button with correct text for %s provider',\n      (provider, expectedText) => {\n        render(<SignIn provider={provider} />);\n        expect(\n          screen.getByTestId(AUTH_BUTTON_SELECTORS.SIGN_IN)\n        ).toHaveTextContent(expectedText);\n      }\n    );\n\n    it.each(['twitch', 'google'] as SignInProviders[])(\n      'calls signInAction with %s provider when clicked',\n      async (provider) => {\n        render(<SignIn provider={provider} />);\n\n        await act(async () => {\n          fireEvent.click(screen.getByTestId(AUTH_BUTTON_SELECTORS.SIGN_IN));\n        });\n\n        expect(signInAction).toHaveBeenCalled();\n        expect((signInAction as jest.Mock).mock.calls[0][0]).toBe(provider);\n      }\n    );\n  });\n\n  describe('SignOut component', () => {\n    it('renders the sign out button and calls signOutAction when clicked', async () => {\n      render(<SignOut />);\n      const signOutButton = screen.getByTestId(AUTH_BUTTON_SELECTORS.SIGN_OUT);\n      expect(signOutButton).toBeInTheDocument();\n\n      await act(async () => {\n        fireEvent.click(signOutButton);\n      });\n      expect(signOutAction).toHaveBeenCalled();\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":66,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/discord-link/DiscordLink.tsx":{
    "content":"import React from 'react';\nimport { DISCORD_LINK_SELECTORS } from '../../../lib/test-selectors/components/discord-link.selectors';\nimport { LinkTooltip } from '../tooltip/LinkTooltip';\n\nexport interface DiscordLinkProps {\n  isInsideParagraph?: boolean;\n}\n\nexport const DiscordLink: React.FC<DiscordLinkProps> = ({\n  isInsideParagraph = false\n}) => {\n  return (\n    <LinkTooltip\n      url=\\\"https://discord.gg/mpThbx67J7\\\"\n      isInsideParagraph={isInsideParagraph}\n    >\n      <a\n        data-testid={DISCORD_LINK_SELECTORS.LINK}\n        href=\\\"https://discord.gg/mpThbx67J7\\\"\n        target=\\\"_blank\\\"\n        rel=\\\"noopener noreferrer\\\"\n        aria-label=\\\"Join our Discord server\\\"\n        aria-describedby=\\\"discord-link-tooltip\\\"\n        aria-labelledby=\\\"discord-link-tooltip\\\"\n      >\n        Discord\n      </a>\n    </LinkTooltip>\n  );\n};\n",
    "language":"typescript",
    "lines":31,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/discord-link/DiscordLink.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { DISCORD_LINK_SELECTORS } from '../../../lib/test-selectors/components/discord-link.selectors';\nimport { DiscordLink } from './DiscordLink';\n\ndescribe('Discord Link', () => {\n  it('renders the Discord link', () => {\n    render(<DiscordLink isInsideParagraph={false} />);\n\n    const linkElement = screen.getByTestId(DISCORD_LINK_SELECTORS.LINK);\n\n    expect(linkElement).toBeVisible();\n    expect(linkElement).toBeEnabled();\n    expect(linkElement).toHaveAttribute(\n      'href',\n      'https://discord.gg/mpThbx67J7'\n    );\n    expect(linkElement).toHaveAttribute('target', '_blank');\n  });\n\n  it('has the correct text content', () => {\n    render(<DiscordLink isInsideParagraph={false} />);\n\n    const linkElement = screen.getByTestId(DISCORD_LINK_SELECTORS.LINK);\n\n    expect(linkElement).toHaveTextContent('Discord');\n  });\n\n  it('has the correct tooltip text', () => {\n    render(<DiscordLink isInsideParagraph />);\n\n    const linkElement = screen.getByTestId(DISCORD_LINK_SELECTORS.LINK);\n\n    expect(linkElement).toHaveTextContent('Discord');\n    expect(linkElement).toHaveAttribute(\n      'href',\n      'https://discord.gg/mpThbx67J7'\n    );\n    expect(linkElement).toHaveAttribute('target', '_blank');\n    expect(linkElement).toHaveAttribute('rel', 'noopener noreferrer');\n    expect(linkElement).toHaveAttribute(\n      'aria-label',\n      'Join our Discord server'\n    );\n    expect(linkElement).toHaveAttribute(\n      'aria-describedby',\n      'discord-link-tooltip'\n    );\n    expect(linkElement).toHaveAttribute(\n      'aria-labelledby',\n      'discord-link-tooltip'\n    );\n  });\n});\n",
    "language":"typescript",
    "lines":54,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/discord-link/Discord.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { DISCORD_LINK_SELECTORS } from '../../../lib/test-selectors/components/discord-link.selectors';\nimport { DiscordLink } from './DiscordLink';\n\ndescribe('Discord Link', () => {\n  it('renders the Discord link', () => {\n    render(<DiscordLink />);\n\n    screen.findByRole('heading');\n\n    expect(screen.getByTestId(DISCORD_LINK_SELECTORS.LINK))\n      .toBeVisible()\n      .toBeEnabled()\n      .toHaveAttribute('href', 'https://discord.gg/mpThbx67J7')\n      .toHaveAttribute('target', '_blank');\n  });\n});\n",
    "language":"typescript",
    "lines":18,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/infinite-scroll-trigger/InfiniteScrollTrigger.tsx":{
    "content":"'use client';\n\nimport { useCallback, useEffect, useRef } from 'react';\nimport './InfiniteScrollTrigger.css';\n\ninterface InfiniteScrollTriggerProps {\n  onLoadMore: () => void;\n  isLoading: boolean;\n  className?: string;\n  threshold?: number; // How much of the trigger should be visible before loading (0-1)\n  rootMargin?: string; // Margin around the root for early triggering\n}\n\nconst InfiniteScrollTrigger: React.FC<InfiniteScrollTriggerProps> = ({\n  onLoadMore,\n  isLoading,\n  className = '',\n  threshold = 0.1, // Trigger when 10% visible\n  rootMargin = '100px' // Start loading 100px before trigger is visible\n}) => {\n  const triggerRef = useRef<HTMLDivElement>(null);\n  const hasTriggeredRef = useRef(false);\n\n  const handleIntersection = useCallback(\n    (entries: IntersectionObserverEntry[]) => {\n      const [entry] = entries;\n\n      if (entry.isIntersecting && !isLoading && !hasTriggeredRef.current) {\n        hasTriggeredRef.current = true;\n        onLoadMore();\n      }\n    },\n    [onLoadMore, isLoading]\n  );\n\n  useEffect(() => {\n    const trigger = triggerRef.current;\n    if (!trigger) return;\n\n    const observer = new IntersectionObserver(handleIntersection, {\n      threshold,\n      rootMargin\n    });\n\n    observer.observe(trigger);\n\n    return () => {\n      observer.unobserve(trigger);\n      observer.disconnect();\n    };\n  }, [handleIntersection, threshold, rootMargin]);\n\n  // Reset trigger when loading completes\n  useEffect(() => {\n    if (!isLoading) {\n      hasTriggeredRef.current = false;\n    }\n  }, [isLoading]);\n\n  return (\n    <div\n      ref={triggerRef}\n      className={`infinite-scroll-trigger ${className} ${\n        isLoading ? 'infinite-scroll-trigger--loading' : ''\n      }`}\n    >\n      {isLoading ? (\n        <div className=\\\"infinite-scroll-trigger__loader\\\">\n          <div className=\\\"infinite-scroll-trigger__spinner\\\">\n            <svg\n              width=\\\"24\\\"\n              height=\\\"24\\\"\n              viewBox=\\\"0 0 24 24\\\"\n              fill=\\\"none\\\"\n              stroke=\\\"currentColor\\\"\n              strokeWidth=\\\"2\\\"\n              strokeLinecap=\\\"round\\\"\n              strokeLinejoin=\\\"round\\\"\n              className=\\\"infinite-scroll-trigger__spinner-icon\\\"\n            >\n              <path d=\\\"M21 12a9 9 0 11-6.219-8.56\\\" />\n            </svg>\n          </div>\n          <span className=\\\"infinite-scroll-trigger__text\\\">\n            Loading more posts...\n          </span>\n        </div>\n      ) : (\n        <div className=\\\"infinite-scroll-trigger__ready\\\">\n          <div className=\\\"infinite-scroll-trigger__indicator\\\">\n            <svg\n              width=\\\"16\\\"\n              height=\\\"16\\\"\n              viewBox=\\\"0 0 24 24\\\"\n              fill=\\\"none\\\"\n              stroke=\\\"currentColor\\\"\n              strokeWidth=\\\"2\\\"\n              strokeLinecap=\\\"round\\\"\n              strokeLinejoin=\\\"round\\\"\n            >\n              <path d=\\\"M19 14l-7 7m0 0l-7-7m7 7V3\\\" />\n            </svg>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default InfiniteScrollTrigger;\n",
    "language":"typescript",
    "lines":111,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/edit-submission-form/EditSubmissionForm.tsx":{
    "content":"'use client';\n\nimport { Submission } from '../schema';\nimport { SharedSubmissionForm } from '../shared-submission-form/SharedSubmissionForm';\n\ninterface SubmissionData {\n  submission_id: number;\n  submission_title: string;\n  submission_name: string;\n  tags: string[];\n}\n\nexport function EditSubmissionForm({\n  submission,\n  onSuccess,\n  onCancel\n}: {\n  submission: SubmissionData;\n  onSuccess?: (updatedSubmissionData?: Submission) => void;\n  onCancel?: () => void;\n}) {\n  // Convert tags array to comma-separated string with # prefix\n  const formattedTags = submission.tags\n    .map((tag) => (tag.startsWith('#') ? tag : `#${tag}`))\n    .join(', ');\n\n  const handleSuccess = (result?: {\n    status: number;\n    message?: string;\n    error?: string;\n    submission?: Submission;\n  }) => {\n    // Pass any updated submission data to the callback\n    onSuccess?.(result?.submission);\n  };\n\n  return (\n    <div className=\\\"edit-submission-form\\\">\n      <SharedSubmissionForm\n        mode=\\\"edit\\\"\n        submissionId={submission.submission_id}\n        initialTitle={submission.submission_title}\n        initialContent={submission.submission_name || ''}\n        initialTags={formattedTags}\n        onSuccess={handleSuccess}\n        className=\\\"edit-submission-form__shared-form\\\"\n      />\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":51,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/add-submission-form/AddSubmissionForm.tsx":{
    "content":"'use client';\nimport { useAtom } from 'jotai';\nimport { useSession } from 'next-auth/react';\nimport { useEffect, useRef, useState } from 'react';\nimport { useFormState, useFormStatus } from 'react-dom';\nimport { shouldUpdateAtom } from '../../../../lib/state/atoms';\nimport { ADD_SUBMISSION_FORM_SELECTORS } from '../../../../lib/test-selectors/components/add-submission-form.selectors';\nimport { getEffectiveCharacterCount } from '../../../../lib/utils/string';\nimport { validateTagsInput } from '../../../../lib/utils/string/tag-regex';\nimport { SmartInput } from '../../ui/SmartInput';\nimport {\n  createSubmissionAction,\n  validateCreateSubmissionFormAction\n} from '../actions';\nimport './AddSubmissionForm.css';\n\nconst initialState = {\n  status: 0,\n  message: '',\n  error: '',\n  submission_datetime: '',\n  submission_name: '',\n  submission_title: ''\n};\n\nfunction SubmitButton({\n  isDisabled,\n  title\n}: {\n  isDisabled: boolean;\n  title?: string;\n}) {\n  const { pending } = useFormStatus();\n  const canSubmit = !pending && !isDisabled;\n\n  return (\n    <button\n      type=\\\"submit\\\"\n      aria-disabled={!canSubmit}\n      disabled={!canSubmit}\n      title={title}\n      data-testid={ADD_SUBMISSION_FORM_SELECTORS.SUBMIT_BUTTON}\n    >\n      Submit\n    </button>\n  );\n}\n\nexport function AddSubmissionForm({\n  onSuccess,\n  contextId\n}: { onSuccess?: () => void; contextId?: string } = {}) {\n  const ref = useRef<HTMLFormElement>(null);\n  const [, setShouldUpdate] = useAtom(shouldUpdateAtom);\n  const { data: session } = useSession();\n  const isAuthorized = !!session?.user;\n\n  const [state, formAction] = useFormState(\n    createSubmissionAction,\n    initialState\n  );\n  const [validateState, handleFormValidateAction] = useFormState(\n    validateCreateSubmissionFormAction,\n    initialState\n  );\n\n  const [titleValue, setTitleValue] = useState('');\n  const [contentValue, setContentValue] = useState('');\n  const [tagsValue, setTagsValue] = useState('');\n  const [titleLength, setTitleLength] = useState(0);\n  const [contentLength, setContentLength] = useState(0);\n  const [errors, setErrors] = useState('');\n  const [tagErrors, setTagErrors] = useState<string[]>([]);\n\n  const isDisabled = !isAuthorized || !!errors || tagErrors.length > 0;\n\n  const submitButtonTitle = errors\n    ? 'Resolve form errors.'\n    : tagErrors.length > 0\n      ? 'Fix tag errors.'\n      : !isAuthorized\n        ? 'Login to create posts.'\n        : undefined;\n\n  // Update should trigger when state changes\n  useEffect(() => {\n    if (state.status === 1) {\n      // Only trigger update on successful submission\n      setShouldUpdate(true);\n      onSuccess?.();\n    }\n  }, [state.status, state.message, setShouldUpdate, onSuccess]);\n\n  useEffect(() => {\n    if (validateState.error) {\n      setErrors(validateState.error);\n    } else {\n      setErrors('');\n    }\n  }, [validateState]);\n\n  const handleTitleChange = async (value: string) => {\n    setTitleValue(value);\n    setTitleLength(getEffectiveCharacterCount(value.trim()));\n\n    // Validate title on change instead of blur\n    if (value.trim().length > 0) {\n      const formData = new FormData();\n      formData.append('submission_title', value);\n      await handleFormValidateAction(formData);\n    }\n  };\n\n  const handleContentChange = (value: string) => {\n    setContentValue(value);\n    setContentLength(getEffectiveCharacterCount(value.trim()));\n  };\n\n  const handleTagsChange = (value: string) => {\n    setTagsValue(value);\n    const validationErrors = validateTagsInput(value);\n    setTagErrors(validationErrors);\n  };\n\n  const handleTitleBlur = async () => {\n    const formData = new FormData();\n    formData.append('submission_title', titleValue);\n    setTitleLength(getEffectiveCharacterCount(titleValue.trim()));\n    await handleFormValidateAction(formData);\n  };\n\n  const getTitleLengthStatus = () => {\n    const percentOfMax = (titleLength / 255) * 100;\n\n    if (percentOfMax >= 80 && percentOfMax < 100) {\n      return 'warning';\n    }\n\n    if (percentOfMax >= 100) {\n      return 'error';\n    }\n\n    return 'info';\n  };\n\n  const getContentLengthStatus = () => {\n    const percentOfMax = (contentLength / 1000) * 100;\n\n    if (percentOfMax >= 80 && percentOfMax < 100) {\n      return 'warning';\n    }\n\n    if (percentOfMax >= 100) {\n      return 'error';\n    }\n\n    return 'info';\n  };\n\n  return (\n    <form\n      ref={ref}\n      action={formAction}\n      className=\\\"submission__form\\\"\n      role=\\\"form\\\"\n      data-testid={ADD_SUBMISSION_FORM_SELECTORS.FORM}\n    >\n      {/* Title Field */}\n      <label htmlFor=\\\"submission_title\\\" className=\\\"submission__title-label\\\">\n        <div className=\\\"row--sm-margin\\\">\n          <span>Title *</span>\n          <SmartInput\n            value={titleValue}\n            onChange={handleTitleChange}\n            disabled={!isAuthorized}\n            placeholder=\\\"Enter a title for your post... Use #hashtags and @mentions!\\\"\n            className=\\\"submission__title-input\\\"\n            as=\\\"input\\\"\n            enableHashtags={true}\n            enableUserMentions={true}\n          />\n          <input type=\\\"hidden\\\" name=\\\"submission_title\\\" value={titleValue} />\n        </div>\n        <div className=\\\"row\\\">\n          <p\n            className={`column ${getTitleLengthStatus()}`}\n            data-testid=\\\"add-submission-title-character-count\\\"\n          >\n            {titleLength}/255\n          </p>\n        </div>\n      </label>\n\n      {/* Content/Description Field */}\n      <label htmlFor=\\\"submission_content\\\" className=\\\"submission__content-label\\\">\n        <div className=\\\"row--sm-margin\\\">\n          <span>Content</span>\n          <SmartInput\n            value={contentValue}\n            onChange={handleContentChange}\n            disabled={!isAuthorized}\n            placeholder=\\\"Write your post content... Use #hashtags and @mentions!\\\"\n            className=\\\"submission__content-input\\\"\n            as=\\\"textarea\\\"\n            rows={4}\n            enableHashtags={true}\n            enableUserMentions={true}\n          />\n          <input type=\\\"hidden\\\" name=\\\"submission_content\\\" value={contentValue} />\n        </div>\n        <div className=\\\"row\\\">\n          <p\n            className={`column ${getContentLengthStatus()}`}\n            data-testid=\\\"add-submission-content-character-count\\\"\n          >\n            {contentLength}/1000\n          </p>\n        </div>\n      </label>\n\n      {/* Tags Field */}\n      <label htmlFor=\\\"submission_tags\\\" className=\\\"submission__tags-label\\\">\n        <div className=\\\"row--sm-margin\\\">\n          <span>Additional Tags</span>\n          <SmartInput\n            value={tagsValue}\n            onChange={handleTagsChange}\n            disabled={!isAuthorized}\n            placeholder=\\\"#tag1, #tag2, #tag3\\\"\n            className=\\\"submission__tags-input\\\"\n            as=\\\"input\\\"\n            enableHashtags={true}\n            enableUserMentions={false}\n          />\n          <input type=\\\"hidden\\\" name=\\\"submission_tags\\\" value={tagsValue} />\n        </div>\n        {tagErrors.length > 0 && (\n          <div className=\\\"submission__tag-errors\\\">\n            {tagErrors.map((error, index) => (\n              <p key={index} className=\\\"error\\\" role=\\\"alert\\\">\n                {error}\n              </p>\n            ))}\n          </div>\n        )}\n        <div className=\\\"submission__tag-help\\\">\n          <p className=\\\"info\\\">\n            Tags must start with # and contain only letters, numbers, hyphens,\n            and underscores. Tags from your title and content will be\n            automatically detected.\n          </p>\n        </div>\n      </label>\n\n      {/* Hidden submission_name field - now populated from content */}\n      <input\n        type=\\\"hidden\\\"\n        id=\\\"submission_name\\\"\n        name=\\\"submission_name\\\"\n        value=\\\"\\\"\n      />\n\n      <div className=\\\"row--sm-margin\\\">\n        <SubmitButton isDisabled={isDisabled} title={submitButtonTitle} />\n      </div>\n\n      <div className=\\\"row\\\">\n        <p\n          aria-live=\\\"polite\\\"\n          className={`column ${errors ? 'error' : 'info'}`}\n          role=\\\"status\\\"\n          data-testid={ADD_SUBMISSION_FORM_SELECTORS.STATUS_MESSAGE}\n        >\n          {errors || state.message}\n        </p>\n      </div>\n    </form>\n  );\n}\n",
    "language":"typescript",
    "lines":280,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/add-submission-form/AddSubmissionForm.test.tsx":{
    "content":"import { fireEvent, render, screen, waitFor } from '@testing-library/react';\nimport { Provider } from 'jotai';\nimport { AddSubmissionForm } from './AddSubmissionForm';\n\n// Mock Jotai atoms instead of old context hooks\njest.mock('jotai', () => ({\n  ...jest.requireActual('jotai'),\n  useAtom: jest.fn().mockReturnValue([false, jest.fn()])\n}));\n\n// Mock the add submission action\njest.mock('../actions', () => ({\n  addSubmissionAction: jest.fn().mockResolvedValue({\n    status: 1,\n    message: 'Submission added successfully'\n  }),\n  createSubmissionAction: jest.fn().mockResolvedValue({\n    status: 1,\n    message: 'Submission added successfully'\n  }),\n  validateCreateSubmissionFormAction: jest.fn().mockResolvedValue({\n    status: 0,\n    message: '',\n    error: ''\n  })\n}));\n\n// Mock react-dom hooks\njest.mock('react-dom', () => ({\n  ...jest.requireActual('react-dom'),\n  useFormState: jest.fn(),\n  useFormStatus: jest.fn(() => ({ pending: false }))\n}));\n\n// Mock next-auth\njest.mock('next-auth/react', () => ({\n  useSession: jest.fn(() => ({\n    data: { user: { id: 'test-user' } },\n    status: 'authenticated'\n  }))\n}));\n\n// Mock SmartInput component\njest.mock('../../ui/SmartInput', () => ({\n  SmartInput: ({\n    value,\n    onChange,\n    disabled,\n    placeholder,\n    className,\n    as\n  }: any) => {\n    const Component = as || 'input';\n    return (\n      <Component\n        value={value}\n        onChange={(e: any) => onChange(e.target.value)}\n        disabled={disabled}\n        placeholder={placeholder}\n        className={className}\n        data-testid={`smart-input-${className}`}\n      />\n    );\n  }\n}));\n\ndescribe('AddSubmissionForm', () => {\n  const defaultProps = {\n    isAuthorized: true\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n\n    // Setup default form state mock\n    const { useFormState } = require('react-dom');\n    useFormState.mockReturnValue([{ status: 0, message: '' }, jest.fn()]);\n  });\n\n  it('renders form correctly', () => {\n    render(\n      <Provider>\n        <AddSubmissionForm />\n      </Provider>\n    );\n\n    expect(screen.getByRole('form')).toBeInTheDocument();\n    expect(\n      screen.getByTestId('smart-input-submission__title-input')\n    ).toBeInTheDocument();\n    expect(\n      screen.getByTestId('smart-input-submission__tags-input')\n    ).toBeInTheDocument();\n    expect(screen.getByRole('button', { name: /submit/i })).toBeInTheDocument();\n  });\n\n  it('handles form submission correctly', async () => {\n    const mockSetShouldUpdate = jest.fn();\n    const mockFormAction = jest.fn();\n\n    const { useAtom } = require('jotai');\n    const { useFormState } = require('react-dom');\n\n    useAtom.mockReturnValue([false, mockSetShouldUpdate]);\n\n    useFormState.mockReturnValue([\n      { status: 1, message: 'Success' },\n      mockFormAction\n    ]);\n\n    render(\n      <Provider>\n        <AddSubmissionForm />\n      </Provider>\n    );\n\n    const titleInput = screen.getByTestId(\n      'smart-input-submission__title-input'\n    );\n    const tagsInput = screen.getByTestId('smart-input-submission__tags-input');\n    const submitButton = screen.getByRole('button', { name: /submit/i });\n\n    fireEvent.change(titleInput, { target: { value: 'Test Title' } });\n    fireEvent.change(tagsInput, { target: { value: 'test, example' } });\n    fireEvent.click(submitButton);\n\n    await waitFor(() => {\n      expect(mockSetShouldUpdate).toHaveBeenCalledWith(true);\n    });\n  });\n\n  it('shows loading state during submission', () => {\n    const { useFormStatus } = require('react-dom');\n    useFormStatus.mockReturnValue({ pending: true });\n\n    render(\n      <Provider>\n        <AddSubmissionForm />\n      </Provider>\n    );\n\n    const submitButton = screen.getByRole('button', { name: /submit/i });\n    expect(submitButton).toBeDisabled();\n  });\n\n  it('displays error message on failed submission', () => {\n    const { useFormState } = require('react-dom');\n    useFormState.mockReturnValue([\n      { status: -1, message: 'Submission failed' },\n      jest.fn()\n    ]);\n\n    render(\n      <Provider>\n        <AddSubmissionForm />\n      </Provider>\n    );\n\n    expect(screen.getByText('Submission failed')).toBeInTheDocument();\n  });\n\n  it('resets form after successful submission', async () => {\n    const { useFormState } = require('react-dom');\n    useFormState.mockReturnValue([\n      { status: 1, message: 'Success' },\n      jest.fn()\n    ]);\n\n    render(\n      <Provider>\n        <AddSubmissionForm />\n      </Provider>\n    );\n\n    // Form should be reset after successful submission\n    const titleInput = screen.getByTestId(\n      'smart-input-submission__title-input'\n    ) as HTMLInputElement;\n    expect(titleInput.value).toBe('');\n  });\n});\n",
    "language":"typescript",
    "lines":182,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/SharedSubmissionForm.tsx":{
    "content":"'use client';\n\nimport { useAtom } from 'jotai';\nimport { shouldUpdateAtom } from '../../../../lib/state/atoms';\nimport { SmartInput } from '../../ui/SmartInput';\nimport { Submission } from '../schema';\nimport './SharedSubmissionForm.css';\n\n// Import the new components and hooks\nimport { RichTextEditor } from '@rich-text-editor';\nimport { useSubmissionForm } from './hooks/useSubmissionForm';\n\ninterface SharedSubmissionFormProps {\n  mode: 'create' | 'reply' | 'edit';\n  parentId?: number;\n  onSuccess?: (result?: {\n    status: number;\n    message?: string;\n    error?: string;\n    submission?: Submission;\n  }) => void;\n  replyToAuthor?: string;\n  contextId?: string;\n  className?: string;\n  // Edit mode props\n  submissionId?: number;\n  initialTitle?: string;\n  initialContent?: string;\n  initialTags?: string;\n}\n\nexport function SharedSubmissionForm({\n  mode,\n  parentId,\n  onSuccess,\n  replyToAuthor,\n  contextId,\n  className = '',\n  submissionId,\n  initialTitle = '',\n  initialContent = '',\n  initialTags = ''\n}: SharedSubmissionFormProps) {\n  const [, setShouldUpdate] = useAtom(shouldUpdateAtom);\n\n  // Use the new submission form hook\n  const {\n    formData,\n    isSubmitting,\n    error,\n    tagErrors,\n    contentViewMode,\n    setContentViewMode,\n    handleInputChange,\n    handleSubmit,\n    isFormValid,\n    titleCharsRemaining,\n    contentCharsRemaining\n  } = useSubmissionForm({\n    mode,\n    initialTitle,\n    initialContent,\n    initialTags,\n    replyToAuthor,\n    submissionId,\n    parentId,\n    onSuccess: (result) => {\n      setShouldUpdate(true);\n      if (onSuccess) {\n        onSuccess(result);\n      }\n    }\n  });\n\n  const isReply = mode === 'reply';\n  const isEdit = mode === 'edit';\n  const titleLabel = isReply\n    ? 'Reply Title'\n    : isEdit\n      ? 'Edit Title'\n      : 'Post Title';\n  const contentLabel = isReply\n    ? 'Reply Content'\n    : isEdit\n      ? 'Edit Content'\n      : 'Post Content';\n  const submitText = isReply\n    ? 'Submit Reply'\n    : isEdit\n      ? 'Update Post'\n      : 'Create Post';\n  const submittingText = isReply\n    ? 'Submitting Reply...'\n    : isEdit\n      ? 'Updating Post...'\n      : 'Creating Post...';\n\n  return (\n    <form\n      onSubmit={handleSubmit}\n      className={`shared-submission-form ${className}`}\n    >\n      {/* Title Field */}\n      <div className=\\\"shared-submission-form__field\\\" data-testid=\\\"title-field\\\">\n        <label className=\\\"shared-submission-form__label\\\">{titleLabel} *</label>\n        <RichTextEditor\n          key={`title-${mode}`}\n          value={formData.title}\n          onChange={(value: string) => handleInputChange('title', value)}\n          placeholder={`Enter a ${isReply ? 'reply' : isEdit ? 'post' : 'post'} title... Use #hashtags, @mentions, and paste URLs!`}\n          className={`shared-submission-form__form-input ${\n            titleCharsRemaining < 0\n              ? 'shared-submission-form__input--error'\n              : ''\n          }`}\n          disabled={isSubmitting}\n          contextId={`${contextId || 'shared-form'}-title`}\n          multiline={false}\n          viewMode=\\\"preview\\\"\n          enableHashtags={true}\n          enableUserMentions={true}\n          enableEmojis={true}\n          enableImagePaste={true}\n        />\n        <div className=\\\"shared-submission-form__char-count\\\">\n          <span\n            className={\n              titleCharsRemaining < 0\n                ? 'shared-submission-form__char-count--error'\n                : ''\n            }\n          >\n            {titleCharsRemaining} characters remaining\n          </span>\n        </div>\n      </div>\n\n      {/* Content Field */}\n      <div className=\\\"shared-submission-form__field\\\">\n        <div className=\\\"shared-submission-form__field-header\\\">\n          <label className=\\\"shared-submission-form__label\\\">\n            {contentLabel} *\n          </label>\n          <div className=\\\"shared-submission-form__view-toggle\\\">\n            <button\n              type=\\\"button\\\"\n              className={`shared-submission-form__toggle-btn ${\n                contentViewMode === 'preview'\n                  ? 'shared-submission-form__toggle-btn--active'\n                  : ''\n              }`}\n              onClick={() => setContentViewMode('preview')}\n              disabled={isSubmitting}\n            >\n              PREVIEW\n            </button>\n            <button\n              type=\\\"button\\\"\n              className={`shared-submission-form__toggle-btn ${\n                contentViewMode === 'raw'\n                  ? 'shared-submission-form__toggle-btn--active'\n                  : ''\n              }`}\n              onClick={() => setContentViewMode('raw')}\n              disabled={isSubmitting}\n            >\n              RAW\n            </button>\n          </div>\n        </div>\n        <RichTextEditor\n          key={`content-${mode}-${contentViewMode}`}\n          value={formData.content}\n          onChange={(value: string) => handleInputChange('content', value)}\n          placeholder={\n            contentViewMode === 'preview'\n              ? `Write your ${isReply ? 'reply' : isEdit ? 'post' : 'post'} content... Use #hashtags, @mentions, and paste URLs!`\n              : `Write your ${isReply ? 'reply' : isEdit ? 'post' : 'post'} content... Raw text mode for easy editing of #hashtags, @mentions, and ![behavior](URLs)`\n          }\n          className={`shared-submission-form__form-input ${\n            contentCharsRemaining < 0\n              ? 'shared-submission-form__textarea--error'\n              : ''\n          }`}\n          disabled={isSubmitting}\n          contextId={`${contextId || 'shared-form'}-content`}\n          multiline={true}\n          viewMode={contentViewMode}\n          enableHashtags={true}\n          enableUserMentions={true}\n          enableEmojis={true}\n          enableImagePaste={true}\n        />\n        <div className=\\\"shared-submission-form__char-count\\\">\n          <span\n            className={\n              contentCharsRemaining < 0\n                ? 'shared-submission-form__char-count--error'\n                : ''\n            }\n          >\n            {contentCharsRemaining} characters remaining\n          </span>\n        </div>\n      </div>\n\n      {/* Tags Field */}\n      <div className=\\\"shared-submission-form__field\\\">\n        <label className=\\\"shared-submission-form__label\\\">Additional Tags</label>\n        <SmartInput\n          value={formData.tags}\n          onChange={(value) => handleInputChange('tags', value)}\n          placeholder=\\\"#tag1, #tag2 or #tag1 #tag2 #tag3\\\"\n          className={`shared-submission-form__input ${\n            tagErrors.length > 0 ? 'shared-submission-form__input--error' : ''\n          }`}\n          disabled={isSubmitting}\n          enableHashtags={true}\n          enableUserMentions={false}\n          as=\\\"input\\\"\n        />\n        {tagErrors.length > 0 && (\n          <div className=\\\"shared-submission-form__tag-errors\\\">\n            {tagErrors.map((error, index) => (\n              <p\n                key={index}\n                className=\\\"shared-submission-form__error-text\\\"\n                role=\\\"alert\\\"\n              >\n                {error}\n              </p>\n            ))}\n          </div>\n        )}\n        <div className=\\\"shared-submission-form__help\\\">\n          <span className=\\\"shared-submission-form__help-text\\\">\n            Tags must start with # and contain only letters, numbers, hyphens,\n            and underscores. You can separate tags with commas (#tag1, #tag2) or\n            spaces (#tag1 #tag2). Tags from your title and content will be\n            automatically detected.\n          </span>\n        </div>\n      </div>\n\n      {/* Error Display */}\n      {error && (\n        <div className=\\\"shared-submission-form__error\\\" role=\\\"alert\\\">\n          {error}\n        </div>\n      )}\n\n      {/* Submit Button */}\n      <div className=\\\"shared-submission-form__actions\\\">\n        <button\n          type=\\\"submit\\\"\n          disabled={\n            !isFormValid ||\n            isSubmitting ||\n            titleCharsRemaining < 0 ||\n            contentCharsRemaining < 0\n          }\n          className=\\\"shared-submission-form__submit\\\"\n        >\n          {isSubmitting ? submittingText : submitText}\n        </button>\n      </div>\n    </form>\n  );\n}\n",
    "language":"typescript",
    "lines":270,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/components/RichInputAdapter.tsx":{
    "content":"/**\n * Adapter component for the new rich input system\n * Provides compatibility with existing form components\n */\n\n'use client';\n\nimport React, { useCallback, useRef, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { RichInput } from '../../../../../lib/rich-input';\nimport { useFocusManagement } from '../hooks/useFocusManagement';\nimport { useSearchOverlay } from '../hooks/useSearchOverlay';\nimport { useTextInsertion } from '../hooks/useTextInsertion';\nimport { useUrlAutoConversion } from '../hooks/useUrlAutoConversion';\nimport { useValueExtraction } from '../hooks/useValueExtraction';\nimport { FloatingToolbar } from './FloatingToolbar';\n\ninterface RichInputAdapterProps {\n  value: string;\n  onChange: (value: string) => void;\n  placeholder: string;\n  className?: string;\n  disabled?: boolean;\n  contextId: string;\n  multiline?: boolean;\n  viewMode?: 'preview' | 'raw';\n  enableHashtags?: boolean;\n  enableUserMentions?: boolean;\n  enableEmojis?: boolean;\n  enableImagePaste?: boolean;\n  mentionFilterType?: 'author' | 'mentions';\n  enableDebugLogging?: boolean;\n}\n\nexport const RichInputAdapter: React.FC<RichInputAdapterProps> = ({\n  value,\n  onChange,\n  placeholder,\n  className = '',\n  disabled = false,\n  contextId,\n  multiline = false,\n  viewMode = 'preview',\n  enableHashtags = true,\n  enableUserMentions = true,\n  enableEmojis = true,\n  enableImagePaste = true,\n  mentionFilterType = 'author',\n  enableDebugLogging = true\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const richInputRef = useRef<any>(null);\n  const [toolbarInteracting, setToolbarInteracting] = useState(false);\n  const [searchOverlayInteracting, setSearchOverlayInteracting] =\n    useState(false);\n\n  // Extract structured content from current value\n  const { existingHashtags, existingUserIds } = useValueExtraction(value);\n\n  // Handle focus management\n  const { isFocused, handleFocus, handleBlur, setInteracting } =\n    useFocusManagement({\n      containerRef,\n      blurDelay: 150\n    });\n\n  // Handle search overlay functionality\n  const {\n    searchOverlay,\n    searchResults,\n    isSearchLoading,\n    handleSearchResultSelect,\n    detectTriggerAndShowOverlay,\n    hideSearchOverlay\n  } = useSearchOverlay({\n    value,\n    onChange,\n    existingHashtags,\n    existingUserIds,\n    mentionFilterType,\n    enableHashtags,\n    enableUserMentions,\n    enableEmojis\n  });\n\n  // Handle text insertion at cursor\n  const { insertAtCursor } = useTextInsertion({\n    value,\n    onChange,\n    richInputRef\n  });\n\n  // Handle URL auto-conversion\n  const { handleValueChangeWithURLDetection } = useUrlAutoConversion({\n    value,\n    onChange,\n    richInputRef\n  });\n\n  // Simple value change handler - only update value and detect search triggers\n  const handleValueChange = useCallback(\n    (newValue: string) => {\n      // Always update the value first for responsive typing\n      onChange(newValue);\n\n      // Only detect search triggers for immediate feedback (hashtags, mentions, emojis)\n      if (richInputRef.current?.getState) {\n        const state = richInputRef.current.getState();\n        detectTriggerAndShowOverlay(newValue, state.cursorPosition?.index || 0);\n      }\n    },\n    [onChange, detectTriggerAndShowOverlay]\n  );\n\n  // Process URL conversion and other heavy processing on blur/enter\n  const handleProcessing = useCallback(\n    (finalValue: string) => {\n      const previousValue = value;\n\n      // Handle URL auto-conversion when user finishes typing\n      handleValueChangeWithURLDetection(finalValue, previousValue);\n    },\n    [value, handleValueChangeWithURLDetection]\n  );\n\n  // Handle interaction state changes\n  const handleToolbarInteractionStart = useCallback(() => {\n    setToolbarInteracting(true);\n    setInteracting(true);\n  }, [setInteracting]);\n\n  const handleToolbarInteractionEnd = useCallback(() => {\n    setToolbarInteracting(false);\n    setInteracting(false);\n    // Re-focus the input after toolbar interaction\n    if (richInputRef.current?.focus) {\n      richInputRef.current.focus();\n    }\n  }, [setInteracting]);\n\n  const handleSearchOverlayInteractionStart = useCallback(() => {\n    setSearchOverlayInteracting(true);\n    setInteracting(true);\n  }, [setInteracting]);\n\n  const handleSearchOverlayInteractionEnd = useCallback(() => {\n    setSearchOverlayInteracting(false);\n    setInteracting(false);\n  }, [setInteracting]);\n\n  // Render search tooltip content\n  const renderSearchTooltip = useCallback(() => {\n    if (!searchOverlay.visible) return null;\n\n    const content = (\n      <div\n        className=\\\"search-overlay-content\\\"\n        onMouseEnter={handleSearchOverlayInteractionStart}\n        onMouseLeave={handleSearchOverlayInteractionEnd}\n      >\n        {isSearchLoading && (\n          <div className=\\\"search-overlay-loading\\\">Searching...</div>\n        )}\n        {!isSearchLoading &&\n          searchResults.length === 0 &&\n          searchOverlay.query.length >= 2 && (\n            <div className=\\\"search-overlay-no-results\\\">\n              No {searchOverlay.type}s found\n            </div>\n          )}\n        {searchResults.map((item, index) => (\n          <button\n            key={item.id || index}\n            className={`search-overlay-item ${item.disabled ? 'search-overlay-item--disabled' : ''}`}\n            onMouseDown={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              if (!item.disabled) {\n                handleSearchResultSelect(item);\n              }\n            }}\n            disabled={item.disabled}\n            title={item.disabled ? 'Already selected' : undefined}\n          >\n            {searchOverlay.type === 'hashtag' && (\n              <span className=\\\"search-overlay-trigger\\\">#</span>\n            )}\n            {searchOverlay.type === 'mention' && (\n              <span className=\\\"search-overlay-trigger\\\">@</span>\n            )}\n            {searchOverlay.type === 'emoji' && (\n              <span className=\\\"search-overlay-trigger\\\">:</span>\n            )}\n            <span className=\\\"search-overlay-label\\\">\n              {searchOverlay.type === 'emoji' && item.unicode && (\n                <span className=\\\"search-overlay-emoji\\\">{item.unicode}</span>\n              )}\n              {item.label || item.name}\n            </span>\n            {item.disabled && (\n              <span className=\\\"search-overlay-indicator\\\">\u2713</span>\n            )}\n          </button>\n        ))}\n      </div>\n    );\n\n    // Calculate position relative to the input container\n    const containerRect = containerRef.current?.getBoundingClientRect();\n    const tooltipStyle = containerRect\n      ? {\n          position: 'fixed' as const,\n          top: containerRect.bottom + 4,\n          left: containerRect.left,\n          zIndex: 1000,\n          pointerEvents: 'auto' as const\n        }\n      : {\n          position: 'fixed' as const,\n          top: 0,\n          left: 0,\n          zIndex: 1000,\n          pointerEvents: 'auto' as const\n        };\n\n    return ReactDOM.createPortal(\n      <div\n        style={{\n          ...tooltipStyle,\n          backgroundColor: 'white',\n          border: '1px solid #e1e5e9',\n          borderRadius: '8px',\n          boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n          maxHeight: '200px',\n          overflowY: 'auto',\n          minWidth: '200px'\n        }}\n      >\n        {content}\n      </div>,\n      document.body\n    );\n  }, [\n    searchOverlay,\n    searchResults,\n    isSearchLoading,\n    handleSearchResultSelect,\n    hideSearchOverlay,\n    handleSearchOverlayInteractionStart,\n    handleSearchOverlayInteractionEnd\n  ]);\n\n  // Raw mode: show simple textarea/input\n  if (viewMode === 'raw') {\n    return (\n      <div className=\\\"rich-input-adapter-raw-container\\\">\n        {React.createElement(multiline ? 'textarea' : 'input', {\n          value,\n          onChange: (\n            e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n          ) => {\n            const newValue = e.target.value;\n            const cursorPosition = e.target.selectionStart || 0;\n            onChange(newValue);\n            detectTriggerAndShowOverlay(newValue, cursorPosition);\n          },\n          placeholder,\n          className: `rich-input-adapter-raw ${className}`,\n          disabled,\n          rows: multiline ? 4 : undefined,\n          onFocus: handleFocus,\n          onBlur: () => {\n            // Process URL conversion and other heavy logic on blur\n            handleProcessing(value);\n            // Then handle focus management\n            handleBlur();\n          },\n          onKeyDown: (\n            e: React.KeyboardEvent<HTMLInputElement | HTMLTextAreaElement>\n          ) => {\n            if (e.key === 'Enter') {\n              // Process URL conversion and other heavy logic on Enter\n              handleProcessing(value);\n            }\n          },\n          onKeyUp: (\n            e: React.KeyboardEvent<HTMLInputElement | HTMLTextAreaElement>\n          ) => {\n            const target = e.target as HTMLInputElement | HTMLTextAreaElement;\n            detectTriggerAndShowOverlay(\n              target.value,\n              target.selectionStart || 0\n            );\n          },\n          style: {\n            width: '100%',\n            minHeight: multiline ? '60px' : '40px',\n            maxHeight: multiline ? '200px' : '40px',\n            border: '1px solid var(--light-border--primary)',\n            borderRadius: 'var(--border-radius)',\n            backgroundColor: 'var(--light-background--primary)',\n            color: 'var(--light-bg__text-color--primary)',\n            padding: '8px 12px',\n            fontSize: '14px',\n            lineHeight: '1.4',\n            fontFamily: 'inherit',\n            resize: multiline ? 'vertical' : 'none'\n          }\n        })}\n\n        {isFocused && (\n          <FloatingToolbar\n            inputRef={{ current: null }}\n            onHashtagInsert={insertAtCursor}\n            onMentionInsert={insertAtCursor}\n            onEmojiInsert={insertAtCursor}\n            disabled={disabled}\n            onToolbarInteractionStart={handleToolbarInteractionStart}\n            onToolbarInteractionEnd={handleToolbarInteractionEnd}\n          />\n        )}\n\n        {renderSearchTooltip()}\n      </div>\n    );\n  }\n\n  // Preview mode: use rich input\n  return (\n    <div\n      ref={containerRef}\n      className=\\\"rich-input-adapter-container\\\"\n      data-rich-text-editor\n    >\n      <RichInput\n        ref={richInputRef}\n        value={value}\n        onChange={handleValueChange}\n        multiline={multiline}\n        placeholder={placeholder}\n        disabled={disabled}\n        parsers={{\n          hashtags: enableHashtags,\n          mentions: enableUserMentions,\n          urls: true,\n          emojis: enableEmojis,\n          images: enableImagePaste,\n          markdown: false\n        }}\n        behavior={{\n          smartSelection: true,\n          autoComplete: false,\n          spellCheck: true\n        }}\n        styling={{\n          className: `rich-input-adapter ${className} ${multiline ? 'rich-input-adapter--multiline' : 'rich-input-adapter--single-line'}`,\n          style: {\n            minHeight: multiline ? '60px' : '40px',\n            maxHeight: multiline ? '200px' : '40px',\n            border: '1px solid var(--light-border--primary)',\n            borderRadius: 'var(--border-radius)',\n            backgroundColor: 'var(--light-background--primary)',\n            padding: '8px 12px',\n            fontSize: '14px',\n            lineHeight: '1.4',\n            fontFamily: 'inherit',\n            overflow: multiline ? 'auto' : 'hidden',\n            whiteSpace: multiline ? 'pre-wrap' : 'nowrap',\n            wordWrap: 'break-word'\n          }\n        }}\n        handlers={{\n          onFocus: handleFocus,\n          onBlur: () => {\n            // Process URL conversion and other heavy logic on blur\n            handleProcessing(value);\n            // Then handle focus management\n            handleBlur();\n          }\n        }}\n        enableDebugLogging={enableDebugLogging}\n      >\n        {(isFocused || toolbarInteracting) && (\n          <FloatingToolbar\n            inputRef={richInputRef}\n            onHashtagInsert={insertAtCursor}\n            onMentionInsert={insertAtCursor}\n            onEmojiInsert={insertAtCursor}\n            disabled={disabled}\n            onToolbarInteractionStart={handleToolbarInteractionStart}\n            onToolbarInteractionEnd={handleToolbarInteractionEnd}\n          />\n        )}\n      </RichInput>\n\n      {renderSearchTooltip()}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":400,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/components/FloatingToolbar.tsx":{
    "content":"'use client';\n\nimport * as React from 'react';\nimport {\n  HashtagResult,\n  searchHashtags,\n  searchUsers,\n  UserResult\n} from '../../../../../lib/actions/search.actions';\nimport { useUserPreferences } from '../../../../../lib/context/UserPreferencesContext';\nimport { InteractiveTooltip } from '../../../tooltip/InteractiveTooltip';\nimport {\n  EmojiData,\n  EmojiPicker,\n  formatEmojiForText\n} from '../../../ui/EmojiPicker';\nimport './FloatingToolbar.css';\n\n// Emoji panel component that accepts closeTooltip prop from InteractiveTooltip\nconst EmojiPanelContent: React.FC<{\n  closeTooltip?: () => void;\n  handleEmojiSelect: (emoji: EmojiData) => void;\n  emojiPanelBehavior: 'close_after_select' | 'stay_open';\n  emojiPickerConfig: {\n    enablePagination: boolean;\n    itemsPerPage?: number;\n    maxResults: number;\n  };\n}> = React.memo(\n  ({\n    closeTooltip: tooltipClose,\n    handleEmojiSelect,\n    emojiPanelBehavior,\n    emojiPickerConfig\n  }) => (\n    <div className=\\\"toolbar-tooltip-panel toolbar-tooltip-panel--wide\\\">\n      <EmojiPicker\n        isOpen={true}\n        onClose={() => {}}\n        onEmojiSelect={(emoji) => {\n          handleEmojiSelect(emoji);\n          // Close tooltip based on user preference\n          if (emojiPanelBehavior === 'close_after_select' && tooltipClose) {\n            // Close the tooltip after a short delay to allow the emoji to be inserted\n            setTimeout(() => {\n              tooltipClose();\n            }, 100);\n          }\n        }}\n        className=\\\"toolbar-emoji-picker\\\"\n        autoFetch={true}\n        enablePagination={emojiPickerConfig.enablePagination}\n        itemsPerPage={emojiPickerConfig.itemsPerPage}\n        maxResults={emojiPickerConfig.maxResults}\n      />\n    </div>\n  )\n);\nEmojiPanelContent.displayName = 'EmojiPanelContent';\n\n// Wrapper function component to receive closeTooltip from InteractiveTooltip\nconst EmojiPanelWrapper = (props: {\n  closeTooltip?: () => void;\n  handleEmojiSelect: (emoji: EmojiData) => void;\n  emojiPanelBehavior: 'close_after_select' | 'stay_open';\n  emojiPickerConfig: {\n    enablePagination: boolean;\n    itemsPerPage?: number;\n    maxResults: number;\n  };\n}) => <EmojiPanelContent {...props} />;\n\ninterface FloatingToolbarProps {\n  inputRef: React.RefObject<HTMLInputElement | HTMLTextAreaElement>;\n  onHashtagInsert: (text: string) => void;\n  onMentionInsert: (text: string) => void;\n  onEmojiInsert: (text: string) => void;\n  disabled?: boolean;\n  onToolbarInteractionStart?: () => void;\n  onToolbarInteractionEnd?: () => void;\n  closeTooltip?: () => void; // Passed by InteractiveTooltip\n}\n\nexport const FloatingToolbar: React.FC<FloatingToolbarProps> = ({\n  inputRef,\n  onHashtagInsert,\n  onMentionInsert,\n  onEmojiInsert,\n  disabled = false,\n  onToolbarInteractionStart,\n  onToolbarInteractionEnd,\n  closeTooltip\n}) => {\n  const { paginationMode, emojiPanelBehavior } = useUserPreferences();\n\n  // State for search functionality within the toolbar tooltips\n  const [hashtagQuery, setHashtagQuery] = React.useState('');\n  const [mentionQuery, setMentionQuery] = React.useState('');\n  const [hashtagResults, setHashtagResults] = React.useState<any[]>([]);\n  const [mentionResults, setMentionResults] = React.useState<any[]>([]);\n  const [loadingHashtags, setLoadingHashtags] = React.useState(false);\n  const [loadingMentions, setLoadingMentions] = React.useState(false);\n\n  // Search hashtags\n  React.useEffect(() => {\n    if (hashtagQuery.length >= 2) {\n      setLoadingHashtags(true);\n\n      const searchHashtagsAsync = async () => {\n        try {\n          const result = await searchHashtags(hashtagQuery, 1, 10);\n          const transformedResults = result.items.map(\n            (hashtag: HashtagResult) => ({\n              id: hashtag.id,\n              label: hashtag.label,\n              value: hashtag.value,\n              count: hashtag.count,\n              disabled: false // No existing hashtags to check against in toolbar\n            })\n          );\n          setHashtagResults(transformedResults);\n        } catch (error) {\n          console.warn('Error searching hashtags:', error);\n          setHashtagResults([\n            {\n              id: `${hashtagQuery}-1`,\n              label: hashtagQuery,\n              value: hashtagQuery.startsWith('#')\n                ? hashtagQuery\n                : `#${hashtagQuery}`,\n              count: 0,\n              disabled: false\n            }\n          ]);\n        } finally {\n          setLoadingHashtags(false);\n        }\n      };\n\n      const timeoutId = setTimeout(searchHashtagsAsync, 300);\n      return () => {\n        clearTimeout(timeoutId);\n        setLoadingHashtags(false);\n      };\n    } else {\n      setHashtagResults([]);\n      setLoadingHashtags(false);\n    }\n  }, [hashtagQuery]);\n\n  // Search mentions\n  React.useEffect(() => {\n    if (mentionQuery.length >= 2) {\n      setLoadingMentions(true);\n\n      const searchUsersAsync = async () => {\n        try {\n          const result = await searchUsers(mentionQuery, 1, 10);\n          const transformedResults = result.items.map((user: UserResult) => ({\n            id: user.id,\n            label: user.label,\n            value: user.value,\n            displayName: user.displayName,\n            avatar: user.avatar,\n            isAuthor: false,\n            disabled: false // No existing users to check against in toolbar\n          }));\n          setMentionResults(transformedResults);\n        } catch (error) {\n          console.warn('Error searching users:', error);\n          setMentionResults([\n            {\n              id: `${mentionQuery}-user`,\n              label: mentionQuery,\n              value: `${mentionQuery}-id`,\n              displayName: mentionQuery,\n              avatar: null,\n              isAuthor: false,\n              disabled: false\n            }\n          ]);\n        } finally {\n          setLoadingMentions(false);\n        }\n      };\n\n      const timeoutId = setTimeout(searchUsersAsync, 300);\n      return () => {\n        clearTimeout(timeoutId);\n        setLoadingMentions(false);\n      };\n    } else {\n      setMentionResults([]);\n      setLoadingMentions(false);\n    }\n  }, [mentionQuery]);\n\n  // Insert hashtag\n  const handleHashtagSelect = (hashtag: any) => {\n    const hashtagText = hashtag.value.startsWith('#')\n      ? hashtag.value\n      : `#${hashtag.value}`;\n    onHashtagInsert(hashtagText + ' ');\n    setHashtagQuery('');\n    // Don't try to focus here - let the RichInputAdapter handle it\n  };\n\n  // Insert mention\n  const handleMentionSelect = (user: any) => {\n    const mentionText = `@[${user.displayName || user.label}|${user.value}|author] `;\n    onMentionInsert(mentionText);\n    setMentionQuery('');\n    // Don't try to focus here - let the RichInputAdapter handle it\n  };\n\n  // Insert emoji\n  const handleEmojiSelect = React.useCallback(\n    (emoji: EmojiData) => {\n      const emojiText = formatEmojiForText(emoji);\n      onEmojiInsert(emojiText + ' '); // Add space after emoji for proper separation\n      // Don't try to focus here - let the RichInputAdapter handle it\n    },\n    [onEmojiInsert]\n  );\n\n  // Prevent mouse down events from propagating to prevent blur, but only on toolbar buttons\n  const handleToolbarMouseDown = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  if (disabled) return null;\n\n  // Determine emoji picker configuration based on user preference\n  const useInfiniteScroll = paginationMode === 'infinite';\n  const emojiPickerConfig = useInfiniteScroll\n    ? {\n        enablePagination: false,\n        maxResults: 500, // Show more emojis for infinite scroll\n        itemsPerPage: undefined\n      }\n    : {\n        enablePagination: true,\n        itemsPerPage: 18,\n        maxResults: 200\n      };\n\n  // Hashtag search panel content\n  const HashtagContent: React.FC<{ closeTooltip?: () => void }> = ({\n    closeTooltip\n  }) => (\n    <div className=\\\"toolbar-tooltip-panel\\\">\n      <div className=\\\"toolbar-search-header\\\">\n        <input\n          type=\\\"text\\\"\n          placeholder=\\\"Search hashtags...\\\"\n          value={hashtagQuery}\n          onChange={(e) => setHashtagQuery(e.target.value)}\n          className=\\\"toolbar-search-input\\\"\n          autoFocus\n        />\n      </div>\n      <div className=\\\"toolbar-search-results\\\">\n        {loadingHashtags && <div className=\\\"toolbar-loading\\\">Searching...</div>}\n        {!loadingHashtags &&\n          hashtagResults.length === 0 &&\n          hashtagQuery.length >= 2 && (\n            <div className=\\\"toolbar-no-results\\\">No hashtags found</div>\n          )}\n        {hashtagResults.map((hashtag, index) => (\n          <button\n            key={hashtag.id || index}\n            className={`toolbar-result-item ${hashtag.disabled ? 'toolbar-result-item--disabled' : ''}`}\n            onClick={() => {\n              if (!hashtag.disabled) {\n                handleHashtagSelect(hashtag);\n                if (closeTooltip) closeTooltip();\n              }\n            }}\n            disabled={hashtag.disabled}\n            title={hashtag.disabled ? 'Already selected' : undefined}\n          >\n            <span className=\\\"toolbar-result-trigger\\\">#</span>\n            <span className=\\\"toolbar-result-label\\\">{hashtag.label}</span>\n            {hashtag.disabled && (\n              <span className=\\\"toolbar-result-indicator\\\">\u2713</span>\n            )}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n\n  // Mention search panel content\n  const MentionContent: React.FC<{ closeTooltip?: () => void }> = ({\n    closeTooltip\n  }) => (\n    <div className=\\\"toolbar-tooltip-panel\\\">\n      <div className=\\\"toolbar-search-header\\\">\n        <input\n          type=\\\"text\\\"\n          placeholder=\\\"Search users...\\\"\n          value={mentionQuery}\n          onChange={(e) => setMentionQuery(e.target.value)}\n          className=\\\"toolbar-search-input\\\"\n          autoFocus\n        />\n      </div>\n      <div className=\\\"toolbar-search-results\\\">\n        {loadingMentions && <div className=\\\"toolbar-loading\\\">Searching...</div>}\n        {!loadingMentions &&\n          mentionResults.length === 0 &&\n          mentionQuery.length >= 2 && (\n            <div className=\\\"toolbar-no-results\\\">No users found</div>\n          )}\n        {mentionResults.map((user, index) => (\n          <button\n            key={user.id || index}\n            className={`toolbar-result-item ${user.disabled ? 'toolbar-result-item--disabled' : ''}`}\n            onClick={() => {\n              if (!user.disabled) {\n                handleMentionSelect(user);\n                if (closeTooltip) closeTooltip();\n              }\n            }}\n            disabled={user.disabled}\n            title={user.disabled ? 'Already selected' : undefined}\n          >\n            {user.avatar && (\n              <img src={user.avatar} alt=\\\"\\\" className=\\\"toolbar-result-avatar\\\" />\n            )}\n            <span className=\\\"toolbar-result-trigger\\\">@</span>\n            <span className=\\\"toolbar-result-label\\\">{user.label}</span>\n            {user.disabled && (\n              <span className=\\\"toolbar-result-indicator\\\">\u2713</span>\n            )}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\\\"floating-toolbar\\\">\n      {/* Hashtag Button with Interactive Tooltip */}\n      <InteractiveTooltip\n        content={<HashtagContent />}\n        delay={0}\n        className=\\\"toolbar-tooltip\\\"\n        triggerOnClick={true}\n        onClose={() => onToolbarInteractionEnd?.()}\n      >\n        <button\n          type=\\\"button\\\"\n          className=\\\"toolbar-button\\\"\n          onMouseDown={(e) => {\n            handleToolbarMouseDown(e);\n            onToolbarInteractionStart?.();\n          }}\n          title=\\\"Insert hashtag\\\"\n          disabled={disabled}\n        >\n          #\n        </button>\n      </InteractiveTooltip>\n\n      {/* Mention Button with Interactive Tooltip */}\n      <InteractiveTooltip\n        content={<MentionContent />}\n        delay={0}\n        className=\\\"toolbar-tooltip\\\"\n        triggerOnClick={true}\n        onClose={() => onToolbarInteractionEnd?.()}\n      >\n        <button\n          type=\\\"button\\\"\n          className=\\\"toolbar-button\\\"\n          onMouseDown={(e) => {\n            handleToolbarMouseDown(e);\n            onToolbarInteractionStart?.();\n          }}\n          title=\\\"Insert mention\\\"\n          disabled={disabled}\n        >\n          @\n        </button>\n      </InteractiveTooltip>\n\n      {/* Emoji Button with Interactive Tooltip */}\n      <InteractiveTooltip\n        content={\n          <EmojiPanelWrapper\n            handleEmojiSelect={handleEmojiSelect}\n            emojiPanelBehavior={emojiPanelBehavior}\n            emojiPickerConfig={emojiPickerConfig}\n          />\n        }\n        triggerOnClick={true}\n        onClose={() => onToolbarInteractionEnd?.()}\n        onShow={() => onToolbarInteractionStart?.()}\n        className=\\\"interactive-tooltip--emoji\\\"\n      >\n        <button\n          className=\\\"toolbar-button\\\"\n          onMouseDown={(e) => {\n            handleToolbarMouseDown(e);\n            onToolbarInteractionStart?.();\n          }}\n          type=\\\"button\\\"\n          aria-label=\\\"Insert emoji\\\"\n          title=\\\"Insert emoji\\\"\n          disabled={disabled}\n        >\n          \ud83d\ude00\n        </button>\n      </InteractiveTooltip>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":420,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.tsx":{
    "content":"'use client';\nimport { useAtom } from 'jotai';\nimport { useEffect, useRef, useState } from 'react';\nimport { useFormState, useFormStatus } from 'react-dom';\nimport { shouldUpdateAtom } from '../../../../lib/state/atoms';\nimport { InteractiveTooltip } from '../../tooltip/InteractiveTooltip';\nimport { canDeleteSubmission, deleteSubmissionAction } from '../actions';\nimport './DeleteSubmissionForm.css';\n\nconst initialState = {\n  status: 0,\n  message: ''\n};\n\ninterface DeletePermission {\n  canDelete: boolean;\n  reason?: string;\n  replyCount?: number;\n}\n\nfunction DeleteButton({\n  isAuthorized,\n  deletePermission\n}: {\n  isAuthorized: boolean;\n  deletePermission: DeletePermission | null;\n}) {\n  const { pending } = useFormStatus();\n\n  // Don't show button at all if user is not authorized\n  if (!isAuthorized) {\n    return null;\n  }\n\n  // Don't show button until permission is checked\n  if (!deletePermission) {\n    return null;\n  }\n\n  const canDelete = deletePermission.canDelete === true;\n  const isDisabled = pending || !canDelete;\n\n  const button = (\n    <button\n      type=\\\"submit\\\"\n      aria-disabled={isDisabled}\n      disabled={isDisabled}\n      className=\\\"submission__delete-btn\\\"\n    >\n      Delete\n    </button>\n  );\n\n  // Show tooltip only for non-permission reasons (like replies existing)\n  if (!canDelete && deletePermission.reason) {\n    const tooltipContent = (\n      <div\n        style={{\n          padding: '8px 12px',\n          fontSize: '14px',\n          lineHeight: '1.4',\n          color: 'white',\n          textAlign: 'center',\n          wordWrap: 'break-word'\n        }}\n      >\n        {deletePermission.reason}\n      </div>\n    );\n\n    return (\n      <InteractiveTooltip\n        content={tooltipContent}\n        isInsideParagraph={true}\n        delay={200}\n      >\n        {button}\n      </InteractiveTooltip>\n    );\n  }\n\n  return button;\n}\n\nexport function DeleteSubmissionForm({\n  id,\n  name,\n  isAuthorized,\n  authorId,\n  onDeleteSuccess\n}: {\n  id: number;\n  name: string;\n  isAuthorized: boolean;\n  authorId?: string | undefined;\n  onDeleteSuccess?: () => void;\n}) {\n  const ref = useRef<HTMLFormElement>(null);\n  const [, setShouldUpdate] = useAtom(shouldUpdateAtom);\n  const [deletePermission, setDeletePermission] =\n    useState<DeletePermission | null>({ canDelete: false });\n  const [state, formAction] = useFormState(\n    deleteSubmissionAction,\n    initialState\n  );\n\n  // Check delete permission when component mounts or dependencies change\n  useEffect(() => {\n    async function checkPermission() {\n      if (isAuthorized && authorId) {\n        try {\n          const permission = await canDeleteSubmission(id, authorId);\n          setDeletePermission(permission);\n        } catch (error) {\n          console.error('Error checking delete permission:', error);\n          setDeletePermission({\n            canDelete: false,\n            reason: 'Unable to verify delete permissions.'\n          });\n        }\n      } else {\n        setDeletePermission({\n          canDelete: false,\n          reason: isAuthorized\n            ? 'Unable to verify permissions.'\n            : 'Login required to delete posts.'\n        });\n      }\n    }\n\n    checkPermission();\n  }, [id, isAuthorized, authorId]);\n\n  useEffect(() => {\n    if (state.status === 1) {\n      // Use optimistic callback if available, otherwise fallback to global update\n      if (onDeleteSuccess) {\n        onDeleteSuccess();\n      } else {\n        setShouldUpdate(true);\n      }\n      ref.current?.reset();\n    }\n  }, [state.status, state.message, onDeleteSuccess, setShouldUpdate]);\n\n  return (\n    <form ref={ref} action={formAction}>\n      <input type=\\\"hidden\\\" name=\\\"submission_id\\\" value={id} />\n      <input type=\\\"hidden\\\" name=\\\"submission_name\\\" value={name} />\n      <DeleteButton\n        isAuthorized={isAuthorized}\n        deletePermission={deletePermission}\n      />\n      <p aria-live=\\\"polite\\\" className=\\\"\\\" role=\\\"status\\\">\n        {state?.message || (state as any)?.error}\n      </p>\n    </form>\n  );\n}\n",
    "language":"typescript",
    "lines":160,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/delete-submission-form/DeleteSubmissionForm.test.tsx":{
    "content":"import { Provider } from 'jotai';\nimport { fireEvent, render, screen, waitFor } from '../../../../test-utils';\nimport { DeleteSubmissionForm } from './DeleteSubmissionForm';\n\n// Mock Jotai atoms instead of old context hooks\njest.mock('jotai', () => ({\n  ...jest.requireActual('jotai'),\n  useAtom: jest.fn().mockReturnValue([false, jest.fn()])\n}));\n\n// Mock the delete submission action\njest.mock('../actions', () => ({\n  deleteSubmissionAction: jest.fn().mockResolvedValue({\n    status: 1,\n    message: 'Submission deleted successfully'\n  })\n}));\n\n// Mock react-dom hooks\njest.mock('react-dom', () => ({\n  ...jest.requireActual('react-dom'),\n  useFormState: jest.fn(),\n  useFormStatus: jest.fn(() => ({ pending: false }))\n}));\n\ndescribe('DeleteSubmissionForm', () => {\n  const defaultProps = {\n    id: 1,\n    name: 'Test Submission',\n    isAuthorized: true\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n\n    // Setup default form state mock\n    const { useFormState } = require('react-dom');\n    useFormState.mockReturnValue([{ status: 0, message: '' }, jest.fn()]);\n  });\n\n  it('renders delete button when authorized', () => {\n    render(\n      <Provider>\n        <DeleteSubmissionForm {...defaultProps} />\n      </Provider>\n    );\n\n    expect(screen.getByRole('button', { name: /delete/i })).toBeInTheDocument();\n  });\n\n  it('handles form submission correctly', async () => {\n    const mockSetShouldUpdate = jest.fn();\n    const mockFormAction = jest.fn();\n\n    const { useAtom } = require('jotai');\n    const { useFormState } = require('react-dom');\n\n    useAtom.mockReturnValue([false, mockSetShouldUpdate]);\n\n    useFormState.mockReturnValue([\n      { status: 1, message: 'Deleted successfully' },\n      mockFormAction\n    ]);\n\n    render(\n      <Provider>\n        <DeleteSubmissionForm {...defaultProps} />\n      </Provider>\n    );\n\n    const deleteButton = screen.getByRole('button', { name: /delete/i });\n    fireEvent.click(deleteButton);\n\n    await waitFor(() => {\n      expect(mockSetShouldUpdate).toHaveBeenCalledWith(true);\n    });\n  });\n\n  it('shows loading state during submission', () => {\n    const { useFormStatus } = require('react-dom');\n    useFormStatus.mockReturnValue({ pending: true });\n\n    render(\n      <Provider>\n        <DeleteSubmissionForm {...defaultProps} />\n      </Provider>\n    );\n\n    const deleteButton = screen.getByRole('button', { name: /delete/i });\n    expect(deleteButton).toBeDisabled();\n  });\n\n  it('displays success message after deletion', () => {\n    const { useFormState } = require('react-dom');\n    useFormState.mockReturnValue([\n      { status: 1, message: 'Deleted successfully' },\n      jest.fn()\n    ]);\n\n    render(\n      <Provider>\n        <DeleteSubmissionForm {...defaultProps} />\n      </Provider>\n    );\n\n    expect(screen.getByText('Deleted successfully')).toBeInTheDocument();\n  });\n\n  it('displays error message on failed deletion', () => {\n    const { useFormState } = require('react-dom');\n    useFormState.mockReturnValue([\n      { status: -1, error: 'Deletion failed' },\n      jest.fn()\n    ]);\n\n    render(\n      <Provider>\n        <DeleteSubmissionForm {...defaultProps} />\n      </Provider>\n    );\n\n    expect(screen.getByText('Deletion failed')).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":125,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/pagination/PageSizeSelector.tsx":{
    "content":"import React, { memo } from 'react';\nimport { PageSize } from 'src/lib/state/atoms';\nimport { PAGINATION_SELECTORS } from 'src/lib/test-selectors/components/pagination.selectors';\n\ntype PageSizeSelectorProps = {\n  pageSize: PageSize;\n  onPageSizeChange: (_newPageSize: PageSize) => void;\n};\n\nconst PageSizeSelector: React.FC<PageSizeSelectorProps> = ({\n  pageSize,\n  onPageSizeChange\n}) => {\n  const handlePageSizeSelect = (\n    event: React.ChangeEvent<HTMLSelectElement>\n  ) => {\n    const newPageSize = Number(event.target.value);\n    onPageSizeChange(newPageSize);\n  };\n\n  return (\n    <select\n      aria-label=\\\"Page size selector\\\"\n      value={pageSize}\n      onChange={handlePageSizeSelect}\n      className=\\\"pagination__page-size-select\\\"\n      data-testid={PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR}\n    >\n      {Object.values(PageSize)\n        .filter((value) => typeof value === 'number')\n        .map((size) => (\n          <option key={size} value={size}>\n            {size}\n          </option>\n        ))}\n    </select>\n  );\n};\n\nexport default memo(PageSizeSelector);\n",
    "language":"typescript",
    "lines":41,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/pagination/StickyPagination.tsx":{
    "content":"'use client';\n\nimport { useCallback, useEffect, useState } from 'react';\nimport Pagination from './Pagination';\nimport './StickyPagination.css';\n\ninterface StickyPaginationProps {\n  id: string;\n  currentPage: number;\n  totalPages: number;\n  pageSize: number;\n  onPageChange: (page: number) => void;\n  onPageSizeChange: (pageSize: number) => void;\n  containerSelector?: string; // CSS selector for the container to monitor\n}\n\nexport function StickyPagination({\n  id,\n  currentPage,\n  totalPages,\n  pageSize,\n  onPageChange,\n  onPageSizeChange,\n  containerSelector = '.posts-manager__controls'\n}: StickyPaginationProps) {\n  const [position, setPosition] = useState<'top' | 'bottom'>('bottom');\n  const [isVisible, setIsVisible] = useState(false);\n\n  const updatePosition = useCallback(() => {\n    const container = document.querySelector(containerSelector);\n    if (!container) return;\n\n    const containerRect = container.getBoundingClientRect();\n    const viewportHeight = window.innerHeight;\n\n    // Show sticky pagination when original pagination is not visible in viewport\n    const isContainerOffScreen =\n      containerRect.bottom < 0 || containerRect.top > viewportHeight;\n\n    setIsVisible(isContainerOffScreen && totalPages > 1);\n\n    // Position based on scroll position - show at top when scrolled down, bottom when at top\n    if (containerRect.top < -50) {\n      // Original pagination is above viewport, show sticky at top\n      setPosition('top');\n    } else if (containerRect.bottom > viewportHeight + 50) {\n      // Original pagination is below viewport, show sticky at bottom\n      setPosition('bottom');\n    }\n  }, [containerSelector, totalPages]);\n\n  useEffect(() => {\n    // Initial check\n    updatePosition();\n\n    // Add scroll listener\n    const handleScroll = () => {\n      requestAnimationFrame(updatePosition);\n    };\n\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    window.addEventListener('resize', handleScroll, { passive: true });\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n      window.removeEventListener('resize', handleScroll);\n    };\n  }, [updatePosition]);\n\n  if (!isVisible || totalPages <= 1) {\n    return null;\n  }\n\n  return (\n    <div\n      className={`sticky-pagination sticky-pagination--${position}`}\n      data-position={position}\n    >\n      <div className=\\\"sticky-pagination__content\\\">\n        <div className=\\\"sticky-pagination__label\\\">\n          Page {currentPage} of {totalPages}\n        </div>\n        <Pagination\n          id={`${id}-sticky`}\n          currentPage={currentPage}\n          totalPages={totalPages}\n          pageSize={pageSize}\n          onPageChange={onPageChange}\n          onPageSizeChange={onPageSizeChange}\n        />\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":95,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/pagination/Pagination.test.tsx":{
    "content":"import { fireEvent, render, screen } from '@testing-library/react';\nimport { PageSize } from '../../../lib/state/atoms';\nimport { PAGINATION_SELECTORS } from '../../../lib/test-selectors/components/pagination.selectors';\nimport Pagination from './Pagination';\n\n// Mock the PageSizeSelector component to avoid import issues\njest.mock('./PageSizeSelector', () => {\n  const {\n    PAGINATION_SELECTORS\n  } = require('../../../lib/test-selectors/components/pagination.selectors');\n  return function MockPageSizeSelector({\n    pageSize,\n    onPageSizeChange\n  }: {\n    pageSize: any;\n    onPageSizeChange: (size: any) => void;\n  }) {\n    return (\n      <select\n        value={pageSize}\n        onChange={(e) => onPageSizeChange(Number(e.target.value))}\n        data-testid={PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR}\n      >\n        <option value={10}>10</option>\n        <option value={20}>20</option>\n        <option value={50}>50</option>\n        <option value={100}>100</option>\n      </select>\n    );\n  };\n});\n\nconst testDataId = 'default';\n\ndescribe('Pagination', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders correctly with initial state', () => {\n    render(\n      <Pagination\n        id={testDataId}\n        currentPage={1}\n        totalPages={3}\n        pageSize={PageSize.TEN}\n      />\n    );\n\n    expect(screen.getByText('Previous')).toBeInTheDocument();\n    expect(screen.getByText('Next')).toBeInTheDocument();\n    expect(screen.getByText('Page 1 of 3')).toBeInTheDocument();\n    expect(screen.getByTestId(PAGINATION_SELECTORS.PAGE_SELECTOR)).toHaveValue(\n      '1'\n    );\n    expect(screen.getByDisplayValue('1')).toBeInTheDocument();\n    expect(screen.getByText('2')).toBeInTheDocument();\n    expect(screen.getByText('3')).toBeInTheDocument();\n    expect(\n      screen.getByTestId(PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR)\n    ).toHaveValue('10');\n  });\n\n  it('handles previous button click', () => {\n    const mockOnPageChange = jest.fn();\n    render(\n      <Pagination\n        id={testDataId}\n        currentPage={1}\n        totalPages={3}\n        onPageChange={mockOnPageChange}\n      />\n    );\n\n    const previousButton = screen.getByText('Previous');\n    fireEvent.click(previousButton);\n\n    // Should not call onPageChange when already on page 1\n    expect(mockOnPageChange).not.toHaveBeenCalled();\n  });\n\n  it('handles next button click', () => {\n    const mockOnPageChange = jest.fn();\n    render(\n      <Pagination\n        id={testDataId}\n        currentPage={1}\n        totalPages={3}\n        onPageChange={mockOnPageChange}\n      />\n    );\n\n    const nextButton = screen.getByText('Next');\n    fireEvent.click(nextButton);\n\n    expect(mockOnPageChange).toHaveBeenCalledWith(2);\n  });\n\n  it('handles page selection', () => {\n    const mockOnPageChange = jest.fn();\n    render(\n      <Pagination\n        id={testDataId}\n        currentPage={1}\n        totalPages={4}\n        onPageChange={mockOnPageChange}\n      />\n    );\n\n    const pageSelector = screen.getByTestId(PAGINATION_SELECTORS.PAGE_SELECTOR);\n    fireEvent.change(pageSelector, { target: { value: '3' } });\n\n    expect(mockOnPageChange).toHaveBeenCalledWith(3);\n  });\n\n  it('handles page size selection', () => {\n    const mockOnPageSizeChange = jest.fn();\n    render(\n      <Pagination\n        id={testDataId}\n        currentPage={1}\n        totalPages={2}\n        pageSize={PageSize.TEN}\n        onPageSizeChange={mockOnPageSizeChange}\n      />\n    );\n\n    const pageSizeSelector = screen.getByTestId(\n      PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR\n    );\n\n    expect(screen.getByDisplayValue('10')).toBeInTheDocument();\n    expect(screen.getByText('20')).toBeInTheDocument();\n    expect(screen.getByText('50')).toBeInTheDocument();\n    expect(screen.getByText('100')).toBeInTheDocument();\n\n    fireEvent.change(pageSizeSelector, { target: { value: '50' } });\n\n    expect(mockOnPageSizeChange).toHaveBeenCalledWith(50);\n  });\n\n  it('disables previous button on first page', () => {\n    render(<Pagination id={testDataId} currentPage={1} totalPages={3} />);\n\n    const previousButton = screen.getByText('Previous');\n    expect(previousButton).toBeDisabled();\n  });\n\n  it('disables next button on last page', () => {\n    render(<Pagination id={testDataId} currentPage={1} totalPages={1} />);\n\n    // Component should not render when totalPages <= 1\n    expect(screen.queryByText('Previous')).not.toBeInTheDocument();\n    expect(screen.queryByText('Next')).not.toBeInTheDocument();\n  });\n\n  it('shows correct page information for middle page', () => {\n    render(<Pagination id={testDataId} currentPage={3} totalPages={5} />);\n\n    expect(screen.getByText('Page 3 of 5')).toBeInTheDocument();\n    expect(screen.getByTestId(PAGINATION_SELECTORS.PAGE_SELECTOR)).toHaveValue(\n      '3'\n    );\n  });\n\n  it('handles different page sizes correctly', () => {\n    render(\n      <Pagination\n        id={testDataId}\n        currentPage={1}\n        totalPages={2}\n        pageSize={PageSize.TWENTY}\n      />\n    );\n\n    expect(\n      screen.getByTestId(PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR)\n    ).toHaveValue('20');\n  });\n\n  it('does not render when totalPages is 1 or less', () => {\n    render(<Pagination id={testDataId} currentPage={1} totalPages={1} />);\n\n    expect(screen.queryByText('Previous')).not.toBeInTheDocument();\n    expect(screen.queryByText('Next')).not.toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":188,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/pagination/PageSizeSelector.test.tsx":{
    "content":"import { fireEvent, render, screen } from '@testing-library/react';\nimport { PageSize } from 'src/lib/state/atoms';\nimport { PAGINATION_SELECTORS } from 'src/lib/test-selectors/components/pagination.selectors';\nimport PageSizeSelector from './PageSizeSelector';\n\ndescribe('PageSizeSelector', () => {\n  const mockOnPageSizeChange = jest.fn();\n\n  beforeEach(() => {\n    mockOnPageSizeChange.mockClear();\n  });\n\n  it('renders with correct options', () => {\n    render(\n      <PageSizeSelector\n        pageSize={PageSize.TEN}\n        onPageSizeChange={mockOnPageSizeChange}\n      />\n    );\n\n    const selector = screen.getByTestId(\n      PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR\n    );\n    expect(selector).toBeInTheDocument();\n\n    const options = screen.getAllByRole('option');\n    const pageSizeValues = Object.values(PageSize).filter(\n      (value) => typeof value === 'number'\n    );\n\n    expect(options).toHaveLength(pageSizeValues.length);\n\n    options.forEach((option, index) => {\n      expect(option).toHaveValue(pageSizeValues[index].toString());\n      expect(option).toHaveTextContent(pageSizeValues[index].toString());\n    });\n  });\n\n  it('selects the correct option based on pageSize prop', () => {\n    render(\n      <PageSizeSelector\n        pageSize={PageSize.TWENTY}\n        onPageSizeChange={mockOnPageSizeChange}\n      />\n    );\n\n    const selector = screen.getByTestId(\n      PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR\n    ) as HTMLSelectElement;\n    expect(selector.value).toBe(PageSize.TWENTY.toString());\n  });\n\n  it('calls onPageSizeChange when a new option is selected', () => {\n    render(\n      <PageSizeSelector\n        pageSize={PageSize.TEN}\n        onPageSizeChange={mockOnPageSizeChange}\n      />\n    );\n\n    const selector = screen.getByTestId(\n      PAGINATION_SELECTORS.PAGE_SIZE_SELECTOR\n    );\n    fireEvent.change(selector, {\n      target: { value: PageSize.FIFTY.toString() }\n    });\n\n    expect(mockOnPageSizeChange).toHaveBeenCalledTimes(1);\n    expect(mockOnPageSizeChange).toHaveBeenCalledWith(PageSize.FIFTY);\n  });\n\n  it('has the correct aria-label', () => {\n    render(\n      <PageSizeSelector\n        pageSize={PageSize.TEN}\n        onPageSizeChange={mockOnPageSizeChange}\n      />\n    );\n\n    const selector = screen.getByLabelText('Page size selector');\n    expect(selector).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":84,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/pagination/Pagination.tsx":{
    "content":"'use client';\nimport { PageSize } from '../../../lib/state/atoms';\nimport { PAGINATION_SELECTORS } from '../../../lib/test-selectors/components/pagination.selectors';\nimport PageSizeSelector from './PageSizeSelector';\nimport './Pagination.css';\n\ninterface PaginationProps {\n  id: string;\n  currentPage?: number;\n  totalPages?: number;\n  pageSize?: PageSize;\n  onPageChange?: (page: number) => void;\n  onPageSizeChange?: (pageSize: PageSize) => void;\n}\n\nfunction Pagination({\n  id,\n  currentPage = 1,\n  totalPages = 1,\n  pageSize = 10,\n  onPageChange,\n  onPageSizeChange\n}: PaginationProps) {\n  const handlePrevious = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    if (currentPage > 1 && onPageChange) {\n      const newPage = currentPage - 1;\n      onPageChange(newPage);\n    }\n  };\n\n  const handleNext = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    if (currentPage < totalPages && onPageChange) {\n      const newPage = currentPage + 1;\n      onPageChange(newPage);\n    }\n  };\n\n  const handlePageSelect = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    const newPage = Number(event.target.value);\n    if (onPageChange) {\n      onPageChange(newPage);\n    }\n  };\n\n  const handlePageSizeSelect = (newPageSize: PageSize) => {\n    if (onPageSizeChange) {\n      onPageSizeChange(newPageSize);\n    }\n  };\n\n  // Don't render if only one page\n  if (totalPages <= 1) {\n    return null;\n  }\n\n  return (\n    <div className=\\\"pagination\\\">\n      <div className=\\\"pagination__info\\\">\n        <span\n          className=\\\"pagination__page-info\\\"\n          data-testid={PAGINATION_SELECTORS.STATE}\n        >\n          Page {currentPage} of {totalPages}\n        </span>\n      </div>\n\n      <div className=\\\"pagination__controls\\\">\n        <button\n          type=\\\"button\\\"\n          onClick={handlePrevious}\n          disabled={currentPage === 1}\n          className=\\\"pagination__button pagination__button--prev\\\"\n          data-testid={PAGINATION_SELECTORS.PREVIOUS}\n          aria-label=\\\"Go to previous page\\\"\n        >\n          <svg\n            width=\\\"16\\\"\n            height=\\\"16\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n          >\n            <polyline points=\\\"15,18 9,12 15,6\\\"></polyline>\n          </svg>\n          Previous\n        </button>\n\n        <div className=\\\"pagination__page-selector-container\\\">\n          <select\n            aria-label=\\\"Current page selector\\\"\n            value={currentPage}\n            onChange={handlePageSelect}\n            className=\\\"pagination__page-select\\\"\n            data-testid={PAGINATION_SELECTORS.PAGE_SELECTOR}\n          >\n            {Array.from({ length: totalPages }, (_, index) => (\n              <option key={index + 1} value={index + 1}>\n                {index + 1}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <button\n          type=\\\"button\\\"\n          onClick={handleNext}\n          disabled={currentPage === totalPages}\n          className=\\\"pagination__button pagination__button--next\\\"\n          data-testid={PAGINATION_SELECTORS.NEXT}\n          aria-label=\\\"Go to next page\\\"\n        >\n          Next\n          <svg\n            width=\\\"16\\\"\n            height=\\\"16\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n          >\n            <polyline points=\\\"9,18 15,12 9,6\\\"></polyline>\n          </svg>\n        </button>\n      </div>\n\n      <div className=\\\"pagination__page-size\\\">\n        <label className=\\\"pagination__page-size-label\\\">\n          Show:\n          <PageSizeSelector\n            pageSize={pageSize as PageSize}\n            onPageSizeChange={handlePageSizeSelect}\n          />\n        </label>\n      </div>\n    </div>\n  );\n}\n\nexport default Pagination;\n",
    "language":"typescript",
    "lines":143,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/filter-bar/FilterBar.tsx":{
    "content":"'use client';\n\nimport { useAtom } from 'jotai';\nimport { useEffect } from 'react';\nimport { Filter, getSubmissionsFiltersAtom } from '../../../lib/state/atoms';\nimport { PostFilters } from '../../../lib/types/filters';\nimport './FilterBar.css';\nimport { FilterLabel } from './FilterLabel';\n\nfunction dedupeStringArray(arr: string[]): string[] {\n  return [...new Set(arr)];\n}\n\ninterface FilterBarProps {\n  filterId: string;\n  filters: Filter<PostFilters>[];\n  onRemoveFilter: (filterType: PostFilters, filterValue?: string) => void;\n  onRemoveTag: (tagToRemove: string) => void;\n  onClearFilters: () => void;\n  onUpdateFilter?: (name: string, value: string) => void;\n}\n\nexport default function FilterBar({\n  filterId,\n  filters,\n  onRemoveFilter,\n  onRemoveTag,\n  onClearFilters,\n  onUpdateFilter\n}: FilterBarProps) {\n  // Add direct Jotai access for debugging\n  const [filtersState, setFiltersState] = useAtom(\n    getSubmissionsFiltersAtom(filterId)\n  );\n\n  // Handle filter type change events from FilterLabel components\n  useEffect(() => {\n    const handleFilterTypeChange = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { filterType, value, oldFilterType, oldValue } = customEvent.detail;\n\n      // Remove the old filter first\n      onRemoveFilter(oldFilterType as PostFilters, oldValue);\n\n      // Add the new filter using the proper function\n      // We need to access the addFilter function from the parent component\n      // Since we don't have direct access, we'll dispatch another event that the parent can listen to\n      setTimeout(() => {\n        const addFilterEvent = new CustomEvent('addFilterFromToggle', {\n          detail: {\n            filterType,\n            value\n          }\n        });\n        window.dispatchEvent(addFilterEvent);\n      }, 50); // Increased delay to ensure removal completes first\n    };\n\n    window.addEventListener('filterTypeChange', handleFilterTypeChange);\n\n    return () => {\n      window.removeEventListener('filterTypeChange', handleFilterTypeChange);\n    };\n  }, [onRemoveFilter]);\n\n  // Add null check for filters\n  const safeFilters = filters || [];\n\n  // Enhanced logic: if filters is empty or undefined, don't render\n  if (!safeFilters || safeFilters.length === 0) {\n    return null;\n  }\n\n  const handleClearFilters = () => {\n    onClearFilters();\n  };\n\n  // Get logic values from filters\n  const tagLogic =\n    safeFilters.find((f) => f.name === 'tagLogic')?.value || 'OR';\n  const authorLogic =\n    safeFilters.find((f) => f.name === 'authorLogic')?.value || 'OR';\n  const mentionsLogic =\n    safeFilters.find((f) => f.name === 'mentionsLogic')?.value || 'OR';\n  const searchLogic =\n    safeFilters.find((f) => f.name === 'searchLogic')?.value || 'OR';\n  const globalLogic =\n    safeFilters.find((f) => f.name === 'globalLogic')?.value || 'AND';\n\n  const hasTagsFilter = safeFilters.some((f) => f.name === 'tags');\n  const hasAuthorFilter = safeFilters.some((f) => f.name === 'author');\n  const hasMentionsFilter = safeFilters.some((f) => f.name === 'mentions');\n  const hasSearchFilter = safeFilters.some((f) => f.name === 'search');\n  const filterTypeCount = [\n    hasTagsFilter,\n    hasAuthorFilter,\n    hasMentionsFilter,\n    hasSearchFilter\n  ].filter(Boolean).length;\n  const hasMultipleFilterTypes = filterTypeCount > 1;\n\n  // Check if there are any actual content filters (not logic filters) with values\n  const hasContentFilters = safeFilters.some((filter) => {\n    // Only count non-logic filters that have actual values\n    const isLogicFilter = [\n      'tagLogic',\n      'authorLogic',\n      'mentionsLogic',\n      'searchLogic',\n      'globalLogic'\n    ].includes(filter.name);\n\n    return !isLogicFilter && filter.value && filter.value.trim() !== '';\n  });\n\n  // Auto-switch global logic to OR when there's only one filter type\n  // This prevents the confusing state where global=ALL but there's only one group\n  const effectiveGlobalLogic = hasMultipleFilterTypes ? globalLogic : 'OR';\n\n  // DISABLED: Auto-switch global logic to prevent double fetches\n  // The tag/hashtag click handlers now add globalLogic atomically\n  // if (\n  //   onUpdateFilter &&\n  //   globalLogic !== effectiveGlobalLogic &&\n  //   !hasMultipleFilterTypes\n  // ) {\n  //   // Automatically switch to OR when there's only one filter type\n  //   setTimeout(() => onUpdateFilter('globalLogic', 'OR'), 0);\n  // }\n\n  const handleLogicToggle = (\n    filterType: 'tagLogic' | 'authorLogic' | 'mentionsLogic' | 'globalLogic'\n  ) => {\n    if (!onUpdateFilter) return;\n\n    const currentValue =\n      safeFilters.find((f) => f.name === filterType)?.value ||\n      (filterType === 'globalLogic' ? 'AND' : 'OR');\n    const newValue = currentValue === 'AND' ? 'OR' : 'AND';\n\n    // Use consistent update mechanism for all filter types\n    onUpdateFilter(filterType, newValue);\n  };\n\n  return (\n    <article className=\\\"filter-bar__container\\\">\n      {/* Compact filter display with integrated global logic */}\n      <div className=\\\"filter-bar__filters-compact\\\">\n        {/* Global Logic Toggle - inline with filters when multiple filter types are active */}\n        {hasMultipleFilterTypes && onUpdateFilter && (\n          <div className=\\\"filter-bar__global-logic-inline\\\">\n            <span className=\\\"filter-bar__logic-label\\\">Groups:</span>\n            <div className=\\\"filter-bar__logic-button-group\\\">\n              <button\n                className={`filter-bar__logic-button ${effectiveGlobalLogic === 'AND' ? 'filter-bar__logic-button--active' : ''}`}\n                onClick={() => onUpdateFilter('globalLogic', 'AND')}\n                title=\\\"All filter groups must match\\\"\n              >\n                ALL\n              </button>\n              <button\n                className={`filter-bar__logic-button ${effectiveGlobalLogic === 'OR' ? 'filter-bar__logic-button--active' : ''}`}\n                onClick={() => onUpdateFilter('globalLogic', 'OR')}\n                title=\\\"Any filter group can match\\\"\n              >\n                ANY\n              </button>\n            </div>\n          </div>\n        )}\n\n        {safeFilters\n          .filter(\n            (filter) =>\n              ![\n                'tagLogic',\n                'authorLogic',\n                'mentionsLogic',\n                'searchLogic',\n                'globalLogic'\n              ].includes(filter.name)\n          )\n          // Group filters by name to consolidate multiple values\n          // For author and mentions: keep as separate instances but group them for display\n          // For tags and search: consolidate values with comma separation\n          .reduce((acc, filter) => {\n            if (filter.name === 'author' || filter.name === 'mentions') {\n              // For user filters, group all values under a single consolidated entry\n              const existingFilter = acc.find((f) => f.name === filter.name);\n              if (existingFilter) {\n                // Combine values with comma separation for display purposes only\n                existingFilter.value =\n                  existingFilter.value + ',' + filter.value;\n              } else {\n                acc.push({ ...filter });\n              }\n            } else {\n              // Consolidate other filter types (tags, search)\n              const existingFilter = acc.find((f) => f.name === filter.name);\n              if (existingFilter) {\n                // Consolidate values with comma separation\n                existingFilter.value =\n                  existingFilter.value + ',' + filter.value;\n              } else {\n                acc.push({ ...filter });\n              }\n            }\n            return acc;\n          }, [] as Filter<PostFilters>[])\n          .map((filter, filterIndex) => {\n            if (!filter.value) {\n              return null;\n            }\n\n            // Handle comma-separated values for all filter types\n            let values: string[];\n            let hasMultipleValues: boolean;\n\n            if (filter.name === 'search') {\n              // For search filters, parse the search text to preserve quoted phrases\n              const searchTerms: string[] = [];\n              const regex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n              let match;\n\n              while ((match = regex.exec(filter.value)) !== null) {\n                const quotedTerm = match[1]; // Captured quoted content\n                const unquotedTerm = match[2]; // Captured unquoted content\n\n                if (quotedTerm && quotedTerm.length >= 1) {\n                  // Preserve quotes for atomic phrases\n                  searchTerms.push(`\\\"${quotedTerm}\\\"`);\n                } else if (unquotedTerm && unquotedTerm.length >= 1) {\n                  // Individual words without quotes\n                  searchTerms.push(unquotedTerm);\n                }\n              }\n\n              values = searchTerms;\n              hasMultipleValues = searchTerms.length > 1;\n            } else {\n              // For other filter types, use comma separation\n              values = dedupeStringArray(\n                filter.value\n                  .split(',')\n                  .map((v) => v.trim())\n                  .filter((v) => v)\n              );\n              hasMultipleValues = values.length > 1;\n            }\n\n            if (values.length === 0) {\n              return null;\n            }\n\n            // When globalLogic is AND, force all individual filters to AND\n            // When globalLogic is OR, use individual filter logic settings\n            const effectiveLogic =\n              effectiveGlobalLogic === 'AND'\n                ? 'AND'\n                : filter.name === 'tags'\n                  ? tagLogic\n                  : filter.name === 'author'\n                    ? authorLogic\n                    : filter.name === 'mentions'\n                      ? mentionsLogic\n                      : filter.name === 'search'\n                        ? searchLogic\n                        : 'OR';\n\n            const currentLogic = effectiveLogic;\n\n            return (\n              <div\n                key={`${filter.name}-${filter.value}-${filterIndex}-consolidated`}\n                className=\\\"filter-bar__filter-compact\\\"\n              >\n                <div className=\\\"filter-bar__filter-inline\\\">\n                  <span className=\\\"filter-bar__filter-label\\\">\n                    {filter.name}:\n                  </span>\n\n                  {/* Logic toggle for multi-value filters */}\n                  {hasMultipleValues && onUpdateFilter && (\n                    <div className=\\\"filter-bar__logic-toggle-inline\\\">\n                      <div className=\\\"filter-bar__logic-button-group\\\">\n                        <button\n                          className={`filter-bar__logic-button ${\n                            currentLogic === 'AND'\n                              ? 'filter-bar__logic-button--active'\n                              : ''\n                          } ${effectiveGlobalLogic === 'AND' ? 'filter-bar__logic-button--disabled' : ''}`}\n                          onClick={() => {\n                            // Only allow changes when globalLogic is OR\n                            if (effectiveGlobalLogic === 'OR') {\n                              const logicType =\n                                filter.name === 'tags'\n                                  ? 'tagLogic'\n                                  : filter.name === 'author'\n                                    ? 'authorLogic'\n                                    : filter.name === 'mentions'\n                                      ? 'mentionsLogic'\n                                      : filter.name === 'search'\n                                        ? 'searchLogic'\n                                        : 'tagLogic';\n                              onUpdateFilter(logicType, 'AND');\n                            }\n                          }}\n                          disabled={effectiveGlobalLogic === 'AND'}\n                          title={\n                            effectiveGlobalLogic === 'AND'\n                              ? `Controlled by Groups setting - set Groups to ANY to change`\n                              : `Must have ALL selected ${filter.name}`\n                          }\n                        >\n                          ALL\n                        </button>\n                        <button\n                          className={`filter-bar__logic-button ${\n                            currentLogic === 'OR'\n                              ? 'filter-bar__logic-button--active'\n                              : ''\n                          } ${effectiveGlobalLogic === 'AND' ? 'filter-bar__logic-button--disabled' : ''}`}\n                          onClick={() => {\n                            // Only allow changes when globalLogic is OR\n                            if (effectiveGlobalLogic === 'OR') {\n                              const logicType =\n                                filter.name === 'tags'\n                                  ? 'tagLogic'\n                                  : filter.name === 'author'\n                                    ? 'authorLogic'\n                                    : filter.name === 'mentions'\n                                      ? 'mentionsLogic'\n                                      : filter.name === 'search'\n                                        ? 'searchLogic'\n                                        : 'tagLogic';\n                              onUpdateFilter(logicType, 'OR');\n                            }\n                          }}\n                          disabled={effectiveGlobalLogic === 'AND'}\n                          title={\n                            effectiveGlobalLogic === 'AND'\n                              ? `Controlled by Groups setting - set Groups to ANY to change`\n                              : `Must have ANY selected ${filter.name}`\n                          }\n                        >\n                          ANY\n                        </button>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Filter values */}\n                  <div className=\\\"filter-bar__filter-values-inline\\\">\n                    {values.map((value, valueIndex) => (\n                      <div\n                        key={`${filter.name}-${value}-${valueIndex}`}\n                        className=\\\"filter-bar__filter-value-container\\\"\n                      >\n                        <FilterLabel\n                          name={filter.name}\n                          label={value}\n                          filterId={filterId}\n                          onRemoveTag={onRemoveTag}\n                          onRemoveFilter={(filterName, filterValue) =>\n                            onRemoveFilter(\n                              filterName as PostFilters,\n                              filterValue\n                            )\n                          }\n                        />\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n\n        {hasContentFilters && (\n          <button\n            className=\\\"filter-bar__clear-all-button-compact\\\"\n            onClick={handleClearFilters}\n            aria-label=\\\"Clear all filters\\\"\n            title=\\\"Clear all filters\\\"\n          >\n            Clear\n          </button>\n        )}\n      </div>\n    </article>\n  );\n}\n",
    "language":"typescript",
    "lines":393,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/filter-bar/FilterBar.test.tsx":{
    "content":"import '@testing-library/jest-dom';\nimport { fireEvent, render, screen, waitFor } from '@testing-library/react';\nimport { createStore, Provider } from 'jotai';\nimport { Filter } from '../../../lib/state/atoms';\nimport { PostFilters } from '../../../lib/types/filters';\nimport FilterBar from './FilterBar';\n\n// Mock the atoms module\njest.mock('../../../lib/state/atoms', () => ({\n  getDisplayFiltersAtom: jest.fn().mockReturnValue({\n    read: jest.fn(),\n    write: jest.fn()\n  }),\n  getSubmissionsFiltersAtom: jest.fn().mockReturnValue({\n    read: jest.fn(),\n    write: jest.fn()\n  })\n}));\n\njest.mock('jotai', () => ({\n  ...jest.requireActual('jotai'),\n  useAtom: jest.fn().mockReturnValue([[], jest.fn()]) // displayFilters is an array\n}));\n\n// Mock Next.js navigation\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    prefetch: jest.fn()\n  }),\n  useSearchParams: () => new URLSearchParams(),\n  usePathname: () => '/test'\n}));\n\n// Mock the FilterLabel component\njest.mock('./FilterLabel', () => {\n  return {\n    FilterLabel: ({ name, label, onRemoveFilter, onRemoveTag }: any) => (\n      <div data-testid={`filter-label-${name}-${label}`}>\n        <span>\n          {name}: {label}\n        </span>\n        <button\n          onClick={() => onRemoveFilter?.(name, label)}\n          data-testid={`remove-filter-${name}-${label}`}\n        >\n          Remove\n        </button>\n        <button\n          onClick={() => onRemoveTag?.(label)}\n          data-testid={`remove-tag-${label}`}\n        >\n          Remove Tag\n        </button>\n      </div>\n    )\n  };\n});\n\n// Mock the utils\njest.mock('./utils/get-tags', () => ({\n  getTagsFromSearchParams: (value: string) => {\n    return value\n      .split(',')\n      .map((tag) => tag.trim().replace('#', ''))\n      .filter(Boolean);\n  }\n}));\n\ndescribe('FilterBar Component', () => {\n  let store: ReturnType<typeof createStore>;\n  let mockOnRemoveFilter: jest.Mock;\n  let mockOnRemoveTag: jest.Mock;\n  let mockOnClearFilters: jest.Mock;\n  let mockOnUpdateFilter: jest.Mock;\n\n  beforeEach(() => {\n    store = createStore();\n    mockOnRemoveFilter = jest.fn();\n    mockOnRemoveTag = jest.fn();\n    mockOnClearFilters = jest.fn();\n    mockOnUpdateFilter = jest.fn();\n  });\n\n  const renderFilterBar = (filters: Filter<PostFilters>[] = []) => {\n    return render(\n      <Provider store={store}>\n        <FilterBar\n          filterId=\\\"test\\\"\n          filters={filters}\n          onRemoveFilter={mockOnRemoveFilter}\n          onRemoveTag={mockOnRemoveTag}\n          onClearFilters={mockOnClearFilters}\n          onUpdateFilter={mockOnUpdateFilter}\n        />\n      </Provider>\n    );\n  };\n\n  describe('Rendering', () => {\n    it('should not render when filters array is empty', () => {\n      const { container } = renderFilterBar([]);\n      expect(container.firstChild).toBeNull();\n    });\n\n    it('should not render when filters is null or undefined', () => {\n      const { container } = render(\n        <Provider store={store}>\n          <FilterBar\n            filterId=\\\"test\\\"\n            filters={null as any}\n            onRemoveFilter={mockOnRemoveFilter}\n            onRemoveTag={mockOnRemoveTag}\n            onClearFilters={mockOnClearFilters}\n            onUpdateFilter={mockOnUpdateFilter}\n          />\n        </Provider>\n      );\n      expect(container.firstChild).toBeNull();\n    });\n\n    it('should render basic filters', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' },\n        { name: 'author', value: '123' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(screen.getByText('tags:')).toBeInTheDocument();\n      expect(screen.getByText('author:')).toBeInTheDocument();\n      expect(\n        screen.getByRole('button', { name: 'Clear all filters' })\n      ).toBeInTheDocument();\n    });\n\n    it('should render consolidated filters', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' },\n        { name: 'tags', value: '#typescript' },\n        { name: 'author', value: '123' },\n        { name: 'author', value: '456' }\n      ];\n\n      renderFilterBar(filters);\n\n      // Should consolidate multiple filters of the same type\n      expect(\n        screen.getByTestId('filter-label-tags-#react')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-tags-#typescript')\n      ).toBeInTheDocument();\n      expect(screen.getByTestId('filter-label-author-123')).toBeInTheDocument();\n      expect(screen.getByTestId('filter-label-author-456')).toBeInTheDocument();\n    });\n  });\n\n  describe('Logic Controls', () => {\n    it('should show global logic controls when multiple filter types exist', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' },\n        { name: 'author', value: '123' },\n        { name: 'globalLogic', value: 'AND' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(screen.getByText('Groups:')).toBeInTheDocument();\n      expect(\n        screen.getByTitle('All filter groups must match')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTitle('Any filter group can match')\n      ).toBeInTheDocument();\n    });\n\n    it('should not show global logic controls with single filter type', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(screen.queryByText('Groups:')).not.toBeInTheDocument();\n    });\n\n    it('should highlight active global logic button', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' },\n        { name: 'author', value: '123' },\n        { name: 'globalLogic', value: 'OR' }\n      ];\n\n      renderFilterBar(filters);\n\n      const allButton = screen.getByTitle('All filter groups must match');\n      const anyButton = screen.getByTitle('Any filter group can match');\n\n      expect(allButton).not.toHaveClass('filter-bar__logic-button--active');\n      expect(anyButton).toHaveClass('filter-bar__logic-button--active');\n    });\n\n    it('should show filter-specific logic controls for multi-value filters', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' },\n        { name: 'tagLogic', value: 'AND' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(\n        screen.getByTitle('Must have ALL selected tags')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTitle('Must have ANY selected tags')\n      ).toBeInTheDocument();\n    });\n\n    it('should not show filter-specific logic controls for single-value filters', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(\n        screen.queryByRole('button', { name: 'Must have ALL selected tags' })\n      ).not.toBeInTheDocument();\n      expect(\n        screen.queryByRole('button', { name: 'Must have ANY selected tags' })\n      ).not.toBeInTheDocument();\n    });\n  });\n\n  describe('User Interactions', () => {\n    it('should call onClearFilters when clear button is clicked', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' }\n      ];\n\n      renderFilterBar(filters);\n\n      const clearButton = screen.getByRole('button', {\n        name: 'Clear all filters'\n      });\n      fireEvent.click(clearButton);\n\n      expect(mockOnClearFilters).toHaveBeenCalledTimes(1);\n    });\n\n    it('should call onUpdateFilter when global logic buttons are clicked', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' },\n        { name: 'author', value: '123' },\n        { name: 'globalLogic', value: 'AND' }\n      ];\n\n      renderFilterBar(filters);\n\n      const orButton = screen.getByTitle('Any filter group can match');\n      fireEvent.click(orButton);\n\n      expect(mockOnUpdateFilter).toHaveBeenCalledWith('globalLogic', 'OR');\n    });\n\n    it('should call onUpdateFilter when filter-specific logic buttons are clicked', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' },\n        { name: 'tagLogic', value: 'OR' }\n      ];\n\n      renderFilterBar(filters);\n\n      const allButton = screen.getByTitle('Must have ALL selected tags');\n      fireEvent.click(allButton);\n\n      expect(mockOnUpdateFilter).toHaveBeenCalledWith('tagLogic', 'AND');\n    });\n\n    it('should handle author logic buttons correctly', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'author', value: '123,456' },\n        { name: 'authorLogic', value: 'OR' }\n      ];\n\n      renderFilterBar(filters);\n\n      const allButton = screen.getByTitle('Must have ALL selected author');\n      fireEvent.click(allButton);\n\n      expect(mockOnUpdateFilter).toHaveBeenCalledWith('authorLogic', 'AND');\n    });\n\n    it('should handle mentions logic buttons correctly', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'mentions', value: '@user1,@user2' },\n        { name: 'mentionsLogic', value: 'OR' }\n      ];\n\n      renderFilterBar(filters);\n\n      const allButton = screen.getByTitle('Must have ALL selected mentions');\n      fireEvent.click(allButton);\n\n      expect(mockOnUpdateFilter).toHaveBeenCalledWith('mentionsLogic', 'AND');\n    });\n\n    it('should not call onUpdateFilter when onUpdateFilter prop is not provided', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' },\n        { name: 'author', value: '123' }\n      ];\n\n      render(\n        <Provider store={store}>\n          <FilterBar\n            filterId=\\\"test\\\"\n            filters={filters}\n            onRemoveFilter={mockOnRemoveFilter}\n            onRemoveTag={mockOnRemoveTag}\n            onClearFilters={mockOnClearFilters}\n            // onUpdateFilter not provided\n          />\n        </Provider>\n      );\n\n      // Global logic controls should not be shown\n      expect(screen.queryByText('Groups:')).not.toBeInTheDocument();\n    });\n  });\n\n  describe('Filter Value Processing', () => {\n    it('should handle comma-separated tag values', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript,#javascript' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(\n        screen.getByTestId('filter-label-tags-#react')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-tags-#typescript')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-tags-#javascript')\n      ).toBeInTheDocument();\n    });\n\n    it('should handle comma-separated author values', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'author', value: '123,456,789' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(screen.getByTestId('filter-label-author-123')).toBeInTheDocument();\n      expect(screen.getByTestId('filter-label-author-456')).toBeInTheDocument();\n      expect(screen.getByTestId('filter-label-author-789')).toBeInTheDocument();\n    });\n\n    it('should handle comma-separated mentions values', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'mentions', value: '@user1,@user2,@user3' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(\n        screen.getByTestId('filter-label-mentions-@user1')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-mentions-@user2')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-mentions-@user3')\n      ).toBeInTheDocument();\n    });\n\n    it('should deduplicate values', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#react,#typescript,#react' }\n      ];\n\n      renderFilterBar(filters);\n\n      // Should only show unique values\n      const reactElements = screen.getAllByTestId('filter-label-tags-#react');\n      expect(reactElements).toHaveLength(1);\n      expect(\n        screen.getByTestId('filter-label-tags-#typescript')\n      ).toBeInTheDocument();\n    });\n\n    it('should filter out empty values', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,,#typescript, ,#javascript' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(\n        screen.getByTestId('filter-label-tags-#react')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-tags-#typescript')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-tags-#javascript')\n      ).toBeInTheDocument();\n\n      // Should not render empty values\n      expect(\n        screen.queryByTestId('filter-label-tags-')\n      ).not.toBeInTheDocument();\n    });\n\n    it('should not render filters with empty values', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '' },\n        { name: 'author', value: '123' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(screen.queryByText('tags:')).not.toBeInTheDocument();\n      expect(screen.getByText('author:')).toBeInTheDocument();\n    });\n  });\n\n  describe('Logic Value Extraction', () => {\n    it('should extract correct logic values with defaults', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' }, // Multiple tags to show logic buttons\n        { name: 'tagLogic', value: 'AND' },\n        { name: 'author', value: '123' }\n        // No authorLogic, mentionsLogic, or globalLogic\n      ];\n\n      renderFilterBar(filters);\n\n      // This tests the internal logic extraction - we can verify through button states\n      // When tagLogic is AND, the ALL button should be active\n      const tagAllButtons = screen.getAllByTitle(\n        'Controlled by Groups setting - set Groups to ANY to change'\n      );\n      expect(tagAllButtons[0]).toHaveClass('filter-bar__logic-button--active');\n    });\n\n    it('should handle missing logic filters gracefully', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' }\n        // No tagLogic specified\n      ];\n\n      renderFilterBar(filters);\n\n      // When no tagLogic is specified, it defaults to OR and buttons are enabled\n      const anyButton = screen.getByTitle('Must have ANY selected tags');\n      expect(anyButton).toHaveClass('filter-bar__logic-button--active');\n    });\n  });\n\n  describe('Complex Scenarios', () => {\n    it('should handle all filter types with all logic types', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' },\n        { name: 'tagLogic', value: 'AND' },\n        { name: 'author', value: '123,456' },\n        { name: 'authorLogic', value: 'OR' },\n        { name: 'mentions', value: '@user1,@user2' },\n        { name: 'mentionsLogic', value: 'AND' },\n        { name: 'globalLogic', value: 'OR' }\n      ];\n\n      renderFilterBar(filters);\n\n      // Should show all filter types\n      expect(screen.getByText('tags:')).toBeInTheDocument();\n      expect(screen.getByText('author:')).toBeInTheDocument();\n      expect(screen.getByText('mentions:')).toBeInTheDocument();\n\n      // Should show global logic controls\n      expect(screen.getByText('Groups:')).toBeInTheDocument();\n\n      // Should show correct active states for logic buttons\n      // With globalLogic OR, individual filter logic buttons should be enabled\n      expect(screen.getByTitle('Any filter group can match')).toHaveClass(\n        'filter-bar__logic-button--active'\n      );\n    });\n\n    it('should handle rapid filter updates', async () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' },\n        { name: 'author', value: '123' },\n        { name: 'globalLogic', value: 'AND' }\n      ];\n\n      renderFilterBar(filters);\n\n      // Rapidly click different logic buttons\n      const globalOrButton = screen.getByTitle('Any filter group can match');\n      const tagAndButtons = screen.getAllByTitle(\n        'Controlled by Groups setting - set Groups to ANY to change'\n      );\n      const tagAndButton = tagAndButtons[0]; // Get the first one (ALL button)\n\n      fireEvent.click(globalOrButton);\n      fireEvent.click(tagAndButton);\n      fireEvent.click(globalOrButton);\n\n      await waitFor(() => {\n        expect(mockOnUpdateFilter).toHaveBeenCalledTimes(2);\n      });\n\n      expect(mockOnUpdateFilter).toHaveBeenNthCalledWith(\n        1,\n        'globalLogic',\n        'OR'\n      );\n      expect(mockOnUpdateFilter).toHaveBeenNthCalledWith(\n        2,\n        'globalLogic',\n        'OR'\n      );\n    });\n\n    it('should handle filters with special characters', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react-hooks,#@typescript,#javascript.es6' },\n        { name: 'mentions', value: '@user-name,user@domain.com' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(\n        screen.getByTestId('filter-label-tags-#react-hooks')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-tags-#@typescript')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-tags-#javascript.es6')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-mentions-@user-name')\n      ).toBeInTheDocument();\n      expect(\n        screen.getByTestId('filter-label-mentions-user@domain.com')\n      ).toBeInTheDocument();\n    });\n  });\n\n  describe('Accessibility', () => {\n    it('should have proper ARIA labels', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react' }\n      ];\n\n      renderFilterBar(filters);\n\n      const clearButton = screen.getByRole('button', {\n        name: 'Clear all filters'\n      });\n      expect(clearButton).toHaveAttribute('aria-label', 'Clear all filters');\n    });\n\n    it('should have proper button titles for logic controls', () => {\n      const filters: Filter<PostFilters>[] = [\n        { name: 'tags', value: '#react,#typescript' },\n        { name: 'author', value: '123' }\n      ];\n\n      renderFilterBar(filters);\n\n      expect(screen.getByTitle('All filter groups must match')).toHaveAttribute(\n        'title',\n        'All filter groups must match'\n      );\n      expect(screen.getByTitle('Any filter group can match')).toHaveAttribute(\n        'title',\n        'Any filter group can match'\n      );\n      const disabledButtons = screen.getAllByTitle(\n        'Controlled by Groups setting - set Groups to ANY to change'\n      );\n      expect(disabledButtons[0]).toHaveAttribute(\n        'title',\n        'Controlled by Groups setting - set Groups to ANY to change'\n      );\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":598,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/filter-bar/CustomFilterInput.test.tsx":{
    "content":"import '@testing-library/jest-dom';\nimport { act, fireEvent, render, screen, waitFor } from '../../../test-utils';\nimport { CustomFilterInput } from './CustomFilterInput';\n\n// Mock the search actions with better structure\njest.mock('../../../lib/actions/search.actions', () => ({\n  searchHashtags: jest.fn().mockImplementation(() =>\n    Promise.resolve({\n      items: [\n        { id: '1', value: 'javascript', label: 'javascript', type: 'hashtag' }\n      ],\n      hasMore: false,\n      total: 1\n    })\n  ),\n  searchUsers: jest.fn().mockImplementation(() =>\n    Promise.resolve({\n      items: [\n        {\n          id: '1',\n          value: 'user123',\n          label: 'testuser',\n          displayName: 'Test User',\n          type: 'user'\n        }\n      ],\n      hasMore: false,\n      total: 1\n    })\n  )\n}));\n\n// Mock Next.js navigation\njest.mock('next/navigation', () => ({\n  usePathname: jest.fn(() => '/posts'),\n  useRouter: jest.fn(() => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    back: jest.fn()\n  })),\n  useSearchParams: jest.fn(() => new URLSearchParams())\n}));\n\ndescribe('CustomFilterInput', () => {\n  const mockOnAddFilter = jest.fn();\n\n  const defaultProps = {\n    contextId: 'test-context',\n    onAddFilter: mockOnAddFilter\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  // Helper function to get the input element\n  const getInput = async () => {\n    // The input is now directly accessible via the SmartPillInput component\n    // We can find it by its placeholder attribute\n    const input = screen.getByPlaceholderText('Add filter: @user or #tag...');\n    return input;\n  };\n\n  it('renders with default placeholder', () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    expect(\n      screen.getByPlaceholderText('Add filter: @user or #tag...')\n    ).toBeInTheDocument();\n  });\n\n  it('shows hashtag help text when typing #', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n\n    // Type a hashtag\n    await act(async () => {\n      fireEvent.change(input, { target: { value: '#javascript' } });\n    });\n\n    // Should show hashtag help text\n    expect(\n      screen.getByText(\n        'Filtering by hashtag - select from suggestions, add space to complete, or click Add'\n      )\n    ).toBeInTheDocument();\n  });\n\n  it('shows user help text when typing @', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n\n    // Type a mention\n    await act(async () => {\n      fireEvent.change(input, { target: { value: '@user' } });\n    });\n\n    // Should show user help text\n    expect(\n      screen.getByText(\n        'Filtering by user - select from suggestions or use inline controls on pills'\n      )\n    ).toBeInTheDocument();\n  });\n\n  it('adds hashtag filter correctly', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n    const form = input.closest('form')!;\n\n    // Type a hashtag\n    await act(async () => {\n      fireEvent.change(input, { target: { value: '#javascript' } });\n    });\n\n    // Submit the form\n    await act(async () => {\n      fireEvent.submit(form);\n    });\n\n    // Should call onAddFilter with correct hashtag filter\n    expect(mockOnAddFilter).toHaveBeenCalledWith({\n      name: 'tags',\n      value: '#javascript'\n    });\n  });\n\n  it('adds user filter correctly in author mode', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n    const form = input.closest('form')!;\n\n    // Type a properly formatted mention (@[username|userId] format expected by parseMultiplePills)\n    await act(async () => {\n      fireEvent.change(input, { target: { value: '@[testuser|123]' } });\n    });\n\n    // Submit the form and wait for async processing\n    await act(async () => {\n      fireEvent.submit(form);\n    });\n\n    // Wait for any async operations to complete\n    await waitFor(\n      () => {\n        expect(mockOnAddFilter).toHaveBeenCalledWith({\n          name: 'author',\n          value: 'testuser|123' // Should use username|userId format\n        });\n      },\n      { timeout: 3000 }\n    );\n  });\n\n  it('handles structured mention format correctly', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n    const form = input.closest('form')!;\n\n    // Type a structured mention from SmartInput\n    await act(async () => {\n      fireEvent.change(input, { target: { value: '@[testuser|user123]' } });\n    });\n\n    // Submit the form\n    await act(async () => {\n      fireEvent.submit(form);\n    });\n\n    // Should call onAddFilter with the username|userId format\n    expect(mockOnAddFilter).toHaveBeenCalledWith({\n      name: 'author',\n      value: 'testuser|user123'\n    });\n  });\n\n  it('retains input after successful submission', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n    const form = input.closest('form')!;\n\n    // Type and submit\n    await act(async () => {\n      fireEvent.change(input, { target: { value: '#test' } });\n      fireEvent.submit(form);\n    });\n\n    // Input should retain the value after submission (current behavior)\n    await waitFor(() => {\n      expect(input).toHaveValue('#test');\n    });\n\n    // Verify the filter was still added\n    expect(mockOnAddFilter).toHaveBeenCalledWith({\n      name: 'tags',\n      value: '#test'\n    });\n  });\n\n  it('treats formatted hashtags correctly when submitted', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n    const form = input.closest('form')!;\n\n    // Type properly formatted hashtag (with # prefix expected by parseMultiplePills)\n    await act(async () => {\n      fireEvent.change(input, { target: { value: '#javascript' } });\n    });\n\n    // Submit the form and wait for async processing\n    await act(async () => {\n      fireEvent.submit(form);\n    });\n\n    // Wait for the callback to be called\n    await waitFor(\n      () => {\n        expect(mockOnAddFilter).toHaveBeenCalledWith({\n          name: 'tags',\n          value: '#javascript'\n        });\n      },\n      { timeout: 3000 }\n    );\n  });\n\n  it('shows default help text when input is empty', () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    expect(\n      screen.getByText('Type # for hashtags or @ for users...')\n    ).toBeInTheDocument();\n  });\n\n  it('processes multiple hashtags correctly', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n    const form = input.closest('form')!;\n\n    // Type multiple hashtags\n    await act(async () => {\n      fireEvent.change(input, {\n        target: { value: '#javascript #react #typescript' }\n      });\n    });\n\n    // Submit the form\n    await act(async () => {\n      fireEvent.submit(form);\n    });\n\n    // Should call onAddFilter three times - once for each hashtag\n    expect(mockOnAddFilter).toHaveBeenCalledTimes(3);\n    expect(mockOnAddFilter).toHaveBeenNthCalledWith(1, {\n      name: 'tags',\n      value: '#javascript'\n    });\n    expect(mockOnAddFilter).toHaveBeenNthCalledWith(2, {\n      name: 'tags',\n      value: '#react'\n    });\n    expect(mockOnAddFilter).toHaveBeenNthCalledWith(3, {\n      name: 'tags',\n      value: '#typescript'\n    });\n  });\n\n  it('handles multiple structured mentions correctly', async () => {\n    render(<CustomFilterInput {...defaultProps} />);\n\n    const input = await getInput();\n    const form = input.closest('form')!;\n\n    // Type multiple structured mentions including malformed ones\n    await act(async () => {\n      fireEvent.change(input, {\n        target: { value: '@[user1|id1] [user2|id2]' }\n      });\n    });\n\n    // Submit the form\n    await act(async () => {\n      fireEvent.submit(form);\n    });\n\n    // Should call onAddFilter twice - once for each user\n    expect(mockOnAddFilter).toHaveBeenCalledTimes(2);\n\n    // First call should be for the first valid mention\n    expect(mockOnAddFilter).toHaveBeenNthCalledWith(1, {\n      name: 'author',\n      value: 'user1|id1'\n    });\n\n    // Second call should be for the fixed malformed mention\n    expect(mockOnAddFilter).toHaveBeenNthCalledWith(2, {\n      name: 'author',\n      value: 'user2|id2'\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":310,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/filter-bar/CustomFilterInput.tsx":{
    "content":"'use client';\n\nimport { useState } from 'react';\nimport { Filter } from '../../../lib/state/atoms';\nimport { PostFilters } from '../../../lib/types/filters';\nimport { SmartPillInput } from '../ui/SmartPillInput';\nimport './CustomFilterInput.css';\n\nexport type FilterType = 'tags' | 'users';\nexport type UserFilterMode = 'author' | 'mentions';\n\ninterface CustomFilterInputProps {\n  contextId: string;\n  onAddFilter: (filter: Filter<PostFilters>) => void;\n  onAddFilters?: (filters: Filter<PostFilters>[]) => void;\n  onFilterSuccess?: () => void;\n  placeholder?: string;\n  className?: string;\n}\n\nexport function CustomFilterInput({\n  contextId,\n  onAddFilter,\n  onAddFilters,\n  onFilterSuccess,\n  placeholder = 'Add filter: @user or #tag...',\n  className = ''\n}: CustomFilterInputProps) {\n  const [inputValue, setInputValue] = useState('');\n  const [currentEditValue, setCurrentEditValue] = useState('');\n  const [filterType, setFilterType] = useState<FilterType>('tags');\n  const [userFilterMode, setUserFilterMode] =\n    useState<UserFilterMode>('author');\n\n  const handleInputChange = (value: string) => {\n    setInputValue(value);\n    setCurrentEditValue(value);\n\n    // Auto-detect filter type based on input\n    if (value.startsWith('#')) {\n      setFilterType('tags');\n    } else if (value.startsWith('@')) {\n      setFilterType('users');\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Get the complete value including both existing pills and new input\n    const valueToProcess = currentEditValue || inputValue;\n    if (!valueToProcess.trim()) return;\n\n    // Process the input and create appropriate filter\n    processFilterInput(valueToProcess.trim());\n  };\n\n  const processFilterInput = (value: string) => {\n    const pills = parseMultiplePills(value);\n    const filtersToAdd: Filter<PostFilters>[] = [];\n\n    pills.forEach((pill) => {\n      if (pill.type === 'hashtag') {\n        const filter = createHashtagFilter(pill.content);\n        if (filter) filtersToAdd.push(filter);\n      } else if (pill.type === 'mention') {\n        const filter = createUserFilter(pill.content);\n        if (filter) filtersToAdd.push(filter);\n      }\n    });\n\n    // Use batched addition if available and we have multiple filters\n    if (onAddFilters && filtersToAdd.length > 1) {\n      onAddFilters(filtersToAdd);\n    } else {\n      // Fall back to individual addition\n      filtersToAdd.forEach((filter) => onAddFilter(filter));\n    }\n\n    // Clear the input after processing with a small delay to ensure state updates complete\n    setTimeout(() => {\n      setInputValue('');\n      setCurrentEditValue('');\n      setFilterType('tags'); // Reset to default\n    }, 0);\n\n    if (onFilterSuccess) {\n      onFilterSuccess();\n    }\n  };\n\n  // Parse input string to extract multiple pills\n  const parseMultiplePills = (\n    text: string\n  ): Array<{ type: 'hashtag' | 'mention'; content: string }> => {\n    const pills: Array<{ type: 'hashtag' | 'mention'; content: string }> = [];\n\n    // Simple regex to match:\n    // - Hashtags: #word\n    // - Valid mentions: @[username|userId]\n    // - Malformed mentions: [username|userId] (missing @ prefix - fix these)\n    const pillRegex = /#\\\\w+|@\\\\[[^\\\\]]+\\\\]|\\\\[[^\\\\]]+\\\\]/g;\n    let match;\n\n    while ((match = pillRegex.exec(text)) !== null) {\n      const matchedText = match[0];\n\n      if (matchedText.startsWith('#')) {\n        pills.push({\n          type: 'hashtag',\n          content: matchedText\n        });\n      } else if (matchedText.startsWith('@[')) {\n        // Valid mention format\n        pills.push({\n          type: 'mention',\n          content: matchedText\n        });\n      } else if (matchedText.startsWith('[') && matchedText.includes('|')) {\n        // Malformed mention missing @ prefix - fix it\n        pills.push({\n          type: 'mention',\n          content: `@${matchedText}`\n        });\n      }\n    }\n\n    return pills;\n  };\n\n  const createHashtagFilter = (value: string): Filter<PostFilters> | null => {\n    // Clean the hashtag value\n    let cleanValue = value.replace(/^#+/, ''); // Remove leading #'s\n    if (!cleanValue) return null;\n\n    // Ensure it starts with # for consistency\n    const hashtagValue = `#${cleanValue}`;\n\n    // Return tags filter\n    return {\n      name: 'tags',\n      value: hashtagValue\n    };\n  };\n\n  const createUserFilter = (value: string): Filter<PostFilters> | null => {\n    // Handle different mention formats:\n    // @username\n    // @[username|userId] (legacy from SmartInput)\n    // @[username|userId|filterType] (enhanced with filter type)\n\n    let userId = '';\n    let username = '';\n    let filterType: 'author' | 'mentions' = userFilterMode; // Default to current mode\n\n    // Check if it's in the enhanced format @[username|userId|filterType]\n    const enhancedMatch = value.match(/^@\\\\[([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\]$/);\n    if (enhancedMatch) {\n      username = enhancedMatch[1];\n      userId = enhancedMatch[2];\n      filterType = enhancedMatch[3] as 'author' | 'mentions';\n    } else {\n      // Check if it's in the legacy structured format @[username|userId]\n      const structuredMatch = value.match(/^@\\\\[([^|]+)\\\\|([^\\\\]]+)\\\\]$/);\n      if (structuredMatch) {\n        username = structuredMatch[1];\n        userId = structuredMatch[2];\n        // Use the current user filter mode for legacy format\n      } else {\n        // Simple @username format\n        username = value.replace(/^@+/, ''); // Remove leading @'s\n        if (!username) return null;\n\n        // Validate username format (alphanumeric, underscore, hyphen)\n        if (!/^[a-zA-Z0-9_-]+$/.test(username)) {\n          // console.warn('Invalid username format:', username);\n          return null;\n        }\n\n        // For simple format, we'll use the username as both username and userId\n        // The backend will handle username resolution\n        userId = username;\n      }\n    }\n\n    // Create filter based on the determined filter type\n    const filterName: PostFilters = filterType;\n    // Both author and mentions filters use the same username|userId format\n    const filterValue = `${username}|${userId}`;\n\n    return {\n      name: filterName,\n      value: filterValue\n    };\n  };\n\n  // Determine current mode for display\n  const getCurrentMode = () => {\n    const valueToCheck = currentEditValue || inputValue;\n    if (valueToCheck.startsWith('#')) {\n      return 'hashtag';\n    } else if (valueToCheck.startsWith('@')) {\n      return userFilterMode;\n    }\n    return null;\n  };\n\n  const currentMode = getCurrentMode();\n\n  // Handle input changes from SmartPillInput\n  const handleSmartInputChange = (newValue: string) => {\n    // Update input value and handle filter type detection\n    setInputValue(newValue);\n    // Don't set currentEditValue here to avoid circular updates\n\n    // Auto-detect filter type based on input\n    if (newValue.startsWith('#')) {\n      setFilterType('tags');\n    } else if (newValue.startsWith('@')) {\n      setFilterType('users');\n    }\n  };\n\n  const handleEditValueChange = (editValue: string) => {\n    setCurrentEditValue(editValue);\n\n    // Don't sync inputValue here to avoid circular updates\n    // The SmartPillInput will handle its own state\n\n    // Auto-detect filter type based on edit value\n    if (editValue.startsWith('#')) {\n      setFilterType('tags');\n    } else if (editValue.startsWith('@')) {\n      setFilterType('users');\n    }\n  };\n\n  const handlePillClick = (pillText: string, action: 'edit' | 'remove') => {\n    // console.log('DEBUG: CustomFilterInput handlePillClick:', pillText, action);\n\n    if (action === 'edit') {\n      // For incomplete pills, the SmartPillInput will handle entering edit mode\n      // We just need to make sure our state is in sync\n      setCurrentEditValue(pillText);\n      setInputValue(pillText);\n    } else if (action === 'remove') {\n      // SmartPillInput handles the removal directly and calls onChange\n      // We don't need to do anything here - just log for debugging\n      // console.log(\n      //   'DEBUG: CustomFilterInput: pill removal handled by SmartPillInput'\n      // );\n    }\n  };\n\n  const handleMentionClick = (\n    mention: string,\n    filterType?: 'author' | 'mentions'\n  ) => {\n    // Handle enhanced mention format with embedded filter type\n    const enhancedMatch = mention.match(/^@\\\\[([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\]$/);\n    if (enhancedMatch) {\n      const [, username, userId, embeddedFilterType] = enhancedMatch;\n      // Use the embedded filter type if no explicit type provided\n      const selectedFilterType =\n        filterType || (embeddedFilterType as 'author' | 'mentions') || 'author';\n\n      // Create and add the appropriate filter\n      const filter = createUserFilterWithType(\n        `@[${username}|${userId}]`,\n        selectedFilterType\n      );\n      if (filter) {\n        onAddFilter(filter);\n\n        // Clear input after successful addition\n        setTimeout(() => {\n          setInputValue('');\n          setCurrentEditValue('');\n          setFilterType('tags'); // Reset to default\n        }, 0);\n\n        if (onFilterSuccess) {\n          onFilterSuccess();\n        }\n      }\n      return;\n    }\n\n    // Default to 'author' if no filter type is specified\n    const selectedFilterType = filterType || 'author';\n\n    // Update the user filter mode based on the selected filter type\n    setUserFilterMode(selectedFilterType);\n\n    // Create and add the appropriate filter\n    const filter = createUserFilterWithType(mention, selectedFilterType);\n    if (filter) {\n      onAddFilter(filter);\n\n      // Clear input after successful addition\n      setTimeout(() => {\n        setInputValue('');\n        setCurrentEditValue('');\n        setFilterType('tags'); // Reset to default\n      }, 0);\n\n      if (onFilterSuccess) {\n        onFilterSuccess();\n      }\n    }\n  };\n\n  const createUserFilterWithType = (\n    value: string,\n    filterType: 'author' | 'mentions'\n  ): Filter<PostFilters> | null => {\n    let userId = '';\n    let username = '';\n\n    // Check if it's in the structured format @[username|userId]\n    const structuredMatch = value.match(/^@\\\\[([^|]+)\\\\|([^\\\\]]+)\\\\]$/);\n    if (structuredMatch) {\n      username = structuredMatch[1];\n      userId = structuredMatch[2];\n    } else {\n      // Simple @username format\n      username = value.replace(/^@+/, ''); // Remove leading @'s\n      if (!username) return null;\n\n      // Validate username format (alphanumeric, underscore, hyphen)\n      if (!/^[a-zA-Z0-9_-]+$/.test(username)) {\n        // console.warn('Invalid username format:', username);\n        return null;\n      }\n\n      // For simple format, we'll use the username as both username and userId\n      // The backend will handle username resolution\n      userId = username;\n    }\n\n    // Create filter based on specified type\n    const filterName: PostFilters = filterType;\n    // Both author and mentions filters use the same username|userId format\n    const filterValue = `${username}|${userId}`;\n\n    return {\n      name: filterName,\n      value: filterValue\n    };\n  };\n\n  return (\n    <div className={`custom-filter-input ${className}`}>\n      {/* Dynamic Help Text */}\n      <div className=\\\"custom-filter-input__help\\\">\n        <p className=\\\"custom-filter-input__help-text\\\">\n          {!(currentEditValue || inputValue) &&\n            'Type # for hashtags or @ for users...'}\n          {(currentEditValue || inputValue).startsWith('#') &&\n            'Filtering by hashtag - select from suggestions, add space to complete, or click Add'}\n          {(currentEditValue || inputValue).startsWith('@') &&\n            'Filtering by user - select from suggestions or use inline controls on pills'}\n          {(currentEditValue || inputValue) &&\n            !(currentEditValue || inputValue).startsWith('#') &&\n            !(currentEditValue || inputValue).startsWith('@') &&\n            'Will be treated as hashtag when added'}\n        </p>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\\\"custom-filter-input__form\\\">\n        {/* Smart Pill Input with Mode Indicator */}\n        <div className=\\\"custom-filter-input__input-container\\\">\n          <div className=\\\"custom-filter-input__input-wrapper\\\">\n            <SmartPillInput\n              value={inputValue}\n              onChange={handleSmartInputChange}\n              onEditValueChange={handleEditValueChange}\n              onPillClick={handlePillClick}\n              onMentionClick={handleMentionClick}\n              placeholder={placeholder}\n              className=\\\"custom-filter-input__input\\\"\n              enableHashtags={true}\n              enableUserMentions={true}\n              contextId={contextId}\n            />\n          </div>\n\n          <button\n            type=\\\"submit\\\"\n            className=\\\"custom-filter-input__submit\\\"\n            disabled={!inputValue.trim()}\n            title=\\\"Add filter\\\"\n          >\n            Add\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":401,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/filter-bar/FilterLabel.test.tsx":{
    "content":"import '@testing-library/jest-dom';\nimport {\n  act,\n  fireEvent,\n  render,\n  screen,\n  waitFor\n} from '@testing-library/react';\nimport { FilterLabel } from './FilterLabel';\n\n// Mock the ContentWithPills component\njest.mock('../ui/ContentWithPills', () => ({\n  ContentWithPills: ({\n    content,\n    onHashtagClick,\n    onMentionClick,\n    className\n  }: any) => (\n    <div data-testid=\\\"content-with-pills\\\" className={className}>\n      <span>{content}</span>\n      <button\n        onClick={() => onHashtagClick?.(content)}\n        data-testid=\\\"hashtag-click\\\"\n      >\n        Remove Hashtag\n      </button>\n      <button\n        onClick={() => onMentionClick?.(content)}\n        data-testid=\\\"mention-click\\\"\n      >\n        Remove Mention\n      </button>\n    </div>\n  )\n}));\n\n// Mock the search actions\nconst mockResolveUserIdToUsername = jest.fn();\nconst mockGetUserInfo = jest.fn();\n\njest.mock('../../../lib/actions/search.actions', () => ({\n  resolveUserIdToUsername: mockResolveUserIdToUsername,\n  getUserInfo: mockGetUserInfo\n}));\n\ndescribe('FilterLabel Component', () => {\n  let mockOnRemoveTag: jest.Mock;\n  let mockOnRemoveFilter: jest.Mock;\n\n  beforeEach(() => {\n    mockOnRemoveTag = jest.fn();\n    mockOnRemoveFilter = jest.fn();\n    mockResolveUserIdToUsername.mockClear();\n    mockGetUserInfo.mockClear();\n  });\n\n  const renderFilterLabel = (props: {\n    name: string;\n    label: string;\n    filterId?: string;\n    onRemoveTag?: jest.Mock;\n    onRemoveFilter?: jest.Mock;\n  }) => {\n    return render(\n      <FilterLabel\n        name={props.name}\n        label={props.label}\n        filterId={props.filterId || 'test'}\n        onRemoveTag={props.onRemoveTag || mockOnRemoveTag}\n        onRemoveFilter={props.onRemoveFilter || mockOnRemoveFilter}\n      />\n    );\n  };\n\n  describe('Tag Filters', () => {\n    it('should render tag filter with ContentWithPills', () => {\n      renderFilterLabel({\n        name: 'tags',\n        label: '#react'\n      });\n\n      expect(screen.getByTestId('content-with-pills')).toBeInTheDocument();\n      expect(screen.getByText('#react')).toBeInTheDocument();\n    });\n\n    it('should handle tag removal via hashtag click', () => {\n      renderFilterLabel({\n        name: 'tags',\n        label: '#react'\n      });\n\n      const hashtagButton = screen.getByTestId('hashtag-click');\n      fireEvent.click(hashtagButton);\n\n      expect(mockOnRemoveTag).toHaveBeenCalledWith('#react');\n    });\n\n    it('should handle multiple tags', () => {\n      renderFilterLabel({\n        name: 'tags',\n        label: '#react,#typescript'\n      });\n\n      expect(screen.getByText('#react,#typescript')).toBeInTheDocument();\n    });\n  });\n\n  describe('Author Filters', () => {\n    it('should resolve author userId to username', async () => {\n      mockResolveUserIdToUsername.mockResolvedValue('johndoe');\n\n      await act(async () => {\n        renderFilterLabel({\n          name: 'author',\n          label: '123'\n        });\n      });\n\n      await waitFor(() => {\n        expect(mockResolveUserIdToUsername).toHaveBeenCalledWith('123');\n      });\n\n      await waitFor(() => {\n        expect(screen.getByText('@[johndoe|123]')).toBeInTheDocument();\n      });\n    });\n\n    it('should handle author resolution failure', async () => {\n      mockResolveUserIdToUsername.mockResolvedValue(null);\n\n      await act(async () => {\n        renderFilterLabel({\n          name: 'author',\n          label: '123'\n        });\n      });\n\n      await waitFor(() => {\n        expect(screen.getByText('@123')).toBeInTheDocument();\n      });\n    });\n\n    it('should handle author resolution error', async () => {\n      mockResolveUserIdToUsername.mockRejectedValue(new Error('Network error'));\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation();\n\n      await act(async () => {\n        renderFilterLabel({\n          name: 'author',\n          label: '123'\n        });\n      });\n\n      await waitFor(() => {\n        expect(consoleSpy).toHaveBeenCalledWith(\n          'Error resolving user ID to username:',\n          expect.any(Error)\n        );\n      });\n\n      await waitFor(() => {\n        expect(screen.getByText('@123')).toBeInTheDocument();\n      });\n\n      consoleSpy.mockRestore();\n    });\n\n    it('should not resolve author if label already starts with @', async () => {\n      await act(async () => {\n        renderFilterLabel({\n          name: 'author',\n          label: '@johndoe'\n        });\n      });\n\n      // Should not call resolution\n      expect(mockResolveUserIdToUsername).not.toHaveBeenCalled();\n      expect(screen.getByText('@johndoe')).toBeInTheDocument();\n    });\n\n    it('should handle author removal via mention click', async () => {\n      mockResolveUserIdToUsername.mockResolvedValue('johndoe');\n\n      await act(async () => {\n        renderFilterLabel({\n          name: 'author',\n          label: '123'\n        });\n      });\n\n      await waitFor(() => {\n        expect(screen.getByText('@[johndoe|123]')).toBeInTheDocument();\n      });\n\n      const mentionButton = screen.getByTestId('mention-click');\n      fireEvent.click(mentionButton);\n\n      expect(mockOnRemoveFilter).toHaveBeenCalledWith('author', '123');\n    });\n  });\n\n  describe('Mentions Filters', () => {\n    it('should resolve mentions username to display format', async () => {\n      await act(async () => {\n        renderFilterLabel({\n          name: 'mentions',\n          label: 'johndoe'\n        });\n      });\n\n      // For mentions filters with plain usernames, no async resolution is needed\n      // It just adds @ prefix\n      await waitFor(() => {\n        expect(screen.getByText('@johndoe')).toBeInTheDocument();\n      });\n    });\n\n    it('should handle mentions resolution failure', async () => {\n      mockGetUserInfo.mockResolvedValue(null);\n\n      renderFilterLabel({\n        name: 'mentions',\n        label: 'johndoe'\n      });\n\n      await waitFor(() => {\n        expect(screen.getByText('@johndoe')).toBeInTheDocument();\n      });\n    });\n\n    it('should handle mentions display correctly', async () => {\n      renderFilterLabel({\n        name: 'mentions',\n        label: 'johndoe'\n      });\n\n      // For mentions filters with plain usernames, no async resolution is needed\n      await waitFor(() => {\n        expect(screen.getByText('@johndoe')).toBeInTheDocument();\n      });\n    });\n\n    it('should not resolve mentions if label already starts with @', async () => {\n      renderFilterLabel({\n        name: 'mentions',\n        label: '@johndoe'\n      });\n\n      // Should not call resolution\n      expect(mockGetUserInfo).not.toHaveBeenCalled();\n      expect(screen.getByText('@johndoe')).toBeInTheDocument();\n    });\n\n    it('should handle mentions removal via mention click', async () => {\n      renderFilterLabel({\n        name: 'mentions',\n        label: 'johndoe'\n      });\n\n      await waitFor(() => {\n        expect(screen.getByText('@johndoe')).toBeInTheDocument();\n      });\n\n      const mentionButton = screen.getByTestId('mention-click');\n      fireEvent.click(mentionButton);\n\n      expect(mockOnRemoveFilter).toHaveBeenCalledWith('mentions', 'johndoe');\n    });\n\n    it('should handle plain text mentions removal', () => {\n      renderFilterLabel({\n        name: 'mentions',\n        label: 'plain-mention'\n      });\n\n      // For plain text mentions, displayLabel becomes @plain-mention and renders via ContentWithPills\n      const mentionButton = screen.getByTestId('mention-click');\n      fireEvent.click(mentionButton);\n\n      expect(mockOnRemoveFilter).toHaveBeenCalledWith(\n        'mentions',\n        'plain-mention'\n      );\n    });\n  });\n\n  describe('Plain Text Labels', () => {\n    it('should render plain text labels as buttons', () => {\n      renderFilterLabel({\n        name: 'custom',\n        label: 'plain-text'\n      });\n\n      expect(\n        screen.queryByTestId('content-with-pills')\n      ).not.toBeInTheDocument();\n      expect(\n        screen.getByRole('button', { name: 'Remove plain-text filter' })\n      ).toBeInTheDocument();\n      expect(screen.getByText('plain-text')).toBeInTheDocument();\n      expect(screen.getByText('\u00d7')).toBeInTheDocument();\n    });\n\n    it('should handle plain text removal', () => {\n      renderFilterLabel({\n        name: 'custom',\n        label: 'plain-text'\n      });\n\n      const button = screen.getByRole('button', {\n        name: 'Remove plain-text filter'\n      });\n      fireEvent.click(button);\n\n      expect(mockOnRemoveTag).toHaveBeenCalledWith('plain-text');\n    });\n\n    it('should handle plain text author removal', () => {\n      renderFilterLabel({\n        name: 'author',\n        label: 'plain-author'\n      });\n\n      const button = screen.getByRole('button', {\n        name: 'Remove plain-author filter'\n      });\n      fireEvent.click(button);\n\n      expect(mockOnRemoveFilter).toHaveBeenCalledWith('author', 'plain-author');\n    });\n\n    it('should handle plain text mentions removal', () => {\n      renderFilterLabel({\n        name: 'mentions',\n        label: 'plain-mention'\n      });\n\n      // For plain text mentions, displayLabel becomes @plain-mention and renders via ContentWithPills\n      const mentionButton = screen.getByTestId('mention-click');\n      fireEvent.click(mentionButton);\n\n      expect(mockOnRemoveFilter).toHaveBeenCalledWith(\n        'mentions',\n        'plain-mention'\n      );\n    });\n  });\n\n  describe('Edge Cases', () => {\n    it('should handle empty labels', () => {\n      renderFilterLabel({\n        name: 'tags',\n        label: ''\n      });\n\n      // Should render ContentWithPills for tags, even with empty label\n      expect(screen.getByTestId('content-with-pills')).toBeInTheDocument();\n    });\n\n    it('should handle special characters in labels', () => {\n      renderFilterLabel({\n        name: 'tags',\n        label: '#react-hooks.v18'\n      });\n\n      expect(screen.getByText('#react-hooks.v18')).toBeInTheDocument();\n    });\n\n    it('should handle long labels', () => {\n      const longLabel = '#' + 'a'.repeat(100);\n      renderFilterLabel({\n        name: 'tags',\n        label: longLabel\n      });\n\n      expect(screen.getByText(longLabel)).toBeInTheDocument();\n    });\n\n    it('should handle unicode characters', () => {\n      renderFilterLabel({\n        name: 'tags',\n        label: '#react-\ud83d\ude80-awesome'\n      });\n\n      expect(screen.getByText('#react-\ud83d\ude80-awesome')).toBeInTheDocument();\n    });\n  });\n\n  describe('Props Handling', () => {\n    it('should pass correct props to ContentWithPills', () => {\n      renderFilterLabel({\n        name: 'tags',\n        label: '#react',\n        filterId: 'custom-filter-id'\n      });\n\n      const contentWithPills = screen.getByTestId('content-with-pills');\n      expect(contentWithPills).toHaveClass('filter-bar__filter-pill');\n    });\n\n    it('should handle missing onRemoveFilter prop', () => {\n      renderFilterLabel({\n        name: 'author',\n        label: '@johndoe',\n        onRemoveFilter: undefined\n      });\n\n      // For labels starting with @, it should use ContentWithPills\n      const contentWithPills = screen.getByTestId('content-with-pills');\n      expect(contentWithPills).toBeInTheDocument();\n\n      // The component should still render without errors even when onRemoveFilter is undefined\n      expect(contentWithPills).toHaveClass('filter-bar__filter-pill');\n    });\n\n    it('should use original label for removal, not display label', async () => {\n      mockResolveUserIdToUsername.mockResolvedValue('johndoe');\n\n      renderFilterLabel({\n        name: 'author',\n        label: '123'\n      });\n\n      await waitFor(() => {\n        expect(screen.getByText('@[johndoe|123]')).toBeInTheDocument();\n      });\n\n      const mentionButton = screen.getByTestId('mention-click');\n      fireEvent.click(mentionButton);\n\n      // Should use original label '123', not display label '@[johndoe|123]'\n      expect(mockOnRemoveFilter).toHaveBeenCalledWith('author', '123');\n    });\n  });\n\n  describe('Async Behavior', () => {\n    it('should show initial label before resolution completes', () => {\n      // Don't resolve the promise immediately\n      let resolvePromise: (value: string) => void;\n      const promise = new Promise<string>((resolve) => {\n        resolvePromise = resolve;\n      });\n      mockResolveUserIdToUsername.mockReturnValue(promise);\n\n      renderFilterLabel({\n        name: 'author',\n        label: '123'\n      });\n\n      // Should show initial state in loading indicator\n      expect(screen.getByText('@123')).toBeInTheDocument();\n\n      // Resolve the promise\n      resolvePromise!('johndoe');\n\n      return waitFor(() => {\n        expect(screen.getByText('@[johndoe|123]')).toBeInTheDocument();\n      });\n    });\n\n    it('should handle concurrent resolution requests', async () => {\n      // Set up multiple calls\n      mockResolveUserIdToUsername.mockResolvedValue('johndoe');\n\n      const { rerender } = renderFilterLabel({\n        name: 'author',\n        label: '123'\n      });\n\n      // Change the label while resolution is pending\n      rerender(\n        <FilterLabel\n          name=\\\"author\\\"\n          label=\\\"456\\\"\n          filterId=\\\"test\\\"\n          onRemoveTag={mockOnRemoveTag}\n          onRemoveFilter={mockOnRemoveFilter}\n        />\n      );\n\n      // Should handle both resolutions\n      await waitFor(() => {\n        expect(mockResolveUserIdToUsername).toHaveBeenCalledWith('123');\n        expect(mockResolveUserIdToUsername).toHaveBeenCalledWith('456');\n      });\n    });\n  });\n\n  describe('Accessibility', () => {\n    it('should have proper ARIA labels for plain text buttons', () => {\n      renderFilterLabel({\n        name: 'custom',\n        label: 'test-filter'\n      });\n\n      const button = screen.getByRole('button', {\n        name: 'Remove test-filter filter'\n      });\n      expect(button).toHaveAttribute('aria-label', 'Remove test-filter filter');\n    });\n\n    it('should have aria-hidden on remove icon', () => {\n      renderFilterLabel({\n        name: 'custom',\n        label: 'test-filter'\n      });\n\n      const removeIcon = screen.getByText('\u00d7');\n      expect(removeIcon).toHaveAttribute('aria-hidden', 'true');\n    });\n\n    it('should be keyboard accessible', () => {\n      renderFilterLabel({\n        name: 'custom',\n        label: 'test-filter'\n      });\n\n      const button = screen.getByRole('button', {\n        name: 'Remove test-filter filter'\n      });\n\n      // Should be focusable\n      button.focus();\n      expect(document.activeElement).toBe(button);\n\n      // Should handle Enter key\n      fireEvent.keyDown(button, { key: 'Enter' });\n      fireEvent.click(button);\n\n      expect(mockOnRemoveTag).toHaveBeenCalledWith('test-filter');\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":534,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/filter-bar/FilterLabel.tsx":{
    "content":"'use client';\nimport { useEffect, useState } from 'react';\nimport { ContentWithPills } from '../ui/ContentWithPills';\nimport './FilterBar.css';\n\nexport function FilterLabel({\n  name,\n  label,\n  filterId,\n  onRemoveTag,\n  onRemoveFilter\n}: {\n  name: string;\n  label: string;\n  filterId: string;\n  onRemoveTag: (tagToRemove: string) => void;\n  onRemoveFilter?: (filterName: string, filterValue?: string) => void;\n}) {\n  const [displayLabel, setDisplayLabel] = useState(label);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Simplified display logic - resolve userId to username for display\n  useEffect(() => {\n    const resolveUserDisplay = async () => {\n      // Check if this looks like a user ID that needs resolution (numeric or UUID-like)\n      const isUserIdFormat = (value: string) => {\n        return (\n          /^\\\\d+$/.test(value) || // Numeric ID\n          /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(\n            value\n          )\n        ); // UUID\n      };\n\n      // Check if this looks like a valid username (alphanumeric, underscore, hyphen)\n      const isUsernameFormat = (value: string) => {\n        return /^[a-zA-Z0-9_-]+$/.test(value) && value.length >= 2;\n      };\n\n      // Check if this is the new combined format (username|userId)\n      const isCombinedFormat = (value: string) => {\n        return value.includes('|') && value.split('|').length === 2;\n      };\n\n      // Handle tags filter - ensure # prefix\n      if (name === 'tags') {\n        const tagValue = label.startsWith('#') ? label : `#${label}`;\n        setDisplayLabel(tagValue);\n        setIsLoading(false);\n        return;\n      }\n\n      // Handle search filter - split unquoted words but keep quoted text atomic\n      if (name === 'search') {\n        setDisplayLabel(label); // Keep as-is, will be handled in rendering\n        setIsLoading(false);\n        return;\n      }\n\n      // Handle combined format for mentions (username|userId)\n      if (\n        (name === 'mentions' || name === 'author') &&\n        isCombinedFormat(label)\n      ) {\n        const [username, userId] = label.split('|');\n        // Display format: @[username|userID] (structured format for ContentWithPills)\n        setDisplayLabel(`@[${username}|${userId}]`);\n        setIsLoading(false);\n        return;\n      }\n\n      // Check if we need async resolution for display purposes\n      let needsAsyncResolution = false;\n\n      if (\n        name === 'author' &&\n        label &&\n        !label.startsWith('@') &&\n        isUserIdFormat(label)\n      ) {\n        needsAsyncResolution = true;\n      } else if (\n        name === 'mentions' &&\n        label &&\n        !label.startsWith('@') &&\n        isUsernameFormat(label) &&\n        !isCombinedFormat(label)\n      ) {\n        // Only need async resolution for mentions if it's a plain username (not combined format)\n        needsAsyncResolution = true;\n      }\n\n      if (needsAsyncResolution) {\n        setIsLoading(true);\n      }\n\n      if (\n        name === 'author' &&\n        label &&\n        !label.startsWith('@') &&\n        isUserIdFormat(label)\n      ) {\n        // Author filter: label is a userId, resolve to username for display\n        try {\n          const { resolveUserIdToUsername } = await import(\n            '../../../lib/actions/search.actions'\n          );\n          const username = await resolveUserIdToUsername(label);\n          if (username) {\n            // Display format: @[username|userID] (structured format for ContentWithPills)\n            setDisplayLabel(`@[${username}|${label}]`);\n          } else {\n            // Fallback: show userId with @ prefix\n            setDisplayLabel(`@${label}`);\n          }\n        } catch (error) {\n          console.error('Error resolving user ID to username:', error);\n          setDisplayLabel(`@${label}`);\n        } finally {\n          setIsLoading(false);\n        }\n      } else if (\n        name === 'mentions' &&\n        label &&\n        !label.startsWith('@') &&\n        isUsernameFormat(label) &&\n        !isCombinedFormat(label)\n      ) {\n        // Mentions filter: label is a username, use as-is for display\n        setDisplayLabel(`@${label}`);\n        setIsLoading(false);\n      } else {\n        // Already formatted, plain text, or other types - no loading needed\n        setDisplayLabel(label);\n        setIsLoading(false);\n      }\n    };\n\n    resolveUserDisplay();\n  }, [name, label, displayLabel]);\n\n  const handleTagClick = (tagValue: string) => {\n    // FilterBar now preserves the correct format, so use the label directly\n    onRemoveTag(label);\n  };\n\n  const handleMentionClick = (\n    mentionValue: string,\n    filterType?: 'author' | 'mentions'\n  ) => {\n    // Always use the original label for removal since that's what's actually stored\n    // The label contains the exact value that was used to create the filter\n\n    if (name === 'author' && onRemoveFilter) {\n      // For author filters, label is the userId that was stored\n      onRemoveFilter('author', label);\n    } else if (name === 'mentions' && onRemoveFilter) {\n      // For mentions filters, label is the username that was stored\n      onRemoveFilter('mentions', label);\n    } else {\n      // Fallback to tag removal with original label\n      onRemoveTag(label);\n    }\n  };\n\n  // Handle filter type toggle for user mention pills\n  const handleFilterTypeToggle = () => {\n    if (!onRemoveFilter) return;\n\n    // Parse the display label to get user info\n    const mentionMatch = displayLabel.match(/^@\\\\[([^|]+)\\\\|([^\\\\]]+)\\\\]$/);\n    if (!mentionMatch) return;\n\n    const [, username, userId] = mentionMatch;\n\n    // Determine new filter type\n    const newFilterType = name === 'author' ? 'mentions' : 'author';\n\n    // Remove current filter\n    if (name === 'author') {\n      onRemoveFilter('author', label);\n    } else if (name === 'mentions') {\n      onRemoveFilter('mentions', label);\n    }\n\n    // Add new filter with appropriate value format\n    // We need to import the filter addition function\n    setTimeout(() => {\n      // This is a bit hacky, but we need to trigger the parent to add the new filter\n      // Since we don't have direct access to onAddFilter here, we'll use a custom event\n      const filterChangeEvent = new CustomEvent('filterTypeChange', {\n        detail: {\n          filterType: newFilterType,\n          // For author filters, backend expects just userId\n          // For mentions filters, we store combined format for display consistency\n          value: newFilterType === 'author' ? userId : `${username}|${userId}`,\n          oldFilterType: name,\n          oldValue: label\n        }\n      });\n      window.dispatchEvent(filterChangeEvent);\n    }, 0);\n  };\n\n  // Handle search text removal\n  const handleSearchTextClick = (searchText: string) => {\n    if (onRemoveFilter) {\n      // Parse the current search text to get all parts\n      const searchParts = parseSearchText(displayLabel);\n\n      // Remove the specific clicked part\n      const remainingParts = searchParts.filter((part) => {\n        // For quoted parts, the button shows \\\"text\\\" but part.text is just text\n        // For unquoted parts, both should match exactly\n        let partDisplay;\n\n        if (part.isQuoted) {\n          partDisplay = `\\\"${part.text}\\\"`;\n        } else {\n          partDisplay = part.text;\n        }\n\n        // The clicked text should match exactly what we display\n        const clickedDisplay = searchText;\n\n        return partDisplay !== clickedDisplay;\n      });\n\n      if (remainingParts.length > 0) {\n        // Reconstruct the search text with remaining parts\n        const newSearchText = remainingParts\n          .map((part) => (part.isQuoted ? `\\\"${part.text}\\\"` : part.text))\n          .join(' ');\n\n        // Use special format to signal partial removal - this handles both removal and update\n        onRemoveTag(`search:${searchText}:${newSearchText}`);\n      } else {\n        // No remaining parts, remove the entire search filter\n        onRemoveFilter('search', label);\n      }\n    } else {\n      onRemoveTag(label);\n    }\n  };\n\n  // Parse search text to handle quoted vs unquoted content\n  const parseSearchText = (text: string) => {\n    const parts: Array<{ text: string; isQuoted: boolean }> = [];\n    const regex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n    let match;\n\n    while ((match = regex.exec(text)) !== null) {\n      const quotedText = match[1]; // Captured quoted content\n      const unquotedText = match[2]; // Captured unquoted content\n\n      if (quotedText) {\n        // Quoted text - keep as atomic unit\n        parts.push({ text: quotedText, isQuoted: true });\n      } else if (unquotedText) {\n        // Unquoted text - can be split\n        parts.push({ text: unquotedText, isQuoted: false });\n      }\n    }\n\n    return parts;\n  };\n\n  // Show loading state for user mention filters while resolving (only for those that need resolution)\n  if (isLoading) {\n    return (\n      <div className=\\\"filter-bar__filter-value filter-bar__filter-value--loading\\\">\n        <span className=\\\"filter-bar__filter-loading-indicator\\\">\n          <span className=\\\"filter-bar__filter-loading-spinner\\\"></span>\n          {name === 'tags'\n            ? '#'\n            : name === 'author' || name === 'mentions'\n              ? '@'\n              : ''}\n          {label}\n        </span>\n        <span\n          className=\\\"filter-bar__filter-remove\\\"\n          aria-hidden=\\\"true\\\"\n          onClick={() => {\n            if (name === 'author' && onRemoveFilter) {\n              onRemoveFilter('author', label);\n            } else if (name === 'mentions' && onRemoveFilter) {\n              onRemoveFilter('mentions', label);\n            } else {\n              onRemoveTag(label);\n            }\n          }}\n          style={{ cursor: 'pointer' }}\n        >\n          \u00d7\n        </span>\n      </div>\n    );\n  }\n\n  // Special handling for search filters\n  if (name === 'search') {\n    const searchParts = parseSearchText(displayLabel);\n\n    return (\n      <div className=\\\"filter-bar__search-terms\\\">\n        {searchParts.map((part, index) => {\n          // Calculate the display format that matches what handleSearchTextClick expects\n          const displayFormat = part.isQuoted ? `\\\"${part.text}\\\"` : part.text;\n\n          return (\n            <button\n              key={`search-${index}-${part.text}`}\n              className={`filter-bar__filter-value ${part.isQuoted ? 'filter-bar__filter-value--quoted' : 'filter-bar__filter-value--word'}`}\n              onClick={() => handleSearchTextClick(displayFormat)}\n              aria-label={`Remove search term: ${part.text}`}\n              title={\n                part.isQuoted\n                  ? `Quoted search: \\\"${part.text}\\\"`\n                  : `Search word: ${part.text}`\n              }\n            >\n              {part.isQuoted ? `\\\"${part.text}\\\"` : part.text}\n              <span className=\\\"filter-bar__filter-remove\\\" aria-hidden=\\\"true\\\">\n                \u00d7\n              </span>\n            </button>\n          );\n        })}\n      </div>\n    );\n  }\n\n  // Special handling for user mention pills with filter type controls\n  if (\n    (name === 'author' || name === 'mentions') &&\n    displayLabel.startsWith('@')\n  ) {\n    return (\n      <div className=\\\"filter-bar__mention-pill-integrated\\\">\n        <ContentWithPills\n          content={displayLabel}\n          contextId={filterId}\n          isFilterBarContext={true}\n          onHashtagClick={handleTagClick}\n          onMentionClick={handleMentionClick}\n          className=\\\"filter-bar__filter-pill filter-bar__filter-pill--with-controls\\\"\n        />\n        <button\n          type=\\\"button\\\"\n          className={`filter-bar__filter-type-toggle filter-bar__filter-type-toggle--${name} filter-bar__filter-type-toggle--integrated`}\n          onClick={handleFilterTypeToggle}\n          title={`Current: ${name === 'author' ? 'Author' : 'Mentions'} filter. Click to toggle.`}\n        >\n          {name === 'author' ? 'BY' : 'IN'}\n        </button>\n      </div>\n    );\n  }\n\n  // If the display label starts with # or @, use ContentWithPills for proper styling\n  if (displayLabel.startsWith('#') || displayLabel.startsWith('@')) {\n    return (\n      <ContentWithPills\n        content={displayLabel}\n        contextId={filterId}\n        isFilterBarContext={true}\n        onHashtagClick={handleTagClick}\n        onMentionClick={handleMentionClick}\n        className=\\\"filter-bar__filter-pill\\\"\n      />\n    );\n  }\n\n  // Fallback for plain text labels\n  return (\n    <button\n      className=\\\"filter-bar__filter-value\\\"\n      onClick={() => {\n        if (name === 'author' && onRemoveFilter) {\n          onRemoveFilter('author', label);\n        } else if (name === 'mentions' && onRemoveFilter) {\n          onRemoveFilter('mentions', label);\n        } else {\n          onRemoveTag(label);\n        }\n      }}\n      aria-label={`Remove ${displayLabel} filter`}\n    >\n      {displayLabel}\n      <span className=\\\"filter-bar__filter-remove\\\" aria-hidden=\\\"true\\\">\n        \u00d7\n      </span>\n    </button>\n  );\n}\n",
    "language":"typescript",
    "lines":397,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/timeout-banner/TimeoutBanner.tsx":{
    "content":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useEffect, useState } from 'react';\nimport './TimeoutBanner.css';\n\ninterface TimeoutInfo {\n  is_timed_out: boolean;\n  expires_at?: string;\n  reason?: string;\n}\n\ninterface TimeRemaining {\n  days: number;\n  hours: number;\n  minutes: number;\n  seconds: number;\n}\n\nexport default function TimeoutBanner() {\n  const { data: session } = useSession();\n  const [timeoutInfo, setTimeoutInfo] = useState<TimeoutInfo | null>(null);\n  const [timeRemaining, setTimeRemaining] = useState<TimeRemaining | null>(\n    null\n  );\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Check timeout status\n  useEffect(() => {\n    if (!session?.user?.id) {\n      setIsLoading(false);\n      return;\n    }\n\n    const checkTimeout = async () => {\n      try {\n        const response = await fetch(`/api/user/timeout?type=post_creation`, {\n          credentials: 'include' // Ensure authentication headers are sent\n        });\n        if (response.ok) {\n          const data = await response.json();\n          setTimeoutInfo(data);\n        } else if (response.status === 401) {\n          // User session expired, don't log this as an error\n          // eslint-disable-next-line no-console\n          console.debug('User session expired, skipping timeout check');\n        }\n      } catch (error) {\n        console.error('Error checking timeout:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    checkTimeout();\n\n    // Check every minute for updates\n    const interval = setInterval(checkTimeout, 60000);\n    return () => clearInterval(interval);\n  }, [session?.user?.id]);\n\n  // Update countdown timer\n  useEffect(() => {\n    if (!timeoutInfo?.is_timed_out || !timeoutInfo.expires_at) {\n      setTimeRemaining(null);\n      return;\n    }\n\n    const updateTimer = () => {\n      const now = new Date().getTime();\n      const expiresAt = new Date(timeoutInfo.expires_at!).getTime();\n      const difference = expiresAt - now;\n\n      if (difference <= 0) {\n        setTimeRemaining(null);\n        setTimeoutInfo(null);\n        return;\n      }\n\n      const days = Math.floor(difference / (1000 * 60 * 60 * 24));\n      const hours = Math.floor(\n        (difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)\n      );\n      const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));\n      const seconds = Math.floor((difference % (1000 * 60)) / 1000);\n\n      setTimeRemaining({ days, hours, minutes, seconds });\n    };\n\n    updateTimer();\n    const interval = setInterval(updateTimer, 1000);\n\n    return () => clearInterval(interval);\n  }, [timeoutInfo]);\n\n  // Don't render if loading or no timeout\n  if (isLoading || !timeoutInfo?.is_timed_out || !timeRemaining) {\n    return null;\n  }\n\n  const formatTimeRemaining = () => {\n    const parts = [];\n\n    if (timeRemaining.days > 0) {\n      parts.push(`${timeRemaining.days}d`);\n    }\n    if (timeRemaining.hours > 0) {\n      parts.push(`${timeRemaining.hours}h`);\n    }\n    if (timeRemaining.minutes > 0) {\n      parts.push(`${timeRemaining.minutes}m`);\n    }\n    if (timeRemaining.seconds > 0 && timeRemaining.days === 0) {\n      parts.push(`${timeRemaining.seconds}s`);\n    }\n\n    return parts.join(' ') || '0s';\n  };\n\n  return (\n    <div className=\\\"timeout-banner\\\">\n      <div className=\\\"timeout-banner__content\\\">\n        <div className=\\\"timeout-banner__icon\\\">\u23f0</div>\n        <div className=\\\"timeout-banner__text\\\">\n          <div className=\\\"timeout-banner__title\\\">\n            You are temporarily restricted from creating posts\n          </div>\n          <div className=\\\"timeout-banner__details\\\">\n            <span className=\\\"timeout-banner__reason\\\">\n              Reason: {timeoutInfo.reason}\n            </span>\n            <span className=\\\"timeout-banner__timer\\\">\n              Time remaining: {formatTimeRemaining()}\n            </span>\n          </div>\n        </div>\n        <div className=\\\"timeout-banner__close\\\">\n          <button\n            onClick={() => setTimeoutInfo(null)}\n            className=\\\"timeout-banner__close-btn\\\"\n            aria-label=\\\"Dismiss notification\\\"\n          >\n            \u00d7\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":150,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/docs-link/DocsLink.tsx":{
    "content":"import React from 'react';\nimport { DOCS_LINK_SELECTORS } from '../../../lib/test-selectors/components/docs-link.selectors';\nimport { LinkTooltip } from '../tooltip/LinkTooltip';\n\nexport const DocsLink: React.FC = () => {\n  return (\n    <LinkTooltip\n      url=\\\"https://underwood-inc.github.io/idling.app__UI/\\\"\n      isInsideParagraph\n    >\n      <a\n        data-testid={DOCS_LINK_SELECTORS.LINK}\n        href=\\\"https://underwood-inc.github.io/idling.app__UI/\\\"\n        target=\\\"_blank\\\"\n      >\n        Docs\n      </a>\n    </LinkTooltip>\n  );\n};\n",
    "language":"typescript",
    "lines":21,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/docs-link/DocsLink.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { DOCS_LINK_SELECTORS } from '../../../lib/test-selectors/components/docs-link.selectors';\nimport { DocsLink } from './DocsLink';\n\ndescribe('Docs Link', () => {\n  it('renders the Docs link', () => {\n    render(<DocsLink />);\n\n    const linkElement = screen.getByTestId(DOCS_LINK_SELECTORS.LINK);\n\n    expect(linkElement).toBeVisible();\n    expect(linkElement).toBeEnabled();\n    expect(linkElement).toHaveAttribute(\n      'href',\n      'https://underwood-inc.github.io/idling.app__UI/'\n    );\n    expect(linkElement).toHaveAttribute('target', '_blank');\n  });\n\n  it('has the correct text content', () => {\n    render(<DocsLink />);\n\n    const linkElement = screen.getByTestId(DOCS_LINK_SELECTORS.LINK);\n\n    expect(linkElement).toHaveTextContent('Docs');\n  });\n});\n",
    "language":"typescript",
    "lines":28,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/docs-link/Docs.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { DOCS_LINK_SELECTORS } from '../../../lib/test-selectors/components/docs-link.selectors';\nimport { DocsLink } from './DocsLink';\n\ndescribe('Docs Link', () => {\n  it('renders the Docs link', () => {\n    render(<DocsLink />);\n\n    screen.findByRole('heading');\n\n    expect(screen.getByTestId(DOCS_LINK_SELECTORS.LINK))\n      .toBeVisible()\n      .toBeEnabled()\n      .toHaveAttribute(\n        'href',\n        'https://underwood-inc.github.io/idling.app__UI/'\n      )\n      .toHaveAttribute('target', '_blank');\n  });\n});\n",
    "language":"typescript",
    "lines":21,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/nav/NavPaths.test.tsx":{
    "content":"import {\n  HEADER_NAV_PATHS,\n  NAV_PATH_LABELS,\n  NAV_PATHS\n} from '../../../lib/routes';\nimport { act, render, screen } from '../../../test-utils';\nimport { NavPaths } from './NavPaths';\n\njest.mock('next/config');\n\njest.mock('next/link', () => {\n  const MockLink = ({ children, ...props }: any) => (\n    <a {...props}>{children}</a>\n  );\n  MockLink.displayName = 'MockLink';\n  return MockLink;\n});\n\njest.mock('../navbar/Navbar', () => ({\n  Navbar: {\n    Item: ({ children, isDisabled }: any) => (\n      <div data-disabled={isDisabled}>{children}</div>\n    )\n  }\n}));\n\n// Get the mocked functions\nconst mockUsePathname = jest.fn();\nconst mockUseSearchParams = jest.fn();\n\n// Mock next/navigation locally\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    prefetch: jest.fn(),\n    back: jest.fn(),\n    forward: jest.fn(),\n    refresh: jest.fn()\n  }),\n  usePathname: () => mockUsePathname(),\n  useSearchParams: () => mockUseSearchParams()\n}));\n\ndescribe('NavPaths', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockUsePathname.mockClear();\n    mockUseSearchParams.mockClear();\n  });\n\n  it('renders all navigation paths', () => {\n    mockUsePathname.mockReturnValue('/');\n    mockUseSearchParams.mockReturnValue({\n      get: jest.fn().mockReturnValue(null)\n    });\n    render(<NavPaths />);\n\n    Object.entries(HEADER_NAV_PATHS).forEach(([key, path]) => {\n      const element = screen.getByRole('link', {\n        name: NAV_PATH_LABELS[key as keyof typeof NAV_PATH_LABELS]\n      });\n      expect(element).toBeInTheDocument();\n      expect(element).toHaveAttribute('href', path);\n    });\n  });\n\n  it('marks the current path as active', () => {\n    mockUsePathname.mockReturnValue(NAV_PATHS.POSTS);\n    mockUseSearchParams.mockReturnValue({\n      get: jest.fn().mockReturnValue(null)\n    });\n    render(<NavPaths />);\n\n    const activeLink = screen.getByRole('link', {\n      name: NAV_PATH_LABELS.POSTS\n    });\n    expect(activeLink).toHaveClass('active');\n  });\n\n  it('appends tags to supported routes', async () => {\n    mockUsePathname.mockReturnValue(NAV_PATHS.POSTS);\n    const mockGet = jest.fn().mockReturnValue('tag1,tag2');\n    mockUseSearchParams.mockReturnValue({ get: mockGet });\n\n    await act(async () => {\n      render(<NavPaths />);\n    });\n\n    const postsLink = screen.getByRole('link', { name: NAV_PATH_LABELS.POSTS });\n    const myPostsLink = screen.getByRole('link', {\n      name: NAV_PATH_LABELS.MY_POSTS\n    });\n\n    expect(postsLink).toHaveAttribute(\n      'href',\n      `${NAV_PATHS.POSTS}?tags=tag1,tag2`\n    );\n    expect(myPostsLink).toHaveAttribute(\n      'href',\n      `${NAV_PATHS.MY_POSTS}?tags=tag1,tag2`\n    );\n\n    expect(mockGet).toHaveBeenCalledWith('tags');\n  });\n\n  it('updates path when pathname changes, with and without tags', async () => {\n    let mockGet = jest.fn().mockReturnValue('tag1,tag2');\n    mockUseSearchParams.mockReturnValue({ get: mockGet });\n\n    // Initial render with POSTS path and tags\n    mockUsePathname.mockReturnValue(NAV_PATHS.POSTS);\n    const { rerender } = render(<NavPaths />);\n\n    let postsLink = screen.getByRole('link', { name: NAV_PATH_LABELS.POSTS });\n    let myPostsLink = screen.getByRole('link', {\n      name: NAV_PATH_LABELS.MY_POSTS\n    });\n\n    expect(postsLink).toHaveAttribute(\n      'href',\n      `${NAV_PATHS.POSTS}?tags=tag1,tag2`\n    );\n    expect(myPostsLink).toHaveAttribute(\n      'href',\n      `${NAV_PATHS.MY_POSTS}?tags=tag1,tag2`\n    );\n\n    // Simulate pathname change to MY_POSTS, still with tags\n    mockUsePathname.mockReturnValue(NAV_PATHS.MY_POSTS);\n    await act(async () => {\n      rerender(<NavPaths />);\n    });\n\n    postsLink = screen.getByRole('link', { name: NAV_PATH_LABELS.POSTS });\n    myPostsLink = screen.getByRole('link', { name: NAV_PATH_LABELS.MY_POSTS });\n\n    expect(postsLink).toHaveAttribute('href', NAV_PATHS.POSTS);\n    expect(myPostsLink).toHaveAttribute(\n      'href',\n      `${NAV_PATHS.MY_POSTS}?tags=tag1,tag2`\n    );\n\n    // Now simulate no tags\n    mockGet = jest.fn().mockReturnValue(null);\n    mockUseSearchParams.mockReturnValue({ get: mockGet });\n\n    // Change pathname back to POSTS with no tags\n    mockUsePathname.mockReturnValue(NAV_PATHS.POSTS);\n    await act(async () => {\n      rerender(<NavPaths />);\n    });\n\n    postsLink = screen.getByRole('link', { name: NAV_PATH_LABELS.POSTS });\n    myPostsLink = screen.getByRole('link', { name: NAV_PATH_LABELS.MY_POSTS });\n\n    expect(postsLink).toHaveAttribute('href', NAV_PATHS.POSTS);\n    expect(myPostsLink).toHaveAttribute('href', NAV_PATHS.MY_POSTS);\n\n    expect(mockGet).toHaveBeenCalledWith('tags');\n  });\n});\n",
    "language":"typescript",
    "lines":163,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/nav/NavPaths.tsx":{
    "content":"/* eslint-disable custom-rules/enforce-link-target-blank */\n'use client';\n\nimport { usePathname, useSearchParams } from 'next/navigation';\nimport { Suspense, useEffect, useRef, useState } from 'react';\nimport {\n  HEADER_NAV_PATHS,\n  NAV_PATH_LABELS,\n  NAV_PATHS,\n  ROUTES\n} from '../../../lib/routes';\nimport { Navbar } from '../navbar/Navbar';\nimport { InstantLink } from '../ui/InstantLink';\n\n/**\n * Internal NavPaths component that uses useSearchParams\n */\nfunction NavPathsInternal() {\n  const [lastPath, setLastPath] = useState('');\n  const currentPath = usePathname();\n  const searchParams = useSearchParams();\n  const paths = Object.entries(HEADER_NAV_PATHS) as [ROUTES, string][];\n  const isFirstRender = useRef(true);\n\n  useEffect(() => {\n    if (!isFirstRender.current) {\n      setLastPath(`${currentPath}${searchParams.get('tags') || ''}`);\n    } else {\n      isFirstRender.current = false;\n    }\n  }, [currentPath, searchParams]);\n\n  return (\n    <>\n      {paths.map(([key, value]) => {\n        const isActive = currentPath === value;\n        const isDisabled = key === 'GAME';\n        let path = value;\n        const tags = searchParams.get('tags');\n\n        const isTagSupportedRoute =\n          value === NAV_PATHS.POSTS || value === NAV_PATHS.MY_POSTS;\n\n        if (isTagSupportedRoute && tags) {\n          if (lastPath === '' || lastPath.startsWith(value)) {\n            path = `${value}?tags=${tags}`;\n          }\n        }\n\n        return (\n          <Navbar.Item key={`path--${key}`} isDisabled={isDisabled}>\n            <InstantLink\n              href={path}\n              className={`instant-link--nav ${isActive ? 'active' : ''}`}\n              aria-disabled={isDisabled}\n            >\n              {NAV_PATH_LABELS[key]}\n            </InstantLink>\n          </Navbar.Item>\n        );\n      })}\n    </>\n  );\n}\n\n/**\n * Main NavPaths component with Suspense wrapper\n */\nexport function NavPaths() {\n  return (\n    <Suspense\n      fallback={\n        <>\n          {Object.entries(HEADER_NAV_PATHS).map(([key, value]) => (\n            <Navbar.Item key={`path--${key}`} isDisabled={key === 'GAME'}>\n              <InstantLink\n                href={value}\n                aria-disabled={key === 'GAME'}\n                className=\\\"instant-link--nav\\\"\n              >\n                {NAV_PATH_LABELS[key as ROUTES]}\n              </InstantLink>\n            </Navbar.Item>\n          ))}\n        </>\n      }\n    >\n      <NavPathsInternal />\n    </Suspense>\n  );\n}\n",
    "language":"typescript",
    "lines":92,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/nav/Nav.tsx":{
    "content":"/* eslint-disable custom-rules/enforce-link-target-blank */\nimport { unstable_noStore as noStore } from 'next/cache';\nimport { NAV_SELECTORS } from 'src/lib/test-selectors/components/nav.selectors';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport { Navbar } from '../navbar/Navbar';\nimport { InstantLink } from '../ui/InstantLink';\nimport { UserSearch } from '../user-search/UserSearch';\nimport './Nav.css';\nimport { NavAuth } from './NavAuth';\nimport { NavPaths } from './NavPaths';\n\nexport default async function Nav() {\n  // Prevent caching to ensure fresh permission checks\n  noStore();\n\n  return (\n    <Navbar>\n      <Navbar.Body className=\\\"nav__content\\\">\n        <Navbar.Content\n          justify=\\\"flex-start\\\"\n          className=\\\"nav__links nav__links--as-flex-end\\\"\n        >\n          <NavPaths />\n        </Navbar.Content>\n\n        <Navbar.Content justify=\\\"center\\\" className=\\\"nav__brand\\\">\n          <Navbar.Brand />\n\n          <InstantLink\n            href={NAV_PATHS.ROOT}\n            data-testid={NAV_SELECTORS.HOME_LINK}\n          >\n            <h1 className=\\\"nav__header\\\">Idling.app</h1>\n          </InstantLink>\n        </Navbar.Content>\n\n        <Navbar.Content justify=\\\"flex-end\\\" className=\\\"nav--as-flex-end\\\">\n          <Navbar.Item className=\\\"nav__search\\\">\n            <UserSearch placeholder=\\\"Find users...\\\" />\n          </Navbar.Item>\n          <Navbar.Item className=\\\"nav__auth\\\">\n            <NavAuth />\n          </Navbar.Item>\n        </Navbar.Content>\n      </Navbar.Body>\n    </Navbar>\n  );\n}\n",
    "language":"typescript",
    "lines":49,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/nav/NavAuth.tsx":{
    "content":"/* eslint-disable custom-rules/enforce-link-target-blank */\nimport { NAV_SELECTORS } from 'src/lib/test-selectors/components/nav.selectors';\nimport { auth } from '../../../lib/auth';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport { SignOut } from '../auth-buttons/AuthButtons';\nimport { InstantLink } from '../ui/InstantLink';\nimport { NavUserProfile } from './NavUserProfile';\n\nexport async function NavAuth() {\n  const session = await auth();\n\n  if (!session) {\n    return (\n      <div className=\\\"nav__auth-links\\\">\n        <InstantLink\n          href={NAV_PATHS.SIGNIN}\n          data-testid={NAV_SELECTORS.SIGN_IN_LINK}\n        >\n          Sign In\n        </InstantLink>\n      </div>\n    );\n  }\n\n  const profileUrl = session.user?.id\n    ? `/profile/${session.user.id}`\n    : '/profile/unknown';\n\n  return (\n    <div className=\\\"nav__auth\\\">\n      <div className=\\\"nav__auth-links\\\">\n        <InstantLink href={profileUrl} data-testid={NAV_SELECTORS.PROFILE_LINK}>\n          <div className=\\\"nav__user-profile\\\">\n            <NavUserProfile initialSession={session} />\n          </div>\n        </InstantLink>\n      </div>\n\n      <SignOut data-testid={NAV_SELECTORS.SIGN_OUT_BUTTON} />\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":43,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/nav/Nav.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport React from 'react';\nimport { NAV_SELECTORS } from 'src/lib/test-selectors/components/nav.selectors';\nimport { auth } from '../../../lib/auth';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport Nav from './Nav';\n\n// Mock the dependencies\njest.mock('../../../lib/auth', () => ({\n  auth: jest.fn()\n}));\n\njest.mock('next/link', () => {\n  const MockLink = ({\n    children,\n    href\n  }: {\n    children: React.ReactNode;\n    href: string;\n  }) => <a href={href}>{children}</a>;\n  MockLink.displayName = 'MockLink';\n  return MockLink;\n});\n\njest.mock('./NavPaths', () => ({\n  NavPaths: () => <div data-testid=\\\"nav-paths\\\">NavPaths</div>\n}));\n\njest.mock('../navbar/Navbar', () => ({\n  Navbar: {\n    Body: ({ children }: { children: React.ReactNode }) => (\n      <div>{children}</div>\n    ),\n    Content: ({ children }: { children: React.ReactNode }) => (\n      <div>{children}</div>\n    ),\n    Brand: () => <div>Brand</div>,\n    Item: ({ children }: { children: React.ReactNode }) => <div>{children}</div>\n  }\n}));\n\njest.mock('../auth-buttons/AuthButtons', () => ({\n  SignOut: () => <button>Sign Out</button>\n}));\n\n// Mock the Nav component\njest.mock('./Nav', () => {\n  return {\n    __esModule: true,\n    default: jest.fn()\n  };\n});\n\ndescribe('Nav', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders correctly when user is not authenticated', async () => {\n    (auth as jest.Mock).mockResolvedValue(null);\n    const mockNavContent = (\n      <div>\n        <a href={NAV_PATHS.ROOT} data-testid={NAV_SELECTORS.HOME_LINK}>\n          Idling.app\n        </a>\n        <div data-testid={NAV_SELECTORS.NAV_PATHS}>NavPaths</div>\n        <a href={NAV_PATHS.SIGNIN} data-testid={NAV_SELECTORS.SIGN_IN_LINK}>\n          Sign In\n        </a>\n      </div>\n    );\n    jest.mocked(Nav).mockResolvedValue(mockNavContent);\n\n    render(await Nav());\n\n    expect(screen.getByTestId(NAV_SELECTORS.HOME_LINK)).toBeInTheDocument();\n    expect(screen.getByTestId(NAV_SELECTORS.NAV_PATHS)).toBeInTheDocument();\n    expect(screen.getByTestId(NAV_SELECTORS.SIGN_IN_LINK)).toBeInTheDocument();\n    expect(\n      screen.queryByTestId(NAV_SELECTORS.SIGN_OUT_BUTTON)\n    ).not.toBeInTheDocument();\n  });\n\n  it('renders correctly when user is authenticated', async () => {\n    (auth as jest.Mock).mockResolvedValue({\n      user: { name: 'Test User' }\n    });\n    const mockNavContent = (\n      <div>\n        <a href={NAV_PATHS.ROOT} data-testid={NAV_SELECTORS.HOME_LINK}>\n          Idling.app\n        </a>\n        <div data-testid={NAV_SELECTORS.NAV_PATHS}>NavPaths</div>\n        <span data-testid={NAV_SELECTORS.USER_NAME}>Test User</span>\n        <button data-testid={NAV_SELECTORS.SIGN_OUT_BUTTON}>Sign Out</button>\n      </div>\n    );\n    jest.mocked(Nav).mockResolvedValue(mockNavContent);\n\n    render(await Nav());\n\n    expect(screen.getByTestId(NAV_SELECTORS.HOME_LINK)).toBeInTheDocument();\n    expect(screen.getByTestId(NAV_SELECTORS.NAV_PATHS)).toBeInTheDocument();\n    expect(screen.getByTestId(NAV_SELECTORS.USER_NAME)).toBeInTheDocument();\n    expect(\n      screen.getByTestId(NAV_SELECTORS.SIGN_OUT_BUTTON)\n    ).toBeInTheDocument();\n    expect(\n      screen.queryByTestId(NAV_SELECTORS.SIGN_IN_LINK)\n    ).not.toBeInTheDocument();\n  });\n\n  it('renders the correct links', async () => {\n    (auth as jest.Mock).mockResolvedValue(null);\n    const mockNavContent = (\n      <div>\n        <a href={NAV_PATHS.ROOT} data-testid={NAV_SELECTORS.HOME_LINK}>\n          Idling.app\n        </a>\n        <div data-testid={NAV_SELECTORS.NAV_PATHS}>NavPaths</div>\n        <a href={NAV_PATHS.SIGNIN} data-testid={NAV_SELECTORS.SIGN_IN_LINK}>\n          Sign In\n        </a>\n      </div>\n    );\n    jest.mocked(Nav).mockResolvedValue(mockNavContent);\n\n    render(await Nav());\n\n    expect(screen.getByTestId(NAV_SELECTORS.HOME_LINK)).toHaveAttribute(\n      'href',\n      NAV_PATHS.ROOT\n    );\n    expect(screen.getByTestId(NAV_SELECTORS.SIGN_IN_LINK)).toHaveAttribute(\n      'href',\n      NAV_PATHS.SIGNIN\n    );\n  });\n});\n",
    "language":"typescript",
    "lines":140,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/nav/NavUserProfile.tsx":{
    "content":"'use client';\n\nimport { Session } from 'next-auth';\nimport { useSession } from 'next-auth/react';\n\ninterface NavUserProfileProps {\n  initialSession?: Session;\n}\n\nexport function NavUserProfile({ initialSession }: NavUserProfileProps) {\n  const { data: session, status } = useSession();\n\n  // Use initialSession during hydration to prevent layout shift\n  const currentSession = session || initialSession;\n\n  // Show loading placeholder only if we have no session data at all\n  if (status === 'loading' && !currentSession) {\n    return (\n      <h3 className=\\\"header__user-name\\\" style={{ opacity: 0.6 }}>\n        Loading...\n      </h3>\n    );\n  }\n\n  // Don't render anything if not authenticated\n  if (!currentSession?.user) {\n    return null;\n  }\n\n  return <h3 className=\\\"header__user-name\\\">{currentSession.user.name}</h3>;\n}\n",
    "language":"typescript",
    "lines":32,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/loader/Loader.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { LOADER_SELECTORS } from 'src/lib/test-selectors/components/loader.selectors';\nimport Loader from './Loader';\n\ndescribe('Loader', () => {\n  it('renders with default props', () => {\n    render(<Loader />);\n    expect(screen.getByText('Loading Data...')).toBeInTheDocument();\n    expect(screen.getByTestId(LOADER_SELECTORS.LOADER)).toBeInTheDocument();\n  });\n\n  it('renders with custom label', () => {\n    render(<Loader label=\\\"Custom Loading...\\\" />);\n    expect(screen.getByText('Custom Loading...')).toBeInTheDocument();\n    expect(screen.getByTestId(LOADER_SELECTORS.LOADER)).toBeInTheDocument();\n  });\n\n  it('renders without label when label prop is empty', () => {\n    render(<Loader label=\\\"\\\" />);\n    expect(screen.queryByText('Loading Data...')).not.toBeInTheDocument();\n    expect(screen.getByTestId(LOADER_SELECTORS.LOADER)).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":24,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/loader/Loader.tsx":{
    "content":"'use client';\nimport { ScaleLoader } from 'react-spinners';\nimport { LOADER_SELECTORS } from 'src/lib/test-selectors/components/loader.selectors';\nimport './Loader.css';\n\nexport default function Loader({\n  label = 'Loading Data...',\n  color = 'white'\n}: {\n  label?: string;\n  color?: string;\n}) {\n  return (\n    <div className=\\\"loader\\\">\n      {label && <p>{label}</p>}\n      <ScaleLoader data-testid={LOADER_SELECTORS.LOADER} color={color} />\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":20,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/user-search/UserSearch.tsx":{
    "content":"'use client';\n\nimport { useRouter } from 'next/navigation';\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport './UserSearch.css';\n\ninterface UserSearchResult {\n  id: string;\n  name: string;\n  email?: string;\n  username?: string;\n  image?: string;\n}\n\ninterface UserSearchProps {\n  placeholder?: string;\n  className?: string;\n  onUserSelect?: (user: UserSearchResult) => void;\n}\n\nexport function UserSearch({\n  placeholder = 'Search for users...',\n  className = '',\n  onUserSelect\n}: UserSearchProps) {\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState<UserSearchResult[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedIndex, setSelectedIndex] = useState(-1);\n\n  const searchRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const router = useRouter();\n\n  // Debounced search function\n  const searchUsers = useCallback(async (searchQuery: string) => {\n    if (!searchQuery.trim() || searchQuery.length < 2) {\n      setResults([]);\n      setIsOpen(false);\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await fetch(\n        `/api/users/search?q=${encodeURIComponent(searchQuery)}&limit=8`\n      );\n      if (response.ok) {\n        const data = await response.json();\n        setResults(data.users || []);\n        setIsOpen(true);\n      } else {\n        setResults([]);\n        setIsOpen(false);\n      }\n    } catch (error) {\n      console.error('Search error:', error);\n      setResults([]);\n      setIsOpen(false);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Debounce search requests\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      searchUsers(query);\n    }, 300);\n\n    return () => clearTimeout(timeoutId);\n  }, [query, searchUsers]);\n\n  // Handle keyboard navigation\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (!isOpen) return;\n\n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          setSelectedIndex((prev) =>\n            prev < results.length - 1 ? prev + 1 : prev\n          );\n          break;\n        case 'ArrowUp':\n          e.preventDefault();\n          setSelectedIndex((prev) => (prev > 0 ? prev - 1 : -1));\n          break;\n        case 'Enter':\n          e.preventDefault();\n          if (selectedIndex >= 0 && results[selectedIndex]) {\n            handleUserSelect(results[selectedIndex]);\n          }\n          break;\n        case 'Escape':\n          setIsOpen(false);\n          setSelectedIndex(-1);\n          inputRef.current?.blur();\n          break;\n      }\n    },\n    [isOpen, results, selectedIndex]\n  );\n\n  // Handle user selection\n  const handleUserSelect = useCallback(\n    (user: UserSearchResult) => {\n      setQuery('');\n      setResults([]);\n      setIsOpen(false);\n      setSelectedIndex(-1);\n\n      if (onUserSelect) {\n        onUserSelect(user);\n      } else {\n        // Navigate to user profile\n        router.push(`/profile/${user.id}`);\n      }\n    },\n    [onUserSelect, router]\n  );\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        searchRef.current &&\n        !searchRef.current.contains(event.target as Node)\n      ) {\n        setIsOpen(false);\n        setSelectedIndex(-1);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  return (\n    <div className={`user-search ${className}`} ref={searchRef}>\n      <div className=\\\"user-search__input-container\\\">\n        <input\n          ref={inputRef}\n          type=\\\"text\\\"\n          value={query}\n          onChange={(e) => setQuery(e.target.value)}\n          onKeyDown={handleKeyDown}\n          placeholder={placeholder}\n          className=\\\"user-search__input\\\"\n          autoComplete=\\\"off\\\"\n        />\n        <div className=\\\"user-search__icon\\\">\n          {isLoading ? (\n            <div className=\\\"user-search__spinner\\\" />\n          ) : (\n            <span>\ud83d\udd0d</span>\n          )}\n        </div>\n      </div>\n\n      {isOpen && results.length > 0 && (\n        <div className=\\\"user-search__dropdown\\\">\n          <div className=\\\"user-search__results\\\">\n            {results.map((user, index) => (\n              <button\n                key={user.id}\n                className={`user-search__result ${\n                  index === selectedIndex ? 'user-search__result--selected' : ''\n                }`}\n                onClick={() => handleUserSelect(user)}\n                onMouseEnter={() => setSelectedIndex(index)}\n              >\n                <div className=\\\"user-search__result-content\\\">\n                  <div className=\\\"user-search__result-info\\\">\n                    <span className=\\\"user-search__result-name\\\">\n                      {user.name || user.username || 'Anonymous User'}\n                    </span>\n                    {user.email && (\n                      <span className=\\\"user-search__result-email\\\">\n                        {user.email}\n                      </span>\n                    )}\n                  </div>\n                  <div className=\\\"user-search__result-action\\\">\n                    <span className=\\\"user-search__result-arrow\\\">\u2192</span>\n                  </div>\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {isOpen && query.length >= 2 && !isLoading && results.length === 0 && (\n        <div className=\\\"user-search__dropdown\\\">\n          <div className=\\\"user-search__no-results\\\">\n            <span className=\\\"user-search__no-results-icon\\\">\ud83e\udd37\u200d\u2642\ufe0f</span>\n            <span className=\\\"user-search__no-results-text\\\">\n              No users found for &quot;{query}&quot;\n            </span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":209,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/vote-buttons/VoteButtons.tsx":{
    "content":"'use client';\nimport { useState } from 'react';\nimport { voteComment } from 'src/lib/actions/comment.actions';\nimport { votePost } from 'src/lib/actions/post.actions';\nimport './VoteButtons.css';\n\ninterface VoteButtonsProps {\n  score: number;\n  id: string;\n  type: 'post' | 'comment';\n}\n\nexport default function VoteButtons({ score, id, type }: VoteButtonsProps) {\n  const [currentScore, setCurrentScore] = useState(score);\n  const [isVoting, setIsVoting] = useState(false);\n  const [hasUpvoted, setHasUpvoted] = useState(false);\n  const [hasDownvoted, setHasDownvoted] = useState(false);\n\n  const handleVote = async (voteType: 1 | -1) => {\n    try {\n      setIsVoting(true);\n      if (type === 'post') {\n        await votePost(id, voteType);\n      } else {\n        await voteComment(id, voteType);\n      }\n      setCurrentScore((prevScore) => prevScore + voteType);\n      if (voteType === 1) {\n        setHasUpvoted(true);\n        setHasDownvoted(false);\n      } else {\n        setHasUpvoted(false);\n        setHasDownvoted(true);\n      }\n    } catch (error) {\n      console.error('Error voting:', error);\n    } finally {\n      setIsVoting(false);\n    }\n  };\n\n  return (\n    <div className=\\\"vote-buttons\\\">\n      <div className=\\\"vote-buttons__container\\\">\n        <button\n          onClick={() => handleVote(1)}\n          disabled={isVoting}\n          className={`vote-buttons__button vote-buttons__button--up ${hasUpvoted ? 'vote-buttons__button--active' : ''}`}\n          aria-label=\\\"Upvote\\\"\n        >\n          \u25b2\n        </button>\n        <span className=\\\"vote-buttons__score\\\">{currentScore}</span>\n        <button\n          onClick={() => handleVote(-1)}\n          disabled={isVoting}\n          className={`vote-buttons__button vote-buttons__button--down ${hasDownvoted ? 'vote-buttons__button--active' : ''}`}\n          aria-label=\\\"Downvote\\\"\n        >\n          \u25bc\n        </button>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":66,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/pwa-install/PWAInstallPrompt.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport './PWAInstallPrompt.css';\n\ninterface BeforeInstallPromptEvent extends Event {\n  readonly platforms: string[];\n  readonly userChoice: Promise<{\n    outcome: 'accepted' | 'dismissed';\n    platform: string;\n  }>;\n  prompt(): Promise<void>;\n}\n\nconst PWAInstallPrompt: React.FC = () => {\n  const [deferredPrompt, setDeferredPrompt] =\n    useState<BeforeInstallPromptEvent | null>(null);\n  const [showPrompt, setShowPrompt] = useState(false);\n  const [isInstalled, setIsInstalled] = useState(false);\n  const [isSupported, setIsSupported] = useState(false);\n\n  // Note: Removed route-specific positioning logic as PWA prompt now uses\n  // consistent top: 2rem; right: 2rem positioning regardless of route\n\n  useEffect(() => {\n    // Check if PWA is already installed\n    const checkIfInstalled = () => {\n      // Check for standalone mode (PWA is installed)\n      if (window.matchMedia('(display-mode: standalone)').matches) {\n        setIsInstalled(true);\n        return;\n      }\n\n      // Check for iOS Safari PWA\n      if ((window.navigator as any).standalone === true) {\n        setIsInstalled(true);\n        return;\n      }\n\n      // Check if running in TWA (Trusted Web Activity)\n      if (document.referrer.includes('android-app://')) {\n        setIsInstalled(true);\n        return;\n      }\n    };\n\n    checkIfInstalled();\n\n    // Listen for the beforeinstallprompt event\n    const handleBeforeInstallPrompt = (e: Event) => {\n      e.preventDefault();\n      const beforeInstallPromptEvent = e as BeforeInstallPromptEvent;\n      setDeferredPrompt(beforeInstallPromptEvent);\n      setIsSupported(true);\n\n      // Show prompt after a short delay to avoid being too aggressive\n      setTimeout(() => {\n        if (!isInstalled) {\n          setShowPrompt(true);\n        }\n      }, 3000);\n    };\n\n    // Listen for app installed event\n    const handleAppInstalled = () => {\n      setIsInstalled(true);\n      setShowPrompt(false);\n      setDeferredPrompt(null);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener(\n        'beforeinstallprompt',\n        handleBeforeInstallPrompt\n      );\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, [isInstalled]);\n\n  const handleInstallClick = async () => {\n    if (!deferredPrompt) return;\n\n    try {\n      // Show the install prompt\n      await deferredPrompt.prompt();\n\n      // Wait for the user's response\n      const choiceResult = await deferredPrompt.userChoice;\n\n      if (choiceResult.outcome === 'accepted') {\n        // User accepted the install prompt\n      } else {\n        // User dismissed the install prompt\n      }\n    } catch (error) {\n      // Error showing install prompt - fail silently\n    } finally {\n      // Clear the deferredPrompt\n      setDeferredPrompt(null);\n      setShowPrompt(false);\n    }\n  };\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    // Hide for this session\n    sessionStorage.setItem('pwa-prompt-dismissed', 'true');\n  };\n\n  // Don't show if already installed, not supported, or dismissed this session\n  if (\n    isInstalled ||\n    !isSupported ||\n    !showPrompt ||\n    sessionStorage.getItem('pwa-prompt-dismissed')\n  ) {\n    return null;\n  }\n\n  return (\n    <div className=\\\"pwa-install-prompt\\\">\n      <div className=\\\"pwa-install-prompt__content\\\">\n        <div className=\\\"pwa-install-prompt__icon\\\">\ud83d\udcf1</div>\n        <div className=\\\"pwa-install-prompt__text\\\">\n          <span className=\\\"pwa-install-prompt__title\\\">Install App</span>\n          <span className=\\\"pwa-install-prompt__subtitle\\\">\n            Get the full experience\n          </span>\n        </div>\n        <div className=\\\"pwa-install-prompt__actions\\\">\n          <button\n            onClick={handleInstallClick}\n            className=\\\"pwa-install-prompt__install-btn\\\"\n            aria-label=\\\"Install Idling App\\\"\n          >\n            Install\n          </button>\n          <button\n            onClick={handleDismiss}\n            className=\\\"pwa-install-prompt__dismiss-btn\\\"\n            aria-label=\\\"Dismiss install prompt\\\"\n          >\n            \u00d7\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PWAInstallPrompt;\n",
    "language":"typescript",
    "lines":155,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/SubmissionItem.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { useSession } from 'next-auth/react';\nimport { useState } from 'react';\nimport { buildThreadUrl } from '../../../lib/routes';\nimport {\n  generateScrollKey,\n  storeScrollPosition\n} from '../../../lib/utils/scroll-position';\nimport { Author } from '../author/Author';\nimport { DeleteSubmissionForm } from '../submission-forms/delete-submission-form/DeleteSubmissionForm';\nimport { EditSubmissionForm } from '../submission-forms/edit-submission-form/EditSubmissionForm';\nimport { Submission } from '../submission-forms/schema';\nimport { TagLink } from '../tag-link/TagLink';\nimport { ReplyForm } from '../thread/ReplyForm';\nimport { ContentWithPills } from '../ui/ContentWithPills';\nimport { InstantLink } from '../ui/InstantLink';\nimport { RefreshButton } from '../ui/RefreshButton';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport { getSubmissionById, SubmissionWithReplies } from './actions';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'SubmissionItem',\n    module: 'components/submissions-list'\n  },\n  enabled: false\n});\n\ninterface SubmissionItemProps {\n  submission: SubmissionWithReplies;\n  onTagClick: (tag: string) => void;\n  onHashtagClick?: (hashtag: string) => void;\n  onMentionClick?: (mention: string, filterType: 'author' | 'mentions') => void;\n  isReply?: boolean;\n  depth?: number;\n  maxDepth?: number;\n  onSubmissionUpdate?: () => void;\n  contextId?: string;\n  // Optimistic update functions\n  optimisticUpdateSubmission?: (\n    submissionId: number,\n    updatedSubmission: Submission\n  ) => void;\n  optimisticRemoveSubmission?: (submissionId: number) => void;\n  // Scroll position context\n  currentPage?: number;\n  currentFilters?: Record<string, any>;\n  // Control parent link display\n  showParentLinkForFirstLevel?: boolean;\n  // Refresh functionality\n  onRefreshSubmission?: (\n    submissionId: number,\n    refreshedSubmission: SubmissionWithReplies\n  ) => void;\n  // Context for determining button positioning\n  isThreadPage?: boolean;\n}\n\nexport function SubmissionItem({\n  submission,\n  onTagClick,\n  onHashtagClick,\n  onMentionClick,\n  isReply = false,\n  depth = 0,\n  maxDepth = 3,\n  onSubmissionUpdate,\n  contextId,\n  optimisticUpdateSubmission,\n  optimisticRemoveSubmission,\n  currentPage,\n  currentFilters,\n  showParentLinkForFirstLevel = true,\n  onRefreshSubmission,\n  isThreadPage = false\n}: SubmissionItemProps) {\n  const { data: session } = useSession();\n\n  // Local state for this submission\n  const [isEditing, setIsEditing] = useState(false);\n  const [showReplyForm, setShowReplyForm] = useState(false);\n  const [showReplies, setShowReplies] = useState(false);\n  const [showNestedReplyForms, setShowNestedReplyForms] = useState<\n    Record<number, boolean>\n  >({});\n\n  const isCurrentUserPost = (authorUserId: number) => {\n    // Direct comparison of internal database user ID\n    const currentUserId = session?.user?.id;\n    if (!currentUserId) return false;\n\n    // Handle both string and number types for session.user.id\n    const userIdNumber =\n      typeof currentUserId === 'string'\n        ? parseInt(currentUserId)\n        : currentUserId;\n    return userIdNumber === authorUserId;\n  };\n\n  const handleTagClick = (tag: string) => {\n    onTagClick(tag);\n  };\n\n  const handleThreadNavigation = () => {\n    // Store current scroll position before navigating to thread\n    if (typeof window !== 'undefined') {\n      const scrollKey = generateScrollKey(window.location.pathname, {\n        page: currentPage,\n        filters: currentFilters,\n        searchParams: new URLSearchParams(window.location.search)\n      });\n\n      // Get scroll position from the submissions list container, not the window\n      const submissionsContainer = document.querySelector(\n        '.submissions-list--virtual'\n      ) as HTMLElement;\n\n      const scrollY = submissionsContainer\n        ? submissionsContainer.scrollTop\n        : window.scrollY;\n\n      logger.debug('Storing scroll position for thread navigation', {\n        scrollKey,\n        currentPage,\n        currentFilters,\n        scrollY,\n        containerFound: !!submissionsContainer,\n        pathname: window.location.pathname\n      });\n\n      storeScrollPosition(\n        scrollKey,\n        {\n          currentPage,\n          filters: currentFilters,\n          infiniteMode: false // You can adjust this based on your pagination mode\n        },\n        scrollY\n      );\n    }\n  };\n\n  const toggleReplyForm = () => {\n    setShowReplyForm(!showReplyForm);\n  };\n\n  const toggleReplies = () => {\n    setShowReplies(!showReplies);\n  };\n\n  const toggleEdit = () => {\n    setIsEditing(!isEditing);\n  };\n\n  const toggleNestedReplyForm = (replyId: number) => {\n    setShowNestedReplyForms((prev) => ({\n      ...prev,\n      [replyId]: !prev[replyId]\n    }));\n  };\n\n  const onReplySuccess = () => {\n    setShowReplyForm(false);\n    onSubmissionUpdate?.();\n  };\n\n  const onEditSuccess = (updatedSubmissionData?: Submission) => {\n    setIsEditing(false);\n    // Use optimistic update if available and we have the updated data\n    if (optimisticUpdateSubmission && updatedSubmissionData) {\n      optimisticUpdateSubmission(\n        submission.submission_id,\n        updatedSubmissionData\n      );\n    } else {\n      // Fallback to refresh mechanism\n      onSubmissionUpdate?.();\n    }\n  };\n\n  const onNestedReplySuccess = (replyId: number) => {\n    setShowNestedReplyForms((prev) => ({\n      ...prev,\n      [replyId]: false\n    }));\n    onSubmissionUpdate?.();\n  };\n\n  const onDeleteSuccess = () => {\n    // Use optimistic removal if available\n    if (optimisticRemoveSubmission) {\n      optimisticRemoveSubmission(submission.submission_id);\n    } else {\n      // Fallback to refresh mechanism\n      onSubmissionUpdate?.();\n    }\n  };\n\n  const handleRefresh = async () => {\n    try {\n      const result = await getSubmissionById(submission.submission_id);\n\n      if (result.data) {\n        // Collapse replies when refreshing\n        setShowReplies(false);\n        setShowReplyForm(false);\n        setShowNestedReplyForms({});\n\n        // Use optimistic update if available\n        if (onRefreshSubmission) {\n          onRefreshSubmission(submission.submission_id, result.data);\n        } else if (optimisticUpdateSubmission) {\n          // Convert SubmissionWithReplies to Submission type for optimistic update\n          const submissionData: Submission = {\n            submission_id: result.data.submission_id,\n            submission_title: result.data.submission_title,\n            submission_name: result.data.submission_name,\n            submission_datetime: result.data.submission_datetime || new Date(),\n            user_id: result.data.user_id,\n            author: result.data.author,\n            author_bio: result.data.author_bio,\n            tags: result.data.tags,\n            thread_parent_id: result.data.thread_parent_id\n          };\n          optimisticUpdateSubmission(submission.submission_id, submissionData);\n        } else {\n          // Fallback to refresh mechanism\n          onSubmissionUpdate?.();\n        }\n      } else {\n        console.error('Failed to refresh submission:', result.error);\n      }\n    } catch (error) {\n      console.error('Error refreshing submission:', error);\n    }\n  };\n\n  const renderTags = (tags: string[]) => {\n    if (!tags || tags.length === 0) return null;\n\n    return (\n      <div className=\\\"submission__tags\\\">\n        {tags.map((tag, index) => (\n          <TagLink\n            key={`${tag}-${index}`}\n            value={tag}\n            contextId={contextId || 'default'}\n            onTagClick={handleTagClick}\n          />\n        ))}\n      </div>\n    );\n  };\n\n  const canReply = session?.user?.id && depth < maxDepth;\n  const hasReplies = submission.replies && submission.replies.length > 0;\n  const hasOwnerActions = isCurrentUserPost(submission.user_id || 0);\n\n  // Check if this is a reply post (has a parent)\n  const isReplyPost = !!submission.thread_parent_id;\n\n  return (\n    <div\n      className={`submission__wrapper${\n        isReplyPost ? ' submission__wrapper--reply' : ''\n      } ${isReply ? 'submission__wrapper--reply-nested' : ''} ${\n        isReplyPost ? 'submission__wrapper--is-reply' : ''\n      }`}\n      style={{\n        marginLeft: isReply ? `${depth * 1.5}rem` : 0,\n        position: 'relative'\n      }}\n      data-testid={`submission-item-${submission.submission_id}`}\n    >\n      {isReplyPost && (\n        <span\n          className=\\\"reply-dot-indicator\\\"\n          title=\\\"Reply\\\"\n          aria-label=\\\"Reply\\\"\n          style={{\n            position: 'absolute',\n            top: '0.25rem',\n            left: '0.25rem',\n            zIndex: 2\n          }}\n        />\n      )}\n      <div\n        className={`submission__meta ${!hasOwnerActions ? 'submission__meta--no-actions' : ''}`}\n      >\n        <div className=\\\"submission__meta-left\\\">\n          <Author\n            authorId={submission.user_id?.toString() || ''}\n            authorName={submission.author}\n            showFullName={true}\n            bio={submission.author_bio}\n          />\n        </div>\n\n        <div className=\\\"submission__meta-center\\\">\n          <TimestampWithTooltip\n            date={submission.submission_datetime}\n            className=\\\"submission__datetime\\\"\n          />\n        </div>\n\n        {/* Edit/Delete buttons */}\n        <div className=\\\"submission__owner-actions\\\">\n          {hasOwnerActions && (\n            <>\n              <button\n                className=\\\"submission__edit-btn\\\"\n                onClick={toggleEdit}\n                title={`Edit ${isReply ? 'reply' : 'post'}`}\n              >\n                {isEditing ? 'Cancel' : 'Edit'}\n              </button>\n              <DeleteSubmissionForm\n                id={submission.submission_id}\n                name={submission.submission_name}\n                isAuthorized={true}\n                authorId={session?.user?.id?.toString()}\n                onDeleteSuccess={onDeleteSuccess}\n              />\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* Show edit form or regular content */}\n      {isEditing ? (\n        <div className=\\\"submission__edit-form\\\">\n          <EditSubmissionForm\n            submission={{\n              submission_id: submission.submission_id,\n              submission_title: submission.submission_title,\n              submission_name: submission.submission_name,\n              tags: submission.tags || []\n            }}\n            onSuccess={onEditSuccess}\n            onCancel={toggleEdit}\n          />\n        </div>\n      ) : (\n        <>\n          <div className=\\\"submission__content\\\">\n            {/* Title field label and content */}\n            <div className=\\\"submission__field\\\">\n              <span className=\\\"submission__field-label\\\">Title:</span>\n              <h3\n                className={`submission__title ${isReply ? 'submission__title--reply' : ''}`}\n              >\n                {hasReplies && !isReply ? (\n                  // eslint-disable-next-line custom-rules/enforce-link-target-blank\n                  <InstantLink\n                    href={buildThreadUrl(submission.submission_id)}\n                    className=\\\"submission__title-link\\\"\n                    title=\\\"View thread\\\"\n                    onClick={handleThreadNavigation}\n                  >\n                    <ContentWithPills\n                      content={submission.submission_title}\n                      onHashtagClick={onHashtagClick}\n                      onMentionClick={onMentionClick}\n                      contextId={contextId || 'submission-item'}\n                    />\n                  </InstantLink>\n                ) : (\n                  <ContentWithPills\n                    content={submission.submission_title}\n                    onHashtagClick={onHashtagClick}\n                    onMentionClick={onMentionClick}\n                    contextId={contextId || 'submission-item'}\n                  />\n                )}\n              </h3>\n            </div>\n\n            {/* Content field label and content (only if different from title) */}\n            {submission.submission_name &&\n              submission.submission_name !== submission.submission_title && (\n                <div className=\\\"submission__field\\\">\n                  <span className=\\\"submission__field-label\\\">Content:</span>\n                  <div className=\\\"submission__description\\\">\n                    <ContentWithPills\n                      content={submission.submission_name}\n                      onHashtagClick={onHashtagClick}\n                      onMentionClick={onMentionClick}\n                      contextId={contextId || 'submission-item'}\n                    />\n                  </div>\n                </div>\n              )}\n          </div>\n\n          {/* Tags field label and content (only if tags exist) */}\n          {submission.tags && submission.tags.length > 0 && (\n            <div className=\\\"submission__field\\\">\n              <span className=\\\"submission__field-label\\\">Tags:</span>\n              {renderTags(submission.tags)}\n            </div>\n          )}\n        </>\n      )}\n\n      {/* Action buttons */}\n      <div className=\\\"submission__actions\\\">\n        <div className=\\\"submission__actions-left\\\">\n          {canReply && (\n            <button className=\\\"submission__reply-btn\\\" onClick={toggleReplyForm}>\n              {showReplyForm ? 'Cancel' : 'Reply'}\n            </button>\n          )}\n\n          {hasReplies && (\n            <button className=\\\"submission__expand-btn\\\" onClick={toggleReplies}>\n              {showReplies\n                ? `Hide ${submission.replies!.length} Replies`\n                : `Show ${submission.replies!.length} Replies`}\n            </button>\n          )}\n        </div>\n\n        <div className=\\\"submission__actions-right\\\">\n          {/* Refresh button */}\n          <RefreshButton\n            onRefresh={handleRefresh}\n            className=\\\"submission__refresh-btn\\\"\n            title=\\\"Refresh post and collapse replies\\\"\n          />\n\n          {/* View Parent button for replies */}\n          {isReplyPost && submission.thread_parent_id && (\n            <InstantLink\n              href={buildThreadUrl(submission.thread_parent_id)}\n              className=\\\"submission__parent-link submission__text-link\\\"\n              title=\\\"View parent post\\\"\n            >\n              View Parent\n            </InstantLink>\n          )}\n\n          {/* View Thread link for posts with replies */}\n          {hasReplies && !isReply && (\n            // eslint-disable-next-line custom-rules/enforce-link-target-blank\n            <InstantLink\n              href={buildThreadUrl(submission.submission_id)}\n              className=\\\"submission__thread-link submission__text-link\\\"\n              title=\\\"View full thread\\\"\n              onClick={handleThreadNavigation}\n            >\n              View Thread\n            </InstantLink>\n          )}\n        </div>\n      </div>\n\n      {/* Reply form */}\n      {showReplyForm && (\n        <div className=\\\"submission__reply-form\\\">\n          <ReplyForm\n            parentId={submission.submission_id}\n            onSuccess={onReplySuccess}\n            replyToAuthor={submission.author}\n          />\n        </div>\n      )}\n\n      {/* Nested replies */}\n      {showReplies && hasReplies && (\n        <div className=\\\"submission__replies\\\">\n          {submission.replies!.map((reply) => (\n            <div key={reply.submission_id}>\n              <SubmissionItem\n                submission={reply}\n                onTagClick={onTagClick}\n                onHashtagClick={onHashtagClick}\n                onMentionClick={onMentionClick}\n                isReply={true}\n                depth={depth + 1}\n                maxDepth={maxDepth}\n                onSubmissionUpdate={onSubmissionUpdate}\n                contextId={contextId || 'submission-item'}\n                showParentLinkForFirstLevel={false}\n              />\n\n              {/* Nested reply form for this specific reply */}\n              {showNestedReplyForms[reply.submission_id] && (\n                <div\n                  className=\\\"submission__nested-reply-form\\\"\n                  style={{ marginLeft: `${(depth + 1) * 1.5}rem` }}\n                >\n                  <ReplyForm\n                    parentId={reply.submission_id}\n                    onSuccess={() => onNestedReplySuccess(reply.submission_id)}\n                    replyToAuthor={reply.author}\n                  />\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":510,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/StickyPostsControls.tsx":{
    "content":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useCallback, useEffect, useState } from 'react';\nimport { InstantLink } from '../ui/InstantLink';\nimport './StickyPostsControls.css';\n\ninterface StickyPostsControlsProps {\n  // Filter state\n  showFilters: boolean;\n  onToggleFilters: () => void;\n  filtersCount: number;\n\n  // Pagination state\n  infiniteScrollMode: boolean;\n  onTogglePaginationMode: (mode: boolean) => void;\n\n  // Results info\n  totalRecords: number;\n  isLoading: boolean;\n  hasFilters: boolean;\n\n  // New post functionality\n  onNewPostClick?: () => void;\n\n  // Container monitoring\n  containerSelector?: string;\n}\n\nexport function StickyPostsControls({\n  showFilters,\n  onToggleFilters,\n  filtersCount,\n  infiniteScrollMode,\n  onTogglePaginationMode,\n  totalRecords,\n  isLoading,\n  hasFilters,\n  onNewPostClick,\n  containerSelector = '.posts-manager__top-controls'\n}: StickyPostsControlsProps) {\n  const { data: session } = useSession();\n  const [position, setPosition] = useState<'top' | 'bottom'>('top');\n  const [isVisible, setIsVisible] = useState(false);\n\n  const isAuthorized = Boolean(session?.user?.id);\n\n  const updatePosition = useCallback(() => {\n    const container = document.querySelector(containerSelector);\n    if (!container) return;\n\n    const containerRect = container.getBoundingClientRect();\n    const viewportHeight = window.innerHeight;\n\n    // Show sticky controls when original controls are not visible in viewport\n    const isContainerOffScreen =\n      containerRect.bottom < 0 || containerRect.top > viewportHeight;\n\n    setIsVisible(isContainerOffScreen);\n\n    // Always position at top when controls are out of view\n    setPosition('top');\n  }, [containerSelector]);\n\n  useEffect(() => {\n    // Initial check\n    updatePosition();\n\n    // Add scroll listener\n    const handleScroll = () => {\n      requestAnimationFrame(updatePosition);\n    };\n\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    window.addEventListener('resize', handleScroll, { passive: true });\n\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n      window.removeEventListener('resize', handleScroll);\n    };\n  }, [updatePosition]);\n\n  if (!isVisible) {\n    return null;\n  }\n\n  return (\n    <div\n      className={`sticky-posts-controls sticky-posts-controls--${position}`}\n      data-position={position}\n    >\n      <div className=\\\"sticky-posts-controls__content\\\">\n        {/* Essential controls only - minimal design */}\n\n        {/* Filter toggle with count */}\n        <button\n          className={`sticky-posts-controls__filter-toggle ${\n            showFilters ? 'sticky-posts-controls__filter-toggle--active' : ''\n          } ${\n            filtersCount > 0\n              ? 'sticky-posts-controls__filter-toggle--has-filters'\n              : ''\n          }`}\n          onClick={onToggleFilters}\n          aria-expanded={showFilters}\n          title={showFilters ? 'Hide filters' : 'Show filters'}\n        >\n          <svg\n            width=\\\"14\\\"\n            height=\\\"14\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          >\n            <polygon points=\\\"22,3 2,3 10,12.46 10,19 14,21 14,12.46\\\" />\n          </svg>\n          {filtersCount > 0 && (\n            <span className=\\\"sticky-posts-controls__filter-count\\\">\n              {filtersCount}\n            </span>\n          )}\n        </button>\n\n        {/* Results count - compact version */}\n        {!isLoading && (\n          <div className=\\\"sticky-posts-controls__results\\\">\n            <span className=\\\"sticky-posts-controls__results-text\\\">\n              {totalRecords === 0\n                ? 'No results'\n                : `${totalRecords.toLocaleString()}`}\n              {hasFilters && (\n                <span className=\\\"sticky-posts-controls__filtered\\\">\n                  {' '}\n                  (filtered)\n                </span>\n              )}\n            </span>\n          </div>\n        )}\n\n        {/* Pagination mode toggle - minimal */}\n        <div className=\\\"sticky-posts-controls__pagination\\\">\n          <button\n            className={`sticky-posts-controls__pagination-button ${\n              !infiniteScrollMode ? 'active' : ''\n            }`}\n            onClick={() => onTogglePaginationMode(false)}\n            aria-pressed={!infiniteScrollMode}\n            title=\\\"Traditional pagination\\\"\n          >\n            T\n          </button>\n          <button\n            className={`sticky-posts-controls__pagination-button ${\n              infiniteScrollMode ? 'active' : ''\n            }`}\n            onClick={() => onTogglePaginationMode(true)}\n            aria-pressed={infiniteScrollMode}\n            title=\\\"Infinite scroll\\\"\n          >\n            \u221e\n          </button>\n        </div>\n\n        {/* New post button - icon only */}\n        {onNewPostClick && (\n          <InstantLink\n            href=\\\"#\\\"\n            onClick={(e) => {\n              e.preventDefault();\n              onNewPostClick();\n            }}\n            className=\\\"sticky-posts-controls__new-post instant-link--button\\\"\n            aria-disabled={!isAuthorized}\n            title={isAuthorized ? 'Create a new post' : 'Login to create posts'}\n          >\n            <svg\n              width=\\\"16\\\"\n              height=\\\"16\\\"\n              viewBox=\\\"0 0 24 24\\\"\n              fill=\\\"none\\\"\n              stroke=\\\"currentColor\\\"\n              strokeWidth=\\\"2\\\"\n              strokeLinecap=\\\"round\\\"\n              strokeLinejoin=\\\"round\\\"\n            >\n              <line x1=\\\"12\\\" y1=\\\"5\\\" x2=\\\"12\\\" y2=\\\"19\\\" />\n              <line x1=\\\"5\\\" y1=\\\"12\\\" x2=\\\"19\\\" y2=\\\"12\\\" />\n            </svg>\n          </InstantLink>\n        )}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":199,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/SubmissionsList.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { Provider } from 'jotai';\nimport SubmissionsList from './SubmissionsList';\n\n// Mock Next.js router\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    prefetch: jest.fn()\n  }),\n  useSearchParams: () => new URLSearchParams(),\n  usePathname: () => '/test'\n}));\n\n// Mock next-auth completely\njest.mock('next-auth/react', () => ({\n  useSession: jest.fn(() => ({\n    data: { user: { id: 'test-user' } },\n    status: 'authenticated'\n  }))\n}));\n\njest.mock('next-auth', () => ({\n  default: jest.fn(),\n  NextAuth: jest.fn(),\n  getServerSession: jest.fn()\n}));\n\n// Mock the auth module\njest.mock('../../../lib/auth', () => ({\n  auth: jest.fn().mockResolvedValue({\n    user: { id: 'test-user' }\n  })\n}));\n\n// Mock jotai useAtom for this component\njest.mock('jotai', () => ({\n  ...jest.requireActual('jotai'),\n  useAtom: jest.fn().mockReturnValue([\n    [], // displayFilters\n    jest.fn() // setDisplayFilters\n  ])\n}));\n\n// Mock the SubmissionItem component\njest.mock('./SubmissionItem', () => ({\n  SubmissionItem: ({ submission, onTagClick }: any) => (\n    <div data-testid=\\\"submission-item\\\">\n      <h3>{submission.submission_title}</h3>\n      <p>{submission.author}</p>\n      <div>\n        {submission.tags?.map((tag: string) => (\n          <span key={tag} onClick={() => onTagClick(tag)}>\n            {tag}\n          </span>\n        ))}\n      </div>\n    </div>\n  )\n}));\n\ndescribe('SubmissionsList', () => {\n  const mockOnTagClick = jest.fn();\n  const mockOnHashtagClick = jest.fn();\n  const mockOnMentionClick = jest.fn();\n  const mockOnRefresh = jest.fn();\n\n  const defaultProps = {\n    posts: [],\n    onTagClick: mockOnTagClick,\n    onHashtagClick: mockOnHashtagClick,\n    onMentionClick: mockOnMentionClick,\n    onRefresh: mockOnRefresh,\n    contextId: 'test-context'\n  };\n\n  const sampleSubmission = {\n    submission_id: 1,\n    submission_name: 'Test Submission',\n    submission_title: 'Test Title',\n    submission_datetime: new Date('2024-01-01T12:00:00Z'),\n    author_id: 'test-user',\n    author: 'Test User',\n    thread_parent_id: null,\n    tags: ['test', 'javascript']\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders submissions list correctly', () => {\n    render(\n      <Provider>\n        <SubmissionsList {...defaultProps} />\n      </Provider>\n    );\n\n    // The component should render without errors\n    expect(screen.getByTestId('submissions-list')).toBeInTheDocument();\n  });\n\n  it('handles onlyMine prop correctly', () => {\n    // This component doesn't have onlyMine prop directly, but we can test empty state\n    render(\n      <Provider>\n        <SubmissionsList {...defaultProps} />\n      </Provider>\n    );\n\n    expect(screen.getByTestId('submissions-list')).toBeInTheDocument();\n  });\n\n  it('renders with initial submissions', () => {\n    const propsWithSubmissions = {\n      ...defaultProps,\n      posts: [sampleSubmission]\n    };\n\n    render(\n      <Provider>\n        <SubmissionsList {...propsWithSubmissions} />\n      </Provider>\n    );\n\n    expect(screen.getByText('Test Title')).toBeInTheDocument();\n    expect(screen.getByText('Test User')).toBeInTheDocument();\n    expect(screen.getByText('test')).toBeInTheDocument();\n    expect(screen.getByText('javascript')).toBeInTheDocument();\n  });\n\n  it('renders empty state when no submissions', () => {\n    render(\n      <Provider>\n        <SubmissionsList {...defaultProps} />\n      </Provider>\n    );\n\n    expect(screen.getByTestId('submissions-list')).toBeInTheDocument();\n    expect(screen.queryByTestId('submission-item')).not.toBeInTheDocument();\n  });\n\n  it('shows loading state', () => {\n    const loadingProps = {\n      ...defaultProps,\n      showSkeletons: true\n    };\n\n    render(\n      <Provider>\n        <SubmissionsList {...loadingProps} />\n      </Provider>\n    );\n\n    // Should show skeleton loading state\n    expect(screen.getByTestId('submissions-list')).toBeInTheDocument();\n    expect(screen.getAllByTestId('submissions-list__skeleton')).toHaveLength(5);\n  });\n\n  it('shows error state', () => {\n    // This component doesn't handle error state directly\n    // Error handling would be done by parent component\n    render(\n      <Provider>\n        <SubmissionsList {...defaultProps} />\n      </Provider>\n    );\n\n    expect(screen.getByTestId('submissions-list')).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":173,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/SubmissionsList.tsx":{
    "content":"'use client';\n\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState\n} from 'react';\nimport InfiniteScrollTrigger from '../infinite-scroll-trigger/InfiniteScrollTrigger';\nimport { SubmissionItem } from './SubmissionItem';\nimport './SubmissionItem.css';\nimport './SubmissionsList.css';\n\n// Virtual scrolling constants\nconst BATCH_SIZE = 20; // Number of items to render in each batch\nconst BUFFER_SIZE = 1; // Number of batches to render outside visible area\nconst ESTIMATED_ITEM_HEIGHT = 150; // Fallback height estimate\nconst HEIGHT_CACHE_SIZE = 100; // Maximum items to cache heights for\n\nexport interface SubmissionsListProps {\n  posts: any[];\n  onTagClick: (tag: string) => void;\n  onHashtagClick?: (hashtag: string) => void;\n  onMentionClick?: (mention: string, filterType: 'author' | 'mentions') => void;\n  showSkeletons?: boolean;\n  onRefresh?: () => void;\n  contextId: string;\n  // Infinite scroll props\n  infiniteScrollMode?: boolean;\n  hasMore?: boolean;\n  isLoadingMore?: boolean;\n  onLoadMore?: () => void;\n  // Optimistic update functions\n  optimisticUpdateSubmission?: (\n    submissionId: number,\n    updatedSubmission: any\n  ) => void;\n  optimisticRemoveSubmission?: (submissionId: number) => void;\n  // Refresh functionality\n  onRefreshSubmission?: (\n    submissionId: number,\n    refreshedSubmission: any\n  ) => void;\n  // Scroll position context\n  currentPage?: number;\n  currentFilters?: Record<string, any>;\n  // Custom renderer\n  children?: (props: {\n    submission: any;\n    onTagClick: (tag: string) => void;\n    onHashtagClick?: (hashtag: string) => void;\n    onMentionClick?: (\n      mention: string,\n      filterType: 'author' | 'mentions'\n    ) => void;\n    onSubmissionUpdate?: () => void;\n    contextId: string;\n    // Add optimistic update functions to custom renderer\n    optimisticUpdateSubmission?: (\n      submissionId: number,\n      updatedSubmission: any\n    ) => void;\n    optimisticRemoveSubmission?: (submissionId: number) => void;\n    // Refresh functionality\n    onRefreshSubmission?: (\n      submissionId: number,\n      refreshedSubmission: any\n    ) => void;\n    // Scroll position context\n    currentPage?: number;\n    currentFilters?: Record<string, any>;\n  }) => React.ReactNode;\n  error?: string;\n}\n\nconst SubmissionsList = React.memo(function SubmissionsList({\n  posts,\n  onTagClick,\n  onHashtagClick,\n  onMentionClick,\n  showSkeletons,\n  onRefresh,\n  contextId,\n  infiniteScrollMode = false,\n  hasMore = false,\n  isLoadingMore = false,\n  onLoadMore,\n  optimisticUpdateSubmission,\n  optimisticRemoveSubmission,\n  onRefreshSubmission,\n  currentPage,\n  currentFilters,\n  children,\n  error\n}: SubmissionsListProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const itemRefs = useRef<Map<number, HTMLDivElement>>(new Map());\n  const heightCache = useRef<Map<number, number>>(new Map());\n  const [scrollTop, setScrollTop] = useState(0);\n  const [visibleRange, setVisibleRange] = useState({\n    start: 0,\n    end: BATCH_SIZE\n  });\n  const visibleRangeRef = useRef(visibleRange);\n  const isScrolling = useRef(false);\n  const scrollTimeout = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const resizeObserver = useRef<ResizeObserver | null>(null);\n\n  // Update ref when visible range changes\n  useEffect(() => {\n    visibleRangeRef.current = visibleRange;\n  }, [visibleRange]);\n\n  // Get cached height or estimate\n  const getItemHeight = useCallback((index: number): number => {\n    const cached = heightCache.current.get(index);\n    if (cached) return cached;\n\n    // Use average of cached heights if available, otherwise use estimate\n    const cachedHeights = Array.from(heightCache.current.values());\n    if (cachedHeights.length > 0) {\n      const average =\n        cachedHeights.reduce((sum, h) => sum + h, 0) / cachedHeights.length;\n      return Math.round(average);\n    }\n\n    return ESTIMATED_ITEM_HEIGHT;\n  }, []);\n\n  // Calculate cumulative heights for positioning\n  const getCumulativeHeight = useCallback(\n    (index: number): number => {\n      let height = 0;\n      for (let i = 0; i < index; i++) {\n        height += getItemHeight(i);\n      }\n      return height;\n    },\n    [getItemHeight]\n  );\n\n  // Calculate visible range based on scroll position\n  const calculateVisibleRange = useCallback(\n    (scrollTop: number, containerHeight: number) => {\n      if (posts.length === 0) return { start: 0, end: 0 };\n\n      // Find start index using binary search for efficiency\n      let startIndex = 0;\n      let endIndex = posts.length - 1;\n\n      while (startIndex < endIndex) {\n        const mid = Math.floor((startIndex + endIndex) / 2);\n        const midTop = getCumulativeHeight(mid);\n\n        if (midTop < scrollTop) {\n          startIndex = mid + 1;\n        } else {\n          endIndex = mid;\n        }\n      }\n\n      // Find end index\n      let currentHeight = getCumulativeHeight(startIndex);\n      let visibleEndIndex = startIndex;\n\n      while (\n        visibleEndIndex < posts.length &&\n        currentHeight < scrollTop + containerHeight\n      ) {\n        currentHeight += getItemHeight(visibleEndIndex);\n        visibleEndIndex++;\n      }\n\n      // Add buffer\n      const bufferStart = Math.max(0, startIndex - BUFFER_SIZE * BATCH_SIZE);\n      const bufferEnd = Math.min(\n        posts.length,\n        visibleEndIndex + BUFFER_SIZE * BATCH_SIZE\n      );\n\n      // Ensure we render in batches\n      const startBatch = Math.floor(bufferStart / BATCH_SIZE);\n      const endBatch = Math.ceil(bufferEnd / BATCH_SIZE);\n\n      return {\n        start: startBatch * BATCH_SIZE,\n        end: Math.min(posts.length, endBatch * BATCH_SIZE)\n      };\n    },\n    [posts.length, getCumulativeHeight, getItemHeight]\n  );\n\n  // Handle scroll events with throttling\n  const handleScroll = useCallback(\n    (e: React.UIEvent<HTMLDivElement>) => {\n      const scrollTop = e.currentTarget.scrollTop;\n      const containerHeight = e.currentTarget.clientHeight;\n\n      setScrollTop(scrollTop);\n\n      if (!isScrolling.current) {\n        isScrolling.current = true;\n      }\n\n      // Clear existing timeout\n      if (scrollTimeout.current) {\n        clearTimeout(scrollTimeout.current);\n      }\n\n      // Throttle scroll updates\n      scrollTimeout.current = setTimeout(() => {\n        const newRange = calculateVisibleRange(scrollTop, containerHeight);\n        const currentRange = visibleRangeRef.current;\n\n        if (\n          newRange.start !== currentRange.start ||\n          newRange.end !== currentRange.end\n        ) {\n          setVisibleRange(newRange);\n        }\n\n        isScrolling.current = false;\n      }, 100);\n    },\n    [calculateVisibleRange]\n  );\n\n  // Set up ResizeObserver to track actual item heights\n  useEffect(() => {\n    if (!window.ResizeObserver) return;\n\n    resizeObserver.current = new ResizeObserver((entries) => {\n      let heightsChanged = false;\n\n      entries.forEach((entry) => {\n        const element = entry.target as HTMLDivElement;\n        const index = parseInt(element.dataset.itemIndex || '-1');\n\n        if (index >= 0) {\n          const newHeight = Math.round(entry.contentRect.height);\n          const oldHeight = heightCache.current.get(index);\n\n          if (oldHeight !== newHeight) {\n            heightCache.current.set(index, newHeight);\n            heightsChanged = true;\n\n            // Limit cache size\n            if (heightCache.current.size > HEIGHT_CACHE_SIZE) {\n              const oldestKey = heightCache.current.keys().next().value;\n              if (oldestKey !== undefined) {\n                heightCache.current.delete(oldestKey);\n              }\n            }\n          }\n        }\n      });\n\n      // Recalculate visible range if heights changed\n      if (heightsChanged && containerRef.current) {\n        const containerHeight = containerRef.current.clientHeight;\n        const newRange = calculateVisibleRange(scrollTop, containerHeight);\n        setVisibleRange(newRange);\n      }\n    });\n\n    // Observe all currently rendered items\n    itemRefs.current.forEach((element) => {\n      resizeObserver.current?.observe(element);\n    });\n\n    return () => {\n      resizeObserver.current?.disconnect();\n    };\n  }, [calculateVisibleRange, scrollTop]);\n\n  // Initialize visible range when posts change\n  useEffect(() => {\n    if (containerRef.current) {\n      const containerHeight = containerRef.current.clientHeight;\n      const newRange = calculateVisibleRange(scrollTop, containerHeight);\n      setVisibleRange(newRange);\n    }\n  }, [posts.length, calculateVisibleRange]);\n\n  // Force recalculation when container becomes available\n  useEffect(() => {\n    if (containerRef.current && posts.length > 0) {\n      const containerHeight = containerRef.current.clientHeight;\n      if (containerHeight > 0) {\n        const newRange = calculateVisibleRange(0, containerHeight);\n        setVisibleRange(newRange);\n      }\n    }\n  }, [posts.length, calculateVisibleRange]);\n\n  // Get visible posts to render\n  const visiblePosts = useMemo(() => {\n    return posts.slice(visibleRange.start, visibleRange.end);\n  }, [posts, visibleRange.start, visibleRange.end]);\n\n  // Calculate spacing for virtual scrolling\n  const topSpacer = getCumulativeHeight(visibleRange.start);\n  const bottomSpacer =\n    getCumulativeHeight(posts.length) - getCumulativeHeight(visibleRange.end);\n\n  // Track item refs for ResizeObserver\n  const setItemRef = useCallback(\n    (index: number, element: HTMLDivElement | null) => {\n      if (element) {\n        itemRefs.current.set(index, element);\n        element.dataset.itemIndex = index.toString();\n        resizeObserver.current?.observe(element);\n      } else {\n        const oldElement = itemRefs.current.get(index);\n        if (oldElement) {\n          resizeObserver.current?.unobserve(oldElement);\n          itemRefs.current.delete(index);\n        }\n      }\n    },\n    []\n  );\n\n  // Handle error state\n  if (error) {\n    return (\n      <div\n        className=\\\"submissions-list submissions-list--error\\\"\n        data-testid=\\\"submissions-list\\\"\n      >\n        <div className=\\\"submissions-list__error-message\\\">\n          <p>Error loading posts: {error}</p>\n          <button\n            onClick={onRefresh}\n            className=\\\"submissions-list__retry-button\\\"\n          >\n            Try Again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Skeleton loading - only show if explicitly requested (for backwards compatibility)\n  // The new IntelligentSkeletonWrapper handles most skeleton loading\n  if (showSkeletons) {\n    return (\n      <div className=\\\"submissions-list\\\" data-testid=\\\"submissions-list\\\">\n        {Array.from({ length: Math.min(BATCH_SIZE, 5) }, (_, index) => (\n          <div\n            key={index}\n            className=\\\"submissions-list__skeleton\\\"\n            data-testid=\\\"submissions-list__skeleton\\\"\n          >\n            <div className=\\\"submission__wrapper\\\">\n              <div className=\\\"submission__meta\\\">\n                <div className=\\\"skeleton-line skeleton-line--short\\\"></div>\n                <div className=\\\"skeleton-line skeleton-line--xs\\\"></div>\n              </div>\n              <div className=\\\"submission__content\\\">\n                <div className=\\\"skeleton-line skeleton-line--title\\\"></div>\n                <div className=\\\"skeleton-line skeleton-line--description\\\"></div>\n              </div>\n              <div className=\\\"submission__tags\\\">\n                <div className=\\\"skeleton-tag\\\"></div>\n                <div className=\\\"skeleton-tag\\\"></div>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Empty state\n  if (posts.length === 0) {\n    return (\n      <div\n        className=\\\"submissions-list submissions-list--empty\\\"\n        data-testid=\\\"submissions-list\\\"\n      >\n        <div className=\\\"submissions-list__empty-message\\\">\n          No posts to display\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className=\\\"submissions-list submissions-list--simple\\\"\n      data-testid=\\\"submissions-list\\\"\n      style={{\n        maxHeight: '70vh',\n        overflowY: 'auto',\n        position: 'relative'\n      }}\n    >\n      {/* Render ALL posts directly (no virtual scrolling) */}\n      <div className=\\\"submissions-list__content\\\">\n        {posts.map((post, index) => (\n          <div key={post.submission_id} className=\\\"submissions-list__item\\\">\n            {children ? (\n              children({\n                submission: post,\n                onTagClick,\n                onHashtagClick,\n                onMentionClick,\n                onSubmissionUpdate: onRefresh,\n                contextId,\n                optimisticUpdateSubmission,\n                optimisticRemoveSubmission,\n                onRefreshSubmission,\n                currentPage,\n                currentFilters\n              })\n            ) : (\n              <SubmissionItem\n                submission={post}\n                onTagClick={onTagClick}\n                onHashtagClick={onHashtagClick}\n                onMentionClick={onMentionClick}\n                onSubmissionUpdate={onRefresh}\n                contextId={contextId}\n                optimisticUpdateSubmission={optimisticUpdateSubmission}\n                optimisticRemoveSubmission={optimisticRemoveSubmission}\n                onRefreshSubmission={onRefreshSubmission}\n                currentPage={currentPage}\n                currentFilters={currentFilters}\n              />\n            )}\n          </div>\n        ))}\n\n        {/* Infinite scroll trigger - only show when in infinite mode */}\n        {infiniteScrollMode && hasMore && onLoadMore && (\n          <div className=\\\"submissions-list__infinite-trigger\\\">\n            <InfiniteScrollTrigger\n              onLoadMore={onLoadMore}\n              isLoading={isLoadingMore}\n              className=\\\"submissions-list__trigger\\\"\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n});\n\nexport default SubmissionsList;\n",
    "language":"typescript",
    "lines":453,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/SubmissionThread.tsx":{
    "content":"'use client';\n\nimport { ReplyForm } from '../thread/ReplyForm';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport { SubmissionWithReplies } from './actions';\nimport './SubmissionThread.css';\n\ninterface SubmissionThreadProps {\n  submission: SubmissionWithReplies;\n  isAuthorized: boolean;\n  activeReplies: { [key: number]: boolean };\n  setActiveReplies: (replies: { [key: number]: boolean }) => void;\n  expandedThreads: { [key: number]: boolean };\n  setExpandedThreads: (threads: { [key: number]: boolean }) => void;\n  onTagClick: (tag: string) => void;\n}\n\nexport function SubmissionThread({\n  submission,\n  isAuthorized,\n  activeReplies,\n  setActiveReplies,\n  expandedThreads,\n  setExpandedThreads,\n  onTagClick\n}: SubmissionThreadProps) {\n  const toggleReply = () => {\n    setActiveReplies({\n      ...activeReplies,\n      [submission.submission_id]: !activeReplies[submission.submission_id]\n    });\n  };\n\n  const toggleExpand = () => {\n    setExpandedThreads({\n      ...expandedThreads,\n      [submission.submission_id]: !expandedThreads[submission.submission_id]\n    });\n  };\n\n  return (\n    <div className=\\\"submission-thread\\\">\n      <div className=\\\"submission-thread__header\\\">\n        <div className=\\\"submission-thread__content\\\">\n          <h3 className=\\\"submission-thread__title\\\">\n            {submission.submission_name}\n          </h3>\n          <p className=\\\"submission-thread__datetime\\\">\n            <TimestampWithTooltip date={submission.submission_datetime} />\n          </p>\n          {submission.tags && submission.tags.length > 0 && (\n            <div className=\\\"submission-thread__tags\\\">\n              {submission.tags.map((tag) => (\n                <span\n                  key={tag}\n                  className=\\\"submission-thread__tag\\\"\n                  onClick={() => onTagClick(tag)}\n                >\n                  {tag}\n                </span>\n              ))}\n            </div>\n          )}\n        </div>\n        <div className=\\\"submission-thread__actions\\\">\n          {isAuthorized && (\n            <button\n              onClick={toggleReply}\n              className=\\\"submission-thread__reply-button\\\"\n            >\n              {activeReplies[submission.submission_id] ? 'Cancel' : 'Reply'}\n            </button>\n          )}\n          {submission.replies && submission.replies.length > 0 && (\n            <button\n              onClick={toggleExpand}\n              className=\\\"submission-thread__expand-button\\\"\n            >\n              {expandedThreads[submission.submission_id]\n                ? 'Collapse'\n                : 'Expand'}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {activeReplies[submission.submission_id] && (\n        <div className=\\\"submission-thread__reply-form\\\">\n          <ReplyForm\n            parentId={submission.submission_id}\n            replyToAuthor={submission.author}\n            onSuccess={() => {\n              // Close the reply form\n              setActiveReplies({\n                ...activeReplies,\n                [submission.submission_id]: false\n              });\n              // Expand the thread to show the new reply\n              setExpandedThreads({\n                ...expandedThreads,\n                [submission.submission_id]: true\n              });\n            }}\n          />\n        </div>\n      )}\n\n      {expandedThreads[submission.submission_id] &&\n        submission.replies &&\n        submission.replies.length > 0 && (\n          <div className=\\\"submission-thread__replies\\\">\n            {submission.replies.map((reply) => (\n              <SubmissionThread\n                key={reply.submission_id}\n                submission={reply}\n                isAuthorized={isAuthorized}\n                activeReplies={activeReplies}\n                setActiveReplies={setActiveReplies}\n                expandedThreads={expandedThreads}\n                setExpandedThreads={setExpandedThreads}\n                onTagClick={onTagClick}\n              />\n            ))}\n          </div>\n        )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":129,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/PostsManager.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { useSession } from 'next-auth/react';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { useSubmissionsManager } from '../../../lib/state/useSubmissionsManager';\nimport '../../../lib/utils/scroll-highlight-demo'; // Import for global test function\nimport { Submission } from '../submission-forms/schema';\nimport { SubmissionWithReplies } from './actions';\n\nimport { Filter } from '@/lib/state/atoms';\nimport { PostFilters } from '@/lib/types/filters';\nimport { usePaginationPreRequest } from '../../hooks/usePaginationPreRequest';\nimport { SimpleSkeletonWrapper } from '../skeleton/SimpleSkeletonWrapper';\nimport { PostsManagerControls } from './components/PostsManagerControls';\nimport { PostsManagerFilters } from './components/PostsManagerFilters';\nimport { PostsManagerPagination } from './components/PostsManagerPagination';\nimport { usePostsManagerHandlers } from './hooks/usePostsManagerHandlers';\nimport { usePostsManagerState } from './hooks/usePostsManagerState';\nimport { useScrollRestoration } from './hooks/useScrollRestoration';\nimport './PostsManager.css';\nimport { StickyPostsControls } from './StickyPostsControls';\nimport SubmissionsList from './SubmissionsList';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'PostsManager',\n    module: 'components/submissions-list'\n  },\n  enabled: false // Disabled to reduce log noise\n});\n\ninterface PostsManagerProps {\n  contextId: string;\n  onlyMine?: boolean;\n  enableThreadMode?: boolean;\n  onNewPostClick?: () => void;\n  // Custom renderer for submissions\n  renderSubmissionItem?: (props: {\n    submission: SubmissionWithReplies;\n    onTagClick: (_tag: string) => void;\n    onHashtagClick?: (_hashtag: string) => void;\n    onMentionClick?: (\n      _mention: string,\n      _filterType: 'author' | 'mentions'\n    ) => void;\n    onSubmissionUpdate?: () => void;\n    contextId: string;\n    optimisticUpdateSubmission?: (\n      _submissionId: number,\n      _updatedSubmission: Submission\n    ) => void;\n    optimisticRemoveSubmission?: (_submissionId: number) => void;\n    currentPage?: number;\n    currentFilters?: Record<string, any>;\n  }) => React.ReactNode;\n}\n\n/**\n * PostsManager - Single source of truth for submissions state\n * Manages state with useSubmissionsManager and passes data to child components\n * This eliminates duplicate API calls from multiple useSubmissionsManager instances\n */\nconst PostsManager = React.memo(function PostsManager({\n  contextId,\n  onlyMine = false,\n  enableThreadMode = false,\n  onNewPostClick,\n  renderSubmissionItem\n}: PostsManagerProps) {\n  const { data: session } = useSession();\n\n  // Simple render counter for debugging\n  const renderCount = useRef(0);\n  renderCount.current += 1;\n\n  // Only log in development and when there's a potential issue\n  if (process.env.NODE_ENV === 'development' && renderCount.current > 2) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      `PostsManager rendered ${renderCount.current} times for contextId: ${contextId}`\n    );\n  }\n\n  // Track filter operations for debugging\n  const filterOpCount = useRef(0);\n  const lastFilterOp = useRef('');\n\n  // Use custom hooks for state management\n  const {\n    spacingTheme,\n    includeThreadReplies,\n    setIncludeThreadReplies,\n    isMobile,\n    infiniteScrollMode,\n    setInfiniteScrollMode,\n    showFilters,\n    setShowFilters\n  } = usePostsManagerState();\n\n  // Default behavior: show posts only (no replies) for both pages\n  // Replies are only included when:\n  // 1. includeThreadReplies toggle is enabled, OR\n  // 2. onlyReplies filter is active\n  const shouldIncludeReplies = includeThreadReplies;\n  const showRepliesFilter = true; // Always show the combined filter\n\n  // Memoize the submissions manager call\n  const {\n    submissions,\n    pagination,\n    filters,\n    isLoading,\n    error,\n    addFilter,\n    addFilters,\n    removeFilter,\n    removeTag,\n    clearFilters,\n    setPage,\n    setPageSize,\n    loadMore,\n    isLoadingMore,\n    hasMore,\n    optimisticUpdateSubmission,\n    optimisticRemoveSubmission,\n    updateFilter\n  } = useSubmissionsManager({\n    contextId,\n    onlyMine,\n    initialUserId: session?.user?.id?.toString() || '',\n    includeThreadReplies: shouldIncludeReplies,\n    infiniteScroll: infiniteScrollMode\n  });\n\n  // Check if onlyReplies filter is active\n  const onlyRepliesFilter = filters.find(\n    (filter) => filter.name === 'onlyReplies'\n  );\n  const onlyReplies = onlyRepliesFilter?.value === 'true';\n\n  // Pagination pre-request for intelligent skeleton loading\n  const {\n    data: preRequestData,\n    isLoading: isPreRequestLoading,\n    error: preRequestError\n  } = usePaginationPreRequest({\n    onlyMine,\n    userId: session?.user?.id?.toString() || '',\n    filters: filters as Filter<PostFilters>[],\n    pageSize: pagination.pageSize,\n    includeThreadReplies: shouldIncludeReplies,\n    enabled: true // Always enabled for skeleton optimization\n  });\n\n  // Use scroll restoration hook\n  useScrollRestoration({\n    isLoading,\n    submissions,\n    pagination,\n    filters,\n    infiniteScrollMode\n  });\n\n  // Use event handlers hook\n  const {\n    handleAddFilter,\n    handleAddFilters,\n    handleTagClick,\n    handleHashtagClick,\n    handleMentionClick,\n    handleToggleThreadReplies,\n    handleNewPostClick,\n    handleRefresh,\n    handleFilterSuccess,\n    handleUpdateFilter,\n    handleTextSearch\n  } = usePostsManagerHandlers({\n    addFilter,\n    addFilters,\n    removeFilter,\n    updateFilter,\n    setIncludeThreadReplies,\n    onNewPostClick,\n    contextId\n  });\n\n  // Handler for only replies toggle\n  const handleOnlyRepliesToggle = useCallback(\n    (checked: boolean) => {\n      if (process.env.NODE_ENV === 'development') {\n        // eslint-disable-next-line no-console\n        console.log('\ud83d\udd0d PostsManager: onlyReplies toggle', {\n          checked,\n          currentOnlyReplies: onlyReplies\n        });\n      }\n      if (checked) {\n        addFilter({ name: 'onlyReplies', value: 'true' });\n      } else {\n        removeFilter('onlyReplies');\n      }\n    },\n    [addFilter, removeFilter]\n  );\n\n  // Wrapper function for thread toggle that accepts boolean\n  const handleThreadToggle = useCallback(\n    (checked: boolean) => {\n      if (process.env.NODE_ENV === 'development') {\n        // eslint-disable-next-line no-console\n        console.log('\ud83d\udd0d PostsManager: includeThreadReplies toggle', {\n          checked,\n          currentIncludeThreadReplies: includeThreadReplies\n        });\n      }\n      setIncludeThreadReplies(checked);\n    },\n    [setIncludeThreadReplies]\n  );\n\n  // Memoize authorization check\n  const isAuthorized = useMemo(() => !!session?.user?.id, [session?.user?.id]);\n\n  // Handle filter type change events from FilterBar\n  useEffect(() => {\n    const handleAddFilterFromToggle = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      const { filterType, value } = customEvent.detail;\n\n      // Add the new filter\n      addFilter({ name: filterType, value });\n    };\n\n    window.addEventListener('addFilterFromToggle', handleAddFilterFromToggle);\n\n    return () => {\n      window.removeEventListener(\n        'addFilterFromToggle',\n        handleAddFilterFromToggle\n      );\n    };\n  }, [addFilter]);\n\n  // Memoize total pages calculation\n  const totalPages = useMemo(\n    () => Math.ceil(pagination.totalRecords / pagination.pageSize),\n    [pagination.totalRecords, pagination.pageSize]\n  );\n\n  // Calculate expected skeleton items based on pre-request data\n  const expectedSkeletonItems = useMemo(() => {\n    if (preRequestData?.expectedItems) {\n      return preRequestData.expectedItems;\n    }\n    // Fallback to pagination page size or default\n    return Math.min(pagination.pageSize || 10, 10);\n  }, [preRequestData?.expectedItems, pagination.pageSize]);\n\n  // Calculate actual filter count (excluding logic-only filters)\n  const actualFiltersCount = useMemo(() => {\n    return filters.filter(\n      (filter) =>\n        !['tagLogic', 'authorLogic', 'mentionsLogic', 'globalLogic'].includes(\n          filter.name\n        )\n    ).length;\n  }, [filters]);\n\n  // Debug logging for filter operations\n  if (process.env.NODE_ENV === 'development') {\n    const currentFilterString = JSON.stringify(filters);\n    if (\n      filterOpCount.current === 0 ||\n      lastFilterOp.current !== currentFilterString\n    ) {\n      filterOpCount.current += 1;\n      lastFilterOp.current = currentFilterString;\n      // eslint-disable-next-line no-console\n      console.log(`Filter operation #${filterOpCount.current}:`, {\n        filtersCount: filters.length,\n        isLoading,\n        renderCount: renderCount.current\n      });\n    }\n  }\n\n  // Debug logging for render state\n  logger.group('renderState');\n  logger.debug('Rendering with state', {\n    isLoading,\n    hasSubmissions: submissions.length > 0,\n    submissionsCount: submissions.length,\n    error,\n    filtersCount: actualFiltersCount,\n    currentPage: pagination.currentPage,\n    totalPages: Math.ceil(pagination.totalRecords / pagination.pageSize),\n    totalRecords: pagination.totalRecords,\n    infiniteScrollMode,\n    showFilters,\n    expectedSkeletonItems,\n    preRequestData: preRequestData\n      ? {\n          expectedItems: preRequestData.expectedItems,\n          isLoading: isPreRequestLoading\n        }\n      : null\n  });\n\n  // Additional debug logging for search results issue\n  if (process.env.NODE_ENV === 'development') {\n    // Only log when there are actual issues, not on every render\n    if (renderCount.current === 1 || renderCount.current % 10 === 0) {\n      // eslint-disable-next-line no-console\n      console.log('\ud83d\udd0d PostsManager Debug - Search Results Issue:', {\n        submissionsLength: submissions.length,\n        isLoading,\n        error,\n        totalRecords: pagination.totalRecords,\n        renderCount: renderCount.current,\n        filters: filters.map((f) => ({ name: f.name, value: f.value })),\n        firstSubmission: submissions[0]\n          ? {\n              id: submissions[0].submission_id,\n              title: submissions[0].submission_title,\n              author: submissions[0].author\n            }\n          : null\n      });\n    }\n  }\n\n  logger.groupEnd();\n\n  // Memoize filter toggle function\n  const handleToggleFilters = useCallback(() => {\n    setShowFilters(!showFilters);\n  }, [showFilters, setShowFilters]);\n\n  // Memoize remove filter function\n  const handleRemoveFilter = useCallback(\n    (name: string, value?: any) => removeFilter(name as any, value),\n    [removeFilter]\n  );\n\n  return (\n    <>\n      <div className=\\\"posts-manager__controls\\\">\n        {/* Top controls row with filters and new post button */}\n        <PostsManagerControls\n          isMobile={isMobile}\n          showFilters={showFilters}\n          onToggleFilters={handleToggleFilters}\n          filtersCount={actualFiltersCount}\n          totalRecords={pagination.totalRecords}\n          isLoading={isLoading}\n          error={error || null}\n          onNewPostClick={handleNewPostClick}\n          isAuthorized={isAuthorized}\n          compactMode={spacingTheme === 'compact'}\n        />\n\n        {/* Collapsible Filter Section */}\n        <PostsManagerFilters\n          showFilters={showFilters}\n          contextId={contextId}\n          filters={filters}\n          onRemoveFilter={handleRemoveFilter}\n          onRemoveTag={removeTag}\n          onClearFilters={clearFilters}\n          onUpdateFilter={handleUpdateFilter}\n          onAddFilter={addFilter}\n          onAddFilters={addFilters}\n          onFilterSuccess={handleFilterSuccess}\n          onTextSearch={handleTextSearch}\n          showRepliesFilter={showRepliesFilter}\n          includeThreadReplies={includeThreadReplies}\n          onlyReplies={onlyReplies}\n          onToggleThreadReplies={handleThreadToggle}\n          onToggleOnlyReplies={handleOnlyRepliesToggle}\n          isLoading={isLoading}\n        />\n\n        {/* Sticky Controls - appears when main controls are out of view */}\n        <StickyPostsControls\n          showFilters={showFilters}\n          onToggleFilters={handleToggleFilters}\n          filtersCount={actualFiltersCount}\n          infiniteScrollMode={infiniteScrollMode}\n          onTogglePaginationMode={setInfiniteScrollMode}\n          totalRecords={pagination.totalRecords}\n          isLoading={isLoading}\n          hasFilters={actualFiltersCount > 0}\n          onNewPostClick={handleNewPostClick}\n        />\n      </div>\n\n      {/* Simple Skeleton Wrapper for SubmissionsList */}\n      <SimpleSkeletonWrapper\n        isLoading={isLoading}\n        className=\\\"posts-manager__submissions-wrapper\\\"\n        expectedItemCount={expectedSkeletonItems}\n      >\n        <SubmissionsList\n          posts={submissions}\n          onTagClick={handleTagClick}\n          onHashtagClick={handleHashtagClick}\n          onMentionClick={handleMentionClick}\n          showSkeletons={false} // Handled by SimpleSkeletonWrapper\n          onRefresh={handleRefresh}\n          contextId={contextId}\n          infiniteScrollMode={infiniteScrollMode}\n          hasMore={hasMore}\n          isLoadingMore={isLoadingMore}\n          onLoadMore={loadMore}\n          optimisticUpdateSubmission={optimisticUpdateSubmission}\n          optimisticRemoveSubmission={optimisticRemoveSubmission}\n          currentPage={pagination.currentPage}\n          currentFilters={filters}\n          error={error}\n        >\n          {renderSubmissionItem}\n        </SubmissionsList>\n      </SimpleSkeletonWrapper>\n\n      {/* Pagination */}\n      <PostsManagerPagination\n        isLoading={isLoading}\n        error={error || null}\n        submissions={submissions}\n        infiniteScrollMode={infiniteScrollMode}\n        hasMore={hasMore}\n        totalRecords={pagination.totalRecords}\n        pagination={pagination}\n        totalPages={totalPages}\n        onPageChange={setPage}\n        onPageSizeChange={setPageSize}\n      />\n    </>\n  );\n});\n\nexport default PostsManager;\n",
    "language":"typescript",
    "lines":445,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/SearchStatus.tsx":{
    "content":"import React from 'react';\n\ninterface SearchStatusProps {\n  children: React.ReactNode;\n}\n\nexport const SearchStatus: React.FC<SearchStatusProps> = ({ children }) => {\n  return (\n    <div className=\\\"text-search-input__status\\\">\n      <span className=\\\"text-search-input__status-text\\\">{children}</span>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":14,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/SmartFilterInput.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { useAtom } from 'jotai';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Filter, getSubmissionsFiltersAtom } from '../../../../lib/state/atoms';\nimport { PostFilters } from '../../../../lib/types/filters';\nimport { RichInputAdapter } from '../../submission-forms/shared-submission-form/components/RichInputAdapter';\nimport './SmartFilterInput.css';\n\nconst logger = createLogger({\n  context: {\n    component: 'SmartFilterInput',\n    module: 'submissions-list'\n  }\n});\n\ninterface SmartFilterInputProps {\n  placeholder?: string;\n  className?: string;\n  contextId: string;\n  enableHashtags?: boolean;\n  enableUserMentions?: boolean;\n  onMentionClick?: (\n    mention: string,\n    filterType?: 'author' | 'mentions'\n  ) => void;\n  onPillClick?: (pill: string) => void;\n  onAddFilter?: (filter: Filter<PostFilters>) => void;\n  onAddFilters?: (filters: Filter<PostFilters>[]) => void;\n  onRemoveFilter?: (name: PostFilters, value?: any) => void;\n  onFilterSuccess?: () => void;\n  onSearch?: (searchText: string) => void;\n  onClearFilters?: () => void;\n  onValueChange?: (value: string) => void;\n}\n\nexport const SmartFilterInput: React.FC<SmartFilterInputProps> = ({\n  placeholder = 'Search posts, #hashtags, @mentions...',\n  className = '',\n  contextId,\n  enableHashtags = true,\n  enableUserMentions = true,\n  onAddFilter,\n  onAddFilters,\n  onRemoveFilter,\n  onFilterSuccess,\n  onSearch,\n  onClearFilters,\n  onValueChange\n}) => {\n  const [filtersState] = useAtom(getSubmissionsFiltersAtom(contextId));\n\n  // Local input state for user typing\n  const [localInputValue, setLocalInputValue] = useState('');\n  const [isUpdatingFromFilters, setIsUpdatingFromFilters] = useState(false);\n  const [isUserTyping, setIsUserTyping] = useState(false);\n  const [lastFilterStateLength, setLastFilterStateLength] = useState(0);\n  const [lastInputValue, setLastInputValue] = useState('');\n\n  // Convert current filter state to display value\n  const filtersToDisplayValue = useMemo(() => {\n    const parts: string[] = [];\n\n    // Add hashtags\n    filtersState.filters\n      .filter((f: Filter) => f.name === 'tags')\n      .forEach((filter: Filter) => {\n        // Handle legacy comma-separated values by splitting them\n        const values = filter.value\n          .split(',')\n          .map((v) => v.trim())\n          .filter(Boolean);\n        values.forEach((value) => {\n          const cleanValue = value.startsWith('#') ? value : `#${value}`;\n          parts.push(cleanValue);\n        });\n      });\n\n    // Add structured mentions and authors\n    filtersState.filters\n      .filter((f: Filter) => f.name === 'author' || f.name === 'mentions')\n      .forEach((filter: Filter) => {\n        // Handle legacy comma-separated values by splitting them\n        const values = filter.value\n          .split(',')\n          .map((v) => v.trim())\n          .filter(Boolean);\n        values.forEach((value) => {\n          if (value.includes('|')) {\n            const [username, userId] = value.split('|');\n            const filterType = filter.name === 'author' ? 'author' : 'mentions';\n            parts.push(`@[${username}|${userId}|${filterType}]`);\n          } else {\n            const filterType = filter.name === 'author' ? 'author' : 'mentions';\n            parts.push(`@[${value}|${value}|${filterType}]`);\n          }\n        });\n      });\n\n    // Add search text\n    const searchFilter = filtersState.filters.find(\n      (f: Filter) => f.name === 'search'\n    );\n    if (searchFilter?.value) {\n      const searchText = searchFilter.value;\n      // Parse quoted phrases and individual words\n      const quotedRegex = /\\\"([^\\\"]+)\\\"/g;\n      const searchParts: string[] = [];\n\n      const remainingText = searchText.replace(quotedRegex, (match, quoted) => {\n        searchParts.push(`\\\"${quoted}\\\"`);\n        return '';\n      });\n\n      // Add remaining individual words\n      const words = remainingText.trim().split(/\\\\s+/).filter(Boolean);\n      searchParts.push(...words);\n      parts.push(...searchParts);\n    }\n\n    return parts.join(' ');\n  }, [filtersState.filters]);\n\n  // Initialize input value on first load\n  useEffect(() => {\n    if (localInputValue === '' && filtersToDisplayValue !== '') {\n      setLocalInputValue(filtersToDisplayValue);\n    }\n  }, []);\n\n  // Sync input with filter state changes\n  useEffect(() => {\n    const currentFilterCount = filtersState.filters.length;\n\n    // If filters were cleared (went from having filters to no filters)\n    if (lastFilterStateLength > 0 && currentFilterCount === 0) {\n      setLocalInputValue('');\n      setIsUserTyping(false);\n    }\n    // If filters were added and user is not currently typing, update the input to show constructed value\n    else if (\n      currentFilterCount > 0 &&\n      !isUserTyping &&\n      filtersToDisplayValue !== localInputValue\n    ) {\n      setLocalInputValue(filtersToDisplayValue);\n      setIsUserTyping(false);\n    }\n\n    setLastFilterStateLength(currentFilterCount);\n  }, [\n    filtersState.filters.length,\n    lastFilterStateLength,\n    isUserTyping,\n    isUpdatingFromFilters,\n    filtersToDisplayValue,\n    localInputValue\n  ]);\n\n  // Reset the updating flag when the display value has been applied\n  useEffect(() => {\n    if (isUpdatingFromFilters && localInputValue === filtersToDisplayValue) {\n      setIsUpdatingFromFilters(false);\n    }\n  }, [isUpdatingFromFilters, localInputValue, filtersToDisplayValue]);\n\n  // Reset user typing flag when input matches filter state\n  useEffect(() => {\n    if (isUserTyping && localInputValue === filtersToDisplayValue) {\n      setIsUserTyping(false);\n    }\n  }, [isUserTyping, localInputValue, filtersToDisplayValue]);\n\n  // Notify parent of value changes for clear button visibility\n  useEffect(() => {\n    if (onValueChange) {\n      onValueChange(localInputValue);\n    }\n  }, [localInputValue, onValueChange]);\n\n  // Parse user input and extract filters\n  const parseInputToFilters = useCallback(\n    (input: string): Filter<PostFilters>[] => {\n      const filters: Filter<PostFilters>[] = [];\n      let remainingText = input;\n\n      // Extract hashtags\n      const hashtagRegex = /#(\\\\w+)/g;\n      let match;\n      while ((match = hashtagRegex.exec(input)) !== null) {\n        filters.push({ name: 'tags', value: match[1] });\n        remainingText = remainingText.replace(match[0], '').trim();\n      }\n\n      // Extract structured mentions @[username|userId|filterType]\n      const mentionRegex = /@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]/g;\n      while ((match = mentionRegex.exec(input)) !== null) {\n        const [fullMatch, username, userId, filterType] = match;\n        if (filterType === 'author') {\n          filters.push({ name: 'author', value: userId });\n        } else if (filterType === 'mentions') {\n          filters.push({ name: 'mentions', value: `${username}|${userId}` });\n        } else {\n          filters.push({ name: 'mentions', value: `${username}|${userId}` });\n        }\n        remainingText = remainingText.replace(fullMatch, '').trim();\n      }\n\n      // Extract simple mentions @username\n      const simpleMentionRegex = /@(\\\\w+)/g;\n      while ((match = simpleMentionRegex.exec(remainingText)) !== null) {\n        filters.push({ name: 'mentions', value: match[1] });\n        remainingText = remainingText.replace(match[0], '').trim();\n      }\n\n      // Handle remaining text as search\n      if (remainingText.trim()) {\n        filters.push({ name: 'search', value: remainingText.trim() });\n      }\n\n      return filters;\n    },\n    []\n  );\n\n  // Apply filters to state\n  const applyFilters = useCallback(\n    (filters: Filter<PostFilters>[]) => {\n      setIsUpdatingFromFilters(true);\n\n      // Clear existing filters\n      onRemoveFilter?.('tags');\n      onRemoveFilter?.('author');\n      onRemoveFilter?.('mentions');\n      onRemoveFilter?.('search');\n\n      // Add new filters\n      if (filters.length > 0) {\n        onAddFilters?.(filters);\n        onFilterSuccess?.();\n      }\n\n      // Trigger search callback if there's search text\n      const searchFilter = filters.find((f) => f.name === 'search');\n      if (searchFilter?.value) {\n        onSearch?.(searchFilter.value);\n      }\n    },\n    [onAddFilters, onRemoveFilter, onFilterSuccess, onSearch]\n  );\n\n  // Handle input changes from RichInputAdapter (only update local state)\n  const handleInputChange = useCallback(\n    (newValue: string) => {\n      // Prevent infinite loops during programmatic updates\n      if (isUpdatingFromFilters) {\n        return;\n      }\n\n      // Always update local state immediately for responsive typing\n      setLocalInputValue(newValue);\n\n      // Mark that user is actively typing\n      setIsUserTyping(true);\n\n      // Update the last input value for comparison in next call\n      setLastInputValue(newValue);\n    },\n    [isUpdatingFromFilters]\n  );\n\n  // Handle Enter key to apply filters\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === 'Enter' && !isUpdatingFromFilters) {\n        e.preventDefault();\n        // Parse and apply filters on Enter\n        const filters = parseInputToFilters(localInputValue);\n        applyFilters(filters);\n        // User finished typing\n        setIsUserTyping(false);\n      }\n    },\n    [parseInputToFilters, applyFilters, isUpdatingFromFilters, localInputValue]\n  );\n\n  // Handle blur to apply filters when user clicks away\n  const handleBlur = useCallback(() => {\n    if (isUpdatingFromFilters) {\n      return;\n    }\n\n    // Parse and apply filters on blur\n    const filters = parseInputToFilters(localInputValue);\n    applyFilters(filters);\n    // User finished typing\n    setIsUserTyping(false);\n  }, [\n    parseInputToFilters,\n    applyFilters,\n    isUpdatingFromFilters,\n    localInputValue\n  ]);\n\n  return (\n    <div\n      className={`smart-filter-input ${className}`}\n      onKeyDown={handleKeyDown}\n      onBlur={handleBlur}\n    >\n      <RichInputAdapter\n        value={localInputValue}\n        onChange={handleInputChange}\n        placeholder={placeholder}\n        contextId={`${contextId}-filter`}\n        className=\\\"smart-filter-input__rich-input\\\"\n        multiline={false}\n        enableHashtags={enableHashtags}\n        enableUserMentions={enableUserMentions}\n        enableEmojis={false}\n        enableImagePaste={false}\n        mentionFilterType=\\\"mentions\\\"\n        enableDebugLogging={false}\n      />\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":329,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/TextSearchInput.tsx":{
    "content":"'use client';\n\nimport React from 'react';\nimport { useFilterStatus, type FilterCounts } from './hooks/useFilterStatus';\nimport { useTextSearchInput } from './hooks/useTextSearchInput';\nimport { SearchInputContainer } from './SearchInputContainer';\nimport { SearchStatus } from './SearchStatus';\nimport './TextSearchInput.css';\n\nexport interface TextSearchInputProps {\n  onSearch: (searchText: string) => void;\n  contextId?: string;\n  placeholder?: string;\n  minLength?: number;\n  className?: string;\n  initialValue?: string;\n  value?: string; // Controlled value\n  onChange?: (value: string) => void; // Controlled change handler\n  // Combined replies filter\n  showRepliesFilter?: boolean;\n  includeThreadReplies?: boolean;\n  onlyReplies?: boolean;\n  onToggleThreadReplies?: (checked: boolean) => void;\n  onToggleOnlyReplies?: (checked: boolean) => void;\n  isLoading?: boolean;\n  // Smart input features\n  enableSmartInput?: boolean;\n  onMentionClick?: (\n    mention: string,\n    filterType?: 'author' | 'mentions'\n  ) => void;\n  onPillClick?: (pill: string) => void;\n  // Filter management callbacks for smart input\n  onAddFilter?: (filter: any) => void;\n  onAddFilters?: (filters: any[]) => void;\n  onRemoveFilter?: (name: any, value?: any) => void;\n  onFilterSuccess?: () => void;\n  onClearFilters?: () => void;\n  // Enhanced filter information\n  filterCounts?: FilterCounts;\n  totalActiveFilters?: number;\n}\n\nexport const TextSearchInput: React.FC<TextSearchInputProps> = ({\n  onSearch,\n  contextId,\n  placeholder = 'Search posts content... (or use @user #tag for filters)',\n  minLength = 2,\n  className = '',\n  initialValue = '',\n  value,\n  onChange,\n  showRepliesFilter = false,\n  includeThreadReplies = false,\n  onlyReplies = false,\n  onToggleThreadReplies,\n  onToggleOnlyReplies,\n  isLoading = false,\n  enableSmartInput = false,\n  onMentionClick,\n  onPillClick,\n  onAddFilter,\n  onAddFilters,\n  onRemoveFilter,\n  onFilterSuccess,\n  onClearFilters,\n  filterCounts,\n  totalActiveFilters\n}) => {\n  // Use custom hooks for logic\n  const searchInput = useTextSearchInput({\n    initialValue,\n    value,\n    onChange,\n    onSearch,\n    minLength\n  });\n\n  const filterStatus = useFilterStatus({\n    filterCounts,\n    totalActiveFilters,\n    hasValidSearch: searchInput.hasValidSearch,\n    searchTerms: searchInput.searchTerms\n  });\n\n  // Create custom clear handler for smart input mode\n  const handleClear =\n    enableSmartInput && onClearFilters\n      ? onClearFilters // Clear all filters in smart mode\n      : searchInput.handleClear; // Clear only search in regular mode\n\n  // Determine container class\n  const containerClass = [\n    'text-search-input',\n    enableSmartInput && contextId ? 'text-search-input--smart' : '',\n    showRepliesFilter ? 'text-search-input--with-replies-filter' : '',\n    className\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  return (\n    <div className={containerClass}>\n      <SearchInputContainer\n        enableSmartInput={enableSmartInput}\n        contextId={contextId}\n        currentValue={searchInput.currentValue}\n        onSmartInputChange={searchInput.handleSmartInputChange}\n        onMentionClick={onMentionClick}\n        onPillClick={onPillClick}\n        onAddFilter={onAddFilter}\n        onAddFilters={onAddFilters}\n        onRemoveFilter={onRemoveFilter}\n        onFilterSuccess={onFilterSuccess}\n        onSearch={onSearch}\n        inputRef={searchInput.inputRef}\n        onInputChange={searchInput.handleInputChange}\n        onKeyDown={searchInput.handleKeyDown}\n        placeholder={placeholder}\n        isLoading={isLoading}\n        hasValue={searchInput.hasValue}\n        onClear={handleClear}\n        showRepliesFilter={Boolean(showRepliesFilter)}\n        includeThreadReplies={Boolean(includeThreadReplies)}\n        onlyReplies={Boolean(onlyReplies)}\n        onToggleThreadReplies={onToggleThreadReplies}\n        onToggleOnlyReplies={onToggleOnlyReplies}\n      />\n\n      {filterStatus.statusText && Boolean(filterStatus.shouldShowStatus) && (\n        <SearchStatus>{filterStatus.statusText}</SearchStatus>\n      )}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":136,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/SearchInputContainer.tsx":{
    "content":"'use client';\n\nimport React, { useCallback, useState } from 'react';\nimport { InteractiveTooltip } from '../../tooltip/InteractiveTooltip';\nimport { SmartFilterInput } from './SmartFilterInput';\n\ninterface SearchInputContainerProps {\n  // Smart input mode\n  enableSmartInput?: boolean;\n  contextId?: string;\n  currentValue: string;\n  onSmartInputChange: (value: string) => void;\n  onMentionClick?: (\n    mention: string,\n    filterType?: 'author' | 'mentions'\n  ) => void;\n  onPillClick?: (pill: string) => void;\n  // Filter management callbacks for smart input\n  onAddFilter?: (filter: any) => void;\n  onAddFilters?: (filters: any[]) => void;\n  onRemoveFilter?: (name: any, value?: any) => void;\n  onFilterSuccess?: () => void;\n  onSearch?: (searchText: string) => void;\n\n  // Regular input mode\n  inputRef: React.RefObject<HTMLInputElement>;\n  onInputChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  onKeyDown: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n\n  // Common props\n  placeholder: string;\n  isLoading: boolean;\n  hasValue: boolean;\n  onClear: () => void;\n\n  // Combined replies filter\n  showRepliesFilter?: boolean;\n  includeThreadReplies?: boolean;\n  onlyReplies?: boolean;\n  onToggleThreadReplies?: (checked: boolean) => void;\n  onToggleOnlyReplies?: (checked: boolean) => void;\n}\n\nexport const SearchInputContainer: React.FC<SearchInputContainerProps> = ({\n  enableSmartInput,\n  contextId,\n  currentValue,\n  onSmartInputChange,\n  onMentionClick,\n  onPillClick,\n  onAddFilter,\n  onAddFilters,\n  onRemoveFilter,\n  onFilterSuccess,\n  onSearch,\n  inputRef,\n  onInputChange,\n  onKeyDown,\n  placeholder,\n  isLoading,\n  hasValue,\n  onClear,\n  showRepliesFilter = false,\n  includeThreadReplies = false,\n  onlyReplies = false,\n  onToggleThreadReplies,\n  onToggleOnlyReplies\n}) => {\n  const shouldUseSmartInput = enableSmartInput && contextId;\n  const [smartInputValue, setSmartInputValue] = useState('');\n\n  // Handle smart input value changes for clear button visibility\n  const handleSmartInputValueChange = useCallback((value: string) => {\n    setSmartInputValue(value);\n  }, []);\n\n  // Handle clear for smart input - clear both input and filters\n  const handleSmartInputClear = useCallback(() => {\n    setSmartInputValue('');\n    // Call onClear which should clear all filters\n    onClear();\n  }, [onClear]);\n\n  // Determine if we have a value (for clear button visibility)\n  const actualHasValue = shouldUseSmartInput\n    ? smartInputValue.length > 0\n    : hasValue;\n\n  // Determine replies filter state and styling\n  const getRepliesFilterState = () => {\n    if (onlyReplies) return 'only-replies';\n    if (includeThreadReplies) return 'active';\n    return 'inactive';\n  };\n\n  const getRepliesFilterLabel = () => {\n    if (onlyReplies) return 'Only Replies';\n    if (includeThreadReplies) return 'With Replies';\n    return 'Replies';\n  };\n\n  const getRepliesFilterIcon = () => {\n    if (onlyReplies) return '\ud83d\udcac';\n    if (includeThreadReplies) return '\ud83d\udcac';\n    return '\ud83d\udcac';\n  };\n\n  const handleRepliesOptionClick = (option: 'none' | 'thread' | 'only') => {\n    switch (option) {\n      case 'none':\n        onToggleThreadReplies?.(false);\n        onToggleOnlyReplies?.(false);\n        break;\n      case 'thread':\n        onToggleThreadReplies?.(true);\n        onToggleOnlyReplies?.(false);\n        break;\n      case 'only':\n        onToggleThreadReplies?.(false);\n        onToggleOnlyReplies?.(true);\n        break;\n    }\n  };\n\n  // Create the dropdown content for the InteractiveTooltip\n  const repliesDropdownContent = (\n    <div className=\\\"text-search-input__replies-dropdown-content\\\">\n      <div\n        className={`text-search-input__replies-option ${!includeThreadReplies && !onlyReplies ? 'text-search-input__replies-option--active' : ''}`}\n        onClick={() => handleRepliesOptionClick('none')}\n      >\n        <div className=\\\"text-search-input__replies-option-icon\\\">\ud83d\udcdd</div>\n        <div className=\\\"text-search-input__replies-option-text\\\">\n          <div>Main Posts Only</div>\n          <div className=\\\"text-search-input__replies-option-description\\\">\n            Show only original posts\n          </div>\n        </div>\n      </div>\n\n      <div\n        className={`text-search-input__replies-option ${includeThreadReplies && !onlyReplies ? 'text-search-input__replies-option--active' : ''}`}\n        onClick={() => handleRepliesOptionClick('thread')}\n      >\n        <div className=\\\"text-search-input__replies-option-icon\\\">\ud83d\udcac</div>\n        <div className=\\\"text-search-input__replies-option-text\\\">\n          <div>With Replies</div>\n          <div className=\\\"text-search-input__replies-option-description\\\">\n            Show posts with their replies\n          </div>\n        </div>\n      </div>\n\n      <div\n        className={`text-search-input__replies-option ${onlyReplies ? 'text-search-input__replies-option--active' : ''}`}\n        onClick={() => handleRepliesOptionClick('only')}\n      >\n        <div className=\\\"text-search-input__replies-option-icon\\\">\u21a9\ufe0f</div>\n        <div className=\\\"text-search-input__replies-option-text\\\">\n          <div>Only Replies</div>\n          <div className=\\\"text-search-input__replies-option-description\\\">\n            Show only reply posts\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\\\"text-search-input__container\\\">\n      {/* Search Icon */}\n      <div className=\\\"text-search-input__icon\\\">\n        {isLoading ? (\n          <div className=\\\"text-search-input__spinner\\\" />\n        ) : (\n          <svg\n            width=\\\"16\\\"\n            height=\\\"16\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          >\n            <circle cx=\\\"11\\\" cy=\\\"11\\\" r=\\\"8\\\" />\n            <path d=\\\"m21 21-4.35-4.35\\\" />\n          </svg>\n        )}\n      </div>\n\n      {/* Input Field */}\n      {shouldUseSmartInput ? (\n        <SmartFilterInput\n          onMentionClick={onMentionClick}\n          onPillClick={onPillClick}\n          onAddFilter={onAddFilter}\n          onAddFilters={onAddFilters}\n          onRemoveFilter={onRemoveFilter}\n          onFilterSuccess={onFilterSuccess}\n          onSearch={onSearch}\n          onClearFilters={onClear}\n          onValueChange={handleSmartInputValueChange}\n          placeholder={placeholder}\n          className=\\\"text-search-input__smart-field\\\"\n          contextId={contextId}\n          enableHashtags={true}\n          enableUserMentions={true}\n        />\n      ) : (\n        <input\n          ref={inputRef}\n          type=\\\"text\\\"\n          value={currentValue}\n          onChange={onInputChange}\n          onKeyDown={onKeyDown}\n          placeholder={placeholder}\n          className=\\\"text-search-input__field\\\"\n          autoComplete=\\\"off\\\"\n          spellCheck=\\\"false\\\"\n        />\n      )}\n\n      {/* Combined Replies Filter with InteractiveTooltip */}\n      {showRepliesFilter && (\n        <InteractiveTooltip\n          content={repliesDropdownContent}\n          triggerOnClick={true}\n          className=\\\"text-search-input__replies-tooltip\\\"\n        >\n          <div\n            className={`text-search-input__replies-filter text-search-input__replies-filter--${getRepliesFilterState()}`}\n            title=\\\"Configure reply filtering options\\\"\n          >\n            <div className=\\\"text-search-input__replies-icon\\\">\n              {getRepliesFilterIcon()}\n            </div>\n            <span className=\\\"text-search-input__replies-label\\\">\n              {getRepliesFilterLabel()}\n            </span>\n          </div>\n        </InteractiveTooltip>\n      )}\n\n      {/* Clear Button */}\n      {actualHasValue && (\n        <button\n          type=\\\"button\\\"\n          onClick={shouldUseSmartInput ? handleSmartInputClear : onClear}\n          className=\\\"text-search-input__clear\\\"\n          aria-label=\\\"Clear search\\\"\n          title=\\\"Clear search (Esc)\\\"\n        >\n          <svg\n            width=\\\"14\\\"\n            height=\\\"14\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          >\n            <line x1=\\\"18\\\" y1=\\\"6\\\" x2=\\\"6\\\" y2=\\\"18\\\" />\n            <line x1=\\\"6\\\" y1=\\\"6\\\" x2=\\\"18\\\" y2=\\\"18\\\" />\n          </svg>\n        </button>\n      )}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":272,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/PostsManagerFilters.tsx":{
    "content":"'use client';\n\nimport FilterBar from '../../filter-bar/FilterBar';\nimport { SmartTextSearchInput } from './SmartTextSearchInput';\n\nexport interface PostsManagerFiltersProps {\n  showFilters: boolean;\n  contextId: string;\n  filters: Array<{ name: string; value: any }>;\n  onRemoveFilter: (name: string, value?: any) => void;\n  onRemoveTag: (tag: string) => void;\n  onClearFilters: () => void;\n  onUpdateFilter: (name: string, value: string) => void;\n  onAddFilter: (filter: any) => void;\n  onAddFilters: (filters: any[]) => void;\n  onFilterSuccess: () => void;\n  onTextSearch: (searchText: string) => void;\n  // Combined replies filter\n  showRepliesFilter?: boolean;\n  includeThreadReplies?: boolean;\n  onlyReplies?: boolean;\n  onToggleThreadReplies?: (checked: boolean) => void;\n  onToggleOnlyReplies?: (checked: boolean) => void;\n  isLoading?: boolean;\n}\n\nexport function PostsManagerFilters({\n  showFilters,\n  contextId,\n  filters,\n  onRemoveFilter,\n  onRemoveTag,\n  onClearFilters,\n  onUpdateFilter,\n  onAddFilter,\n  onAddFilters,\n  onFilterSuccess,\n  onTextSearch,\n  showRepliesFilter = false,\n  includeThreadReplies = false,\n  onlyReplies = false,\n  onToggleThreadReplies,\n  onToggleOnlyReplies,\n  isLoading = false\n}: PostsManagerFiltersProps) {\n  // Get current search value from filters\n  const searchFilter = filters.find((f) => f.name === 'search');\n  const currentSearchValue = searchFilter?.value || '';\n\n  return (\n    <div\n      className={`posts-manager__filter-section ${showFilters ? 'posts-manager__filter-section--expanded' : 'posts-manager__filter-section--collapsed'}`}\n      aria-hidden={!showFilters}\n    >\n      <div className=\\\"posts-manager__filter-content\\\">\n        {/* Enhanced Text Search Input with Smart Filters */}\n        <SmartTextSearchInput\n          onSearch={onTextSearch}\n          onAddFilter={onAddFilter}\n          onAddFilters={onAddFilters}\n          onRemoveFilter={onRemoveFilter}\n          onFilterSuccess={onFilterSuccess}\n          onClearFilters={onClearFilters}\n          contextId={contextId}\n          placeholder=\\\"Search posts content... (or use @user #tag for filters)\\\"\n          className=\\\"posts-manager__text-search\\\"\n          showRepliesFilter={showRepliesFilter}\n          includeThreadReplies={includeThreadReplies}\n          onToggleThreadReplies={onToggleThreadReplies}\n          onToggleOnlyReplies={onToggleOnlyReplies}\n          onlyReplies={onlyReplies}\n          isLoading={isLoading}\n        />\n\n        <FilterBar\n          filterId={contextId}\n          filters={filters as any}\n          onRemoveFilter={onRemoveFilter}\n          onRemoveTag={onRemoveTag}\n          onClearFilters={onClearFilters}\n          onUpdateFilter={onUpdateFilter}\n        />\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":87,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/PostsManagerControls.tsx":{
    "content":"'use client';\n\nimport { InstantLink } from '../../ui/InstantLink';\n\nexport interface PostsManagerControlsProps {\n  isMobile: boolean;\n  showFilters: boolean;\n  onToggleFilters: () => void;\n  filtersCount: number;\n  totalRecords: number;\n  isLoading: boolean;\n  error: string | null;\n  onNewPostClick?: () => void;\n  isAuthorized: boolean;\n  compactMode?: boolean;\n}\n\nexport function PostsManagerControls({\n  isMobile,\n  showFilters,\n  onToggleFilters,\n  filtersCount,\n  totalRecords,\n  isLoading,\n  error,\n  onNewPostClick,\n  isAuthorized,\n  compactMode = false\n}: PostsManagerControlsProps) {\n  const isCompact = compactMode || isMobile;\n\n  // Debug logging for totalRecords\n  if (process.env.NODE_ENV === 'development') {\n    // Only log when there are actual issues or significant changes\n    if (totalRecords === 0 && !isLoading && !error) {\n      // eslint-disable-next-line no-console\n      console.log('\ud83d\udd0d PostsManagerControls - totalRecords debug:', {\n        totalRecords,\n        isLoading,\n        error,\n        filtersCount,\n        isCompact\n      });\n    }\n  }\n\n  return (\n    <div\n      className={`posts-manager__top-controls ${isMobile ? 'posts-manager__top-controls--minimal' : ''} ${compactMode ? 'posts-manager__top-controls--compact' : ''}`}\n    >\n      <div className=\\\"posts-manager__display-controls\\\">\n        {/* Filter Toggle Button */}\n        <button\n          className={`posts-manager__filter-toggle ${\n            showFilters ? 'posts-manager__filter-toggle--active' : ''\n          } ${\n            filtersCount > 0 ? 'posts-manager__filter-toggle--has-filters' : ''\n          } ${isCompact ? 'posts-manager__filter-toggle--compact' : ''}`}\n          onClick={onToggleFilters}\n          aria-expanded={showFilters}\n          title={showFilters ? 'Hide filters' : 'Show filters'}\n        >\n          <svg\n            width=\\\"16\\\"\n            height=\\\"16\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n            className={`posts-manager__filter-icon ${showFilters ? 'posts-manager__filter-icon--rotated' : ''}`}\n          >\n            <polygon points=\\\"22,3 2,3 10,12.46 10,19 14,21 14,12.46\\\" />\n          </svg>\n          {!isCompact && 'Filters'}\n          {filtersCount > 0 && (\n            <span className=\\\"posts-manager__filter-count\\\">{filtersCount}</span>\n          )}\n\n          {!isCompact && (\n            <svg\n              width=\\\"12\\\"\n              height=\\\"12\\\"\n              viewBox=\\\"0 0 24 24\\\"\n              fill=\\\"none\\\"\n              stroke=\\\"currentColor\\\"\n              strokeWidth=\\\"2\\\"\n              strokeLinecap=\\\"round\\\"\n              strokeLinejoin=\\\"round\\\"\n              className={`posts-manager__chevron ${showFilters ? 'posts-manager__chevron--up' : 'posts-manager__chevron--down'}`}\n            >\n              <polyline points=\\\"6,9 12,15 18,9\\\" />\n            </svg>\n          )}\n        </button>\n      </div>\n\n      {/* Results count display - show when we have data or when not loading */}\n      {(!isLoading || totalRecords > 0) && !error && (\n        <div\n          className={`posts-manager__results-count ${isCompact ? 'posts-manager__results-count--compact' : ''}`}\n        >\n          <span className=\\\"posts-manager__results-text\\\">\n            {totalRecords === 0\n              ? 'No results found'\n              : isCompact\n                ? `Posts: ${totalRecords.toLocaleString()}`\n                : `${totalRecords.toLocaleString()} result${\n                    totalRecords === 1 ? '' : 's'\n                  }`}\n          </span>\n        </div>\n      )}\n\n      {/* New Post Button */}\n      {onNewPostClick && (\n        <InstantLink\n          href=\\\"#\\\"\n          onClick={(e) => {\n            e.preventDefault();\n            onNewPostClick();\n          }}\n          className={`posts-manager__new-post-button instant-link--button ${\n            isCompact ? 'posts-manager__new-post-button--compact' : ''\n          }`}\n          aria-disabled={!isAuthorized}\n          title={isAuthorized ? 'Create a new post' : 'Login to create posts'}\n        >\n          <svg\n            width=\\\"16\\\"\n            height=\\\"16\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          >\n            <line x1=\\\"12\\\" y1=\\\"5\\\" x2=\\\"12\\\" y2=\\\"19\\\" />\n            <line x1=\\\"5\\\" y1=\\\"12\\\" x2=\\\"19\\\" y2=\\\"12\\\" />\n          </svg>\n          <span className=\\\"instant-link__content\\\">New</span>\n        </InstantLink>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":149,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/PostsManagerPagination.tsx":{
    "content":"'use client';\n\nimport Pagination from '../../pagination/Pagination';\nimport { StickyPagination } from '../../pagination/StickyPagination';\n\nexport interface PostsManagerPaginationProps {\n  isLoading: boolean;\n  error: string | null;\n  submissions: any[];\n  infiniteScrollMode: boolean;\n  hasMore: boolean;\n  totalRecords: number;\n  pagination: {\n    currentPage: number;\n    pageSize: number;\n  };\n  totalPages: number;\n  onPageChange: (page: number) => void;\n  onPageSizeChange: (size: number) => void;\n}\n\nexport function PostsManagerPagination({\n  isLoading,\n  error,\n  submissions,\n  infiniteScrollMode,\n  hasMore,\n  totalRecords,\n  pagination,\n  totalPages,\n  onPageChange,\n  onPageSizeChange\n}: PostsManagerPaginationProps) {\n  if (isLoading || error || submissions.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\\\"posts-manager__pagination\\\">\n      {!infiniteScrollMode ? (\n        <>\n          <Pagination\n            id=\\\"submissions\\\"\n            currentPage={pagination.currentPage}\n            totalPages={totalPages}\n            pageSize={pagination.pageSize}\n            onPageChange={onPageChange}\n            onPageSizeChange={onPageSizeChange}\n          />\n          <StickyPagination\n            id=\\\"submissions\\\"\n            currentPage={pagination.currentPage}\n            totalPages={totalPages}\n            pageSize={pagination.pageSize}\n            onPageChange={onPageChange}\n            onPageSizeChange={onPageSizeChange}\n            containerSelector=\\\".posts-manager__pagination\\\"\n          />\n        </>\n      ) : (\n        <div className=\\\"posts-manager__infinite-scroll\\\">\n          {/* Show completion message when no more posts */}\n          {!hasMore && submissions.length > 0 && (\n            <div className=\\\"posts-manager__infinite-info\\\">\n              Showing all {submissions.length} of{' '}\n              {totalRecords.toLocaleString()} posts\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":74,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/SmartTextSearchInput.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { useAtom } from 'jotai';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Filter, getSubmissionsFiltersAtom } from '../../../../lib/state/atoms';\nimport { PostFilters } from '../../../../lib/types/filters';\nimport { TextSearchInput } from './TextSearchInput';\n\nconst logger = createLogger({\n  context: {\n    component: 'SmartTextSearchInput',\n    module: 'submissions-list'\n  }\n});\n\n// Hook for resolving user IDs to usernames (same as FilterLabel)\nconst useUserResolution = () => {\n  const [userCache, setUserCache] = useState<Map<string, string>>(new Map());\n  const [loadingUsers, setLoadingUsers] = useState<Set<string>>(new Set());\n\n  const resolveUserId = useCallback(\n    async (userId: string): Promise<string> => {\n      // Return cached result if available\n      if (userCache.has(userId)) {\n        return userCache.get(userId)!;\n      }\n\n      // Return userId if already loading\n      if (loadingUsers.has(userId)) {\n        return userId;\n      }\n\n      // Check if this looks like a user ID that needs resolution (numeric or UUID-like)\n      const isUserIdFormat = (value: string) => {\n        return (\n          /^\\\\d+$/.test(value) || // Numeric ID\n          /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(\n            value\n          )\n        ); // UUID\n      };\n\n      if (!isUserIdFormat(userId)) {\n        // Not a user ID format, return as-is\n        return userId;\n      }\n\n      // Start loading\n      setLoadingUsers((prev) => new Set(prev).add(userId));\n\n      try {\n        const { resolveUserIdToUsername } = await import(\n          '../../../../lib/actions/search.actions'\n        );\n        const username = await resolveUserIdToUsername(userId);\n\n        if (username) {\n          // Cache the result\n          setUserCache((prev) => new Map(prev).set(userId, username));\n          return username;\n        } else {\n          // Cache the failure (use userId as fallback)\n          setUserCache((prev) => new Map(prev).set(userId, userId));\n          return userId;\n        }\n      } catch (error) {\n        console.error('Error resolving user ID to username:', error);\n        // Cache the failure (use userId as fallback)\n        setUserCache((prev) => new Map(prev).set(userId, userId));\n        return userId;\n      } finally {\n        // Stop loading\n        setLoadingUsers((prev) => {\n          const newSet = new Set(prev);\n          newSet.delete(userId);\n          return newSet;\n        });\n      }\n    },\n    [userCache, loadingUsers]\n  );\n\n  return {\n    resolveUserId,\n    isLoading: (userId: string) => loadingUsers.has(userId)\n  };\n};\n\nexport interface SmartTextSearchInputProps {\n  onSearch: (searchText: string) => void;\n  onAddFilter?: (filter: Filter<PostFilters>) => void;\n  onAddFilters?: (filters: Filter<PostFilters>[]) => void;\n  onRemoveFilter?: (name: PostFilters, value?: any) => void;\n  onFilterSuccess?: () => void;\n  onClearFilters?: () => void;\n  contextId: string; // Required for filter state management\n  placeholder?: string;\n  minLength?: number;\n  className?: string;\n  // Combined replies filter\n  showRepliesFilter?: boolean;\n  includeThreadReplies?: boolean;\n  onlyReplies?: boolean;\n  onToggleThreadReplies?: (checked: boolean) => void;\n  onToggleOnlyReplies?: (checked: boolean) => void;\n  isLoading?: boolean;\n}\n\nexport const SmartTextSearchInput: React.FC<SmartTextSearchInputProps> = ({\n  onSearch,\n  onAddFilter,\n  onAddFilters,\n  onRemoveFilter,\n  onFilterSuccess,\n  onClearFilters,\n  contextId,\n  placeholder = 'Search posts content... (or use @user #tag for filters)',\n  minLength = 2,\n  className = '',\n  showRepliesFilter = false,\n  includeThreadReplies = false,\n  onlyReplies = false,\n  onToggleThreadReplies,\n  onToggleOnlyReplies,\n  isLoading = false\n}) => {\n  // Read filter state from Jotai\n  const [filtersState] = useAtom(getSubmissionsFiltersAtom(contextId));\n\n  // User resolution hook\n  const { resolveUserId } = useUserResolution();\n\n  // Construct input value from current filter state\n  const constructedValue = useMemo(() => {\n    const filterParts: string[] = [];\n\n    // Add tag filters as hashtags (each tag is now a separate filter entry)\n    filtersState.filters\n      .filter((f: Filter) => f.name === 'tags')\n      .forEach((f: Filter) => {\n        if (typeof f.value === 'string') {\n          const tag = f.value.trim();\n          if (tag && !tag.startsWith('#')) {\n            filterParts.push(`#${tag}`);\n          } else if (tag) {\n            filterParts.push(tag);\n          }\n        }\n      });\n\n    // Add author filters as mentions (with async username resolution)\n    filtersState.filters\n      .filter((f: Filter) => f.name === 'author')\n      .forEach((f: Filter) => {\n        // Author filters now only store user ID, so we need to resolve username\n        // Use the user ID as placeholder, will be resolved below\n        filterParts.push(`@[${f.value}|${f.value}|author]`);\n      });\n\n    // Add mentions filters\n    filtersState.filters\n      .filter((f: Filter) => f.name === 'mentions')\n      .forEach((f: Filter) => {\n        // Check if the value contains both username and user ID (username|userId format)\n        if (f.value.includes('|')) {\n          const [username, userId] = f.value.split('|');\n          filterParts.push(`@[${username}|${userId}|mentions]`);\n        } else {\n          // Legacy format - just username, use username for both\n          filterParts.push(`@[${f.value}|${f.value}|mentions]`);\n        }\n      });\n\n    // Add search text at the end, ensuring proper spacing\n    const searchFilter = filtersState.filters.find(\n      (f: Filter) => f.name === 'search'\n    );\n    if (searchFilter?.value) {\n      // Parse search text to identify quoted phrases and individual words\n      const searchText = searchFilter.value;\n      const searchParts: string[] = [];\n\n      // Regex to match quoted phrases and individual words\n      const searchRegex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n      let match;\n\n      while ((match = searchRegex.exec(searchText)) !== null) {\n        const quotedText = match[1]; // Captured quoted content\n        const unquotedText = match[2]; // Captured unquoted content\n\n        if (quotedText) {\n          // Quoted phrase - treat as atomic pill\n          searchParts.push(`\\\"${quotedText}\\\"`);\n        } else if (unquotedText) {\n          // Individual word\n          searchParts.push(unquotedText);\n        }\n      }\n\n      // Add search parts to filterParts\n      if (searchParts.length > 0) {\n        // Ensure search text is separated from pills with a space\n        if (filterParts.length > 0) {\n          filterParts.push(''); // This will create a space when joined\n        }\n        filterParts.push(...searchParts);\n      }\n    }\n\n    const result = filterParts.join(' ').replace(/\\\\s+/g, ' ').trim();\n    logger.debug('SmartTextSearchInput constructedValue', {\n      filters: filtersState.filters,\n      filterParts,\n      result\n    });\n    return result;\n  }, [filtersState.filters]);\n\n  // Resolve usernames for legacy user ID filters\n  const [resolvedValue, setResolvedValue] = useState(constructedValue);\n\n  useEffect(() => {\n    const resolveUsernames = async () => {\n      let updatedValue = constructedValue;\n\n      // Find all user ID-only mentions that need resolution\n      const userIdOnlyRegex = /@\\\\[(\\\\d+)\\\\|(\\\\d+)\\\\|(author|mentions)\\\\]/g;\n      const matches = [...constructedValue.matchAll(userIdOnlyRegex)];\n\n      for (const match of matches) {\n        const [fullMatch, displayUserId, filterUserId, filterType] = match;\n\n        // Only resolve if display and filter user IDs are the same (indicating legacy format)\n        if (displayUserId === filterUserId) {\n          try {\n            const username = await resolveUserId(displayUserId);\n            if (username !== displayUserId) {\n              // Replace with resolved username\n              const resolvedMention = `@[${username}|${filterUserId}|${filterType}]`;\n              updatedValue = updatedValue.replace(fullMatch, resolvedMention);\n            }\n          } catch (error) {\n            logger.error(\n              'Failed to resolve username for user ID',\n              error as Error,\n              {\n                userId: displayUserId\n              }\n            );\n          }\n        }\n      }\n\n      if (updatedValue !== resolvedValue) {\n        setResolvedValue(updatedValue);\n      }\n    };\n\n    resolveUsernames();\n  }, [constructedValue, resolveUserId, resolvedValue]);\n\n  // Handle input value changes and parse filters\n  const handleInputChange = useCallback(\n    (value: string) => {\n      // Parse filters from the input\n      const filters: Filter<PostFilters>[] = [];\n      const filtersToRemove: { name: PostFilters; value?: any }[] = [];\n      let remainingText = value;\n\n      // Extract hashtags\n      const hashtagRegex = /#(\\\\w+)/g;\n      const hashtags: string[] = [];\n      let hashtagMatch;\n      while ((hashtagMatch = hashtagRegex.exec(value)) !== null) {\n        hashtags.push(hashtagMatch[1]);\n        remainingText = remainingText.replace(hashtagMatch[0], '').trim();\n      }\n\n      if (hashtags.length > 0) {\n        // Remove existing tags filter\n        filtersToRemove.push({ name: 'tags' });\n        // Add individual tag filter entries (new system)\n        hashtags.forEach((tag) => {\n          filters.push({\n            name: 'tags',\n            value: `#${tag}`\n          });\n        });\n      } else {\n        // No hashtags found, remove tags filter\n        filtersToRemove.push({ name: 'tags' });\n      }\n\n      // Extract user mentions\n      const mentionRegex = /@\\\\[([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\]/g;\n      let mentionMatch;\n      const processedUsers = new Set<string>();\n\n      while ((mentionMatch = mentionRegex.exec(value)) !== null) {\n        const [fullMatch, username, userId, filterType] = mentionMatch;\n        const userKey = `${userId}-${filterType}`;\n\n        if (!processedUsers.has(userKey)) {\n          processedUsers.add(userKey);\n\n          // Remove existing filters for this user (using both possible formats)\n          filtersToRemove.push({ name: 'author', value: userId });\n          filtersToRemove.push({\n            name: 'author',\n            value: `${username}|${userId}`\n          });\n          filtersToRemove.push({ name: 'mentions', value: username });\n          filtersToRemove.push({\n            name: 'mentions',\n            value: `${username}|${userId}`\n          });\n\n          // Add new filter with appropriate format based on filter type\n          if (filterType === 'author') {\n            // For author filters, backend expects just the user ID\n            filters.push({\n              name: filterType,\n              value: userId\n            });\n          } else if (filterType === 'mentions') {\n            // For mentions filters, store combined format for display\n            filters.push({\n              name: filterType,\n              value: `${username}|${userId}`\n            });\n          }\n        }\n\n        remainingText = remainingText.replace(fullMatch, '').trim();\n      }\n\n      // Clean up remaining text and reconstruct search terms\n      remainingText = remainingText.replace(/\\\\s+/g, ' ').trim();\n\n      // Handle search text - reconstruct from individual terms and quoted phrases\n      if (remainingText) {\n        // The remaining text may contain individual words and quoted phrases\n        // We need to reconstruct them into a single search value\n        const searchTerms: string[] = [];\n        const searchRegex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n        let match;\n\n        while ((match = searchRegex.exec(remainingText)) !== null) {\n          const quotedText = match[1]; // Captured quoted content\n          const unquotedText = match[2]; // Captured unquoted content\n\n          if (quotedText) {\n            // Quoted phrase - keep the quotes\n            searchTerms.push(`\\\"${quotedText}\\\"`);\n          } else if (unquotedText) {\n            // Individual word\n            searchTerms.push(unquotedText);\n          }\n        }\n\n        if (searchTerms.length > 0) {\n          filters.push({ name: 'search', value: searchTerms.join(' ') });\n        }\n      } else {\n        filtersToRemove.push({ name: 'search' });\n      }\n\n      // Apply filter changes\n      if (filtersToRemove.length > 0 && onRemoveFilter) {\n        filtersToRemove.forEach(({ name, value }) => {\n          onRemoveFilter(name, value);\n        });\n      }\n\n      if (filters.length > 0) {\n        if (onAddFilters && filters.length > 1) {\n          onAddFilters(filters);\n        } else if (onAddFilter) {\n          filters.forEach((filter) => onAddFilter(filter));\n        }\n\n        if (onFilterSuccess) {\n          onFilterSuccess();\n        }\n      }\n    },\n    [onAddFilter, onAddFilters, onRemoveFilter, onFilterSuccess]\n  );\n\n  // Calculate filter category counts for enhanced search status\n  const filterCounts = useMemo(() => {\n    const counts = {\n      tags: 0,\n      authors: 0,\n      mentions: 0,\n      search: 0\n    };\n\n    filtersState.filters.forEach((filter: Filter) => {\n      switch (filter.name) {\n        case 'tags':\n          // Count individual tag filter entries (new system)\n          counts.tags++;\n          break;\n        case 'author':\n          counts.authors++;\n          break;\n        case 'mentions':\n          counts.mentions++;\n          break;\n        case 'search':\n          if (filter.value) {\n            // Count space-separated search terms\n            counts.search = filter.value\n              .trim()\n              .split(/\\\\s+/)\n              .filter((term) => term.length >= 2).length;\n          }\n          break;\n      }\n    });\n\n    return counts;\n  }, [filtersState.filters]);\n\n  // Calculate total active filters\n  const totalActiveFilters =\n    filterCounts.tags +\n    filterCounts.authors +\n    filterCounts.mentions +\n    (filterCounts.search > 0 ? 1 : 0);\n\n  // Handle mention clicks for filter type changes\n  const handleMentionClick = useCallback(\n    (mention: string, filterType?: 'author' | 'mentions') => {\n      if (!filterType || !onAddFilter || !onRemoveFilter) return;\n\n      // Parse the mention to get user info\n      const enhancedMatch = mention.match(\n        /^@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]$/\n      );\n      if (!enhancedMatch) return;\n\n      const [, username, userId] = enhancedMatch;\n\n      // Remove existing filters for this user (using both possible formats)\n      onRemoveFilter('author', userId);\n      onRemoveFilter('author', `${username}|${userId}`);\n      onRemoveFilter('mentions', username);\n      onRemoveFilter('mentions', `${username}|${userId}`);\n\n      // Add new filter with appropriate format based on filter type\n      if (filterType === 'author') {\n        // For author filters, backend expects just the user ID\n        onAddFilter({\n          name: filterType,\n          value: userId\n        });\n      } else if (filterType === 'mentions') {\n        // For mentions filters, store combined format for display\n        onAddFilter({\n          name: filterType,\n          value: `${username}|${userId}`\n        });\n      }\n\n      if (onFilterSuccess) {\n        onFilterSuccess();\n      }\n\n      logger.debug('Mention filter type changed', {\n        username,\n        userId,\n        newFilterType: filterType,\n        filterValue: `${username}|${userId}`\n      });\n    },\n    [onAddFilter, onRemoveFilter, onFilterSuccess]\n  );\n\n  // Handle pill clicks for removal\n  const handlePillClick = useCallback(\n    (pillText: string) => {\n      if (!onRemoveFilter) return;\n\n      // Parse the pill to determine what filter to remove\n      if (pillText.startsWith('#')) {\n        // Remove specific tag filter entry (new system)\n        const tag = pillText.substring(1);\n        // Remove the specific tag filter entry by its exact value\n        onRemoveFilter('tags', `#${tag}`);\n      } else if (pillText.startsWith('@')) {\n        // Parse mention format to determine removal\n        const enhancedMatch = pillText.match(\n          /^@\\\\[([^|]+)\\\\|([^|]+)\\\\|([^|]+)\\\\]$/\n        );\n        if (enhancedMatch) {\n          const [, username, userId, filterType] = enhancedMatch;\n          if (filterType === 'author') {\n            // For author filters, remove by user ID only\n            onRemoveFilter('author', userId);\n          } else if (filterType === 'mentions') {\n            // For mentions filters, remove by combined format\n            onRemoveFilter('mentions', `${username}|${userId}`);\n          }\n        }\n      }\n\n      if (onFilterSuccess) {\n        onFilterSuccess();\n      }\n    },\n    [filtersState.filters, onRemoveFilter, onAddFilter, onFilterSuccess]\n  );\n\n  return (\n    <TextSearchInput\n      onSearch={onSearch}\n      contextId={contextId}\n      placeholder={placeholder}\n      minLength={minLength}\n      className={className}\n      value={resolvedValue}\n      onChange={handleInputChange}\n      showRepliesFilter={showRepliesFilter}\n      includeThreadReplies={includeThreadReplies}\n      onlyReplies={onlyReplies}\n      onToggleThreadReplies={onToggleThreadReplies}\n      onToggleOnlyReplies={onToggleOnlyReplies}\n      isLoading={isLoading}\n      enableSmartInput={true}\n      onMentionClick={handleMentionClick}\n      onPillClick={handlePillClick}\n      onAddFilter={onAddFilter}\n      onAddFilters={onAddFilters}\n      onRemoveFilter={onRemoveFilter}\n      onFilterSuccess={onFilterSuccess}\n      onClearFilters={onClearFilters}\n      // Enhanced filter information\n      filterCounts={filterCounts}\n      totalActiveFilters={totalActiveFilters}\n    />\n  );\n};\n",
    "language":"typescript",
    "lines":546,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/TextSearchInput.test.tsx":{
    "content":"// Skip this test due to ES module issues\n// The component works correctly in the application, but Jest has trouble\n// with the ES module imports from next-auth and related dependencies\ndescribe.skip('TextSearchInput', () => {\n  it('is skipped due to ES module issues', () => {\n    // This test is skipped because the TextSearchInput component\n    // has dependencies that lead to next-auth ES modules which\n    // cause Jest parsing issues. The component works correctly\n    // in the actual application.\n    expect(true).toBe(true);\n  });\n});\n",
    "language":"typescript",
    "lines":13,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/card/Card.tsx":{
    "content":"import React from 'react';\nimport { CARD_SELECTORS } from 'src/lib/test-selectors/components/card.selectors';\nimport './Card.css';\n\nexport type CardPropsWidth = 'full' | 'lg' | 'md' | 'sm' | 'min';\n\nexport const Card: React.FC<{\n  children: React.ReactNode;\n  className?: string;\n  width?: CardPropsWidth;\n  height?: number; // TODO: deprecate with introduction of a maintainable alternative\n}> = ({ children, className, width = 'md', height }) => {\n  return (\n    <div\n      className={`card ${width}${className ? ` ${className}` : ''}`}\n      style={height ? { height: `${height}rem` } : undefined}\n      data-testid={CARD_SELECTORS.CONTAINER}\n    >\n      {children}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":23,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/card/Card.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport { CARD_SELECTORS } from 'src/lib/test-selectors/components/card.selectors';\nimport { Card } from './Card';\n\ndescribe('Card Component', () => {\n  it('renders children correctly', () => {\n    const { getByText, getByTestId } = render(<Card>Test Content</Card>);\n    expect(getByText('Test Content')).toBeInTheDocument();\n    expect(getByTestId(CARD_SELECTORS.CONTAINER)).toBeInTheDocument();\n  });\n\n  it('applies default width class', () => {\n    const { getByTestId } = render(<Card>Test Content</Card>);\n    expect(getByTestId(CARD_SELECTORS.CONTAINER)).toHaveClass('card md');\n  });\n\n  it('applies custom width class', () => {\n    const { getByTestId } = render(<Card width=\\\"lg\\\">Test Content</Card>);\n    expect(getByTestId(CARD_SELECTORS.CONTAINER)).toHaveClass('card lg');\n  });\n\n  it('applies custom className', () => {\n    const { getByTestId } = render(\n      <Card className=\\\"custom-class\\\">Test Content</Card>\n    );\n    expect(getByTestId(CARD_SELECTORS.CONTAINER)).toHaveClass(\n      'card md custom-class'\n    );\n  });\n\n  it('applies height style when height is provided', () => {\n    const { getByTestId } = render(<Card height={10}>Test Content</Card>);\n    expect(getByTestId(CARD_SELECTORS.CONTAINER)).toHaveStyle('height: 10rem');\n  });\n\n  it('does not apply height style when height is not provided', () => {\n    const { getByTestId } = render(<Card>Test Content</Card>);\n    expect(getByTestId(CARD_SELECTORS.CONTAINER)).not.toHaveStyle(\n      'height: 10rem'\n    );\n  });\n});\n",
    "language":"typescript",
    "lines":43,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/avatar/Avatar.test.tsx":{
    "content":"import '@testing-library/jest-dom';\nimport { render, screen } from '@testing-library/react';\nimport { useAtom } from 'jotai';\nimport { Avatar } from './Avatar';\n\n// Mock the avatar cache atom\nconst mockAvatarCache = {};\nconst mockSetAvatarCache = jest.fn();\n\njest.mock('jotai', () => ({\n  useAtom: jest.fn(),\n  atom: jest.fn()\n}));\n\n// Mock @dicebear/core\njest.mock('@dicebear/core', () => ({\n  createAvatar: jest.fn().mockReturnValue({\n    toDataUri: jest.fn().mockReturnValue('data:image/svg+xml;base64,mock')\n  })\n}));\n\n// Mock @dicebear/collection\njest.mock('@dicebear/collection', () => ({\n  adventurer: {\n    create: jest.fn().mockReturnValue({\n      toDataUriSync: jest.fn().mockReturnValue('data:image/svg+xml;base64,mock')\n    })\n  }\n}));\n\ndescribe('Avatar', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (useAtom as jest.Mock).mockReturnValue([\n      mockAvatarCache,\n      mockSetAvatarCache\n    ]);\n  });\n\n  it('renders loading state when avatar is not ready', () => {\n    // Mock createAvatar to return null to simulate loading state\n    const { createAvatar } = require('@dicebear/core');\n    (createAvatar as jest.Mock).mockReturnValueOnce({\n      toDataUri: jest.fn().mockReturnValue(null)\n    });\n\n    render(<Avatar />);\n    expect(screen.getByTestId('avatar-loading')).toBeInTheDocument();\n    expect(screen.getByTestId('avatar-loading')).toHaveClass('avatar--loading');\n  });\n\n  it('renders avatar image when ready', () => {\n    render(<Avatar seed=\\\"test-seed\\\" />);\n    const avatarDiv = screen.getByTestId('avatar');\n    const img = avatarDiv.querySelector('img');\n    expect(img).toHaveClass('avatar__img', 'md');\n    expect(avatarDiv).toHaveClass('avatar', 'md');\n  });\n\n  it('applies correct size class', () => {\n    render(<Avatar seed=\\\"test-seed\\\" size=\\\"lg\\\" />);\n    const avatarDiv = screen.getByTestId('avatar');\n    const img = avatarDiv.querySelector('img');\n    expect(img).toHaveClass('avatar__img', 'lg');\n    expect(avatarDiv).toHaveClass('avatar', 'lg');\n  });\n});\n",
    "language":"typescript",
    "lines":68,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/avatar/Avatar.tsx":{
    "content":"'use client';\n\nimport { adventurer } from '@dicebear/collection';\nimport { createAvatar } from '@dicebear/core';\nimport { useAtom } from 'jotai';\nimport { memo, useCallback, useEffect, useMemo, useState } from 'react';\nimport { avatarCacheAtom } from '../../../lib/state/atoms';\nimport { InteractiveTooltip } from '../tooltip/InteractiveTooltip';\nimport './Avatar.css';\n\nexport type AvatarPropSizes = 'full' | 'lg' | 'md' | 'sm' | 'xs' | 'xxs';\n\n// Generate a stable fallback seed once per component instance\nconst generateStableFallbackSeed = () =>\n  `fallback-${Math.random().toString(36).substring(2, 15)}`;\n\nconst Avatar = memo(\n  ({\n    seed,\n    size = 'md',\n    enableTooltip = false,\n    tooltipScale = 2\n  }: {\n    seed?: string;\n    size?: AvatarPropSizes;\n    enableTooltip?: boolean;\n    tooltipScale?: 2 | 3 | 4;\n  }) => {\n    const [avatarCache, setAvatarCache] = useAtom(avatarCacheAtom);\n\n    // Create a stable seed that only changes when the seed prop changes\n    const stableSeed = useMemo(() => {\n      return seed || generateStableFallbackSeed();\n    }, [seed]);\n\n    // Check if we have a cached avatar\n    const cachedAvatar = avatarCache[stableSeed];\n\n    // Generate avatar using useMemo to prevent regeneration on every render\n    const avatarDataUri = useMemo(() => {\n      if (cachedAvatar) {\n        return cachedAvatar;\n      }\n\n      try {\n        const avatar = createAvatar(adventurer, {\n          seed: stableSeed\n        });\n        return avatar.toDataUri();\n      } catch (error) {\n        console.error('Failed to generate avatar:', error);\n        return null;\n      }\n    }, [stableSeed, cachedAvatar]);\n\n    // Cache the generated avatar\n    const cacheAvatar = useCallback(() => {\n      if (avatarDataUri && !avatarCache[stableSeed]) {\n        try {\n          setAvatarCache((prev: Record<string, string>) => ({\n            ...prev,\n            [stableSeed]: avatarDataUri\n          }));\n        } catch (error) {\n          // Gracefully handle cache storage failures\n          console.warn(\n            'Failed to cache avatar, continuing without cache:',\n            error\n          );\n        }\n      }\n    }, [avatarDataUri, stableSeed, avatarCache, setAvatarCache]);\n\n    // Cache the avatar when it's generated\n    useEffect(() => {\n      cacheAvatar();\n    }, [cacheAvatar]);\n\n    const [showTooltip, setShowTooltip] = useState(false);\n    const [position, setPosition] = useState({ top: 0, left: 0 });\n\n    const handleMouseEnter = useCallback(\n      (e: React.MouseEvent) => {\n        if (!enableTooltip) return;\n\n        const rect = e.currentTarget.getBoundingClientRect();\n        setPosition({\n          top: rect.top + window.scrollY,\n          left: rect.left + window.scrollX + rect.width / 2\n        });\n        setShowTooltip(true);\n      },\n      [enableTooltip]\n    );\n\n    const handleMouseLeave = useCallback(() => {\n      if (!enableTooltip) return;\n      setShowTooltip(false);\n    }, [enableTooltip]);\n\n    if (!avatarDataUri) {\n      return (\n        <div\n          className={`avatar ${size} avatar--loading`}\n          data-testid=\\\"avatar-loading\\\"\n        >\n          <div className=\\\"avatar__placeholder\\\" />\n        </div>\n      );\n    }\n\n    const avatarElement = (\n      <div\n        className={`avatar ${size}`}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        data-testid=\\\"avatar\\\"\n      >\n        <img\n          src={avatarDataUri}\n          className={`avatar__img ${size}`}\n          alt=\\\"Avatar\\\"\n          style={{\n            opacity: 1,\n            transition: 'opacity 0.2s ease'\n          }}\n        />\n      </div>\n    );\n\n    if (enableTooltip) {\n      return (\n        <InteractiveTooltip\n          content={\n            <div\n              className={`avatar ${size === 'xs' ? 'lg' : size === 'xxs' ? 'lg' : 'full'}`}\n              style={{ transform: `scale(${tooltipScale})` }}\n            >\n              <img\n                src={avatarDataUri}\n                className={`avatar__img ${size === 'xs' ? 'lg' : size === 'xxs' ? 'lg' : 'full'}`}\n                alt=\\\"Avatar (enlarged)\\\"\n              />\n            </div>\n          }\n        >\n          {avatarElement}\n        </InteractiveTooltip>\n      );\n    }\n\n    return avatarElement;\n  }\n);\n\nAvatar.displayName = 'Avatar';\n\nexport { Avatar };\n",
    "language":"typescript",
    "lines":159,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/URLPill.tsx":{
    "content":"'use client';\n\nimport { getMediaType } from '../../../lib/config/media-domains';\nimport { getURLPillType, shouldEmbedURL } from '../../../lib/config/url-pills';\nimport { useOverlay } from '../../../lib/context/OverlayContext';\nimport { ImageEmbed } from './ImageEmbed';\nimport './URLPill.css';\nimport { YouTubeEmbed } from './YouTubeEmbed';\nimport { YouTubeModal } from './YouTubeModal';\n\ninterface URLPillProps {\n  url: string;\n  behavior?: 'embed' | 'link' | 'modal';\n  width?: 'small' | 'medium' | 'large' | 'full';\n  customId?: string;\n  className?: string;\n  isEditMode?: boolean;\n  onWidthChange?: (newWidth: 'small' | 'medium' | 'large' | 'full') => void;\n  onModeChange?: (newMode: 'embed' | 'link' | 'modal') => void;\n  onBehaviorChange?: (oldContent: string, newContent: string) => void;\n  onRemove?: () => void;\n}\n\nexport function URLPill({\n  url,\n  behavior,\n  width = 'medium',\n  customId,\n  className = '',\n  isEditMode,\n  onWidthChange,\n  onModeChange,\n  onBehaviorChange,\n  onRemove\n}: URLPillProps) {\n  const { openOverlay, closeOverlay } = useOverlay();\n\n  // Validate URL prop\n  if (!url || typeof url !== 'string') {\n    console.warn('URLPill: Invalid or missing URL prop:', url);\n    return (\n      <span className={`url-pill url-pill--invalid ${className}`}>\n        Invalid URL\n      </span>\n    );\n  }\n\n  // Determine the media type and behavior\n  const mediaType = getMediaType(url);\n  const pillType = getURLPillType(url);\n\n  // Handle temporary images specially\n  if (url.startsWith('data:temp-image;')) {\n    return (\n      <ImageEmbed\n        src={url}\n        width={width}\n        mode=\\\"embed\\\"\n        className={`url-pill temp-image-pill ${className}`}\n        isTemporary={true}\n        isEditMode={isEditMode}\n        onWidthChange={onWidthChange}\n        onModeChange={onModeChange}\n        onRemove={onRemove}\n      />\n    );\n  }\n\n  // Handle different behaviors\n  if (behavior === 'modal' && mediaType === 'youtube') {\n    // Modal behavior for YouTube - render as clickable link that opens modal\n    const domain = new URL(url).hostname.replace('www.', '');\n\n    const handleModalClick = (e: React.MouseEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const modalId = `youtube-modal-${url}`;\n\n      openOverlay({\n        id: modalId,\n        type: 'modal',\n        component: YouTubeModal,\n        props: {\n          url,\n          title: customId || 'YouTube Video',\n          onClose: () => closeOverlay(modalId)\n        }\n      });\n    };\n\n    return (\n      <div\n        className={`url-pill url-pill--modal ${className} url-pill--youtube-com`}\n      >\n        <a href=\\\"#\\\" className=\\\"url-pill__link\\\" onClick={handleModalClick}>\n          <span className=\\\"url-pill__icon\\\">\ud83d\udcfa</span>\n          <span className=\\\"url-pill__domain\\\">{domain}</span>\n          <span className=\\\"url-pill__behavior-icon\\\">\u29c9</span>\n        </a>\n\n        {isEditMode && (onModeChange || onWidthChange) && (\n          <div className=\\\"url-pill__behavior-toggles\\\">\n            {onModeChange && (\n              <>\n                <button\n                  type=\\\"button\\\"\n                  className=\\\"url-pill__behavior-toggle url-pill__behavior-toggle--embed\\\"\n                  onClick={() => onModeChange('embed')}\n                  title=\\\"Show as embed\\\"\n                >\n                  \ud83d\udcfa Embed\n                </button>\n                <button\n                  type=\\\"button\\\"\n                  className=\\\"url-pill__behavior-toggle url-pill__behavior-toggle--link\\\"\n                  onClick={() => onModeChange('link')}\n                  title=\\\"Show as link\\\"\n                >\n                  \ud83d\udd17 Link\n                </button>\n                <button\n                  type=\\\"button\\\"\n                  className=\\\"url-pill__behavior-toggle url-pill__behavior-toggle--modal url-pill__behavior-toggle--active\\\"\n                  onClick={() => onModeChange('modal')}\n                  title=\\\"Show in modal\\\"\n                >\n                  \u29c9 Modal\n                </button>\n              </>\n            )}\n\n            {onWidthChange && (\n              <div className=\\\"url-pill__width-note\\\">\n                Width controls available in embed mode\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  if (behavior === 'embed' || (behavior === undefined && shouldEmbedURL(url))) {\n    // Embed behavior\n    switch (mediaType) {\n      case 'youtube':\n        if (isEditMode && (onModeChange || onWidthChange)) {\n          // In edit mode, wrap YouTube embed with controls\n          return (\n            <div className={`url-pill youtube-pill-wrapper ${className}`}>\n              <YouTubeEmbed\n                url={url}\n                width={\n                  width === 'small'\n                    ? 'S'\n                    : width === 'medium'\n                      ? 'M'\n                      : width === 'large'\n                        ? 'L'\n                        : width === 'full'\n                          ? 'F'\n                          : 'M'\n                }\n                className=\\\"url-pill youtube-pill\\\"\n                title={customId || 'YouTube video'}\n              />\n              <div className=\\\"url-pill__behavior-toggles\\\">\n                {onModeChange && (\n                  <>\n                    <button\n                      type=\\\"button\\\"\n                      className={`url-pill__behavior-toggle url-pill__behavior-toggle--embed ${\n                        behavior === 'embed' || behavior === undefined\n                          ? 'url-pill__behavior-toggle--active'\n                          : ''\n                      }`}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onModeChange('embed');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Embed video player\\\"\n                    >\n                      \ud83d\udcfa\n                    </button>\n                    <button\n                      type=\\\"button\\\"\n                      className=\\\"url-pill__behavior-toggle url-pill__behavior-toggle--link\\\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onModeChange('link');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Show as clickable link\\\"\n                    >\n                      \ud83d\udd17\n                    </button>\n                    <button\n                      type=\\\"button\\\"\n                      className=\\\"url-pill__behavior-toggle url-pill__behavior-toggle--modal\\\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onModeChange('modal');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Open in modal popup\\\"\n                    >\n                      \u29c9\n                    </button>\n                  </>\n                )}\n\n                {onWidthChange && (\n                  <div className=\\\"url-pill__width-controls\\\">\n                    <button\n                      type=\\\"button\\\"\n                      className={`url-pill__behavior-toggle ${\n                        width === 'small'\n                          ? 'url-pill__behavior-toggle--active'\n                          : ''\n                      }`}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onWidthChange('small');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Small size (320px)\\\"\n                    >\n                      \ud83d\udcf1\n                    </button>\n                    <button\n                      type=\\\"button\\\"\n                      className={`url-pill__behavior-toggle ${\n                        width === 'medium'\n                          ? 'url-pill__behavior-toggle--active'\n                          : ''\n                      }`}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onWidthChange('medium');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Medium size (560px)\\\"\n                    >\n                      \ud83d\udcbb\n                    </button>\n                    <button\n                      type=\\\"button\\\"\n                      className={`url-pill__behavior-toggle ${\n                        width === 'large'\n                          ? 'url-pill__behavior-toggle--active'\n                          : ''\n                      }`}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onWidthChange('large');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Large size (800px)\\\"\n                    >\n                      \ud83d\udda5\ufe0f\n                    </button>\n                    <button\n                      type=\\\"button\\\"\n                      className={`url-pill__behavior-toggle ${\n                        width === 'full'\n                          ? 'url-pill__behavior-toggle--active'\n                          : ''\n                      }`}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onWidthChange('full');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Full width (100%)\\\"\n                    >\n                      \ud83d\udcfa\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n          );\n        } else {\n          // Normal mode, just render the embed\n          return (\n            <YouTubeEmbed\n              url={url}\n              width={\n                width === 'small'\n                  ? 'S'\n                  : width === 'medium'\n                    ? 'M'\n                    : width === 'large'\n                      ? 'L'\n                      : width === 'full'\n                        ? 'F'\n                        : 'M'\n              }\n              className={`url-pill youtube-pill ${className}`}\n              title={customId || 'YouTube video'}\n            />\n          );\n        }\n\n      case 'image':\n        return (\n          <ImageEmbed\n            src={url}\n            width={width}\n            mode=\\\"embed\\\"\n            className={`url-pill image-pill ${className}`}\n            isEditMode={isEditMode}\n            onWidthChange={onWidthChange}\n            onModeChange={onModeChange}\n            onRemove={onRemove}\n          />\n        );\n\n      default:\n        // Unknown media type - render as enhanced link pill with controls\n        return (\n          <div className={`url-pill url-pill--unknown ${className}`}>\n            <a\n              href={url}\n              target=\\\"_blank\\\"\n              rel=\\\"noopener noreferrer\\\"\n              className=\\\"url-pill__link\\\"\n            >\n              <span className=\\\"url-pill__icon\\\">\ud83d\udd17</span>\n              <span className=\\\"url-pill__domain\\\">\n                {new URL(url).hostname.replace('www.', '')}\n              </span>\n            </a>\n\n            {isEditMode && (onModeChange || onWidthChange) && (\n              <div className=\\\"url-pill__behavior-toggles\\\">\n                {onModeChange && (\n                  <>\n                    <button\n                      type=\\\"button\\\"\n                      className={`url-pill__behavior-toggle url-pill__behavior-toggle--embed ${\n                        behavior === 'embed' || behavior === undefined\n                          ? 'url-pill__behavior-toggle--active'\n                          : ''\n                      }`}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onModeChange('embed');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Show as embed\\\"\n                    >\n                      E\n                    </button>\n                    <button\n                      type=\\\"button\\\"\n                      className=\\\"url-pill__behavior-toggle url-pill__behavior-toggle--link\\\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onModeChange('link');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Show as link\\\"\n                    >\n                      L\n                    </button>\n                    <button\n                      type=\\\"button\\\"\n                      className=\\\"url-pill__behavior-toggle url-pill__behavior-toggle--modal\\\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        onModeChange('modal');\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      title=\\\"Show in modal\\\"\n                    >\n                      M\n                    </button>\n                  </>\n                )}\n              </div>\n            )}\n          </div>\n        );\n    }\n  }\n\n  // Render as enhanced link pill with domain info (for 'link', 'modal', or other behaviors)\n  const domain = new URL(url).hostname.replace('www.', '');\n  const isYouTube = domain.includes('youtube') || domain.includes('youtu.be');\n  const isImage = /\\\\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|avif|tiff|tif)$/i.test(\n    url\n  );\n  const isVideo = /\\\\.(mp4|webm|ogg|avi|mov|wmv|flv|m4v|mkv|3gp|ogv)$/i.test(\n    url\n  );\n\n  // Handle link click - open modal for modal behavior, otherwise normal link\n  const handleLinkClick = (e: React.MouseEvent) => {\n    if (behavior === 'modal' && isYouTube) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const modalId = `youtube-modal-${url}`;\n\n      openOverlay({\n        id: modalId,\n        type: 'modal',\n        component: YouTubeModal,\n        props: {\n          url,\n          title: customId || 'YouTube Video',\n          onClose: () => closeOverlay(modalId)\n        }\n      });\n    }\n    // For non-modal behavior, let the link work normally\n  };\n\n  return (\n    <div\n      className={`url-pill url-pill--link ${className} ${\n        isYouTube ? 'url-pill--youtube-com' : ''\n      }`}\n    >\n      <a\n        href={behavior === 'modal' ? '#' : url}\n        target={behavior === 'modal' ? undefined : '_blank'}\n        rel={behavior === 'modal' ? undefined : 'noopener noreferrer'}\n        className=\\\"url-pill__link\\\"\n        onClick={handleLinkClick}\n      >\n        <span className=\\\"url-pill__icon\\\">\n          {isYouTube ? '\ud83d\udcfa' : isImage ? '\ud83d\uddbc\ufe0f' : isVideo ? '\ud83c\udfa5' : '\ud83d\udd17'}\n        </span>\n        <span className=\\\"url-pill__domain\\\">{domain}</span>\n        {behavior && (\n          <span className=\\\"url-pill__behavior-icon\\\">\n            {behavior === 'modal' ? '\u29c9' : '\u2197'}\n          </span>\n        )}\n      </a>\n\n      {isEditMode && (onModeChange || onWidthChange) && (\n        <div className=\\\"url-pill__behavior-toggles\\\">\n          {onModeChange && (\n            <>\n              <button\n                type=\\\"button\\\"\n                className={`url-pill__behavior-toggle url-pill__behavior-toggle--embed`}\n                onClick={() => onModeChange('embed')}\n                title=\\\"Show as embed\\\"\n              >\n                \ud83d\udcfa Embed\n              </button>\n              <button\n                type=\\\"button\\\"\n                className={`url-pill__behavior-toggle url-pill__behavior-toggle--link ${\n                  behavior === 'link' ? 'url-pill__behavior-toggle--active' : ''\n                }`}\n                onClick={() => onModeChange('link')}\n                title=\\\"Show as link\\\"\n              >\n                \ud83d\udd17 Link\n              </button>\n              {isYouTube && (\n                <button\n                  type=\\\"button\\\"\n                  className={`url-pill__behavior-toggle url-pill__behavior-toggle--modal ${\n                    behavior === 'modal'\n                      ? 'url-pill__behavior-toggle--active'\n                      : ''\n                  }`}\n                  onClick={() => onModeChange('modal')}\n                  title=\\\"Show in modal\\\"\n                >\n                  \u29c9 Modal\n                </button>\n              )}\n            </>\n          )}\n\n          {onWidthChange && (\n            <div className=\\\"url-pill__width-note\\\">\n              Width controls available in embed mode\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":535,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/FooterBadge.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport './FooterBadge.css';\n\nexport interface FooterBadgeProps {\n  /** Text to show when expanded */\n  text: string;\n  /** Icon or content to show in collapsed state */\n  icon?: React.ReactNode;\n  /** Click handler */\n  onClick?: () => void;\n  /** Position from right edge in pixels */\n  rightOffset?: number;\n  /** Position from bottom edge in pixels */\n  bottomOffset?: number;\n  /** Badge color theme */\n  theme?: 'primary' | 'secondary' | 'success' | 'warning' | 'danger';\n  /** Custom CSS class */\n  className?: string;\n  /** Disabled state */\n  disabled?: boolean;\n  /** Hover proximity distance in pixels */\n  hoverDistance?: number;\n}\n\nexport const FooterBadge: React.FC<FooterBadgeProps> = ({\n  text,\n  icon = '+',\n  onClick,\n  rightOffset = 20,\n  bottomOffset = 4,\n  theme = 'primary',\n  className = '',\n  disabled = false,\n  hoverDistance = 80\n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\n  const badgeRef = useRef<HTMLButtonElement>(null);\n\n  useEffect(() => {\n    const handleMouseMove = (e: MouseEvent) => {\n      setMousePosition({ x: e.clientX, y: e.clientY });\n\n      if (badgeRef.current && !disabled) {\n        const rect = badgeRef.current.getBoundingClientRect();\n        const badgeCenter = {\n          x: rect.left + rect.width / 2,\n          y: rect.top + rect.height / 2\n        };\n\n        const distance = Math.sqrt(\n          Math.pow(e.clientX - badgeCenter.x, 2) +\n            Math.pow(e.clientY - badgeCenter.y, 2)\n        );\n\n        setIsExpanded(distance <= hoverDistance);\n      }\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    return () => document.removeEventListener('mousemove', handleMouseMove);\n  }, [hoverDistance, disabled]);\n\n  const handleClick = () => {\n    if (!disabled && onClick) {\n      onClick();\n    }\n  };\n\n  const themeClasses = {\n    primary: 'footer-badge--primary',\n    secondary: 'footer-badge--secondary',\n    success: 'footer-badge--success',\n    warning: 'footer-badge--warning',\n    danger: 'footer-badge--danger'\n  };\n\n  const badgeContent = (\n    <div className=\\\"footer-badge__content\\\">\n      <div className=\\\"footer-badge__icon\\\">{icon}</div>\n      <div className=\\\"footer-badge__text\\\">{text}</div>\n    </div>\n  );\n\n  const baseClasses = `\n    footer-badge\n    ${themeClasses[theme]}\n    ${isExpanded ? 'footer-badge--expanded' : 'footer-badge--collapsed'}\n    ${disabled ? 'footer-badge--disabled' : ''}\n    ${className}\n  `.trim();\n\n  const baseStyles = {\n    right: rightOffset,\n    bottom: bottomOffset\n  };\n\n  return (\n    <>\n      {/* Background button - full button behind footer */}\n      <button\n        className={`${baseClasses} footer-badge--background`}\n        style={baseStyles}\n        onClick={handleClick}\n        disabled={disabled}\n        aria-label={text}\n        title={text}\n      >\n        {badgeContent}\n      </button>\n\n      {/* Clipped button - partial button in front of footer */}\n      <button\n        ref={badgeRef}\n        className={`${baseClasses} footer-badge--clipped`}\n        style={baseStyles}\n        onClick={handleClick}\n        disabled={disabled}\n        aria-label={text}\n        title={text}\n      >\n        {badgeContent}\n      </button>\n    </>\n  );\n};\n\nexport default FooterBadge;\n",
    "language":"typescript",
    "lines":131,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/ImageEmbed.tsx":{
    "content":"import React from 'react';\nimport './URLPill.css';\n\ninterface ImageEmbedProps {\n  src: string;\n  alt?: string;\n  width?: 'small' | 'medium' | 'large' | 'full';\n  mode?: 'embed' | 'link';\n  className?: string;\n  isTemporary?: boolean;\n  onRemove?: () => void;\n  onWidthChange?: (newWidth: 'small' | 'medium' | 'large' | 'full') => void;\n  onModeChange?: (newMode: 'embed' | 'link') => void;\n  isEditMode?: boolean;\n}\n\nexport function ImageEmbed({\n  src,\n  alt = 'Image',\n  width = 'medium',\n  mode = 'embed',\n  className = '',\n  isTemporary = false,\n  onRemove,\n  onWidthChange,\n  onModeChange,\n  isEditMode\n}: ImageEmbedProps) {\n  const [isLoaded, setIsLoaded] = React.useState(false);\n  const [hasError, setHasError] = React.useState(false);\n\n  // Detect if this is a video file\n  const isVideo = /\\\\.(mp4|webm|ogg|mov)(\\\\?.*)?$/i.test(src);\n\n  const handleMediaLoad = () => {\n    setIsLoaded(true);\n    setHasError(false);\n  };\n\n  const handleMediaError = () => {\n    setHasError(true);\n    setIsLoaded(false);\n  };\n\n  // Handle temporary images specially\n  let imageSrc = src;\n  if (src.startsWith('data:temp-image;')) {\n    // Extract the actual data URL from the temp format\n    const dataURLMatch = src.match(\n      /;(data:image\\\\/[^;]*;base64,[A-Za-z0-9+/=]+)/\n    );\n    if (dataURLMatch) {\n      imageSrc = dataURLMatch[1];\n    }\n  }\n\n  // Map width to CSS class - use single letter for CSS classes\n  const widthMap = {\n    small: 's',\n    medium: 'm',\n    large: 'l',\n    full: 'f'\n  };\n  const widthClass = `image-embed--${widthMap[width]}`;\n\n  return (\n    <div className={`image-embed ${widthClass} ${className}`}>\n      <div\n        className={`image-embed__image-container ${isTemporary ? 'image-embed__image-container--temp' : ''}`}\n      >\n        {/* Interactive controls - similar to YouTube embeds */}\n        {(isEditMode && (onWidthChange || onModeChange)) || onRemove ? (\n          <div className=\\\"image-embed__controls\\\">\n            {/* Remove button */}\n            {onRemove && (\n              <div className=\\\"image-embed__remove-section\\\">\n                <button\n                  className=\\\"image-embed__remove-button-inline\\\"\n                  onClick={onRemove}\n                  type=\\\"button\\\"\n                  aria-label=\\\"Remove image\\\"\n                  title=\\\"Remove image\\\"\n                >\n                  \u00d7\n                </button>\n              </div>\n            )}\n\n            {onModeChange && (\n              <div className=\\\"image-embed__mode-section\\\">\n                <span className=\\\"image-embed__controls-label\\\">Mode:</span>\n                <button\n                  className={`image-embed__mode-button ${mode === 'embed' ? 'image-embed__mode-button--active' : ''}`}\n                  onClick={() => onModeChange('embed')}\n                  title=\\\"Embed mode - show image inline\\\"\n                  type=\\\"button\\\"\n                >\n                  EMB\n                </button>\n                <button\n                  className={`image-embed__mode-button ${mode === 'link' ? 'image-embed__mode-button--active' : ''}`}\n                  onClick={() => onModeChange('link')}\n                  title=\\\"Link mode - show as clickable link\\\"\n                  type=\\\"button\\\"\n                >\n                  LNK\n                </button>\n              </div>\n            )}\n\n            {onWidthChange && (\n              <div className=\\\"image-embed__width-section\\\">\n                <span className=\\\"image-embed__controls-label\\\">Size:</span>\n                <button\n                  className={`image-embed__width-button ${width === 'small' ? 'image-embed__width-button--active' : ''}`}\n                  onClick={() => onWidthChange('small')}\n                  title=\\\"Small (400px)\\\"\n                  type=\\\"button\\\"\n                >\n                  S\n                </button>\n                <button\n                  className={`image-embed__width-button ${width === 'medium' ? 'image-embed__width-button--active' : ''}`}\n                  onClick={() => onWidthChange('medium')}\n                  title=\\\"Medium (600px)\\\"\n                  type=\\\"button\\\"\n                >\n                  M\n                </button>\n                <button\n                  className={`image-embed__width-button ${width === 'large' ? 'image-embed__width-button--active' : ''}`}\n                  onClick={() => onWidthChange('large')}\n                  title=\\\"Large (800px)\\\"\n                  type=\\\"button\\\"\n                >\n                  L\n                </button>\n                <button\n                  className={`image-embed__width-button ${width === 'full' ? 'image-embed__width-button--active' : ''}`}\n                  onClick={() => onWidthChange('full')}\n                  title=\\\"Full width\\\"\n                  type=\\\"button\\\"\n                >\n                  F\n                </button>\n              </div>\n            )}\n          </div>\n        ) : null}\n\n        {/* Temporary indicator is handled by CSS ::after pseudo-element */}\n\n        {hasError ? (\n          <div className=\\\"image-embed__error\\\">\n            <div className=\\\"image-embed__error-content\\\">\n              <div className=\\\"image-embed__error-icon\\\">\n                {isVideo ? '\ud83c\udfa5' : '\ud83d\uddbc\ufe0f'}\n              </div>\n              <div className=\\\"image-embed__error-text\\\">\n                Failed to load {isVideo ? 'video' : 'image'}\n              </div>\n              <div className=\\\"image-embed__error-url\\\">{src}</div>\n            </div>\n          </div>\n        ) : isVideo ? (\n          <video\n            src={imageSrc}\n            className={`image-embed__video ${isLoaded ? 'image-embed__video--loaded' : ''}`}\n            onLoadedData={handleMediaLoad}\n            onError={handleMediaError}\n            controls\n            loop\n            muted\n            playsInline\n            preload=\\\"metadata\\\"\n          >\n            Your browser does not support the video tag.\n          </video>\n        ) : (\n          <img\n            src={imageSrc}\n            alt={alt}\n            className={`image-embed__image ${isLoaded ? 'image-embed__image--loaded' : ''}`}\n            onLoad={handleMediaLoad}\n            onError={handleMediaError}\n            loading=\\\"lazy\\\"\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":193,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/YouTubeModal.tsx":{
    "content":"'use client';\n\nimport React from 'react';\nimport { YouTubeEmbed } from './YouTubeEmbed';\nimport './YouTubeModal.css';\n\ninterface YouTubeModalProps {\n  url: string;\n  title?: string;\n  onClose?: () => void;\n}\n\nexport const YouTubeModal: React.FC<YouTubeModalProps> = ({\n  url,\n  title,\n  onClose\n}) => {\n  const handleBackdropClick = (e: React.MouseEvent) => {\n    if (e.target === e.currentTarget && onClose) {\n      onClose();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Escape' && onClose) {\n      onClose();\n    }\n  };\n\n  React.useEffect(() => {\n    const handleEscapeKey = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && onClose) {\n        onClose();\n      }\n    };\n\n    document.addEventListener('keydown', handleEscapeKey);\n    return () => document.removeEventListener('keydown', handleEscapeKey);\n  }, [onClose]);\n\n  return (\n    <div\n      className=\\\"youtube-modal\\\"\n      onClick={handleBackdropClick}\n      onKeyDown={handleKeyDown}\n      tabIndex={-1}\n    >\n      <div className=\\\"youtube-modal__content\\\">\n        <div className=\\\"youtube-modal__header\\\">\n          <h3 className=\\\"youtube-modal__title\\\">{title || 'YouTube Video'}</h3>\n          <button\n            className=\\\"youtube-modal__close\\\"\n            onClick={onClose}\n            aria-label=\\\"Close modal\\\"\n          >\n            <svg\n              width=\\\"24\\\"\n              height=\\\"24\\\"\n              viewBox=\\\"0 0 24 24\\\"\n              fill=\\\"none\\\"\n              stroke=\\\"currentColor\\\"\n              strokeWidth=\\\"2\\\"\n              strokeLinecap=\\\"round\\\"\n              strokeLinejoin=\\\"round\\\"\n            >\n              <line x1=\\\"18\\\" y1=\\\"6\\\" x2=\\\"6\\\" y2=\\\"18\\\" />\n              <line x1=\\\"6\\\" y1=\\\"6\\\" x2=\\\"18\\\" y2=\\\"18\\\" />\n            </svg>\n          </button>\n        </div>\n        <div className=\\\"youtube-modal__video\\\">\n          <YouTubeEmbed\n            url={url}\n            width=\\\"F\\\"\n            className=\\\"youtube-modal__embed\\\"\n            title={title || 'YouTube video'}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":83,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/BackButton.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport { getStoredScrollPosition } from '../../../lib/utils/scroll-position';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'BackButton',\n    module: 'components/ui'\n  },\n  enabled: false\n});\n\ninterface BackButtonProps {\n  className?: string;\n  children?: React.ReactNode;\n  fallbackHref?: string;\n  scrollRestoreKey?: string;\n  onBack?: () => void;\n}\n\nexport function BackButton({\n  className = '',\n  children = '\u2190 Back',\n  fallbackHref = '/',\n  scrollRestoreKey,\n  onBack\n}: BackButtonProps) {\n  const router = useRouter();\n  const [canGoBack, setCanGoBack] = useState(false);\n  const [scrollPosition, setScrollPosition] = useState<any>(null);\n  const [targetHref, setTargetHref] = useState(fallbackHref);\n\n  useEffect(() => {\n    // Check if we can go back in history\n    setCanGoBack(window.history.length > 1);\n\n    // Check if we have stored scroll position and construct target URL\n    if (scrollRestoreKey) {\n      const position = getStoredScrollPosition(scrollRestoreKey);\n      setScrollPosition(position);\n\n      if (position) {\n        // Construct the target URL with pagination and filters\n        const targetPath = position.pathname || fallbackHref;\n        let targetSearch = position.searchParams || '';\n\n        // Add pagination parameters if they exist in stored position\n        if (position.currentPage && position.currentPage > 1) {\n          const urlParams = new URLSearchParams(targetSearch);\n          urlParams.set('page', position.currentPage.toString());\n          targetSearch = '?' + urlParams.toString();\n        }\n\n        const fullUrl = targetPath + targetSearch;\n        setTargetHref(fullUrl);\n      }\n    }\n  }, [scrollRestoreKey, fallbackHref]);\n\n  const handleClick = (e: React.MouseEvent<HTMLAnchorElement>) => {\n    if (onBack) {\n      e.preventDefault();\n      onBack();\n      return;\n    }\n\n    // Handle scroll restoration for navigation\n    if (scrollRestoreKey && scrollPosition) {\n      logger.debug('Preparing scroll restoration for navigation', {\n        scrollRestoreKey,\n        scrollPosition,\n        currentPage: scrollPosition.currentPage,\n        targetHref\n      });\n\n      // Store the scroll restoration info in sessionStorage for the target page\n      // This ensures PostsManager can pick it up after navigation\n      sessionStorage.setItem('restore-scroll-key', scrollRestoreKey);\n      sessionStorage.setItem(\n        'restore-scroll-position',\n        JSON.stringify(scrollPosition)\n      );\n\n      // Use router.push instead of Link to ensure proper page transition\n      // and scroll restoration context\n      e.preventDefault();\n      router.push(targetHref);\n    }\n    // For cases without scroll restoration, let Link handle navigation normally\n  };\n\n  return (\n    <Link\n      href={targetHref}\n      className={`back-button ${className}`}\n      title={\n        scrollPosition\n          ? `Back to previous page (page ${scrollPosition.currentPage || 1})`\n          : 'Go back'\n      }\n      onClick={handleClick}\n    >\n      {children}\n    </Link>\n  );\n}\n",
    "language":"typescript",
    "lines":112,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/GrammarlyCleanup.tsx":{
    "content":"'use client';\n\nimport { useEffect } from 'react';\n\n/**\n * Client-side component to clean up Grammarly extension attributes\n * that cause hydration mismatches\n */\nexport const GrammarlyCleanup = () => {\n  useEffect(() => {\n    // Clean up Grammarly extension attributes that cause hydration warnings\n    const cleanupGrammarlyAttributes = () => {\n      const body = document.body;\n      if (body) {\n        // Remove Grammarly-specific attributes that cause hydration mismatches\n        body.removeAttribute('data-new-gr-c-s-check-loaded');\n        body.removeAttribute('data-gr-ext-installed');\n      }\n    };\n\n    // Clean up immediately\n    cleanupGrammarlyAttributes();\n\n    // Set up a mutation observer to continuously clean up these attributes\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (\n          mutation.type === 'attributes' &&\n          mutation.target === document.body\n        ) {\n          const target = mutation.target as HTMLElement;\n          if (\n            target.hasAttribute('data-new-gr-c-s-check-loaded') ||\n            target.hasAttribute('data-gr-ext-installed')\n          ) {\n            cleanupGrammarlyAttributes();\n          }\n        }\n      });\n    });\n\n    // Start observing body attribute changes\n    observer.observe(document.body, {\n      attributes: true,\n      attributeFilter: ['data-new-gr-c-s-check-loaded', 'data-gr-ext-installed']\n    });\n\n    // Cleanup function\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n\n  return null;\n};\n",
    "language":"typescript",
    "lines":56,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/LoadingButton.tsx":{
    "content":"'use client';\n\nimport { ReactNode, useCallback, useState } from 'react';\nimport { useGlobalLoading } from '../../../lib/context/GlobalLoadingContext';\nimport './LoadingButton.css';\n\ninterface LoadingButtonProps {\n  onClick: () => Promise<void> | void;\n  children: ReactNode;\n  className?: string;\n  disabled?: boolean;\n  loadingText?: string;\n  globalLoadingMessage?: string;\n  variant?: 'primary' | 'secondary' | 'danger' | 'ghost';\n  size?: 'sm' | 'md' | 'lg';\n  type?: 'button' | 'submit' | 'reset';\n  title?: string;\n  'aria-label'?: string;\n  'data-testid'?: string;\n}\n\nexport function LoadingButton({\n  onClick,\n  children,\n  className = '',\n  disabled = false,\n  loadingText,\n  globalLoadingMessage,\n  variant = 'primary',\n  size = 'md',\n  type = 'button',\n  title,\n  'aria-label': ariaLabel,\n  'data-testid': dataTestId\n}: LoadingButtonProps) {\n  const [isLoading, setIsLoading] = useState(false);\n  const { startLoading, stopLoading } = useGlobalLoading();\n\n  const handleClick = useCallback(async () => {\n    if (isLoading || disabled) return;\n\n    setIsLoading(true);\n\n    // Generate unique request ID for global loading\n    const requestId = `button-${Date.now()}-${Math.random()}`;\n\n    // Start global loading if message provided\n    if (globalLoadingMessage) {\n      startLoading(requestId, globalLoadingMessage);\n    }\n\n    try {\n      await onClick();\n    } catch (error) {\n      console.error('LoadingButton error:', error);\n      throw error; // Re-throw to allow parent components to handle\n    } finally {\n      setIsLoading(false);\n\n      // Stop global loading\n      if (globalLoadingMessage) {\n        stopLoading(requestId);\n      }\n    }\n  }, [\n    onClick,\n    isLoading,\n    disabled,\n    globalLoadingMessage,\n    startLoading,\n    stopLoading\n  ]);\n\n  const buttonClasses = [\n    'loading-button',\n    `loading-button--${variant}`,\n    `loading-button--${size}`,\n    isLoading && 'loading-button--loading',\n    (disabled || isLoading) && 'loading-button--disabled',\n    className\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  const displayText = isLoading && loadingText ? loadingText : children;\n\n  return (\n    <button\n      type={type}\n      className={buttonClasses}\n      onClick={handleClick}\n      disabled={disabled || isLoading}\n      title={title}\n      aria-label={ariaLabel}\n      data-testid={dataTestId}\n      aria-busy={isLoading}\n    >\n      {isLoading && (\n        <span className=\\\"loading-button__spinner\\\" aria-hidden=\\\"true\\\">\n          <svg\n            width=\\\"16\\\"\n            height=\\\"16\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          >\n            <path d=\\\"M21 12a9 9 0 11-6.22-8.56\\\" />\n          </svg>\n        </span>\n      )}\n      <span className=\\\"loading-button__content\\\">{displayText}</span>\n    </button>\n  );\n}\n\n// Convenience hook for async operations with loading state\nexport function useAsyncAction() {\n  const [isLoading, setIsLoading] = useState(false);\n  const { startLoading, stopLoading } = useGlobalLoading();\n\n  const execute = useCallback(\n    async (\n      asyncFn: () => Promise<void>,\n      options?: {\n        globalMessage?: string;\n        onSuccess?: () => void;\n        onError?: (error: Error) => void;\n      }\n    ) => {\n      if (isLoading) return;\n\n      setIsLoading(true);\n      const requestId = `async-action-${Date.now()}-${Math.random()}`;\n\n      if (options?.globalMessage) {\n        startLoading(requestId, options.globalMessage);\n      }\n\n      try {\n        await asyncFn();\n        options?.onSuccess?.();\n      } catch (error) {\n        console.error('Async action error:', error);\n        options?.onError?.(error as Error);\n        throw error;\n      } finally {\n        setIsLoading(false);\n        if (options?.globalMessage) {\n          stopLoading(requestId);\n        }\n      }\n    },\n    [isLoading, startLoading, stopLoading]\n  );\n\n  return { execute, isLoading };\n}\n",
    "language":"typescript",
    "lines":161,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/InlineSuggestionInput.tsx":{
    "content":"'use client';\n\nimport React, {\n  ChangeEvent,\n  KeyboardEvent,\n  useEffect,\n  useRef,\n  useState\n} from 'react';\nimport { createPortal } from 'react-dom';\nimport './InlineSuggestionInput.css';\n\nexport interface SuggestionItem {\n  id: string;\n  value: string; // For users, this is the author_id\n  label: string;\n  displayName?: string; // For users, this is the author name for display\n  avatar?: string;\n  type: 'hashtag' | 'user';\n  disabled?: boolean; // Whether this option is already selected and should be disabled\n}\n\nexport interface InlineSuggestionInputProps {\n  value: string;\n  onChange: (value: string) => void;\n  onPaste?: (e: React.ClipboardEvent) => void;\n  placeholder?: string;\n  className?: string;\n  disabled?: boolean;\n  onHashtagSearch?: (\n    query: string,\n    page?: number\n  ) => Promise<{\n    items: SuggestionItem[];\n    hasMore: boolean;\n    total: number;\n  }>;\n  onUserSearch?: (\n    query: string,\n    page?: number\n  ) => Promise<{\n    items: SuggestionItem[];\n    hasMore: boolean;\n    total: number;\n  }>;\n  maxSuggestions?: number;\n  minQueryLength?: number;\n  as?: 'input' | 'textarea';\n  rows?: number;\n}\n\nexport const InlineSuggestionInput: React.FC<InlineSuggestionInputProps> = ({\n  value,\n  onChange,\n  onPaste,\n  placeholder,\n  className = '',\n  disabled = false,\n  onHashtagSearch,\n  onUserSearch,\n  maxSuggestions = 10,\n  minQueryLength = 2,\n  as = 'input',\n  rows = 3\n}) => {\n  const [suggestions, setSuggestions] = useState<SuggestionItem[]>([]);\n  const [showSuggestions, setShowSuggestions] = useState(false);\n  const [selectedIndex, setSelectedIndex] = useState(-1);\n  const [currentTrigger, setCurrentTrigger] = useState<'#' | '@' | null>(null);\n  const [currentQuery, setCurrentQuery] = useState('');\n  const [cursorPosition, setCursorPosition] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n  const [hasMore, setHasMore] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalResults, setTotalResults] = useState(0);\n  const [triggerStartIndex, setTriggerStartIndex] = useState(-1);\n  const [dropdownPosition, setDropdownPosition] = useState({\n    top: 100,\n    left: 100,\n    width: 300\n  });\n\n  const inputRef = useRef<HTMLInputElement | HTMLTextAreaElement>(null);\n  const suggestionListRef = useRef<HTMLDivElement>(null);\n\n  // Calculate dropdown position based on input position\n  const calculateDropdownPosition = () => {\n    if (!inputRef.current) return;\n\n    const inputRect = inputRef.current.getBoundingClientRect();\n    const viewportHeight = window.innerHeight;\n    const viewportWidth = window.innerWidth;\n    const scrollY = window.scrollY || document.documentElement.scrollTop;\n    const scrollX = window.scrollX || document.documentElement.scrollLeft;\n\n    // Calculate initial position\n    let top = inputRect.bottom + scrollY + 2; // Add small gap\n    let left = inputRect.left + scrollX;\n    const width = Math.max(inputRect.width, 300); // Minimum width for readability\n\n    // Check if dropdown would go off-screen vertically\n    const dropdownHeight = 300; // Max height from CSS\n    if (inputRect.bottom + dropdownHeight > viewportHeight) {\n      // Position above the input instead\n      top = inputRect.top + scrollY - dropdownHeight - 2;\n    }\n\n    // Check if dropdown would go off-screen horizontally\n    if (left + width > viewportWidth) {\n      // Align to right edge of viewport\n      left = viewportWidth - width - 10;\n    }\n\n    // Ensure dropdown doesn't go off left edge\n    if (left < 10) {\n      left = 10;\n    }\n\n    // Ensure all values are valid numbers\n    const finalTop = isNaN(top) ? 100 : Math.max(10, top);\n    const finalLeft = isNaN(left) ? 100 : Math.max(10, left);\n    const finalWidth = isNaN(width) ? 300 : Math.max(200, width);\n\n    setDropdownPosition({\n      top: finalTop,\n      left: finalLeft,\n      width: finalWidth\n    });\n  };\n\n  // Update dropdown position when suggestions show/hide or on scroll/resize\n  useEffect(() => {\n    if (showSuggestions) {\n      // Use requestAnimationFrame to ensure DOM is updated\n      requestAnimationFrame(() => {\n        calculateDropdownPosition();\n      });\n\n      const handlePositionUpdate = () => {\n        requestAnimationFrame(() => {\n          calculateDropdownPosition();\n        });\n      };\n\n      window.addEventListener('scroll', handlePositionUpdate, true);\n      window.addEventListener('resize', handlePositionUpdate);\n\n      return () => {\n        window.removeEventListener('scroll', handlePositionUpdate, true);\n        window.removeEventListener('resize', handlePositionUpdate);\n      };\n    }\n  }, [showSuggestions]);\n\n  // Recalculate position when suggestions change\n  useEffect(() => {\n    if (showSuggestions && suggestions.length > 0) {\n      requestAnimationFrame(() => {\n        calculateDropdownPosition();\n      });\n    }\n  }, [suggestions.length, showSuggestions]);\n\n  // Enhanced trigger detection that persists through spaces\n  const detectTriggerAndQuery = (text: string, position: number) => {\n    const beforeCursor = text.substring(0, position);\n\n    // Find last occurrence of # or @ before cursor\n    const hashIndex = beforeCursor.lastIndexOf('#');\n    const atIndex = beforeCursor.lastIndexOf('@');\n\n    const lastTriggerIndex = Math.max(hashIndex, atIndex);\n\n    if (lastTriggerIndex === -1) {\n      return { trigger: null, query: '', startIndex: -1 };\n    }\n\n    const trigger = text[lastTriggerIndex] as '#' | '@';\n    const afterTrigger = beforeCursor.substring(lastTriggerIndex + 1);\n\n    // For @ mentions, continue searching until we find a closing bracket or end of meaningful content\n    if (trigger === '@') {\n      // Check if we're inside or after a complete structured mention @[username|userId|author]\n      const textFromTrigger = text.substring(lastTriggerIndex);\n      const completeStructuredMention = textFromTrigger.match(/^@\\\\[[^\\\\]]+\\\\]/);\n\n      if (completeStructuredMention) {\n        const mentionEnd =\n          lastTriggerIndex + completeStructuredMention[0].length;\n\n        // If cursor is inside the structured mention or right after it (including space), don't trigger\n        if (position <= mentionEnd + 1) {\n          // +1 to account for space after mention\n          return { trigger: null, query: '', startIndex: -1 };\n        }\n      }\n\n      // Check if we have a partial structured mention that's not complete\n      const partialStructuredMention = textFromTrigger.match(/^@\\\\[[^\\\\]]*$/);\n      if (partialStructuredMention) {\n        // We're in the middle of typing a structured mention, don't trigger search\n        return { trigger: null, query: '', startIndex: -1 };\n      }\n\n      // For @ mentions, allow spaces in the query until we hit certain terminating characters\n      const terminatingChars = /[.,!?;:\\\\n\\\\r\\\\t]/;\n      if (terminatingChars.test(afterTrigger)) {\n        return { trigger: null, query: '', startIndex: -1 };\n      }\n\n      // Only trigger if we have a simple @ followed by text (not structured format)\n      if (afterTrigger.includes('[')) {\n        return { trigger: null, query: '', startIndex: -1 };\n      }\n\n      // Continue search with spaces allowed for user mentions\n      return {\n        trigger,\n        query: afterTrigger.trim(),\n        startIndex: lastTriggerIndex\n      };\n    } else {\n      // For hashtags, stop at first space (original behavior)\n      if (afterTrigger.includes(' ')) {\n        return { trigger: null, query: '', startIndex: -1 };\n      }\n\n      return {\n        trigger,\n        query: afterTrigger,\n        startIndex: lastTriggerIndex\n      };\n    }\n  };\n\n  // Enhanced search with pagination support\n  const searchSuggestions = async (\n    trigger: '#' | '@',\n    query: string,\n    page: number = 1,\n    append: boolean = false\n  ) => {\n    // eslint-disable-next-line no-console\n    console.log('InlineSuggestionInput searchSuggestions called:', {\n      trigger,\n      query,\n      page,\n      minQueryLength\n    });\n\n    if (query.length < minQueryLength) {\n      // eslint-disable-next-line no-console\n      console.log(\n        'InlineSuggestionInput query too short:',\n        query.length,\n        '<',\n        minQueryLength\n      );\n      setSuggestions([]);\n      setShowSuggestions(false);\n      setHasMore(false);\n      setTotalResults(0);\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      let result: { items: SuggestionItem[]; hasMore: boolean; total: number } =\n        {\n          items: [],\n          hasMore: false,\n          total: 0\n        };\n\n      if (trigger === '#' && onHashtagSearch) {\n        // eslint-disable-next-line no-console\n        console.log('InlineSuggestionInput calling onHashtagSearch');\n        result = await onHashtagSearch(query, page);\n      } else if (trigger === '@' && onUserSearch) {\n        // eslint-disable-next-line no-console\n        console.log('InlineSuggestionInput calling onUserSearch');\n        result = await onUserSearch(query, page);\n      } else {\n        // eslint-disable-next-line no-console\n        console.log('InlineSuggestionInput no search function available:', {\n          trigger,\n          hasHashtagSearch: !!onHashtagSearch,\n          hasUserSearch: !!onUserSearch\n        });\n      }\n\n      if (append) {\n        setSuggestions((prev) => [...prev, ...result.items]);\n      } else {\n        setSuggestions(result.items);\n        // Set selected index to first non-disabled item\n        let firstEnabledIndex = -1;\n        for (let i = 0; i < result.items.length; i++) {\n          if (!result.items[i].disabled) {\n            firstEnabledIndex = i;\n            break;\n          }\n        }\n        setSelectedIndex(firstEnabledIndex);\n      }\n\n      setHasMore(result.hasMore);\n      setTotalResults(result.total);\n      setShowSuggestions(true); // Always show dropdown when we have a search query\n      setCurrentPage(page);\n\n      // eslint-disable-next-line no-console\n      console.log('InlineSuggestionInput search completed:', {\n        resultCount: result.items.length,\n        total: result.total,\n        hasMore: result.hasMore,\n        showSuggestions: true\n      });\n    } catch (error) {\n      console.error('Error searching suggestions:', error);\n      if (!append) {\n        setSuggestions([]);\n        setShowSuggestions(false);\n        setHasMore(false);\n        setTotalResults(0);\n      }\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Load more results\n  const loadMore = async () => {\n    if (!hasMore || isLoading || !currentTrigger || !currentQuery) return;\n\n    await searchSuggestions(\n      currentTrigger,\n      currentQuery,\n      currentPage + 1,\n      true\n    );\n  };\n\n  // Handle input change\n  const handleInputChange = (\n    e: ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const newValue = e.target.value;\n    const newCursorPosition = e.target.selectionStart || 0;\n\n    // eslint-disable-next-line no-console\n    console.log('InlineSuggestionInput handleInputChange:', {\n      oldValue: value,\n      newValue,\n      hasNewlines: newValue.includes('\\\\n'),\n      cursorPosition: newCursorPosition\n    });\n\n    onChange(newValue);\n    setCursorPosition(newCursorPosition);\n\n    const { trigger, query, startIndex } = detectTriggerAndQuery(\n      newValue,\n      newCursorPosition\n    );\n\n    // eslint-disable-next-line no-console\n    console.log('InlineSuggestionInput detected trigger and query:', {\n      trigger,\n      query,\n      startIndex,\n      currentQuery\n    });\n\n    setCurrentTrigger(trigger);\n    setCurrentQuery(query);\n    setTriggerStartIndex(startIndex);\n\n    if (trigger && query !== currentQuery) {\n      // eslint-disable-next-line no-console\n      console.log('InlineSuggestionInput triggering search:', {\n        trigger,\n        query\n      });\n      // Reset pagination when query changes\n      setCurrentPage(1);\n      searchSuggestions(trigger, query, 1, false);\n    } else if (!trigger) {\n      // eslint-disable-next-line no-console\n      console.log(\n        'InlineSuggestionInput no trigger detected, hiding suggestions'\n      );\n      setShowSuggestions(false);\n      setSuggestions([]);\n      setHasMore(false);\n      setTotalResults(0);\n    } else {\n      // eslint-disable-next-line no-console\n      console.log('InlineSuggestionInput query unchanged, not searching:', {\n        trigger,\n        query,\n        currentQuery\n      });\n    }\n  };\n\n  // Handle cursor position changes\n  const handleCursorPositionChange = (\n    e: React.SyntheticEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const target = e.target as HTMLInputElement | HTMLTextAreaElement;\n    const newCursorPosition = target.selectionStart || 0;\n    setCursorPosition(newCursorPosition);\n\n    const { trigger, query, startIndex } = detectTriggerAndQuery(\n      value,\n      newCursorPosition\n    );\n\n    setCurrentTrigger(trigger);\n    setCurrentQuery(query);\n    setTriggerStartIndex(startIndex);\n\n    if (!trigger) {\n      setShowSuggestions(false);\n      setSuggestions([]);\n      setHasMore(false);\n      setTotalResults(0);\n    }\n  };\n\n  // Handle keyboard navigation with pagination support\n  const handleKeyDown = (\n    e: KeyboardEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    // Debug logging for Enter key\n    if (e.key === 'Enter') {\n      // eslint-disable-next-line no-console\n      console.log('InlineSuggestionInput handleKeyDown Enter pressed:', {\n        showSuggestions,\n        suggestionsLength: suggestions.length,\n        selectedIndex,\n        as,\n        willReturn: !showSuggestions || suggestions.length === 0\n      });\n    }\n\n    // Only handle special keys when suggestions are visible\n    if (!showSuggestions || suggestions.length === 0) return;\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        if (selectedIndex < suggestions.length - 1) {\n          let nextIndex = selectedIndex + 1;\n          // Skip disabled items\n          while (\n            nextIndex < suggestions.length &&\n            suggestions[nextIndex]?.disabled\n          ) {\n            nextIndex++;\n          }\n          if (nextIndex < suggestions.length) {\n            setSelectedIndex(nextIndex);\n          } else if (hasMore && !isLoading) {\n            // Load more when reaching the end\n            loadMore();\n          } else {\n            // Wrap to beginning, finding first non-disabled item\n            let wrapIndex = 0;\n            while (\n              wrapIndex < suggestions.length &&\n              suggestions[wrapIndex]?.disabled\n            ) {\n              wrapIndex++;\n            }\n            if (wrapIndex < suggestions.length) {\n              setSelectedIndex(wrapIndex);\n            }\n          }\n        } else if (hasMore && !isLoading) {\n          // Load more when reaching the end\n          loadMore();\n        } else {\n          // Wrap to beginning, finding first non-disabled item\n          let wrapIndex = 0;\n          while (\n            wrapIndex < suggestions.length &&\n            suggestions[wrapIndex]?.disabled\n          ) {\n            wrapIndex++;\n          }\n          if (wrapIndex < suggestions.length) {\n            setSelectedIndex(wrapIndex);\n          }\n        }\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        if (selectedIndex > 0) {\n          let prevIndex = selectedIndex - 1;\n          // Skip disabled items\n          while (prevIndex >= 0 && suggestions[prevIndex]?.disabled) {\n            prevIndex--;\n          }\n          if (prevIndex >= 0) {\n            setSelectedIndex(prevIndex);\n          } else {\n            // Wrap to end, finding last non-disabled item\n            let wrapIndex = suggestions.length - 1;\n            while (wrapIndex >= 0 && suggestions[wrapIndex]?.disabled) {\n              wrapIndex--;\n            }\n            if (wrapIndex >= 0) {\n              setSelectedIndex(wrapIndex);\n            }\n          }\n        } else {\n          // Wrap to end, finding last non-disabled item\n          let wrapIndex = suggestions.length - 1;\n          while (wrapIndex >= 0 && suggestions[wrapIndex]?.disabled) {\n            wrapIndex--;\n          }\n          if (wrapIndex >= 0) {\n            setSelectedIndex(wrapIndex);\n          }\n        }\n        break;\n      case 'Enter':\n      case 'Tab':\n        // Only handle Enter/Tab if a suggestion is actually selected and not disabled\n        if (\n          selectedIndex >= 0 &&\n          selectedIndex < suggestions.length &&\n          !suggestions[selectedIndex]?.disabled\n        ) {\n          e.preventDefault();\n          e.stopPropagation();\n          insertSuggestion(suggestions[selectedIndex]);\n          return; // Prevent any further processing\n        }\n        // If no suggestion is selected or it's disabled, allow normal Enter/Tab behavior\n        // by NOT preventing default - this allows newlines in textarea\n        break;\n      case 'Escape':\n        e.preventDefault();\n        setShowSuggestions(false);\n        setSuggestions([]);\n        setSelectedIndex(-1);\n        setHasMore(false);\n        setTotalResults(0);\n        break;\n      case 'PageDown':\n        e.preventDefault();\n        if (hasMore && !isLoading) {\n          loadMore();\n        }\n        break;\n    }\n  };\n\n  // Insert selected suggestion\n  const insertSuggestion = (suggestion: SuggestionItem) => {\n    if (triggerStartIndex === -1) return;\n\n    // Clear suggestions immediately to prevent re-triggering\n    setShowSuggestions(false);\n    setSuggestions([]);\n    setSelectedIndex(-1);\n    setHasMore(false);\n    setTotalResults(0);\n    setCurrentTrigger(null);\n    setCurrentQuery('');\n\n    const before = value.substring(0, triggerStartIndex);\n    const after = value.substring(cursorPosition);\n\n    let replacement = '';\n\n    if (suggestion.type === 'user') {\n      // Create enhanced mention format: @[username|userId|filterType]\n      const username = suggestion.displayName || suggestion.value;\n      const userId = suggestion.value; // The value is the user ID\n\n      // Clean username (remove @ if present)\n      const cleanUsername = username.startsWith('@')\n        ? username.substring(1)\n        : username;\n\n      // Create enhanced mention with default filter type: @[username|userId|author]\n      replacement = `@[${cleanUsername}|${userId}|author] `;\n    } else if (suggestion.type === 'hashtag') {\n      // Handle hashtags normally\n      let hashtagValue = suggestion.value;\n      if (hashtagValue.startsWith('#')) {\n        hashtagValue = hashtagValue.substring(1);\n      }\n      replacement = `#${hashtagValue} `;\n    } else {\n      // Fallback for other types\n      replacement = `${currentTrigger}${suggestion.value} `;\n    }\n\n    const newValue = before + replacement + after;\n    const newCursorPosition = before.length + replacement.length;\n\n    onChange(newValue);\n\n    // Focus and set cursor position\n    setTimeout(() => {\n      if (inputRef.current) {\n        inputRef.current.focus();\n        inputRef.current.setSelectionRange(\n          newCursorPosition,\n          newCursorPosition\n        );\n      }\n    }, 0);\n  };\n\n  // Handle clicking on suggestions\n  const handleSuggestionClick = (suggestion: SuggestionItem) => {\n    // Don't allow selecting disabled suggestions\n    if (suggestion.disabled) {\n      return;\n    }\n    insertSuggestion(suggestion);\n  };\n\n  // Handle scroll to load more\n  const handleSuggestionScroll = (e: React.UIEvent<HTMLDivElement>) => {\n    const { scrollTop, scrollHeight, clientHeight } = e.currentTarget;\n\n    // Load more when scrolled to bottom\n    if (\n      scrollHeight - scrollTop <= clientHeight + 10 &&\n      hasMore &&\n      !isLoading\n    ) {\n      loadMore();\n    }\n  };\n\n  // Close suggestions when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      const target = event.target as Node;\n\n      // Check if click is inside input\n      if (inputRef.current && inputRef.current.contains(target)) {\n        return;\n      }\n\n      // Check if click is inside suggestion list\n      if (\n        suggestionListRef.current &&\n        suggestionListRef.current.contains(target)\n      ) {\n        return;\n      }\n\n      // Check if click is inside any portal container (for nested portals)\n      const portalContainer = document.querySelector(\n        '.suggestion-portal-container'\n      );\n      if (portalContainer && portalContainer.contains(target)) {\n        return;\n      }\n\n      // Click is outside, close suggestions\n      setShowSuggestions(false);\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const InputComponent = as === 'textarea' ? 'textarea' : 'input';\n\n  // Render suggestions dropdown\n  const renderSuggestionsDropdown = () => {\n    // Show dropdown if:\n    // 1. showSuggestions is true AND\n    // 2. (we have suggestions OR we're loading OR we have a query to show \\\"no results\\\" for)\n    if (\n      !showSuggestions ||\n      (!suggestions.length && !isLoading && !currentQuery)\n    )\n      return null;\n\n    return (\n      <div\n        className=\\\"suggestion-portal-container\\\"\n        style={{\n          position: 'fixed',\n          top: `${dropdownPosition.top}px`,\n          left: `${dropdownPosition.left}px`,\n          width: `${dropdownPosition.width}px`,\n          zIndex: 999999,\n          pointerEvents: 'auto'\n        }}\n      >\n        <div\n          ref={suggestionListRef}\n          className=\\\"suggestion-list\\\"\n          onScroll={handleSuggestionScroll}\n        >\n          {/* Results header */}\n          {totalResults > 0 && (\n            <div className=\\\"suggestion-header\\\">\n              <span className=\\\"suggestion-count\\\">\n                {suggestions.length} of {totalResults} results\n                {currentQuery && ` for \\\"${currentQuery}\\\"`}\n              </span>\n            </div>\n          )}\n\n          {/* Suggestion items */}\n          {suggestions.map((suggestion, index) => (\n            <div\n              key={suggestion.id}\n              className={`suggestion-item ${index === selectedIndex ? 'selected' : ''} ${suggestion.disabled ? 'disabled' : ''}`}\n              onClick={() => handleSuggestionClick(suggestion)}\n              title={suggestion.disabled ? 'Already selected' : undefined}\n            >\n              {suggestion.type === 'user' && suggestion.avatar && (\n                <img\n                  src={suggestion.avatar}\n                  alt=\\\"\\\"\n                  className=\\\"suggestion-avatar\\\"\n                />\n              )}\n              <span className=\\\"suggestion-trigger\\\">\n                {suggestion.type === 'hashtag' ? '#' : '@'}\n              </span>\n              <span className=\\\"suggestion-label\\\">{suggestion.label}</span>\n              {suggestion.disabled && (\n                <span className=\\\"suggestion-disabled-indicator\\\">\u2713</span>\n              )}\n            </div>\n          ))}\n\n          {/* Load more button */}\n          {hasMore && !isLoading && (\n            <div className=\\\"suggestion-load-more\\\">\n              <button\n                type=\\\"button\\\"\n                onClick={loadMore}\n                className=\\\"suggestion-load-more-btn\\\"\n              >\n                Load More ({totalResults - suggestions.length} remaining)\n              </button>\n            </div>\n          )}\n\n          {/* Loading indicator */}\n          {isLoading && (\n            <div className=\\\"suggestion-loading\\\">\n              <div className=\\\"suggestion-loading-spinner\\\"></div>\n              <span>Loading more results...</span>\n            </div>\n          )}\n\n          {/* No results message */}\n          {!isLoading && suggestions.length === 0 && currentQuery && (\n            <div className=\\\"suggestion-no-results\\\">\n              No {currentTrigger === '@' ? 'users' : 'hashtags'} found for{' '}\n              {`\\\"${currentQuery}\\\"`}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\\\"inline-suggestion-container\\\">\n      <InputComponent\n        ref={inputRef as any}\n        value={value}\n        onChange={handleInputChange}\n        onPaste={onPaste}\n        onSelect={handleCursorPositionChange}\n        onKeyDown={handleKeyDown}\n        placeholder={placeholder}\n        className={`inline-suggestion-input ${\n          showSuggestions && suggestions.length > 0\n            ? 'inline-suggestion-input--with-suggestions'\n            : ''\n        } ${className}`}\n        disabled={disabled}\n        rows={as === 'textarea' ? rows : undefined}\n      />\n\n      {/* Render suggestions dropdown as portal */}\n      {typeof window !== 'undefined' &&\n        createPortal(renderSuggestionsDropdown(), document.body)}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":802,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/SmartPillInput.test.tsx":{
    "content":"import '@testing-library/jest-dom';\nimport { fireEvent, render, screen } from '@testing-library/react';\nimport { NavigationLoadingProvider } from '../../../lib/context/NavigationLoadingContext';\nimport { SmartPillInput } from './SmartPillInput';\n\n// Mock Next.js navigation\njest.mock('next/navigation', () => ({\n  usePathname: jest.fn(() => '/posts'),\n  useRouter: jest.fn(() => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    back: jest.fn()\n  })),\n  useSearchParams: jest.fn(() => new URLSearchParams())\n}));\n\n// Mock the search actions\njest.mock('../../../lib/actions/search.actions', () => ({\n  searchHashtags: jest\n    .fn()\n    .mockResolvedValue([\n      { id: '1', value: 'javascript', label: 'javascript', type: 'hashtag' }\n    ]),\n  searchUsers: jest.fn().mockResolvedValue([\n    {\n      id: '1',\n      value: 'user123',\n      label: 'testuser',\n      displayName: 'Test User',\n      type: 'user'\n    }\n  ])\n}));\n\ndescribe('SmartPillInput', () => {\n  const defaultProps = {\n    value: '',\n    onChange: jest.fn(),\n    contextId: 'test',\n    placeholder: 'Type something...'\n  };\n\n  // Helper function to render with required providers\n  const renderWithProviders = (props = defaultProps) => {\n    return render(\n      <NavigationLoadingProvider>\n        <SmartPillInput {...props} />\n      </NavigationLoadingProvider>\n    );\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders placeholder when empty', () => {\n    renderWithProviders();\n    expect(\n      screen.getByPlaceholderText('Type something...')\n    ).toBeInTheDocument();\n  });\n\n  it('enters edit mode when clicked', () => {\n    renderWithProviders();\n\n    const input = screen.getByPlaceholderText('Type something...');\n    fireEvent.click(input);\n\n    // Should show the input field in edit mode\n    expect(screen.getByRole('textbox')).toBeInTheDocument();\n  });\n\n  it('renders hashtag pills in display mode', () => {\n    renderWithProviders({ ...defaultProps, value: '#javascript #react' });\n\n    // Should render the hashtags as pills\n    expect(screen.getByText('#javascript')).toBeInTheDocument();\n    expect(screen.getByText('#react')).toBeInTheDocument();\n  });\n\n  it('renders mention pills in display mode', () => {\n    renderWithProviders({ ...defaultProps, value: '@[testuser|user123]' });\n\n    // Should render the mention as a styled pill\n    const pillLink = screen.getByRole('link');\n    expect(pillLink).toHaveClass('content-pill', 'content-pill--mention');\n    expect(pillLink).toHaveTextContent('@testuser');\n    // No title attribute in filter context (tooltips disabled)\n    expect(pillLink).not.toHaveAttribute('title');\n  });\n\n  it('commits changes when commit button is clicked', async () => {\n    const onChange = jest.fn();\n    renderWithProviders({\n      ...defaultProps,\n      onChange,\n      value: '#existing'\n    });\n\n    // Enter edit mode\n    const container = screen.getByText('#existing').closest('div');\n    fireEvent.click(container!);\n\n    // Type in the input\n    const input = screen.getByRole('textbox');\n    fireEvent.change(input, { target: { value: '#test' } });\n\n    // Click outside to commit (since we removed keyboard shortcuts)\n    fireEvent.click(document.body);\n\n    // Should call onChange with the combined value\n    expect(onChange).toHaveBeenCalledWith('#existing #test');\n  });\n\n  it('cancels changes when clicking outside without typing', () => {\n    const onChange = jest.fn();\n    renderWithProviders({\n      ...defaultProps,\n      onChange,\n      value: '#original'\n    });\n\n    // Enter edit mode\n    const container = screen.getByText('#original').closest('div');\n    fireEvent.click(container!);\n\n    // Click outside without typing anything\n    fireEvent.click(document.body);\n\n    // Should call onChange with just the original value (no new content added)\n    expect(onChange).toHaveBeenCalledWith('#original');\n\n    // Should return to display mode with original value\n    expect(screen.getByText('#original')).toBeInTheDocument();\n  });\n\n  it('shows existing pills in edit mode and allows removal', () => {\n    const onChange = jest.fn();\n    renderWithProviders({\n      ...defaultProps,\n      onChange,\n      value: '#existing #test'\n    });\n\n    // Enter edit mode\n    const container = screen.getByText('#existing').closest('div');\n    fireEvent.click(container!);\n\n    // Should still show existing pills in edit mode\n    expect(screen.getByText('#existing')).toBeInTheDocument();\n    expect(screen.getByText('#test')).toBeInTheDocument();\n\n    // Click on a pill to remove it\n    const existingPill = screen.getByText('#existing');\n    fireEvent.click(existingPill);\n\n    // Click outside to commit the changes\n    fireEvent.click(document.body);\n\n    // Should call onChange with the remaining pill\n    expect(onChange).toHaveBeenCalledWith('#test');\n  });\n\n  it('removes pills immediately when clicked in display mode', () => {\n    const onChange = jest.fn();\n    renderWithProviders({\n      ...defaultProps,\n      onChange,\n      value: '#keep #remove'\n    });\n\n    // Click on a pill to remove it\n    const removePill = screen.getByText('#remove');\n    fireEvent.click(removePill);\n\n    // Should call onChange immediately with the remaining content\n    expect(onChange).toHaveBeenCalledWith('#keep');\n  });\n\n  it('prevents duplicate hashtags from being added', () => {\n    const onChange = jest.fn();\n    renderWithProviders({\n      ...defaultProps,\n      onChange,\n      value: '#existing'\n    });\n\n    // Enter edit mode\n    const container = screen.getByText('#existing').closest('div');\n    fireEvent.click(container!);\n\n    // Try to add the same hashtag again (must end with space to be detected as complete pill)\n    const input = screen.getByRole('textbox');\n    fireEvent.change(input, { target: { value: '#existing ' } }); // Note the space at the end\n\n    // Click outside to commit\n    fireEvent.click(document.body);\n\n    // Should not add duplicate - value should remain the same\n    expect(onChange).toHaveBeenCalledWith('#existing');\n  });\n\n  it('prevents duplicate mentions from being added', () => {\n    const onChange = jest.fn();\n    renderWithProviders({\n      ...defaultProps,\n      onChange,\n      value: '@[testuser|user123]'\n    });\n\n    // Enter edit mode\n    const container = screen.getByText('@testuser').closest('div');\n    fireEvent.click(container!);\n\n    // Try to add the same mention again (must end with space to be detected as complete pill)\n    const input = screen.getByRole('textbox');\n    fireEvent.change(input, { target: { value: '@[testuser|user123] ' } }); // Note the space at the end\n\n    // Click outside to commit\n    fireEvent.click(document.body);\n\n    // Should not add duplicate - value should remain the same\n    expect(onChange).toHaveBeenCalledWith('@[testuser|user123]');\n  });\n});\n",
    "language":"typescript",
    "lines":226,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/OverlayRenderer.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useOverlay } from '../../../lib/context/OverlayContext';\nimport './OverlayRenderer.css';\n\n// Draggable/Resizable Widget Component\nconst DraggableWidget: React.FC<{\n  id: string;\n  children: React.ReactNode;\n  position: { x: number; y: number };\n  size: { width: number; height: number };\n  isDraggable?: boolean;\n  isResizable?: boolean;\n  onPositionChange?: (position: { x: number; y: number }) => void;\n  onSizeChange?: (size: { width: number; height: number }) => void;\n  onClose?: () => void;\n}> = ({\n  id,\n  children,\n  position,\n  size,\n  isDraggable = true,\n  isResizable = true,\n  onPositionChange,\n  onSizeChange,\n  onClose\n}) => {\n  const [isDragging, setIsDragging] = useState(false);\n  const [isResizing, setIsResizing] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [currentPosition, setCurrentPosition] = useState(position);\n  const [currentSize, setCurrentSize] = useState(size);\n  const widgetRef = useRef<HTMLDivElement>(null);\n\n  // Handle dragging\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (\n      !isDraggable ||\n      (e.target as HTMLElement).classList.contains('widget-resize-handle')\n    )\n      return;\n\n    setIsDragging(true);\n    setDragOffset({\n      x: e.clientX - currentPosition.x,\n      y: e.clientY - currentPosition.y\n    });\n  };\n\n  const handleMouseMove = (e: MouseEvent) => {\n    if (isDragging && isDraggable) {\n      const newPosition = {\n        x: Math.max(\n          0,\n          Math.min(\n            window.innerWidth - currentSize.width,\n            e.clientX - dragOffset.x\n          )\n        ),\n        y: Math.max(\n          0,\n          Math.min(\n            window.innerHeight - currentSize.height,\n            e.clientY - dragOffset.y\n          )\n        )\n      };\n      setCurrentPosition(newPosition);\n      onPositionChange?.(newPosition);\n    }\n  };\n\n  const handleMouseUp = () => {\n    setIsDragging(false);\n    setIsResizing(false);\n  };\n\n  // Handle resizing\n  const handleResizeStart = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    setIsResizing(true);\n  };\n\n  const handleResize = (e: MouseEvent) => {\n    if (isResizing && isResizable) {\n      const rect = widgetRef.current?.getBoundingClientRect();\n      if (rect) {\n        const newSize = {\n          width: Math.max(200, e.clientX - rect.left),\n          height: Math.max(150, e.clientY - rect.top)\n        };\n        setCurrentSize(newSize);\n        onSizeChange?.(newSize);\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (isDragging || isResizing) {\n      document.addEventListener(\n        'mousemove',\n        isDragging ? handleMouseMove : handleResize\n      );\n      document.addEventListener('mouseup', handleMouseUp);\n      return () => {\n        document.removeEventListener(\n          'mousemove',\n          isDragging ? handleMouseMove : handleResize\n        );\n        document.removeEventListener('mouseup', handleMouseUp);\n      };\n    }\n  }, [isDragging, isResizing, dragOffset, currentPosition, currentSize]);\n\n  return (\n    <div\n      ref={widgetRef}\n      className={`overlay-widget ${isDragging ? 'dragging' : ''} ${isResizing ? 'resizing' : ''}`}\n      style={{\n        position: 'fixed',\n        left: currentPosition.x,\n        top: currentPosition.y,\n        width: currentSize.width,\n        height: currentSize.height,\n        zIndex: 1000,\n        cursor: isDraggable ? 'move' : 'default'\n      }}\n      onMouseDown={handleMouseDown}\n    >\n      <div className=\\\"widget-header\\\">\n        <div className=\\\"widget-title\\\">Widget {id}</div>\n        <button className=\\\"widget-close\\\" onClick={onClose}>\n          \u00d7\n        </button>\n      </div>\n      <div className=\\\"widget-content\\\">{children}</div>\n      {isResizable && (\n        <div className=\\\"widget-resize-handle\\\" onMouseDown={handleResizeStart} />\n      )}\n    </div>\n  );\n};\n\n// Modal Component\nconst Modal: React.FC<{\n  children: React.ReactNode;\n  onClose?: () => void;\n  className?: string;\n}> = ({ children, onClose, className = '' }) => {\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose?.();\n      }\n    };\n\n    document.addEventListener('keydown', handleEscape);\n    document.body.style.overflow = 'hidden';\n\n    return () => {\n      document.removeEventListener('keydown', handleEscape);\n      document.body.style.overflow = '';\n    };\n  }, [onClose]);\n\n  return (\n    <div className={`overlay-modal ${className}`}>\n      <div className=\\\"modal-backdrop\\\" onClick={onClose} />\n      <div className=\\\"modal-content\\\">{children}</div>\n    </div>\n  );\n};\n\n// Main Overlay Renderer\nexport const OverlayRenderer: React.FC = () => {\n  const { overlays, closeOverlay, updateOverlay } = useOverlay();\n  const [portalContainer, setPortalContainer] = useState<HTMLElement | null>(\n    null\n  );\n\n  useEffect(() => {\n    // Create or get the portal container\n    let container = document.getElementById('overlay-portal');\n    if (!container) {\n      container = document.createElement('div');\n      container.id = 'overlay-portal';\n      document.body.appendChild(container);\n    }\n    setPortalContainer(container);\n\n    return () => {\n      // Clean up portal container if no overlays exist\n      if (overlays.length === 0 && container?.parentNode) {\n        container.parentNode.removeChild(container);\n      }\n    };\n  }, [overlays.length]);\n\n  if (!portalContainer || overlays.length === 0) {\n    return null;\n  }\n\n  return createPortal(\n    <>\n      {overlays.map((overlay) => {\n        const { id, config } = overlay;\n        const Component = config.component;\n\n        if (config.type === 'modal') {\n          return (\n            <Modal\n              key={id}\n              onClose={() => closeOverlay(id)}\n              className={config.props?.className}\n            >\n              <Component {...(config.props || {})} />\n            </Modal>\n          );\n        }\n\n        if (config.type === 'widget') {\n          return (\n            <DraggableWidget\n              key={id}\n              id={id}\n              position={config.position || { x: 100, y: 100 }}\n              size={config.size || { width: 300, height: 200 }}\n              isDraggable={config.isDraggable}\n              isResizable={config.isResizable}\n              onPositionChange={(position) => updateOverlay(id, { position })}\n              onSizeChange={(size) => updateOverlay(id, { size })}\n              onClose={() => closeOverlay(id)}\n            >\n              <Component {...(config.props || {})} />\n            </DraggableWidget>\n          );\n        }\n\n        // Default popup rendering\n        return (\n          <div\n            key={id}\n            className=\\\"overlay-popup\\\"\n            style={{ zIndex: config.zIndex }}\n          >\n            <Component {...(config.props || {})} />\n          </div>\n        );\n      })}\n    </>,\n    portalContainer\n  );\n};\n",
    "language":"typescript",
    "lines":256,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/TimestampWithTooltip.tsx":{
    "content":"'use client';\n\nimport { parseISO } from 'date-fns';\nimport { formatInTimeZone } from 'date-fns-tz';\nimport React, { useEffect, useState } from 'react';\nimport { InteractiveTooltip } from '../tooltip/InteractiveTooltip';\nimport './TimestampWithTooltip.css';\n\ninterface TimestampWithTooltipProps {\n  date: Date | string | null;\n  className?: string;\n  showSeconds?: boolean;\n  updateInterval?: number; // milliseconds, default 60000 (1 minute)\n  abbreviated?: boolean; // New prop for compact display\n}\n\ninterface TimeUnit {\n  value: number;\n  unit: string;\n  isFuture?: boolean;\n}\n\nexport const TimestampWithTooltip: React.FC<TimestampWithTooltipProps> = ({\n  date,\n  className = '',\n  showSeconds = false,\n  updateInterval = 60000,\n  abbreviated = false\n}) => {\n  const [currentTime, setCurrentTime] = useState(Date.now());\n  const [userTimezone, setUserTimezone] = useState<string>('UTC');\n\n  // Parse the date to ensure we have a Date object\n  const parsedDate = date\n    ? typeof date === 'string'\n      ? parseISO(date)\n      : date\n    : null;\n\n  // Get user's timezone\n  useEffect(() => {\n    try {\n      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n      setUserTimezone(timezone);\n    } catch (error) {\n      console.warn('Could not detect user timezone, falling back to UTC');\n      setUserTimezone('UTC');\n    }\n  }, []);\n\n  // Update current time for real-time relative time updates\n  useEffect(() => {\n    // Update more frequently when tooltip is visible for real-time updates\n    const interval = setInterval(() => {\n      setCurrentTime(Date.now());\n    }, 1000); // Update every second for real-time display\n\n    return () => clearInterval(interval);\n  }, []);\n\n  // Handle null dates after hooks\n  if (!parsedDate) {\n    return (\n      <span className={`timestamp-with-tooltip ${className}`}>\n        Unknown time\n      </span>\n    );\n  }\n\n  // Debug logging for invalid dates\n  if (isNaN(parsedDate.getTime())) {\n    // eslint-disable-next-line no-console\n    console.error('TimestampWithTooltip: Invalid date received', {\n      originalDate: date,\n      parsedDate,\n      isValidDate: parsedDate instanceof Date && !isNaN(parsedDate.getTime()),\n      getTime: parsedDate?.getTime(),\n      stack: new Error().stack?.split('\\\\n').slice(0, 5).join('\\\\n')\n    });\n\n    return (\n      <span className={`timestamp-with-tooltip ${className}`}>\n        Invalid time\n      </span>\n    );\n  }\n\n  // Calculate time difference in various units\n  const getTimeUnits = (date: Date): TimeUnit[] => {\n    const now = currentTime;\n    const diff = now - date.getTime();\n    const absDiff = Math.abs(diff);\n    const isFuture = diff < 0;\n\n    // Debug logging for suspicious time calculations\n    if (absDiff <= 1000) {\n      // Less than 1 second difference\n      // eslint-disable-next-line no-console\n      // console.warn(\n      //   'TimestampWithTooltip: Very recent or future timestamp detected',\n      //   {\n      //     now,\n      //     dateTime: date.getTime(),\n      //     diff,\n      //     dateString: date.toISOString(),\n      //     isNaN: isNaN(date.getTime()),\n      //     isFuture,\n      //     stack: new Error().stack?.split('\\\\n').slice(0, 3).join('\\\\n')\n      //   }\n      // );\n    }\n\n    // For very small differences (less than 1 second), treat as \\\"now\\\"\n    if (absDiff < 1000) return [{ value: 0, unit: 'seconds', isFuture }];\n\n    const units = [\n      {\n        value: Math.floor(absDiff / (365 * 24 * 60 * 60 * 1000)),\n        unit: 'years'\n      },\n      {\n        value: Math.floor(\n          (absDiff % (365 * 24 * 60 * 60 * 1000)) / (30 * 24 * 60 * 60 * 1000)\n        ),\n        unit: 'months'\n      },\n      {\n        value: Math.floor(\n          (absDiff % (30 * 24 * 60 * 60 * 1000)) / (7 * 24 * 60 * 60 * 1000)\n        ),\n        unit: 'weeks'\n      },\n      {\n        value: Math.floor(\n          (absDiff % (7 * 24 * 60 * 60 * 1000)) / (24 * 60 * 60 * 1000)\n        ),\n        unit: 'days'\n      },\n      {\n        value: Math.floor((absDiff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000)),\n        unit: 'hours'\n      },\n      {\n        value: Math.floor((absDiff % (60 * 60 * 1000)) / (60 * 1000)),\n        unit: 'minutes'\n      },\n      { value: Math.floor((absDiff % (60 * 1000)) / 1000), unit: 'seconds' }\n    ];\n\n    const nonZeroUnits = units.filter((unit) => unit.value > 0);\n\n    // Mark units as future if the timestamp is in the future\n    return nonZeroUnits.map((unit) => ({\n      ...unit,\n      isFuture\n    }));\n  };\n\n  // Format abbreviated time with fixed width for footer\n  const formatAbbreviatedTime = (date: Date): string => {\n    const units = getTimeUnits(date);\n\n    if (units.length === 0) {\n      return 'now';\n    }\n\n    // Take only the largest unit for abbreviated display\n    const largestUnit = units[0];\n    const value = largestUnit.value;\n    const unit = largestUnit.unit;\n    const isFuture = largestUnit.isFuture;\n\n    // Use consistent abbreviations with fixed character width\n    let timeStr = '';\n    switch (unit) {\n      case 'years':\n        timeStr = `${value}y`;\n        break;\n      case 'months':\n        timeStr = `${value}mo`;\n        break;\n      case 'weeks':\n        timeStr = `${value}w`;\n        break;\n      case 'days':\n        timeStr = `${value}d`;\n        break;\n      case 'hours':\n        timeStr = `${value}h`;\n        break;\n      case 'minutes':\n        timeStr = `${value}m`;\n        break;\n      case 'seconds':\n        timeStr = `${value}s`;\n        break;\n      default:\n        return 'now';\n    }\n\n    return isFuture ? `in ${timeStr}` : timeStr;\n  };\n\n  // Format relative time with two precision units\n  const formatRelativeTime = (date: Date): string => {\n    const units = getTimeUnits(date);\n\n    if (units.length === 0) {\n      return 'just now';\n    }\n\n    // Take first two non-zero units for precision\n    const significantUnits = units.slice(0, 2);\n    const isFuture = significantUnits[0]?.isFuture;\n\n    const parts = significantUnits.map((unit) => {\n      const value = unit.value;\n      const unitName = value === 1 ? unit.unit.slice(0, -1) : unit.unit; // Remove 's' for singular\n      return `${value} ${unitName}`;\n    });\n\n    const timeStr = parts.join(' and ');\n    return isFuture ? `in ${timeStr}` : `${timeStr} ago`;\n  };\n\n  // Format full timestamp for tooltip\n  const formatFullTimestamp = (date: Date): string => {\n    const units = getTimeUnits(date);\n\n    if (units.length === 0) {\n      return 'just now';\n    }\n\n    const isFuture = units[0]?.isFuture;\n\n    const parts = units.map((unit) => {\n      const value = unit.value;\n      const unitName = value === 1 ? unit.unit.slice(0, -1) : unit.unit;\n      return `${value} ${unitName}`;\n    });\n\n    const timeStr = parts.join(', ');\n    return isFuture ? `in ${timeStr}` : `${timeStr} ago`;\n  };\n\n  // Create tooltip content\n  const tooltipContent = (\n    <div>\n      <div\n        style={{\n          padding: '10px 12px',\n          borderBottom:\n            '1px solid var(--glass-border-overlay-light, var(--brand-tertiary--light))',\n          marginBottom: '6px'\n        }}\n      >\n        <h4\n          style={{\n            margin: '0 0 6px 0',\n            fontSize: '13px',\n            fontWeight: '600',\n            color: 'white'\n          }}\n        >\n          Exact Time\n        </h4>\n        <div\n          style={{\n            fontSize: '12px',\n            color: 'rgba(255, 255, 255, 0.8)',\n            wordWrap: 'break-word'\n          }}\n        >\n          {formatFullTimestamp(parsedDate)}\n        </div>\n      </div>\n\n      <div style={{ padding: '0 12px 10px' }}>\n        <div\n          style={{\n            marginBottom: '6px',\n            fontSize: '11px',\n            fontWeight: '500',\n            color: 'white'\n          }}\n        >\n          UTC Time\n        </div>\n        <div\n          style={{\n            fontSize: '12px',\n            color: 'rgba(255, 255, 255, 0.8)',\n            fontFamily: 'var(--font-mono, monospace)',\n            wordWrap: 'break-word'\n          }}\n        >\n          {formatInTimeZone(parsedDate, 'UTC', 'yyyy-MM-dd HH:mm:ss')} UTC\n        </div>\n      </div>\n\n      <div style={{ padding: '0 12px 10px' }}>\n        <div\n          style={{\n            marginBottom: '6px',\n            fontSize: '11px',\n            fontWeight: '500',\n            color: 'white'\n          }}\n        >\n          Your Local Time ({userTimezone})\n        </div>\n        <div\n          style={{\n            fontSize: '12px',\n            color: 'rgba(255, 255, 255, 0.8)',\n            fontFamily: 'var(--font-mono, monospace)',\n            wordWrap: 'break-word'\n          }}\n        >\n          {formatInTimeZone(\n            parsedDate,\n            userTimezone,\n            'yyyy-MM-dd HH:mm:ss zzz'\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  const relativeTime = abbreviated\n    ? formatAbbreviatedTime(parsedDate)\n    : formatRelativeTime(parsedDate);\n\n  return (\n    <InteractiveTooltip\n      content={tooltipContent}\n      isInsideParagraph={true}\n      delay={200}\n      className=\\\"timestamp-tooltip timestamp-tooltip-wrapper\\\"\n    >\n      <span\n        className={`timestamp-with-tooltip ${abbreviated ? 'abbreviated' : ''} ${className}`}\n        style={{\n          cursor: 'help',\n          textDecoration: 'underline',\n          textDecorationStyle: 'dotted',\n          textUnderlineOffset: '2px'\n        }}\n      >\n        {relativeTime}\n      </span>\n    </InteractiveTooltip>\n  );\n};\n",
    "language":"typescript",
    "lines":355,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/SmartPillInput.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { ContentWithPills } from './ContentWithPills';\nimport { SmartInput } from './SmartInput';\nimport './SmartPillInput.css';\n\nconst logger = createLogger({\n  context: { component: 'SmartPillInput' }\n});\n\nexport interface SmartPillInputProps {\n  value: string;\n  onChange: (value: string) => void;\n  onEditValueChange?: (editValue: string) => void;\n  onPillClick?: (pillText: string, action: 'edit' | 'remove') => void;\n  placeholder?: string;\n  className?: string;\n  disabled?: boolean;\n  contextId: string;\n  enableHashtags?: boolean;\n  enableUserMentions?: boolean;\n  onHashtagClick?: (hashtag: string) => void;\n  onMentionClick?: (\n    mention: string,\n    filterType?: 'author' | 'mentions'\n  ) => void;\n}\n\ninterface ParsedContent {\n  type: 'text' | 'hashtag' | 'mention';\n  content: string;\n  raw?: string;\n  filterType?: 'author' | 'mentions'; // For mention pills, store their specific filter type\n}\n\nexport const SmartPillInput: React.FC<SmartPillInputProps> = ({\n  value,\n  onChange,\n  onEditValueChange,\n  onPillClick,\n  placeholder,\n  className = '',\n  disabled = false,\n  contextId,\n  enableHashtags = true,\n  enableUserMentions = true,\n  onHashtagClick,\n  onMentionClick\n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(value);\n  const [newInputValue, setNewInputValue] = useState(''); // For new text being typed\n  const [hasSuggestions, setHasSuggestions] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const smartInputRef = useRef<HTMLDivElement>(null);\n\n  // Parse the value into segments for pill rendering\n  const parseContent = (text: string): ParsedContent[] => {\n    if (!text) return [];\n\n    const segments: ParsedContent[] = [];\n    let currentIndex = 0;\n\n    // Enhanced regex to match hashtags and structured mentions only (prevent false positives)\n    const pillRegex = /(#\\\\w+)|(@\\\\[[^\\\\]]+\\\\])/g;\n    let match;\n\n    logger.debug('SmartPillInput parseContent', {\n      text,\n      pillRegex: pillRegex.source\n    });\n\n    while ((match = pillRegex.exec(text)) !== null) {\n      // Add text before the match\n      if (match.index > currentIndex) {\n        const textContent = text.slice(currentIndex, match.index);\n        if (textContent) {\n          segments.push({ type: 'text', content: textContent });\n          logger.debug('Added text segment', {\n            textContent,\n            index: match.index,\n            currentIndex\n          });\n        }\n      }\n\n      const matchedText = match[0];\n\n      if (matchedText.startsWith('#')) {\n        segments.push({ type: 'hashtag', content: matchedText });\n        logger.debug('Added hashtag segment', { matchedText });\n      } else if (matchedText.startsWith('@[')) {\n        // Enhanced mention format: @[username|userId] or @[username|userId|filterType]\n        const enhancedMatch = matchedText.match(\n          /^@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]$/\n        );\n        if (enhancedMatch) {\n          const [, username, userId, filterType] = enhancedMatch;\n          // Pass the clean @username format to ContentWithPills for display\n          segments.push({\n            type: 'mention',\n            content: `@${username}`,\n            raw: matchedText, // Keep the original structured format\n            filterType: (filterType as 'author' | 'mentions') || 'author' // Default to author\n          });\n          logger.debug('Added mention segment', {\n            username,\n            userId,\n            filterType,\n            matchedText\n          });\n        } else {\n          // Fallback for legacy format @[username|userId]\n          const legacyMatch = matchedText.match(/^@\\\\[([^|]+)\\\\|([^\\\\]]+)\\\\]$/);\n          if (legacyMatch) {\n            const [, username, userId] = legacyMatch;\n            segments.push({\n              type: 'mention',\n              content: `@${username}`,\n              raw: matchedText,\n              filterType: 'author' // Default to author for legacy format\n            });\n            logger.debug('Added legacy mention segment', {\n              username,\n              userId,\n              matchedText\n            });\n          } else {\n            // Fallback if parsing fails\n            segments.push({\n              type: 'mention',\n              content: matchedText,\n              raw: matchedText,\n              filterType: 'author'\n            });\n            logger.debug('Added fallback mention segment', { matchedText });\n          }\n        }\n      }\n\n      currentIndex = match.index + matchedText.length;\n    }\n\n    // Add remaining text\n    if (currentIndex < text.length) {\n      const remainingText = text.slice(currentIndex);\n      if (remainingText) {\n        segments.push({ type: 'text', content: remainingText });\n        logger.debug('Added remaining text segment', {\n          remainingText,\n          currentIndex,\n          textLength: text.length\n        });\n      }\n    }\n\n    logger.debug('SmartPillInput parseContent result', { segments });\n    // eslint-disable-next-line no-console\n    // console.log('SmartPillInput parseContent debug:', { text, segments });\n    return segments;\n  };\n\n  const handleContainerClick = () => {\n    if (!disabled && !isEditing && !isValueEmpty) {\n      setIsEditing(true);\n\n      // Parse the current value to separate pills from text\n      const segments = parseContent(value);\n      const pillSegments = segments.filter(\n        (s) => s.type === 'hashtag' || s.type === 'mention'\n      );\n      const textSegments = segments.filter((s) => s.type === 'text');\n\n      // Reconstruct pills-only value for editValue\n      const pillsValue = pillSegments.map((s) => s.raw || s.content).join(' ');\n\n      // Combine all text segments for newInputValue\n      const textValue = textSegments\n        .map((s) => s.content)\n        .join(' ')\n        .trim();\n\n      setEditValue(pillsValue);\n      setNewInputValue(textValue);\n\n      logger.debug('SmartPillInput entering edit mode', {\n        originalValue: value,\n        segments,\n        pillsValue,\n        textValue\n      });\n\n      // Notify parent of the current text being edited\n      if (onEditValueChange) {\n        onEditValueChange(textValue);\n      }\n\n      // Focus the input after entering edit mode\n      setTimeout(() => {\n        const input = smartInputRef.current?.querySelector('input');\n        if (input) {\n          input.focus();\n        }\n      }, 0);\n    }\n  };\n\n  // Check if the input should start in editing mode\n  const isValueEmpty = !value || value.trim() === '';\n\n  const handleSmartInputChange = (newValue: string) => {\n    setNewInputValue(newValue);\n\n    // Combine existing pills with new input and update editValue immediately\n    const combinedValue = editValue + (newValue ? ' ' + newValue : '');\n\n    // Check if the new input contains complete pills (hashtags or structured mentions)\n    // Only auto-create pills for:\n    // 1. Structured mentions from suggestions: @[username|userId]\n    // 2. Hashtags that end with a space (indicating completion/selection)\n    const hasCompletePill =\n      /@\\\\[[^\\\\]]+\\\\]$/.test(newValue.trim()) || // Structured mentions\n      (/^#\\\\w+\\\\s$/.test(newValue) && newValue.trim().length > 2); // Hashtags ending with space, 3+ chars total\n\n    if (hasCompletePill) {\n      const newPill = newValue.trim();\n\n      // Check for duplicates - parse existing content to get all current pills\n      const existingSegments = parseContent(editValue);\n      const existingPills = existingSegments\n        .filter(\n          (segment) => segment.type === 'hashtag' || segment.type === 'mention'\n        )\n        .map((segment) => segment.raw || segment.content);\n\n      // For mentions, we need to check both the structured format and display format\n      const isDuplicate = existingPills.some((existingPill) => {\n        if (newPill.startsWith('@[') && existingPill.startsWith('@[')) {\n          // Both are structured mentions - compare the structured format\n          return newPill === existingPill;\n        } else if (newPill.startsWith('#') && existingPill.startsWith('#')) {\n          // Both are hashtags - direct comparison\n          return newPill === existingPill;\n        } else if (newPill.startsWith('@[') && existingPill.startsWith('@')) {\n          // New is structured, existing might be display format - extract username from structured\n          const usernameMatch = newPill.match(/@\\\\[([^|]+)\\\\|/);\n          const username = usernameMatch ? usernameMatch[1] : '';\n          return existingPill === `@${username}`;\n        } else if (existingPill.startsWith('@[') && newPill.startsWith('@')) {\n          // Existing is structured, new might be display format\n          const usernameMatch = existingPill.match(/@\\\\[([^|]+)\\\\|/);\n          const username = usernameMatch ? usernameMatch[1] : '';\n          return newPill === `@${username}`;\n        }\n        return false;\n      });\n\n      if (!isDuplicate) {\n        // If not duplicate, add it to editValue and clear newInputValue\n        const newEditValue = editValue + (editValue ? ' ' : '') + newPill;\n        setEditValue(newEditValue);\n        setNewInputValue('');\n\n        if (onEditValueChange) {\n          onEditValueChange(newEditValue); // Pass the updated edit value with the new pill\n        }\n      } else {\n        // If duplicate, just clear the input without adding\n        setNewInputValue('');\n\n        if (onEditValueChange) {\n          onEditValueChange(editValue); // Pass existing pills so parent knows complete content\n        }\n      }\n    } else {\n      // Notify parent of edit value changes for mode indicators\n      // Pass the complete combined value so parent can process all pills\n      const combinedForParent =\n        editValue + (newValue ? (editValue ? ' ' : '') + newValue : '');\n      if (onEditValueChange) {\n        onEditValueChange(combinedForParent.trim());\n      }\n    }\n  };\n\n  // Monitor for suggestion dropdown visibility\n  useEffect(() => {\n    if (!isEditing || !smartInputRef.current) return;\n\n    const observer = new MutationObserver(() => {\n      const suggestionList =\n        smartInputRef.current?.querySelector('.suggestion-list');\n      setHasSuggestions(!!suggestionList);\n    });\n\n    observer.observe(smartInputRef.current, {\n      childList: true,\n      subtree: true\n    });\n\n    return () => observer.disconnect();\n  }, [isEditing]);\n\n  // Update edit value when prop value changes\n  useEffect(() => {\n    // Always sync when parent explicitly clears the value (empty string)\n    if (value === '') {\n      setEditValue('');\n      setNewInputValue('');\n      logger.debug('SmartPillInput cleared values due to empty prop value');\n    } else if (!isEditing && !hasSuggestions) {\n      // Only sync non-empty values when not editing AND no suggestions are visible\n      // This prevents interference during suggestion selection\n      setEditValue(value);\n      logger.debug(\n        'SmartPillInput synced with prop value (not editing, no suggestions)',\n        {\n          value\n        }\n      );\n    }\n    // When editing or suggestions are visible, completely ignore prop value changes\n    // This prevents the input from becoming inactive when filters are processed\n    // or when user is actively selecting from suggestions\n  }, [value, isEditing, hasSuggestions]);\n\n  // Commit changes\n  const handleCommit = useCallback(() => {\n    const finalValue =\n      editValue + (newInputValue ? (editValue ? ' ' : '') + newInputValue : '');\n\n    onChange(finalValue.trim());\n    setIsEditing(false);\n    setEditValue('');\n    setNewInputValue('');\n    if (onEditValueChange) {\n      onEditValueChange('');\n    }\n  }, [editValue, newInputValue, onChange, onEditValueChange]);\n\n  // Cancel changes\n  const handleCancel = useCallback(() => {\n    setIsEditing(false);\n    setEditValue('');\n    setNewInputValue('');\n    if (onEditValueChange) {\n      onEditValueChange('');\n    }\n  }, [onEditValueChange]);\n\n  // Handle clicks outside to commit changes\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (!isEditing) return;\n\n      const target = e.target as Element;\n\n      // Don't commit if clicking form buttons\n      if (target?.closest('button[type=\\\"submit\\\"]')) {\n        return;\n      }\n\n      if (containerRef.current && !containerRef.current.contains(target)) {\n        handleCommit();\n      }\n    };\n\n    if (isEditing) {\n      document.addEventListener('click', handleClickOutside);\n\n      // Auto-focus input\n      setTimeout(() => {\n        containerRef.current?.querySelector('input')?.focus();\n      }, 0);\n    }\n\n    return () => document.removeEventListener('click', handleClickOutside);\n  }, [isEditing, handleCommit]);\n\n  // Handle pill click to remove the clicked pill\n  const handlePillClick = (pillText: string) => {\n    // // console.log(\n    //   'DEBUG: handlePillClick called with:',\n    //   pillText,\n    //   'isEditing:',\n    //   isEditing,\n    //   'value:',\n    //   value\n    // );\n\n    const pillTextTrimmed = pillText.trim();\n    // // console.log('DEBUG: Removing pill:', pillTextTrimmed);\n\n    // Remove the pill directly from the appropriate state\n    let currentValue = value;\n\n    // If we're in edit mode, work with editValue\n    if (isEditing) {\n      currentValue = editValue;\n      // // console.log('DEBUG: Using editValue for removal:', editValue);\n    }\n\n    // Split into segments and filter out the exact pill\n    const segments = currentValue\n      .split(/\\\\s+/)\n      .filter((segment) => segment.trim() !== '');\n    const filteredSegments = segments.filter(\n      (segment) => segment !== pillTextTrimmed\n    );\n    const newValue = filteredSegments.join(' ').trim();\n\n    // // console.log(\n    //   'DEBUG: segments:',\n    //   segments,\n    //   'filteredSegments:',\n    //   filteredSegments,\n    //   'newValue:',\n    //   newValue\n    // );\n\n    if (isEditing) {\n      // Update edit value\n      setEditValue(newValue);\n\n      // Also clear newInputValue if it matches the pill\n      if (newInputValue.trim() === pillTextTrimmed) {\n        // // console.log('DEBUG: Clearing newInputValue because it matches pill');\n        setNewInputValue('');\n      }\n\n      // Call onEditValueChange with the updated value\n      if (onEditValueChange) {\n        const combinedValue =\n          newValue +\n          (newInputValue && newInputValue.trim() !== pillTextTrimmed\n            ? (newValue ? ' ' : '') + newInputValue\n            : '');\n        // // console.log(\n        //   'DEBUG: Calling onEditValueChange with:',\n        //   combinedValue.trim()\n        // );\n        onEditValueChange(combinedValue.trim());\n      }\n    } else {\n      // Update main value immediately - this will trigger parent to update\n      // // console.log('DEBUG: Calling onChange with:', newValue);\n      onChange(newValue);\n    }\n\n    // Also call the onPillClick callback if provided (for additional handling)\n    if (onPillClick) {\n      // // console.log('DEBUG: Also calling onPillClick callback');\n      onPillClick(pillText, 'remove');\n    }\n  };\n\n  const parsedSegments = parseContent(value);\n  const editParsedSegments = parseContent(editValue); // Parse current edit state\n  const isEmpty = !value || value.trim() === '';\n\n  // Extract existing pills to exclude from search results\n  const extractExistingPills = (segments: ParsedContent[]) => {\n    const hashtags: string[] = [];\n    const userIds: string[] = [];\n\n    segments.forEach((segment) => {\n      if (segment.type === 'hashtag') {\n        hashtags.push(segment.content);\n      } else if (segment.type === 'mention') {\n        // Extract user ID from structured mention format @[username|userId|filterType]\n        if (segment.raw && segment.raw.includes('|')) {\n          const userIdMatch = segment.raw.match(\n            /@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]/\n          );\n          if (userIdMatch) {\n            // userIdMatch[1] is username, userIdMatch[2] is userId, userIdMatch[3] is filterType (optional)\n            userIds.push(userIdMatch[2]);\n          }\n        }\n      }\n    });\n\n    return { hashtags, userIds };\n  };\n\n  // Get existing pills from current edit state\n  const { hashtags: existingHashtags, userIds: existingUserIds } =\n    extractExistingPills(editParsedSegments);\n\n  // Handle filter type toggle for mention pills\n  const handleFilterTypeToggle = (index: number, segment: ParsedContent) => {\n    if (segment.type !== 'mention') return;\n\n    const newFilterType =\n      segment.filterType === 'author' ? 'mentions' : 'author';\n\n    if (isEditing) {\n      // Update the segment in editValue\n      const updatedSegments = editParsedSegments.map((seg, i) => {\n        if (i === index && seg.type === 'mention') {\n          // Create new enhanced mention format with the toggled filter type\n          const rawMatch = seg.raw?.match(\n            /^@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]$/\n          );\n          if (rawMatch) {\n            const [, username, userId] = rawMatch;\n            const newRaw = `@[${username}|${userId}|${newFilterType}]`;\n            return {\n              ...seg,\n              raw: newRaw,\n              filterType: newFilterType\n            };\n          }\n        }\n        return seg;\n      });\n\n      // Reconstruct the editValue from updated segments\n      const newEditValue = updatedSegments\n        .map((seg) => {\n          if (seg.type === 'text') return seg.content;\n          return seg.raw || seg.content;\n        })\n        .join(' ')\n        .replace(/\\\\s+/g, ' ')\n        .trim();\n\n      setEditValue(newEditValue);\n\n      // Notify parent of the change\n      if (onEditValueChange) {\n        onEditValueChange(newEditValue);\n      }\n    } else {\n      // Update the segment in display mode (main value)\n      const updatedSegments = parsedSegments.map((seg, i) => {\n        if (i === index && seg.type === 'mention') {\n          // Create new enhanced mention format with the toggled filter type\n          const rawMatch = seg.raw?.match(\n            /^@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]$/\n          );\n          if (rawMatch) {\n            const [, username, userId] = rawMatch;\n            const newRaw = `@[${username}|${userId}|${newFilterType}]`;\n            return {\n              ...seg,\n              raw: newRaw,\n              filterType: newFilterType\n            };\n          }\n        }\n        return seg;\n      });\n\n      // Reconstruct the value from updated segments\n      const newValue = updatedSegments\n        .map((seg) => {\n          if (seg.type === 'text') return seg.content;\n          return seg.raw || seg.content;\n        })\n        .join(' ')\n        .replace(/\\\\s+/g, ' ')\n        .trim();\n\n      // Notify parent of the change\n      onChange(newValue);\n\n      // Also notify onMentionClick if provided\n      if (onMentionClick) {\n        const rawMatch = segment.raw?.match(\n          /^@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]$/\n        );\n        if (rawMatch) {\n          const [, username] = rawMatch;\n          const newRaw = `@[${username}|${rawMatch[2]}|${newFilterType}]`;\n          onMentionClick(newRaw, newFilterType);\n        }\n      }\n    }\n  };\n\n  return (\n    <div\n      ref={containerRef}\n      className={`smart-pill-input ${className} ${isEditing ? 'smart-pill-input--editing' : ''} ${\n        isEmpty ? 'smart-pill-input--empty' : ''\n      } ${hasSuggestions ? 'smart-pill-input--with-suggestions' : ''}`}\n    >\n      {isEditing || isValueEmpty ? (\n        <div className=\\\"smart-pill-input__edit-container\\\">\n          {/* Show existing pills in edit mode */}\n          {editParsedSegments.length > 0 && (\n            <div className=\\\"smart-pill-input__existing-pills\\\">\n              {editParsedSegments.map((segment, index) => {\n                if (segment.type === 'text') {\n                  return null; // Skip text segments in edit mode\n                } else if (segment.type === 'mention') {\n                  // For mention pills, show with external filter type control\n                  const contentForPills = segment.raw || segment.content;\n                  return (\n                    <div\n                      key={index}\n                      className=\\\"smart-pill-input__mention-pill-integrated\\\"\n                    >\n                      <ContentWithPills\n                        content={contentForPills}\n                        contextId={contextId}\n                        onHashtagClick={(hashtag) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput hashtag clicked:',\n                          //   hashtag,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        onMentionClick={(mention, filterType) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput mention clicked:',\n                          //   mention,\n                          //   'filterType:',\n                          //   filterType,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        className=\\\"smart-pill-input__pill smart-pill-input__pill--with-controls\\\"\n                        isFilterBarContext={true}\n                        enableInlineFilterControl={false}\n                      />\n                      {/* Integrated filter type toggle button */}\n                      <button\n                        type=\\\"button\\\"\n                        className={\n                          `smart-pill-input__filter-type-toggle ` +\n                          `smart-pill-input__filter-type-toggle--${segment.filterType} ` +\n                          `smart-pill-input__filter-type-toggle--integrated`\n                        }\n                        onClick={() => handleFilterTypeToggle(index, segment)}\n                        title={`Current: ${\n                          segment.filterType === 'author'\n                            ? 'Author'\n                            : 'Mentions'\n                        } filter. Click to toggle.`}\n                      >\n                        {segment.filterType === 'author' ? 'BY' : 'IN'}\n                      </button>\n                    </div>\n                  );\n                } else {\n                  // For hashtag pills, use the existing approach\n                  const contentForPills = segment.raw || segment.content;\n                  return (\n                    <div key={index} className=\\\"smart-pill-input__pill-wrapper\\\">\n                      <ContentWithPills\n                        content={contentForPills}\n                        contextId={contextId}\n                        onHashtagClick={(hashtag) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput hashtag clicked:',\n                          //   hashtag,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        onMentionClick={(mention, filterType) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput mention clicked:',\n                          //   mention,\n                          //   'filterType:',\n                          //   filterType,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        className=\\\"smart-pill-input__pill\\\"\n                        isFilterBarContext={true}\n                        enableInlineFilterControl={false}\n                      />\n                    </div>\n                  );\n                }\n              })}\n            </div>\n          )}\n\n          <div ref={smartInputRef} className=\\\"smart-pill-input__smart-input\\\">\n            {/* Input for new content */}\n            <SmartInput\n              value={newInputValue}\n              onChange={handleSmartInputChange}\n              placeholder={placeholder}\n              enableHashtags={enableHashtags}\n              enableUserMentions={enableUserMentions}\n              existingHashtags={existingHashtags}\n              existingUserIds={existingUserIds}\n            />\n          </div>\n        </div>\n      ) : (\n        <div\n          className=\\\"smart-pill-input__display\\\"\n          onClick={handleContainerClick}\n        >\n          {isEmpty ? (\n            <span className=\\\"smart-pill-input__placeholder\\\">{placeholder}</span>\n          ) : (\n            <div className=\\\"smart-pill-input__content\\\">\n              {parsedSegments.map((segment, index) => {\n                if (segment.type === 'text') {\n                  return (\n                    <span key={index} className=\\\"smart-pill-input__text\\\">\n                      {segment.content}\n                    </span>\n                  );\n                } else if (segment.type === 'mention') {\n                  // For mention pills in display mode, show with filter type indicator\n                  const contentForPills = segment.raw || segment.content;\n                  return (\n                    <div\n                      key={index}\n                      className=\\\"smart-pill-input__mention-pill-integrated\\\"\n                    >\n                      <ContentWithPills\n                        content={contentForPills}\n                        contextId={contextId}\n                        onHashtagClick={(hashtag) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput hashtag clicked:',\n                          //   hashtag,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        onMentionClick={(mention, filterType) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput mention clicked:',\n                          //   mention,\n                          //   'filterType:',\n                          //   filterType,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        className=\\\"smart-pill-input__pill smart-pill-input__pill--with-controls\\\"\n                        isFilterBarContext={true}\n                        enableInlineFilterControl={false}\n                      />\n                      {/* Clickable filter type toggle in display mode */}\n                      <button\n                        type=\\\"button\\\"\n                        className={\n                          `smart-pill-input__filter-type-toggle ` +\n                          `smart-pill-input__filter-type-toggle--${segment.filterType} ` +\n                          `smart-pill-input__filter-type-toggle--integrated`\n                        }\n                        onClick={(e) => {\n                          e.stopPropagation(); // Prevent triggering container click\n                          handleFilterTypeToggle(index, segment);\n                        }}\n                        title={`Current: ${\n                          segment.filterType === 'author'\n                            ? 'Author'\n                            : 'Mentions'\n                        } filter. Click to toggle.`}\n                      >\n                        {segment.filterType === 'author' ? 'BY' : 'IN'}\n                      </button>\n                    </div>\n                  );\n                } else {\n                  // For hashtag pills, use the existing approach\n                  const contentForPills = segment.raw || segment.content;\n                  return (\n                    <div key={index} className=\\\"smart-pill-input__pill-wrapper\\\">\n                      <ContentWithPills\n                        content={contentForPills}\n                        contextId={contextId}\n                        onHashtagClick={(hashtag) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput hashtag clicked:',\n                          //   hashtag,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        onMentionClick={(mention, filterType) => {\n                          // // console.log(\n                          //   'DEBUG: SmartPillInput mention clicked:',\n                          //   mention,\n                          //   'filterType:',\n                          //   filterType,\n                          //   'contentForPills:',\n                          //   contentForPills\n                          // );\n                          handlePillClick(contentForPills);\n                        }}\n                        className=\\\"smart-pill-input__pill\\\"\n                        isFilterBarContext={true}\n                        enableInlineFilterControl={false}\n                      />\n                    </div>\n                  );\n                }\n              })}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":821,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/NavigationLoadingBar.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useGlobalLoading } from '../../../lib/context/GlobalLoadingContext';\nimport { useNavigationLoading } from '../../../lib/context/NavigationLoadingContext';\nimport './NavigationLoadingBar.css';\n\nexport function NavigationLoadingBar() {\n  const { isNavigating, targetPath } = useNavigationLoading();\n  const { isLoading: isGlobalLoading, loadingMessage } = useGlobalLoading();\n\n  const [progress, setProgress] = useState(0);\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClient, setIsClient] = useState(false);\n\n  // Combine navigation and global loading states\n  const isAnyLoading = isNavigating || isGlobalLoading;\n  const displayMessage = targetPath\n    ? `Loading ${targetPath}...`\n    : loadingMessage;\n\n  // Ensure we only show on client to prevent hydration mismatches\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  useEffect(() => {\n    let progressInterval: ReturnType<typeof setInterval>;\n    let hideTimeout: ReturnType<typeof setTimeout>;\n\n    if (isAnyLoading && isClient) {\n      setIsVisible(true);\n      setProgress(10); // Start with 10%\n\n      // Simulate progress\n      progressInterval = setInterval(() => {\n        setProgress((prev) => {\n          if (prev < 90) {\n            return prev + Math.random() * 10;\n          }\n          return prev;\n        });\n      }, 200);\n    } else if (!isAnyLoading && isVisible) {\n      // Complete the progress bar\n      setProgress(100);\n\n      // Hide after animation completes\n      hideTimeout = setTimeout(() => {\n        setIsVisible(false);\n        setProgress(0);\n      }, 500);\n    }\n\n    return () => {\n      if (progressInterval) clearInterval(progressInterval);\n      if (hideTimeout) clearTimeout(hideTimeout);\n    };\n  }, [isAnyLoading, isClient, isVisible]);\n\n  // Don't render on server or if not visible\n  if (!isClient || !isVisible) return null;\n\n  return (\n    <div className=\\\"navigation-loading-bar\\\">\n      <div\n        className=\\\"navigation-loading-bar__progress\\\"\n        style={{ width: `${progress}%` }}\n      >\n        <div className=\\\"navigation-loading-bar__glow\\\" />\n      </div>\n      {displayMessage && (\n        <div className=\\\"navigation-loading-bar__info\\\">\n          <span className=\\\"navigation-loading-bar__text\\\">{displayMessage}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":80,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/SmartInput.tsx":{
    "content":"'use client';\n\nimport { forwardRef, useCallback, useImperativeHandle, useRef } from 'react';\nimport {\n  PaginatedHashtagResult,\n  PaginatedUserResult,\n  searchHashtags,\n  searchUsers\n} from '../../../lib/actions/search.actions';\nimport {\n  EmojiData,\n  EmojiPicker,\n  formatEmojiForText,\n  useEmojiPicker\n} from './EmojiPicker';\nimport {\n  InlineSuggestionInput,\n  InlineSuggestionInputProps,\n  SuggestionItem\n} from './InlineSuggestionInput';\n\nexport interface SmartInputProps\n  extends Omit<InlineSuggestionInputProps, 'onHashtagSearch' | 'onUserSearch'> {\n  enableHashtags?: boolean;\n  enableUserMentions?: boolean;\n  enableEmojis?: boolean;\n  enableImagePaste?: boolean;\n  existingHashtags?: string[]; // Hashtags to mark as disabled in search results\n  existingUserIds?: string[]; // User IDs to mark as disabled in search results\n}\n\nexport const SmartInput = forwardRef<\n  HTMLInputElement | HTMLTextAreaElement,\n  SmartInputProps\n>(\n  (\n    {\n      enableHashtags = true,\n      enableUserMentions = true,\n      enableEmojis = true,\n      enableImagePaste = true,\n      existingHashtags = [],\n      existingUserIds = [],\n      value,\n      onChange,\n      ...props\n    },\n    ref\n  ) => {\n    const internalRef = useRef<HTMLInputElement | HTMLTextAreaElement>(null);\n    const emojiPicker = useEmojiPicker();\n\n    // Expose the ref\n    useImperativeHandle(ref, () => internalRef.current!, []);\n\n    // Enhanced hashtag search function with pagination\n    const handleHashtagSearch = async (\n      query: string,\n      page: number = 1\n    ): Promise<{\n      items: SuggestionItem[];\n      hasMore: boolean;\n      total: number;\n    }> => {\n      if (!enableHashtags) {\n        return { items: [], hasMore: false, total: 0 };\n      }\n\n      try {\n        const result: PaginatedHashtagResult = await searchHashtags(\n          query,\n          page\n        );\n        const mappedResults = result.items.map((hashtagResult) => {\n          // Check if hashtag is already added\n          const hashtagValue = hashtagResult.value.startsWith('#')\n            ? hashtagResult.value\n            : `#${hashtagResult.value}`;\n          const isDisabled = existingHashtags.includes(hashtagValue);\n\n          return {\n            id: hashtagResult.id,\n            value: hashtagResult.value,\n            label: hashtagResult.label,\n            type: 'hashtag' as const,\n            disabled: isDisabled\n          };\n        });\n\n        return {\n          items: mappedResults,\n          hasMore: result.hasMore,\n          total: result.total\n        };\n      } catch (error) {\n        console.error('Error searching hashtags:', error);\n        return { items: [], hasMore: false, total: 0 };\n      }\n    };\n\n    // Enhanced user search function with pagination\n    const handleUserSearch = async (\n      query: string,\n      page: number = 1\n    ): Promise<{\n      items: SuggestionItem[];\n      hasMore: boolean;\n      total: number;\n    }> => {\n      if (!enableUserMentions) {\n        return { items: [], hasMore: false, total: 0 };\n      }\n\n      try {\n        const result: PaginatedUserResult = await searchUsers(query, page);\n        const mappedResults = result.items.map((userResult) => {\n          // Check if user is already added (by user ID)\n          const isDisabled = existingUserIds.includes(userResult.value);\n\n          return {\n            id: userResult.id,\n            value: userResult.value, // author_id for filtering\n            label: userResult.label,\n            displayName: userResult.displayName, // author name for display\n            avatar: userResult.avatar,\n            type: 'user' as const,\n            disabled: isDisabled\n          };\n        });\n\n        return {\n          items: mappedResults,\n          hasMore: result.hasMore,\n          total: result.total\n        };\n      } catch (error) {\n        console.error('Error searching users:', error);\n        return { items: [], hasMore: false, total: 0 };\n      }\n    };\n\n    // Handle emoji selection\n    const handleEmojiSelect = useCallback(\n      (emoji: EmojiData) => {\n        if (!internalRef.current) return;\n\n        const input = internalRef.current;\n        const currentValue = value || '';\n        const cursorPosition = input.selectionStart || 0;\n\n        // Find the colon trigger position\n        const beforeCursor = currentValue.slice(0, cursorPosition);\n        const colonIndex = beforeCursor.lastIndexOf(':');\n\n        if (colonIndex === -1) return;\n\n        // Replace from colon position to cursor with emoji\n        const emojiText = formatEmojiForText(emoji);\n        const newValue =\n          currentValue.slice(0, colonIndex) +\n          emojiText +\n          ' ' +\n          currentValue.slice(cursorPosition);\n\n        onChange(newValue);\n\n        // Set cursor position after emoji\n        setTimeout(() => {\n          const newCursorPosition = colonIndex + emojiText.length + 1;\n          input.setSelectionRange(newCursorPosition, newCursorPosition);\n          input.focus();\n        }, 0);\n      },\n      [value, onChange]\n    );\n\n    // Enhanced onChange to detect colon trigger for emojis\n    const handleChange = useCallback(\n      (newValue: string) => {\n        // First call the original onChange\n        onChange(newValue);\n\n        if (!enableEmojis || !internalRef.current) {\n          return;\n        }\n\n        const input = internalRef.current;\n        const cursorPosition = input.selectionStart || 0;\n        const beforeCursor = newValue.slice(0, cursorPosition);\n\n        // Check for colon trigger\n        const colonMatch = beforeCursor.match(/:(\\\\w*)$/);\n\n        if (colonMatch && enableEmojis) {\n          const [, searchQuery] = colonMatch;\n          const colonPosition = beforeCursor.lastIndexOf(':');\n\n          // Get position for emoji picker (relative to document, not viewport)\n          const rect = input.getBoundingClientRect();\n          const style = window.getComputedStyle(input);\n          const fontSize = parseFloat(style.fontSize);\n          const scrollX =\n            window.pageXOffset || document.documentElement.scrollLeft;\n          const scrollY =\n            window.pageYOffset || document.documentElement.scrollTop;\n\n          // Estimate character width (rough approximation)\n          const charWidth = fontSize * 0.6;\n          const x = Math.min(\n            rect.left + scrollX + colonPosition * charWidth,\n            window.innerWidth + scrollX - 320\n          );\n          const y = rect.bottom + scrollY + 5;\n\n          emojiPicker.openAt(x, y, searchQuery);\n        } else {\n          emojiPicker.close();\n        }\n      },\n      [onChange, enableEmojis, emojiPicker]\n    );\n\n    // Enhanced onChange with URL detection and auto-conversion\n    const handleChangeWithURLDetection = useCallback(\n      (newValue: string, previousValue?: string) => {\n        // First call the emoji detection\n        handleChange(newValue);\n\n        // Only check for URL conversion if we just added a space\n        const prevValue = previousValue || value || '';\n        if (newValue.length <= prevValue.length) {\n          return; // Don't convert on deletion\n        }\n\n        const lastChar = newValue[newValue.length - 1];\n        if (lastChar !== ' ') {\n          return; // Only convert when space is added\n        }\n\n        if (internalRef.current) {\n          const input = internalRef.current;\n          const cursorPosition = input.selectionStart || 0;\n\n          // Look for the word before the space\n          const beforeCursor = newValue.slice(0, cursorPosition - 1); // Exclude the space\n          const words = beforeCursor.split(/\\\\s+/);\n          const lastWord = words[words.length - 1];\n\n          // Check if the last word is a URL\n          if (lastWord) {\n            const urlRegex = /^https?:\\\\/\\\\/[^\\\\s<>\\\"{}|\\\\\\\\^`[\\\\]]+$/;\n            if (urlRegex.test(lastWord)) {\n              const url = lastWord;\n\n              // Import URL detection utilities\n              import('../../../lib/config/url-pills')\n                .then(({ findDomainConfig, createURLPill }) => {\n                  const domainConfig = findDomainConfig(url);\n                  if (domainConfig) {\n                    // Convert URL to pill format\n                    const pillFormat = createURLPill(\n                      url,\n                      domainConfig.defaultBehavior\n                    );\n\n                    // Replace the URL with the pill format\n                    const beforeUrl = beforeCursor.slice(\n                      0,\n                      beforeCursor.lastIndexOf(lastWord)\n                    );\n                    const afterCursor = newValue.slice(cursorPosition);\n                    const newContent =\n                      beforeUrl + pillFormat + ' ' + afterCursor;\n\n                    // Update the content\n                    onChange(newContent);\n\n                    // Set cursor position after the pill\n                    setTimeout(() => {\n                      const newCursorPosition =\n                        beforeUrl.length + pillFormat.length + 1;\n                      input.setSelectionRange(\n                        newCursorPosition,\n                        newCursorPosition\n                      );\n                      input.focus();\n                    }, 0);\n                  }\n                })\n                .catch((error) => {\n                  console.error('Failed to load URL pill utilities:', error);\n                });\n            }\n          }\n        }\n      },\n      [handleChange, onChange, value]\n    );\n\n    // Enhanced onChange wrapper that tracks previous value\n    const handleChangeWrapper = useCallback(\n      (newValue: string) => {\n        const prevValue = value;\n        handleChangeWithURLDetection(newValue, prevValue);\n      },\n      [handleChangeWithURLDetection, value]\n    );\n\n    // Handle clipboard paste events\n    const handlePaste = useCallback(\n      async (e: React.ClipboardEvent) => {\n        if (!enableImagePaste) return;\n\n        const clipboardData = e.clipboardData;\n        if (!clipboardData) return;\n\n        // Check if there are files in the clipboard\n        const files = Array.from(clipboardData.files);\n        const imageFiles = files.filter((file) =>\n          file.type.startsWith('image/')\n        );\n\n        if (imageFiles.length === 0) return;\n\n        // Prevent default paste behavior for images\n        e.preventDefault();\n\n        try {\n          // Process each image file\n          for (const file of imageFiles) {\n            // Convert file to data URL for temporary storage\n            const dataURL = await fileToDataURL(file);\n\n            // Create temporary image pill format\n            const tempImagePill = `![embed](data:temp-image;name=${encodeURIComponent(file.name)};${dataURL})`;\n\n            // Insert at current cursor position\n            if (internalRef.current) {\n              const input = internalRef.current;\n              const currentValue = value || '';\n              const cursorPosition = input.selectionStart || 0;\n\n              const before = currentValue.slice(0, cursorPosition);\n              const after = currentValue.slice(cursorPosition);\n\n              // Add spacing around the pill\n              const spacing =\n                before.length > 0 && !before.endsWith(' ') ? ' ' : '';\n              const newValue = before + spacing + tempImagePill + ' ' + after;\n\n              onChange(newValue);\n\n              // Set cursor position after the inserted pill\n              setTimeout(() => {\n                const newCursorPosition =\n                  before.length + spacing.length + tempImagePill.length + 1;\n                input.setSelectionRange(newCursorPosition, newCursorPosition);\n                input.focus();\n              }, 0);\n            }\n          }\n        } catch (error) {\n          console.error('Failed to process pasted image:', error);\n        }\n      },\n      [enableImagePaste, value, onChange]\n    );\n\n    // Helper function to convert file to data URL\n    const fileToDataURL = (file: File): Promise<string> => {\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n      });\n    };\n\n    return (\n      <>\n        <InlineSuggestionInput\n          {...props}\n          value={value}\n          onChange={handleChangeWrapper}\n          onPaste={handlePaste}\n          onHashtagSearch={enableHashtags ? handleHashtagSearch : undefined}\n          onUserSearch={enableUserMentions ? handleUserSearch : undefined}\n        />\n\n        {enableEmojis && (\n          <EmojiPicker\n            isOpen={emojiPicker.isOpen}\n            onClose={emojiPicker.close}\n            onEmojiSelect={handleEmojiSelect}\n            position={emojiPicker.position}\n            searchQuery={emojiPicker.searchQuery}\n          />\n        )}\n      </>\n    );\n  }\n);\n\nSmartInput.displayName = 'SmartInput';\n\n// Export both components for flexibility\nexport { InlineSuggestionInput };\nexport type { InlineSuggestionInputProps, SuggestionItem };\n",
    "language":"typescript",
    "lines":409,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/PostModal.tsx":{
    "content":"'use client';\n\nimport React from 'react';\nimport { useOverlay } from '../../../lib/context/OverlayContext';\nimport { EditSubmissionForm } from '../submission-forms/edit-submission-form/EditSubmissionForm';\nimport { SharedSubmissionForm } from '../submission-forms/shared-submission-form/SharedSubmissionForm';\nimport './PostModal.css';\n\ninterface PostModalProps {\n  mode: 'create' | 'view' | 'edit';\n  postId?: string;\n  title?: string;\n  content?: React.ReactNode;\n  onClose?: () => void;\n  // Edit mode props\n  submission?: {\n    submission_id: number;\n    submission_title: string;\n    submission_name: string;\n    tags: string[];\n  };\n}\n\nexport const PostModal: React.FC<PostModalProps> = ({\n  mode,\n  postId,\n  title,\n  content,\n  onClose,\n  submission\n}) => {\n  const { closeOverlay } = useOverlay();\n\n  const handleClose = () => {\n    if (onClose) {\n      onClose();\n    } else {\n      // Close via overlay system if no custom close handler\n      closeOverlay(`post-modal-${postId || mode}`);\n    }\n  };\n\n  const getModalTitle = () => {\n    if (title) return title;\n\n    switch (mode) {\n      case 'create':\n        return 'Create New Post';\n      case 'edit':\n        return 'Edit Post';\n      case 'view':\n        return 'View Post';\n      default:\n        return 'Post';\n    }\n  };\n\n  const renderContent = () => {\n    if (content) {\n      return content;\n    }\n\n    switch (mode) {\n      case 'create':\n        return <SharedSubmissionForm mode=\\\"create\\\" onSuccess={handleClose} />;\n      case 'edit':\n        if (!submission) {\n          return <div>Error: No submission data provided for edit mode</div>;\n        }\n        return (\n          <EditSubmissionForm\n            submission={submission}\n            onSuccess={handleClose}\n            onCancel={handleClose}\n          />\n        );\n      case 'view':\n        // TODO: Implement post view\n        return <div>Post view coming soon...</div>;\n      default:\n        return <div>Unknown mode</div>;\n    }\n  };\n\n  return (\n    <div className=\\\"post-modal\\\">\n      <div className=\\\"post-modal__header\\\">\n        <h2 className=\\\"post-modal__title\\\">{getModalTitle()}</h2>\n        <button\n          className=\\\"post-modal__close\\\"\n          onClick={handleClose}\n          aria-label=\\\"Close modal\\\"\n        >\n          <svg\n            width=\\\"20\\\"\n            height=\\\"20\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          >\n            <line x1=\\\"18\\\" y1=\\\"6\\\" x2=\\\"6\\\" y2=\\\"18\\\" />\n            <line x1=\\\"6\\\" y1=\\\"6\\\" x2=\\\"18\\\" y2=\\\"18\\\" />\n          </svg>\n        </button>\n      </div>\n      <div className=\\\"post-modal__content\\\">{renderContent()}</div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":113,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/ContentWithPills.tsx":{
    "content":"/* eslint-disable custom-rules/enforce-link-target-blank */\n'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { usePathname, useRouter, useSearchParams } from 'next/navigation';\nimport React, { Suspense, useCallback, useMemo } from 'react';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport {\n  ContentParser,\n  ContentSegment\n} from '../../../lib/utils/content-parsers';\nimport { InteractiveTooltip } from '../tooltip/InteractiveTooltip';\nimport './ContentWithPills.css';\nimport { InstantLink } from './InstantLink';\nimport { URLPill } from './URLPill';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'ContentWithPills',\n    module: 'components/ui'\n  }\n});\n\ninterface ContentWithPillsProps {\n  content: string;\n  onHashtagClick?: (hashtag: string) => void;\n  onMentionClick?: (mention: string, filterType: 'author' | 'mentions') => void;\n  onURLClick?: (url: string, behavior: string) => void;\n  onURLBehaviorChange?: (oldContent: string, newContent: string) => void;\n  onURLRemove?: () => void;\n  className?: string;\n  contextId: string;\n  isFilterBarContext?: boolean;\n  enableInlineFilterControl?: boolean;\n  isEditMode?: boolean;\n}\n\n/**\n * Internal ContentWithPills component that uses useSearchParams\n */\nfunction ContentWithPillsInternal({\n  content,\n  onHashtagClick,\n  onMentionClick,\n  onURLClick,\n  onURLBehaviorChange,\n  onURLRemove,\n  className = '',\n  contextId,\n  isFilterBarContext = false,\n  enableInlineFilterControl = false,\n  isEditMode = false\n}: ContentWithPillsProps) {\n  const pathname = usePathname();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n\n  /**\n   * Parse content using modular parsers with strict precedence:\n   * 1. Structured URL Pills (highest priority)\n   * 2. Hashtags\n   * 3. Mentions\n   * 4. Fallback URLs (only in remaining text)\n   */\n  const parseContent = (text: string): ContentSegment[] => {\n    return ContentParser.parse(text);\n  };\n\n  // Memoize the parsing result\n  const segments = useMemo(() => parseContent(content), [content]);\n\n  // Memoize URL generation to prevent recreation on every render\n  const generatePillUrl = useCallback(\n    (\n      type: 'hashtag' | 'mention',\n      value: string,\n      segment?: ContentSegment\n    ): string => {\n      const params = new URLSearchParams(searchParams);\n\n      if (isFilterBarContext) {\n        // Remove filters in filter bar context\n        if (type === 'hashtag') {\n          const currentTags = params.get('tags');\n          if (currentTags) {\n            const hashtagValue = value; // URL stores tags without # prefix now\n            const tags = currentTags\n              .split(',')\n              .filter((tag) => tag !== hashtagValue);\n            if (tags.length > 0) {\n              params.set('tags', tags.join(','));\n            } else {\n              params.delete('tags');\n            }\n          }\n        } else if (type === 'mention') {\n          params.delete('author');\n          params.delete('mentions');\n        }\n      } else {\n        // Add filters in normal context\n        if (type === 'hashtag') {\n          const currentTags = params.get('tags');\n          const hashtagValue = value; // Use value without # for URL (cleaner URLs)\n          if (currentTags && !currentTags.split(',').includes(hashtagValue)) {\n            params.set('tags', `${currentTags},${hashtagValue}`);\n          } else if (!currentTags) {\n            params.set('tags', hashtagValue);\n          }\n        } else if (type === 'mention' && pathname === NAV_PATHS.POSTS) {\n          // Always use userId for author filtering (required)\n          if (segment?.userId) {\n            params.set('author', segment.userId);\n          }\n          // If no userId available, skip filtering (embedded data should always have userId)\n        }\n      }\n\n      params.set('page', '1');\n\n      if (type === 'hashtag' && pathname.startsWith('/t/')) {\n        return `${NAV_PATHS.POSTS}?${params.toString()}`;\n      }\n\n      return `${pathname}?${params.toString()}`;\n    },\n    [searchParams, isFilterBarContext, pathname]\n  );\n\n  // Memoize pill click handler\n  const handlePillClick = useCallback(\n    async (\n      type: 'hashtag' | 'mention',\n      value: string,\n      event: React.MouseEvent,\n      segment?: ContentSegment\n    ) => {\n      event.preventDefault();\n\n      // In edit mode (submission forms), user mention pills should not have click behavior\n      // They should only be deletable via external remove buttons\n      if (isEditMode && type === 'mention') {\n        return; // No click behavior for mention pills in edit mode\n      }\n\n      if (isFilterBarContext) {\n        // Filter bar context - trigger removal\n        // The FilterLabel component will handle using the correct stored values\n        if (type === 'hashtag' && onHashtagClick) {\n          onHashtagClick(`#${value}`);\n        } else if (type === 'mention' && onMentionClick) {\n          // Just trigger the callback - FilterLabel will use the stored values\n          onMentionClick(value, segment?.filterType || 'author');\n        }\n        return;\n      }\n\n      // Normal context - trigger add\n      if (type === 'hashtag' && onHashtagClick) {\n        onHashtagClick(`#${value}`);\n      } else if (type === 'mention' && onMentionClick && segment?.userId) {\n        // Always use userId for author filtering\n        onMentionClick(segment.userId, 'author');\n      } else if (\n        type === 'hashtag' &&\n        pathname.startsWith('/t/') &&\n        !onHashtagClick\n      ) {\n        // For thread pages without callback, navigate to posts with filter\n        const params = new URLSearchParams();\n        params.set('tags', value);\n        params.set('page', '1');\n        router.push(`${NAV_PATHS.POSTS}?${params.toString()}`);\n      } else if (\n        type === 'mention' &&\n        pathname === NAV_PATHS.POSTS &&\n        segment?.userId\n      ) {\n        // Direct navigation - only with userId\n        const params = new URLSearchParams(searchParams);\n        params.set('author', segment.userId);\n        params.set('page', '1');\n        router.push(`${pathname}?${params.toString()}`);\n      }\n    },\n    [\n      isEditMode, // Add isEditMode to dependencies\n      isFilterBarContext,\n      onHashtagClick,\n      onMentionClick,\n      pathname,\n      searchParams,\n      router\n    ]\n  );\n\n  // Memoize active filter check\n  const isActiveFilter = useCallback(\n    (\n      type: 'hashtag' | 'mention',\n      value: string,\n      segment?: ContentSegment\n    ): boolean => {\n      if (type === 'hashtag') {\n        const currentTags = searchParams.get('tags');\n        const hashtagValue = value; // URL stores tags without # prefix now\n        return currentTags\n          ? currentTags.split(',').includes(hashtagValue)\n          : false;\n      } else if (type === 'mention' && segment?.userId) {\n        const currentAuthor = searchParams.get('author');\n        const currentMentions = searchParams.get('mentions');\n\n        if (!currentAuthor && !currentMentions) return false;\n\n        // Ensure values are strings and trim whitespace\n        const normalizedSegmentUserId = String(segment.userId).trim();\n        const normalizedSegmentUsername = String(segment.value).trim();\n\n        // Check if this mention matches the active author filter (filtering by who wrote posts)\n        if (currentAuthor) {\n          const normalizedCurrentAuthor = String(currentAuthor).trim();\n          if (normalizedCurrentAuthor === normalizedSegmentUserId) {\n            return true;\n          }\n        }\n\n        // Check if this mention matches the active mentions filter (filtering by who is mentioned in content)\n        if (currentMentions) {\n          const normalizedCurrentMentions = String(currentMentions).trim();\n          if (normalizedCurrentMentions === normalizedSegmentUsername) {\n            return true;\n          }\n        }\n\n        return false;\n      }\n      return false;\n    },\n    [searchParams]\n  );\n\n  // Memoize filter handlers\n  const createFilterHandler = useCallback(\n    (segment: ContentSegment, filterType: 'author' | 'mentions') => {\n      return () => {\n        if (onMentionClick) {\n          // For author filters: use userId (who wrote the posts)\n          // For mentions filters: use username (who is mentioned in content)\n          if (filterType === 'author') {\n            // Author filter needs userId\n            const authorValue = segment.userId || segment.value;\n            onMentionClick(authorValue, filterType);\n          } else {\n            // Mentions filter needs username\n            const mentionValue = segment.displayName || segment.value;\n            onMentionClick(mentionValue, filterType);\n          }\n        }\n      };\n    },\n    [onMentionClick]\n  );\n\n  // Memoize tooltip content\n  const createMentionTooltipContent = useCallback(\n    (segment: ContentSegment) => {\n      const username = segment.displayName || segment.value;\n\n      // Create a component that accepts closeTooltip prop\n      const MentionTooltipContent = ({\n        closeTooltip\n      }: {\n        closeTooltip?: () => void;\n      }) => (\n        <div className=\\\"mention-tooltip-content\\\">\n          <div className=\\\"mention-tooltip__header\\\">Filter by @{username}</div>\n          <div className=\\\"mention-tooltip__options\\\">\n            <button\n              className=\\\"mention-tooltip__option mention-tooltip__option--primary\\\"\n              onClick={() => {\n                createFilterHandler(segment, 'author')();\n                closeTooltip?.();\n              }}\n              title=\\\"Show posts authored by this user\\\"\n            >\n              <span className=\\\"mention-tooltip__icon\\\">\ud83d\udc64</span>\n              <div>\n                Filter by Author\n                <span className=\\\"mention-tooltip__description\\\">\n                  Posts by this user\n                </span>\n              </div>\n            </button>\n            <button\n              className=\\\"mention-tooltip__option\\\"\n              onClick={() => {\n                createFilterHandler(segment, 'mentions')();\n                closeTooltip?.();\n              }}\n              title=\\\"Show posts that mention this user\\\"\n            >\n              <span className=\\\"mention-tooltip__icon\\\">\ud83d\udcac</span>\n              <div>\n                Filter by Mentions\n                <span className=\\\"mention-tooltip__description\\\">\n                  Posts mentioning this user\n                </span>\n              </div>\n            </button>\n          </div>\n        </div>\n      );\n\n      return <MentionTooltipContent />;\n    },\n    [createFilterHandler]\n  );\n\n  // Check if there are any URL embeds to determine container styling\n  const hasEmbeds = segments.some(\n    (segment) => segment.type === 'url' && segment.behavior === 'embed'\n  );\n\n  return (\n    <>\n      <span\n        className={`content-with-pills ${hasEmbeds ? 'content-with-pills--has-embeds' : ''} ${className}`}\n        data-context-id={contextId}\n      >\n        {renderSegmentsWithLineBreaks(segments)}\n      </span>\n    </>\n  );\n\n  /**\n   * Enhanced rendering function that handles line breaks properly\n   * Uses the same approach as the rich text editor's DefaultRenderer\n   */\n  function renderSegmentsWithLineBreaks(\n    segments: ContentSegment[]\n  ): React.ReactNode {\n    if (segments.length === 0) {\n      return null;\n    }\n\n    // Check if content has newlines - if not, use simple rendering\n    const hasNewlines = segments.some(\n      (segment) => segment.type === 'text' && segment.value.includes('\\\\n')\n    );\n\n    if (!hasNewlines) {\n      // Simple rendering for single-line content\n      return segments.map((segment, index) => renderSegment(segment, index));\n    }\n\n    // Line-based rendering for multi-line content\n    const lines: ContentSegment[][] = [];\n    let currentLine: ContentSegment[] = [];\n\n    for (const segment of segments) {\n      if (segment.type === 'text' && segment.value.includes('\\\\n')) {\n        // Split text segments containing newlines\n        const textParts = segment.value.split('\\\\n');\n\n        for (let i = 0; i < textParts.length; i++) {\n          const part = textParts[i];\n\n          // Add text part to current line if not empty\n          if (part.length > 0) {\n            currentLine.push({\n              ...segment,\n              value: part,\n              type: 'text'\n            });\n          }\n\n          // End current line (except for the last part)\n          if (i < textParts.length - 1) {\n            lines.push([...currentLine]);\n            currentLine = [];\n          }\n        }\n      } else {\n        // Add non-text segments or text without newlines to current line\n        currentLine.push(segment);\n      }\n    }\n\n    // Add the last line if it has content\n    if (currentLine.length > 0) {\n      lines.push(currentLine);\n    }\n\n    // Render lines with proper structure\n    return lines.map((lineSegments, lineIndex) => (\n      <div\n        key={`line-${lineIndex}`}\n        className=\\\"content-with-pills__line\\\"\n        data-line-index={lineIndex}\n        data-line-segment-count={lineSegments.length}\n      >\n        {lineSegments.length === 0 ? (\n          // Empty line - render invisible character for proper spacing\n          <span className=\\\"content-with-pills__empty-line\\\">&nbsp;</span>\n        ) : (\n          lineSegments.map((segment, segmentIndex) =>\n            renderSegment(segment, `${lineIndex}-${segmentIndex}`)\n          )\n        )}\n      </div>\n    ));\n  }\n\n  /**\n   * Render individual segment (pill or text)\n   */\n  function renderSegment(\n    segment: ContentSegment,\n    key: string | number\n  ): React.ReactNode {\n    if (segment.type === 'text') {\n      // Simple text rendering - no newlines should be present at this point\n      return <span key={key}>{segment.value}</span>;\n    }\n\n    // Handle URL pills separately from other pill types\n    if (segment.type === 'url') {\n      // Extract URL and behavior from the segment\n      const url = segment.value;\n      const behavior = segment.behavior as 'embed' | 'link' | undefined;\n\n      // Extract width from rawFormat if it exists (format: ![behavior|width](url))\n      let width: 'small' | 'medium' | 'large' | 'full' = 'medium'; // Default width\n      if (segment.rawFormat) {\n        const pillData = segment.rawFormat.match(\n          /!\\\\[([^|]+)(?:\\\\|([^|]+))?\\\\]\\\\([^)]+\\\\)/\n        );\n        if (pillData && pillData[2]) {\n          const extractedWidth = pillData[2].toLowerCase();\n          if (\n            ['s', 'm', 'l', 'f', 'small', 'medium', 'large', 'full'].includes(\n              extractedWidth\n            )\n          ) {\n            // Map legacy short names to full names\n            switch (extractedWidth) {\n              case 's':\n                width = 'small';\n                break;\n              case 'm':\n                width = 'medium';\n                break;\n              case 'l':\n                width = 'large';\n                break;\n              case 'f':\n                width = 'full';\n                break;\n              case 'small':\n              case 'medium':\n              case 'large':\n              case 'full':\n                width = extractedWidth as 'small' | 'medium' | 'large' | 'full';\n                break;\n            }\n          }\n        }\n      }\n\n      // Create change handlers for width and mode\n      const handleWidthChange = (\n        newWidth: 'small' | 'medium' | 'large' | 'full'\n      ) => {\n        if (onURLBehaviorChange && segment.rawFormat) {\n          const currentFormat = segment.rawFormat;\n          // Width change debug info\n          // logger.debug('Width change', { newWidth, currentFormat, url, behavior, width });\n\n          // Check if it's already in pill format\n          const pillMatch = currentFormat.match(\n            /!\\\\[([^|]+)(?:\\\\|([^|]+))?\\\\]\\\\(([^)]+)\\\\)/\n          );\n\n          if (pillMatch) {\n            // It's already a pill, update the width\n            const [, currentBehavior, , currentUrl] = pillMatch;\n            const newFormat = `![${currentBehavior}|${newWidth}](${currentUrl})`;\n            // logger.debug('Updating pill format', { currentFormat, newFormat });\n            onURLBehaviorChange(currentFormat, newFormat);\n          } else {\n            // It's a raw URL, convert to pill with width\n            const newFormat = `![${behavior || 'embed'}|${newWidth}](${currentFormat})`;\n            // logger.debug('Converting to pill format', { currentFormat, newFormat });\n            onURLBehaviorChange(currentFormat, newFormat);\n          }\n        } else {\n          // logger.debug('Width change failed', { onURLBehaviorChange: !!onURLBehaviorChange, rawFormat: segment.rawFormat });\n        }\n      };\n\n      const handleModeChange = (newMode: 'embed' | 'link' | 'modal') => {\n        if (onURLBehaviorChange && segment.rawFormat) {\n          const currentFormat = segment.rawFormat;\n\n          // Check if it's already in pill format\n          const pillMatch = currentFormat.match(\n            /!\\\\[([^|]+)(?:\\\\|([^|]+))?\\\\]\\\\(([^)]+)\\\\)/\n          );\n\n          if (pillMatch) {\n            // It's already a pill, update the behavior\n            const [, , currentWidth, currentUrl] = pillMatch;\n            const newFormat = currentWidth\n              ? `![${newMode}|${currentWidth}](${currentUrl})`\n              : `![${newMode}](${currentUrl})`;\n            onURLBehaviorChange(currentFormat, newFormat);\n          } else {\n            // It's a raw URL, convert to pill with behavior\n            const newFormat =\n              width && width !== 'medium'\n                ? `![${newMode}|${width}](${currentFormat})`\n                : `![${newMode}](${currentFormat})`;\n            onURLBehaviorChange(currentFormat, newFormat);\n          }\n        }\n      };\n\n      return (\n        <URLPill\n          key={key}\n          url={url}\n          behavior={behavior}\n          width={width}\n          className=\\\"content-pill--url\\\"\n          isEditMode={isEditMode}\n          onBehaviorChange={onURLBehaviorChange}\n          onWidthChange={handleWidthChange}\n          onModeChange={handleModeChange}\n          onRemove={onURLRemove}\n        />\n      );\n    }\n\n    // Existing logic for hashtag and mention pills (unchanged)\n    const isActiveFilter_ = isActiveFilter(\n      segment.type as 'hashtag' | 'mention',\n      segment.value,\n      segment\n    );\n\n    const pillUrl = generatePillUrl(\n      segment.type as 'hashtag' | 'mention',\n      segment.value,\n      segment\n    );\n\n    // All pills are clickable now - simplified logic\n    const isClickable = true;\n\n    if (isClickable) {\n      const shouldShowTooltip =\n        segment.type === 'mention' && !isFilterBarContext && !isEditMode; // Don't show tooltip in edit mode\n\n      const pillElement = (\n        <InstantLink\n          key={key}\n          href={pillUrl}\n          className={`content-pill content-pill--${segment.type} content-pill--clickable ${\n            isActiveFilter_ ? 'content-pill--active' : ''\n          } ${isFilterBarContext ? 'content-pill--filter-context' : ''} ${\n            isEditMode ? 'content-pill--edit-mode' : ''\n          }`}\n          onClick={(event) => {\n            // In edit mode for mention pills, prevent all click behavior\n            if (isEditMode && segment.type === 'mention') {\n              event.preventDefault();\n              return;\n            }\n\n            handlePillClick(\n              segment.type as 'hashtag' | 'mention',\n              segment.value,\n              event,\n              segment\n            );\n          }}\n          title={\n            isFilterBarContext || shouldShowTooltip\n              ? undefined // No title tooltip when InfoTooltip is used or in filter context\n              : isEditMode && segment.type === 'mention'\n                ? 'Use remove button to delete' // Helpful hint in edit mode\n                : segment.type === 'hashtag'\n                  ? `Filter by hashtag: ${segment.value}`\n                  : `Filter by user: ${segment.value}`\n          }\n        >\n          {segment.type === 'hashtag' ? '#' : '@'}\n          {segment.value}\n        </InstantLink>\n      );\n\n      // Show tooltip for mentions in non-filter contexts (not edit mode)\n      if (shouldShowTooltip) {\n        return (\n          <InteractiveTooltip\n            key={key}\n            content={createMentionTooltipContent(segment)}\n            isInsideParagraph={true}\n            delay={500}\n            className=\\\"content-pill-tooltip\\\"\n          >\n            {pillElement}\n          </InteractiveTooltip>\n        );\n      }\n\n      return pillElement;\n    }\n\n    // Non-clickable pills (fallback)\n    return (\n      <span\n        key={key}\n        className={`content-pill content-pill--${segment.type} ${\n          isActiveFilter_ ? 'content-pill--active' : ''\n        }`}\n      >\n        {segment.type === 'hashtag' ? '#' : '@'}\n        {segment.value}\n      </span>\n    );\n  }\n}\n\n/**\n * Main ContentWithPills component with Suspense wrapper\n */\nexport function ContentWithPills(props: ContentWithPillsProps) {\n  return (\n    <Suspense fallback={<div className={props.className}>{props.content}</div>}>\n      <ContentWithPillsInternal {...props} />\n    </Suspense>\n  );\n}\n\n/**\n * Utility functions for creating robust mention content\n */\nexport const createRobustMention = (\n  username: string,\n  userId: string\n): string => {\n  const cleanUsername = username.trim().replace(/[[\\\\]|]/g, '');\n  const cleanUserId = userId.trim().replace(/[[\\\\]|]/g, '');\n  return `@[${cleanUsername}|${cleanUserId}]`;\n};\n\nexport const parseRobustMention = (\n  mentionString: string\n): { username: string; userId: string } | null => {\n  const match = mentionString.match(/^@\\\\[([^|]+)\\\\|([^\\\\]]+)\\\\]$/);\n  if (match) {\n    return {\n      username: match[1].trim(),\n      userId: match[2].trim()\n    };\n  }\n  return null;\n};\n\nexport const convertLegacyMention = async (\n  legacyMention: string,\n  getUserId: (username: string) => Promise<string | undefined>\n): Promise<string> => {\n  const match = legacyMention.match(\n    /^@([a-zA-Z0-9._-]+(?:\\\\s+[a-zA-Z0-9._-]+)*)$/\n  );\n  if (match) {\n    const username = match[1];\n    try {\n      const userId = await getUserId(username);\n      if (userId) {\n        return createRobustMention(username, userId);\n      }\n    } catch (error) {\n      logger.error('Error converting legacy mention', error as Error, {\n        legacyMention\n      });\n    }\n  }\n  return legacyMention;\n};\n",
    "language":"typescript",
    "lines":695,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/RefreshButton.tsx":{
    "content":"'use client';\n\nimport { useState } from 'react';\nimport { ClipLoader } from 'react-spinners';\nimport './RefreshButton.css';\n\ninterface RefreshButtonProps {\n  onRefresh: () => Promise<void>;\n  className?: string;\n  disabled?: boolean;\n  title?: string;\n}\n\nexport function RefreshButton({\n  onRefresh,\n  className = '',\n  disabled = false,\n  title = 'Refresh post'\n}: RefreshButtonProps) {\n  const [isRefreshing, setIsRefreshing] = useState(false);\n\n  const handleRefresh = async () => {\n    if (isRefreshing || disabled) return;\n\n    setIsRefreshing(true);\n    try {\n      await onRefresh();\n    } catch (error) {\n      console.error('Error refreshing:', error);\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  return (\n    <button\n      className={`refresh-button ${className} ${isRefreshing ? 'refresh-button--refreshing' : ''}`}\n      onClick={handleRefresh}\n      disabled={isRefreshing || disabled}\n      title={title}\n      aria-label={title}\n    >\n      {isRefreshing ? (\n        <ClipLoader\n          size={16}\n          color=\\\"var(--brand-secondary)\\\"\n          loading={true}\n          aria-label=\\\"Loading\\\"\n        />\n      ) : (\n        <svg\n          width=\\\"16\\\"\n          height=\\\"16\\\"\n          viewBox=\\\"0 0 24 24\\\"\n          fill=\\\"none\\\"\n          stroke=\\\"currentColor\\\"\n          strokeWidth=\\\"2\\\"\n          strokeLinecap=\\\"round\\\"\n          strokeLinejoin=\\\"round\\\"\n          className=\\\"refresh-button__icon\\\"\n        >\n          <polyline points=\\\"23 4 23 10 17 10\\\" />\n          <polyline points=\\\"1 20 1 14 7 14\\\" />\n          <path d=\\\"m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\\\" />\n        </svg>\n      )}\n    </button>\n  );\n}\n",
    "language":"typescript",
    "lines":70,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/PillInput.tsx":{
    "content":"'use client';\n\nimport React, { KeyboardEvent, useEffect, useRef, useState } from 'react';\nimport { ContentWithPills } from './ContentWithPills';\nimport './PillInput.css';\n\nexport interface PillInputProps {\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  className?: string;\n  disabled?: boolean;\n  contextId: string;\n  onHashtagClick?: (hashtag: string) => void;\n  onMentionClick?: (\n    mention: string,\n    filterType?: 'author' | 'mentions'\n  ) => void;\n}\n\ninterface ParsedContent {\n  type: 'text' | 'hashtag' | 'mention';\n  content: string;\n  raw?: string; // For structured mentions: @[username|userId]\n}\n\nexport const PillInput: React.FC<PillInputProps> = ({\n  value,\n  onChange,\n  placeholder,\n  className = '',\n  disabled = false,\n  contextId,\n  onHashtagClick,\n  onMentionClick\n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [editValue, setEditValue] = useState(value);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Parse the value into segments for pill rendering\n  const parseContent = (text: string): ParsedContent[] => {\n    if (!text) return [];\n\n    const segments: ParsedContent[] = [];\n    let currentIndex = 0;\n\n    // Regex to match hashtags and structured mentions only (prevent false positives)\n    const pillRegex = /(#\\\\w+)|(@\\\\[[^\\\\]]+\\\\])/g;\n    let match;\n\n    while ((match = pillRegex.exec(text)) !== null) {\n      // Add text before the match\n      if (match.index > currentIndex) {\n        const textContent = text.slice(currentIndex, match.index);\n        if (textContent) {\n          segments.push({ type: 'text', content: textContent });\n        }\n      }\n\n      const matchedText = match[0];\n\n      if (matchedText.startsWith('#')) {\n        // Hashtag\n        segments.push({ type: 'hashtag', content: matchedText });\n      } else if (matchedText.startsWith('@[')) {\n        // Structured mention: @[username|userId]\n        segments.push({\n          type: 'mention',\n          content: matchedText,\n          raw: matchedText\n        });\n      }\n\n      currentIndex = match.index + matchedText.length;\n    }\n\n    // Add remaining text\n    if (currentIndex < text.length) {\n      const remainingText = text.slice(currentIndex);\n      if (remainingText) {\n        segments.push({ type: 'text', content: remainingText });\n      }\n    }\n\n    return segments;\n  };\n\n  const handleContainerClick = () => {\n    if (!disabled && !isEditing) {\n      setIsEditing(true);\n      setEditValue(value);\n      setTimeout(() => {\n        if (inputRef.current) {\n          inputRef.current.focus();\n          inputRef.current.setSelectionRange(value.length, value.length);\n        }\n      }, 0);\n    }\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setEditValue(e.target.value);\n  };\n\n  const handleInputKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      commitEdit();\n    } else if (e.key === 'Escape') {\n      e.preventDefault();\n      cancelEdit();\n    }\n  };\n\n  const handleInputBlur = () => {\n    commitEdit();\n  };\n\n  const commitEdit = () => {\n    onChange(editValue);\n    setIsEditing(false);\n  };\n\n  const cancelEdit = () => {\n    setEditValue(value);\n    setIsEditing(false);\n  };\n\n  const handlePillClick = (content: string, type: 'hashtag' | 'mention') => {\n    if (type === 'hashtag' && onHashtagClick) {\n      onHashtagClick(content);\n    } else if (type === 'mention' && onMentionClick) {\n      onMentionClick(content);\n    }\n  };\n\n  // Update edit value when prop value changes\n  useEffect(() => {\n    if (!isEditing) {\n      setEditValue(value);\n    }\n  }, [value, isEditing]);\n\n  // Handle click outside to commit edit\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        containerRef.current &&\n        !containerRef.current.contains(event.target as Node) &&\n        isEditing\n      ) {\n        commitEdit();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [isEditing, editValue]);\n\n  const parsedSegments = parseContent(value);\n  const isEmpty = !value || value.trim() === '';\n\n  return (\n    <div\n      ref={containerRef}\n      className={`pill-input ${className} ${isEditing ? 'pill-input--editing' : ''} ${\n        isEmpty ? 'pill-input--empty' : ''\n      }`}\n      onClick={handleContainerClick}\n    >\n      {isEditing ? (\n        <input\n          ref={inputRef}\n          type=\\\"text\\\"\n          value={editValue}\n          onChange={handleInputChange}\n          onKeyDown={handleInputKeyDown}\n          onBlur={handleInputBlur}\n          className=\\\"pill-input__edit-field\\\"\n          placeholder={placeholder}\n          disabled={disabled}\n        />\n      ) : (\n        <div className=\\\"pill-input__display\\\">\n          {isEmpty ? (\n            <span className=\\\"pill-input__placeholder\\\">{placeholder}</span>\n          ) : (\n            <div className=\\\"pill-input__content\\\">\n              {parsedSegments.map((segment, index) => {\n                if (segment.type === 'text') {\n                  return (\n                    <span key={index} className=\\\"pill-input__text\\\">\n                      {segment.content}\n                    </span>\n                  );\n                } else {\n                  return (\n                    <ContentWithPills\n                      key={index}\n                      content={segment.content}\n                      contextId={contextId}\n                      onHashtagClick={onHashtagClick}\n                      onMentionClick={onMentionClick}\n                      className=\\\"pill-input__pill\\\"\n                    />\n                  );\n                }\n              })}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":218,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/ContentWithPills.test.tsx":{
    "content":"import { fireEvent, render, screen } from '@testing-library/react';\nimport { Provider } from 'jotai';\nimport { NavigationLoadingProvider } from '../../../lib/context/NavigationLoadingContext';\nimport { ContentWithPills } from './ContentWithPills';\n\n// Mock window.matchMedia\nObject.defineProperty(window, 'matchMedia', {\n  writable: true,\n  value: jest.fn().mockImplementation((query) => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(), // deprecated\n    removeListener: jest.fn(), // deprecated\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn()\n  }))\n});\n\n// Mock the Jotai useAtom hook with proper return values\nconst mockSetFiltersState = jest.fn();\nconst mockFiltersState = {\n  filters: [],\n  page: 1,\n  pageSize: 10,\n  initialized: true\n};\n\njest.mock('jotai', () => {\n  const actual = jest.requireActual('jotai');\n  return {\n    ...actual,\n    useAtom: jest.fn(() => [mockFiltersState, mockSetFiltersState]),\n    Provider: actual.Provider\n  };\n});\n\n// Mock the atoms module\njest.mock('../../../lib/state/atoms', () => ({\n  getSubmissionsFiltersAtom: jest.fn(() => ({})),\n  shouldUpdateAtom: jest.fn(() => ({}))\n}));\n\n// Mock Next.js navigation\njest.mock('next/navigation', () => ({\n  usePathname: jest.fn(() => '/posts'),\n  useSearchParams: jest.fn(() => new URLSearchParams()),\n  useRouter: jest.fn(() => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    back: jest.fn(),\n    forward: jest.fn(),\n    refresh: jest.fn(),\n    prefetch: jest.fn()\n  }))\n}));\n\n// Mock Next.js Link component\njest.mock('next/link', () => {\n  const MockedLink = ({ children, href, onClick, className, title }: any) => (\n    <a href={href} onClick={onClick} className={className} title={title}>\n      {children}\n    </a>\n  );\n  MockedLink.displayName = 'Link';\n  return MockedLink;\n});\n\n// Mock tooltip component\njest.mock('../tooltip/LinkTooltip', () => ({\n  MentionTooltip: ({ children }: any) => <div>{children}</div>\n}));\n\n// Helper function to render with all required providers\nconst renderWithProviders = (children: React.ReactNode) => {\n  return render(\n    <NavigationLoadingProvider>\n      <Provider>{children}</Provider>\n    </NavigationLoadingProvider>\n  );\n};\n\ndescribe('ContentWithPills', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('Basic hashtag detection', () => {\n    it('should detect single hashtag', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"This is a post with #hashtag\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      // Check that the hashtag link exists\n      const hashtagLink = screen.getByRole('link');\n      expect(hashtagLink).toHaveTextContent('#hashtag');\n\n      // Check that text content exists using partial matches\n      expect(screen.getByText(/This is a post with/)).toBeInTheDocument();\n    });\n\n    it('should detect multiple hashtags', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Post with #first and #second hashtags\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      // Check text content exists\n      expect(screen.getByText(/Post with/)).toBeInTheDocument();\n      expect(screen.getByText(/and/)).toBeInTheDocument();\n      expect(screen.getByText(/hashtags/)).toBeInTheDocument();\n\n      const hashtagLinks = screen.getAllByRole('link');\n      expect(hashtagLinks).toHaveLength(2);\n      expect(hashtagLinks[0]).toHaveTextContent('#first');\n      expect(hashtagLinks[1]).toHaveTextContent('#second');\n    });\n\n    it('should detect hashtag at beginning of text', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"#start is at the beginning\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const hashtagLink = screen.getByRole('link');\n      expect(hashtagLink).toHaveTextContent('#start');\n      expect(screen.getByText(/is at the beginning/)).toBeInTheDocument();\n    });\n\n    it('should detect hashtag at end of text', () => {\n      renderWithProviders(\n        <ContentWithPills content=\\\"This ends with #end\\\" contextId=\\\"test\\\" />\n      );\n\n      const hashtagLink = screen.getByRole('link');\n      expect(hashtagLink).toHaveTextContent('#end');\n      expect(screen.getByText(/This ends with/)).toBeInTheDocument();\n    });\n  });\n\n  describe('Chained hashtag detection', () => {\n    it('should detect chained hashtags without spaces', () => {\n      renderWithProviders(\n        <ContentWithPills content=\\\"#ademptio#testimonium\\\" contextId=\\\"test\\\" />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n      expect(links[0]).toHaveTextContent('#ademptio');\n      expect(links[1]).toHaveTextContent('#testimonium');\n    });\n\n    it('should detect multiple chained hashtags', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"#first#second#third#fourth\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(4);\n      expect(links[0]).toHaveTextContent('#first');\n      expect(links[1]).toHaveTextContent('#second');\n      expect(links[2]).toHaveTextContent('#third');\n      expect(links[3]).toHaveTextContent('#fourth');\n    });\n\n    it('should detect chained hashtags mixed with text', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react#javascript for web dev\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      expect(screen.getByText(/Check out/)).toBeInTheDocument();\n      expect(screen.getByText(/for web dev/)).toBeInTheDocument();\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n      expect(links[0]).toHaveTextContent('#react');\n      expect(links[1]).toHaveTextContent('#javascript');\n    });\n  });\n\n  describe('Basic mention detection', () => {\n    it('should detect single structured mention', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Hello @[username|user123], how are you?\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      expect(screen.getByText(/Hello/)).toBeInTheDocument();\n      expect(screen.getByText(/how are you/)).toBeInTheDocument();\n\n      const mentionLink = screen.getByRole('link');\n      expect(mentionLink).toHaveTextContent('@username');\n    });\n\n    it('should detect multiple structured mentions', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Hey @[alice|user1] and @[bob|user2]!\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n      expect(links[0]).toHaveTextContent('@alice');\n      expect(links[1]).toHaveTextContent('@bob');\n    });\n  });\n\n  describe('Mixed hashtags and mentions', () => {\n    it('should detect both hashtags and mentions in same text', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Hey @[user|123] check out #react\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n\n      const mentionLink = links.find((link) => link.textContent?.includes('@'));\n      const hashtagLink = links.find((link) => link.textContent?.includes('#'));\n\n      expect(mentionLink).toHaveTextContent('@user');\n      expect(hashtagLink).toHaveTextContent('#react');\n    });\n\n    it('should detect chained mixed hashtags and mentions', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"#react@[developer|123]#javascript@[coder|456]\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(4);\n      expect(links[0]).toHaveTextContent('#react');\n      expect(links[1]).toHaveTextContent('@developer');\n      expect(links[2]).toHaveTextContent('#javascript');\n      expect(links[3]).toHaveTextContent('@coder');\n    });\n  });\n\n  describe('Edge cases', () => {\n    it('should handle empty content', () => {\n      renderWithProviders(<ContentWithPills content=\\\"\\\" contextId=\\\"test\\\" />);\n      expect(screen.queryByRole('link')).not.toBeInTheDocument();\n    });\n\n    it('should handle content with no hashtags or mentions', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"This is just regular text.\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n      expect(screen.queryByRole('link')).not.toBeInTheDocument();\n      expect(screen.getByText(/This is just regular text/)).toBeInTheDocument();\n    });\n\n    it('should handle hashtag with numbers and underscores', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react_18 and #web3_dev\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n      expect(links[0]).toHaveTextContent('#react_18');\n      expect(links[1]).toHaveTextContent('#web3_dev');\n    });\n\n    it('should handle mention with special characters in username', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Hello @[user_name|123] and @[dev-ops|456]\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n      expect(links[0]).toHaveTextContent('@user_name');\n      expect(links[1]).toHaveTextContent('@dev-ops');\n    });\n\n    it('should NOT parse simple mention format to prevent false positives', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Hello @username this should be parsed\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      // Simple @username format should NOT create links to prevent false positives\n      const links = screen.queryAllByRole('link');\n      expect(links).toHaveLength(0);\n\n      // All text should be preserved as plain text\n      expect(\n        screen.getByText(/Hello @username this should be parsed/)\n      ).toBeInTheDocument();\n    });\n\n    it('should handle special characters adjacent to hashtags/mentions', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Amazing! #react is great. @[user|123], what do you think?\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n      expect(links[0]).toHaveTextContent('#react');\n      expect(links[1]).toHaveTextContent('@user');\n    });\n  });\n\n  describe('Click functionality', () => {\n    it('should call onHashtagClick when hashtag is clicked', () => {\n      const mockOnHashtagClick = jest.fn();\n\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react\\\"\n          contextId=\\\"test\\\"\n          onHashtagClick={mockOnHashtagClick}\n        />\n      );\n\n      const hashtagLink = screen.getByRole('link');\n      fireEvent.click(hashtagLink);\n\n      expect(mockOnHashtagClick).toHaveBeenCalledWith('#react');\n    });\n\n    it('should call onMentionClick when mention is clicked', () => {\n      const mockOnMentionClick = jest.fn();\n\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Hello @[john|123]\\\"\n          contextId=\\\"test\\\"\n          onMentionClick={mockOnMentionClick}\n        />\n      );\n\n      const mentionLink = screen.getByRole('link');\n      fireEvent.click(mentionLink);\n\n      expect(mockOnMentionClick).toHaveBeenCalledWith('123', 'author');\n    });\n\n    it('should use global filter state when contextId is provided', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react and @[john|123]\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n    });\n\n    it('should prioritize custom callbacks over global filter state', () => {\n      const mockOnHashtagClick = jest.fn();\n\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react\\\"\n          contextId=\\\"test\\\"\n          onHashtagClick={mockOnHashtagClick}\n        />\n      );\n\n      const hashtagLink = screen.getByRole('link');\n      fireEvent.click(hashtagLink);\n\n      expect(mockOnHashtagClick).toHaveBeenCalledWith('#react');\n    });\n  });\n\n  describe('Accessibility', () => {\n    it('should have proper link attributes', () => {\n      const mockOnHashtagClick = jest.fn();\n\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react and @[john|123]\\\"\n          contextId=\\\"test\\\"\n          onHashtagClick={mockOnHashtagClick}\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n\n      // Check that at least one link has a title (not all may have titles in current implementation)\n      const linksWithTitles = links.filter((link) =>\n        link.hasAttribute('title')\n      );\n      expect(linksWithTitles.length).toBeGreaterThan(0);\n    });\n\n    it('should have non-clickable spans when no callbacks or contextId', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react and @[john|123]\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      // Should still render as links due to contextId\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n    });\n\n    it('should have appropriate titles for hashtags and mentions when available', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"Check out #react and @[john|123]\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n      const hashtagLink = links.find((link) => link.textContent?.includes('#'));\n      const mentionLink = links.find((link) => link.textContent?.includes('@'));\n\n      // Check if titles exist and contain expected content (not all links may have titles)\n      if (hashtagLink?.hasAttribute('title')) {\n        expect(hashtagLink).toHaveAttribute(\n          'title',\n          expect.stringContaining('hashtag')\n        );\n      }\n\n      if (mentionLink?.hasAttribute('title')) {\n        expect(mentionLink).toHaveAttribute(\n          'title',\n          expect.stringContaining('user')\n        );\n      }\n\n      // At least verify that the links exist and have correct text content\n      expect(hashtagLink).toHaveTextContent('#react');\n      expect(mentionLink).toHaveTextContent('@john');\n    });\n  });\n\n  describe('Real-world examples', () => {\n    it('should handle complex post content', () => {\n      const mockOnHashtagClick = jest.fn();\n      const mockOnMentionClick = jest.fn();\n\n      renderWithProviders(\n        <ContentWithPills\n          content={\n            'Amazing progress on #webdev! Thanks to @[alice|123] and @[bob|456] for the help. ' +\n            'Looking forward to #react2024 conference. #javascript #typescript'\n          }\n          contextId=\\\"test\\\"\n          onHashtagClick={mockOnHashtagClick}\n          onMentionClick={mockOnMentionClick}\n        />\n      );\n\n      const links = screen.getAllByRole('link');\n\n      // Should find 2 mentions + 4 hashtags = 6 total links\n      expect(links).toHaveLength(6);\n\n      // Check that text content is preserved\n      expect(screen.getByText(/Amazing progress on/)).toBeInTheDocument();\n      expect(screen.getByText(/Thanks to/)).toBeInTheDocument();\n      expect(screen.getByText(/and/)).toBeInTheDocument();\n      expect(screen.getByText(/for the help/)).toBeInTheDocument();\n\n      // Test clicking a hashtag\n      const webdevHashtag = links.find(\n        (link) => link.textContent === '#webdev'\n      );\n      if (webdevHashtag) {\n        fireEvent.click(webdevHashtag);\n        expect(mockOnHashtagClick).toHaveBeenCalledWith('#webdev');\n      }\n\n      // Test clicking a mention\n      const aliceMention = links.find((link) => link.textContent === '@alice');\n      if (aliceMention) {\n        fireEvent.click(aliceMention);\n        expect(mockOnMentionClick).toHaveBeenCalledWith('123', 'author');\n      }\n    });\n\n    it('should handle post with no pills', () => {\n      renderWithProviders(\n        <ContentWithPills\n          content=\\\"This is just regular text with no special tags.\\\"\n          contextId=\\\"test\\\"\n        />\n      );\n\n      expect(screen.queryByRole('link')).not.toBeInTheDocument();\n      expect(screen.getByText(/This is just regular text/)).toBeInTheDocument();\n    });\n\n    it('should handle the original failing case', () => {\n      renderWithProviders(\n        <ContentWithPills content=\\\"#ademptio#testimonium\\\" contextId=\\\"test\\\" />\n      );\n\n      const links = screen.getAllByRole('link');\n      expect(links).toHaveLength(2);\n      expect(links[0]).toHaveTextContent('#ademptio');\n      expect(links[1]).toHaveTextContent('#testimonium');\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":542,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/InstantLink.tsx":{
    "content":"'use client';\n\nimport Link from 'next/link';\nimport { usePathname } from 'next/navigation';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useNavigationLoader } from '../../../lib/hooks/useNavigationLoader';\nimport './InstantLink.css';\n\ninterface InstantLinkProps {\n  href: string;\n  children: React.ReactNode;\n  className?: string;\n  prefetch?: boolean;\n  scroll?: boolean;\n  'aria-disabled'?: boolean;\n  'data-testid'?: string;\n  target?: string;\n  title?: string;\n  onClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n}\n\nexport function InstantLink({\n  href,\n  children,\n  className = '',\n  prefetch = true,\n  scroll = true,\n  'aria-disabled': ariaDisabled,\n  'data-testid': dataTestId,\n  target,\n  title,\n  onClick\n}: InstantLinkProps) {\n  const { navigate, isNavigating, targetPath } = useNavigationLoader();\n  const pathname = usePathname();\n  const [isClicked, setIsClicked] = useState(false);\n\n  const isCurrentPath = pathname === href;\n  const isNavigatingToThisPath = isNavigating && targetPath === href;\n\n  // Reset clicked state when navigation completes\n  useEffect(() => {\n    if (isClicked && !isNavigating) {\n      setIsClicked(false);\n    }\n  }, [isClicked, isNavigating]);\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent<HTMLAnchorElement>) => {\n      // Call custom onClick first if provided\n      if (onClick) {\n        onClick(e);\n      }\n\n      // Don't handle navigation for external links or disabled links\n      if (target === '_blank' || ariaDisabled) {\n        return;\n      }\n\n      // Don't handle if user is holding modifier keys (allow default browser behavior)\n      if (e.ctrlKey || e.metaKey || e.shiftKey || e.altKey) {\n        return;\n      }\n\n      // Don't navigate if already on the same path\n      if (isCurrentPath) {\n        e.preventDefault();\n        return;\n      }\n\n      // Prevent default navigation and use our enhanced navigation\n      e.preventDefault();\n      setIsClicked(true);\n\n      // Use navigate function which provides instant feedback\n      navigate(href, { scroll });\n    },\n    [onClick, target, ariaDisabled, isCurrentPath, navigate, href, scroll]\n  );\n\n  const linkClasses = [\n    'instant-link',\n    className,\n    isCurrentPath && 'instant-link--active',\n    (isNavigatingToThisPath || isClicked) && 'instant-link--loading',\n    ariaDisabled && 'instant-link--disabled'\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  const showSpinner = isNavigatingToThisPath || isClicked;\n\n  return (\n    <Link\n      href={href}\n      className={linkClasses}\n      prefetch={prefetch}\n      aria-disabled={ariaDisabled}\n      data-testid={dataTestId}\n      target={target}\n      title={title}\n      onClick={handleClick}\n    >\n      <span className=\\\"instant-link__content\\\">{children}</span>\n      {showSpinner && (\n        <span className=\\\"instant-link__loader\\\">\n          <svg\n            className=\\\"instant-link__spinner\\\"\n            width=\\\"16\\\"\n            height=\\\"16\\\"\n            viewBox=\\\"0 0 24 24\\\"\n            fill=\\\"none\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          >\n            <path d=\\\"M21 12a9 9 0 11-6.22-8.56\\\" />\n          </svg>\n        </span>\n      )}\n    </Link>\n  );\n}\n",
    "language":"typescript",
    "lines":125,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/EmojiPicker.tsx":{
    "content":"'use client';\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { EmojiData, useEmojis } from '../../hooks/useEmojis';\nimport './EmojiPicker.css';\n\n/**\n * EmojiPicker Component with Pagination Support\n *\n * Features:\n * - Search functionality across all emojis\n * - Category filtering\n * - Pagination support for large emoji sets\n * - Keyboard navigation (Escape to close)\n * - Click-outside-to-close behavior\n * - Responsive design with mobile support\n * - Dark mode support\n *\n * Pagination:\n * - Enable with `enablePagination={true}`\n * - Set items per page with `itemsPerPage` prop\n * - Pagination resets when changing categories or searching\n * - Shows current page info and navigation controls\n */\n\n// Re-export EmojiData for use in other components\nexport type { EmojiData } from '../../hooks/useEmojis';\n\nexport interface EmojiPickerProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onEmojiSelect: (emoji: EmojiData) => void;\n  position?: { x: number; y: number };\n  searchQuery?: string;\n  maxResults?: number;\n  className?: string;\n  // Pagination props\n  enablePagination?: boolean;\n  itemsPerPage?: number;\n  // Control automatic fetching\n  autoFetch?: boolean;\n}\n\nexport interface EmojiPickerTriggerProps {\n  children: React.ReactNode;\n  onEmojiSelect: (emojiText: string) => void;\n  searchQuery?: string;\n  disabled?: boolean;\n}\n\n// Main Emoji Picker Component\nexport const EmojiPicker: React.FC<EmojiPickerProps> = ({\n  isOpen,\n  onClose,\n  onEmojiSelect,\n  position,\n  searchQuery = '',\n  maxResults = 24,\n  className = '',\n  enablePagination = false,\n  itemsPerPage = 24,\n  autoFetch = true\n}) => {\n  const {\n    emojis,\n    categories,\n    loading,\n    error,\n    searchEmojis,\n    selectCategory,\n    trackEmojiUsage,\n    filters,\n    fetchEmojis\n  } = useEmojis({\n    autoFetch: autoFetch,\n    defaultFilters: {\n      includeCustom: true,\n      includeUsage: true\n    }\n  });\n\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [isChangingCategory, setIsChangingCategory] = useState(false);\n  const [localSearchQuery, setLocalSearchQuery] = useState(searchQuery);\n\n  // Pagination state\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalEmojis, setTotalEmojis] = useState(0);\n\n  // If autoFetch is false, manually fetch emojis when the picker opens\n  useEffect(() => {\n    if (isOpen && !autoFetch && emojis.length === 0 && !loading) {\n      fetchEmojis();\n    }\n  }, [isOpen, autoFetch, emojis.length, loading]); // Remove fetchEmojis from dependencies\n\n  // Sync selected category with the filters from useEmojis hook\n  useEffect(() => {\n    if (!filters.category) {\n      setSelectedCategory('all');\n    } else {\n      setSelectedCategory(filters.category);\n    }\n  }, [filters.category]);\n\n  // Update local search when prop changes\n  useEffect(() => {\n    setLocalSearchQuery(searchQuery);\n  }, [searchQuery]);\n\n  // Update total emojis count\n  useEffect(() => {\n    setTotalEmojis(emojis.length);\n  }, [emojis]);\n\n  // Reset pagination when category or search changes\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [selectedCategory, localSearchQuery]);\n\n  // Memoize filtered emojis to prevent unnecessary recalculations\n  const filteredEmojis = useMemo(() => {\n    if (!enablePagination) {\n      return emojis.slice(0, maxResults);\n    }\n\n    const startIndex = (currentPage - 1) * itemsPerPage;\n    const endIndex = startIndex + itemsPerPage;\n    return emojis.slice(startIndex, endIndex);\n  }, [emojis, maxResults, enablePagination, currentPage, itemsPerPage]);\n\n  // Memoize pagination info to prevent recalculation\n  const paginationInfo = useMemo(() => {\n    const totalPages = enablePagination\n      ? Math.ceil(totalEmojis / itemsPerPage)\n      : 1;\n    return {\n      totalPages,\n      hasNextPage: currentPage < totalPages,\n      hasPrevPage: currentPage > 1\n    };\n  }, [totalEmojis, itemsPerPage, enablePagination, currentPage]);\n\n  const { totalPages, hasNextPage, hasPrevPage } = paginationInfo;\n\n  // Handle emoji selection\n  const handleEmojiClick = useCallback(\n    (emoji: EmojiData) => {\n      // Call the parent handler first\n      onEmojiSelect(emoji);\n\n      // Track usage asynchronously to avoid blocking UI\n      const emojiType = emoji.is_custom ? 'custom' : 'mac'; // Default to mac for standard emojis\n      trackEmojiUsage(emoji.emoji_id, emojiType);\n    },\n    [onEmojiSelect, trackEmojiUsage]\n  );\n\n  // Pagination handlers\n  const handleNextPage = useCallback(() => {\n    if (hasNextPage) {\n      setCurrentPage((prev) => prev + 1);\n    }\n  }, [hasNextPage]);\n\n  const handlePrevPage = useCallback(() => {\n    if (hasPrevPage) {\n      setCurrentPage((prev) => prev - 1);\n    }\n  }, [hasPrevPage]);\n\n  const handlePageChange = useCallback(\n    (page: number) => {\n      if (page >= 1 && page <= totalPages) {\n        setCurrentPage(page);\n      }\n    },\n    [totalPages]\n  );\n\n  // Handle category selection with loading state\n  const handleCategorySelect = useCallback(\n    async (category: string) => {\n      // Prevent rapid category changes\n      if (isChangingCategory) return;\n\n      setIsChangingCategory(true);\n      setSelectedCategory(category);\n      setLocalSearchQuery(''); // Clear search when selecting category\n      setCurrentPage(1); // Reset pagination when changing category\n\n      try {\n        if (category === 'all') {\n          selectCategory(null); // Clear category filter to show all\n        } else {\n          selectCategory(category);\n        }\n        // Add slight delay to prevent flickering\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      } finally {\n        setIsChangingCategory(false);\n      }\n    },\n    [selectCategory, isChangingCategory]\n  );\n\n  // Handle search input - FIXED: Trigger search properly\n  const handleSearchChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const query = e.target.value;\n      setLocalSearchQuery(query);\n      setCurrentPage(1); // Reset pagination when searching\n      if (query.trim()) {\n        searchEmojis(query.trim());\n        setSelectedCategory('all'); // Switch to 'all' when searching\n      } else {\n        // Clear search by selecting current category or 'all'\n        if (selectedCategory !== 'all') {\n          selectCategory(selectedCategory);\n        } else {\n          selectCategory(null);\n        }\n      }\n    },\n    [searchEmojis, selectCategory, selectedCategory]\n  );\n\n  // Handle escape key\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('keydown', handleEscape);\n    return () => document.removeEventListener('keydown', handleEscape);\n  }, [isOpen, onClose]);\n\n  // Handle clicks outside\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as Element;\n      if (!target.closest('.emoji-picker')) {\n        onClose();\n      }\n    };\n\n    // Add delay to prevent immediate close\n    const timeoutId = setTimeout(() => {\n      document.addEventListener('click', handleClickOutside);\n    }, 0);\n\n    return () => {\n      clearTimeout(timeoutId);\n      document.removeEventListener('click', handleClickOutside);\n    };\n  }, [isOpen, onClose]);\n\n  if (!isOpen) return null;\n\n  // Determine if we should show loading state\n  const showLoadingState = loading || isChangingCategory;\n  const showContent = !loading && !error && filteredEmojis.length > 0;\n  const showEmptyState = !loading && !error && filteredEmojis.length === 0;\n\n  const content = (\n    <div\n      className={`emoji-picker ${className}`}\n      style={\n        position\n          ? {\n              position: 'absolute',\n              left: position.x,\n              top: position.y,\n              zIndex: 10000\n            }\n          : undefined\n      }\n    >\n      <div className=\\\"emoji-picker__header\\\">\n        <input\n          type=\\\"text\\\"\n          placeholder=\\\"Search emojis...\\\"\n          value={localSearchQuery}\n          onChange={handleSearchChange}\n          className=\\\"emoji-picker__search\\\"\n          autoFocus\n          disabled={isChangingCategory}\n        />\n        <button onClick={onClose} className=\\\"emoji-picker__close\\\" title=\\\"Close\\\">\n          \u00d7\n        </button>\n      </div>\n\n      <div className=\\\"emoji-picker__categories\\\">\n        <button\n          className={`emoji-picker__category ${selectedCategory === 'all' ? 'emoji-picker__category--active' : ''}`}\n          onClick={() => handleCategorySelect('all')}\n          title=\\\"All emojis\\\"\n          disabled={isChangingCategory}\n        >\n          \ud83c\udf1f\n        </button>\n        {categories.map((category) => (\n          <button\n            key={category.name}\n            className={`emoji-picker__category ${selectedCategory === category.name ? 'emoji-picker__category--active' : ''}`}\n            onClick={() => handleCategorySelect(category.name)}\n            title={category.display_name}\n            disabled={isChangingCategory}\n          >\n            {getCategoryIcon(category.name)}\n          </button>\n        ))}\n      </div>\n\n      <div className=\\\"emoji-picker__content\\\">\n        {showLoadingState && (\n          <div className=\\\"emoji-picker__loading\\\">\n            <div className=\\\"emoji-picker__loading-spinner\\\"></div>\n            <span>\n              {isChangingCategory\n                ? 'Switching category...'\n                : 'Loading emojis...'}\n            </span>\n          </div>\n        )}\n\n        {error && !isChangingCategory && (\n          <div className=\\\"emoji-picker__error\\\">Error loading emojis</div>\n        )}\n\n        {showEmptyState && !isChangingCategory && (\n          <div className=\\\"emoji-picker__empty\\\">\n            {localSearchQuery ? 'No emojis found' : 'No emojis available'}\n          </div>\n        )}\n\n        {showContent && (\n          <>\n            <div\n              className={`emoji-picker__grid ${isChangingCategory ? 'emoji-picker__grid--loading' : ''}`}\n            >\n              {filteredEmojis.map((emoji: EmojiData, index: number) => (\n                <button\n                  key={`${emoji.emoji_id}-${index}`}\n                  className=\\\"emoji-picker__emoji\\\"\n                  onClick={() => handleEmojiClick(emoji)}\n                  title={`:${emoji.emoji_id}:`}\n                  disabled={isChangingCategory}\n                >\n                  {emoji.is_custom && emoji.custom_image_url ? (\n                    <img\n                      src={emoji.custom_image_url}\n                      alt={`:${emoji.emoji_id}:`}\n                      className=\\\"emoji-picker__emoji-image\\\"\n                      loading=\\\"lazy\\\"\n                    />\n                  ) : (\n                    <span className=\\\"emoji-picker__emoji-char\\\">\n                      {emoji.unicode_char || `:${emoji.emoji_id}:`}\n                    </span>\n                  )}\n                </button>\n              ))}\n            </div>\n\n            {enablePagination && totalPages > 1 && (\n              <div className=\\\"emoji-picker__pagination\\\">\n                <button\n                  className=\\\"emoji-picker__pagination-btn emoji-picker__pagination-btn--prev\\\"\n                  onClick={handlePrevPage}\n                  disabled={!hasPrevPage || isChangingCategory}\n                  title=\\\"Previous page\\\"\n                >\n                  \u2039\n                </button>\n\n                <div className=\\\"emoji-picker__pagination-info\\\">\n                  <span className=\\\"emoji-picker__pagination-current\\\">\n                    {currentPage}\n                  </span>\n                  <span className=\\\"emoji-picker__pagination-separator\\\">/</span>\n                  <span className=\\\"emoji-picker__pagination-total\\\">\n                    {totalPages}\n                  </span>\n                </div>\n\n                <button\n                  className=\\\"emoji-picker__pagination-btn emoji-picker__pagination-btn--next\\\"\n                  onClick={handleNextPage}\n                  disabled={!hasNextPage || isChangingCategory}\n                  title=\\\"Next page\\\"\n                >\n                  \u203a\n                </button>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {filteredEmojis.length > 0 && !isChangingCategory && (\n        <div className=\\\"emoji-picker__footer\\\">\n          <span className=\\\"emoji-picker__count\\\">\n            {enablePagination ? (\n              <>\n                Showing {(currentPage - 1) * itemsPerPage + 1}-\n                {Math.min(currentPage * itemsPerPage, totalEmojis)} of{' '}\n                {totalEmojis} emoji\n                {totalEmojis !== 1 ? 's' : ''}\n              </>\n            ) : (\n              <>\n                {filteredEmojis.length} emoji\n                {filteredEmojis.length !== 1 ? 's' : ''}\n              </>\n            )}\n          </span>\n        </div>\n      )}\n    </div>\n  );\n\n  // Render content directly - no portal needed\n  return content;\n};\n\n// Helper function to get category icons\nfunction getCategoryIcon(categoryName: string): string {\n  const icons: Record<string, string> = {\n    faces: '\ud83d\ude00',\n    gestures: '\ud83d\udc4b',\n    hearts: '\u2764\ufe0f',\n    objects: '\ud83d\udd27',\n    nature: '\ud83c\udf3f',\n    food: '\ud83c\udf4e',\n    travel: '\u2708\ufe0f',\n    activities: '\u26bd',\n    symbols: '\ud83d\udd25',\n    flags: '\ud83c\udfc1',\n    custom: '\u2b50'\n  };\n  return icons[categoryName] || '\ud83d\udcc1';\n}\n\n// Format emoji for text insertion\nexport function formatEmojiForText(emoji: EmojiData): string {\n  // Always use colon syntax for both custom and standard emojis\n  // This ensures they are properly tokenized by the RichTextParser\n  return `:${emoji.emoji_id}:`;\n}\n\n// Hook for managing emoji picker state\nexport function useEmojiPicker(options?: {\n  enablePagination?: boolean;\n  itemsPerPage?: number;\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const openAt = useCallback((x: number, y: number, query = '') => {\n    setPosition({ x, y });\n    setSearchQuery(query);\n    setIsOpen(true);\n  }, []);\n\n  const close = useCallback(() => {\n    setIsOpen(false);\n    setSearchQuery('');\n  }, []);\n\n  return {\n    isOpen,\n    position,\n    searchQuery,\n    openAt,\n    close,\n    // Pass pagination options through to component\n    enablePagination: options?.enablePagination ?? false,\n    itemsPerPage: options?.itemsPerPage ?? 24\n  };\n}\n",
    "language":"typescript",
    "lines":490,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/ui/YouTubeEmbed.tsx":{
    "content":"import React from 'react';\nimport './URLPill.css';\n\ninterface YouTubeEmbedProps {\n  url: string;\n  width?: 'S' | 'M' | 'L' | 'F';\n  className?: string;\n  title?: string;\n}\n\nexport function YouTubeEmbed({\n  url,\n  width = 'F',\n  className = '',\n  title = 'YouTube video'\n}: YouTubeEmbedProps) {\n  const [isVisible, setIsVisible] = React.useState(false);\n  const [hasLoaded, setHasLoaded] = React.useState(false);\n  const containerRef = React.useRef<HTMLDivElement>(null);\n\n  // Extract video ID from URL\n  const extractVideoId = (youtubeUrl: string): string | null => {\n    const patterns = [\n      /(?:youtube\\\\.com\\\\/watch\\\\?v=|youtu\\\\.be\\\\/)([^&\\\\n?#]+)/,\n      /youtube\\\\.com\\\\/embed\\\\/([^&\\\\n?#]+)/,\n      /youtube\\\\.com\\\\/v\\\\/([^&\\\\n?#]+)/\n    ];\n\n    for (const pattern of patterns) {\n      const match = youtubeUrl.match(pattern);\n      if (match) return match[1];\n    }\n    return null;\n  };\n\n  const videoId = extractVideoId(url);\n\n  // Intersection Observer for lazy loading\n  React.useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        const [entry] = entries;\n        if (entry.isIntersecting && !hasLoaded) {\n          setIsVisible(true);\n          setHasLoaded(true);\n          // Once loaded, we can disconnect the observer\n          observer.disconnect();\n        }\n      },\n      {\n        // Start loading when the element is 100px away from being visible\n        rootMargin: '100px',\n        threshold: 0.1\n      }\n    );\n\n    if (containerRef.current) {\n      observer.observe(containerRef.current);\n    }\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [hasLoaded]);\n\n  if (!videoId) {\n    return (\n      <div className={`youtube-embed-error ${className}`}>\n        <div className=\\\"youtube-embed-error__content\\\">\n          <div className=\\\"youtube-embed-error__icon\\\">\ud83d\udcfa</div>\n          <div className=\\\"youtube-embed-error__text\\\">Invalid YouTube URL</div>\n          <div className=\\\"youtube-embed-error__url\\\">{url}</div>\n        </div>\n      </div>\n    );\n  }\n\n  const embedUrl = `https://www.youtube.com/embed/${videoId}?rel=0&showinfo=0&modestbranding=1`;\n  const widthClass = `youtube-embed--${width.toLowerCase()}`;\n\n  return (\n    <div\n      className={`youtube-embed ${widthClass} ${className}`}\n      ref={containerRef}\n    >\n      <div className=\\\"youtube-embed__video-container\\\">\n        {isVisible ? (\n          <iframe\n            src={embedUrl}\n            frameBorder=\\\"0\\\"\n            allow=\\\"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture\\\"\n            allowFullScreen\n            title={title}\n            className=\\\"youtube-embed__iframe\\\"\n          />\n        ) : (\n          <div className=\\\"youtube-embed__placeholder\\\">\n            <div className=\\\"youtube-embed__placeholder-content\\\">\n              <div className=\\\"youtube-embed__placeholder-icon\\\">\ud83d\udcfa</div>\n              <div className=\\\"youtube-embed__placeholder-text\\\">\n                YouTube video will load when visible\n              </div>\n              <div className=\\\"youtube-embed__placeholder-title\\\">{title}</div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":111,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/avatars-background/AvatarsBackground.test.tsx":{
    "content":"import { cleanup, render, screen } from '@testing-library/react';\nimport React from 'react';\n\n// Mock the makeid function BEFORE importing the component\njest.mock('../../../lib/utils/string/make-id', () => ({\n  makeid: jest.fn().mockReturnValue('mocked-seed')\n}));\n\n// Mock the Avatar component\njest.mock('../avatar/Avatar', () => ({\n  Avatar: function MockedAvatar({ seed }: { seed: string }) {\n    return <div data-testid=\\\"mocked-avatar\\\" data-seed={seed}></div>;\n  }\n}));\n\n// Import after mocking\nimport { makeid } from '../../../lib/utils/string/make-id';\nimport AvatarsBackground from './AvatarsBackground';\n\ndescribe('AvatarsBackground', () => {\n  beforeEach(() => {\n    // Clear mock calls before the test, but note that makeid is called at module import time\n    jest.clearAllMocks();\n  });\n\n  afterEach(() => {\n    // Clean up after each render\n    cleanup();\n  });\n\n  it('renders the correct number of avatars', () => {\n    render(<AvatarsBackground />);\n    const avatars = screen.getAllByTestId('mocked-avatar');\n    expect(avatars).toHaveLength(10);\n  });\n\n  it('uses makeid to generate seeds for avatars', () => {\n    // Reset the mock to ensure we can track new calls\n    (makeid as jest.Mock).mockClear();\n\n    // Since makeid is called at module load time, we need to trigger a re-import\n    // or check that the calls were made previously. For this test, we'll verify\n    // that the component renders correctly with the mocked seeds.\n    render(<AvatarsBackground />);\n\n    // The component should render with the mocked seeds\n    const avatars = screen.getAllByTestId('mocked-avatar');\n    expect(avatars).toHaveLength(10);\n\n    // Each avatar should have the mocked seed in its data-seed attribute\n    avatars.forEach((avatar, index) => {\n      expect(avatar).toHaveAttribute('data-seed');\n      const seed = avatar.getAttribute('data-seed');\n      expect(seed).toMatch(/^background-\\\\d+-mocked-seed$/);\n    });\n\n    // Since makeid was called at module import time, we can't easily test\n    // the exact number of calls, but we can verify the component works correctly\n    // with the mocked return value\n  });\n\n  it('passes the generated seed to each Avatar component', () => {\n    render(<AvatarsBackground />);\n    const avatars = screen.getAllByTestId('mocked-avatar');\n    avatars.forEach((avatar) => {\n      expect(avatar).toHaveAttribute('data-seed');\n      // The seed should contain \\\"background-\\\" prefix and the mocked-seed\n      expect(avatar.getAttribute('data-seed')).toMatch(\n        /^background-\\\\d+-mocked-seed$/\n      );\n    });\n  });\n\n  it('renders avatars with correct class names', () => {\n    const { container } = render(<AvatarsBackground />);\n    const avatarContainers = container.querySelectorAll(\n      '.avatar__background_avatar'\n    );\n    expect(avatarContainers).toHaveLength(10);\n  });\n\n  it('renders the correct structure', () => {\n    const { container } = render(<AvatarsBackground />);\n    expect(\n      container.querySelector('.avatar__background-container')\n    ).toBeInTheDocument();\n    expect(container.querySelector('.avatar__background')).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":90,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/avatars-background/AvatarsBackground.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { makeid } from '../../../lib/utils/string/make-id';\nimport { Avatar } from '../avatar/Avatar';\nimport './AvatarsBackground.css';\n\n// ================================\n// TYPES\n// ================================\n\ninterface AvatarInstance {\n  id: string;\n  seed: string;\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  size: 'sm' | 'md';\n  opacity: number;\n  rotation: number;\n  rotationSpeed: number;\n  createdAt: number;\n  lifetime: number;\n}\n\n// ================================\n// CONSTANTS\n// ================================\n\nconst MAX_AVATARS = 12;\nconst GENERATION_INTERVAL = 1500; // 1.5 seconds - more frequent\nconst MIN_LIFETIME = 8000; // 8 seconds minimum\nconst MAX_LIFETIME = 15000; // 15 seconds maximum\nconst GRAVITY = 0.05; // Gentle downward movement\nconst WIND_VARIATION = 0.02; // Very subtle horizontal drift\nconst BASE_SPEED = 0.3; // Base movement speed\n\n// ================================\n// MAIN COMPONENT\n// ================================\n\nconst AvatarsBackground: React.FC = () => {\n  const [avatars, setAvatars] = useState<AvatarInstance[]>([]);\n  const animationRef = useRef<number>();\n  const lastGenerationRef = useRef<number>(0);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const generateAvatar = (): AvatarInstance => {\n    const now = Date.now();\n    const lifetime =\n      MIN_LIFETIME + Math.random() * (MAX_LIFETIME - MIN_LIFETIME);\n\n    return {\n      id: `avatar-${now}-${makeid(6)}`,\n      seed: makeid(8),\n      x: Math.random() * (window.innerWidth - 80) + 40,\n      y: window.innerHeight + 60, // Start just below screen\n      vx: (Math.random() - 0.5) * 0.2, // Gentle horizontal movement\n      vy: -BASE_SPEED - Math.random() * 0.2, // Upward movement\n      size: Math.random() > 0.6 ? 'md' : 'sm',\n      opacity: 0.15 + Math.random() * 0.25, // Subtle opacity\n      rotation: Math.random() * 360,\n      rotationSpeed: (Math.random() - 0.5) * 0.3, // Gentle rotation\n      createdAt: now,\n      lifetime\n    };\n  };\n\n  const animate = () => {\n    const now = Date.now();\n\n    setAvatars((prevAvatars) => {\n      let newAvatars = [...prevAvatars];\n\n      // Generate new avatar if needed\n      if (\n        now - lastGenerationRef.current > GENERATION_INTERVAL &&\n        newAvatars.length < MAX_AVATARS\n      ) {\n        newAvatars.push(generateAvatar());\n        lastGenerationRef.current = now;\n      }\n\n      // Update positions and remove old avatars\n      newAvatars = newAvatars\n        .map((avatar) => {\n          const age = now - avatar.createdAt;\n          const progress = age / avatar.lifetime;\n\n          // Fade out as avatar approaches end of life\n          const fadeOpacity =\n            progress > 0.8\n              ? avatar.opacity * (1 - (progress - 0.8) * 5)\n              : avatar.opacity;\n\n          return {\n            ...avatar,\n            x: avatar.x + avatar.vx,\n            y: avatar.y + avatar.vy,\n            vx: avatar.vx + (Math.random() - 0.5) * WIND_VARIATION,\n            vy: avatar.vy + GRAVITY, // Gentle downward acceleration\n            rotation: avatar.rotation + avatar.rotationSpeed,\n            opacity: Math.max(0, fadeOpacity)\n          };\n        })\n        .filter((avatar) => {\n          const age = now - avatar.createdAt;\n          const isVisible =\n            avatar.y > -100 && avatar.y < window.innerHeight + 100;\n          const isAlive = age < avatar.lifetime;\n\n          return isAlive && (isVisible || age < 2000); // Keep for 2 seconds even if off-screen\n        });\n\n      return newAvatars;\n    });\n\n    animationRef.current = requestAnimationFrame(animate);\n  };\n\n  // Initialize with a few avatars immediately\n  useEffect(() => {\n    const initialAvatars: AvatarInstance[] = [];\n    const now = Date.now();\n\n    // Create 3-5 initial avatars\n    const initialCount = 3 + Math.floor(Math.random() * 3);\n    for (let i = 0; i < initialCount; i++) {\n      const avatar = generateAvatar();\n      // Stagger their start positions\n      avatar.y = window.innerHeight + 60 + i * 100;\n      avatar.createdAt = now - i * 500; // Stagger creation time\n      initialAvatars.push(avatar);\n    }\n\n    setAvatars(initialAvatars);\n    lastGenerationRef.current = now;\n  }, []);\n\n  useEffect(() => {\n    animationRef.current = requestAnimationFrame(animate);\n\n    return () => {\n      if (animationRef.current) {\n        cancelAnimationFrame(animationRef.current);\n      }\n    };\n  }, []);\n\n  return (\n    <div\n      ref={containerRef}\n      className=\\\"avatars-background\\\"\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%',\n        pointerEvents: 'none',\n        zIndex: -1,\n        overflow: 'hidden'\n      }}\n    >\n      {avatars.map((avatar) => (\n        <div\n          key={avatar.id}\n          style={{\n            position: 'absolute',\n            left: `${avatar.x}px`,\n            top: `${avatar.y}px`,\n            opacity: avatar.opacity,\n            transform: `rotate(${avatar.rotation}deg)`,\n            filter: 'blur(0.3px) saturate(0.7)',\n            transition: 'opacity 0.3s ease-out',\n            willChange: 'transform, opacity'\n          }}\n        >\n          <Avatar seed={avatar.seed} size={avatar.size} />\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default AvatarsBackground;\n",
    "language":"typescript",
    "lines":188,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarContent.tsx":{
    "content":"import React from 'react';\n\ntype CSSFlexJustifyContentOptions =\n  | 'center'\n  | 'end'\n  | 'flex-end'\n  | 'flex-start'\n  | 'left'\n  | 'normal'\n  | 'right'\n  | 'space-around'\n  | 'space-between'\n  | 'space-evenly'\n  | 'start'\n  | 'stretch'\n  | 'inherit'\n  | 'initial'\n  | 'revert'\n  | 'revert-layer';\n\nexport function NavbarContent({\n  children,\n  className = '',\n  justify\n}: {\n  children: React.ReactNode;\n  className?: string;\n  justify: CSSFlexJustifyContentOptions;\n}) {\n  return (\n    <div\n      className={`navbar__content${justify ? `--jc-${justify}` : ''} ${className}`}\n    >\n      {children}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":38,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarBody.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport { NavbarBody } from './NavbarBody';\n\ndescribe('NavbarBody', () => {\n  it('renders children and applies default class', () => {\n    const { container } = render(\n      <NavbarBody>\n        <span>Test content</span>\n      </NavbarBody>\n    );\n\n    const bodyElement = container.firstChild as HTMLElement;\n    expect(bodyElement).toHaveClass('navbar__body');\n    expect(bodyElement).toHaveTextContent('Test content');\n  });\n\n  it('applies additional className when provided', () => {\n    const { container } = render(\n      <NavbarBody className=\\\"custom-class\\\">\n        <span>Test content</span>\n      </NavbarBody>\n    );\n\n    const bodyElement = container.firstChild as HTMLElement;\n    expect(bodyElement).toHaveClass('navbar__body');\n    expect(bodyElement).toHaveClass('custom-class');\n  });\n});\n",
    "language":"typescript",
    "lines":29,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarItem.tsx":{
    "content":"import React from 'react';\nimport { NAV_PATHS_SELECTORS } from 'src/lib/test-selectors/components/nav-paths.selectors';\n\nexport function NavbarItem({\n  children,\n  className = '',\n  isDisabled = false,\n  testId = NAV_PATHS_SELECTORS.ITEM\n}: {\n  children: React.ReactNode;\n  className?: string;\n  isDisabled?: boolean;\n  testId?: string;\n}) {\n  return (\n    <div\n      className={`navbar__item ${className}`}\n      aria-disabled={isDisabled}\n      data-testid={testId}\n    >\n      {children}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":25,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarBrand.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { NavbarBrand } from './NavbarBrand';\n\n// Mock the AuthAvatar component\njest.mock('../auth-avatar', () => ({\n  AuthAvatar: jest.fn(({ size }) => (\n    <div data-testid=\\\"auth-avatar\\\">Mock AuthAvatar: {size}</div>\n  ))\n}));\n\ndescribe('NavbarBrand', () => {\n  it('renders default avatar when unauthenticated', () => {\n    render(<NavbarBrand />);\n\n    const avatarElement = screen.getByLabelText('Default user avatar');\n    expect(avatarElement).toBeInTheDocument();\n    expect(avatarElement).toHaveClass('navbar-brand__avatar--default');\n  });\n});\n",
    "language":"typescript",
    "lines":20,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarBrand.tsx":{
    "content":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { AuthAvatar } from '../auth-avatar';\n\nexport function NavbarBrand() {\n  const { data: session, status } = useSession();\n\n  // Show placeholder during loading to prevent layout shift\n  if (status === 'loading') {\n    return (\n      <div\n        className=\\\"navbar-brand__avatar navbar-brand__avatar--placeholder\\\"\n        style={{\n          width: '2.5rem',\n          height: '2.5rem',\n          borderRadius: '50%',\n          backgroundColor: 'var(--brand-tertiary)',\n          opacity: 0.4,\n          flexShrink: 0,\n          border: '2px solid var(--brand-tertiary--light)',\n          animation: 'pulse 2s infinite'\n        }}\n        aria-label=\\\"Loading avatar\\\"\n      />\n    );\n  }\n\n  // Show default avatar for unauthenticated users\n  if (!session?.user) {\n    return (\n      <div\n        className=\\\"navbar-brand__avatar navbar-brand__avatar--default\\\"\n        style={{\n          width: '2.5rem',\n          height: '2.5rem',\n          borderRadius: '50%',\n          backgroundColor: 'var(--brand-primary)',\n          border: '2px solid var(--brand-primary--light)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          fontSize: '1.2rem',\n          color: 'white',\n          flexShrink: 0,\n          transition: 'all 0.2s ease'\n        }}\n        aria-label=\\\"Default user avatar\\\"\n        title=\\\"Welcome to Idling.app\\\"\n      >\n        \ud83d\udc64\n      </div>\n    );\n  }\n\n  // Show user avatar for authenticated users\n  return <AuthAvatar size=\\\"sm\\\" className=\\\"navbar-brand__avatar\\\" />;\n}\n",
    "language":"typescript",
    "lines":59,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/Navbar.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { Navbar } from './Navbar';\n\n// Mock the NavbarBrand component\njest.mock('./NavbarBrand', () => ({\n  NavbarBrand: () => <div data-testid=\\\"mocked-navbar-brand\\\">Mocked Brand</div>\n}));\n\n// Mock the auth function\njest.mock('../../../lib/auth', () => ({\n  auth: jest.fn(() => Promise.resolve({ user: { name: 'Test User' } }))\n}));\n\ndescribe('Navbar', () => {\n  it('renders Navbar component with children', () => {\n    render(\n      <Navbar>\n        <div data-testid=\\\"navbar-child\\\">Navbar content</div>\n      </Navbar>\n    );\n    expect(screen.getByTestId('navbar-child')).toBeInTheDocument();\n  });\n\n  it('renders Navbar with all subcomponents', async () => {\n    render(\n      <Navbar>\n        <Navbar.Brand />\n        <Navbar.Body>\n          <Navbar.Content justify=\\\"flex-start\\\">\n            <Navbar.Item>Item 1</Navbar.Item>\n            <Navbar.Item>Item 2</Navbar.Item>\n          </Navbar.Content>\n        </Navbar.Body>\n      </Navbar>\n    );\n\n    expect(\n      await screen.findByTestId('mocked-navbar-brand')\n    ).toBeInTheDocument();\n    expect(screen.getByText('Item 1')).toBeInTheDocument();\n    expect(screen.getByText('Item 2')).toBeInTheDocument();\n  });\n\n  it('applies correct CSS classes', () => {\n    render(<Navbar>Test</Navbar>);\n    const navElement = screen.getByRole('navigation');\n    expect(navElement).toHaveClass('navbar__container');\n  });\n});\n",
    "language":"typescript",
    "lines":50,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarBody.tsx":{
    "content":"'use client';\n\nexport function NavbarBody({\n  children,\n  className = ''\n}: {\n  children: React.ReactNode;\n  className?: string;\n}) {\n  return <div className={`navbar__body ${className}`}>{children}</div>;\n}\n",
    "language":"typescript",
    "lines":12,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarContent.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { NavbarContent } from './NavbarContent';\n\ndescribe('NavbarContent', () => {\n  it('renders children correctly', () => {\n    render(\n      <NavbarContent justify=\\\"center\\\">\n        <span>Test Content</span>\n      </NavbarContent>\n    );\n    expect(screen.getByText('Test Content')).toBeInTheDocument();\n  });\n\n  it('applies correct className based on justify prop', () => {\n    const { container } = render(\n      <NavbarContent justify=\\\"space-between\\\">\n        <span>Test Content</span>\n      </NavbarContent>\n    );\n    expect(container.firstChild).toHaveClass(\n      'navbar__content--jc-space-between'\n    );\n  });\n\n  it('applies additional className when provided', () => {\n    const { container } = render(\n      <NavbarContent justify=\\\"center\\\" className=\\\"custom-class\\\">\n        <span>Test Content</span>\n      </NavbarContent>\n    );\n    expect(container.firstChild).toHaveClass('custom-class');\n  });\n\n  it('renders without justify prop', () => {\n    const { container } = render(\n      <NavbarContent justify=\\\"inherit\\\">\n        <span>Test Content</span>\n      </NavbarContent>\n    );\n    expect(container.firstChild).toHaveClass('navbar__content--jc-inherit');\n  });\n\n  it('renders without additional class when justify is an empty string', () => {\n    const { container } = render(\n      // @ts-expect-error\n      <NavbarContent justify=\\\"\\\">\n        <span>Test Content</span>\n      </NavbarContent>\n    );\n    expect(container.firstChild).toHaveClass('navbar__content');\n    expect(container.firstChild).not.toHaveClass('navbar__content--jc-');\n  });\n});\n",
    "language":"typescript",
    "lines":54,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/NavbarItem.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { NAV_PATHS_SELECTORS } from 'src/lib/test-selectors/components/nav-paths.selectors';\nimport { NavbarItem } from './NavbarItem';\n\ndescribe('NavbarItem', () => {\n  it('renders children correctly', () => {\n    render(<NavbarItem>Test Content</NavbarItem>);\n    expect(screen.getByText('Test Content')).toBeInTheDocument();\n  });\n\n  it('applies default class and test ID', () => {\n    render(<NavbarItem>Test</NavbarItem>);\n    const item = screen.getByTestId(NAV_PATHS_SELECTORS.ITEM);\n    expect(item).toHaveClass('navbar__item');\n  });\n\n  it('applies custom class when provided', () => {\n    render(<NavbarItem className=\\\"custom-class\\\">Test</NavbarItem>);\n    const item = screen.getByTestId(NAV_PATHS_SELECTORS.ITEM);\n    expect(item).toHaveClass('navbar__item');\n    expect(item).toHaveClass('custom-class');\n  });\n\n  it('sets aria-disabled attribute when isDisabled is true', () => {\n    render(<NavbarItem isDisabled>Test</NavbarItem>);\n    const item = screen.getByTestId(NAV_PATHS_SELECTORS.ITEM);\n    expect(item).toHaveAttribute('aria-disabled', 'true');\n  });\n\n  it('uses custom testId when provided', () => {\n    render(<NavbarItem testId=\\\"custom-test-id\\\">Test</NavbarItem>);\n    expect(screen.getByTestId('custom-test-id')).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":35,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/navbar/Navbar.tsx":{
    "content":"import React from 'react';\nimport './Navbar.css';\nimport { NavbarBody } from './NavbarBody';\nimport { NavbarBrand } from './NavbarBrand';\nimport { NavbarContent } from './NavbarContent';\nimport { NavbarItem } from './NavbarItem';\n\nfunction NavbarComponent({ children }: { children: React.ReactNode }) {\n  return <nav className=\\\"navbar__container\\\">{children}</nav>;\n}\n\nexport const Navbar = Object.assign(NavbarComponent, {\n  Brand: NavbarBrand,\n  Body: NavbarBody,\n  Content: NavbarContent,\n  Item: NavbarItem\n});\n",
    "language":"typescript",
    "lines":18,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/twitch-chat/TwitchChat.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport './TwitchChat.css';\n\nexport interface TwitchChatProps {\n  username: string;\n  height?: string;\n  width?: string;\n  theme?: 'light' | 'dark';\n  className?: string;\n  minimal?: boolean;\n  hideHeader?: boolean;\n}\n\nexport const TwitchChat: React.FC<TwitchChatProps> = ({\n  username,\n  height = '400px',\n  width = '100%',\n  theme = 'dark',\n  className = '',\n  minimal = false,\n  hideHeader = false\n}) => {\n  const [mounted, setMounted] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n\n    // Check if mobile\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth <= 768);\n    };\n\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n\n  if (!mounted) {\n    return (\n      <div\n        className={`twitch-chat twitch-chat--loading ${className}`}\n        style={{ height, width }}\n      >\n        <div className=\\\"twitch-chat__placeholder\\\">Loading Twitch chat...</div>\n      </div>\n    );\n  }\n\n  const hostname =\n    typeof window !== 'undefined' ? window.location.hostname : 'localhost';\n  const darkMode = theme === 'dark' ? '&darkpopout' : '';\n\n  // Build minimal chat URL with reduced UI elements\n  let chatUrl = `https://www.twitch.tv/embed/${username}/chat?parent=${hostname}${darkMode}`;\n\n  if (minimal) {\n    // Add parameters for minimal chat experience\n    chatUrl += '&migration=true'; // Use newer chat interface\n  }\n\n  // Calculate iframe height based on header visibility and size\n  const headerHeight = hideHeader ? 0 : isMobile ? 50 : 60;\n  const iframeHeight = `calc(100% - ${headerHeight}px)`;\n\n  return (\n    <div className={`twitch-chat ${className}`} style={{ height, width }}>\n      {!hideHeader && (\n        <div className=\\\"twitch-chat__header\\\">\n          <span className=\\\"twitch-chat__title\\\">{username} Chat</span>\n          <a\n            href={`https://www.twitch.tv/${username}`}\n            target=\\\"_blank\\\"\n            rel=\\\"noopener noreferrer\\\"\n            className=\\\"twitch-chat__link\\\"\n          >\n            View on Twitch\n          </a>\n        </div>\n      )}\n      <iframe\n        src={chatUrl}\n        height={iframeHeight}\n        width=\\\"100%\\\"\n        title={`${username} Twitch Chat`}\n        className=\\\"twitch-chat__iframe\\\"\n        frameBorder=\\\"0\\\"\n        scrolling=\\\"no\\\"\n        allowFullScreen\n      />\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":97,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/rich-text/RichTextRenderer.tsx":{
    "content":"'use client';\n\nimport React, { useMemo } from 'react';\nimport { emojiRegistry } from '../../../lib/utils/parsers/emoji-parser';\nimport {\n  RichTextConfig,\n  richTextParser\n} from '../../../lib/utils/parsers/rich-text-parser';\nimport './RichText.css';\n\nexport interface RichTextRendererProps {\n  content: string;\n  config?: Partial<RichTextConfig>;\n  className?: string;\n  onEmojiClick?: (emojiId: string) => void;\n  onImageClick?: (imageSrc: string) => void;\n  onLinkClick?: (url: string) => void;\n  maxLength?: number;\n  showEmojiTooltips?: boolean;\n}\n\nexport const RichTextRenderer: React.FC<RichTextRendererProps> = ({\n  content,\n  config = {},\n  className = '',\n  onEmojiClick,\n  onImageClick,\n  onLinkClick,\n  maxLength,\n  showEmojiTooltips = true\n}) => {\n  // Memoize the parsed content to avoid re-parsing on every render\n  const parsedContent = useMemo(() => {\n    if (!content) return '';\n\n    // Truncate content if maxLength is specified\n    const processedContent =\n      maxLength && content.length > maxLength\n        ? content.slice(0, maxLength) + '...'\n        : content;\n\n    // Update parser config\n    const parser = richTextParser;\n    parser.updateConfig({\n      enableMarkdown: true,\n      enableEmojis: true,\n      enableImages: true,\n      enableHashtags: true,\n      enableMentions: true,\n      enableUrls: true,\n      ...config\n    });\n\n    // Parse and convert to HTML\n    const tokens = parser.parse(processedContent);\n    return parser.tokensToHtml(tokens);\n  }, [content, config, maxLength]);\n\n  // Handle click events\n  const handleClick = (event: React.MouseEvent<HTMLDivElement>) => {\n    const target = event.target as HTMLElement;\n\n    // Handle emoji clicks\n    if (target.classList.contains('emoji') && onEmojiClick) {\n      const emojiId = target.getAttribute('data-emoji');\n      if (emojiId) {\n        onEmojiClick(emojiId);\n      }\n    }\n\n    // Handle image clicks\n    if (target.classList.contains('embedded-image') && onImageClick) {\n      const imageSrc = target.getAttribute('src');\n      if (imageSrc) {\n        onImageClick(imageSrc);\n      }\n    }\n\n    // Handle link clicks\n    if (target.tagName === 'A' && onLinkClick) {\n      event.preventDefault();\n      const url = target.getAttribute('href');\n      if (url && url !== '#') {\n        onLinkClick(url);\n      }\n    }\n\n    // Handle URL embed clicks\n    if (target.classList.contains('url-embed') && onLinkClick) {\n      const url = target.getAttribute('data-url');\n      if (url) {\n        onLinkClick(url);\n      }\n    }\n  };\n\n  return (\n    <div\n      className={`rich-text-container ${className}`}\n      dangerouslySetInnerHTML={{ __html: parsedContent }}\n      onClick={handleClick}\n    />\n  );\n};\n\n// Hook for managing custom emojis\nexport const useCustomEmojis = () => {\n  const addCustomEmoji = (emoji: {\n    id: string;\n    name: string;\n    imageUrl: string;\n    category: string;\n    tags: string[];\n    aliases: string[];\n  }) => {\n    emojiRegistry.registerEmoji(emoji);\n  };\n\n  const addCustomEmojis = (\n    emojis: Array<{\n      id: string;\n      name: string;\n      imageUrl: string;\n      category: string;\n      tags: string[];\n      aliases: string[];\n    }>\n  ) => {\n    emojiRegistry.registerEmojis(emojis);\n  };\n\n  const searchEmojis = (query: string) => {\n    return emojiRegistry.searchEmojis(query);\n  };\n\n  const getEmojisByCategory = (category: string) => {\n    return emojiRegistry.getEmojisByCategory(category);\n  };\n\n  const getAllEmojis = () => {\n    return emojiRegistry.getAllEmojis();\n  };\n\n  return {\n    addCustomEmoji,\n    addCustomEmojis,\n    searchEmojis,\n    getEmojisByCategory,\n    getAllEmojis\n  };\n};\n\n// Component for emoji picker/selector\nexport interface EmojiPickerProps {\n  onEmojiSelect: (emoji: {\n    id: string;\n    name: string;\n    unicode?: string;\n    imageUrl?: string;\n  }) => void;\n  categories?: string[];\n  maxResults?: number;\n  searchQuery?: string;\n  className?: string;\n}\n\nexport const EmojiPicker: React.FC<EmojiPickerProps> = ({\n  onEmojiSelect,\n  categories = ['faces', 'gestures', 'hearts', 'objects', 'nature'],\n  maxResults = 50,\n  searchQuery = '',\n  className = ''\n}) => {\n  const { searchEmojis, getEmojisByCategory, getAllEmojis } = useCustomEmojis();\n\n  const emojis = useMemo(() => {\n    if (searchQuery) {\n      return searchEmojis(searchQuery).slice(0, maxResults);\n    }\n\n    if (categories.length === 0) {\n      return getAllEmojis().slice(0, maxResults);\n    }\n\n    const categoryEmojis = categories.flatMap((category) =>\n      getEmojisByCategory(category)\n    );\n\n    return categoryEmojis.slice(0, maxResults);\n  }, [searchQuery, categories, maxResults]);\n\n  return (\n    <div className={`emoji-picker ${className}`}>\n      <div className=\\\"emoji-grid\\\">\n        {emojis.map((emoji) => (\n          <button\n            key={emoji.id}\n            className=\\\"emoji-button\\\"\n            onClick={() => onEmojiSelect(emoji)}\n            title={`:${emoji.name}:`}\n          >\n            {emoji.unicode ? (\n              <span className=\\\"emoji emoji--unicode\\\">{emoji.unicode}</span>\n            ) : emoji.imageUrl ? (\n              <img\n                className=\\\"emoji emoji--custom\\\"\n                src={emoji.imageUrl}\n                alt={`:${emoji.name}:`}\n                loading=\\\"lazy\\\"\n              />\n            ) : (\n              <span>:{emoji.name}:</span>\n            )}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n// Utility component for rendering just emojis\nexport interface EmojiRendererProps {\n  emojiId: string;\n  size?: 'small' | 'medium' | 'large';\n  className?: string;\n}\n\nexport const EmojiRenderer: React.FC<EmojiRendererProps> = ({\n  emojiId,\n  size = 'medium',\n  className = ''\n}) => {\n  const emoji = emojiRegistry.getEmoji(emojiId);\n\n  if (!emoji) {\n    return <span className={className}>:{emojiId}:</span>;\n  }\n\n  const sizeClass = `emoji--${size}`;\n\n  return emoji.unicode ? (\n    <span\n      className={`emoji emoji--unicode ${sizeClass} ${className}`}\n      title={`:${emoji.name}:`}\n    >\n      {emoji.unicode}\n    </span>\n  ) : emoji.imageUrl ? (\n    <img\n      className={`emoji emoji--custom ${sizeClass} ${className}`}\n      src={emoji.imageUrl}\n      alt={`:${emoji.name}:`}\n      title={`:${emoji.name}:`}\n      loading=\\\"lazy\\\"\n    />\n  ) : (\n    <span className={className}>:{emoji.name}:</span>\n  );\n};\n\nexport default RichTextRenderer;\n",
    "language":"typescript",
    "lines":262,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/InteractiveTooltip.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { createPortal } from 'react-dom';\nimport './InteractiveTooltip.css';\n\ninterface InteractiveTooltipProps {\n  content: React.ReactNode;\n  children: React.ReactNode;\n  isInsideParagraph?: boolean;\n  disabled?: boolean;\n  delay?: number; // Delay before showing tooltip in milliseconds\n  className?: string; // Additional CSS class for tooltip wrapper\n  triggerOnClick?: boolean; // If true, tooltip shows/hides on click instead of hover\n  triggerOnRightClick?: boolean; // If true, tooltip shows on right-click (context menu style)\n  onClose?: () => void; // Callback when tooltip closes\n  onShow?: () => void; // Callback when tooltip is about to show\n  show?: boolean; // If provided, controls tooltip visibility programmatically\n}\n\n// Utility function to detect mobile devices\nconst isMobileDevice = () => {\n  return (\n    typeof window !== 'undefined' &&\n    window.matchMedia('(hover: none) and (pointer: coarse)').matches\n  );\n};\n\nexport const InteractiveTooltip: React.FC<InteractiveTooltipProps> = ({\n  content,\n  children,\n  isInsideParagraph = false,\n  disabled = false,\n  delay = 300,\n  className = '',\n  triggerOnClick = false,\n  triggerOnRightClick = false,\n  onClose,\n  onShow,\n  show\n}) => {\n  const [showTooltip, setShowTooltip] = useState(false);\n  const [position, setPosition] = useState({ top: 0, left: 0 });\n  const [anchorPosition, setAnchorPosition] = useState({ x: 0, y: 0 }); // Fixed anchor point\n  const [mounted, setMounted] = useState(false);\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const tooltipContentRef = useRef<HTMLDivElement>(null);\n  const hideTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const isHoveringRef = useRef(false);\n\n  // Store latest callbacks in refs to avoid dependency issues\n  const onShowRef = useRef(onShow);\n  const onCloseRef = useRef(onClose);\n\n  useEffect(() => {\n    onShowRef.current = onShow;\n    onCloseRef.current = onClose;\n  });\n\n  // Sync external show prop with internal state\n  useEffect(() => {\n    if (show !== undefined) {\n      setShowTooltip(show);\n      if (show && onShowRef.current) {\n        onShowRef.current();\n      } else if (!show && onCloseRef.current) {\n        onCloseRef.current();\n      }\n    }\n  }, [show]);\n\n  // Function to close tooltip programmatically\n  const closeTooltip = () => {\n    if (show === undefined) {\n      // Only control internal state if not controlled by show prop\n      setShowTooltip(false);\n    }\n    if (onCloseRef.current) {\n      onCloseRef.current();\n    }\n  };\n\n  // Ensure component is mounted before rendering portal\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const updatePosition = () => {\n    if (!tooltipContentRef.current || !tooltipRef.current) return;\n\n    // Special positioning for search overlay tooltips\n    if (className.includes('search-overlay-tooltip')) {\n      const triggerRect = tooltipRef.current.getBoundingClientRect();\n\n      // Position below the search input\n      const top = triggerRect.bottom + 4;\n      const left = triggerRect.left;\n\n      // Apply position\n      tooltipContentRef.current.style.visibility = 'visible';\n      tooltipContentRef.current.style.width = `${triggerRect.width}px`;\n      setPosition({ top, left });\n      return;\n    }\n\n    // Reset positioning to get accurate measurements\n    tooltipContentRef.current.style.visibility = 'hidden';\n    tooltipContentRef.current.style.position = 'fixed';\n    tooltipContentRef.current.style.top = '0px';\n    tooltipContentRef.current.style.left = '0px';\n    tooltipContentRef.current.style.transform = 'none';\n    tooltipContentRef.current.style.maxHeight = 'none';\n    tooltipContentRef.current.style.maxWidth = 'none';\n\n    // Force reflow and get dimensions\n    tooltipContentRef.current.offsetHeight;\n    const tooltipRect = tooltipContentRef.current.getBoundingClientRect();\n\n    const viewportHeight = window.innerHeight;\n    const viewportWidth = window.innerWidth;\n\n    // Enhanced padding calculations\n    const basePadding = 12;\n    const minPadding = 8;\n    const cursorOffset = 10; // Offset from cursor to avoid blocking\n\n    // Use fixed anchor position (set when tooltip is first shown)\n    const anchorX = anchorPosition.x;\n    const anchorY = anchorPosition.y;\n\n    // Calculate available space from anchor position\n    const spaceAbove = anchorY;\n    const spaceBelow = viewportHeight - anchorY;\n    const spaceLeft = anchorX;\n    const spaceRight = viewportWidth - anchorX;\n\n    // Determine vertical position with viewport boundary checking\n    let top: number;\n    let maxHeight: number | undefined;\n\n    // Calculate ideal positions\n    const belowPosition = anchorY + cursorOffset;\n    const abovePosition = anchorY - tooltipRect.height - cursorOffset;\n\n    // Check if tooltip fits below anchor without being cut off\n    if (belowPosition + tooltipRect.height <= viewportHeight - minPadding) {\n      top = belowPosition;\n    }\n    // Check if tooltip fits above anchor without being cut off\n    else if (abovePosition >= minPadding) {\n      top = abovePosition;\n    }\n    // Position in larger space with scrolling if needed, ensuring viewport visibility\n    else if (spaceBelow > spaceAbove) {\n      top = Math.max(minPadding, belowPosition);\n      const availableHeight = viewportHeight - top - minPadding;\n      if (tooltipRect.height > availableHeight) {\n        maxHeight = availableHeight;\n      }\n    } else {\n      const availableHeight = anchorY - cursorOffset - minPadding;\n      if (tooltipRect.height > availableHeight) {\n        maxHeight = availableHeight;\n        top = minPadding;\n      } else {\n        top = Math.max(minPadding, abovePosition);\n      }\n    }\n\n    // Final viewport boundary check for vertical position\n    if (top + (maxHeight || tooltipRect.height) > viewportHeight - minPadding) {\n      top = viewportHeight - (maxHeight || tooltipRect.height) - minPadding;\n      top = Math.max(minPadding, top);\n    }\n\n    // Determine horizontal position with viewport boundary checking\n    let left: number;\n    let maxWidth: number | undefined;\n\n    // Calculate ideal positions\n    const rightPosition = anchorX + cursorOffset;\n    const leftPosition = anchorX - tooltipRect.width - cursorOffset;\n    const centerPosition = anchorX - tooltipRect.width / 2;\n\n    // Check if tooltip fits to the right without being cut off\n    if (rightPosition + tooltipRect.width <= viewportWidth - minPadding) {\n      left = rightPosition;\n    }\n    // Check if tooltip fits to the left without being cut off\n    else if (leftPosition >= minPadding) {\n      left = leftPosition;\n    }\n    // Check if centered position fits without being cut off\n    else if (\n      centerPosition >= minPadding &&\n      centerPosition + tooltipRect.width <= viewportWidth - minPadding\n    ) {\n      left = centerPosition;\n    }\n    // Force fit within viewport with width constraints if necessary\n    else {\n      // Try to center as much as possible while staying in viewport\n      left = Math.max(\n        minPadding,\n        Math.min(centerPosition, viewportWidth - tooltipRect.width - minPadding)\n      );\n\n      // If tooltip is still too wide, constrain width and position at edge\n      if (\n        left < minPadding ||\n        left + tooltipRect.width > viewportWidth - minPadding\n      ) {\n        const availableWidth = viewportWidth - minPadding * 2;\n        if (tooltipRect.width > availableWidth) {\n          maxWidth = availableWidth;\n        }\n        left = minPadding;\n      }\n    }\n\n    // Final viewport boundary check for horizontal position\n    if (left + (maxWidth || tooltipRect.width) > viewportWidth - minPadding) {\n      left = viewportWidth - (maxWidth || tooltipRect.width) - minPadding;\n      left = Math.max(minPadding, left);\n    }\n\n    // Apply constraints if needed\n    if (maxHeight) {\n      tooltipContentRef.current.style.maxHeight = `${maxHeight}px`;\n      tooltipContentRef.current.style.overflowY = 'auto';\n    }\n    if (maxWidth) {\n      tooltipContentRef.current.style.maxWidth = `${maxWidth}px`;\n      tooltipContentRef.current.style.overflowX = 'hidden';\n    }\n\n    // Restore visibility and set final position\n    tooltipContentRef.current.style.visibility = 'visible';\n    setPosition({ top, left });\n  };\n\n  // Update position only when tooltip is first shown\n  useEffect(() => {\n    if (showTooltip) {\n      updatePosition();\n    }\n  }, [showTooltip, anchorPosition]); // Only depend on showTooltip and anchorPosition, not cursor movement\n\n  // Handle scroll to keep tooltip in sync with page\n  useEffect(() => {\n    if (showTooltip) {\n      // Only handle resize, not scroll - let tooltip scroll naturally with page\n      const handleResize = () => {\n        updatePosition();\n      };\n\n      window.addEventListener('resize', handleResize);\n\n      return () => {\n        window.removeEventListener('resize', handleResize);\n      };\n    }\n  }, [showTooltip]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        showTooltip &&\n        tooltipContentRef.current &&\n        !tooltipContentRef.current.contains(event.target as Node) &&\n        tooltipRef.current &&\n        !tooltipRef.current.contains(event.target as Node)\n      ) {\n        closeTooltip();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [showTooltip]);\n\n  const handleMouseEnter = (event: React.MouseEvent) => {\n    // Don't handle mouse events if controlled by show prop\n    if (show !== undefined) return;\n\n    // Update cursor position from the trigger event\n    setAnchorPosition({ x: event.clientX, y: event.clientY });\n\n    // On mobile, don't trigger hover events\n    const isMobile = isMobileDevice();\n    if (disabled || triggerOnClick || isMobile) return;\n\n    isHoveringRef.current = true;\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n    }\n    const timeout = setTimeout(() => {\n      if (onShowRef.current) {\n        onShowRef.current(); // Call onShow callback before showing tooltip\n      }\n      setShowTooltip(true);\n    }, delay);\n    hideTimeoutRef.current = timeout;\n  };\n\n  const handleMouseLeave = () => {\n    // Don't handle mouse events if controlled by show prop\n    if (show !== undefined) return;\n\n    // On mobile, don't trigger mouse leave events\n    const isMobile = isMobileDevice();\n    if (triggerOnClick || isMobile) return;\n\n    isHoveringRef.current = false;\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n    }\n    const timeout = setTimeout(() => {\n      if (!isHoveringRef.current) {\n        setShowTooltip(false);\n      }\n    }, 300); // Longer delay for interactive content\n    hideTimeoutRef.current = timeout;\n  };\n\n  const handleClick = (event: React.MouseEvent) => {\n    // Don't handle click events if controlled by show prop\n    if (show !== undefined) return;\n\n    if (disabled) return;\n\n    // Update cursor position from the click event\n    setAnchorPosition({ x: event.clientX, y: event.clientY });\n\n    // On mobile, always use click mode regardless of triggerOnClick setting\n    const isMobile = isMobileDevice();\n\n    if (!triggerOnClick && !triggerOnRightClick && !isMobile) return;\n\n    const newShowState = !showTooltip;\n\n    if (newShowState && onShow) {\n      onShow(); // Call onShow callback before showing tooltip\n    }\n\n    setShowTooltip(newShowState);\n\n    if (!newShowState && onClose) {\n      onClose();\n    }\n  };\n\n  const handleContextMenu = (event: React.MouseEvent) => {\n    // Don't handle context menu if controlled by show prop or not enabled\n    if (show !== undefined || !triggerOnRightClick || disabled) return;\n\n    event.preventDefault();\n\n    // Update cursor position from the context menu event\n    setAnchorPosition({ x: event.clientX, y: event.clientY });\n\n    if (onShow) {\n      onShow(); // Call onShow callback before showing tooltip\n    }\n\n    setShowTooltip(true);\n  };\n\n  const handleTooltipMouseEnter = () => {\n    if (triggerOnClick || isMobileDevice()) return; // Don't use hover logic in click mode or on mobile\n\n    isHoveringRef.current = true;\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n    }\n  };\n\n  const handleTooltipMouseLeave = () => {\n    if (triggerOnClick || isMobileDevice()) return; // Don't use hover logic in click mode or on mobile\n\n    isHoveringRef.current = false;\n    handleMouseLeave();\n  };\n\n  // Cleanup timeouts on unmount\n  useEffect(() => {\n    return () => {\n      if (hideTimeoutRef.current) {\n        clearTimeout(hideTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  // Clone content and pass closeTooltip function if it's a React element\n  const enhancedContent = React.isValidElement(content)\n    ? React.cloneElement(content as React.ReactElement<any>, {\n        // Only pass closeTooltip to React components, not DOM elements\n        ...(typeof (content as any).type === 'function' ? { closeTooltip } : {})\n      })\n    : content;\n\n  const Wrapper = isInsideParagraph ? 'span' : 'div';\n\n  return (\n    <>\n      <Wrapper\n        ref={tooltipRef}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        onClick={handleClick}\n        onContextMenu={handleContextMenu}\n        style={{ display: 'inline-block' }}\n      >\n        {children}\n      </Wrapper>\n      {mounted &&\n        (show !== undefined ? show : showTooltip) &&\n        content &&\n        createPortal(\n          <div\n            ref={tooltipContentRef}\n            className={`link-tooltip interactive-tooltip glass-border-heavy ${className} ${showTooltip ? 'visible' : ''}`}\n            onMouseEnter={handleTooltipMouseEnter}\n            onMouseLeave={handleTooltipMouseLeave}\n            style={{\n              position: 'fixed',\n              top: position.top,\n              left: position.left,\n              zIndex: className.includes('search-overlay-tooltip')\n                ? 10100\n                : 10001,\n              // Protected background styles - components cannot override these\n              background: 'var(--tooltip-glass-bg) !important',\n              backdropFilter: 'var(--tooltip-glass-blur) !important',\n              WebkitBackdropFilter: 'var(--tooltip-glass-blur) !important',\n              border: '1px solid var(--tooltip-glass-border) !important',\n              boxShadow: 'var(--tooltip-glass-shadow) !important',\n              // Search overlay specific styles\n              ...(className.includes('search-overlay-tooltip') && {\n                maxHeight: '200px',\n                overflowY: 'auto' as const,\n                overflowX: 'hidden' as const\n              }),\n              // Only allow transparent background for author-tooltip-wrapper\n              ...(className === 'author-tooltip-wrapper' && {\n                background: 'transparent !important',\n                backdropFilter: 'none !important',\n                WebkitBackdropFilter: 'none !important',\n                border: 'none !important',\n                boxShadow: 'none !important'\n              })\n            }}\n            data-testid=\\\"interactive-tooltip\\\"\n          >\n            {enhancedContent}\n          </div>,\n          document.body\n        )}\n    </>\n  );\n};\n",
    "language":"typescript",
    "lines":464,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/LinkTooltip.tsx":{
    "content":"'use client';\n\nimport React, { useCallback, useEffect, useRef } from 'react';\nimport { createPortal } from 'react-dom';\nimport { useTooltipCache } from '../../hooks/useTooltipCache';\nimport { useTooltipHandlers } from '../../hooks/useTooltipHandlers';\nimport { useTooltipPosition } from '../../hooks/useTooltipPosition';\nimport { useTooltipState } from '../../hooks/useTooltipState';\nimport './LinkTooltip.css';\nimport { TooltipContent } from './TooltipContent';\nimport { TooltipModal } from './TooltipModal';\n\ninterface LinkTooltipProps {\n  url: string;\n  children: React.ReactNode;\n  enableExtendedPreview?: boolean;\n  enableCtrlClick?: boolean;\n  cacheDuration?: number;\n  isInsideParagraph?: boolean;\n  className?: string;\n}\n\nexport const LinkTooltip: React.FC<LinkTooltipProps> = ({\n  url,\n  children,\n  enableExtendedPreview = false,\n  enableCtrlClick = false,\n  cacheDuration,\n  isInsideParagraph = false,\n  className\n}) => {\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const tooltipContentRef = useRef<HTMLDivElement>(null);\n  const modalContentRef = useRef<HTMLDivElement>(null);\n\n  const state = useTooltipState();\n  const cache = useTooltipCache(url, cacheDuration);\n  const { position, updatePosition } = useTooltipPosition(\n    tooltipRef,\n    tooltipContentRef\n  );\n\n  const fetchPreview = useCallback(async () => {\n    if (!state.shouldFetchRef.current) return;\n    state.shouldFetchRef.current = false;\n\n    state.setLoading(true);\n    state.setError(null);\n\n    const cached = cache.getCachedData(url);\n    if (cached) {\n      state.setTooltipData(cached.data);\n      cache.setIsCached(true);\n      cache.setLastUpdated(new Date(cached.timestamp));\n      state.setLoading(false);\n      return;\n    }\n\n    try {\n      const response = await fetch(\n        `/api/link-preview?url=${encodeURIComponent(url)}`\n      );\n      if (!response.ok) throw new Error('Failed to fetch preview');\n      const data = await response.json();\n      state.setTooltipData(data);\n      cache.setCachedData(url, data);\n      cache.setIsCached(false);\n      cache.setLastUpdated(new Date());\n    } catch (err) {\n      state.setError(\n        err instanceof Error ? err.message : 'Failed to load preview'\n      );\n    } finally {\n      state.setLoading(false);\n    }\n  }, [url, cache, state]);\n\n  const handleRefresh = useCallback(async () => {\n    state.setLoading(true);\n    state.setError(null);\n    try {\n      const response = await fetch(\n        `/api/link-preview?url=${encodeURIComponent(url)}`\n      );\n      if (!response.ok) throw new Error('Failed to fetch preview');\n      const data = await response.json();\n      state.setTooltipData(data);\n      cache.setCachedData(url, data);\n    } catch (err) {\n      state.setError(\n        err instanceof Error ? err.message : 'Failed to load preview'\n      );\n    } finally {\n      state.setLoading(false);\n    }\n  }, [url, cache, state]);\n\n  const handlers = useTooltipHandlers({\n    showTooltip: state.showTooltip,\n    setShowTooltip: state.setShowTooltip,\n    setShowModal: state.setShowModal,\n    setIsFullscreen: state.setIsFullscreen,\n    setShowControls: state.setShowControls,\n    isFullscreen: state.isFullscreen,\n    showControls: state.showControls,\n    hideTimeoutRef: state.hideTimeoutRef,\n    isHoveringRef: state.isHoveringRef,\n    shouldFetchRef: state.shouldFetchRef,\n    updatePosition,\n    fetchPreview,\n    url,\n    enableCtrlClick\n  });\n\n  useEffect(() => {\n    state.setMounted(true);\n  }, [state]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        state.showTooltip &&\n        tooltipContentRef.current &&\n        !tooltipContentRef.current.contains(event.target as Node) &&\n        tooltipRef.current &&\n        !tooltipRef.current.contains(event.target as Node)\n      ) {\n        state.setShowTooltip(false);\n        state.shouldFetchRef.current = true;\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [state.showTooltip, state]);\n\n  useEffect(() => {\n    if (state.showTooltip) {\n      fetchPreview();\n    }\n  }, [state.showTooltip, fetchPreview]);\n\n  useEffect(() => {\n    if (state.showTooltip) {\n      updatePosition();\n      window.addEventListener('scroll', updatePosition);\n      window.addEventListener('resize', updatePosition);\n    }\n\n    return () => {\n      window.removeEventListener('scroll', updatePosition);\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [state.showTooltip, updatePosition]);\n\n  useEffect(() => {\n    if (state.showModal) {\n      document.body.classList.add('modal-open');\n      state.setShowTooltip(false);\n      state.shouldFetchRef.current = true;\n    } else {\n      document.body.classList.remove('modal-open');\n    }\n\n    return () => {\n      document.body.classList.remove('modal-open');\n    };\n  }, [state.showModal, state]);\n\n  const Wrapper = isInsideParagraph ? 'span' : 'div';\n\n  // Handle mobile click behavior on the wrapper\n  const handleWrapperClick = (e: React.MouseEvent) => {\n    const isMobile = window.matchMedia(\n      '(hover: none) and (pointer: coarse)'\n    ).matches;\n\n    if (isMobile) {\n      // On mobile, prevent any default link behavior from child elements\n      e.preventDefault();\n      e.stopPropagation();\n    }\n\n    // Call the tooltip handler\n    handlers.handleClick(e);\n  };\n\n  return (\n    <>\n      <Wrapper\n        ref={tooltipRef}\n        onMouseEnter={handlers.handleMouseEnter}\n        onMouseLeave={handlers.handleMouseLeave}\n        onClick={handleWrapperClick}\n        className={`${className} ${isInsideParagraph ? 'inline-block' : ''}`}\n      >\n        {children}\n      </Wrapper>\n      {state.mounted &&\n        state.showTooltip &&\n        createPortal(\n          <div\n            ref={tooltipContentRef}\n            className={`link-tooltip ${enableExtendedPreview ? 'large' : ''} ${state.showTooltip ? 'visible' : ''}`}\n            onMouseEnter={handlers.handleTooltipMouseEnter}\n            onMouseLeave={handlers.handleTooltipMouseLeave}\n            style={{\n              position: 'fixed',\n              top: position.top,\n              left: position.left,\n              padding: 'var(--spacing-cozy)',\n              zIndex: 10000\n            }}\n            data-testid=\\\"link-tooltip\\\"\n          >\n            {enableCtrlClick && (\n              <div className=\\\"link-tooltip-ctrl-message\\\">\n                Hold Ctrl and click to open in modal\n              </div>\n            )}\n            <TooltipContent\n              loading={state.loading}\n              error={state.error}\n              tooltipData={state.tooltipData}\n              enableExtendedPreview={enableExtendedPreview}\n              isCached={cache.isCached}\n              lastUpdated={cache.lastUpdated}\n              url={url}\n              onRefresh={handleRefresh}\n              onClick={handlers.handleClick}\n            />\n          </div>,\n          document.body\n        )}\n      <TooltipModal\n        showModal={state.showModal}\n        enableCtrlClick={enableCtrlClick}\n        isFullscreen={state.isFullscreen}\n        showControls={state.showControls}\n        url={url}\n        modalContentRef={modalContentRef}\n        onModalClose={handlers.handleModalClose}\n        onModalContentClick={handlers.handleModalContentClick}\n        onFullscreenToggle={handlers.handleFullscreenToggle}\n        onControlsToggle={handlers.handleControlsToggle}\n      />\n    </>\n  );\n};\n",
    "language":"typescript",
    "lines":252,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/TooltipContent.tsx":{
    "content":"import React from 'react';\nimport { InstantLink } from '../ui/InstantLink';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport './TooltipContent.css';\n\ninterface TooltipContentProps {\n  loading: boolean;\n  error: string | null;\n  tooltipData: any;\n  enableExtendedPreview: boolean;\n  isCached: boolean;\n  lastUpdated: Date | null;\n  url: string;\n  onRefresh: () => void;\n  onClick: (e: React.MouseEvent) => void;\n  cacheStats?: {\n    entryCount: number;\n    totalSizeMB: string;\n    maxEntries: number;\n    maxSizeMB: string;\n  } | null;\n  onClearCache?: () => void;\n}\n\n// Utility function to detect mobile devices\nconst isMobileDevice = () => {\n  return (\n    typeof window !== 'undefined' &&\n    window.matchMedia('(hover: none) and (pointer: coarse)').matches\n  );\n};\n\nexport const TooltipContent: React.FC<TooltipContentProps> = ({\n  loading,\n  error,\n  tooltipData,\n  enableExtendedPreview,\n  isCached,\n  lastUpdated,\n  url,\n  onRefresh,\n  onClick,\n  cacheStats,\n  onClearCache\n}) => {\n  if (loading) {\n    return (\n      <div className=\\\"tooltip-loading\\\">\n        <div className=\\\"tooltip-spinner\\\" />\n        Loading preview...\n      </div>\n    );\n  }\n\n  if (error) {\n    return <div className=\\\"tooltip-error\\\">{error}</div>;\n  }\n\n  if (!tooltipData) {\n    return <div className=\\\"tooltip-error\\\">No preview available</div>;\n  }\n\n  const renderCacheInfo = () => (\n    <div className=\\\"tooltip-cache-info\\\">\n      <span>Cached content</span>\n      {lastUpdated && (\n        <span className=\\\"tooltip-cache-time\\\">\n          Last updated:&nbsp;\n          <TimestampWithTooltip date={lastUpdated} abbreviated />\n        </span>\n      )}\n      <button\n        className=\\\"tooltip-refresh-button\\\"\n        onClick={(e) => {\n          e.stopPropagation();\n          onRefresh();\n        }}\n      >\n        Refresh\n      </button>\n      {cacheStats && (\n        <div className=\\\"tooltip-cache-stats\\\">\n          <small>\n            Cache: {cacheStats.entryCount}/{cacheStats.maxEntries} items (\n            {cacheStats.totalSizeMB}MB/{cacheStats.maxSizeMB}MB)\n          </small>\n          {onClearCache && (\n            <button\n              className=\\\"tooltip-clear-cache-button\\\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onClearCache();\n              }}\n              title=\\\"Clear all cached tooltips\\\"\n            >\n              Clear\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  );\n\n  // Mobile-specific link button\n  const renderMobileLinkButton = () => {\n    if (!isMobileDevice()) return null;\n\n    return (\n      <div className=\\\"tooltip-mobile-link\\\">\n        <InstantLink\n          href={url}\n          target=\\\"_blank\\\"\n          className=\\\"tooltip-mobile-link-button\\\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          Visit Link \u2192\n        </InstantLink>\n      </div>\n    );\n  };\n\n  if (enableExtendedPreview) {\n    return (\n      <div className=\\\"tooltip-content\\\" onClick={onClick}>\n        {isCached && renderCacheInfo()}\n        <div className=\\\"tooltip-header\\\">\n          {tooltipData.image && (\n            <img src={tooltipData.image} alt={tooltipData.title} />\n          )}\n          <h3 className=\\\"tooltip-title\\\">{tooltipData.title}</h3>\n        </div>\n        {tooltipData.description && (\n          <p className=\\\"tooltip-description\\\">{tooltipData.description}</p>\n        )}\n        <iframe\n          src={url}\n          className=\\\"tooltip-iframe\\\"\n          sandbox=\\\"allow-same-origin allow-scripts\\\"\n        />\n        <div className=\\\"tooltip-footer\\\">\n          {tooltipData.favicon && (\n            <img src={tooltipData.favicon} alt=\\\"Site favicon\\\" />\n          )}\n          <span>{tooltipData.url}</span>\n        </div>\n        {renderMobileLinkButton()}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\\\"link-tooltip-content\\\" onClick={onClick}>\n      {isCached && renderCacheInfo()}\n      {tooltipData.image && (\n        <div className=\\\"link-tooltip-image\\\">\n          <img src={tooltipData.image} alt={tooltipData.title} />\n        </div>\n      )}\n      <div className=\\\"link-tooltip-text\\\">\n        <div className=\\\"link-tooltip-title\\\">{tooltipData.title}</div>\n        {tooltipData.description && (\n          <div className=\\\"link-tooltip-description\\\">\n            {tooltipData.description}\n          </div>\n        )}\n      </div>\n      <div className=\\\"link-tooltip-url\\\">{tooltipData.url}</div>\n      {renderMobileLinkButton()}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":172,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/TooltipModal.tsx":{
    "content":"import React, { RefObject } from 'react';\nimport './TooltipModal.css';\n\ninterface TooltipModalProps {\n  showModal: boolean;\n  enableCtrlClick: boolean;\n  isFullscreen: boolean;\n  showControls: boolean;\n  url: string;\n  modalContentRef: RefObject<HTMLDivElement>;\n  onModalClose: (e: React.MouseEvent) => void;\n  onModalContentClick: (e: React.MouseEvent) => void;\n  onFullscreenToggle: (e: React.MouseEvent) => void;\n  onControlsToggle: (e: React.MouseEvent) => void;\n}\n\nexport const TooltipModal: React.FC<TooltipModalProps> = ({\n  showModal,\n  enableCtrlClick,\n  isFullscreen,\n  showControls,\n  url,\n  modalContentRef,\n  onModalClose,\n  onModalContentClick,\n  onFullscreenToggle,\n  onControlsToggle\n}) => {\n  if (!showModal || !enableCtrlClick) return null;\n\n  return (\n    <div\n      className=\\\"link-preview-modal\\\"\n      data-testid=\\\"link-preview-modal\\\"\n      onMouseDown={(e) => e.preventDefault()}\n      onClick={onModalClose}\n    >\n      <div\n        ref={modalContentRef}\n        className={`link-preview-modal-content ${isFullscreen ? 'fullscreen' : ''}`}\n        onClick={onModalContentClick}\n      >\n        <div\n          className={`modal-controls ${showControls ? 'visible' : 'hidden'}`}\n        >\n          <div className=\\\"modal-controls-buttons\\\">\n            <button\n              className=\\\"modal-control-button fullscreen-toggle\\\"\n              onClick={onFullscreenToggle}\n              aria-label={isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen'}\n            >\n              {isFullscreen ? (\n                <svg\n                  width=\\\"16\\\"\n                  height=\\\"16\\\"\n                  viewBox=\\\"0 0 24 24\\\"\n                  fill=\\\"none\\\"\n                  stroke=\\\"currentColor\\\"\n                  strokeWidth=\\\"2\\\"\n                >\n                  <path d=\\\"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3\\\" />\n                </svg>\n              ) : (\n                <svg\n                  width=\\\"16\\\"\n                  height=\\\"16\\\"\n                  viewBox=\\\"0 0 24 24\\\"\n                  fill=\\\"none\\\"\n                  stroke=\\\"currentColor\\\"\n                  strokeWidth=\\\"2\\\"\n                >\n                  <path d=\\\"M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7\\\" />\n                </svg>\n              )}\n            </button>\n            <button\n              className=\\\"modal-control-button close-button\\\"\n              onClick={onModalClose}\n              aria-label=\\\"Close modal\\\"\n            >\n              \u00d7\n            </button>\n            <button\n              className=\\\"modal-control-button toggle-button\\\"\n              onClick={onControlsToggle}\n              aria-label=\\\"Hide controls\\\"\n            >\n              <svg\n                width=\\\"14\\\"\n                height=\\\"14\\\"\n                viewBox=\\\"0 0 24 24\\\"\n                fill=\\\"none\\\"\n                stroke=\\\"currentColor\\\"\n                strokeWidth=\\\"2\\\"\n              >\n                <path d=\\\"M18 15l-6-6-6 6\\\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n        {!showControls && (\n          <button\n            className=\\\"modal-control-button toggle-button restore-button\\\"\n            onClick={onControlsToggle}\n            aria-label=\\\"Show controls\\\"\n          >\n            <svg\n              width=\\\"14\\\"\n              height=\\\"14\\\"\n              viewBox=\\\"0 0 24 24\\\"\n              fill=\\\"none\\\"\n              stroke=\\\"currentColor\\\"\n              strokeWidth=\\\"2\\\"\n            >\n              <path d=\\\"M18 15l-6-6-6 6\\\" />\n            </svg>\n          </button>\n        )}\n        <iframe\n          src={url}\n          style={{ width: '100%', height: '100%', border: 'none' }}\n          sandbox=\\\"allow-same-origin allow-scripts\\\"\n        />\n      </div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":128,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/MentionTooltip.tsx":{
    "content":"import { useEffect, useRef } from 'react';\nimport './MentionTooltip.css';\n\ninterface MentionTooltipProps {\n  username: string;\n  onFilterByAuthor: () => void;\n  onFilterByContent: () => void;\n  onClose: () => void;\n  onHover?: () => void;\n  onLeave?: () => void;\n  position: { x: number; y: number };\n}\n\nexport function MentionTooltip({\n  username,\n  onFilterByAuthor,\n  onFilterByContent,\n  onClose,\n  onHover,\n  onLeave,\n  position\n}: MentionTooltipProps) {\n  const tooltipRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        tooltipRef.current &&\n        !tooltipRef.current.contains(event.target as Node)\n      ) {\n        onClose();\n      }\n    };\n\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    document.addEventListener('keydown', handleEscape);\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n      document.removeEventListener('keydown', handleEscape);\n    };\n  }, [onClose]);\n\n  return (\n    <div\n      ref={tooltipRef}\n      className=\\\"mention-tooltip\\\"\n      onMouseEnter={onHover}\n      onMouseLeave={onLeave}\n      style={{\n        position: 'fixed',\n        left: position.x,\n        top: position.y,\n        zIndex: 10000,\n        display: 'block'\n      }}\n    >\n      <div className=\\\"mention-tooltip__header\\\">Filter by @{username}</div>\n      <div className=\\\"mention-tooltip__options\\\">\n        <button\n          className=\\\"mention-tooltip__option mention-tooltip__option--primary\\\"\n          onClick={onFilterByAuthor}\n          title=\\\"Show posts authored by this user\\\"\n        >\n          <span className=\\\"mention-tooltip__icon\\\">\ud83d\udc64</span>\n          Filter by Author\n          <span className=\\\"mention-tooltip__description\\\">\n            Posts by this user\n          </span>\n        </button>\n        <button\n          className=\\\"mention-tooltip__option\\\"\n          onClick={onFilterByContent}\n          title=\\\"Show posts that mention this user\\\"\n        >\n          <span className=\\\"mention-tooltip__icon\\\">\ud83d\udcac</span>\n          Filter by Mentions\n          <span className=\\\"mention-tooltip__description\\\">\n            Posts mentioning this user\n          </span>\n        </button>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":92,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/WebPreviewPortal.tsx":{
    "content":"'use client';\n\nimport React from 'react';\nimport { createPortal } from 'react-dom';\nimport './WebPreviewPortal.css';\n\ninterface WebPreviewPortalProps {\n  url: string;\n  isVisible: boolean;\n  position: { x: number; y: number };\n}\n\nexport const WebPreviewPortal: React.FC<WebPreviewPortalProps> = ({\n  url,\n  isVisible,\n  position\n}) => {\n  const [mounted, setMounted] = React.useState(false);\n  const [isLoading, setIsLoading] = React.useState(true);\n  const iframeRef = React.useRef<HTMLIFrameElement>(null);\n\n  React.useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  React.useEffect(() => {\n    if (isVisible && iframeRef.current) {\n      setIsLoading(true);\n      iframeRef.current.src = url;\n    }\n  }, [url, isVisible]);\n\n  if (!mounted || !isVisible) return null;\n\n  return createPortal(\n    <div\n      className=\\\"web-preview-portal\\\"\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`\n      }}\n    >\n      <div className=\\\"web-preview-header\\\">\n        <div className=\\\"web-preview-url\\\">{url}</div>\n        <div className=\\\"web-preview-controls\\\">\n          <button className=\\\"web-preview-close\\\">\u00d7</button>\n        </div>\n      </div>\n      {isLoading && (\n        <div className=\\\"web-preview-loading\\\">\n          <div className=\\\"web-preview-spinner\\\"></div>\n          Loading preview...\n        </div>\n      )}\n      <iframe\n        ref={iframeRef}\n        className=\\\"web-preview-iframe\\\"\n        onLoad={() => setIsLoading(false)}\n        sandbox=\\\"allow-same-origin allow-scripts\\\"\n      />\n    </div>,\n    document.body\n  );\n};\n",
    "language":"typescript",
    "lines":65,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/InfoTooltip.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport './LinkTooltip.css';\n\ninterface InfoTooltipProps {\n  content: string;\n  children: React.ReactNode;\n  isInsideParagraph?: boolean;\n  disabled?: boolean;\n  delay?: number; // Delay before showing tooltip in milliseconds\n}\n\nexport const InfoTooltip: React.FC<InfoTooltipProps> = ({\n  content,\n  children,\n  isInsideParagraph = false,\n  disabled = false,\n  delay = 300\n}) => {\n  const [showTooltip, setShowTooltip] = useState(false);\n  const [position, setPosition] = useState({ top: 0, left: 0 });\n  const tooltipRef = useRef<HTMLDivElement>(null);\n  const tooltipContentRef = useRef<HTMLDivElement>(null);\n  const hideTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const isHoveringRef = useRef(false);\n\n  const updatePosition = () => {\n    if (!tooltipRef.current || !tooltipContentRef.current) return;\n\n    const triggerRect = tooltipRef.current.getBoundingClientRect();\n    const tooltipRect = tooltipContentRef.current.getBoundingClientRect();\n    const viewportHeight = window.innerHeight;\n    const viewportWidth = window.innerWidth;\n\n    // Calculate available space\n    const spaceAbove = triggerRect.top;\n    const spaceBelow = viewportHeight - triggerRect.bottom;\n    const spaceLeft = triggerRect.left;\n    const spaceRight = viewportWidth - triggerRect.right;\n\n    // Determine vertical position\n    let top: number;\n    if (spaceBelow >= tooltipRect.height || spaceBelow >= spaceAbove) {\n      // Position below if there's more space below or equal space\n      top = triggerRect.bottom + 8;\n    } else {\n      // Position above if there's more space above\n      top = triggerRect.top - tooltipRect.height - 8;\n    }\n\n    // Ensure tooltip stays within viewport vertically\n    top = Math.max(8, Math.min(top, viewportHeight - tooltipRect.height - 8));\n\n    // Determine horizontal position\n    let left: number;\n    if (\n      spaceRight >= tooltipRect.width / 2 &&\n      spaceLeft >= tooltipRect.width / 2\n    ) {\n      // Center if enough space on both sides\n      left = triggerRect.left + (triggerRect.width - tooltipRect.width) / 2;\n    } else if (spaceRight >= tooltipRect.width) {\n      // Align to left if more space on right\n      left = triggerRect.left;\n    } else if (spaceLeft >= tooltipRect.width) {\n      // Align to right if more space on left\n      left = triggerRect.right - tooltipRect.width;\n    } else {\n      // Center if no space on either side\n      left = Math.max(\n        8,\n        Math.min(\n          triggerRect.left + (triggerRect.width - tooltipRect.width) / 2,\n          viewportWidth - tooltipRect.width - 8\n        )\n      );\n    }\n\n    setPosition({ top, left });\n  };\n\n  useEffect(() => {\n    if (showTooltip) {\n      updatePosition();\n      window.addEventListener('scroll', updatePosition);\n      window.addEventListener('resize', updatePosition);\n    }\n\n    return () => {\n      window.removeEventListener('scroll', updatePosition);\n      window.removeEventListener('resize', updatePosition);\n    };\n  }, [showTooltip]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        showTooltip &&\n        tooltipContentRef.current &&\n        !tooltipContentRef.current.contains(event.target as Node) &&\n        tooltipRef.current &&\n        !tooltipRef.current.contains(event.target as Node)\n      ) {\n        setShowTooltip(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [showTooltip]);\n\n  const handleMouseEnter = () => {\n    // Don't trigger hover events on mobile devices\n    const isMobile = window.matchMedia(\n      '(hover: none) and (pointer: coarse)'\n    ).matches;\n    if (disabled || isMobile) return;\n\n    isHoveringRef.current = true;\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n    }\n    const timeout = setTimeout(() => {\n      setShowTooltip(true);\n      // Update position after a short delay to ensure content is rendered\n      setTimeout(updatePosition, 0);\n    }, delay);\n    hideTimeoutRef.current = timeout;\n  };\n\n  const handleMouseLeave = () => {\n    // Don't trigger hover events on mobile devices\n    const isMobile = window.matchMedia(\n      '(hover: none) and (pointer: coarse)'\n    ).matches;\n    if (isMobile) return;\n\n    isHoveringRef.current = false;\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n    }\n    const timeout = setTimeout(() => {\n      if (!isHoveringRef.current) {\n        setShowTooltip(false);\n      }\n    }, 100);\n    hideTimeoutRef.current = timeout;\n  };\n\n  const handleClick = () => {\n    // On mobile, toggle tooltip on click\n    const isMobile = window.matchMedia(\n      '(hover: none) and (pointer: coarse)'\n    ).matches;\n    if (!isMobile) return;\n\n    const newShowState = !showTooltip;\n    setShowTooltip(newShowState);\n\n    if (newShowState) {\n      setTimeout(updatePosition, 0);\n    }\n  };\n\n  const handleTooltipMouseEnter = () => {\n    // Don't trigger hover events on mobile devices\n    const isMobile = window.matchMedia(\n      '(hover: none) and (pointer: coarse)'\n    ).matches;\n    if (isMobile) return;\n\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n    }\n  };\n\n  const handleTooltipMouseLeave = () => {\n    // Don't trigger hover events on mobile devices\n    const isMobile = window.matchMedia(\n      '(hover: none) and (pointer: coarse)'\n    ).matches;\n    if (isMobile) return;\n\n    handleMouseLeave();\n  };\n\n  // Cleanup timeouts on unmount\n  useEffect(() => {\n    return () => {\n      if (hideTimeoutRef.current) {\n        clearTimeout(hideTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  const Wrapper = isInsideParagraph ? 'span' : 'div';\n\n  return (\n    <Wrapper\n      ref={tooltipRef}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n      onClick={handleClick}\n      style={{ display: 'inline-block' }}\n    >\n      {children}\n      {showTooltip && content && (\n        <div\n          ref={tooltipContentRef}\n          className={`link-tooltip info-tooltip ${showTooltip ? 'visible' : ''}`}\n          onMouseEnter={handleTooltipMouseEnter}\n          onMouseLeave={handleTooltipMouseLeave}\n          style={position}\n          data-testid=\\\"info-tooltip\\\"\n        >\n          <div className=\\\"info-tooltip-content\\\">{content}</div>\n        </div>\n      )}\n    </Wrapper>\n  );\n};\n",
    "language":"typescript",
    "lines":225,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/app-version/AppVersion.test.tsx":{
    "content":"// AppVersion.test.tsx\nimport { render } from '@testing-library/react';\nimport { APP_VERSION_SELECTORS } from 'src/lib/test-selectors/components/app-version.selectors';\nimport AppVersion from './AppVersion';\n\n// Make sure getConfig is automatically mocked\njest.mock('next/config');\n\n// Mock fetch\nglobal.fetch = jest.fn(() =>\n  Promise.resolve({\n    json: () => Promise.resolve({ version: '1.2.3' })\n  })\n) as jest.Mock;\n\ndescribe('AppVersion component', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders without errors', () => {\n    render(<AppVersion />);\n  });\n\n  it('displays the correct version', async () => {\n    const { getByTestId } = render(<AppVersion />);\n    const versionElement = getByTestId(APP_VERSION_SELECTORS.ANCHOR);\n    // auto-mock from <root_dir>/__mocks__/next/config.js\n    expect(versionElement).toBeInTheDocument();\n    // Wait for the fetch to complete\n    await new Promise((resolve) => setTimeout(resolve, 0));\n  });\n\n  it('links to the GitHub repository', () => {\n    const { getByTestId } = render(<AppVersion />);\n    const linkElement = getByTestId(APP_VERSION_SELECTORS.ANCHOR);\n    expect(linkElement).toHaveAttribute(\n      'href',\n      'https://github.com/Underwood-Inc/idling.app__UI'\n    );\n  });\n});\n",
    "language":"typescript",
    "lines":43,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/app-version/AppVersion.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { APP_VERSION_SELECTORS } from 'src/lib/test-selectors/components/app-version.selectors';\nimport { LinkTooltip } from '../tooltip/LinkTooltip';\n\nexport default function AppVersion({\n  className,\n  isInsideParagraph = false\n}: Readonly<{ className?: string; isInsideParagraph?: boolean }>) {\n  const [version, setVersion] = useState<string>('0.0.0');\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n    // Get version from package.json via API or fetch\n    fetch('/api/version')\n      .then((res) => res.json())\n      .then((data) => setVersion(data.version || '0.0.0'))\n      .catch(() => setVersion('ERROR'));\n\n    return () => {\n      // Cleanup function to prevent memory leaks\n      setMounted(false);\n    };\n  }, []);\n\n  // Show placeholder during hydration to avoid layout shift\n  if (!mounted) {\n    return <span className={className}>v0.0.0</span>;\n  }\n\n  return (\n    <LinkTooltip\n      url=\\\"https://github.com/Underwood-Inc/idling.app__UI\\\"\n      isInsideParagraph={isInsideParagraph}\n      className={className}\n    >\n      <a\n        data-testid={APP_VERSION_SELECTORS.ANCHOR}\n        href=\\\"https://github.com/Underwood-Inc/idling.app__UI\\\"\n        target=\\\"_blank\\\"\n      >\n        v{version}\n      </a>\n    </LinkTooltip>\n  );\n}\n",
    "language":"typescript",
    "lines":49,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/fancy-border/FancyBorder.tsx":{
    "content":"import './FancyBorder.css';\n\nexport default function FancyBorder({\n  children,\n  className\n}: {\n  children: React.ReactNode;\n  className?: string;\n}) {\n  return (\n    <div className={`fancy-border${className ? ` ${className}` : ''}`}>\n      {children}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":16,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/fancy-border/FancyBorder.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport FancyBorder from './FancyBorder';\n\ndescribe('FancyBorder', () => {\n  it('renders children correctly', () => {\n    const { getByText } = render(\n      <FancyBorder>\n        <span>Test Child</span>\n      </FancyBorder>\n    );\n    expect(getByText('Test Child')).toBeInTheDocument();\n  });\n\n  it('applies additional class names', () => {\n    const { container } = render(\n      <FancyBorder className=\\\"additional-class\\\">\n        <span>Test Child</span>\n      </FancyBorder>\n    );\n    expect(container.firstChild).toHaveClass('fancy-border additional-class');\n  });\n\n  it('applies only the fancy-border class when no additional class is provided', () => {\n    const { container } = render(\n      <FancyBorder>\n        <span>Test Child</span>\n      </FancyBorder>\n    );\n    expect(container.firstChild).toHaveClass('fancy-border');\n  });\n});\n",
    "language":"typescript",
    "lines":32,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-container/PageContainer.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport { usePathname, useSearchParams } from 'next/navigation';\nimport { NAV_PATHS } from 'src/lib/routes';\nimport { PageContainer } from './PageContainer';\n\n// Mock the next/navigation hooks\njest.mock('next/navigation', () => ({\n  usePathname: jest.fn(),\n  useSearchParams: jest.fn()\n}));\n\ndescribe('PageContainer', () => {\n  const mockUsePathname = usePathname as jest.MockedFunction<\n    typeof usePathname\n  >;\n  const mockUseSearchParams = useSearchParams as jest.MockedFunction<\n    typeof useSearchParams\n  >;\n\n  beforeEach(() => {\n    mockUsePathname.mockReset();\n    mockUseSearchParams.mockReset();\n  });\n\n  it('renders children correctly', () => {\n    mockUsePathname.mockReturnValue('/');\n    mockUseSearchParams.mockReturnValue({\n      get: jest.fn().mockReturnValue(null)\n    } as any);\n\n    const { getByText } = render(\n      <PageContainer>\n        <div>Test Child</div>\n      </PageContainer>\n    );\n\n    expect(getByText('Test Child')).toBeInTheDocument();\n  });\n\n  it('sets correct context for posts page', () => {\n    mockUsePathname.mockReturnValue(NAV_PATHS.POSTS);\n    mockUseSearchParams.mockReturnValue({\n      get: jest.fn().mockReturnValue(null)\n    } as any);\n\n    const { container } = render(\n      <PageContainer>\n        <div>Posts Page</div>\n      </PageContainer>\n    );\n\n    expect(container.firstChild).toHaveAttribute('class', 'page__container');\n  });\n\n  it('sets correct context for my posts page', () => {\n    mockUsePathname.mockReturnValue(NAV_PATHS.MY_POSTS);\n    mockUseSearchParams.mockReturnValue({\n      get: jest.fn().mockReturnValue(null)\n    } as any);\n\n    const { container } = render(\n      <PageContainer>\n        <div>My Posts Page</div>\n      </PageContainer>\n    );\n\n    expect(container.firstChild).toHaveAttribute('class', 'page__container');\n  });\n\n  it('handles tag search params correctly', () => {\n    mockUsePathname.mockReturnValue('/');\n    mockUseSearchParams.mockReturnValue({\n      get: jest\n        .fn()\n        .mockImplementation((param) => (param === 'tags' ? 'tag1,tag2' : null))\n    } as any);\n\n    const { container } = render(\n      <PageContainer>\n        <div>With Tags</div>\n      </PageContainer>\n    );\n\n    expect(container.firstChild).toHaveAttribute('class', 'page__container');\n  });\n\n  it('handles page search param correctly', () => {\n    mockUsePathname.mockReturnValue('/');\n    mockUseSearchParams.mockReturnValue({\n      get: jest\n        .fn()\n        .mockImplementation((param) => (param === 'page' ? '2' : null))\n    } as any);\n\n    const { container } = render(\n      <PageContainer>\n        <div>Page 2</div>\n      </PageContainer>\n    );\n\n    expect(container.firstChild).toHaveAttribute('class', 'page__container');\n  });\n});\n",
    "language":"typescript",
    "lines":104,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-container/PageContainer.tsx":{
    "content":"'use client';\nimport React from 'react';\nimport './PageContainer.css';\n\nexport function PageContainer({ children }: { children: React.ReactNode }) {\n  return <section className=\\\"page__container\\\">{children}</section>;\n}\n",
    "language":"typescript",
    "lines":8,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/game/GameWrapper.tsx":{
    "content":"'use client';\nimport Script from 'next/script';\nimport React from 'react';\nimport { GAME_WRAPPER_SELECTORS } from 'src/lib/test-selectors/components/game-wrapper.selectors';\nimport './styles.css';\n\nexport const GameWrapper: React.FC = () => {\n  return (\n    <div>\n      <div className=\\\"gm4html5_div_class\\\" id=\\\"gm4html5_div_id\\\">\n        <canvas\n          id=\\\"canvas\\\"\n          width=\\\"864\\\"\n          height=\\\"648\\\"\n          data-testid={GAME_WRAPPER_SELECTORS.CANVAS}\n        >\n          <p>Your browser doesn&apos;t support HTML5 canvas.</p>\n        </canvas>\n      </div>\n\n      <Script\n        data-testid={GAME_WRAPPER_SELECTORS.SCRIPT}\n        src=\\\"idling.app.js?cachebust=968111397\\\"\n      />\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":28,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/game/GameWrapper.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { GAME_WRAPPER_SELECTORS } from 'src/lib/test-selectors/components/game-wrapper.selectors';\nimport { GameWrapper } from './GameWrapper';\n\n// Mock the next/script component\njest.mock('next/script', () => ({\n  __esModule: true,\n  // eslint-disable-next-line @next/next/no-sync-scripts\n  default: jest.fn().mockImplementation(({ src }) => <script src={src} />)\n}));\n\ndescribe('GameWrapper', () => {\n  it('renders the game canvas', () => {\n    render(<GameWrapper />);\n    const canvas = screen.getByTestId(GAME_WRAPPER_SELECTORS.CANVAS);\n    expect(canvas).toBeInTheDocument();\n    expect(canvas).toHaveAttribute('width', '864');\n    expect(canvas).toHaveAttribute('height', '648');\n  });\n\n  it('renders the fallback message for unsupported browsers', () => {\n    render(<GameWrapper />);\n    const fallbackMessage = screen.getByText(\n      \\\"Your browser doesn't support HTML5 canvas.\\\"\n    );\n    expect(fallbackMessage).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":29,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/spacing-theme-toggle/SpacingThemeToggle.tsx":{
    "content":"'use client';\n\nimport { useUserPreferences } from '../../../lib/context/UserPreferencesContext';\nimport './SpacingThemeToggle.css';\n\nexport function SpacingThemeToggle() {\n  const { spacingTheme, setSpacingTheme } = useUserPreferences();\n\n  return (\n    <div className=\\\"spacing-theme-toggle\\\">\n      <label className=\\\"spacing-theme-toggle__label\\\">Display:</label>\n      <div className=\\\"spacing-theme-toggle__options\\\">\n        <button\n          className={`spacing-theme-toggle__button ${spacingTheme === 'cozy' ? 'active' : ''}`}\n          onClick={() => setSpacingTheme('cozy')}\n          aria-pressed={spacingTheme === 'cozy'}\n        >\n          Cozy\n        </button>\n        <button\n          className={`spacing-theme-toggle__button ${spacingTheme === 'compact' ? 'active' : ''}`}\n          onClick={() => setSpacingTheme('compact')}\n          aria-pressed={spacingTheme === 'compact'}\n        >\n          Compact\n        </button>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":31,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/service-worker/HardResetManager.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { useEffect } from 'react';\nimport {\n  checkAndPerformHardReset,\n  getResetStats\n} from '../../../lib/utils/hard-reset-manager';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'HardResetManager',\n    module: 'components/service-worker'\n  },\n  enabled: false\n});\n\nexport function HardResetManager() {\n  useEffect(() => {\n    const initializeHardResetSystem = async () => {\n      try {\n        logger.group('hardResetInitialization');\n\n        // Get current app version from meta tag\n        const metaVersion = document\n          .querySelector('meta[name=\\\"app-version\\\"]')\n          ?.getAttribute('content');\n        const appVersion = metaVersion || '0.115.0'; // Fallback to current version\n\n        logger.debug('Current app version detected', {\n          appVersion,\n          metaVersion\n        });\n\n        // Get reset statistics\n        const resetStats = getResetStats();\n        logger.debug('Reset statistics retrieved', { resetStats });\n\n        // Check if hard reset is needed for this version\n        const resetResult = await checkAndPerformHardReset({\n          resetVersion: appVersion,\n          resetReason: `Updated to version ${appVersion}`,\n          showNotification: true\n        });\n\n        logger.debug('Hard reset check completed', { resetResult });\n\n        if (resetResult.resetPerformed) {\n          logger.info(\n            'Hard reset completed - user will experience fresh app state'\n          );\n\n          // Optional: Reload page after reset to ensure clean state\n          setTimeout(() => {\n            window.location.reload();\n          }, 2000);\n        } else {\n          logger.debug('No hard reset needed - continuing with normal startup');\n        }\n\n        logger.groupEnd();\n      } catch (error) {\n        logger.error('Hard reset system initialization failed', error as Error);\n      }\n    };\n\n    // Initialize hard reset system\n    initializeHardResetSystem();\n\n    // Listen for manual reset triggers (for development/admin)\n    const handleManualReset = (event: Event) => {\n      const customEvent = event as CustomEvent;\n      if (\n        customEvent.detail &&\n        customEvent.detail.trigger === 'manual-hard-reset'\n      ) {\n        logger.debug('Manual hard reset triggered', {\n          reason: customEvent.detail.reason\n        });\n\n        checkAndPerformHardReset({\n          resetVersion: Date.now().toString(),\n          forceReset: true,\n          resetReason: customEvent.detail.reason || 'Manual reset triggered',\n          showNotification: true\n        }).then((result) => {\n          logger.debug('Manual reset completed', { result });\n          if (result.resetPerformed) {\n            setTimeout(() => {\n              window.location.reload();\n            }, 1000);\n          }\n        });\n      }\n    };\n\n    window.addEventListener('hard-reset-trigger', handleManualReset);\n\n    // Cleanup\n    return () => {\n      window.removeEventListener('hard-reset-trigger', handleManualReset);\n    };\n  }, []);\n\n  return null;\n}\n\n// Global function to trigger manual hard reset (for console/admin use)\nif (typeof window !== 'undefined') {\n  (window as any).triggerHardReset = (\n    reason: string = 'Manual admin reset'\n  ) => {\n    const event = new CustomEvent('hard-reset-trigger', {\n      detail: {\n        trigger: 'manual-hard-reset',\n        reason\n      }\n    });\n    window.dispatchEvent(event);\n  };\n}\n",
    "language":"typescript",
    "lines":123,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/service-worker/ServiceWorkerRegistration.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { useEffect } from 'react';\nimport { enforceOneServiceWorker } from '../../../lib/utils/service-worker-cleanup';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'ServiceWorkerRegistration',\n    module: 'components/service-worker'\n  },\n  enabled: false\n});\n\nexport function ServiceWorkerRegistration() {\n  useEffect(() => {\n    if ('serviceWorker' in navigator) {\n      const registerServiceWorker = async () => {\n        try {\n          logger.group('serviceWorkerRegistration');\n\n          // Step 1: IMMEDIATE cleanup - enforce single service worker\n          logger.debug('Enforcing single service worker');\n          await enforceOneServiceWorker();\n\n          // Step 2: Clear all caches before registering new service worker\n          logger.debug('Clearing all caches');\n          if ('caches' in window) {\n            try {\n              const cacheNames = await caches.keys();\n              await Promise.all(\n                cacheNames.map(async (cacheName) => {\n                  try {\n                    await caches.delete(cacheName);\n                    logger.debug('Cache deleted successfully', { cacheName });\n                  } catch (e) {\n                    logger.warn('Failed to delete cache', {\n                      cacheName,\n                      errorMessage: e instanceof Error ? e.message : String(e)\n                    });\n                  }\n                })\n              );\n            } catch (e) {\n              logger.warn('Failed to clear caches', {\n                errorMessage: e instanceof Error ? e.message : String(e)\n              });\n            }\n          }\n\n          // Step 3: Wait for the page to be fully loaded\n          if (document.readyState !== 'complete') {\n            await new Promise((resolve) => {\n              window.addEventListener('load', resolve, { once: true });\n            });\n          }\n\n          // Step 4: Final check before registration\n          await enforceOneServiceWorker();\n\n          // Step 5: Register new service worker with aggressive cache control\n          logger.debug('Registering new service worker');\n          const registration = await navigator.serviceWorker.register(\n            '/sw.js',\n            {\n              scope: '/',\n              updateViaCache: 'none' // Prevent caching of the service worker itself\n            }\n          );\n\n          logger.info('Service worker registration successful', {\n            scope: registration.scope\n          });\n\n          // Step 6: Handle service worker updates\n          registration.addEventListener('updatefound', () => {\n            const newWorker = registration.installing;\n            if (newWorker) {\n              logger.debug('New service worker found, installing');\n\n              newWorker.addEventListener('statechange', () => {\n                logger.debug('Service worker state changed', {\n                  state: newWorker.state\n                });\n\n                if (newWorker.state === 'installed') {\n                  if (navigator.serviceWorker.controller) {\n                    // New service worker is available, activate immediately\n                    logger.debug(\n                      'New service worker available, activating immediately'\n                    );\n                    newWorker.postMessage({ type: 'SKIP_WAITING' });\n                  } else {\n                    // First time installation\n                    logger.debug('Service worker installed for the first time');\n                  }\n                }\n\n                if (newWorker.state === 'activated') {\n                  logger.debug('New service worker activated');\n                  // Enforce single service worker after activation\n                  setTimeout(() => enforceOneServiceWorker(), 1000);\n                }\n              });\n            }\n          });\n\n          // Step 7: Listen for service worker messages\n          navigator.serviceWorker.addEventListener('message', (event) => {\n            if (event.data && event.data.type === 'SW_UPDATED') {\n              logger.debug('Service worker updated', {\n                version: event.data.version\n              });\n              // Optionally show user notification about update\n            }\n          });\n\n          // Step 8: Handle service worker controller changes\n          navigator.serviceWorker.addEventListener('controllerchange', () => {\n            logger.debug('Service worker controller changed');\n            // Enforce single service worker on controller change\n            setTimeout(() => enforceOneServiceWorker(), 500);\n          });\n\n          // Step 9: Aggressive periodic cleanup (every 5 minutes instead of 1 hour)\n          const cleanupInterval = setInterval(\n            async () => {\n              await enforceOneServiceWorker();\n            },\n            5 * 60 * 1000\n          ); // Every 5 minutes\n\n          // Step 10: Cleanup on visibility change (when user returns to tab)\n          const handleVisibilityChange = async () => {\n            if (document.visibilityState === 'visible') {\n              logger.debug(\n                'Tab visible: checking for multiple service workers'\n              );\n              await enforceOneServiceWorker();\n            }\n          };\n\n          document.addEventListener('visibilitychange', handleVisibilityChange);\n\n          // Step 11: Cleanup on page focus (when user clicks on window)\n          const handleFocus = async () => {\n            logger.debug('Page focused: checking for multiple service workers');\n            await enforceOneServiceWorker();\n          };\n\n          window.addEventListener('focus', handleFocus);\n\n          // Close the logger group before returning cleanup function\n          logger.groupEnd();\n\n          // Cleanup all listeners on component unmount\n          return () => {\n            clearInterval(cleanupInterval);\n            document.removeEventListener(\n              'visibilitychange',\n              handleVisibilityChange\n            );\n            window.removeEventListener('focus', handleFocus);\n          };\n        } catch (err) {\n          logger.error('Service worker registration failed', err as Error);\n          // Close the logger group in error case too\n          logger.groupEnd();\n        }\n      };\n\n      // Start registration process immediately\n      registerServiceWorker();\n\n      // Also run immediate cleanup on component mount\n      enforceOneServiceWorker();\n    }\n  }, []);\n\n  return null;\n}\n",
    "language":"typescript",
    "lines":183,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/error-boundary/NotFoundErrorBoundary.tsx":{
    "content":"'use client';\n\nimport { Component, ErrorInfo, ReactNode } from 'react';\nimport './NotFoundErrorBoundary.css';\n\ninterface Props {\n  children: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n}\n\nexport class NotFoundErrorBoundary extends Component<Props, State> {\n  public state: State = {\n    hasError: false,\n    error: null\n  };\n\n  public static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error('Uncaught error:', error, errorInfo);\n  }\n\n  public render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\\\"error-boundary\\\">\n          <h2>Something went wrong</h2>\n          <p>Please try refreshing the page</p>\n          <button\n            onClick={() => {\n              this.setState({ hasError: false, error: null });\n              window.location.reload();\n            }}\n          >\n            Refresh Page\n          </button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n",
    "language":"typescript",
    "lines":50,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/coin/Coin.tsx":{
    "content":"'use client';\nimport { COIN_SELECTORS } from '../../../lib/test-selectors/components/coin.selectors';\nimport { Avatar } from '../avatar/Avatar';\nimport './Coin.css';\n\nexport type CoinPropsSize = 'full' | 'lg' | 'md' | 'sm';\n\nexport default function Coin({\n  seed,\n  size = 'lg'\n}: {\n  seed: string;\n  size?: CoinPropsSize;\n}) {\n  const getInitials = () => {\n    const hasSpaces = seed.includes(' ');\n\n    if (hasSpaces) {\n      const [first, second] = seed.split(' ');\n      return first[0] + second[0];\n    }\n\n    return `${seed[0]}${seed[seed.length - 1]}`.toUpperCase();\n  };\n\n  const initials = getInitials();\n\n  return (\n    <div className=\\\"coin\\\">\n      <div\n        className={`coin__front zoomed ${size}`}\n        data-testid={COIN_SELECTORS.FRONT}\n      >\n        <p className=\\\"coin__header\\\" data-testid={COIN_SELECTORS.HEADER}>\n          {initials}\n        </p>\n        <div className=\\\"coin__body\\\" data-testid={COIN_SELECTORS.BODY}>\n          <Avatar seed={seed} size={size} />\n        </div>\n        <p className=\\\"coin__footer\\\" data-testid={COIN_SELECTORS.FOOTER}>\n          {initials}\n        </p>\n      </div>\n      <div\n        className={`coin__back shrunk ${size}`}\n        data-testid={COIN_SELECTORS.BACK}\n      >\n        BACK\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":53,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/coin/Coin.test.tsx":{
    "content":"import { cleanup, render } from '@testing-library/react';\nimport { COIN_SELECTORS } from '../../../lib/test-selectors/components/coin.selectors';\nimport Coin, { CoinPropsSize } from './Coin';\n\njest.mock('../avatar/Avatar', () => ({\n  Avatar: function MockedAvatar() {\n    return <div>Mocked Avatar</div>;\n  }\n}));\n\ndescribe('Coin Component', () => {\n  const renderCoin = (seed: string, size?: CoinPropsSize) =>\n    render(<Coin seed={seed} size={size} />);\n\n  afterEach(cleanup);\n\n  it.each`\n    size      | expectedClass\n    ${'lg'}   | ${'lg'}\n    ${'full'} | ${'full'}\n    ${'md'}   | ${'md'}\n    ${'sm'}   | ${'sm'}\n  `('should render with size $size', ({ size, expectedClass }) => {\n    const { getByTestId } = renderCoin('John Doe', size);\n    expect(getByTestId(COIN_SELECTORS.FRONT)).toHaveClass(expectedClass);\n  });\n\n  it.each`\n    name          | expectedInitials\n    ${'John Doe'} | ${'JD'}\n    ${'John'}     | ${'JN'}\n  `(\n    'should display initials correctly for $name',\n    ({ name, expectedInitials }) => {\n      const { getByTestId } = renderCoin(name);\n      expect(getByTestId(COIN_SELECTORS.HEADER)).toHaveTextContent(\n        expectedInitials\n      );\n    }\n  );\n\n  it('should render Avatar component with correct props', () => {\n    const { getByText } = renderCoin('John Doe', 'lg');\n    expect(getByText('Mocked Avatar')).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":47,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/footer/Footer.tsx":{
    "content":"import React from 'react';\nimport AppVersion from '../app-version/AppVersion';\nimport SmartCacheStatus from '../cache-status/SmartCacheStatus';\nimport FooterNav from '../footer-nav/FooterNav';\nimport './Footer.css';\n\nconst Footer = (): React.JSX.Element => {\n  return (\n    <footer className=\\\"footer\\\">\n      <SmartCacheStatus />\n\n      <AppVersion className=\\\"footer__app-version\\\" />\n\n      <FooterNav />\n    </footer>\n  );\n};\n\nexport default Footer;\n",
    "language":"typescript",
    "lines":20,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/footer/Footer.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport Footer from './Footer';\n\njest.mock('../app-version/AppVersion', () => {\n  const MockedAppVersion = () => <div>Mocked AppVersion</div>;\n  MockedAppVersion.displayName = 'MockedAppVersion';\n  return MockedAppVersion;\n});\n\njest.mock('../footer-nav/FooterNav', () => {\n  const MockedFooterNav = () => <div>Mocked FooterNav</div>;\n  MockedFooterNav.displayName = 'MockedFooterNav';\n  return MockedFooterNav;\n});\n\ndescribe('Footer', () => {\n  it('should render the footer component', () => {\n    const { container } = render(<Footer />);\n    expect(container.querySelector('.footer')).toBeInTheDocument();\n  });\n\n  it('should render the AppVersion component', () => {\n    const { getByText } = render(<Footer />);\n    expect(getByText('Mocked AppVersion')).toBeInTheDocument();\n  });\n\n  it('should render the FooterNav component', () => {\n    const { getByText } = render(<Footer />);\n    expect(getByText('Mocked FooterNav')).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":32,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tag-link/TagLink.test.tsx":{
    "content":"import { Provider } from 'jotai';\nimport { fireEvent, render, screen } from '../../../test-utils';\nimport { TagLink } from './TagLink';\n\n// Mock Next.js navigation\nconst mockPush = jest.fn();\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: mockPush,\n    replace: jest.fn(),\n    prefetch: jest.fn()\n  }),\n  useSearchParams: jest.fn(() => new URLSearchParams()),\n  usePathname: () => '/test'\n}));\n\n// Mock Jotai hooks and atoms\nconst mockSetFiltersState = jest.fn();\nconst mockFiltersState = { filters: [], page: 1, pageSize: 10 };\n\njest.mock('jotai', () => ({\n  ...jest.requireActual('jotai'),\n  useAtom: jest.fn(() => [mockFiltersState, mockSetFiltersState]),\n  Provider: jest.requireActual('jotai').Provider\n}));\n\njest.mock('../../../lib/state/atoms', () => ({\n  getSubmissionsFiltersAtom: jest.fn(() => ({}))\n}));\n\ndescribe('TagLink', () => {\n  const defaultProps = {\n    value: 'test-tag',\n    contextId: 'test-context'\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('renders tag link correctly', () => {\n    render(\n      <Provider>\n        <TagLink {...defaultProps} />\n      </Provider>\n    );\n\n    expect(screen.getByText('test-tag')).toBeInTheDocument();\n    expect(screen.getByRole('link')).toBeInTheDocument();\n  });\n\n  it('handles click correctly', () => {\n    render(\n      <Provider>\n        <TagLink {...defaultProps} />\n      </Provider>\n    );\n\n    const tagLink = screen.getByRole('link');\n    expect(tagLink).toHaveAttribute('href');\n    expect(tagLink.getAttribute('href')).toContain('tags=test-tag');\n  });\n\n  it('shows active state when tag is selected', () => {\n    // Mock useSearchParams to return tags that include our test tag\n    const mockSearchParams = new URLSearchParams('tags=test-tag,other-tag');\n    const { useSearchParams } = require('next/navigation');\n    useSearchParams.mockReturnValue(mockSearchParams);\n\n    render(\n      <Provider>\n        <TagLink {...defaultProps} />\n      </Provider>\n    );\n\n    const tagLink = screen.getByRole('link');\n    expect(tagLink).toHaveClass('active');\n  });\n\n  it('handles multiple tags correctly', () => {\n    // Mock useSearchParams to return multiple tags including our test tag\n    const mockSearchParams = new URLSearchParams('tags=tag1,tag2,test-tag');\n    const { useSearchParams } = require('next/navigation');\n    useSearchParams.mockReturnValue(mockSearchParams);\n\n    render(\n      <Provider>\n        <TagLink {...defaultProps} />\n      </Provider>\n    );\n\n    const tagLink = screen.getByRole('link');\n    expect(tagLink).toHaveClass('active');\n  });\n\n  it('handles contextId correctly', () => {\n    const { getSubmissionsFiltersAtom } = require('../../../lib/state/atoms');\n\n    render(\n      <Provider>\n        <TagLink {...defaultProps} />\n      </Provider>\n    );\n\n    expect(getSubmissionsFiltersAtom).toHaveBeenCalledWith('test-context');\n  });\n\n  it('handles onTagClick callback correctly', () => {\n    const mockOnTagClick = jest.fn();\n\n    render(\n      <Provider>\n        <TagLink {...defaultProps} onTagClick={mockOnTagClick} />\n      </Provider>\n    );\n\n    const tagLink = screen.getByRole('link');\n    fireEvent.click(tagLink);\n\n    expect(mockOnTagClick).toHaveBeenCalledWith('test-tag');\n  });\n});\n",
    "language":"typescript",
    "lines":123,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tag-link/TagLink.tsx":{
    "content":"'use client';\nimport { useAtom } from 'jotai';\nimport { usePathname, useSearchParams } from 'next/navigation';\nimport { Suspense } from 'react';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport { getSubmissionsFiltersAtom } from '../../../lib/state/atoms';\nimport { InstantLink } from '../ui/InstantLink';\nimport './TagLink.css';\n\ninterface TagLinkProps {\n  value: string;\n  contextId: string;\n  appendSearchParam?: boolean;\n  onTagClick?: (tag: string) => void;\n}\n\n/**\n * Internal TagLink component that uses useSearchParams\n */\nfunction TagLinkInternal({\n  value,\n  contextId,\n  appendSearchParam = false,\n  onTagClick\n}: TagLinkProps) {\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n\n  // Use shared Jotai atoms directly for state synchronization\n  const [filtersState, setFiltersState] = useAtom(\n    getSubmissionsFiltersAtom(contextId)\n  );\n\n  // Check if we're on a thread page\n  const isThreadPage = pathname.startsWith('/t/');\n\n  const generateTagUrl = (): string => {\n    const params = new URLSearchParams(searchParams.toString());\n    const sanitizedTag = value.trim();\n\n    if (!sanitizedTag || sanitizedTag.length > 50) {\n      return '#';\n    }\n\n    const currentTags =\n      params\n        .get('tags')\n        ?.split(',')\n        .map((tag) => tag.trim())\n        .filter(Boolean) || [];\n\n    if (appendSearchParam) {\n      // Add tag if not already present\n      if (!currentTags.includes(sanitizedTag)) {\n        const newTags = [...currentTags, sanitizedTag];\n        params.set('tags', newTags.join(','));\n      }\n    } else {\n      // Toggle tag\n      if (currentTags.includes(sanitizedTag)) {\n        const newTags = currentTags.filter((tag) => tag !== sanitizedTag);\n        if (newTags.length > 0) {\n          params.set('tags', newTags.join(','));\n        } else {\n          params.delete('tags');\n        }\n      } else {\n        const newTags = [...currentTags, sanitizedTag];\n        params.set('tags', newTags.join(','));\n      }\n    }\n\n    // Reset to first page when filters change\n    params.delete('page');\n\n    // For thread pages, navigate to posts with filters only if no onTagClick callback\n    // If onTagClick is provided (thread filtering), we'll use that instead\n    const targetPath = isThreadPage && !onTagClick ? NAV_PATHS.POSTS : pathname;\n    return `${targetPath}${params.toString() ? `?${params.toString()}` : ''}`;\n  };\n\n  const handleClick = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    const sanitizedTag = value.trim();\n    if (!sanitizedTag || sanitizedTag.length > 50) {\n      console.warn('Invalid tag:', value);\n      return;\n    }\n\n    // If parent provides onTagClick callback, use it and prevent navigation\n    if (onTagClick) {\n      event.preventDefault();\n      onTagClick(sanitizedTag);\n      return;\n    }\n\n    // For thread pages without onTagClick callback, allow navigation to posts\n    // For other pages, let the Link component handle navigation normally\n  };\n\n  // Check if this tag is currently active based on context\n  let isActive = false;\n\n  if (isThreadPage && onTagClick) {\n    // For thread pages with filtering, check the filter state\n    const activeHashtags =\n      filtersState.filters\n        .find((f) => f.name === 'tags')\n        ?.value?.split(',')\n        ?.map((tag) => tag.trim())\n        ?.filter(Boolean) || [];\n\n    const tagValue = value.startsWith('#') ? value : `#${value}`;\n    isActive = activeHashtags.includes(tagValue);\n  } else {\n    // For posts pages or thread pages without filtering, check URL params\n    const currentTags =\n      searchParams\n        .get('tags')\n        ?.split(',')\n        .map((tag) => tag.trim())\n        .filter(Boolean) || [];\n    isActive = currentTags.includes(value);\n  }\n\n  const tagUrl = generateTagUrl();\n\n  return (\n    <InstantLink\n      href={tagUrl}\n      className={`tag-link ${isActive ? 'active' : ''}`}\n      onClick={handleClick}\n      title={`Filter by tag: ${value}`}\n    >\n      {value}\n    </InstantLink>\n  );\n}\n\n/**\n * A component that returns a Next.js Link component that navigates with a filter applied\n * @example <TagLink value=\\\"bacon\\\" /> => a link that navigates to current route with tags=bacon filter\n */\nexport function TagLink(props: TagLinkProps) {\n  return (\n    <Suspense fallback={<span className=\\\"tag-link\\\">{props.value}</span>}>\n      <TagLinkInternal {...props} />\n    </Suspense>\n  );\n}\n",
    "language":"typescript",
    "lines":150,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/badge/Badge.test.tsx":{
    "content":"import '@testing-library/jest-dom';\nimport { fireEvent, render, screen } from '@testing-library/react';\nimport { BADGE_SELECTORS } from 'src/lib/test-selectors/components/badge';\nimport BadgeWrapper from './Badge';\n\ndescribe('BadgeWrapper', () => {\n  it('renders children and badge content', () => {\n    render(\n      <BadgeWrapper badgeContent=\\\"3\\\" showOnHover={false}>\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTENT)).toBeInTheDocument();\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTENT)).toHaveTextContent('3');\n  });\n\n  it('applies correct classes when showOnHover is true', () => {\n    render(\n      <BadgeWrapper badgeContent=\\\"4\\\" showOnHover={true}>\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTAINER)).toHaveClass(\n      'badge__container--hover'\n    );\n  });\n\n  it('applies correct classes when showOnHover is false', () => {\n    render(\n      <BadgeWrapper badgeContent=\\\"5\\\" showOnHover={false}>\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTAINER)).toHaveClass(\n      'badge__container'\n    );\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTAINER)).not.toHaveClass(\n      'badge__container--hover'\n    );\n  });\n\n  it('uses default value for showOnHover when not provided', () => {\n    render(\n      // @ts-expect-error\n      <BadgeWrapper badgeContent=\\\"10\\\">\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTAINER)).toHaveClass(\n      'badge__container'\n    );\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTAINER)).not.toHaveClass(\n      'badge__container--hover'\n    );\n  });\n\n  it('applies cursor--pointer class when onClick is provided', () => {\n    const onClick = jest.fn();\n    render(\n      <BadgeWrapper badgeContent=\\\"6\\\" showOnHover={false} onClick={onClick}>\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTENT)).toHaveClass(\n      'cursor--pointer'\n    );\n  });\n\n  it('does not apply cursor--pointer class when onClick is not provided', () => {\n    render(\n      <BadgeWrapper badgeContent=\\\"7\\\" showOnHover={false}>\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    expect(screen.getByTestId(BADGE_SELECTORS.CONTENT)).not.toHaveClass(\n      'cursor--pointer'\n    );\n  });\n\n  it('calls onClick when badge content is clicked', () => {\n    const onClick = jest.fn();\n    render(\n      <BadgeWrapper badgeContent=\\\"8\\\" showOnHover={false} onClick={onClick}>\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    fireEvent.click(screen.getByTestId(BADGE_SELECTORS.CONTENT));\n    expect(onClick).toHaveBeenCalledTimes(1);\n  });\n\n  it('prevents default event when badge content is clicked', () => {\n    const onClick = jest.fn();\n    render(\n      <BadgeWrapper badgeContent=\\\"9\\\" showOnHover={false} onClick={onClick}>\n        <div>Child content</div>\n      </BadgeWrapper>\n    );\n\n    const badgeElement = screen.getByTestId(BADGE_SELECTORS.CONTENT);\n    const preventDefaultSpy = jest.spyOn(Event.prototype, 'preventDefault');\n\n    fireEvent.click(badgeElement);\n\n    expect(onClick).toHaveBeenCalledTimes(1);\n    expect(preventDefaultSpy).toHaveBeenCalledTimes(1);\n\n    preventDefaultSpy.mockRestore();\n  });\n});\n",
    "language":"typescript",
    "lines":117,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/badge/Badge.tsx":{
    "content":"import { BADGE_SELECTORS } from 'src/lib/test-selectors/components/badge';\nimport './Badge.css';\n\ninterface BadgeWrapperProps {\n  badgeContent: React.ReactNode;\n  children: React.ReactNode;\n  onClick?: (_event: React.MouseEvent<HTMLElement>) => void;\n  showOnHover: boolean;\n}\n\nexport default function BadgeWrapper({\n  badgeContent,\n  children,\n  onClick,\n  showOnHover = false\n}: BadgeWrapperProps) {\n  const handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    onClick?.(event);\n  };\n  const className = showOnHover ? '--hover' : '';\n\n  return (\n    <div\n      className={`badge__container${className}`}\n      data-testid={BADGE_SELECTORS.CONTAINER}\n    >\n      {children}\n      <span\n        className={`badge__content ${onClick && ' cursor--pointer'}`}\n        onClick={handleClick}\n        data-testid={BADGE_SELECTORS.CONTENT}\n      >\n        {badgeContent}\n      </span>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":39,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/threaded/Threaded.tsx":{
    "content":"",
    "language":"typescript",
    "lines":1,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/thread/Thread.tsx":{
    "content":"'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport {\n  generateScrollKey,\n  getStoredScrollPosition\n} from '../../../lib/utils/scroll-position';\nimport { Author } from '../author/Author';\nimport Loader from '../loader/Loader';\nimport { DeleteSubmissionForm } from '../submission-forms/delete-submission-form/DeleteSubmissionForm';\nimport { EditSubmissionForm } from '../submission-forms/edit-submission-form/EditSubmissionForm';\nimport { Submission } from '../submission-forms/schema';\nimport { getSubmissionById } from '../submissions-list/actions';\nimport { TagLink } from '../tag-link/TagLink';\nimport { BackButton } from '../ui/BackButton';\nimport { ContentWithPills } from '../ui/ContentWithPills';\nimport { InstantLink } from '../ui/InstantLink';\nimport { RefreshButton } from '../ui/RefreshButton';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport { getSubmissionThread, NestedSubmission } from './actions';\nimport { ReplyForm } from './ReplyForm';\nimport './Thread.css';\n\ninterface ThreadProps {\n  submissionId: number;\n  userId?: string;\n  onHashtagClick?: (hashtag: string) => void;\n  onMentionClick?: (mention: string, filterType: 'author' | 'mentions') => void;\n  activeFilters?: {\n    hashtags: string[];\n    mentions: string[];\n  };\n  contextId?: string;\n}\n\ninterface ThreadData {\n  parent: NestedSubmission | null;\n  replies: NestedSubmission[];\n}\n\nexport default function Thread({\n  submissionId,\n  userId,\n  onHashtagClick,\n  onMentionClick,\n  activeFilters,\n  contextId\n}: ThreadProps) {\n  const router = useRouter();\n  const [loading, setLoading] = useState(true);\n  const [parentSubmission, setParentSubmission] =\n    useState<NestedSubmission | null>(null);\n  const [replies, setReplies] = useState<NestedSubmission[]>([]);\n  const [editingSubmissions, setEditingSubmissions] = useState<Set<number>>(\n    new Set()\n  );\n  const [showingReplyForms, setShowingReplyForms] = useState<Set<number>>(\n    new Set()\n  );\n\n  useEffect(() => {\n    const loadThread = async () => {\n      try {\n        setLoading(true);\n        const threadData: ThreadData = await getSubmissionThread(submissionId);\n\n        if (!threadData.parent) {\n          setParentSubmission(null);\n        } else {\n          setParentSubmission(threadData.parent);\n          setReplies(threadData.replies || []);\n        }\n      } catch (error) {\n        console.error('Error loading thread:', error);\n        setParentSubmission(null);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadThread();\n  }, [submissionId]);\n\n  // Handle scrolling to target submission when returning from parent thread\n  useEffect(() => {\n    if (!loading && typeof window !== 'undefined') {\n      const scrollKey = generateScrollKey(window.location.pathname, {\n        searchParams: new URLSearchParams(window.location.search)\n      });\n\n      const storedPosition = getStoredScrollPosition(scrollKey);\n      if (storedPosition?.targetSubmissionId) {\n        // Use a more reliable approach with multiple attempts\n        const attemptScroll = (attempts = 0) => {\n          const targetElement = document.querySelector(\n            `[data-testid=\\\"submission-item-${storedPosition.targetSubmissionId}\\\"]`\n          ) as HTMLElement;\n\n          if (targetElement) {\n            // Scroll to the target element\n            targetElement.scrollIntoView({\n              behavior: 'smooth',\n              block: 'center'\n            });\n\n            // Add a highlight effect\n            targetElement.style.backgroundColor = 'var(--brand-tertiary)';\n            setTimeout(() => {\n              targetElement.style.backgroundColor = '';\n            }, 2000);\n          } else if (attempts < 10) {\n            // Retry after a short delay if element not found\n            setTimeout(() => attemptScroll(attempts + 1), 100);\n          } else {\n            console.warn(\n              'Target submission element not found after multiple attempts:',\n              storedPosition.targetSubmissionId\n            );\n          }\n        };\n\n        // Start the scroll attempt process\n        attemptScroll();\n      }\n    }\n  }, [loading, parentSubmission, replies]);\n\n  const handleReplyAdded = async (result?: any) => {\n    // Use optimistic update if we have the new reply data, otherwise refresh\n    if (result && result.submission) {\n      // Optimistically add the new reply to the current state\n      const newReply: NestedSubmission = {\n        ...result.submission,\n        replies: [],\n        depth: 1,\n        author: userId || 'You', // Use current user as author\n        author_bio: null\n      };\n      setReplies((prevReplies) => [...prevReplies, newReply]);\n\n      // Hide the reply form after successful submission\n      if (result.submission.thread_parent_id) {\n        setShowingReplyForms((prev) => {\n          const newSet = new Set(prev);\n          newSet.delete(result.submission.thread_parent_id);\n          return newSet;\n        });\n      }\n    } else {\n      // Fallback: refresh the thread data when a new reply is added\n      try {\n        const threadData: ThreadData = await getSubmissionThread(submissionId);\n        setReplies(threadData.replies || []);\n      } catch (error) {\n        console.error('Error refreshing replies:', error);\n      }\n    }\n  };\n\n  const handleSubmissionDeleted = (deletedId: number) => {\n    if (deletedId === submissionId) {\n      // Parent was deleted, redirect to posts\n      router.push(NAV_PATHS.POSTS);\n    } else {\n      // A reply was deleted, refresh the thread\n      handleReplyAdded();\n    }\n  };\n\n  const handleSubmissionUpdated = async (updatedSubmission?: Submission) => {\n    // Refresh the thread data when a submission is updated\n    try {\n      const threadData: ThreadData = await getSubmissionThread(submissionId);\n      setParentSubmission(threadData.parent);\n      setReplies(threadData.replies || []);\n      // Close edit mode for the updated submission\n      if (updatedSubmission) {\n        setEditingSubmissions((prev) => {\n          const newSet = new Set(prev);\n          newSet.delete(updatedSubmission.submission_id);\n          return newSet;\n        });\n      }\n    } catch (error) {\n      console.error('Error refreshing thread after update:', error);\n    }\n  };\n\n  const handleRefreshSubmission = async (refreshSubmissionId: number) => {\n    try {\n      const result = await getSubmissionById(refreshSubmissionId);\n\n      if (result.data) {\n        // Close any active reply forms for this submission\n        setShowingReplyForms((prev) => {\n          const newSet = new Set(prev);\n          newSet.delete(refreshSubmissionId);\n          return newSet;\n        });\n\n        // Close edit mode if active\n        setEditingSubmissions((prev) => {\n          const newSet = new Set(prev);\n          newSet.delete(refreshSubmissionId);\n          return newSet;\n        });\n\n        // Update the submission in place\n        if (refreshSubmissionId === submissionId) {\n          // Refreshing the parent submission\n          setParentSubmission(result.data as NestedSubmission);\n        } else {\n          // Refreshing a reply - update the replies array\n          setReplies((prevReplies) => {\n            const updateNestedReplies = (\n              replies: NestedSubmission[]\n            ): NestedSubmission[] => {\n              return replies.map((reply) => {\n                if (reply.submission_id === refreshSubmissionId) {\n                  return {\n                    ...result.data!,\n                    replies: reply.replies // Keep existing nested replies structure\n                  } as NestedSubmission;\n                }\n                return {\n                  ...reply,\n                  replies: updateNestedReplies(reply.replies)\n                };\n              });\n            };\n\n            return updateNestedReplies(prevReplies);\n          });\n        }\n      } else {\n        console.error('Failed to refresh submission:', result.error);\n      }\n    } catch (error) {\n      console.error('Error refreshing submission:', error);\n    }\n  };\n\n  const toggleEdit = (submissionId: number) => {\n    setEditingSubmissions((prev) => {\n      const newSet = new Set(prev);\n      if (newSet.has(submissionId)) {\n        newSet.delete(submissionId);\n      } else {\n        newSet.add(submissionId);\n      }\n      return newSet;\n    });\n  };\n\n  const toggleReplyForm = (submissionId: number) => {\n    setShowingReplyForms((prev) => {\n      const newSet = new Set(prev);\n      if (newSet.has(submissionId)) {\n        newSet.delete(submissionId);\n      } else {\n        newSet.add(submissionId);\n        // Scroll to the reply form after a short delay to ensure it's rendered\n        setTimeout(() => {\n          const formElement = document.querySelector(\n            `[data-testid=\\\"reply-form-${submissionId}\\\"]`\n          ) as HTMLElement;\n          if (formElement) {\n            formElement.scrollIntoView({\n              behavior: 'smooth',\n              block: 'center'\n            });\n            // Focus the title field using the RichTextEditor API\n            const titleField = formElement.querySelector(\n              '[data-testid=\\\"title-field\\\"]'\n            ) as HTMLElement;\n            if (titleField) {\n              // Find the RichTextEditor within the title field and focus it\n              const richTextEditor = titleField.querySelector(\n                '[data-rich-text-editor]'\n              ) as HTMLElement;\n              if (richTextEditor) {\n                richTextEditor.focus();\n              } else {\n                // Fallback: focus the title field container\n                titleField.focus();\n              }\n            }\n          }\n        }, 100);\n      }\n      return newSet;\n    });\n  };\n\n  // Filter function to check if a submission matches the active filters\n  const submissionMatchesFilters = (submission: NestedSubmission): boolean => {\n    if (!activeFilters) return true;\n\n    const { hashtags, mentions } = activeFilters;\n\n    // If no filters are active, show all submissions\n    if (hashtags.length === 0 && mentions.length === 0) {\n      return true;\n    }\n\n    let matchesHashtags = true;\n    let matchesMentions = true;\n\n    // Check hashtag filters\n    if (hashtags.length > 0) {\n      const submissionContent = `${submission.submission_title} ${submission.submission_name || ''}`;\n      const submissionTags = submission.tags || [];\n\n      // Check if content contains any of the filtered hashtags\n      matchesHashtags = hashtags.some((hashtag) => {\n        const cleanHashtag = hashtag.replace('#', '');\n        return (\n          submissionContent\n            .toLowerCase()\n            .includes(`#${cleanHashtag.toLowerCase()}`) ||\n          submissionTags.some((tag) =>\n            tag.toLowerCase().includes(cleanHashtag.toLowerCase())\n          )\n        );\n      });\n    }\n\n    // Check mention filters (author filter)\n    if (mentions.length > 0) {\n      matchesMentions = mentions.some((mentionUserId) => {\n        return submission.user_id?.toString() === mentionUserId;\n      });\n    }\n\n    // For multiple filter types, use AND logic (both must match)\n    if (hashtags.length > 0 && mentions.length > 0) {\n      return matchesHashtags && matchesMentions;\n    }\n\n    // For single filter type, return the result\n    return matchesHashtags && matchesMentions;\n  };\n\n  // Recursive function to filter nested submissions\n  const filterNestedSubmissions = (\n    submissions: NestedSubmission[]\n  ): NestedSubmission[] => {\n    return submissions.filter(submissionMatchesFilters).map((submission) => ({\n      ...submission,\n      replies: submission.replies\n        ? filterNestedSubmissions(submission.replies)\n        : []\n    }));\n  };\n\n  // Render a single submission (parent or reply)\n  const renderSubmission = (\n    submission: NestedSubmission,\n    isReply: boolean = false,\n    depth: number = 0\n  ) => {\n    const isEditing = editingSubmissions.has(submission.submission_id);\n    // More robust author check with string comparison\n    const isAuthor = userId && submission.user_id?.toString() === userId;\n    const maxDepth = 5; // Maximum nesting depth\n\n    return (\n      <div\n        key={submission.submission_id}\n        className={`submission__wrapper ${isReply ? 'submission__wrapper--reply' : ''}`}\n        style={{ marginLeft: isReply ? `${depth * 1.5}rem` : '0' }}\n        data-testid={`submission-item-${submission.submission_id}`}\n      >\n        <div className=\\\"submission__meta\\\">\n          <div className=\\\"submission__meta-left\\\">\n            <Author\n              authorId={submission.user_id?.toString() || ''}\n              authorName={submission.author || 'Unknown'}\n              bio={submission.author_bio}\n              size=\\\"sm\\\"\n              showFullName={true}\n            />\n          </div>\n\n          <div className=\\\"submission__meta-center\\\">\n            <span style={{ display: 'inline-block' }}>\n              <TimestampWithTooltip\n                date={submission.submission_datetime}\n                className=\\\"submission__datetime\\\"\n              />\n            </span>\n          </div>\n\n          <div className=\\\"submission__owner-actions\\\">\n            <div className=\\\"submission__actions-right\\\">\n              {/* Reply button for authenticated users */}\n              {userId && depth < maxDepth && (\n                <button\n                  onClick={() => toggleReplyForm(submission.submission_id)}\n                  className=\\\"submission__reply-btn\\\"\n                  aria-label=\\\"Reply to this post\\\"\n                  title=\\\"Reply to this post\\\"\n                >\n                  <svg\n                    width=\\\"16\\\"\n                    height=\\\"16\\\"\n                    viewBox=\\\"0 0 24 24\\\"\n                    fill=\\\"none\\\"\n                    stroke=\\\"currentColor\\\"\n                    strokeWidth=\\\"2\\\"\n                    strokeLinecap=\\\"round\\\"\n                    strokeLinejoin=\\\"round\\\"\n                  >\n                    <polyline points=\\\"9 17 4 12 9 7\\\" />\n                    <path d=\\\"M20 18v-2a4 4 0 0 0-4-4H4\\\" />\n                  </svg>\n                  Reply\n                </button>\n              )}\n\n              {/* Refresh button for thread pages */}\n              <RefreshButton\n                onRefresh={() =>\n                  handleRefreshSubmission(submission.submission_id)\n                }\n                className=\\\"submission__refresh-btn\\\"\n                title=\\\"Refresh this post and collapse replies\\\"\n              />\n\n              {/* Edit/Delete buttons for post authors */}\n              {isAuthor && (\n                <>\n                  <button\n                    onClick={() => toggleEdit(submission.submission_id)}\n                    className=\\\"submission__edit-btn\\\"\n                    aria-label={isEditing ? 'Cancel edit' : 'Edit submission'}\n                  >\n                    {isEditing ? '\u2715' : '\u270f\ufe0f'}\n                  </button>\n\n                  <DeleteSubmissionForm\n                    id={submission.submission_id}\n                    name={submission.submission_name}\n                    isAuthorized={true}\n                    authorId={userId}\n                    onDeleteSuccess={() =>\n                      handleSubmissionDeleted(submission.submission_id)\n                    }\n                  />\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Show edit form or regular content */}\n        {isEditing ? (\n          <div className=\\\"submission__edit-form\\\">\n            <EditSubmissionForm\n              submission={{\n                submission_id: submission.submission_id,\n                submission_title: submission.submission_title,\n                submission_name: submission.submission_name,\n                tags: submission.tags || []\n              }}\n              onSuccess={handleSubmissionUpdated}\n              onCancel={() => toggleEdit(submission.submission_id)}\n            />\n          </div>\n        ) : (\n          <>\n            <div className=\\\"submission__content\\\">\n              <h3\n                className={\n                  isReply ? 'submission__title--reply' : 'thread__main-title'\n                }\n              >\n                <ContentWithPills\n                  content={submission.submission_title}\n                  onHashtagClick={onHashtagClick}\n                  onMentionClick={onMentionClick}\n                  contextId={contextId || 'thread'}\n                />\n              </h3>\n              {submission.submission_name &&\n                submission.submission_name !== submission.submission_title && (\n                  <p className=\\\"submission__description\\\">\n                    <ContentWithPills\n                      content={submission.submission_name}\n                      onHashtagClick={onHashtagClick}\n                      onMentionClick={onMentionClick}\n                      contextId={contextId || 'thread'}\n                    />\n                  </p>\n                )}\n            </div>\n\n            {/* Tags */}\n            {submission.tags && submission.tags.length > 0 && (\n              <div className=\\\"submission__tags\\\">\n                {submission.tags.map((tag, index) => (\n                  <TagLink\n                    key={`${tag}-${index}`}\n                    value={tag}\n                    contextId={contextId || 'thread'}\n                    onTagClick={(clickedTag) => {\n                      if (onHashtagClick) {\n                        onHashtagClick(clickedTag);\n                      }\n                    }}\n                  />\n                ))}\n              </div>\n            )}\n          </>\n        )}\n\n        {/* Nested replies */}\n        {submission.replies && submission.replies.length > 0 && (\n          <div className=\\\"thread__nested-replies\\\">\n            {submission.replies.map((reply) =>\n              renderSubmission(reply, true, depth + 1)\n            )}\n          </div>\n        )}\n\n        {/* View Parent button for replies */}\n        {isReply && submission.thread_parent_id && (\n          <InstantLink\n            href={`/thread/${submission.thread_parent_id}`}\n            className=\\\"submission__parent-link submission__text-link\\\"\n            title=\\\"View parent post\\\"\n          >\n            View Parent\n          </InstantLink>\n        )}\n\n        {/* Reply form for this specific submission (only if not too deep) */}\n        {userId &&\n          depth < maxDepth &&\n          showingReplyForms.has(submission.submission_id) && (\n            <div\n              data-testid={`reply-form-${submission.submission_id}`}\n              style={{\n                marginTop: '1rem'\n                // No additional left margin since the form is already inside the indented submission\n              }}\n            >\n              <ReplyForm\n                parentId={submission.submission_id}\n                onSuccess={handleReplyAdded}\n                replyToAuthor={submission.author}\n              />\n            </div>\n          )}\n      </div>\n    );\n  };\n\n  if (loading) {\n    return (\n      <div className=\\\"thread__loading\\\">\n        <Loader />\n      </div>\n    );\n  }\n\n  if (!parentSubmission) {\n    return (\n      <div className=\\\"thread__not-found\\\">\n        <h2>Thread Not Found</h2>\n        <p>The requested thread could not be found or may have been deleted.</p>\n        <InstantLink href={NAV_PATHS.POSTS}>\u2190 Back to Posts</InstantLink>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\\\"thread__container\\\">\n      {/* Navigation */}\n      <div className=\\\"thread__navigation\\\">\n        <BackButton\n          className=\\\"thread__back-button\\\"\n          fallbackHref={NAV_PATHS.POSTS}\n          scrollRestoreKey={\n            typeof window !== 'undefined'\n              ? (() => {\n                  // Try to reconstruct the scroll key from stored data or URL params\n                  const urlParams = new URLSearchParams(window.location.search);\n                  const page = urlParams.get('page')\n                    ? parseInt(urlParams.get('page')!)\n                    : undefined;\n\n                  // Try to get stored scroll position to extract the original key\n                  const stored = localStorage.getItem('app-scroll-positions');\n                  if (stored) {\n                    try {\n                      const positions = JSON.parse(stored);\n                      // Find the most recent posts page key\n                      const postsKeys = Object.keys(positions).filter((key) =>\n                        key.startsWith(NAV_PATHS.POSTS)\n                      );\n                      if (postsKeys.length > 0) {\n                        // Use the most recent one\n                        const mostRecent = postsKeys.reduce(\n                          (latest, current) =>\n                            positions[current].timestamp >\n                            positions[latest].timestamp\n                              ? current\n                              : latest\n                        );\n                        return mostRecent;\n                      }\n                    } catch (e) {\n                      console.warn('Failed to parse stored positions:', e);\n                    }\n                  }\n\n                  // Fallback: generate basic key\n                  return generateScrollKey(NAV_PATHS.POSTS, {\n                    page,\n                    searchParams: urlParams\n                  });\n                })()\n              : undefined\n          }\n        >\n          \u2190 Back to Posts\n        </BackButton>\n      </div>\n\n      {/* Parent submission - always show, but indicate if it matches filters */}\n      <div className=\\\"thread__parent\\\">\n        {renderSubmission(parentSubmission, false, 0)}\n      </div>\n\n      {/* Direct replies */}\n      {replies.length > 0 && (\n        <div className=\\\"thread__replies\\\">\n          <h4 className=\\\"thread__replies-title\\\">\n            {(() => {\n              const filteredReplies = filterNestedSubmissions(replies);\n              const count = filteredReplies.length;\n              const totalReplies = replies.length;\n              const hasActiveFilters =\n                activeFilters &&\n                (activeFilters.hashtags.length > 0 ||\n                  activeFilters.mentions.length > 0);\n\n              if (hasActiveFilters && count !== totalReplies) {\n                return `${count} of ${totalReplies} ${totalReplies === 1 ? 'Reply' : 'Replies'} (filtered)`;\n              }\n\n              return `${count} ${count === 1 ? 'Reply' : 'Replies'}`;\n            })()}\n          </h4>\n          <div className=\\\"thread__replies-list\\\">\n            {filterNestedSubmissions(replies).map((reply) =>\n              renderSubmission(reply, true, 1)\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":669,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/thread/ThreadTags.tsx":{
    "content":"'use client';\n\nimport { useAtom } from 'jotai';\nimport { useEffect, useState } from 'react';\nimport { getSubmissionsFiltersAtom } from '../../../lib/state/atoms';\nimport { TagLink } from '../tag-link/TagLink';\nimport { getSubmissionThread } from './actions';\nimport './ThreadTags.css';\n\ninterface ThreadTagsProps {\n  submissionId: number;\n  contextId: string;\n}\n\nexport default function ThreadTags({\n  submissionId,\n  contextId\n}: ThreadTagsProps) {\n  const [threadTags, setThreadTags] = useState<string[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // Access the filter state for this context\n  const [filtersState, setFiltersState] = useAtom(\n    getSubmissionsFiltersAtom(contextId)\n  );\n\n  useEffect(() => {\n    const loadThreadTags = async () => {\n      try {\n        setLoading(true);\n        const threadData = await getSubmissionThread(submissionId);\n\n        // Collect all tags from parent and replies\n        const allTags = new Set<string>();\n\n        // Add parent tags\n        if (threadData.parent?.tags) {\n          threadData.parent.tags.forEach((tag) => allTags.add(tag));\n        }\n\n        // Add reply tags\n        threadData.replies.forEach((reply) => {\n          if (reply.tags) {\n            reply.tags.forEach((tag) => allTags.add(tag));\n          }\n        });\n\n        setThreadTags(Array.from(allTags).sort());\n      } catch (error) {\n        console.error('Error loading thread tags:', error);\n        setThreadTags([]);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadThreadTags();\n  }, [submissionId]);\n\n  const handleTagClick = (tag: string) => {\n    // Ensure hashtag value includes # prefix for proper filtering\n    const hashtagValue = tag.startsWith('#') ? tag : `#${tag}`;\n\n    setFiltersState((prev) => {\n      const newFilters = [...prev.filters];\n      const tagsIndex = newFilters.findIndex((f) => f.name === 'tags');\n\n      if (tagsIndex >= 0) {\n        // Update existing tags filter\n        const currentTags = newFilters[tagsIndex].value\n          .split(',')\n          .map((tag) => tag.trim())\n          .filter(Boolean);\n\n        const isTagActive = currentTags.includes(hashtagValue);\n        const updatedTags = isTagActive\n          ? currentTags.filter((tag) => tag !== hashtagValue)\n          : [...currentTags, hashtagValue];\n\n        if (updatedTags.length > 0) {\n          newFilters[tagsIndex] = {\n            name: 'tags',\n            value: updatedTags.join(',')\n          };\n        } else {\n          // Remove tags filter if no tags left\n          return {\n            ...prev,\n            filters: newFilters.filter(\n              (f) => f.name !== 'tags' && f.name !== 'tagLogic'\n            )\n          };\n        }\n      } else {\n        // Add new tags filter\n        newFilters.push({ name: 'tags', value: hashtagValue });\n      }\n\n      return {\n        ...prev,\n        filters: newFilters,\n        page: 1\n      };\n    });\n  };\n\n  if (loading) {\n    return (\n      <div className=\\\"thread-tags\\\">\n        <h3 className=\\\"thread-tags__title\\\">Thread Tags</h3>\n        <div className=\\\"thread-tags__loading\\\">Loading tags...</div>\n      </div>\n    );\n  }\n\n  if (threadTags.length === 0) {\n    return (\n      <div className=\\\"thread-tags\\\">\n        <h3 className=\\\"thread-tags__title\\\">Thread Tags</h3>\n        <p className=\\\"thread-tags__empty\\\">No tags in this thread</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\\\"thread-tags\\\">\n      <h3 className=\\\"thread-tags__title\\\">Thread Tags ({threadTags.length})</h3>\n      <div className=\\\"thread-tags__list\\\">\n        {threadTags.map((tag) => (\n          <TagLink\n            key={tag}\n            value={tag}\n            contextId={contextId}\n            appendSearchParam={false}\n            onTagClick={handleTagClick}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":142,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/thread/ThreadBreadcrumb.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { buildThreadUrl } from '../../../lib/routes';\nimport {\n  generateScrollKey,\n  storeScrollPosition\n} from '../../../lib/utils/scroll-position';\nimport { InstantLink } from '../ui/InstantLink';\nimport './ThreadBreadcrumb.css';\n\ninterface BreadcrumbItem {\n  submission_id: number;\n  submission_title: string;\n  author: string;\n}\n\ninterface ThreadBreadcrumbProps {\n  currentSubmissionId: number;\n  className?: string;\n}\n\nexport function ThreadBreadcrumb({\n  currentSubmissionId,\n  className\n}: ThreadBreadcrumbProps) {\n  const [breadcrumbChain, setBreadcrumbChain] = useState<BreadcrumbItem[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const buildBreadcrumbChain = async () => {\n      try {\n        setLoading(true);\n        const chain: BreadcrumbItem[] = [];\n        let currentId = currentSubmissionId;\n\n        // Build the chain by following thread_parent_id links\n        while (currentId) {\n          const response = await fetch(`/api/submissions/${currentId}`);\n          if (!response.ok) break;\n\n          const submission = await response.json();\n          if (!submission.thread_parent_id) break;\n\n          // Get parent submission\n          const parentResponse = await fetch(\n            `/api/submissions/${submission.thread_parent_id}`\n          );\n          if (!parentResponse.ok) break;\n\n          const parent = await parentResponse.json();\n          chain.unshift({\n            submission_id: parent.submission_id,\n            submission_title: parent.submission_title || parent.submission_name,\n            author: parent.author || 'Unknown'\n          });\n\n          currentId = parent.submission_id;\n        }\n\n        setBreadcrumbChain(chain);\n      } catch (error) {\n        console.error('Error building breadcrumb chain:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    buildBreadcrumbChain();\n  }, [currentSubmissionId]);\n\n  const handleBreadcrumbClick = (targetSubmissionId: number) => {\n    // Store current scroll position before navigating\n    if (typeof window !== 'undefined') {\n      const scrollKey = generateScrollKey(window.location.pathname, {\n        searchParams: new URLSearchParams(window.location.search)\n      });\n\n      const threadContainer = document.querySelector(\n        '.thread__container'\n      ) as HTMLElement;\n      const scrollY = threadContainer\n        ? threadContainer.scrollTop\n        : window.scrollY;\n\n      storeScrollPosition(\n        scrollKey,\n        {\n          targetSubmissionId: currentSubmissionId\n        },\n        scrollY\n      );\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className={`thread-breadcrumb ${className || ''}`}>\n        <span className=\\\"thread-breadcrumb__loading\\\">\n          Loading breadcrumb...\n        </span>\n      </div>\n    );\n  }\n\n  if (breadcrumbChain.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={`thread-breadcrumb ${className || ''}`}>\n      <span className=\\\"thread-breadcrumb__label\\\">Thread chain:</span>\n      <div className=\\\"thread-breadcrumb__items\\\">\n        {breadcrumbChain.map((item, index) => (\n          <div key={item.submission_id} className=\\\"thread-breadcrumb__item\\\">\n            <InstantLink\n              href={buildThreadUrl(item.submission_id)}\n              className=\\\"thread-breadcrumb__link\\\"\n              title={`View thread by ${item.author}`}\n              onClick={() => handleBreadcrumbClick(item.submission_id)}\n            >\n              <span className=\\\"thread-breadcrumb__title\\\">\n                {item.submission_title}\n              </span>\n              <span className=\\\"thread-breadcrumb__author\\\">\n                by {item.author}\n              </span>\n            </InstantLink>\n            {index < breadcrumbChain.length - 1 && (\n              <span className=\\\"thread-breadcrumb__separator\\\">\u2192</span>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":138,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/thread/ParentPostLink.tsx":{
    "content":"'use client';\n\nimport { buildThreadUrl } from '../../../lib/routes';\nimport {\n  generateScrollKey,\n  storeScrollPosition\n} from '../../../lib/utils/scroll-position';\nimport { InstantLink } from '../ui/InstantLink';\nimport './ParentPostLink.css';\n\ninterface ParentPostLinkProps {\n  threadParentId: number;\n  currentSubmissionId: number;\n  className?: string;\n}\n\nexport function ParentPostLink({\n  threadParentId,\n  currentSubmissionId,\n  className\n}: ParentPostLinkProps) {\n  const handleParentNavigation = () => {\n    // Store current scroll position before navigating to parent thread\n    if (typeof window !== 'undefined') {\n      const scrollKey = generateScrollKey(window.location.pathname, {\n        searchParams: new URLSearchParams(window.location.search)\n      });\n\n      // Get scroll position from the thread container\n      const threadContainer = document.querySelector(\n        '.thread__container'\n      ) as HTMLElement;\n      const scrollY = threadContainer\n        ? threadContainer.scrollTop\n        : window.scrollY;\n\n      // Store the current submission ID as the target to scroll to when returning\n      storeScrollPosition(\n        scrollKey,\n        {\n          targetSubmissionId: currentSubmissionId\n        },\n        scrollY\n      );\n    }\n  };\n\n  return (\n    <div className={`parent-post-link ${className || ''}`}>\n      <span className=\\\"parent-post-link__label\\\">\u21a9</span>\n      <InstantLink\n        href={buildThreadUrl(threadParentId)}\n        className=\\\"parent-post-link__link\\\"\n        title=\\\"View parent post\\\"\n        onClick={handleParentNavigation}\n      >\n        <span className=\\\"parent-post-link__text\\\">See parent post</span>\n      </InstantLink>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":62,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/thread/ReplyForm.tsx":{
    "content":"'use client';\n\nimport { SharedSubmissionForm } from '../submission-forms/shared-submission-form/SharedSubmissionForm';\n\ninterface ReplyFormProps {\n  parentId: number;\n  onSuccess?: (newReply?: any) => void;\n  replyToAuthor?: string; // Author name of the post being replied to\n}\n\nexport function ReplyForm({\n  parentId,\n  onSuccess,\n  replyToAuthor\n}: ReplyFormProps) {\n  return (\n    <SharedSubmissionForm\n      mode=\\\"reply\\\"\n      parentId={parentId}\n      onSuccess={onSuccess}\n      replyToAuthor={replyToAuthor}\n      className=\\\"reply-form\\\"\n    />\n  );\n}\n",
    "language":"typescript",
    "lines":26,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/thread/CollapsibleReplyForm.tsx":{
    "content":"'use client';\n\nimport { useState } from 'react';\nimport './CollapsibleReplyForm.css';\nimport { ReplyForm } from './ReplyForm';\n\ninterface CollapsibleReplyFormProps {\n  parentId: number;\n  onSuccess: (result?: any) => void;\n  replyToAuthor: string;\n}\n\nexport default function CollapsibleReplyForm({\n  parentId,\n  onSuccess,\n  replyToAuthor\n}: CollapsibleReplyFormProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const toggleExpanded = () => {\n    setIsExpanded(!isExpanded);\n  };\n\n  return (\n    <div className=\\\"collapsible-reply-form\\\">\n      <button\n        className=\\\"collapsible-reply-form__toggle\\\"\n        onClick={toggleExpanded}\n        aria-expanded={isExpanded}\n        aria-controls=\\\"reply-form-content\\\"\n      >\n        <span className=\\\"collapsible-reply-form__toggle-text\\\">ADD A REPLY</span>\n        <svg\n          className={`collapsible-reply-form__chevron ${\n            isExpanded\n              ? 'collapsible-reply-form__chevron--up'\n              : 'collapsible-reply-form__chevron--down'\n          }`}\n          width=\\\"16\\\"\n          height=\\\"16\\\"\n          viewBox=\\\"0 0 16 16\\\"\n          fill=\\\"none\\\"\n          xmlns=\\\"http://www.w3.org/2000/svg\\\"\n        >\n          <path\n            d=\\\"M4 6L8 10L12 6\\\"\n            stroke=\\\"currentColor\\\"\n            strokeWidth=\\\"2\\\"\n            strokeLinecap=\\\"round\\\"\n            strokeLinejoin=\\\"round\\\"\n          />\n        </svg>\n      </button>\n\n      <div\n        id=\\\"reply-form-content\\\"\n        className={`collapsible-reply-form__content ${\n          isExpanded\n            ? 'collapsible-reply-form__content--expanded'\n            : 'collapsible-reply-form__content--collapsed'\n        }`}\n      >\n        <div className=\\\"collapsible-reply-form__form\\\">\n          <ReplyForm\n            parentId={parentId}\n            onSuccess={(result) => {\n              onSuccess(result);\n              // Optionally collapse after successful submission\n              setIsExpanded(false);\n            }}\n            replyToAuthor={replyToAuthor}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":78,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/font-picker/FontPicker.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { useFontPreference } from '../../../lib/context/UserPreferencesContext';\nimport './FontPicker.css';\n\nexport type FontOption = 'monospace' | 'default';\n\ninterface FontPickerProps {\n  className?: string;\n  onChange?: (font: FontOption) => void;\n}\n\nconst FONT_OPTIONS = {\n  monospace: {\n    name: 'Code',\n    description: 'Fira Code - Perfect for coding',\n    preview: 'Aa 123 {code}',\n    cssValue:\n      \\\"'Fira Code', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'Segoe UI Symbol', monospace\\\"\n  },\n  default: {\n    name: 'Reading',\n    description: 'System fonts - Easy on the eyes',\n    preview: 'Aa 123 text',\n    cssValue:\n      \\\"-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif\\\"\n  }\n} as const;\n\nexport const FontPicker: React.FC<FontPickerProps> = ({\n  className = '',\n  onChange\n}) => {\n  const {\n    preference: selectedFont,\n    setPreference,\n    isUpdating\n  } = useFontPreference();\n  const [isOpen, setIsOpen] = useState(false);\n  const [isClient, setIsClient] = useState(false);\n\n  // Ensure we're on the client side\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  const handleFontChange = async (font: FontOption) => {\n    setIsOpen(false);\n\n    try {\n      await setPreference(font);\n\n      // Notify parent component\n      if (onChange) {\n        onChange(font);\n      }\n    } catch (error) {\n      // Error handling is managed by the context\n      console.error('Failed to update font preference:', error);\n    }\n  };\n\n  const toggleDropdown = () => {\n    setIsOpen(!isOpen);\n  };\n\n  const handleKeyDown = (event: React.KeyboardEvent) => {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      toggleDropdown();\n    } else if (event.key === 'Escape') {\n      setIsOpen(false);\n    }\n  };\n\n  const handleOptionKeyDown = (\n    event: React.KeyboardEvent,\n    font: FontOption\n  ) => {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      handleFontChange(font);\n    }\n  };\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      const target = event.target as Element;\n      if (!target.closest('.font-picker')) {\n        setIsOpen(false);\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () =>\n        document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [isOpen]);\n\n  // Don't render on server to avoid hydration mismatches\n  if (!isClient) {\n    return null;\n  }\n\n  return (\n    <div className={`font-picker ${className}`}>\n      <button\n        type=\\\"button\\\"\n        className={`font-picker__trigger ${isOpen ? 'font-picker__trigger--open' : ''}`}\n        onClick={toggleDropdown}\n        onKeyDown={handleKeyDown}\n        aria-haspopup=\\\"listbox\\\"\n        aria-expanded={isOpen}\n        aria-label=\\\"Select application font\\\"\n        title=\\\"Change application font family\\\"\n        disabled={isUpdating}\n      >\n        <span className=\\\"font-picker__icon\\\">\ud83d\udd24</span>\n        <span className=\\\"font-picker__label\\\">\n          {FONT_OPTIONS[selectedFont].name}\n        </span>\n        <span\n          className={`font-picker__arrow ${isOpen ? 'font-picker__arrow--open' : ''}`}\n        >\n          \u25bc\n        </span>\n      </button>\n\n      {isOpen && (\n        <div className=\\\"font-picker__dropdown\\\" role=\\\"listbox\\\">\n          {Object.entries(FONT_OPTIONS).map(([key, option]) => (\n            <div\n              key={key}\n              className={`font-picker__option ${\n                selectedFont === key ? 'font-picker__option--selected' : ''\n              }`}\n              role=\\\"option\\\"\n              aria-selected={selectedFont === key}\n              tabIndex={0}\n              onClick={() => handleFontChange(key as FontOption)}\n              onKeyDown={(e) => handleOptionKeyDown(e, key as FontOption)}\n            >\n              <div className=\\\"font-picker__option-content\\\">\n                <span className=\\\"font-picker__option-name\\\">{option.name}</span>\n                <span className=\\\"font-picker__option-description\\\">\n                  {option.description}\n                </span>\n                <span\n                  className=\\\"font-picker__option-preview\\\"\n                  style={{ fontFamily: option.cssValue }}\n                >\n                  {option.preview}\n                </span>\n              </div>\n              {selectedFont === key && (\n                <span className=\\\"font-picker__option-check\\\">\u2713</span>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default FontPicker;\n",
    "language":"typescript",
    "lines":170,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/dev-tools/HardResetPanel.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport React, { useEffect, useState } from 'react';\nimport {\n  getResetStats,\n  HardResetResult,\n  triggerManualHardReset\n} from '../../../lib/utils/hard-reset-manager';\n\nconst logger = createLogger({\n  context: {\n    component: 'HardResetPanel',\n    module: 'components/dev-tools'\n  },\n  enabled: false\n});\n\nconst HardResetPanel: React.FC = () => {\n  const [resetStats, setResetStats] = useState<any>(null);\n  const [isResetting, setIsResetting] = useState(false);\n  const [lastResetResult, setLastResetResult] =\n    useState<HardResetResult | null>(null);\n\n  const loadResetStats = () => {\n    const stats = getResetStats();\n    setResetStats(stats);\n  };\n\n  useEffect(() => {\n    loadResetStats();\n\n    // Refresh stats every 5 seconds\n    const interval = setInterval(loadResetStats, 5000);\n    return () => clearInterval(interval);\n  }, []);\n\n  const handleManualReset = async (reason: string) => {\n    if (isResetting) return;\n\n    setIsResetting(true);\n    try {\n      const result = await triggerManualHardReset(reason);\n      setLastResetResult(result);\n\n      // Refresh stats after reset\n      setTimeout(() => {\n        loadResetStats();\n        setIsResetting(false);\n\n        // Reload page if reset was successful\n        if (result.resetPerformed) {\n          setTimeout(() => {\n            window.location.reload();\n          }, 2000);\n        }\n      }, 1000);\n    } catch (error) {\n      logger.error('Manual reset failed', error as Error);\n      setIsResetting(false);\n    }\n  };\n\n  const triggerBrowserReset = () => {\n    if (window.confirm('This will trigger a complete hard reset. Continue?')) {\n      handleManualReset('Manual browser reset via admin panel');\n    }\n  };\n\n  const triggerTestReset = () => {\n    if (window.confirm('This will trigger a test reset. Continue?')) {\n      handleManualReset('Test reset for development');\n    }\n  };\n\n  const formatTimestamp = (timestamp: number | null) => {\n    if (!timestamp) return 'Never';\n    return new Date(timestamp).toLocaleString();\n  };\n\n  return (\n    <div\n      style={{\n        padding: '1rem',\n        border: '1px solid #ddd',\n        borderRadius: '8px',\n        backgroundColor: '#f9f9f9',\n        marginBottom: '1rem'\n      }}\n    >\n      <h3 style={{ margin: '0 0 1rem 0', color: '#333' }}>\n        \ud83d\udd04 Hard Reset Management\n      </h3>\n\n      {/* Reset Statistics */}\n      <div style={{ marginBottom: '1rem' }}>\n        <h4 style={{ margin: '0 0 0.5rem 0', fontSize: '1rem' }}>\n          \ud83d\udcca Reset Statistics\n        </h4>\n        {resetStats ? (\n          <div\n            style={{\n              backgroundColor: '#fff',\n              padding: '0.75rem',\n              borderRadius: '4px',\n              fontSize: '0.875rem'\n            }}\n          >\n            <div>\n              <strong>Last Reset Version:</strong>{' '}\n              {resetStats.lastResetVersion || 'None'}\n            </div>\n            <div>\n              <strong>Last Reset Time:</strong>{' '}\n              {formatTimestamp(resetStats.lastResetTimestamp)}\n            </div>\n            <div>\n              <strong>Total Resets:</strong> {resetStats.resetCount}\n            </div>\n            <div>\n              <strong>First Visit:</strong>{' '}\n              {formatTimestamp(resetStats.firstVisit)}\n            </div>\n          </div>\n        ) : (\n          <div>Loading stats...</div>\n        )}\n      </div>\n\n      {/* Last Reset Result */}\n      {lastResetResult && (\n        <div style={{ marginBottom: '1rem' }}>\n          <h4 style={{ margin: '0 0 0.5rem 0', fontSize: '1rem' }}>\n            \ud83d\udccb Last Reset Result\n          </h4>\n          <div\n            style={{\n              backgroundColor: lastResetResult.resetPerformed\n                ? '#d4edda'\n                : '#f8d7da',\n              padding: '0.75rem',\n              borderRadius: '4px',\n              fontSize: '0.875rem',\n              border: `1px solid ${lastResetResult.resetPerformed ? '#c3e6cb' : '#f5c6cb'}`\n            }}\n          >\n            <div>\n              <strong>Reset Performed:</strong>{' '}\n              {lastResetResult.resetPerformed ? '\u2705 Yes' : '\u274c No'}\n            </div>\n            <div>\n              <strong>Previous Version:</strong>{' '}\n              {lastResetResult.previousVersion || 'None'}\n            </div>\n            <div>\n              <strong>Current Version:</strong> {lastResetResult.currentVersion}\n            </div>\n\n            {lastResetResult.resetPerformed && (\n              <div style={{ marginTop: '0.5rem' }}>\n                <strong>Items Cleared:</strong>\n                <ul style={{ margin: '0.25rem 0', paddingLeft: '1.5rem' }}>\n                  <li>\n                    Service Workers:{' '}\n                    {lastResetResult.itemsCleared.serviceWorkers}\n                  </li>\n                  <li>Caches: {lastResetResult.itemsCleared.caches}</li>\n                  <li>\n                    localStorage:{' '}\n                    {lastResetResult.itemsCleared.localStorage ? '\u2705' : '\u274c'}\n                  </li>\n                  <li>\n                    sessionStorage:{' '}\n                    {lastResetResult.itemsCleared.sessionStorage ? '\u2705' : '\u274c'}\n                  </li>\n                  <li>\n                    IndexedDB:{' '}\n                    {lastResetResult.itemsCleared.indexedDB ? '\u2705' : '\u274c'}\n                  </li>\n                  <li>Cookies: {lastResetResult.itemsCleared.cookies}</li>\n                  <li>\n                    WebSQL: {lastResetResult.itemsCleared.webSQL ? '\u2705' : '\u274c'}\n                  </li>\n                </ul>\n              </div>\n            )}\n\n            {lastResetResult.errors.length > 0 && (\n              <div style={{ marginTop: '0.5rem' }}>\n                <strong>Errors:</strong>\n                <ul\n                  style={{\n                    margin: '0.25rem 0',\n                    paddingLeft: '1.5rem',\n                    color: '#721c24'\n                  }}\n                >\n                  {lastResetResult.errors.map((error, index) => (\n                    <li key={index}>{error}</li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Reset Actions */}\n      <div style={{ marginBottom: '1rem' }}>\n        <h4 style={{ margin: '0 0 0.5rem 0', fontSize: '1rem' }}>\n          \ud83d\udd27 Reset Actions\n        </h4>\n        <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>\n          <button\n            onClick={triggerBrowserReset}\n            disabled={isResetting}\n            style={{\n              padding: '0.5rem 1rem',\n              backgroundColor: isResetting ? '#6c757d' : '#dc3545',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: isResetting ? 'not-allowed' : 'pointer',\n              fontSize: '0.875rem'\n            }}\n          >\n            {isResetting ? 'Resetting...' : '\ud83d\udd04 Manual Hard Reset'}\n          </button>\n\n          <button\n            onClick={triggerTestReset}\n            disabled={isResetting}\n            style={{\n              padding: '0.5rem 1rem',\n              backgroundColor: isResetting ? '#6c757d' : '#ffc107',\n              color: isResetting ? 'white' : '#212529',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: isResetting ? 'not-allowed' : 'pointer',\n              fontSize: '0.875rem'\n            }}\n          >\n            {isResetting ? 'Resetting...' : '\ud83e\uddea Test Reset'}\n          </button>\n\n          <button\n            onClick={loadResetStats}\n            style={{\n              padding: '0.5rem 1rem',\n              backgroundColor: '#28a745',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer',\n              fontSize: '0.875rem'\n            }}\n          >\n            \ud83d\udd04 Refresh Stats\n          </button>\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div\n        style={{\n          fontSize: '0.75rem',\n          color: '#6c757d',\n          backgroundColor: '#e9ecef',\n          padding: '0.5rem',\n          borderRadius: '4px'\n        }}\n      >\n        <strong>Console Commands:</strong>\n        <br />\u2022 <code>triggerHardReset(&apos;reason&apos;)</code> - Trigger\n        manual reset\n        <br />\u2022 <code>window.__originalConsole.log(&apos;test&apos;)</code> -\n        Use original console in production\n      </div>\n    </div>\n  );\n};\n\nexport default HardResetPanel;\n",
    "language":"typescript",
    "lines":284,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/dev-tools/PWATestPanel.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\n\nconst PWATestPanel: React.FC = () => {\n  const [isStandalone, setIsStandalone] = useState(false);\n  const [installPromptAvailable, setInstallPromptAvailable] = useState(false);\n  const [serviceWorkerStatus, setServiceWorkerStatus] = useState('checking...');\n\n  useEffect(() => {\n    // Check if running as PWA\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      setIsStandalone(true);\n    }\n\n    // Check for iOS Safari PWA\n    if ((window.navigator as any).standalone === true) {\n      setIsStandalone(true);\n    }\n\n    // Check service worker status\n    if ('serviceWorker' in navigator) {\n      navigator.serviceWorker.ready\n        .then(() => {\n          setServiceWorkerStatus('active');\n        })\n        .catch(() => {\n          setServiceWorkerStatus('error');\n        });\n    } else {\n      setServiceWorkerStatus('not supported');\n    }\n\n    // Listen for install prompt\n    const handleBeforeInstallPrompt = () => {\n      setInstallPromptAvailable(true);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n\n    return () => {\n      window.removeEventListener(\n        'beforeinstallprompt',\n        handleBeforeInstallPrompt\n      );\n    };\n  }, []);\n\n  const testInstallPrompt = () => {\n    // Force show install prompt for testing\n    const event = new CustomEvent('beforeinstallprompt');\n    window.dispatchEvent(event);\n  };\n\n  return (\n    <div style={{ padding: '20px', maxWidth: '800px' }}>\n      <div\n        style={{\n          padding: '20px',\n          background: 'var(--light-background--primary)',\n          borderRadius: '12px',\n          border: '1px solid var(--light-border--primary)'\n        }}\n      >\n        <h2>PWA & Animated Border Test Panel</h2>\n\n        <div style={{ marginBottom: '20px' }}>\n          <h3>PWA Status</h3>\n          <ul>\n            <li>\n              Running as PWA: <strong>{isStandalone ? 'Yes' : 'No'}</strong>\n            </li>\n            <li>\n              Install prompt available:{' '}\n              <strong>{installPromptAvailable ? 'Yes' : 'No'}</strong>\n            </li>\n            <li>\n              Service Worker: <strong>{serviceWorkerStatus}</strong>\n            </li>\n          </ul>\n\n          <button\n            onClick={testInstallPrompt}\n            style={{\n              padding: '8px 16px',\n              background: 'var(--brand-primary)',\n              color: 'white',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer',\n              marginTop: '10px'\n            }}\n          >\n            Test Install Prompt\n          </button>\n        </div>\n\n        <div>\n          <h3>PWA Features</h3>\n          <ul>\n            <li>\u2705 Web App Manifest</li>\n            <li>\u2705 Service Worker with caching</li>\n            <li>\u2705 Install prompt component</li>\n            <li>\u2705 Offline support</li>\n            <li>\u2705 App icons (multiple sizes)</li>\n            <li>\u2705 Theme colors</li>\n            <li>\u2705 Standalone display mode</li>\n            <li>\u2705 App shortcuts</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PWATestPanel;\n",
    "language":"typescript",
    "lines":117,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/dev-tools/DevSkeletonToggle.tsx":{
    "content":"/**\n * DevSkeletonToggle - Development-only skeleton state controller\n *\n * This component is ONLY included in development builds and provides\n * global control over skeleton loading states for testing and development.\n *\n * SECURITY NOTE: This entire file is excluded from production builds\n * via Next.js build-time environment variable checks.\n */\n\n'use client';\n\nimport { atom, useAtom } from 'jotai';\nimport { useEffect, useState } from 'react';\nimport './DevSkeletonToggle.css';\n\n// Global dev skeleton state atoms - always defined but only used in development\nconst devSkeletonModeAtom = atom<'auto' | 'force-on' | 'force-off'>('auto');\nconst devSkeletonEnabledAtom = atom<boolean>(false);\n\n// Hook for components to check if they should show skeleton\nexport const useDevSkeletonState = () => {\n  const [mode] = useAtom(devSkeletonModeAtom);\n  const [isEnabled] = useAtom(devSkeletonEnabledAtom);\n\n  if (process.env.NODE_ENV !== 'development') {\n    return {\n      shouldShowSkeleton: false,\n      isDevModeActive: false\n    };\n  }\n\n  return {\n    shouldShowSkeleton: mode === 'force-on',\n    isDevModeActive: isEnabled && mode !== 'auto'\n  };\n};\n\n// Internal component that's only rendered in development\nconst DevSkeletonToggleInternal: React.FC = () => {\n  const [mode, setMode] = useAtom(devSkeletonModeAtom);\n  const [, setIsEnabled] = useAtom(devSkeletonEnabledAtom);\n  const [isVisible, setIsVisible] = useState(false);\n\n  // Get dev mode state\n  const { isDevModeActive } = useDevSkeletonState();\n\n  // Keyboard shortcut to toggle visibility (Ctrl+Shift+S)\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.ctrlKey && event.shiftKey && event.key === 'S') {\n        event.preventDefault();\n        setIsVisible((prev) => !prev);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  const handleModeChange = (newMode: 'auto' | 'force-on' | 'force-off') => {\n    setMode(newMode);\n    setIsEnabled(newMode !== 'auto');\n\n    // Development logging with visual indicators\n    if (process.env.NODE_ENV === 'development') {\n      const modeEmojis = {\n        auto: '\ud83d\udd35',\n        'force-on': '\ud83d\udfe2',\n        'force-off': '\ud83d\udd34'\n      };\n      // eslint-disable-next-line no-console\n      console.log(\n        `\ud83c\udf9b\ufe0f [DEV SKELETON] ${modeEmojis[newMode]} Mode changed to:`,\n        newMode.toUpperCase()\n      );\n\n      // Add temporary visual feedback\n      const existingToast = document.querySelector('.dev-skeleton-toast');\n      if (existingToast) {\n        existingToast.remove();\n      }\n\n      const toast = document.createElement('div');\n      toast.className = 'dev-skeleton-toast';\n      toast.innerHTML = `${modeEmojis[newMode]} Skeleton: ${newMode.toUpperCase()}`;\n      toast.style.cssText = `\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: #2563eb;\n        color: white;\n        padding: 8px 16px;\n        border-radius: 6px;\n        font-size: 14px;\n        font-weight: 500;\n        z-index: 10000;\n        animation: slideDown 0.3s ease;\n      `;\n\n      // Add slide animation\n      const style = document.createElement('style');\n      style.textContent = `\n        @keyframes slideDown {\n          from { opacity: 0; transform: translateX(-50%) translateY(-10px); }\n          to { opacity: 1; transform: translateX(-50%) translateY(0); }\n        }\n      `;\n      document.head.appendChild(style);\n      document.body.appendChild(toast);\n\n      // Remove after 2 seconds\n      setTimeout(() => {\n        if (toast.parentNode) {\n          toast.style.animation = 'slideDown 0.3s ease reverse';\n          setTimeout(() => toast.remove(), 300);\n        }\n        style.remove();\n      }, 2000);\n    }\n  };\n\n  const getModeDescription = () => {\n    switch (mode) {\n      case 'auto':\n        return 'Normal behavior - skeletons show during actual loading';\n      case 'force-on':\n        return 'Force ON - all components show skeleton state';\n      case 'force-off':\n        return 'Force OFF - no skeletons will show (override loading states)';\n      default:\n        return '';\n    }\n  };\n\n  return (\n    <>\n      {/* Floating toggle button */}\n      <button\n        className={`dev-skeleton-toggle-fab ${isVisible ? 'dev-skeleton-toggle-fab--open' : ''}`}\n        onClick={() => setIsVisible(!isVisible)}\n        title=\\\"Toggle skeleton dev tools (Ctrl+Shift+S)\\\"\n        aria-label=\\\"Open skeleton development tools\\\"\n      >\n        <svg\n          width=\\\"16\\\"\n          height=\\\"16\\\"\n          viewBox=\\\"0 0 24 24\\\"\n          fill=\\\"none\\\"\n          stroke=\\\"currentColor\\\"\n          strokeWidth=\\\"2\\\"\n        >\n          <rect x=\\\"2\\\" y=\\\"3\\\" width=\\\"20\\\" height=\\\"14\\\" rx=\\\"2\\\" ry=\\\"2\\\" />\n          <line x1=\\\"8\\\" y1=\\\"21\\\" x2=\\\"16\\\" y2=\\\"21\\\" />\n          <line x1=\\\"12\\\" y1=\\\"17\\\" x2=\\\"12\\\" y2=\\\"21\\\" />\n        </svg>\n        {isDevModeActive && (\n          <div className=\\\"dev-skeleton-toggle-fab__indicator\\\" />\n        )}\n      </button>\n\n      {/* Control panel */}\n      {isVisible && (\n        <div className=\\\"dev-skeleton-toggle-panel\\\">\n          <div className=\\\"dev-skeleton-toggle-panel__header\\\">\n            <h3>\ud83c\udf9b\ufe0f Skeleton Dev Tools</h3>\n            <button\n              className=\\\"dev-skeleton-toggle-panel__close\\\"\n              onClick={() => setIsVisible(false)}\n              aria-label=\\\"Close skeleton dev tools\\\"\n            >\n              \u00d7\n            </button>\n          </div>\n\n          <div className=\\\"dev-skeleton-toggle-panel__content\\\">\n            <div className=\\\"dev-skeleton-toggle-panel__section\\\">\n              <h4>Mode Control</h4>\n              <div className=\\\"dev-skeleton-toggle-panel__radio-group\\\">\n                <label className=\\\"dev-skeleton-toggle-panel__radio\\\">\n                  <input\n                    type=\\\"radio\\\"\n                    name=\\\"skeleton-mode\\\"\n                    value=\\\"auto\\\"\n                    checked={mode === 'auto'}\n                    onChange={() => handleModeChange('auto')}\n                  />\n                  <span>Auto (Default)</span>\n                </label>\n\n                <label className=\\\"dev-skeleton-toggle-panel__radio\\\">\n                  <input\n                    type=\\\"radio\\\"\n                    name=\\\"skeleton-mode\\\"\n                    value=\\\"force-on\\\"\n                    checked={mode === 'force-on'}\n                    onChange={() => handleModeChange('force-on')}\n                  />\n                  <span>Force ON</span>\n                </label>\n\n                <label className=\\\"dev-skeleton-toggle-panel__radio\\\">\n                  <input\n                    type=\\\"radio\\\"\n                    name=\\\"skeleton-mode\\\"\n                    value=\\\"force-off\\\"\n                    checked={mode === 'force-off'}\n                    onChange={() => handleModeChange('force-off')}\n                  />\n                  <span>Force OFF</span>\n                </label>\n              </div>\n            </div>\n\n            <div className=\\\"dev-skeleton-toggle-panel__section\\\">\n              <h4>Current Status</h4>\n              <div className=\\\"dev-skeleton-toggle-panel__status\\\">\n                <div\n                  className={`dev-skeleton-toggle-panel__status-indicator ${isDevModeActive ? 'active' : 'inactive'}`}\n                >\n                  {isDevModeActive ? '\ud83d\udfe2 Override Active' : '\ud83d\udd35 Normal Mode'}\n                </div>\n                <p className=\\\"dev-skeleton-toggle-panel__description\\\">\n                  {getModeDescription()}\n                </p>\n              </div>\n            </div>\n\n            <div className=\\\"dev-skeleton-toggle-panel__section\\\">\n              <h4>Usage</h4>\n              <ul className=\\\"dev-skeleton-toggle-panel__help\\\">\n                <li>\n                  <strong>Auto:</strong> Normal loading behavior\n                </li>\n                <li>\n                  <strong>Force ON:</strong> See skeleton designs without\n                  waiting for loading\n                </li>\n                <li>\n                  <strong>Force OFF:</strong> Test layouts without skeleton\n                  interference\n                </li>\n                <li>\n                  <strong>Keyboard:</strong> Ctrl+Shift+S to toggle this panel\n                </li>\n              </ul>\n            </div>\n\n            <div className=\\\"dev-skeleton-toggle-panel__section\\\">\n              <div className=\\\"dev-skeleton-toggle-panel__warning\\\">\n                \u26a0\ufe0f <strong>Development Only</strong>\n                <br />\n                This tool is automatically excluded from production builds.\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n// Main component with build-time exclusion\nexport const DevSkeletonToggle: React.FC = () => {\n  // Return null in production - this ensures the component doesn't exist\n  if (process.env.NODE_ENV !== 'development') {\n    return null;\n  }\n\n  return <DevSkeletonToggleInternal />;\n};\n\nexport default DevSkeletonToggle;\n",
    "language":"typescript",
    "lines":275,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-avatar/AuthAvatarServer.tsx":{
    "content":"import { auth } from '../../../lib/auth';\nimport { Avatar, AvatarPropSizes } from '../avatar/Avatar';\n\ninterface AuthAvatarServerProps {\n  size?: AvatarPropSizes;\n  enableTooltip?: boolean;\n  tooltipScale?: 2 | 3 | 4;\n  className?: string;\n}\n\n/**\n * Server-side Avatar component specifically for the currently authenticated user.\n * Uses the user's ID as a consistent seed to ensure the avatar\n * appearance remains the same across all parts of the application.\n */\nexport async function AuthAvatarServer({\n  size = 'md',\n  enableTooltip = false,\n  tooltipScale = 2,\n  className = ''\n}: AuthAvatarServerProps) {\n  const session = await auth();\n\n  // Generate a random seed for unauthenticated users\n  const randomSeed = `guest-${Math.random().toString(36).substring(2, 15)}-${Date.now()}`;\n\n  // Use user ID as the primary seed for consistency\n  // For unauthenticated users, use a random seed\n  const seed = session?.user?.id\n    ? session.user.id ||\n      session.user.name ||\n      session.user.email ||\n      'authenticated-fallback'\n    : randomSeed;\n\n  return (\n    <div className={className}>\n      <Avatar\n        seed={seed}\n        size={size}\n        enableTooltip={enableTooltip}\n        tooltipScale={tooltipScale}\n      />\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":47,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-avatar/AuthAvatar.tsx":{
    "content":"'use client';\n\nimport { useAtom } from 'jotai';\nimport { useSession } from 'next-auth/react';\nimport { useEffect, useRef } from 'react';\nimport { avatarCacheAtom } from '../../../lib/state/atoms';\nimport { Avatar, AvatarPropSizes } from '../avatar/Avatar';\n\ninterface AuthAvatarProps {\n  size?: AvatarPropSizes;\n  enableTooltip?: boolean;\n  tooltipScale?: 2 | 3 | 4;\n  className?: string;\n}\n\n/**\n * Avatar component specifically for the currently authenticated user.\n * Uses the user's ID as a consistent seed to ensure the avatar\n * appearance remains the same across all parts of the application.\n */\nexport function AuthAvatar({\n  size = 'md',\n  enableTooltip = false,\n  tooltipScale = 2,\n  className = ''\n}: AuthAvatarProps) {\n  const { data: session, status } = useSession();\n  const [avatarCache, setAvatarCache] = useAtom(avatarCacheAtom);\n  const previousUserIdRef = useRef<string | null>(null);\n\n  // Clear avatar cache when user signs out\n  useEffect(() => {\n    const currentUserId = session?.user?.id || null;\n    const previousUserId = previousUserIdRef.current;\n\n    // If we had a user before and now we don't (sign out), clear the cache\n    if (previousUserId && !currentUserId) {\n      // eslint-disable-next-line no-console\n      console.log('\ud83e\uddf9 Clearing avatar cache on sign out');\n      setAvatarCache({});\n    }\n\n    // Update the ref for next comparison\n    previousUserIdRef.current = currentUserId;\n  }, [session?.user?.id, setAvatarCache]);\n\n  // Additional effect to ensure cache is cleared when session becomes null\n  useEffect(() => {\n    if (!session) {\n      // eslint-disable-next-line no-console\n      console.log('\ud83e\uddf9 Clearing avatar cache - no session detected');\n      setAvatarCache({});\n    }\n  }, [session, setAvatarCache]);\n\n  // Don't render until session status is determined to avoid hydration mismatch\n  if (status === 'loading') {\n    return (\n      <div className={className} style={{ width: '2rem', height: '2rem' }} />\n    );\n  }\n\n  // Use user ID as the primary seed for consistency\n  // For unauthenticated users, use a static seed to avoid hydration issues\n  const seed = session?.user?.id\n    ? session.user.id ||\n      session.user.name ||\n      session.user.email ||\n      'authenticated-fallback'\n    : 'guest-user';\n\n  return (\n    <div className={className}>\n      <Avatar\n        key={session?.user?.id || 'guest'}\n        seed={seed}\n        size={size}\n        enableTooltip={enableTooltip}\n        tooltipScale={tooltipScale}\n      />\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":84,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-avatar/AuthAvatar.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport { useAtom } from 'jotai';\nimport { useSession } from 'next-auth/react';\nimport { AVATAR_SELECTORS } from '../../../lib/test-selectors/components/avatar.selectors';\nimport { AuthAvatar } from './AuthAvatar';\n\n// Mock next-auth/react\njest.mock('next-auth/react', () => ({\n  useSession: jest.fn()\n}));\n\n// Mock jotai\njest.mock('jotai', () => ({\n  useAtom: jest.fn(),\n  atom: jest.fn()\n}));\n\n// Mock the atoms module to avoid import issues\njest.mock('../../../lib/state/atoms', () => ({\n  avatarCacheAtom: {}\n}));\n\n// Mock the Avatar component\njest.mock('../avatar/Avatar', () => {\n  return {\n    __esModule: true,\n    Avatar: jest.fn(({ seed, size }) => (\n      <div data-testid={AVATAR_SELECTORS.CONTAINER}>\n        Mock Avatar: {seed}, {size}\n      </div>\n    ))\n  };\n});\n\nconst mockUseSession = useSession as jest.Mock;\nconst mockUseAtom = useAtom as jest.Mock;\n\ndescribe('AuthAvatar', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // Mock avatar cache atom\n    mockUseAtom.mockReturnValue([{}, jest.fn()]);\n  });\n\n  it('renders Avatar with user ID as seed when session exists', () => {\n    const mockSession = {\n      user: {\n        id: 'user-123',\n        name: 'Test User',\n        email: 'test@example.com'\n      }\n    };\n    mockUseSession.mockReturnValue({ data: mockSession });\n\n    render(<AuthAvatar size=\\\"md\\\" />);\n\n    const avatarElement = screen.getByTestId(AVATAR_SELECTORS.CONTAINER);\n    expect(avatarElement).toBeInTheDocument();\n    expect(avatarElement).toHaveTextContent('Mock Avatar: user-123, md');\n  });\n\n  it('renders Avatar with guest seed when ID is not available', () => {\n    const mockSession = {\n      user: {\n        name: 'Test User',\n        email: 'test@example.com'\n        // No ID provided\n      }\n    };\n    mockUseSession.mockReturnValue({ data: mockSession });\n\n    render(<AuthAvatar size=\\\"sm\\\" />);\n\n    const avatarElement = screen.getByTestId(AVATAR_SELECTORS.CONTAINER);\n    expect(avatarElement).toBeInTheDocument();\n    // When there's no user ID, it defaults to 'guest-user'\n    expect(avatarElement).toHaveTextContent('Mock Avatar: guest-user, sm');\n  });\n\n  it('renders Avatar with guest seed when ID and name are not available', () => {\n    const mockSession = {\n      user: {\n        email: 'test@example.com'\n        // No ID or name provided\n      }\n    };\n    mockUseSession.mockReturnValue({ data: mockSession });\n\n    render(<AuthAvatar size=\\\"lg\\\" />);\n\n    const avatarElement = screen.getByTestId(AVATAR_SELECTORS.CONTAINER);\n    expect(avatarElement).toBeInTheDocument();\n    // When there's no user ID, it defaults to 'guest-user'\n    expect(avatarElement).toHaveTextContent('Mock Avatar: guest-user, lg');\n  });\n\n  it('renders Avatar with random guest seed when no session exists', () => {\n    mockUseSession.mockReturnValue({ data: null });\n\n    render(<AuthAvatar size=\\\"xs\\\" />);\n\n    const avatarElement = screen.getByTestId(AVATAR_SELECTORS.CONTAINER);\n    expect(avatarElement).toBeInTheDocument();\n    // Should contain \\\"guest-\\\" prefix but the rest is random\n    expect(avatarElement.textContent).toMatch(/Mock Avatar: guest-.+, xs/);\n  });\n\n  it('renders Avatar with guest seed when ID is empty string', () => {\n    const mockSession = {\n      user: {\n        id: '', // Empty ID (falsy)\n        name: 'Test User',\n        email: 'test@example.com'\n      }\n    };\n    mockUseSession.mockReturnValue({ data: mockSession });\n\n    render(<AuthAvatar size=\\\"md\\\" />);\n\n    const avatarElement = screen.getByTestId(AVATAR_SELECTORS.CONTAINER);\n    expect(avatarElement).toBeInTheDocument();\n    // When ID is empty string (falsy), it defaults to 'guest-user'\n    expect(avatarElement).toHaveTextContent('Mock Avatar: guest-user, md');\n  });\n\n  it('passes through props correctly', () => {\n    const mockSession = {\n      user: {\n        id: 'user-123'\n      }\n    };\n    mockUseSession.mockReturnValue({ data: mockSession });\n\n    render(<AuthAvatar size=\\\"xxs\\\" enableTooltip={true} tooltipScale={3} />);\n\n    const avatarElement = screen.getByTestId(AVATAR_SELECTORS.CONTAINER);\n    expect(avatarElement).toBeInTheDocument();\n    expect(avatarElement).toHaveTextContent('Mock Avatar: user-123, xxs');\n  });\n});\n",
    "language":"typescript",
    "lines":141,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/header/Header.tsx":{
    "content":"import Nav from '../nav/Nav';\nimport './Header.css';\n\nexport default async function Header() {\n  return (\n    <header className=\\\"header\\\">\n      <Nav />\n    </header>\n  );\n}\n",
    "language":"typescript",
    "lines":11,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/header/Header.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport Header from './Header';\n\n// Mock the Nav component\njest.mock('../nav/Nav', () => {\n  return function MockNav() {\n    return <div data-testid=\\\"mock-nav\\\">Mock Nav</div>;\n  };\n});\n\ndescribe('Header', () => {\n  it('renders without crashing', async () => {\n    render(await Header());\n  });\n\n  it('has the correct CSS class', async () => {\n    const { container } = render(await Header());\n    expect(container.firstChild).toHaveClass('header');\n  });\n\n  it('renders the Nav component', async () => {\n    render(await Header());\n    const navElement = screen.getByTestId('mock-nav');\n    expect(navElement).toBeInTheDocument();\n  });\n\n  it('is wrapped in a header tag', async () => {\n    const { container } = render(await Header());\n    expect(container.firstChild?.nodeName).toBe('HEADER');\n  });\n});\n",
    "language":"typescript",
    "lines":32,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/about/About.test.tsx":{
    "content":"import { NAV_PATHS } from '../../../lib/routes';\nimport { ABOUT_PAGE_SELECTORS } from '../../../lib/test-selectors/pages/about.selectors';\nimport { render, screen } from '../../../test-utils';\nimport { About } from './About';\n\ndescribe('Page', () => {\n  it('renders the about page', () => {\n    render(<About />);\n\n    screen.findByRole('heading');\n\n    expect(screen.getByTestId(ABOUT_PAGE_SELECTORS.ROOT_LINK))\n      .toBeVisible()\n      .toBeEnabled()\n      .toHaveAttribute('href', NAV_PATHS.ROOT)\n      .not.toHaveAttribute('target', '_blank');\n\n    const gitlabLink = screen.getByText(/gitlab/i, { selector: 'a' });\n    expect(gitlabLink)\n      .toBeVisible()\n      .toBeEnabled()\n      .toHaveAttribute('href', 'https://gitlab.com/idling.app')\n      .toHaveAttribute('target', '_blank');\n  });\n});\n",
    "language":"typescript",
    "lines":26,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/about/About.tsx":{
    "content":"import { NAV_PATHS } from '../../../lib/routes';\nimport { ABOUT_PAGE_SELECTORS } from '../../../lib/test-selectors/pages/about.selectors';\nimport { DiscordLink } from '../discord-link/DiscordLink';\nimport { GalaxyLink } from '../galaxy-link/GalaxyLink';\nimport { LinkTooltip } from '../tooltip/LinkTooltip';\nimport { InstantLink } from '../ui/InstantLink';\n\nexport function About() {\n  return (\n    <div>\n      <p>\n        <LinkTooltip url={NAV_PATHS.ROOT} isInsideParagraph>\n          {/* eslint-disable-next-line custom-rules/enforce-link-target-blank */}\n          <InstantLink\n            data-testid={ABOUT_PAGE_SELECTORS.ROOT_LINK}\n            href={NAV_PATHS.ROOT}\n          >\n            idling.app\n          </InstantLink>\n        </LinkTooltip>\n        &nbsp;serves as the central hub for my professional portfolio and\n        personal projects, showcasing my expertise in front-end web development\n        and interactive 3D applications. The platform hosts a collection of\n        innovative web applications, with&nbsp;\n        <GalaxyLink />\n        &nbsp;standing as a flagship project that demonstrates advanced 3D space\n        visualization capabilities.\n      </p>\n      <br />\n      <p>\n        <GalaxyLink />\n        &nbsp;represents a cutting-edge web application that leverages modern\n        web technologies to create immersive space environments. The application\n        features procedurally generated galaxies with dynamic star fields,\n        realistic nebula effects, and interactive space environments. Built with\n        Three.js and TypeScript, <GalaxyLink />\n        &nbsp;showcases sophisticated particle systems, advanced rendering\n        techniques, and responsive user interfaces.\n      </p>\n      <br />\n      <p>\n        All publicly available projects can be accessed through the\n        website&apos;s navigation, while active development discussions and\n        updates are hosted on the idling.app{' '}\n        <DiscordLink isInsideParagraph={true} /> server. For detailed technical\n        documentation, release notes, and contribution guidelines, please refer\n        to the project&apos;s&nbsp;\n        <a\n          href=\\\"https://gitlab.com/idling.app\\\"\n          target=\\\"_blank\\\"\n          rel=\\\"noopener noreferrer\\\"\n        >\n          GitLab\n        </a>\n        &nbsp;repository.\n      </p>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":60,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/skeleton/SmartSkeletonLoader.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport './SkeletonLoader.css';\n\n// Development-only import that gets tree-shaken in production\nlet useDevSkeletonState: () => {\n  shouldShowSkeleton: boolean;\n  isDevModeActive: boolean;\n};\n\nif (process.env.NODE_ENV === 'development') {\n  const devModule = require('../dev-tools/DevSkeletonToggle');\n  useDevSkeletonState = devModule.useDevSkeletonState;\n} else {\n  // Production fallback - returns inactive state\n  useDevSkeletonState = () => ({\n    shouldShowSkeleton: false,\n    isDevModeActive: false\n  });\n}\n\n// Base skeleton components\nexport const SkeletonText: React.FC<{\n  width?: string | number;\n  height?: string | number;\n  className?: string;\n  style?: React.CSSProperties;\n}> = ({ width = '100%', height = '1rem', className = '', style = {} }) => (\n  <div\n    className={`skeleton skeleton--text ${className}`}\n    style={{\n      width: typeof width === 'number' ? `${width}px` : width,\n      height: typeof height === 'number' ? `${height}px` : height,\n      ...style\n    }}\n  />\n);\n\nexport const SkeletonBox: React.FC<{\n  width?: string | number;\n  height?: string | number;\n  className?: string;\n  style?: React.CSSProperties;\n}> = ({ width = '100%', height = '100px', className = '', style = {} }) => (\n  <div\n    className={`skeleton skeleton--box ${className}`}\n    style={{\n      width: typeof width === 'number' ? `${width}px` : width,\n      height: typeof height === 'number' ? `${height}px` : height,\n      ...style\n    }}\n  />\n);\n\nexport const SkeletonCircle: React.FC<{\n  size?: string | number;\n  className?: string;\n}> = ({ size = '40px', className = '' }) => (\n  <div\n    className={`skeleton skeleton--circle ${className}`}\n    style={{\n      width: typeof size === 'number' ? `${size}px` : size,\n      height: typeof size === 'number' ? `${size}px` : size\n    }}\n  />\n);\n\n// Enhanced element analysis that preserves exact DOM structure\ninterface SkeletonElementInfo {\n  tagName: string;\n  type: 'element' | 'text';\n  skeletonType:\n    | 'text'\n    | 'box'\n    | 'circle'\n    | 'button'\n    | 'input'\n    | 'image'\n    | 'container';\n  rect: {\n    width: number;\n    height: number;\n  };\n  styles: {\n    [key: string]: string | number;\n  };\n  className: string;\n  children: SkeletonElementInfo[];\n  textContent?: string;\n  hasSignificantContent: boolean;\n}\n\nconst getAllLayoutStyles = (\n  element: Element\n): Record<string, string | number> => {\n  const computedStyle = window.getComputedStyle(element);\n\n  // Capture all layout-affecting properties\n  return {\n    display: computedStyle.display,\n    position: computedStyle.position,\n    flexDirection: computedStyle.flexDirection,\n    flexWrap: computedStyle.flexWrap,\n    justifyContent: computedStyle.justifyContent,\n    alignItems: computedStyle.alignItems,\n    alignContent: computedStyle.alignContent,\n    gap: computedStyle.gap,\n    gridTemplateColumns: computedStyle.gridTemplateColumns,\n    gridTemplateRows: computedStyle.gridTemplateRows,\n    gridGap: computedStyle.gridGap,\n    padding: computedStyle.padding,\n    paddingTop: computedStyle.paddingTop,\n    paddingRight: computedStyle.paddingRight,\n    paddingBottom: computedStyle.paddingBottom,\n    paddingLeft: computedStyle.paddingLeft,\n    margin: computedStyle.margin,\n    marginTop: computedStyle.marginTop,\n    marginRight: computedStyle.marginRight,\n    marginBottom: computedStyle.marginBottom,\n    marginLeft: computedStyle.marginLeft,\n    borderRadius: computedStyle.borderRadius,\n    border: computedStyle.border,\n    borderTop: computedStyle.borderTop,\n    borderRight: computedStyle.borderRight,\n    borderBottom: computedStyle.borderBottom,\n    borderLeft: computedStyle.borderLeft,\n    width: computedStyle.width,\n    height: computedStyle.height,\n    minWidth: computedStyle.minWidth,\n    minHeight: computedStyle.minHeight,\n    maxWidth: computedStyle.maxWidth,\n    maxHeight: computedStyle.maxHeight,\n    boxSizing: computedStyle.boxSizing,\n    overflow: computedStyle.overflow,\n    overflowX: computedStyle.overflowX,\n    overflowY: computedStyle.overflowY,\n    fontSize: computedStyle.fontSize,\n    lineHeight: computedStyle.lineHeight,\n    fontWeight: computedStyle.fontWeight,\n    textAlign: computedStyle.textAlign,\n    verticalAlign: computedStyle.verticalAlign,\n    float: computedStyle.float,\n    clear: computedStyle.clear,\n    zIndex: computedStyle.zIndex,\n    background: computedStyle.background,\n    backgroundColor: computedStyle.backgroundColor,\n    opacity: computedStyle.opacity,\n    transform: computedStyle.transform,\n    transition: computedStyle.transition\n  };\n};\n\nconst getElementSkeletonType = (\n  element: Element\n): SkeletonElementInfo['skeletonType'] => {\n  const tagName = element.tagName.toLowerCase();\n  const rect = element.getBoundingClientRect();\n\n  // Images and avatars should be circles\n  if (\n    tagName === 'img' ||\n    element.classList.contains('avatar') ||\n    element.classList.contains('profile-image') ||\n    element.classList.contains('profile-pic')\n  ) {\n    return 'circle';\n  }\n\n  // SVG icons should be circles\n  if (tagName === 'svg' || element.classList.contains('icon')) {\n    return 'circle';\n  }\n\n  // Form elements\n  if (tagName === 'input' || tagName === 'textarea' || tagName === 'select') {\n    return 'input';\n  }\n\n  // Buttons\n  if (\n    tagName === 'button' ||\n    element.getAttribute('role') === 'button' ||\n    element.classList.contains('button') ||\n    element.classList.contains('btn')\n  ) {\n    return 'button';\n  }\n\n  // Text elements - check if it has text content and is not too tall\n  if (\n    tagName === 'p' ||\n    tagName === 'span' ||\n    tagName === 'a' ||\n    tagName === 'h1' ||\n    tagName === 'h2' ||\n    tagName === 'h3' ||\n    tagName === 'h4' ||\n    tagName === 'h5' ||\n    tagName === 'h6' ||\n    tagName === 'label' ||\n    tagName === 'li' ||\n    tagName === 'td' ||\n    tagName === 'th' ||\n    element.classList.contains('text')\n  ) {\n    return 'text';\n  }\n\n  // If it's small and has text content, treat as text\n  if (\n    rect.height <= 60 &&\n    element.textContent?.trim() &&\n    element.children.length === 0\n  ) {\n    return 'text';\n  }\n\n  // Check if it's a pure container (has children but no direct text content)\n  const hasChildren = element.children.length > 0;\n  const hasDirectText =\n    element.childNodes.length > 0 &&\n    Array.from(element.childNodes).some(\n      (node) =>\n        node.nodeType === Node.TEXT_NODE && Boolean(node.textContent?.trim())\n    );\n\n  // More intelligent container detection\n  if (hasChildren) {\n    // If it's very tall, it's likely a layout container that should be analyzed\n    if (rect.height > 200) {\n      return 'container';\n    }\n\n    // If it has no direct text and is a structural element, it's a container\n    if (\n      !hasDirectText &&\n      (tagName === 'div' ||\n        tagName === 'section' ||\n        tagName === 'article' ||\n        tagName === 'main' ||\n        tagName === 'aside' ||\n        tagName === 'header' ||\n        tagName === 'footer' ||\n        tagName === 'nav' ||\n        tagName === 'ul' ||\n        tagName === 'ol' ||\n        element.classList.contains('container') ||\n        element.classList.contains('wrapper') ||\n        element.classList.contains('list'))\n    ) {\n      return 'container';\n    }\n\n    // If it has flex or grid display, it's likely a container\n    const computedStyle = window.getComputedStyle(element);\n    if (computedStyle.display === 'flex' || computedStyle.display === 'grid') {\n      return 'container';\n    }\n\n    // If it has both children and direct text, treat as mixed content (not pure container)\n    if (hasDirectText) {\n      return 'box'; // Will be handled in mixed content logic\n    }\n  }\n\n  // Default to box for everything else\n  return 'box';\n};\n\nconst shouldSkipElement = (element: Element | Node): boolean => {\n  // Skip text nodes that are only whitespace\n  if (element.nodeType === Node.TEXT_NODE) {\n    return !element.textContent?.trim();\n  }\n\n  if (element.nodeType !== Node.ELEMENT_NODE) {\n    return true;\n  }\n\n  const el = element as Element;\n  const tagName = el.tagName.toLowerCase();\n\n  // Skip these tags entirely\n  const skipTags = [\n    'script',\n    'style',\n    'noscript',\n    'meta',\n    'link',\n    'title',\n    'head'\n  ];\n  if (skipTags.includes(tagName)) return true;\n\n  // Skip elements with no visual impact\n  const rect = el.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return true;\n\n  const computedStyle = window.getComputedStyle(el);\n  if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden')\n    return true;\n\n  // Skip very large page-level containers that are just wrappers\n  if (\n    rect.height > window.innerHeight * 0.8 &&\n    (tagName === 'main' ||\n      tagName === 'body' ||\n      el.classList.contains('page') ||\n      el.classList.contains('app') ||\n      el.classList.contains('layout'))\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\nconst analyzeElementStructure = (element: Element): SkeletonElementInfo => {\n  const rect = element.getBoundingClientRect();\n  const tagName = element.tagName.toLowerCase();\n  const styles = getAllLayoutStyles(element);\n  const skeletonType = getElementSkeletonType(element);\n\n  // Check if element has significant content\n  const hasSignificantContent =\n    rect.width > 0 &&\n    rect.height > 0 &&\n    (Boolean(element.textContent?.trim()) ||\n      element.children.length > 0 ||\n      ['img', 'input', 'button', 'svg'].includes(tagName));\n\n  // Analyze all child nodes (including text nodes)\n  const children: SkeletonElementInfo[] = [];\n\n  for (const child of Array.from(element.childNodes)) {\n    if (shouldSkipElement(child)) continue;\n\n    if (child.nodeType === Node.TEXT_NODE) {\n      const textContent = child.textContent?.trim();\n      if (textContent) {\n        // Create a virtual text element\n        children.push({\n          tagName: '#text',\n          type: 'text',\n          skeletonType: 'text',\n          rect: { width: 0, height: 0 }, // Will be estimated\n          styles: {},\n          className: '',\n          children: [],\n          textContent,\n          hasSignificantContent: true\n        });\n      }\n    } else if (child.nodeType === Node.ELEMENT_NODE) {\n      const childInfo = analyzeElementStructure(child as Element);\n      if (childInfo.hasSignificantContent) {\n        children.push(childInfo);\n      }\n    }\n  }\n\n  return {\n    tagName,\n    type: 'element',\n    skeletonType,\n    rect: {\n      width: rect.width,\n      height: rect.height\n    },\n    styles,\n    className: element.className || '',\n    children,\n    textContent: element.textContent?.trim(),\n    hasSignificantContent\n  };\n};\n\nconst generateRealisticSkeleton = (\n  elementInfo: SkeletonElementInfo,\n  key: string = ''\n): React.ReactNode => {\n  const {\n    tagName,\n    skeletonType,\n    rect,\n    styles,\n    className,\n    children,\n    textContent\n  } = elementInfo;\n\n  // Create base style object preserving layout\n  const skeletonStyle: React.CSSProperties = {\n    ...styles,\n    // Override size properties to use measured values for leaf elements\n    ...(children.length === 0 && {\n      width: rect.width > 0 ? `${rect.width}px` : styles.width,\n      height: rect.height > 0 ? `${rect.height}px` : styles.height\n    })\n  };\n\n  // For containers, preserve all layout properties\n  if (skeletonType === 'container' && children.length > 0) {\n    return (\n      <div\n        key={key}\n        className={`skeleton-replica skeleton-replica--container ${className}`}\n        style={skeletonStyle}\n      >\n        {children.map((child, index) =>\n          generateRealisticSkeleton(child, `${key}-${index}`)\n        )}\n      </div>\n    );\n  }\n\n  // For text nodes, create appropriately sized text skeletons\n  if (tagName === '#text' && textContent) {\n    // Estimate text dimensions based on content length and typical character width\n    const charWidth = 8; // Average character width in pixels\n    const lineHeight = 20; // Average line height\n    const words = textContent.split(/\\\\s+/);\n    const estimatedWidth = Math.min(words.join('').length * charWidth, 300);\n\n    return (\n      <SkeletonText\n        key={key}\n        width={estimatedWidth}\n        height={lineHeight}\n        className=\\\"skeleton--auto skeleton--text-node\\\"\n      />\n    );\n  }\n\n  // For other elements, create appropriate skeleton based on type\n  const baseClassName = `skeleton--auto skeleton--${skeletonType}`;\n\n  switch (skeletonType) {\n    case 'circle':\n      return (\n        <div\n          key={key}\n          style={skeletonStyle}\n          className={`skeleton-replica ${className}`}\n        >\n          <SkeletonCircle\n            size={Math.min(rect.width, rect.height)}\n            className={baseClassName}\n          />\n        </div>\n      );\n\n    case 'text':\n      return (\n        <div\n          key={key}\n          style={skeletonStyle}\n          className={`skeleton-replica ${className}`}\n        >\n          <SkeletonText width=\\\"100%\\\" height=\\\"1em\\\" className={baseClassName} />\n        </div>\n      );\n\n    case 'button':\n      return (\n        <div\n          key={key}\n          style={skeletonStyle}\n          className={`skeleton-replica ${className}`}\n        >\n          <SkeletonBox\n            width=\\\"100%\\\"\n            height=\\\"100%\\\"\n            className={`${baseClassName} skeleton--button-auto`}\n          />\n        </div>\n      );\n\n    case 'input':\n      return (\n        <div\n          key={key}\n          style={skeletonStyle}\n          className={`skeleton-replica ${className}`}\n        >\n          <SkeletonBox\n            width=\\\"100%\\\"\n            height=\\\"100%\\\"\n            className={`${baseClassName} skeleton--input-auto`}\n          />\n        </div>\n      );\n\n    default:\n      // For 'box' type elements, be smarter about whether to render structure or solid box\n      if (children.length > 0) {\n        // If it's a large element with children, analyze the structure\n        if (rect.height > 100 || rect.width > 300) {\n          return (\n            <div\n              key={key}\n              className={`skeleton-replica skeleton-replica--mixed ${className}`}\n              style={skeletonStyle}\n            >\n              {children.map((child, index) =>\n                generateRealisticSkeleton(child, `${key}-${index}`)\n              )}\n            </div>\n          );\n        }\n        // For smaller elements with children, render as a structured box but still show children\n        else {\n          return (\n            <div\n              key={key}\n              className={`skeleton-replica skeleton-replica--mixed ${className}`}\n              style={skeletonStyle}\n            >\n              {children.map((child, index) =>\n                generateRealisticSkeleton(child, `${key}-${index}`)\n              )}\n            </div>\n          );\n        }\n      } else {\n        // Only render as solid box if it's small and has no children\n        if (rect.height <= 100 && rect.width <= 300) {\n          return (\n            <div\n              key={key}\n              style={skeletonStyle}\n              className={`skeleton-replica ${className}`}\n            >\n              <SkeletonBox\n                width=\\\"100%\\\"\n                height=\\\"100%\\\"\n                className={baseClassName}\n              />\n            </div>\n          );\n        } else {\n          // For large elements with no children, create a more reasonable skeleton\n          return (\n            <div\n              key={key}\n              style={skeletonStyle}\n              className={`skeleton-replica ${className}`}\n            >\n              <SkeletonBox\n                width=\\\"100%\\\"\n                height=\\\"60px\\\"\n                className={baseClassName}\n              />\n            </div>\n          );\n        }\n      }\n  }\n};\n\n// Smart Skeleton Hook\nexport const useSmartSkeleton = (targetRef: React.RefObject<HTMLElement>) => {\n  const [skeletonContent, setSkeletonContent] = useState<React.ReactNode>(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [capturedLayout, setCapturedLayout] =\n    useState<SkeletonElementInfo | null>(null);\n\n  const captureLayout = () => {\n    if (!targetRef.current) {\n      return;\n    }\n\n    setIsAnalyzing(true);\n\n    try {\n      // Small delay to ensure DOM is stable\n      setTimeout(() => {\n        if (targetRef.current) {\n          // Analysis starting\n          const elementInfo = analyzeElementStructure(targetRef.current);\n          setCapturedLayout(elementInfo);\n\n          const skeleton = generateRealisticSkeleton(elementInfo, 'root');\n          setSkeletonContent(skeleton);\n\n          // Analysis completed\n        }\n        setIsAnalyzing(false);\n      }, 100);\n    } catch (error) {\n      setIsAnalyzing(false);\n    }\n  };\n\n  const clearCapture = () => {\n    setCapturedLayout(null);\n    setSkeletonContent(null);\n    setIsAnalyzing(false);\n  };\n\n  return {\n    skeletonContent,\n    isAnalyzing,\n    capturedLayout,\n    captureLayout,\n    clearCapture\n  };\n};\n\n// Main Smart Skeleton Loader Component\ninterface SmartSkeletonLoaderProps {\n  targetRef: React.RefObject<HTMLElement>;\n  isLoading?: boolean;\n  forceShow?: boolean;\n  fallback?: React.ReactNode;\n  onAnalysisComplete?: (elementInfo: SkeletonElementInfo) => void;\n  className?: string;\n}\n\nexport const SmartSkeletonLoader: React.FC<SmartSkeletonLoaderProps> = ({\n  targetRef,\n  isLoading = true,\n  forceShow = false,\n  fallback = null,\n  onAnalysisComplete,\n  className = ''\n}) => {\n  const { skeletonContent, isAnalyzing, capturedLayout, captureLayout } =\n    useSmartSkeleton(targetRef);\n  const [shouldAutoCapture, setShouldAutoCapture] = useState(true);\n\n  // Get development mode state\n  const { shouldShowSkeleton, isDevModeActive } = useDevSkeletonState();\n\n  // Determine if skeleton should be visible\n  const shouldShow = (() => {\n    if (process.env.NODE_ENV === 'development' && isDevModeActive) {\n      return shouldShowSkeleton;\n    }\n    return forceShow || isLoading;\n  })();\n\n  // Auto-capture when target becomes available and we need to show skeleton\n  useEffect(() => {\n    if (\n      shouldShow &&\n      !capturedLayout &&\n      !isAnalyzing &&\n      shouldAutoCapture &&\n      targetRef.current\n    ) {\n      captureLayout();\n      setShouldAutoCapture(false); // Prevent repeated captures\n    }\n  }, [\n    shouldShow,\n    capturedLayout,\n    isAnalyzing,\n    shouldAutoCapture,\n    targetRef,\n    captureLayout\n  ]);\n\n  // Call callback when analysis completes\n  useEffect(() => {\n    if (capturedLayout && onAnalysisComplete) {\n      onAnalysisComplete(capturedLayout);\n    }\n  }, [capturedLayout, onAnalysisComplete]);\n\n  // Reset auto-capture when loading state changes\n  useEffect(() => {\n    if (!isLoading) {\n      setShouldAutoCapture(true);\n    }\n  }, [isLoading]);\n\n  if (!shouldShow) {\n    return null;\n  }\n\n  if (isAnalyzing) {\n    return (\n      <div className={`skeleton-container skeleton--analyzing ${className}`}>\n        <SkeletonBox width=\\\"100%\\\" height=\\\"50px\\\" />\n        <SkeletonText width=\\\"80%\\\" height=\\\"1rem\\\" />\n        <SkeletonText width=\\\"60%\\\" height=\\\"1rem\\\" />\n      </div>\n    );\n  }\n\n  if (skeletonContent) {\n    return (\n      <div\n        className={`skeleton-container--smart ${className}`}\n        role=\\\"status\\\"\n        aria-label=\\\"Loading content\\\"\n      >\n        {skeletonContent}\n      </div>\n    );\n  }\n\n  // Fallback skeleton\n  return (\n    <div\n      className={`skeleton-container ${className}`}\n      role=\\\"status\\\"\n      aria-label=\\\"Loading content\\\"\n    >\n      {fallback || (\n        <>\n          <SkeletonBox width=\\\"100%\\\" height=\\\"50px\\\" />\n          <SkeletonText width=\\\"80%\\\" height=\\\"1rem\\\" />\n          <SkeletonText width=\\\"60%\\\" height=\\\"1rem\\\" />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default SmartSkeletonLoader;\n",
    "language":"typescript",
    "lines":724,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/skeleton/useSmartPostsSkeleton.tsx":{
    "content":"'use client';\n\nimport { useEffect, useRef, useState } from 'react';\nimport { SkeletonLoader, SkeletonText } from './SkeletonLoader';\n\n// Development-only import that gets tree-shaken in production\nlet useDevSkeletonState: () => {\n  shouldShowSkeleton: boolean;\n  isDevModeActive: boolean;\n};\n\nif (process.env.NODE_ENV === 'development') {\n  const devModule = require('../dev-tools/DevSkeletonToggle');\n  useDevSkeletonState = devModule.useDevSkeletonState;\n} else {\n  // Production fallback - returns inactive state\n  useDevSkeletonState = () => ({\n    shouldShowSkeleton: false,\n    isDevModeActive: false\n  });\n}\n\ninterface PostsSkeletonConfig {\n  submissionCount?: number;\n  showPagination?: boolean;\n  enableThreadMode?: boolean;\n}\n\n// Pre-built skeleton for submission cards\nconst SubmissionCardSkeleton = ({\n  enableThreadMode = false\n}: {\n  enableThreadMode?: boolean;\n}) => (\n  <div className=\\\"skeleton--submission-card\\\">\n    {/* Meta row - author and date - match submission__meta spacing */}\n    <div\n      style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        marginBottom: '0.5rem' /* Match submission__meta margin-bottom */\n      }}\n    >\n      <SkeletonText width=\\\"120px\\\" height=\\\"0.875rem\\\" />\n      <SkeletonText width=\\\"100px\\\" height=\\\"0.875rem\\\" />\n    </div>\n\n    {/* Content section - match submission__content */}\n    <div style={{ marginBottom: '0.75rem' }}>\n      {/* Title - match submission__title */}\n      <SkeletonText\n        width=\\\"85%\\\"\n        height=\\\"1.125rem\\\"\n        style={{ marginBottom: '0.5rem' }}\n      />\n\n      {/* Description (sometimes) - match submission__description */}\n      {Math.random() > 0.3 && <SkeletonText width=\\\"100%\\\" height=\\\"0.95rem\\\" />}\n    </div>\n\n    {/* Tags - match submission__tags spacing */}\n    <div\n      style={{\n        display: 'flex',\n        gap: '0.5rem',\n        marginBottom: '0.75rem',\n        flexWrap: 'wrap'\n      }}\n    >\n      {Array.from({ length: Math.floor(Math.random() * 4) + 1 }, (_, i) => (\n        <SkeletonText\n          key={i}\n          width={`${Math.random() * 60 + 40}px`}\n          height=\\\"1.5rem\\\"\n          style={{ borderRadius: '0.25rem' }}\n        />\n      ))}\n    </div>\n\n    {/* Actions - match submission__actions spacing */}\n    <div\n      style={{\n        display: 'flex',\n        gap: '0.75rem',\n        alignItems: 'center',\n        marginBottom: '0.5rem' /* Match submission__actions margin-bottom */\n      }}\n    >\n      <SkeletonText\n        width=\\\"60px\\\"\n        height=\\\"1.75rem\\\"\n        style={{ borderRadius: '0.25rem' }}\n      />\n      {Math.random() > 0.5 && (\n        <SkeletonText\n          width=\\\"80px\\\"\n          height=\\\"1.75rem\\\"\n          style={{ borderRadius: '0.25rem' }}\n        />\n      )}\n    </div>\n\n    {/* Thread replies (if expanded) */}\n    {enableThreadMode && Math.random() > 0.7 && (\n      <div style={{ marginTop: '1rem', marginLeft: '2rem' }}>\n        <div\n          className=\\\"skeleton--submission-card\\\"\n          style={{ marginBottom: '0.5rem' }}\n        >\n          <div\n            style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: '0.5rem'\n            }}\n          >\n            <SkeletonText width=\\\"100px\\\" height=\\\"0.8rem\\\" />\n            <SkeletonText width=\\\"80px\\\" height=\\\"0.8rem\\\" />\n          </div>\n          <SkeletonText width=\\\"90%\\\" height=\\\"1rem\\\" className=\\\"mb-2\\\" />\n          <SkeletonText width=\\\"70%\\\" height=\\\"0.875rem\\\" />\n        </div>\n      </div>\n    )}\n  </div>\n);\n\n// Pagination skeleton - now just the inner content since wrapper is added separately\nconst PaginationSkeleton = () => (\n  <>\n    <SkeletonText width=\\\"100px\\\" height=\\\"1.4rem\\\" />\n    <div style={{ display: 'flex', gap: '0.75rem', alignItems: 'center' }}>\n      <SkeletonText\n        width=\\\"80px\\\"\n        height=\\\"2.5rem\\\"\n        style={{ borderRadius: '0.5rem' }}\n      />\n      <SkeletonText\n        width=\\\"4rem\\\"\n        height=\\\"2.5rem\\\"\n        style={{ borderRadius: '0.5rem' }}\n      />\n      <SkeletonText\n        width=\\\"80px\\\"\n        height=\\\"2.5rem\\\"\n        style={{ borderRadius: '0.5rem' }}\n      />\n    </div>\n    <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n      <SkeletonText width=\\\"50px\\\" height=\\\"1.4rem\\\" />\n      <SkeletonText\n        width=\\\"4rem\\\"\n        height=\\\"2.5rem\\\"\n        style={{ borderRadius: '0.5rem' }}\n      />\n    </div>\n  </>\n);\n\nexport const useSmartPostsSkeleton = () => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [capturedLayout, setCapturedLayout] =\n    useState<PostsSkeletonConfig | null>(null);\n  const [isCapturing, setIsCapturing] = useState(false);\n\n  // Get development mode state\n  const { shouldShowSkeleton, isDevModeActive } = useDevSkeletonState();\n\n  const captureCurrentLayout = () => {\n    if (!containerRef.current) return null;\n\n    setIsCapturing(true);\n\n    try {\n      // Analyze the current posts list structure\n      const submissionElements = containerRef.current.querySelectorAll(\n        '.submission__wrapper, .submission-thread'\n      );\n      const paginationElement = containerRef.current.querySelector(\n        '.submissions-list__pagination'\n      );\n      const threadElements =\n        containerRef.current.querySelectorAll('.submission-thread');\n\n      const config: PostsSkeletonConfig = {\n        submissionCount: Math.max(submissionElements.length, 3), // At least 3 for good UX\n        showPagination: !!paginationElement,\n        enableThreadMode: threadElements.length > 0\n      };\n\n      setCapturedLayout(config);\n\n      // eslint-disable-next-line no-console\n      console.log('\ud83d\udcf8 [SKELETON] Captured layout:', config);\n\n      return config;\n    } catch (error) {\n      console.warn('Failed to capture layout:', error);\n      // Default fallback\n      const fallback: PostsSkeletonConfig = {\n        submissionCount: 5,\n        showPagination: true,\n        enableThreadMode: false\n      };\n      setCapturedLayout(fallback);\n      return fallback;\n    } finally {\n      setIsCapturing(false);\n    }\n  };\n\n  const generatePostsSkeleton = (config?: PostsSkeletonConfig) => {\n    const activeConfig = config ||\n      capturedLayout || {\n        submissionCount: 5,\n        showPagination: true,\n        enableThreadMode: false\n      };\n\n    const elements: React.ReactNode[] = [];\n\n    // Generate submission skeletons\n    for (let i = 0; i < (activeConfig.submissionCount || 5); i++) {\n      elements.push(\n        <SubmissionCardSkeleton\n          key={`submission-${i}`}\n          enableThreadMode={activeConfig.enableThreadMode}\n        />\n      );\n    }\n\n    // Add pagination if needed - wrap in submissions-list__pagination div to match real structure\n    if (activeConfig.showPagination) {\n      elements.push(\n        <div key=\\\"pagination\\\" className=\\\"submissions-list__pagination\\\">\n          <PaginationSkeleton />\n        </div>\n      );\n    }\n\n    return (\n      <div className=\\\"skeleton-container skeleton--posts-list\\\">{elements}</div>\n    );\n  };\n\n  const getSmartSkeletonLoader = (isLoading: boolean = true) => {\n    // In dev mode, check if skeleton should be forced\n    const shouldShow = (() => {\n      if (process.env.NODE_ENV === 'development' && isDevModeActive) {\n        return shouldShowSkeleton;\n      }\n      return isLoading;\n    })();\n\n    // Don't render anything if skeleton shouldn't be shown\n    if (!shouldShow) {\n      return null;\n    }\n\n    if (!capturedLayout) {\n      // Return a default skeleton configuration\n      return (\n        <SkeletonLoader\n          config={{\n            type: 'manual',\n            customElements: [generatePostsSkeleton()]\n          }}\n          isLoading={isLoading}\n        />\n      );\n    }\n\n    return generatePostsSkeleton(capturedLayout);\n  };\n\n  const resetCapture = () => {\n    setCapturedLayout(null);\n    setIsCapturing(false);\n  };\n\n  // Auto-capture when component mounts and data changes\n  useEffect(() => {\n    if (containerRef.current && !capturedLayout && !isCapturing) {\n      // Small delay to ensure DOM is stable\n      const timer = setTimeout(() => {\n        captureCurrentLayout();\n      }, 100);\n\n      return () => clearTimeout(timer);\n    }\n  }, [capturedLayout, isCapturing]);\n\n  return {\n    containerRef,\n    capturedLayout,\n    isCapturing,\n    captureCurrentLayout,\n    generatePostsSkeleton,\n    getSmartSkeletonLoader,\n    resetCapture\n  };\n};\n\n// Convenience component for immediate use\nexport const SmartPostsSkeleton: React.FC<\n  PostsSkeletonConfig & { isLoading?: boolean }\n> = ({ isLoading = true, ...config }) => {\n  const { generatePostsSkeleton } = useSmartPostsSkeleton();\n\n  // Get development mode state\n  const { shouldShowSkeleton, isDevModeActive } = useDevSkeletonState();\n\n  // Determine if skeleton should be visible\n  const shouldShow = (() => {\n    if (process.env.NODE_ENV === 'development' && isDevModeActive) {\n      return shouldShowSkeleton;\n    }\n    return isLoading;\n  })();\n\n  // Don't render anything if skeleton shouldn't be shown\n  if (!shouldShow) {\n    return null;\n  }\n\n  return <>{generatePostsSkeleton(config)}</>;\n};\n\nexport default useSmartPostsSkeleton;\n",
    "language":"typescript",
    "lines":332,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/skeleton/SimpleSkeletonWrapper.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport './SkeletonLoader.css';\n\ninterface SimpleSkeletonWrapperProps {\n  children: React.ReactNode;\n  isLoading: boolean;\n  className?: string;\n  expectedItemCount?: number;\n  fallbackMinHeight?: string;\n  delayMs?: number; // Delay before showing skeleton to prevent flicker\n}\n\nconst SubmissionSkeleton: React.FC = () => (\n  <div className=\\\"skeleton-item-fallback\\\">\n    <div\n      className=\\\"skeleton skeleton--box\\\"\n      style={{\n        width: '100%',\n        height: '120px',\n        marginBottom: '1rem',\n        borderRadius: '8px'\n      }}\n    />\n    <div\n      className=\\\"skeleton skeleton--text\\\"\n      style={{ width: '85%', height: '20px', marginBottom: '0.5rem' }}\n    />\n    <div\n      className=\\\"skeleton skeleton--text\\\"\n      style={{ width: '70%', height: '16px', marginBottom: '0.5rem' }}\n    />\n    <div style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem' }}>\n      <div\n        className=\\\"skeleton skeleton--text\\\"\n        style={{ width: '60px', height: '24px', borderRadius: '12px' }}\n      />\n      <div\n        className=\\\"skeleton skeleton--text\\\"\n        style={{ width: '80px', height: '24px', borderRadius: '12px' }}\n      />\n      <div\n        className=\\\"skeleton skeleton--text\\\"\n        style={{ width: '70px', height: '24px', borderRadius: '12px' }}\n      />\n    </div>\n  </div>\n);\n\nexport const SimpleSkeletonWrapper: React.FC<SimpleSkeletonWrapperProps> = ({\n  children,\n  isLoading,\n  className = '',\n  expectedItemCount = 5,\n  fallbackMinHeight = '400px',\n  delayMs = 50 // Reduced delay for better responsiveness\n}) => {\n  const [showSkeleton, setShowSkeleton] = useState(false);\n\n  useEffect(() => {\n    if (isLoading) {\n      const timer = setTimeout(() => {\n        setShowSkeleton(true);\n      }, delayMs);\n      return () => clearTimeout(timer);\n    } else {\n      setShowSkeleton(false);\n    }\n  }, [isLoading, delayMs]);\n\n  if (isLoading && showSkeleton) {\n    return (\n      <div\n        className={`skeleton-container--simple ${className}`}\n        style={{ minHeight: fallbackMinHeight }}\n        aria-label=\\\"Loading content...\\\"\n        role=\\\"status\\\"\n      >\n        {Array.from({ length: expectedItemCount }, (_, i) => (\n          <SubmissionSkeleton key={`skeleton-${i}`} />\n        ))}\n      </div>\n    );\n  }\n\n  return <div className={className}>{children}</div>;\n};\n\nexport default SimpleSkeletonWrapper;\n",
    "language":"typescript",
    "lines":91,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/skeleton/IntelligentSkeletonWrapper.tsx":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport './SkeletonLoader.css';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'IntelligentSkeletonWrapper',\n    module: 'components/skeleton'\n  },\n  enabled: false // Disabled to reduce log noise\n});\n\ninterface CapturedElement {\n  tagName: string;\n  className: string;\n  id: string;\n  rect: {\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n  };\n  computedStyles: Record<string, string>;\n  textContent: string;\n  isContentElement: boolean;\n  isContainer: boolean;\n  children: CapturedElement[];\n  attributes: Record<string, string>;\n}\n\ninterface SkeletonConfig {\n  rootElement: CapturedElement | null;\n  containerDimensions: {\n    width: number;\n    height: number;\n    totalHeight: number;\n  };\n  captureTime: number;\n  metadata: {\n    expectedItemCount?: number;\n    itemPattern?: CapturedElement;\n    containerPattern?: CapturedElement;\n    paginationPattern?: CapturedElement;\n    hasInfiniteScroll?: boolean;\n    hasPagination?: boolean;\n  };\n}\n\ninterface IntelligentSkeletonWrapperProps {\n  children: React.ReactNode;\n  isLoading: boolean;\n  className?: string;\n  preserveExactHeight?: boolean;\n  fallbackMinHeight?: string;\n  onStructureCaptured?: (config: SkeletonConfig) => void;\n  expectedItemCount?: number;\n  expectedTotalRecords?: number;\n  hasPagination?: boolean;\n  hasInfiniteScroll?: boolean;\n  currentPage?: number;\n  pageSize?: number;\n}\n\n// CSS properties that are important for layout replication\nconst LAYOUT_PROPERTIES = [\n  'display',\n  'position',\n  'width',\n  'height',\n  'minWidth',\n  'minHeight',\n  'maxWidth',\n  'maxHeight',\n  'margin',\n  'marginTop',\n  'marginRight',\n  'marginBottom',\n  'marginLeft',\n  'padding',\n  'paddingTop',\n  'paddingRight',\n  'paddingBottom',\n  'paddingLeft',\n  'border',\n  'borderWidth',\n  'borderStyle',\n  'borderColor',\n  'borderRadius',\n  'flexDirection',\n  'flexWrap',\n  'justifyContent',\n  'alignItems',\n  'alignContent',\n  'gap',\n  'rowGap',\n  'columnGap',\n  'gridTemplateColumns',\n  'gridTemplateRows',\n  'overflow',\n  'overflowX',\n  'overflowY',\n  'zIndex',\n  'transform',\n  'fontSize',\n  'fontWeight',\n  'lineHeight',\n  'letterSpacing',\n  'backgroundColor',\n  'backgroundImage',\n  'backgroundSize',\n  'backgroundPosition',\n  'boxShadow',\n  'opacity',\n  'visibility'\n];\n\n// Properties that should be inherited for skeleton styling\nconst SKELETON_PROPERTIES = [\n  'borderRadius',\n  'margin',\n  'padding',\n  'width',\n  'height',\n  'minWidth',\n  'minHeight',\n  'display',\n  'flexDirection',\n  'justifyContent',\n  'alignItems',\n  'gap',\n  'position'\n];\n\nconst isContentElement = (element: Element): boolean => {\n  const tagName = element.tagName.toLowerCase();\n  const textContent = element.textContent?.trim() || '';\n\n  // Text elements with content\n  const textTags = [\n    'p',\n    'span',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    'label',\n    'strong',\n    'em',\n    'small',\n    'time',\n    'div'\n  ];\n  if (\n    textTags.includes(tagName) &&\n    textContent.length > 0 &&\n    textContent.length < 200\n  ) {\n    return true;\n  }\n\n  // Interactive elements\n  const interactiveTags = ['button', 'input', 'textarea', 'select', 'a'];\n  if (interactiveTags.includes(tagName)) {\n    return true;\n  }\n\n  // Media elements\n  const mediaTags = ['img', 'svg', 'video', 'canvas', 'iframe'];\n  if (mediaTags.includes(tagName)) {\n    return true;\n  }\n\n  // Elements with specific roles\n  const role = element.getAttribute('role');\n  if (role && ['button', 'link', 'textbox', 'image'].includes(role)) {\n    return true;\n  }\n\n  return false;\n};\n\nconst isContainerElement = (element: Element): boolean => {\n  const tagName = element.tagName.toLowerCase();\n  const containerTags = [\n    'div',\n    'section',\n    'article',\n    'header',\n    'footer',\n    'main',\n    'aside',\n    'nav',\n    'ul',\n    'ol',\n    'li'\n  ];\n\n  if (!containerTags.includes(tagName)) {\n    return false;\n  }\n\n  // Check if it has layout-related styling\n  const computedStyle = window.getComputedStyle(element);\n  const display = computedStyle.display;\n\n  return (\n    ['flex', 'grid', 'block', 'inline-block'].includes(display) &&\n    element.children.length > 0\n  );\n};\n\nconst shouldSkipElement = (element: Element): boolean => {\n  const tagName = element.tagName.toLowerCase();\n\n  // Skip script, style, and other non-visual elements\n  const skipTags = [\n    'script',\n    'style',\n    'noscript',\n    'meta',\n    'link',\n    'title',\n    'br',\n    'hr'\n  ];\n  if (skipTags.includes(tagName)) return true;\n\n  // Skip elements with no dimensions\n  const rect = element.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return true;\n\n  // Skip hidden elements\n  const computedStyle = window.getComputedStyle(element);\n  if (\n    computedStyle.display === 'none' ||\n    computedStyle.visibility === 'hidden'\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\nconst captureComputedStyles = (element: Element): Record<string, string> => {\n  const computedStyle = window.getComputedStyle(element);\n  const styles: Record<string, string> = {};\n\n  LAYOUT_PROPERTIES.forEach((property) => {\n    const value = computedStyle.getPropertyValue(property);\n    if (\n      value &&\n      value !== 'auto' &&\n      value !== 'normal' &&\n      value !== 'initial'\n    ) {\n      styles[property] = value;\n    }\n  });\n\n  return styles;\n};\n\nconst captureElementStructure = (\n  element: Element,\n  parentRect?: DOMRect\n): CapturedElement => {\n  const rect = element.getBoundingClientRect();\n  const computedStyles = captureComputedStyles(element);\n\n  // Capture attributes\n  const attributes: Record<string, string> = {};\n  Array.from(element.attributes).forEach((attr) => {\n    if (!['class', 'id', 'style'].includes(attr.name)) {\n      attributes[attr.name] = attr.value;\n    }\n  });\n\n  const captured: CapturedElement = {\n    tagName: element.tagName.toLowerCase(),\n    className: String(element.className || ''),\n    id: String(element.id || ''),\n    rect: {\n      width: rect.width,\n      height: rect.height,\n      x: rect.x,\n      y: rect.y\n    },\n    computedStyles,\n    textContent: element.textContent?.trim() || '',\n    isContentElement: isContentElement(element),\n    isContainer: isContainerElement(element),\n    children: [],\n    attributes\n  };\n\n  // Recursively capture children\n  Array.from(element.children).forEach((child) => {\n    if (!shouldSkipElement(child)) {\n      captured.children.push(captureElementStructure(child, rect));\n    }\n  });\n\n  return captured;\n};\n\nconst generateSkeletonStyles = (\n  captured: CapturedElement\n): React.CSSProperties => {\n  const styles: React.CSSProperties = {};\n\n  // Copy essential layout properties with type safety\n  SKELETON_PROPERTIES.forEach((prop) => {\n    const value = captured.computedStyles[prop];\n    if (\n      value &&\n      value !== 'auto' &&\n      value !== 'initial' &&\n      value !== 'inherit'\n    ) {\n      // Convert kebab-case to camelCase for React styles\n      const camelProp = prop.replace(/-([a-z])/g, (_, letter) =>\n        letter.toUpperCase()\n      );\n\n      // Type-safe assignment - only assign valid CSS values\n      try {\n        (styles as any)[camelProp] = value;\n      } catch (e) {\n        // Skip invalid CSS values\n        logger.debug('Skipped invalid CSS property', { prop, value });\n      }\n    }\n  });\n\n  // Override with skeleton-specific styling\n  if (captured.isContentElement) {\n    styles.backgroundColor = 'var(--light-background--secondary, #e0e0e0)';\n    styles.color = 'transparent';\n    styles.borderRadius = styles.borderRadius || '4px';\n\n    // Ensure minimum dimensions for content elements\n    if (!styles.width && captured.rect.width > 0) {\n      styles.width = `${captured.rect.width}px`;\n    }\n    if (!styles.height && captured.rect.height > 0) {\n      styles.height = `${captured.rect.height}px`;\n    }\n  }\n\n  // Preserve container layout but remove backgrounds\n  if (captured.isContainer) {\n    styles.backgroundColor = 'transparent';\n  }\n\n  return styles;\n};\n\nconst findItemPattern = (element: CapturedElement): CapturedElement | null => {\n  // Look for repeating item patterns in the captured structure\n  const itemSelectors = [\n    'submission',\n    'submission__wrapper',\n    'submission-item',\n    'list-item',\n    'card',\n    'post',\n    'item',\n    'entry',\n    'row'\n  ];\n\n  // Safely handle className and id - ensure they're strings\n  const className =\n    typeof element.className === 'string' ? element.className : '';\n  const id = typeof element.id === 'string' ? element.id : '';\n\n  // Check if this element looks like a list item\n  const isListItem = itemSelectors.some(\n    (selector) =>\n      className.toLowerCase().includes(selector) ||\n      id.toLowerCase().includes(selector)\n  );\n\n  // Also check for common structural patterns\n  const hasItemStructure =\n    element.children.length > 2 && // Has multiple child elements\n    element.rect.height > 50 && // Has reasonable height\n    element.rect.width > 100 && // Has reasonable width\n    (element.tagName === 'div' ||\n      element.tagName === 'article' ||\n      element.tagName === 'li');\n\n  logger.debug('Checking element for item pattern', {\n    className,\n    tagName: element.tagName,\n    isListItem,\n    hasItemStructure,\n    childrenCount: element.children.length,\n    height: element.rect.height,\n    width: element.rect.width\n  });\n\n  if (isListItem || hasItemStructure) {\n    logger.debug('Found potential item pattern', {\n      className,\n      tagName: element.tagName,\n      reason: isListItem ? 'matching selector' : 'structural pattern'\n    });\n    return element;\n  }\n\n  // Recursively search children, prioritizing elements that look like items\n  const potentialItems: CapturedElement[] = [];\n\n  for (const child of element.children) {\n    const pattern = findItemPattern(child);\n    if (pattern) {\n      potentialItems.push(pattern);\n    }\n  }\n\n  // If we found multiple similar items, return the first one as the pattern\n  if (potentialItems.length > 0) {\n    logger.debug('Found item pattern in children', {\n      count: potentialItems.length,\n      firstItemClass:\n        typeof potentialItems[0].className === 'string'\n          ? potentialItems[0].className\n          : ''\n    });\n    return potentialItems[0];\n  }\n\n  return null;\n};\n\nconst findPaginationPattern = (\n  element: CapturedElement\n): CapturedElement | null => {\n  // Look for pagination patterns\n  const paginationSelectors = ['pagination', 'page', 'nav'];\n\n  // Safely handle className - ensure it's a string\n  const className =\n    typeof element.className === 'string' ? element.className : '';\n\n  const isPagination = paginationSelectors.some((selector) =>\n    className.toLowerCase().includes(selector)\n  );\n\n  if (isPagination) {\n    return element;\n  }\n\n  // Recursively search children\n  for (const child of element.children) {\n    const pattern = findPaginationPattern(child);\n    if (pattern) return pattern;\n  }\n\n  return null;\n};\n\nconst generateIntelligentSkeleton = (\n  config: SkeletonConfig\n): React.ReactNode => {\n  if (!config.rootElement) return null;\n\n  const { metadata, rootElement } = config;\n  const expectedCount = metadata.expectedItemCount || 5;\n\n  logger.debug('Generating intelligent skeleton', {\n    expectedCount,\n    hasRootElement: !!rootElement,\n    rootClassName: rootElement.className,\n    rootTagName: rootElement.tagName\n  });\n\n  // Find the item pattern from captured structure\n  const itemPattern = findItemPattern(rootElement);\n  const paginationPattern = findPaginationPattern(rootElement);\n\n  logger.debug('Pattern detection results', {\n    hasItemPattern: !!itemPattern,\n    itemPatternClass: itemPattern?.className,\n    hasPaginationPattern: !!paginationPattern,\n    paginationPatternClass: paginationPattern?.className\n  });\n\n  // Generate multiple items based on expected count\n  const skeletonItems: React.ReactNode[] = [];\n\n  if (itemPattern) {\n    // Use the detected item pattern\n    for (let i = 0; i < expectedCount; i++) {\n      skeletonItems.push(\n        reconstructSkeleton(itemPattern, `skeleton-item-${i}`)\n      );\n    }\n  } else {\n    // No specific pattern found - create generic skeleton items\n    // Use the root element as a template but make it more generic\n    const genericItemHeight = Math.max(\n      rootElement.rect.height / Math.max(rootElement.children.length, 1),\n      80\n    );\n\n    for (let i = 0; i < expectedCount; i++) {\n      skeletonItems.push(\n        <div\n          key={`skeleton-generic-${i}`}\n          className=\\\"skeleton skeleton--auto\\\"\n          style={{\n            width: '100%',\n            height: `${genericItemHeight}px`,\n            marginBottom: '1rem',\n            borderRadius: '8px',\n            backgroundColor: 'var(--light-background--secondary, #e0e0e0)'\n          }}\n          aria-hidden=\\\"true\\\"\n        />\n      );\n    }\n  }\n\n  logger.debug('Generated skeleton items', {\n    itemCount: skeletonItems.length,\n    expectedCount\n  });\n\n  // If we have an item pattern, try to find its container and replace content\n  if (itemPattern) {\n    const itemContainer = findItemContainer(rootElement, itemPattern);\n\n    if (itemContainer) {\n      // Reconstruct the root structure but replace the item container content\n      const reconstructWithItems = (\n        element: CapturedElement,\n        key: string\n      ): React.ReactNode => {\n        if (element === itemContainer) {\n          // This is the items container - replace with our generated skeleton items\n          const styles = generateSkeletonStyles(element);\n          return (\n            <div\n              key={key}\n              style={styles}\n              className={`skeleton-container ${element.className}`}\n              aria-hidden=\\\"true\\\"\n            >\n              {skeletonItems}\n            </div>\n          );\n        }\n\n        // For other elements, reconstruct normally but check children\n        const styles = generateSkeletonStyles(element);\n\n        if (element.isContentElement) {\n          return (\n            <div\n              key={key}\n              className=\\\"skeleton skeleton--auto\\\"\n              style={styles}\n              aria-hidden=\\\"true\\\"\n            />\n          );\n        }\n\n        return (\n          <div\n            key={key}\n            style={styles}\n            className={`skeleton-container ${element.className}`}\n            aria-hidden=\\\"true\\\"\n          >\n            {element.children.map((child, index) =>\n              reconstructWithItems(child, `${key}-${index}`)\n            )}\n          </div>\n        );\n      };\n\n      const result = reconstructWithItems(rootElement, 'skeleton-root');\n\n      // Add pagination if expected\n      if (metadata.hasPagination && paginationPattern) {\n        return (\n          <div className=\\\"skeleton-wrapper\\\">\n            {result}\n            {reconstructSkeleton(paginationPattern, 'skeleton-pagination')}\n          </div>\n        );\n      }\n\n      return result;\n    }\n  }\n\n  // Fallback: create a simple container with multiple skeleton items\n  const containerStyles = generateSkeletonStyles(rootElement);\n\n  return (\n    <div\n      className={`skeleton-container ${rootElement.className}`}\n      style={containerStyles}\n      aria-hidden=\\\"true\\\"\n    >\n      {skeletonItems}\n      {metadata.hasPagination && paginationPattern && (\n        <div className=\\\"skeleton-pagination\\\">\n          {reconstructSkeleton(paginationPattern, 'skeleton-pagination')}\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Helper function to find the container that holds the item pattern\nconst findItemContainer = (\n  rootElement: CapturedElement,\n  itemPattern: CapturedElement\n): CapturedElement | null => {\n  // Check if this container has the item as a direct child\n  const hasItemChild = rootElement.children.some(\n    (child) => child === itemPattern || findItemPattern(child) === itemPattern\n  );\n\n  if (hasItemChild) {\n    return rootElement;\n  }\n\n  // Recursively search\n  for (const child of rootElement.children) {\n    const container = findItemContainer(child, itemPattern);\n    if (container) return container;\n  }\n\n  return null;\n};\n\nconst reconstructSkeleton = (\n  captured: CapturedElement,\n  key: string = ''\n): React.ReactNode => {\n  const styles = generateSkeletonStyles(captured);\n\n  // For content elements, render as skeleton\n  if (captured.isContentElement) {\n    return (\n      <div\n        key={key}\n        className=\\\"skeleton skeleton--auto\\\"\n        style={styles}\n        aria-hidden=\\\"true\\\"\n      />\n    );\n  }\n\n  // For containers, preserve structure and render children\n  if (captured.isContainer || captured.children.length > 0) {\n    return (\n      <div\n        key={key}\n        style={styles}\n        className={`skeleton-container ${captured.className}`}\n        aria-hidden=\\\"true\\\"\n      >\n        {captured.children.map((child, index) =>\n          reconstructSkeleton(child, `${key}-${index}`)\n        )}\n      </div>\n    );\n  }\n\n  // For other elements, render as simple skeleton\n  return (\n    <div\n      key={key}\n      className=\\\"skeleton skeleton--auto\\\"\n      style={styles}\n      aria-hidden=\\\"true\\\"\n    />\n  );\n};\n\nexport const IntelligentSkeletonWrapper: React.FC<\n  IntelligentSkeletonWrapperProps\n> = ({\n  children,\n  isLoading,\n  className = '',\n  preserveExactHeight = true,\n  fallbackMinHeight = '400px',\n  onStructureCaptured,\n  expectedItemCount,\n  expectedTotalRecords,\n  hasPagination,\n  hasInfiniteScroll,\n  currentPage,\n  pageSize\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [skeletonConfig, setSkeletonConfig] = useState<SkeletonConfig>({\n    rootElement: null,\n    containerDimensions: { width: 0, height: 0, totalHeight: 0 },\n    captureTime: 0,\n    metadata: {}\n  });\n  const [isCapturing, setIsCapturing] = useState(false);\n\n  const captureStructure = useCallback(() => {\n    if (!containerRef.current || isCapturing) return;\n\n    setIsCapturing(true);\n\n    try {\n      logger.debug('Starting automatic DOM structure capture');\n\n      const rootRect = containerRef.current.getBoundingClientRect();\n      const rootElement = captureElementStructure(containerRef.current);\n\n      const config: SkeletonConfig = {\n        rootElement,\n        containerDimensions: {\n          width: rootRect.width,\n          height: rootRect.height,\n          totalHeight: rootRect.height\n        },\n        captureTime: Date.now(),\n        metadata: {\n          expectedItemCount,\n          itemPattern: rootElement,\n          containerPattern: rootElement,\n          paginationPattern: rootElement,\n          hasInfiniteScroll,\n          hasPagination\n        }\n      };\n\n      setSkeletonConfig(config);\n      onStructureCaptured?.(config);\n\n      logger.debug('DOM structure captured successfully', {\n        elementCount: countElements(rootElement),\n        contentElements: countContentElements(rootElement),\n        containerDimensions: config.containerDimensions\n      });\n    } catch (error) {\n      logger.error('Failed to capture DOM structure', error as Error);\n    } finally {\n      setIsCapturing(false);\n    }\n  }, [\n    isCapturing,\n    onStructureCaptured,\n    expectedItemCount,\n    hasInfiniteScroll,\n    hasPagination\n  ]);\n\n  const countElements = (element: CapturedElement): number => {\n    return (\n      1 +\n      element.children.reduce((count, child) => count + countElements(child), 0)\n    );\n  };\n\n  const countContentElements = (element: CapturedElement): number => {\n    let count = element.isContentElement ? 1 : 0;\n    return (\n      count +\n      element.children.reduce(\n        (total, child) => total + countContentElements(child),\n        0\n      )\n    );\n  };\n\n  // Auto-capture when content becomes available\n  useEffect(() => {\n    if (!isLoading && containerRef.current && !skeletonConfig.rootElement) {\n      // Delay to ensure DOM is stable and styled\n      const timer = setTimeout(captureStructure, 150);\n      return () => clearTimeout(timer);\n    }\n  }, [isLoading, captureStructure, skeletonConfig.rootElement]);\n\n  // Re-capture on window resize for responsive layouts\n  useEffect(() => {\n    const handleResize = () => {\n      if (!isLoading && skeletonConfig.rootElement && containerRef.current) {\n        const rootRect = containerRef.current.getBoundingClientRect();\n        setSkeletonConfig((prev) => ({\n          ...prev,\n          containerDimensions: {\n            width: rootRect.width,\n            height: rootRect.height,\n            totalHeight: rootRect.height\n          }\n        }));\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, [isLoading, skeletonConfig.rootElement]);\n\n  // Show skeleton immediately when loading starts\n  if (isLoading) {\n    // Always show fallback skeleton first for immediate feedback\n    // The intelligent skeleton will be used on subsequent loads\n    const shouldShowIntelligent =\n      skeletonConfig.rootElement && skeletonConfig.captureTime > 0;\n\n    if (shouldShowIntelligent) {\n      // Debug: Log when intelligent skeleton is shown\n      logger.debug('Showing INTELLIGENT skeleton', {\n        hasRootElement: !!skeletonConfig.rootElement,\n        captureTime: skeletonConfig.captureTime,\n        containerDimensions: skeletonConfig.containerDimensions\n      });\n\n      // Render captured structure as skeleton\n      const containerStyle: React.CSSProperties = preserveExactHeight\n        ? {\n            width: `${skeletonConfig.containerDimensions.width}px`,\n            height: `${skeletonConfig.containerDimensions.height}px`,\n            minHeight: `${skeletonConfig.containerDimensions.height}px`\n          }\n        : {\n            minHeight: fallbackMinHeight\n          };\n\n      return (\n        <div\n          className={`skeleton-container--intelligent ${className}`}\n          style={containerStyle}\n          aria-label=\\\"Loading content...\\\"\n          role=\\\"status\\\"\n        >\n          {generateIntelligentSkeleton(skeletonConfig)}\n        </div>\n      );\n    }\n\n    // Debug: Log when fallback skeleton is shown\n    logger.debug('Showing FALLBACK skeleton', {\n      hasRootElement: !!skeletonConfig.rootElement,\n      expectedItemCount: expectedItemCount || 5,\n      reason: 'No captured structure available or first load'\n    });\n\n    // Always show fallback skeleton for immediate loading feedback\n    return (\n      <div\n        className={`skeleton-container--fallback ${className}`}\n        style={{ minHeight: fallbackMinHeight }}\n        aria-label=\\\"Loading content...\\\"\n        role=\\\"status\\\"\n      >\n        {/* Generate multiple fallback skeleton items based on expected count */}\n        {Array.from({ length: expectedItemCount || 5 }, (_, i) => (\n          <div\n            key={`fallback-skeleton-${i}`}\n            className=\\\"skeleton-item-fallback\\\"\n          >\n            <div\n              className=\\\"skeleton skeleton--box\\\"\n              style={{ width: '100%', height: '100px', marginBottom: '1rem' }}\n            />\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{ width: '80%', height: '20px', marginBottom: '0.5rem' }}\n            />\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{ width: '60%', height: '16px', marginBottom: '0.5rem' }}\n            />\n            <div\n              className=\\\"skeleton skeleton--text\\\"\n              style={{ width: '40%', height: '16px', marginBottom: '1rem' }}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div ref={containerRef} className={className}>\n      {children}\n    </div>\n  );\n};\n\nexport default IntelligentSkeletonWrapper;\n",
    "language":"typescript",
    "lines":903,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/skeleton/SkeletonLoader.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport './SkeletonLoader.css';\n\n// Development-only import that gets tree-shaken in production\nlet useDevSkeletonState: () => {\n  shouldShowSkeleton: boolean;\n  isDevModeActive: boolean;\n};\n\n// Always define the hook, but conditionally import the real implementation\nif (process.env.NODE_ENV === 'development') {\n  try {\n    const devModule = require('../dev-tools/DevSkeletonToggle');\n    useDevSkeletonState = devModule.useDevSkeletonState;\n  } catch {\n    // Fallback if dev module not available\n    useDevSkeletonState = () => ({\n      shouldShowSkeleton: false,\n      isDevModeActive: false\n    });\n  }\n} else {\n  // Production fallback - returns inactive state\n  useDevSkeletonState = () => ({\n    shouldShowSkeleton: false,\n    isDevModeActive: false\n  });\n}\n\n// Base skeleton components\nexport const SkeletonText: React.FC<{\n  width?: string | number;\n  height?: string | number;\n  className?: string;\n  style?: React.CSSProperties;\n}> = ({ width = '100%', height = '1rem', className = '', style = {} }) => (\n  <div\n    className={`skeleton skeleton--text ${className}`}\n    style={{\n      width: typeof width === 'number' ? `${width}px` : width,\n      height: typeof height === 'number' ? `${height}px` : height,\n      ...style\n    }}\n  />\n);\n\nexport const SkeletonBox: React.FC<{\n  width?: string | number;\n  height?: string | number;\n  className?: string;\n  style?: React.CSSProperties;\n}> = ({ width = '100%', height = '100px', className = '', style = {} }) => (\n  <div\n    className={`skeleton skeleton--box ${className}`}\n    style={{\n      width: typeof width === 'number' ? `${width}px` : width,\n      height: typeof height === 'number' ? `${height}px` : height,\n      ...style\n    }}\n  />\n);\n\nexport const SkeletonCircle: React.FC<{\n  size?: string | number;\n  className?: string;\n}> = ({ size = '40px', className = '' }) => (\n  <div\n    className={`skeleton skeleton--circle ${className}`}\n    style={{\n      width: typeof size === 'number' ? `${size}px` : size,\n      height: typeof size === 'number' ? `${size}px` : size\n    }}\n  />\n);\n\n// Enhanced element analysis\ninterface ElementInfo {\n  type: 'text' | 'box' | 'circle' | 'button' | 'input' | 'image' | 'icon';\n  width: number;\n  height: number;\n  x: number;\n  y: number;\n  borderRadius: string;\n  margin: string;\n  padding: string;\n  backgroundColor: string;\n  display: string;\n  flexDirection?: string;\n  gap?: string;\n  justifyContent?: string;\n  alignItems?: string;\n  className?: string;\n  tagName: string;\n  textContent?: string;\n  isContainer: boolean;\n  children: ElementInfo[];\n}\n\nconst shouldSkipElement = (element: Element): boolean => {\n  const tagName = element.tagName.toLowerCase();\n  const skipTags = ['script', 'style', 'noscript', 'meta', 'link', 'title'];\n\n  if (skipTags.includes(tagName)) return true;\n\n  // Skip elements with no content and no visual impact\n  const rect = element.getBoundingClientRect();\n  if (rect.width === 0 || rect.height === 0) return true;\n\n  const computedStyle = window.getComputedStyle(element);\n  if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden')\n    return true;\n\n  // Skip SVG internals but keep the SVG container\n  if (\n    element.parentElement?.tagName.toLowerCase() === 'svg' &&\n    tagName !== 'svg'\n  )\n    return true;\n\n  return false;\n};\n\nconst analyzeElement = (\n  element: Element,\n  parentRect?: DOMRect\n): ElementInfo => {\n  const rect = element.getBoundingClientRect();\n  const computedStyle = window.getComputedStyle(element);\n  const tagName = element.tagName.toLowerCase();\n\n  // Calculate relative position if we have a parent\n  const x = parentRect ? rect.left - parentRect.left : rect.left;\n  const y = parentRect ? rect.top - parentRect.top : rect.top;\n\n  // Determine element type based on various factors\n  let type: ElementInfo['type'] = 'box';\n\n  if (\n    tagName === 'img' ||\n    element.classList.contains('avatar') ||\n    element.classList.contains('profile-image')\n  ) {\n    type = 'circle';\n  } else if (tagName === 'svg' || element.classList.contains('icon')) {\n    type = 'icon';\n  } else if (\n    tagName === 'button' ||\n    element.getAttribute('role') === 'button' ||\n    element.classList.contains('button')\n  ) {\n    type = 'button';\n  } else if (\n    tagName === 'input' ||\n    tagName === 'textarea' ||\n    tagName === 'select'\n  ) {\n    type = 'input';\n  } else if (\n    tagName === 'p' ||\n    tagName === 'span' ||\n    tagName === 'a' ||\n    tagName === 'h1' ||\n    tagName === 'h2' ||\n    tagName === 'h3' ||\n    tagName === 'h4' ||\n    tagName === 'h5' ||\n    tagName === 'h6' ||\n    tagName === 'label' ||\n    element.classList.contains('text') ||\n    (rect.height < 40 && element.textContent?.trim()) // Likely text if small and has text content\n  ) {\n    type = 'text';\n  }\n\n  // Check if this is a container element\n  const isContainer =\n    computedStyle.display === 'flex' ||\n    computedStyle.display === 'grid' ||\n    (computedStyle.display === 'block' && element.children.length > 0);\n\n  // Analyze children recursively\n  const children: ElementInfo[] = [];\n  if (isContainer) {\n    for (const child of Array.from(element.children)) {\n      if (!shouldSkipElement(child)) {\n        children.push(analyzeElement(child, rect));\n      }\n    }\n  }\n\n  return {\n    type,\n    width: rect.width,\n    height: rect.height,\n    x,\n    y,\n    borderRadius: computedStyle.borderRadius || '0',\n    margin: computedStyle.margin || '0',\n    padding: computedStyle.padding || '0',\n    backgroundColor: computedStyle.backgroundColor || 'transparent',\n    display: computedStyle.display || 'block',\n    flexDirection: computedStyle.flexDirection || undefined,\n    gap: computedStyle.gap || undefined,\n    justifyContent: computedStyle.justifyContent || undefined,\n    alignItems: computedStyle.alignItems || undefined,\n    className: element.className || '',\n    tagName,\n    textContent: element.textContent?.trim(),\n    isContainer,\n    children\n  };\n};\n\nconst generateSkeletonFromElement = (\n  elementInfo: ElementInfo,\n  key: string = ''\n): React.ReactNode => {\n  const {\n    type,\n    width,\n    height,\n    borderRadius,\n    margin,\n    padding,\n    display,\n    children,\n    isContainer\n  } = elementInfo;\n\n  // Style object for the skeleton element\n  const style: React.CSSProperties = {\n    width: `${width}px`,\n    height: `${height}px`,\n    borderRadius: borderRadius !== '0' ? borderRadius : undefined,\n    margin: margin !== '0' ? margin : undefined,\n    padding: padding !== '0' ? padding : undefined,\n    display: display\n  };\n\n  // Handle flex properties\n  if (display === 'flex') {\n    style.flexDirection = elementInfo.flexDirection as any;\n    style.gap = elementInfo.gap;\n    style.justifyContent = elementInfo.justifyContent as any;\n    style.alignItems = elementInfo.alignItems as any;\n  }\n\n  // If this is a container with children, render the container structure\n  if (isContainer && children.length > 0) {\n    return (\n      <div key={key} className=\\\"skeleton-container--auto\\\" style={style}>\n        {children.map((child, index) =>\n          generateSkeletonFromElement(child, `${key}-${index}`)\n        )}\n      </div>\n    );\n  }\n\n  // Render appropriate skeleton component based on type\n  switch (type) {\n    case 'circle':\n    case 'icon':\n      return (\n        <SkeletonCircle\n          key={key}\n          size={Math.min(width, height)}\n          className=\\\"skeleton--auto\\\"\n        />\n      );\n    case 'text':\n      return (\n        <SkeletonText\n          key={key}\n          width={width}\n          height={height}\n          className=\\\"skeleton--auto\\\"\n          style={{ borderRadius }}\n        />\n      );\n    case 'button':\n      return (\n        <SkeletonBox\n          key={key}\n          width={width}\n          height={height}\n          className=\\\"skeleton--auto skeleton--button-auto\\\"\n          style={{ borderRadius }}\n        />\n      );\n    case 'input':\n      return (\n        <SkeletonBox\n          key={key}\n          width={width}\n          height={height}\n          className=\\\"skeleton--auto skeleton--input-auto\\\"\n          style={{ borderRadius }}\n        />\n      );\n    default:\n      return (\n        <SkeletonBox\n          key={key}\n          width={width}\n          height={height}\n          className=\\\"skeleton--auto\\\"\n          style={{ borderRadius }}\n        />\n      );\n  }\n};\n\n// Smart Skeleton Hook\nexport const useSmartSkeleton = (targetRef: React.RefObject<HTMLElement>) => {\n  const [skeletonContent, setSkeletonContent] = useState<React.ReactNode>(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [capturedLayout, setCapturedLayout] = useState<ElementInfo | null>(\n    null\n  );\n\n  const captureLayout = () => {\n    setIsAnalyzing(true);\n\n    try {\n      // Small delay to ensure DOM is stable\n      setTimeout(() => {\n        if (targetRef.current) {\n          const elementInfo = analyzeElement(targetRef.current);\n          setCapturedLayout(elementInfo);\n\n          const skeleton = generateSkeletonFromElement(elementInfo, 'root');\n          setSkeletonContent(skeleton);\n        }\n        setIsAnalyzing(false);\n      }, 100);\n    } catch (error) {\n      setIsAnalyzing(false);\n    }\n  };\n\n  const clearCapture = () => {\n    setCapturedLayout(null);\n    setSkeletonContent(null);\n    setIsAnalyzing(false);\n  };\n\n  return {\n    skeletonContent,\n    isAnalyzing,\n    capturedLayout,\n    captureLayout,\n    clearCapture\n  };\n};\n\n// Main Smart Skeleton Loader Component\ninterface SmartSkeletonLoaderProps {\n  targetRef: React.RefObject<HTMLElement>;\n  isLoading?: boolean;\n  forceShow?: boolean;\n  fallback?: React.ReactNode;\n  onAnalysisComplete?: (elementInfo: ElementInfo) => void;\n  className?: string;\n}\n\nexport const SmartSkeletonLoader: React.FC<SmartSkeletonLoaderProps> = ({\n  targetRef,\n  isLoading = true,\n  forceShow = false,\n  fallback = null,\n  onAnalysisComplete,\n  className = ''\n}) => {\n  const { skeletonContent, isAnalyzing, capturedLayout, captureLayout } =\n    useSmartSkeleton(targetRef);\n  const [shouldAutoCapture, setShouldAutoCapture] = useState(true);\n\n  // Get development mode state\n  const { shouldShowSkeleton, isDevModeActive } = useDevSkeletonState();\n\n  // Determine if skeleton should be visible\n  const shouldShow = (() => {\n    if (process.env.NODE_ENV === 'development' && isDevModeActive) {\n      return shouldShowSkeleton;\n    }\n    return forceShow || isLoading;\n  })();\n\n  // Auto-capture when target becomes available and we need to show skeleton\n  useEffect(() => {\n    if (\n      shouldShow &&\n      !capturedLayout &&\n      !isAnalyzing &&\n      shouldAutoCapture &&\n      targetRef.current\n    ) {\n      captureLayout();\n      setShouldAutoCapture(false); // Prevent repeated captures\n    }\n  }, [\n    shouldShow,\n    capturedLayout,\n    isAnalyzing,\n    shouldAutoCapture,\n    targetRef,\n    captureLayout\n  ]);\n\n  // Call callback when analysis completes\n  useEffect(() => {\n    if (capturedLayout && onAnalysisComplete) {\n      onAnalysisComplete(capturedLayout);\n    }\n  }, [capturedLayout, onAnalysisComplete]);\n\n  // Reset auto-capture when loading state changes\n  useEffect(() => {\n    if (!isLoading) {\n      setShouldAutoCapture(true);\n    }\n  }, [isLoading]);\n\n  if (!shouldShow) {\n    return null;\n  }\n\n  if (isAnalyzing) {\n    return (\n      <div className={`skeleton-container skeleton--analyzing ${className}`}>\n        <SkeletonBox width=\\\"100%\\\" height=\\\"50px\\\" />\n        <SkeletonText width=\\\"80%\\\" height=\\\"1rem\\\" />\n        <SkeletonText width=\\\"60%\\\" height=\\\"1rem\\\" />\n      </div>\n    );\n  }\n\n  if (skeletonContent) {\n    return (\n      <div\n        className={`skeleton-container--smart ${className}`}\n        role=\\\"status\\\"\n        aria-label=\\\"Loading content\\\"\n      >\n        {skeletonContent}\n      </div>\n    );\n  }\n\n  // Fallback skeleton\n  return (\n    <div\n      className={`skeleton-container ${className}`}\n      role=\\\"status\\\"\n      aria-label=\\\"Loading content\\\"\n    >\n      {fallback || (\n        <>\n          <SkeletonBox width=\\\"100%\\\" height=\\\"50px\\\" />\n          <SkeletonText width=\\\"80%\\\" height=\\\"1rem\\\" />\n          <SkeletonText width=\\\"60%\\\" height=\\\"1rem\\\" />\n        </>\n      )}\n    </div>\n  );\n};\n\n// Legacy SkeletonLoader for backwards compatibility\ninterface SkeletonLoaderProps {\n  config:\n    | {\n        type: 'smart';\n        targetRef: React.RefObject<HTMLElement>;\n        fallback?: React.ReactNode;\n      }\n    | {\n        type: 'manual';\n        customElements: React.ReactNode[];\n      };\n  className?: string;\n  forceShow?: boolean;\n  isLoading?: boolean;\n}\n\nexport const SkeletonLoader: React.FC<SkeletonLoaderProps> = ({\n  config,\n  className = '',\n  forceShow = false,\n  isLoading = true\n}) => {\n  // Always call hooks at the top level\n  const { shouldShowSkeleton, isDevModeActive } = useDevSkeletonState();\n\n  if (config.type === 'smart') {\n    return (\n      <SmartSkeletonLoader\n        targetRef={config.targetRef}\n        isLoading={isLoading}\n        forceShow={forceShow}\n        fallback={config.fallback}\n        className={className}\n      />\n    );\n  }\n\n  // Manual mode - just render the custom elements\n  const shouldShow = (() => {\n    if (process.env.NODE_ENV === 'development' && isDevModeActive) {\n      return shouldShowSkeleton;\n    }\n    return forceShow || isLoading;\n  })();\n\n  if (!shouldShow) {\n    return null;\n  }\n\n  return (\n    <div\n      className={`skeleton-container ${className}`}\n      role=\\\"status\\\"\n      aria-label=\\\"Loading content\\\"\n    >\n      {config.customElements}\n    </div>\n  );\n};\n\nexport default SmartSkeletonLoader;\n",
    "language":"typescript",
    "lines":532,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/skeleton/SkeletonExamples.tsx":{
    "content":"'use client';\n\nimport React, { useRef, useState } from 'react';\nimport {\n  SkeletonBox,\n  SkeletonCircle,\n  SkeletonLoader,\n  SkeletonText,\n  useSmartSkeleton\n} from './SkeletonLoader';\nimport { SmartPostsSkeleton } from './useSmartPostsSkeleton';\n\n/**\n * SkeletonExamples - Demonstrates various skeleton loader usage patterns\n *\n * This component serves as both documentation and testing for the skeleton system.\n * It shows:\n * 1. Basic manual skeleton components\n * 2. Manual skeleton configurations\n * 3. Smart skeleton auto-detection\n * 4. Specialized skeletons for specific components\n */\nexport const SkeletonExamples: React.FC = () => {\n  const [showExample, setShowExample] = useState(1);\n  const contentRef = useRef<HTMLDivElement>(null);\n  const {\n    skeletonContent,\n    isAnalyzing,\n    capturedLayout,\n    captureLayout,\n    clearCapture\n  } = useSmartSkeleton(contentRef);\n\n  const toggleExample = (exampleNumber: number) => {\n    setShowExample(exampleNumber);\n  };\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '800px', margin: '0 auto' }}>\n      <h1>Skeleton Loader Examples</h1>\n\n      <div\n        style={{\n          marginBottom: '2rem',\n          display: 'flex',\n          gap: '1rem',\n          flexWrap: 'wrap'\n        }}\n      >\n        <button onClick={() => toggleExample(1)}>Basic Components</button>\n        <button onClick={() => toggleExample(2)}>Manual Configurations</button>\n        <button onClick={() => toggleExample(3)}>Smart Detection</button>\n        <button onClick={() => toggleExample(4)}>Posts Skeleton</button>\n        <button onClick={() => toggleExample(5)}>Real Content</button>\n      </div>\n\n      {showExample === 1 && (\n        <div>\n          <h2>Basic Skeleton Components</h2>\n          <div\n            style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}\n          >\n            <div>\n              <h3>SkeletonText</h3>\n              <SkeletonText width=\\\"200px\\\" height=\\\"1rem\\\" />\n              <SkeletonText width=\\\"150px\\\" height=\\\"0.875rem\\\" />\n              <SkeletonText width=\\\"300px\\\" height=\\\"1.2rem\\\" />\n            </div>\n\n            <div>\n              <h3>SkeletonBox</h3>\n              <SkeletonBox width=\\\"100%\\\" height=\\\"100px\\\" />\n              <SkeletonBox width=\\\"200px\\\" height=\\\"50px\\\" />\n            </div>\n\n            <div>\n              <h3>SkeletonCircle</h3>\n              <div\n                style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}\n              >\n                <SkeletonCircle size=\\\"40px\\\" />\n                <SkeletonCircle size=\\\"60px\\\" />\n                <SkeletonCircle size=\\\"80px\\\" />\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showExample === 2 && (\n        <div>\n          <h2>Manual Skeleton Configurations</h2>\n\n          <div style={{ marginBottom: '2rem' }}>\n            <h3>Paragraph Configuration</h3>\n            <SkeletonLoader\n              config={{\n                type: 'manual',\n                customElements: [\n                  <SkeletonText key=\\\"p1\\\" width=\\\"90%\\\" height=\\\"1rem\\\" />,\n                  <SkeletonText key=\\\"p2\\\" width=\\\"85%\\\" height=\\\"1rem\\\" />,\n                  <SkeletonText key=\\\"p3\\\" width=\\\"70%\\\" height=\\\"1rem\\\" />\n                ]\n              }}\n            />\n          </div>\n\n          <div style={{ marginBottom: '2rem' }}>\n            <h3>Words Configuration</h3>\n            <SkeletonLoader\n              config={{\n                type: 'manual',\n                customElements: [\n                  <SkeletonText key=\\\"w1\\\" width=\\\"60px\\\" height=\\\"1rem\\\" />,\n                  <SkeletonText key=\\\"w2\\\" width=\\\"80px\\\" height=\\\"1rem\\\" />,\n                  <SkeletonText key=\\\"w3\\\" width=\\\"90px\\\" height=\\\"1rem\\\" />\n                ]\n              }}\n            />\n          </div>\n\n          <div style={{ marginBottom: '2rem' }}>\n            <h3>Boxes Configuration</h3>\n            <SkeletonLoader\n              config={{\n                type: 'manual',\n                customElements: [\n                  <SkeletonBox key=\\\"b1\\\" width=\\\"100%\\\" height=\\\"50px\\\" />,\n                  <SkeletonBox key=\\\"b2\\\" width=\\\"100%\\\" height=\\\"50px\\\" />,\n                  <SkeletonBox key=\\\"b3\\\" width=\\\"100%\\\" height=\\\"50px\\\" />\n                ]\n              }}\n            />\n          </div>\n\n          {capturedLayout && skeletonContent && (\n            <div style={{ marginBottom: '2rem' }}>\n              <h3>Generated Smart Skeleton</h3>\n              {skeletonContent}\n            </div>\n          )}\n        </div>\n      )}\n\n      {showExample === 3 && (\n        <div>\n          <h2>Smart Skeleton Detection</h2>\n          <div style={{ marginBottom: '1rem' }}>\n            <button onClick={captureLayout} disabled={isAnalyzing}>\n              Capture Current Layout\n            </button>\n            <button onClick={clearCapture} style={{ marginLeft: '1rem' }}>\n              Stop Capture\n            </button>\n          </div>\n\n          {isAnalyzing && <p>Analyzing layout...</p>}\n\n          {capturedLayout && skeletonContent && (\n            <div style={{ marginBottom: '2rem' }}>\n              <h3>Generated Smart Skeleton</h3>\n              {skeletonContent}\n            </div>\n          )}\n\n          <div\n            ref={contentRef}\n            style={{\n              border: '2px dashed #ccc',\n              padding: '1rem',\n              marginBottom: '2rem'\n            }}\n          >\n            <h3>Sample Content for Analysis</h3>\n            <div\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: '1rem',\n                marginBottom: '1rem'\n              }}\n            >\n              <div\n                style={{\n                  width: '50px',\n                  height: '50px',\n                  background: '#ddd',\n                  borderRadius: '50%'\n                }}\n              ></div>\n              <div>\n                <h4>Sample Title</h4>\n                <p>\n                  This is sample content that the smart skeleton will analyze.\n                </p>\n              </div>\n            </div>\n            <div\n              style={{ display: 'flex', gap: '0.5rem', marginBottom: '1rem' }}\n            >\n              <span\n                style={{\n                  background: '#e0e0e0',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem'\n                }}\n              >\n                Tag 1\n              </span>\n              <span\n                style={{\n                  background: '#e0e0e0',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem'\n                }}\n              >\n                Tag 2\n              </span>\n            </div>\n            <button style={{ marginRight: '0.5rem' }}>Action 1</button>\n            <button>Action 2</button>\n          </div>\n        </div>\n      )}\n\n      {showExample === 4 && (\n        <div>\n          <h2>Specialized Posts Skeleton</h2>\n\n          <div style={{ marginBottom: '2rem' }}>\n            <h3>Default Posts Skeleton</h3>\n            <SmartPostsSkeleton submissionCount={3} showPagination={true} />\n          </div>\n\n          <div style={{ marginBottom: '2rem' }}>\n            <h3>Thread Mode Posts Skeleton</h3>\n            <SmartPostsSkeleton\n              submissionCount={2}\n              showPagination={false}\n              enableThreadMode={true}\n            />\n          </div>\n        </div>\n      )}\n\n      {showExample === 5 && (\n        <div>\n          <h2>Real Content (For Comparison)</h2>\n          <div\n            style={{\n              border: '1px solid #ddd',\n              borderRadius: '8px',\n              padding: '1rem',\n              marginBottom: '1rem'\n            }}\n          >\n            <div\n              style={{\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginBottom: '0.75rem'\n              }}\n            >\n              <span style={{ fontWeight: 500 }}>John Doe</span>\n              <span style={{ color: '#666', fontSize: '0.875rem' }}>\n                2 hours ago\n              </span>\n            </div>\n            <h3\n              style={{\n                margin: '0 0 0.5rem 0',\n                fontSize: '1.125rem',\n                fontWeight: 600\n              }}\n            >\n              How to implement skeleton loaders in React\n            </h3>\n            <p style={{ margin: '0 0 0.75rem 0', color: '#666' }}>\n              A comprehensive guide to creating smooth loading states with\n              skeleton components.\n            </p>\n            <div\n              style={{\n                display: 'flex',\n                gap: '0.5rem',\n                marginBottom: '0.75rem'\n              }}\n            >\n              <span\n                style={{\n                  background: '#e0f2fe',\n                  color: '#0369a1',\n                  fontSize: '0.75rem',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem'\n                }}\n              >\n                React\n              </span>\n              <span\n                style={{\n                  background: '#e0f2fe',\n                  color: '#0369a1',\n                  fontSize: '0.75rem',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem'\n                }}\n              >\n                UI/UX\n              </span>\n              <span\n                style={{\n                  background: '#e0f2fe',\n                  color: '#0369a1',\n                  fontSize: '0.75rem',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem'\n                }}\n              >\n                TypeScript\n              </span>\n            </div>\n            <div style={{ display: 'flex', gap: '0.75rem' }}>\n              <button\n                style={{\n                  background: 'none',\n                  border: '1px solid #ddd',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem',\n                  cursor: 'pointer'\n                }}\n              >\n                Reply\n              </button>\n              <button\n                style={{\n                  background: 'none',\n                  border: '1px solid #ddd',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem',\n                  cursor: 'pointer'\n                }}\n              >\n                Expand (3)\n              </button>\n            </div>\n          </div>\n\n          <div\n            style={{\n              border: '1px solid #ddd',\n              borderRadius: '8px',\n              padding: '1rem',\n              marginBottom: '1rem'\n            }}\n          >\n            <div\n              style={{\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginBottom: '0.75rem'\n              }}\n            >\n              <span style={{ fontWeight: 500 }}>Jane Smith</span>\n              <span style={{ color: '#666', fontSize: '0.875rem' }}>\n                4 hours ago\n              </span>\n            </div>\n            <h3\n              style={{\n                margin: '0 0 0.5rem 0',\n                fontSize: '1.125rem',\n                fontWeight: 600\n              }}\n            >\n              Best practices for loading states\n            </h3>\n            <div\n              style={{\n                display: 'flex',\n                gap: '0.5rem',\n                marginBottom: '0.75rem'\n              }}\n            >\n              <span\n                style={{\n                  background: '#e0f2fe',\n                  color: '#0369a1',\n                  fontSize: '0.75rem',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem'\n                }}\n              >\n                Design\n              </span>\n            </div>\n            <div style={{ display: 'flex', gap: '0.75rem' }}>\n              <button\n                style={{\n                  background: 'none',\n                  border: '1px solid #ddd',\n                  padding: '0.25rem 0.5rem',\n                  borderRadius: '0.25rem',\n                  cursor: 'pointer'\n                }}\n              >\n                Reply\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SkeletonExamples;\n",
    "language":"typescript",
    "lines":420,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/banner-system/SimpleBannerSystem.tsx":{
    "content":"'use client';\n\n/**\n * Enhanced Simple Banner System\n *\n * Beautiful, animated banner system with live timers and modern UX.\n * Shows rate limit, timeout, and database alerts via polling with delightful interactions.\n */\n\nimport { useSession } from 'next-auth/react';\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState\n} from 'react';\n\n// Force logging function to bypass console silencer - but only for important events\nconst forceLog = (\n  message: string,\n  data?: any,\n  level: 'info' | 'warn' | 'error' | 'debug' = 'debug'\n) => {\n  // Only log errors and warnings now - remove debug spam\n  if (level === 'debug' || level === 'info') {\n    return;\n  }\n\n  if (typeof window !== 'undefined' && (window as any).__originalConsole) {\n    const logMethod =\n      (window as any).__originalConsole[level] ||\n      (window as any).__originalConsole.log;\n    logMethod(message, data);\n  }\n};\n\ninterface BannerData {\n  id: string;\n  type: string;\n  title: string;\n  message: string;\n  dismissible?: boolean;\n  priority?: number;\n  retryAfter?: number;\n  metadata?: Record<string, any>;\n  createdAt?: number;\n}\n\ninterface DatabaseAlert {\n  id: number;\n  title: string;\n  message?: string;\n  details?: string;\n  alert_type: string;\n  priority: number;\n  icon?: string;\n  dismissible: boolean;\n  persistent: boolean;\n  expires_at?: string;\n  actions?: any;\n  metadata?: any;\n}\n\n// Helper function to create a stable key for banner comparison\nconst createBannerKey = (banner: BannerData): string => {\n  return `${banner.id}-${banner.type}-${banner.title}-${banner.message}-${banner.priority}-${banner.dismissible}`;\n};\n\n// Helper function to check if two banner arrays are equivalent\nconst areBannersEqual = (prev: BannerData[], next: BannerData[]): boolean => {\n  if (prev.length !== next.length) return false;\n\n  const prevKeys = prev.map(createBannerKey).sort();\n  const nextKeys = next.map(createBannerKey).sort();\n\n  return prevKeys.every((key, index) => key === nextKeys[index]);\n};\n\n// Helper function to clean up old dismissed alerts from localStorage\nconst cleanupDismissedAlerts = () => {\n  try {\n    const dismissedAlerts = JSON.parse(\n      localStorage.getItem('dismissedAlerts') || '[]'\n    );\n    const oneWeekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000; // 7 days\n\n    // For now, we'll just limit to 50 most recent dismissals to prevent unbounded growth\n    // In the future, we could store dismissal timestamps and clean by date\n    if (dismissedAlerts.length > 50) {\n      const recentDismissals = dismissedAlerts.slice(-50);\n      localStorage.setItem('dismissedAlerts', JSON.stringify(recentDismissals));\n    }\n  } catch (error) {\n    // If localStorage is corrupted, reset it\n    localStorage.removeItem('dismissedAlerts');\n  }\n};\n\nexport function useSimpleBanners() {\n  const [banners, setBanners] = useState<BannerData[]>([]);\n  const { data: session } = useSession();\n  const lastFetchRef = useRef<string>(''); // Track last successful fetch signature\n\n  // Clean up dismissed alerts on component mount\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      cleanupDismissedAlerts();\n    }\n  }, []);\n\n  // Check for all types of banners via polling\n  useEffect(() => {\n    const checkForBanners = async () => {\n      try {\n        const newBanners: BannerData[] = [];\n\n        // 1. Check for database alerts (for all users - testing mode)\n        try {\n          const alertsResponse = await fetch('/api/alerts/active');\n\n          if (alertsResponse.ok) {\n            const dbAlerts: DatabaseAlert[] = await alertsResponse.json();\n\n            // For anonymous users, filter out dismissed alerts from localStorage\n            let dismissedAlerts: string[] = [];\n            if (!session?.user?.id) {\n              try {\n                dismissedAlerts = JSON.parse(\n                  localStorage.getItem('dismissedAlerts') || '[]'\n                );\n              } catch (error) {\n                forceLog(\n                  'Failed to parse dismissed alerts from localStorage:',\n                  error\n                );\n              }\n            }\n\n            dbAlerts.forEach((alert) => {\n              // Skip alerts that anonymous users have dismissed\n              if (\n                !session?.user?.id &&\n                dismissedAlerts.includes(alert.id.toString())\n              ) {\n                return;\n              }\n\n              const bannerData = {\n                id: `alert-${alert.id}`,\n                type: alert.alert_type,\n                title: alert.title,\n                message: alert.message || alert.details || '',\n                dismissible: alert.dismissible,\n                priority: alert.priority,\n                createdAt: Date.now(),\n                metadata: {\n                  ...alert.metadata,\n                  icon: alert.icon,\n                  actions: alert.actions,\n                  expiresAt: alert.expires_at,\n                  persistent: alert.persistent\n                }\n              };\n              newBanners.push(bannerData);\n            });\n          }\n        } catch (error) {\n          forceLog('Failed to fetch database alerts:', error, 'error');\n        }\n\n        // 2. Check for timeouts (authenticated users only)\n        if (session?.user?.id) {\n          try {\n            const timeoutResponse = await fetch(\n              '/api/user/timeout?type=post_creation',\n              {\n                credentials: 'include' // Ensure authentication headers are sent\n              }\n            );\n            if (timeoutResponse.ok) {\n              const timeoutInfo = await timeoutResponse.json();\n\n              if (timeoutInfo.is_timed_out && timeoutInfo.expires_at) {\n                newBanners.push({\n                  id: 'timeout-banner',\n                  type: 'timeout',\n                  title: 'Account Temporarily Restricted',\n                  message:\n                    'You are temporarily restricted from creating posts.',\n                  dismissible: true,\n                  priority: 90,\n                  createdAt: Date.now(),\n                  metadata: {\n                    reason: timeoutInfo.reason,\n                    expiresAt: timeoutInfo.expires_at\n                  }\n                });\n              }\n            } else if (timeoutResponse.status === 401) {\n              // User session expired, don't log this as an error\n              forceLog(\n                'User session expired, skipping timeout check',\n                null,\n                'debug'\n              );\n            }\n          } catch (error) {\n            forceLog('Failed to fetch timeout info:', error, 'error');\n          }\n        }\n\n        // 3. Check sessionStorage for rate limit info (set by fetch interceptor)\n        const rateLimitInfo = sessionStorage.getItem('rate-limit-info');\n        if (rateLimitInfo) {\n          try {\n            const info = JSON.parse(rateLimitInfo);\n            if (info.retryAfter && info.retryAfter > 0) {\n              newBanners.push({\n                id: 'rate-limit-banner',\n                type: 'rate-limit',\n                title: 'Rate Limit Exceeded',\n                message: info.error || 'Too many requests. Please slow down.',\n                dismissible: true,\n                priority: 100,\n                retryAfter: info.retryAfter,\n                createdAt: Date.now(),\n                metadata: {\n                  quotaType: info.quotaType,\n                  penaltyLevel: info.penaltyLevel,\n                  isAttack: info.penaltyLevel >= 3\n                }\n              });\n              sessionStorage.removeItem('rate-limit-info');\n            }\n          } catch (error) {\n            forceLog('Failed to parse rate limit info:', error, 'error');\n            sessionStorage.removeItem('rate-limit-info');\n          }\n        }\n\n        // Create a signature of the current fetch to compare with previous\n        const currentSignature = JSON.stringify(\n          newBanners.map(createBannerKey).sort()\n        );\n\n        // Only update state if data actually changed\n        if (lastFetchRef.current !== currentSignature) {\n          lastFetchRef.current = currentSignature;\n\n          setBanners((prev) => {\n            // Merge with existing banners, avoiding duplicates\n            const existingIds = new Set(prev.map((b) => b.id));\n            const filteredNew = newBanners.filter(\n              (b) => !existingIds.has(b.id)\n            );\n\n            // Keep existing banners that are still valid\n            const validExisting = prev.filter((banner) => {\n              // Keep rate limit banners if they still have time left\n              if (banner.type === 'rate-limit' && banner.retryAfter) {\n                const elapsed = (Date.now() - (banner.createdAt || 0)) / 1000;\n                return elapsed < banner.retryAfter;\n              }\n              // Keep other banners if they match new data\n              return newBanners.some((nb) => nb.id === banner.id);\n            });\n\n            const finalBanners = [...validExisting, ...filteredNew];\n\n            // Double-check: only return new array if actually different\n            if (areBannersEqual(prev, finalBanners)) {\n              return prev; // Return same reference to prevent rerender\n            }\n\n            return finalBanners;\n          });\n        }\n      } catch (error) {\n        forceLog('Error checking for banners:', error, 'error');\n      }\n    };\n\n    // Check immediately and then every 5 seconds (more responsive)\n    checkForBanners();\n    const interval = setInterval(checkForBanners, 5000);\n\n    // Listen for manual refresh events\n    const handleRefresh = () => checkForBanners();\n    window.addEventListener('refresh-alerts', handleRefresh);\n\n    // Listen for admin panel changes\n    const handleAdminChange = () => {\n      // Immediate refresh when admin makes changes\n      setTimeout(checkForBanners, 100); // Small delay to let the API update\n    };\n    window.addEventListener('alert-admin-change', handleAdminChange);\n\n    return () => {\n      clearInterval(interval);\n      window.removeEventListener('refresh-alerts', handleRefresh);\n      window.removeEventListener('alert-admin-change', handleAdminChange);\n    };\n  }, [session?.user?.id]);\n\n  const dismissBanner = useCallback(\n    (id: string) => {\n      setBanners((prev) => prev.filter((b) => b.id !== id));\n\n      // If dismissing a database alert, record the dismissal\n      if (id.startsWith('alert-')) {\n        const alertId = id.replace('alert-', '');\n\n        if (session?.user?.id) {\n          // Authenticated user - record dismissal in database\n          fetch(`/api/alerts/${alertId}/dismiss`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' }\n          }).catch((error) => {\n            forceLog('Failed to record alert dismissal:', error);\n          });\n        } else {\n          // Anonymous user - store dismissal in localStorage\n          try {\n            const dismissedAlerts = JSON.parse(\n              localStorage.getItem('dismissedAlerts') || '[]'\n            );\n            if (!dismissedAlerts.includes(alertId)) {\n              dismissedAlerts.push(alertId);\n              localStorage.setItem(\n                'dismissedAlerts',\n                JSON.stringify(dismissedAlerts)\n              );\n            }\n          } catch (error) {\n            forceLog('Failed to store dismissal in localStorage:', error);\n          }\n        }\n      }\n    },\n    [session?.user?.id]\n  );\n\n  return {\n    banners,\n    dismissBanner\n  };\n}\n\nconst Banner = React.memo(function Banner({\n  banner,\n  onDismiss\n}: {\n  banner: BannerData;\n  onDismiss: (id: string) => void;\n}) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [timeLeft, setTimeLeft] = useState(banner.retryAfter || 0);\n  const [progress, setProgress] = useState(100);\n\n  // Animation entrance\n  useEffect(() => {\n    const timer = setTimeout(() => setIsVisible(true), 100);\n    return () => clearTimeout(timer);\n  }, []);\n\n  // Live countdown timer - memoized to prevent unnecessary recalculations\n  useEffect(() => {\n    if (!banner.retryAfter) return;\n\n    const startTime = banner.createdAt || Date.now();\n    const endTime = startTime + banner.retryAfter * 1000;\n\n    const updateTimer = () => {\n      const now = Date.now();\n      const remaining = Math.max(0, Math.ceil((endTime - now) / 1000));\n      const progressPercent =\n        banner.retryAfter && banner.retryAfter > 0\n          ? Math.max(0, (remaining / banner.retryAfter) * 100)\n          : 0;\n\n      setTimeLeft(remaining);\n      setProgress(progressPercent);\n\n      if (remaining <= 0) {\n        handleDismiss();\n      }\n    };\n\n    updateTimer();\n    const interval = setInterval(updateTimer, 1000);\n    return () => clearInterval(interval);\n  }, [banner.retryAfter, banner.createdAt]);\n\n  const handleDismiss = useCallback(() => {\n    setIsVisible(false);\n    setTimeout(() => onDismiss(banner.id), 300);\n  }, [banner.id, onDismiss]);\n\n  const formatTime = useCallback((seconds: number) => {\n    if (seconds >= 60) {\n      const mins = Math.floor(seconds / 60);\n      const secs = seconds % 60;\n      return `${mins}m ${secs}s`;\n    }\n    return `${seconds}s`;\n  }, []);\n\n  const config = useMemo(() => {\n    const isRateLimit = banner.type === 'rate-limit';\n    const isAttack = banner.metadata?.isAttack;\n    const isTimeout = banner.type === 'timeout';\n\n    // Use custom icon if provided\n    const customIcon = banner.metadata?.icon;\n\n    if (isAttack) {\n      return {\n        icon: customIcon || '\ud83d\udea8',\n        bgGradient: 'linear-gradient(135deg, #fee2e2, #fecaca)',\n        borderColor: '#f87171',\n        textColor: '#991b1b',\n        accentColor: '#ef4444',\n        progressColor: '#f87171'\n      };\n    }\n\n    if (isRateLimit) {\n      return {\n        icon: customIcon || '\u26a1',\n        bgGradient: 'linear-gradient(135deg, #fef3c7, #fde68a)',\n        borderColor: '#f59e0b',\n        textColor: '#92400e',\n        accentColor: '#f59e0b',\n        progressColor: '#fbbf24'\n      };\n    }\n\n    if (isTimeout) {\n      return {\n        icon: customIcon || '\u23f0',\n        bgGradient: 'linear-gradient(135deg, #fed7aa, #fdba74)',\n        borderColor: '#f97316',\n        textColor: '#9a3412',\n        accentColor: '#f97316',\n        progressColor: '#fb923c'\n      };\n    }\n\n    // Handle different alert types from database\n    switch (banner.type) {\n      case 'warning':\n        return {\n          icon: customIcon || '\u26a0\ufe0f',\n          bgGradient: 'linear-gradient(135deg, #fef3c7, #fde68a)',\n          borderColor: '#f59e0b',\n          textColor: '#92400e',\n          accentColor: '#f59e0b',\n          progressColor: '#fbbf24'\n        };\n\n      case 'error':\n        return {\n          icon: customIcon || '\u274c',\n          bgGradient: 'linear-gradient(135deg, #fee2e2, #fecaca)',\n          borderColor: '#f87171',\n          textColor: '#991b1b',\n          accentColor: '#ef4444',\n          progressColor: '#f87171'\n        };\n\n      case 'success':\n        return {\n          icon: customIcon || '\u2705',\n          bgGradient: 'linear-gradient(135deg, #d1fae5, #a7f3d0)',\n          borderColor: '#34d399',\n          textColor: '#065f46',\n          accentColor: '#10b981',\n          progressColor: '#34d399'\n        };\n\n      case 'maintenance':\n        return {\n          icon: customIcon || '\ud83d\udd27',\n          bgGradient: 'linear-gradient(135deg, #e0e7ff, #c7d2fe)',\n          borderColor: '#818cf8',\n          textColor: '#3730a3',\n          accentColor: '#6366f1',\n          progressColor: '#818cf8'\n        };\n\n      default:\n        return {\n          icon: customIcon || '\u2139\ufe0f',\n          bgGradient: 'linear-gradient(135deg, #dbeafe, #bfdbfe)',\n          borderColor: '#60a5fa',\n          textColor: '#1e40af',\n          accentColor: '#3b82f6',\n          progressColor: '#60a5fa'\n        };\n    }\n  }, [banner.type, banner.metadata?.isAttack, banner.metadata?.icon]);\n\n  return (\n    <div\n      style={{\n        width: '100%',\n        transform: isVisible\n          ? 'translateY(0) scale(1)'\n          : 'translateY(-10px) scale(0.98)',\n        opacity: isVisible ? 1 : 0,\n        transition: 'all 0.3s ease-out',\n        marginBottom: '8px'\n      }}\n    >\n      <div\n        style={{\n          position: 'relative',\n          overflow: 'hidden',\n          borderRadius: '8px',\n          boxShadow: '0 4px 12px rgba(0, 0, 0, 0.1)',\n          borderLeft: `4px solid ${config.borderColor}`,\n          background: config.bgGradient,\n          minHeight: '60px',\n          width: '100%'\n        }}\n      >\n        {/* Progress bar for timed banners */}\n        {banner.retryAfter && (\n          <div\n            style={{\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              right: 0,\n              height: '3px',\n              background: 'rgba(0, 0, 0, 0.1)'\n            }}\n          >\n            <div\n              style={{\n                height: '100%',\n                background: config.progressColor,\n                width: `${progress}%`,\n                transition: 'width 1s linear'\n              }}\n            />\n          </div>\n        )}\n\n        <div style={{ padding: '12px 16px' }}>\n          <div\n            style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}\n          >\n            {/* Icon */}\n            <div style={{ flexShrink: 0, fontSize: '20px' }}>{config.icon}</div>\n\n            {/* Content */}\n            <div style={{ flex: 1, minWidth: 0 }}>\n              <h4\n                style={{\n                  fontWeight: '600',\n                  fontSize: '16px',\n                  color: config.textColor,\n                  margin: '0 0 4px 0',\n                  lineHeight: '1.3'\n                }}\n              >\n                {banner.title}\n              </h4>\n\n              {banner.message && (\n                <p\n                  style={{\n                    fontSize: '14px',\n                    color: config.textColor,\n                    opacity: 0.9,\n                    lineHeight: '1.4',\n                    margin: '0'\n                  }}\n                >\n                  {banner.message}\n                </p>\n              )}\n\n              {/* Live countdown */}\n              {timeLeft > 0 && (\n                <div\n                  style={{\n                    marginTop: '8px',\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '6px'\n                  }}\n                >\n                  <div\n                    style={{\n                      width: '6px',\n                      height: '6px',\n                      borderRadius: '50%',\n                      background: config.accentColor,\n                      animation: 'pulse 2s infinite'\n                    }}\n                  />\n                  <span\n                    style={{\n                      fontSize: '12px',\n                      fontWeight: '500',\n                      color: config.textColor\n                    }}\n                  >\n                    Try again in {formatTime(timeLeft)}\n                  </span>\n                </div>\n              )}\n\n              {/* Additional info */}\n              {banner.metadata?.reason && (\n                <p\n                  style={{\n                    fontSize: '11px',\n                    marginTop: '6px',\n                    color: config.textColor,\n                    opacity: 0.75\n                  }}\n                >\n                  Reason: {banner.metadata.reason}\n                </p>\n              )}\n            </div>\n\n            {/* Dismiss button */}\n            {banner.dismissible && (\n              <button\n                onClick={handleDismiss}\n                style={{\n                  flexShrink: 0,\n                  padding: '8px',\n                  borderRadius: '50%',\n                  background: 'rgba(255, 255, 255, 0.2)',\n                  border: 'none',\n                  color: config.textColor,\n                  cursor: 'pointer',\n                  transition: 'all 0.2s ease',\n                  fontSize: '14px',\n                  width: '28px',\n                  height: '28px',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center'\n                }}\n                onMouseEnter={(e) => {\n                  e.currentTarget.style.background = 'rgba(255, 255, 255, 0.3)';\n                  e.currentTarget.style.transform = 'scale(1.1)';\n                }}\n                onMouseLeave={(e) => {\n                  e.currentTarget.style.background = 'rgba(255, 255, 255, 0.2)';\n                  e.currentTarget.style.transform = 'scale(1)';\n                }}\n                aria-label=\\\"Dismiss notification\\\"\n              >\n                \u2715\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default function SimpleBannerSystem() {\n  const { banners, dismissBanner } = useSimpleBanners();\n  const { data: session } = useSession();\n\n  // Add global refresh function for testing (but remove debug logging)\n  useEffect(() => {\n    (window as any).__refreshBanners = () => {\n      window.dispatchEvent(new CustomEvent('refresh-alerts'));\n    };\n\n    (window as any).__bannerDebug = () => {\n      const dismissedAlerts = localStorage.getItem('dismissedAlerts');\n      return {\n        bannerCount: banners.length,\n        banners: banners,\n        isSimpleBannerSystemMounted: true,\n        dismissedAlerts: dismissedAlerts ? JSON.parse(dismissedAlerts) : [],\n        isAuthenticated: !!session?.user?.id\n      };\n    };\n\n    // Debug helper to clear dismissed alerts\n    (window as any).__clearDismissedAlerts = () => {\n      localStorage.removeItem('dismissedAlerts');\n      window.dispatchEvent(new CustomEvent('refresh-alerts'));\n      return 'Dismissed alerts cleared and banners refreshed';\n    };\n  }, [banners, session?.user?.id]);\n\n  // Memoize sorted banners to prevent unnecessary re-sorts\n  const sortedBanners = useMemo(() => {\n    return banners.sort((a, b) => (b.priority || 0) - (a.priority || 0));\n  }, [banners]);\n\n  if (banners.length === 0) {\n    return null; // Don't show anything when no banners\n  }\n\n  return (\n    <div\n      style={{\n        position: 'sticky',\n        top: 0,\n        left: 0,\n        right: 0,\n        zIndex: 9999,\n        pointerEvents: 'auto',\n        width: '100%'\n      }}\n    >\n      <div\n        style={{\n          width: '100%'\n        }}\n      >\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>\n          {/* Banners with proper React keys for optimal rendering */}\n          {sortedBanners.map((banner, index) => (\n            <div\n              key={createBannerKey(banner)} // Stable key that includes content\n              style={{\n                width: '100%',\n                transform: 'translateY(0) scale(1)',\n                opacity: 1,\n                transition: 'all 0.3s ease-out',\n                animationDelay: `${index * 100}ms`,\n                animationFillMode: 'both'\n              }}\n            >\n              <Banner banner={banner} onDismiss={dismissBanner} />\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":749,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/comment/CommentForm.tsx":{
    "content":"'use client';\nimport { useState } from 'react';\nimport { createComment } from 'src/lib/actions/comment.actions';\nimport './CommentForm.css';\n\ninterface CommentFormProps {\n  postId: string;\n}\n\nexport default function CommentForm({ postId }: CommentFormProps) {\n  const [content, setContent] = useState('');\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      // @ts-ignore alpha feature incomplete\n      await createComment({ content, postId });\n      setContent('');\n    } catch (error) {\n      console.error('Error creating comment:', error);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\\\"comment-form\\\">\n      <div className=\\\"comment-form__field\\\">\n        <textarea\n          value={content}\n          onChange={(e) => setContent(e.target.value)}\n          placeholder=\\\"Write a comment...\\\"\n          required\n          className=\\\"comment-form__textarea\\\"\n        />\n      </div>\n      <button type=\\\"submit\\\" className=\\\"comment-form__submit\\\">\n        Post Comment\n      </button>\n    </form>\n  );\n}\n",
    "language":"typescript",
    "lines":41,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/comment/CommentItem.tsx":{
    "content":"import { Comment } from '../../../lib/types';\nimport { TimestampWithTooltip } from '../ui/TimestampWithTooltip';\nimport './CommentItem.css';\n\ninterface CommentItemProps {\n  comment: Comment;\n}\n\nexport default function CommentItem({ comment }: CommentItemProps) {\n  return (\n    <li className=\\\"comment-item\\\">\n      <div className=\\\"comment-item__content\\\">\n        <p className=\\\"comment-item__meta\\\">\n          Posted by u/{comment.authorId} \u2022{' '}\n          <TimestampWithTooltip date={comment.createdAt} />\n        </p>\n        <p className=\\\"comment-item__text\\\">{comment.content}</p>\n      </div>\n    </li>\n  );\n}\n",
    "language":"typescript",
    "lines":22,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/comment/CommentList.tsx":{
    "content":"import { Comment } from 'src/lib/schemas/comment.schemas';\nimport CommentItem from './CommentItem';\n\ninterface CommentListProps {\n  comments: Comment[];\n}\n\nexport default function CommentList({ comments }: CommentListProps) {\n  return (\n    <div className=\\\"comment-list\\\">\n      <ul className=\\\"comment-list__items\\\">\n        {comments.map((comment) => (\n          <CommentItem key={comment.id} comment={comment} />\n        ))}\n      </ul>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":19,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/galaxy-link/GalaxyLink.tsx":{
    "content":"import { NAV_PATHS } from 'src/lib/routes';\nimport { LinkTooltip } from '../tooltip/LinkTooltip';\nimport { InstantLink } from '../ui/InstantLink';\n\nexport const GalaxyLink = () => (\n  <LinkTooltip\n    url={NAV_PATHS.GALAXY}\n    enableExtendedPreview\n    enableCtrlClick\n    isInsideParagraph\n  >\n    <InstantLink target=\\\"_blank\\\" href={NAV_PATHS.GALAXY}>\n      Galaxy\n    </InstantLink>\n  </LinkTooltip>\n);\n",
    "language":"typescript",
    "lines":17,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-content/PageContent.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport PageContent from './PageContent';\n\ndescribe('PageContent', () => {\n  it('renders children correctly', () => {\n    const TestChild = () => <div>Test Child</div>;\n    const { getByText } = render(\n      <PageContent>\n        <TestChild />\n      </PageContent>\n    );\n\n    expect(getByText('Test Child')).toBeInTheDocument();\n  });\n\n  it('has the correct CSS class', () => {\n    const { container } = render(\n      <PageContent>\n        <div>Test</div>\n      </PageContent>\n    );\n\n    expect(container.firstChild).toHaveClass('page-content__section');\n  });\n});\n",
    "language":"typescript",
    "lines":26,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/page-content/PageContent.tsx":{
    "content":"import React from 'react';\nimport './PageContent.css';\n\nexport default function PageContent({\n  children\n}: {\n  children: React.ReactNode;\n}) {\n  return <section className=\\\"page-content__section\\\">{children}</section>;\n}\n",
    "language":"typescript",
    "lines":11,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/discord-embed/DiscordEmbed.test.tsx":{
    "content":"import { render } from '@testing-library/react';\nimport { DISCORD_EMBED_SELECTORS } from '../../../lib/test-selectors/components/discord-embed.selectors';\nimport { DiscordEmbed } from './DiscordEmbed';\n\ndescribe('DiscordEmbed', () => {\n  it('renders the iframe with correct attributes', () => {\n    const { getByTestId } = render(<DiscordEmbed />);\n    const iframe = getByTestId(DISCORD_EMBED_SELECTORS.IFRAME);\n\n    expect(iframe).toBeInTheDocument();\n    expect(iframe).toHaveClass('discord-embed');\n    expect(iframe).toHaveAttribute(\n      'src',\n      'https://discord.com/widget?id=1234783462335189080&theme=dark'\n    );\n    expect(iframe).toHaveAttribute('width', '350');\n    expect(iframe).toHaveAttribute('height', '600');\n    expect(iframe).toHaveAttribute('allowtransparency', 'true');\n    expect(iframe).toHaveAttribute('frameBorder', '0');\n    expect(iframe).toHaveAttribute(\n      'sandbox',\n      'allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts'\n    );\n  });\n});\n",
    "language":"typescript",
    "lines":26,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/discord-embed/DiscordEmbed.tsx":{
    "content":"'use client';\nimport React from 'react';\nimport { DISCORD_EMBED_SELECTORS } from '../../../lib/test-selectors/components/discord-embed.selectors';\nimport './DiscordEmbed.css';\n\nexport const DiscordEmbed: React.FC = () => {\n  return (\n    <iframe\n      data-testid={DISCORD_EMBED_SELECTORS.IFRAME}\n      className=\\\"discord-embed\\\"\n      src=\\\"https://discord.com/widget?id=1234783462335189080&theme=dark\\\"\n      width=\\\"350\\\"\n      height=\\\"600\\\"\n      // @ts-expect-error\n      allowtransparency=\\\"true\\\"\n      frameBorder=\\\"0\\\"\n      sandbox=\\\"allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts\\\"\n    ></iframe>\n  );\n};\n",
    "language":"typescript",
    "lines":21,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/recent-tags/RecentTags.tsx":{
    "content":"import { CustomSession } from 'src/auth.config';\nimport { auth } from 'src/lib/auth';\nimport { getRecentTags } from './actions';\nimport './RecentTags.css';\nimport { RecentTagsClient } from './RecentTagsClient';\n\nexport async function RecentTags({\n  contextId,\n  onlyMine = false\n}: {\n  contextId: string;\n  onlyMine?: boolean;\n}) {\n  const session = (await auth()) as CustomSession | null;\n  const initialRecentTags = await getRecentTags(\n    'months',\n    onlyMine && session?.user?.id ? session.user.id : undefined\n  );\n\n  return (\n    <RecentTagsClient\n      contextId={contextId}\n      onlyMine={onlyMine}\n      initialRecentTags={initialRecentTags}\n      session={session}\n    />\n  );\n}\n",
    "language":"typescript",
    "lines":29,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/recent-tags/RecentTags.test.tsx":{
    "content":"import { fireEvent, render, screen, waitFor } from '@testing-library/react';\nimport { Provider } from 'jotai';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { EMPTY_SELECTORS } from 'src/lib/test-selectors/components/empty.selectors';\nimport { auth } from '../../../lib/auth';\nimport { getRecentTags } from './actions';\nimport { RecentTags } from './RecentTags';\nimport { RecentTagsClient } from './RecentTagsClient';\n\n// Mock the modules\njest.mock('../../../lib/auth', () => ({\n  auth: jest.fn()\n}));\n\njest.mock('./actions', () => ({\n  getRecentTags: jest.fn()\n}));\n\njest.mock('next/navigation', () => ({\n  useRouter: jest.fn(),\n  useSearchParams: jest.fn()\n}));\n\n// Mock the TagLink component (it has hooks that are not needed to be accurate for this test suite)\njest.mock('../tag-link/TagLink', () => ({\n  TagLink: ({ value }: { value: string }) => <span>#{value}</span>\n}));\n\n// Mock the atoms module with a proper atom factory\njest.mock('../../../lib/state/atoms', () => {\n  const mockAtom = {\n    read: jest.fn(),\n    write: jest.fn()\n  };\n  return {\n    getSubmissionsFiltersAtom: jest.fn().mockReturnValue(mockAtom),\n    getSubmissionsStateAtom: jest.fn().mockReturnValue(mockAtom)\n  };\n});\n\n// Mock Jotai with proper initial state structure\njest.mock('jotai', () => ({\n  ...jest.requireActual('jotai'),\n  useAtom: jest.fn()\n}));\n\ndescribe('RecentTags', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it('calls getRecentTags with correct parameters when authenticated but onlyMine=false', async () => {\n    // Mock the auth and getRecentTags functions\n    (auth as jest.Mock).mockResolvedValue({\n      user: { id: '123' }\n    });\n    (getRecentTags as jest.Mock).mockResolvedValue({\n      tags: ['tag1', 'tag2', 'tag3'],\n      error: '',\n      message: ''\n    });\n\n    // Call the server component function with onlyMine=false (default)\n    await RecentTags({ contextId: 'test' });\n\n    // Verify that getRecentTags was called with undefined when onlyMine=false\n    expect(getRecentTags).toHaveBeenCalledWith('months', undefined);\n  });\n\n  it('calls getRecentTags with correct parameters for onlyMine', async () => {\n    (auth as jest.Mock).mockResolvedValue({\n      user: { id: '123' }\n    });\n    (getRecentTags as jest.Mock).mockResolvedValue({\n      tags: ['userTag1', 'userTag2'],\n      error: '',\n      message: ''\n    });\n\n    // Call the server component function with onlyMine\n    const result = await RecentTags({\n      contextId: 'test',\n      onlyMine: true\n    });\n\n    // Check that the component rendered and getRecentTags was called correctly\n    expect(getRecentTags).toHaveBeenCalledWith('months', '123');\n    expect(result).toBeDefined();\n  });\n\n  it('handles unauthenticated user', async () => {\n    (auth as jest.Mock).mockResolvedValue(null);\n    (getRecentTags as jest.Mock).mockResolvedValue({\n      tags: ['publicTag1'],\n      error: '',\n      message: ''\n    });\n\n    // Call the server component function\n    await RecentTags({ contextId: 'test' });\n\n    // Should call getRecentTags with undefined for unauthenticated users\n    expect(getRecentTags).toHaveBeenCalledWith('months', undefined);\n  });\n});\n\ndescribe('RecentTagsClient', () => {\n  const mockPush = jest.fn();\n  const mockSearchParams = new URLSearchParams();\n  const mockSetFiltersState = jest.fn();\n\n  const mockSession = {\n    user: {\n      id: 'test-user-id'\n    },\n    expires: '2024-12-31T23:59:59.999Z'\n  } as any;\n\n  const defaultProps = {\n    contextId: 'test',\n    onlyMine: false,\n    initialRecentTags: { tags: ['javascript', 'react', 'typescript'] },\n    session: mockSession\n  };\n\n  // Default mock state for the filters atom\n  const mockFiltersState = {\n    onlyMine: false,\n    providerAccountId: 'test-user-id',\n    filters: [],\n    page: 1,\n    pageSize: 10,\n    initialized: true\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (useRouter as jest.Mock).mockReturnValue({\n      push: mockPush\n    });\n    (useSearchParams as jest.Mock).mockReturnValue(mockSearchParams);\n\n    // Mock getRecentTags to resolve immediately\n    (getRecentTags as jest.Mock).mockResolvedValue({\n      tags: ['javascript', 'react', 'typescript'],\n      error: '',\n      message: ''\n    });\n\n    // Mock useAtom to return the proper state structure\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      mockFiltersState,\n      mockSetFiltersState\n    ]);\n  });\n\n  it('renders recent tags correctly', async () => {\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    expect(screen.getByText('Recent Tags')).toBeInTheDocument();\n    expect(screen.getByText('#javascript')).toBeInTheDocument();\n    expect(screen.getByText('#react')).toBeInTheDocument();\n    expect(screen.getByText('#typescript')).toBeInTheDocument();\n  });\n\n  it('does not show AND/OR toggle with single tag selected', async () => {\n    // Mock state with single tag\n    const singleTagFiltersState = {\n      ...mockFiltersState,\n      filters: [{ name: 'tags', value: 'javascript' }]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      singleTagFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Should not show the toggle\n    expect(screen.queryByText('OR')).not.toBeInTheDocument();\n    expect(screen.queryByText('ANY')).not.toBeInTheDocument();\n    expect(screen.queryByText('ALL')).not.toBeInTheDocument();\n  });\n\n  it('shows AND/OR toggle with multiple tags selected', async () => {\n    // Mock state with multiple tags - separate filter entries for each tag\n    const multiTagFiltersState = {\n      ...mockFiltersState,\n      filters: [\n        { name: 'tags', value: '#javascript' },\n        { name: 'tags', value: '#react' }\n      ]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      multiTagFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Should show the toggle\n    expect(screen.getByText('OR')).toBeInTheDocument();\n    expect(screen.queryByText('ANY')).not.toBeInTheDocument();\n    expect(screen.queryByText('ALL')).not.toBeInTheDocument();\n  });\n\n  it('handles tag selection correctly', async () => {\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Click on a tag\n    const tagButton = screen.getByText('#javascript');\n    fireEvent.click(tagButton);\n\n    // Should call setFiltersState to add the tag\n    await waitFor(() => {\n      expect(mockSetFiltersState).toHaveBeenCalled();\n    });\n  });\n\n  it('handles multiple tag selection correctly', async () => {\n    // Start with one tag selected\n    const oneTagFiltersState = {\n      ...mockFiltersState,\n      filters: [{ name: 'tags', value: 'javascript' }]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      oneTagFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Click on another tag\n    const reactButton = screen.getByText('#react');\n    fireEvent.click(reactButton);\n\n    // Should call setFiltersState to add the second tag\n    await waitFor(() => {\n      expect(mockSetFiltersState).toHaveBeenCalled();\n    });\n  });\n\n  it('handles AND/OR logic toggle correctly', async () => {\n    // Mock state with multiple tags and OR logic - separate filter entries\n    const multiTagFiltersState = {\n      ...mockFiltersState,\n      filters: [\n        { name: 'tags', value: '#javascript' },\n        { name: 'tags', value: '#react' },\n        { name: 'tagLogic', value: 'OR' }\n      ]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      multiTagFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Find and click the OR button to switch from OR to AND\n    const orButton = screen.getByRole('button', {\n      name: 'OR'\n    });\n    fireEvent.click(orButton);\n\n    // Should call setFiltersState to update logic to AND\n    await waitFor(() => {\n      expect(mockSetFiltersState).toHaveBeenCalled();\n    });\n  });\n\n  it('updates smart title based on selected tags and logic', async () => {\n    // Mock state with multiple tags and AND logic - separate filter entries\n    const multiTagAndFiltersState = {\n      ...mockFiltersState,\n      filters: [\n        { name: 'tags', value: '#javascript' },\n        { name: 'tags', value: '#react' },\n        { name: 'tagLogic', value: 'AND' }\n      ]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      multiTagAndFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Should show smart title with \\\"all of\\\"\n    expect(\n      screen.getByText(/Posts with all of: #javascript, #react/)\n    ).toBeInTheDocument();\n  });\n\n  it('updates smart title for OR logic', async () => {\n    // Mock state with multiple tags and OR logic - separate filter entries\n    const multiTagOrFiltersState = {\n      ...mockFiltersState,\n      filters: [\n        { name: 'tags', value: '#javascript' },\n        { name: 'tags', value: '#react' },\n        { name: 'tagLogic', value: 'OR' }\n      ]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      multiTagOrFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Should show smart title with \\\"any of\\\"\n    expect(\n      screen.getByText(/Posts with any of: #javascript, #react/)\n    ).toBeInTheDocument();\n  });\n\n  it('handles tag removal correctly', async () => {\n    // Mock state with multiple tags - separate filter entries\n    const multiTagFiltersState = {\n      ...mockFiltersState,\n      filters: [\n        { name: 'tags', value: '#javascript' },\n        { name: 'tags', value: '#react' }\n      ]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      multiTagFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Click on an already selected tag to remove it\n    const tagButton = screen.getByText('#javascript');\n    fireEvent.click(tagButton);\n\n    // Should call setFiltersState to remove the tag\n    await waitFor(() => {\n      expect(mockSetFiltersState).toHaveBeenCalled();\n    });\n  });\n\n  it('clears all filters when removing last tag', async () => {\n    // Mock state with single tag\n    const singleTagFiltersState = {\n      ...mockFiltersState,\n      filters: [{ name: 'tags', value: 'javascript' }]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      singleTagFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Click on the selected tag to remove it\n    const tagButton = screen.getByText('#javascript');\n    fireEvent.click(tagButton);\n\n    // Should call setFiltersState to clear all filters\n    await waitFor(() => {\n      expect(mockSetFiltersState).toHaveBeenCalled();\n    });\n  });\n\n  it('renders empty state when no tags', async () => {\n    const propsWithNoTags = {\n      ...defaultProps,\n      initialRecentTags: { tags: [] }\n    };\n\n    // Mock getRecentTags to return empty tags\n    (getRecentTags as jest.Mock).mockResolvedValue({\n      tags: [],\n      error: '',\n      message: ''\n    });\n\n    render(\n      <Provider>\n        <RecentTagsClient {...propsWithNoTags} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Should render with Recent Tags title and empty message\n    expect(screen.getByText('Recent Tags')).toBeInTheDocument();\n    expect(screen.getByTestId(EMPTY_SELECTORS.CONTAINER)).toBeInTheDocument();\n    expect(screen.getByTestId(EMPTY_SELECTORS.LABEL)).toHaveTextContent(\n      'No recent tags'\n    );\n  });\n\n  it('shows active state for selected tags', async () => {\n    // Mock state with some selected tags - separate filter entries\n    const selectedTagsFiltersState = {\n      ...mockFiltersState,\n      filters: [\n        { name: 'tags', value: '#javascript' },\n        { name: 'tags', value: '#react' }\n      ]\n    };\n    const { useAtom } = require('jotai');\n    (useAtom as jest.Mock).mockReturnValue([\n      selectedTagsFiltersState,\n      mockSetFiltersState\n    ]);\n\n    render(\n      <Provider>\n        <RecentTagsClient {...defaultProps} />\n      </Provider>\n    );\n\n    // Wait for the component to finish loading\n    await waitFor(() => {\n      expect(\n        screen.queryByTestId('loader__scale-loader')\n      ).not.toBeInTheDocument();\n    });\n\n    // Verify the buttons exist and are interactive\n    const jsButton = screen.getByText('#javascript').closest('button');\n    const reactButton = screen.getByText('#react').closest('button');\n    const tsButton = screen.getByText('#typescript').closest('button');\n\n    expect(jsButton).toBeInTheDocument();\n    expect(reactButton).toBeInTheDocument();\n    expect(tsButton).toBeInTheDocument();\n\n    // Verify all buttons are clickable\n    expect(jsButton).not.toBeDisabled();\n    expect(reactButton).not.toBeDisabled();\n    expect(tsButton).not.toBeDisabled();\n  });\n});\n",
    "language":"typescript",
    "lines":563,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/recent-tags/RecentTagsClient.tsx":{
    "content":"'use client';\nimport { useAtom } from 'jotai';\nimport { useEffect, useMemo, useState } from 'react';\nimport { CustomSession } from '../../../auth.config';\nimport {\n  getSubmissionsFiltersAtom,\n  getSubmissionsStateAtom\n} from '../../../lib/state/atoms';\nimport { RECENT_TAGS_SELECTORS } from '../../../lib/test-selectors/components/recent-tags.selectors';\nimport Empty from '../empty/Empty';\nimport Loader from '../loader/Loader';\nimport { getRecentTags } from './actions';\nimport './RecentTags.css';\n\nconst RecentTagsClientComponent = ({\n  contextId,\n  onlyMine,\n  initialRecentTags,\n  session\n}: {\n  contextId: string;\n  onlyMine: boolean;\n  initialRecentTags: { tags: string[] };\n  session: CustomSession | null;\n}) => {\n  const [recentTags, setRecentTags] = useState(initialRecentTags);\n  const [loading, setLoading] = useState(false);\n\n  // Use shared Jotai atoms directly for state synchronization\n  const [filtersState, setFiltersState] = useAtom(\n    getSubmissionsFiltersAtom(contextId)\n  );\n\n  // We also need access to the submissions state to set loading immediately\n  const [, setSubmissionsState] = useAtom(getSubmissionsStateAtom(contextId));\n\n  // Extract current tags and logic from shared filters with null checks\n  const filters = filtersState?.filters || [];\n\n  // Get all tag filters (each tag is now a separate filter entry)\n  const tagFilters = filters.filter((f) => f.name === 'tags');\n  const tagLogicFilter = filters.find((f) => f.name === 'tagLogic');\n\n  // Extract current tags from individual filter entries\n  const currentTags = tagFilters.map((filter) => {\n    const tag = filter.value;\n    return tag.startsWith('#') ? tag : `#${tag}`;\n  });\n\n  const currentTagLogic = tagLogicFilter?.value || 'OR';\n\n  // Memoize tag-related state to prevent unnecessary re-renders\n  const tagState = useMemo(\n    () => ({\n      currentTags,\n      currentTagLogic,\n      tagFilters,\n      tagLogicFilter\n    }),\n    [currentTags.join(','), currentTagLogic]\n  ); // Only depend on actual tag values\n\n  // Stable title that doesn't change on hover - no more flickering\n  const stableTitle = useMemo(() => {\n    if (tagState.currentTags.length === 0) {\n      return 'Recent Tags';\n    }\n\n    if (tagState.currentTags.length === 1) {\n      return `Posts tagged: ${tagState.currentTags[0]}`;\n    }\n\n    const logicText = tagState.currentTagLogic === 'OR' ? 'any of' : 'all of';\n    const tagList = tagState.currentTags.join(', ');\n    return `Posts with ${logicText}: ${tagList}`;\n  }, [tagState.currentTags, tagState.currentTagLogic]);\n\n  // Fetch recent tags\n  useEffect(() => {\n    async function fetchTags() {\n      if (!session?.user?.id && onlyMine) {\n        return;\n      }\n\n      setLoading(true);\n      const tags = await getRecentTags(\n        'months',\n        onlyMine && session?.user?.id ? session.user.id : undefined\n      );\n      setRecentTags(tags);\n      setLoading(false);\n    }\n\n    // Initial fetch or when dependencies change\n    fetchTags();\n  }, [onlyMine, session]);\n\n  const handleTagClick = (tag: string) => {\n    // Simple approach: just update the filters and let useSubmissionsManager handle the rest\n    const formattedTag = tag.startsWith('#') ? tag : `#${tag}`;\n    const isSelected = tagState.currentTags.includes(formattedTag);\n\n    // Set loading state immediately when filter changes - this is the key fix!\n    setSubmissionsState((prev) => ({\n      ...prev,\n      loading: true\n    }));\n\n    if (isSelected) {\n      // Remove tag - remove the specific tag filter entry\n      setFiltersState((prevState) => {\n        const newFilters = prevState.filters.filter((filter) => {\n          if (filter.name === 'tags') {\n            const filterTag = filter.value.startsWith('#')\n              ? filter.value\n              : `#${filter.value}`;\n            return filterTag !== formattedTag;\n          }\n          return true;\n        });\n\n        // If no tag filters remain, also remove tagLogic\n        const remainingTagFilters = newFilters.filter((f) => f.name === 'tags');\n        const finalFilters =\n          remainingTagFilters.length > 0\n            ? newFilters\n            : newFilters.filter((f) => f.name !== 'tagLogic');\n\n        return {\n          ...prevState,\n          filters: finalFilters,\n          page: 1\n        };\n      });\n    } else {\n      // Add tag - add a new tag filter entry\n      setFiltersState((prevState) => {\n        // Check if there are already tag filters\n        const existingTagFilters = prevState.filters.filter(\n          (f) => f.name === 'tags'\n        );\n        const willHaveMultipleTags = existingTagFilters.length >= 1; // Will have multiple after adding this one\n\n        const filtersToAdd = [{ name: 'tags', value: formattedTag }];\n\n        // Add tagLogic if we'll have multiple tags and no tagLogic exists\n        if (\n          willHaveMultipleTags &&\n          !prevState.filters.find((f) => f.name === 'tagLogic')\n        ) {\n          filtersToAdd.push({ name: 'tagLogic', value: 'OR' });\n        }\n\n        return {\n          ...prevState,\n          filters: [...prevState.filters, ...filtersToAdd],\n          page: 1\n        };\n      });\n    }\n  };\n\n  const handleLogicToggle = () => {\n    const newLogic = tagState.currentTagLogic === 'OR' ? 'AND' : 'OR';\n\n    // Update logic filter directly if we have multiple tags\n    if (tagState.currentTags.length > 1) {\n      // Set loading state immediately when filter changes\n      setSubmissionsState((prev) => ({\n        ...prev,\n        loading: true\n      }));\n\n      setFiltersState((prevState) => {\n        // Remove existing tagLogic filter and add new one\n        const newFilters = prevState.filters.filter(\n          (f) => f.name !== 'tagLogic'\n        );\n        return {\n          ...prevState,\n          filters: [...newFilters, { name: 'tagLogic', value: newLogic }],\n          page: 1\n        };\n      });\n    }\n  };\n\n  // Sort tags so selected ones appear at the top\n  const sortedTags = useMemo(() => {\n    const selectedTags: string[] = [];\n    const unselectedTags: string[] = [];\n\n    recentTags.tags.forEach((tag) => {\n      const formattedTag = tag.startsWith('#') ? tag : `#${tag}`;\n      const isActive = tagState.currentTags.includes(formattedTag);\n\n      if (isActive) {\n        selectedTags.push(tag);\n      } else {\n        unselectedTags.push(tag);\n      }\n    });\n\n    return [...selectedTags, ...unselectedTags];\n  }, [recentTags.tags, tagState.currentTags]);\n\n  if (loading) {\n    return <RecentTagsLoader />;\n  }\n\n  return (\n    <article className=\\\"recent-tags\\\" data-testid={RECENT_TAGS_SELECTORS.TITLE}>\n      <div className=\\\"recent-tags__container\\\">\n        <div className=\\\"recent-tags__header\\\">\n          <h3 className=\\\"recent-tags__title\\\" title={stableTitle}>\n            {stableTitle}\n          </h3>\n          {tagState.currentTags.length > 1 && (\n            <button\n              className={`recent-tags__logic-toggle recent-tags__logic-toggle--${tagState.currentTagLogic.toLowerCase()}`}\n              onClick={handleLogicToggle}\n              title={\n                `Currently showing posts with ${tagState.currentTagLogic === 'OR' ? 'any' : 'all'} of the selected tags. ` +\n                `Click to switch to ${tagState.currentTagLogic === 'OR' ? 'all' : 'any'}.`\n              }\n            >\n              {tagState.currentTagLogic}\n            </button>\n          )}\n        </div>\n\n        {loading ? (\n          <div className=\\\"recent-tags__loading\\\">\n            <Loader />\n          </div>\n        ) : recentTags.tags.length > 0 ? (\n          <div className=\\\"recent-tags__tags\\\">\n            {sortedTags.map((tag) => {\n              const formattedTag = tag.startsWith('#') ? tag : `#${tag}`;\n              const isActive = tagState.currentTags.includes(formattedTag);\n\n              return (\n                <button\n                  key={tag}\n                  className={`recent-tags__tag ${isActive ? 'recent-tags__tag--active' : ''}`}\n                  onClick={() => handleTagClick(tag)}\n                  title={\n                    isActive\n                      ? `Remove ${formattedTag} filter`\n                      : `Filter by ${formattedTag}`\n                  }\n                >\n                  {formattedTag}\n                  {isActive && (\n                    <span\n                      className=\\\"recent-tags__tag-remove\\\"\n                      aria-hidden=\\\"true\\\"\n                    >\n                      \u00d7\n                    </span>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        ) : (\n          <Empty label=\\\"No recent tags found\\\" />\n        )}\n      </div>\n    </article>\n  );\n};\n\n// Memoize the component to prevent unnecessary re-renders when parent components change due to pagination\nexport const RecentTagsClient = RecentTagsClientComponent;\n// Temporarily disabled memo for debugging\n// export const RecentTagsClient = React.memo(\n//   RecentTagsClientComponent,\n//   (prevProps, nextProps) => {\n//     // Only re-render if contextId, onlyMine, or session changes\n//     // Don't re-render for pagination or other state changes\n//     return (\n//       prevProps.contextId === nextProps.contextId &&\n//       prevProps.onlyMine === nextProps.onlyMine &&\n//       prevProps.session?.user?.id === nextProps.session?.user?.id &&\n//       prevProps.initialRecentTags.tags.length ===\n//         nextProps.initialRecentTags.tags.length\n//     );\n//   }\n// );\n\nexport function RecentTagsLoader() {\n  return (\n    <article className=\\\"recent-tags__article\\\">\n      <div className=\\\"recent-tags__container\\\">\n        <div className=\\\"recent-tags__header\\\">\n          <h3 className=\\\"recent-tags__title\\\" title=\\\"3 months\\\">\n            Recent Tags\n          </h3>\n        </div>\n        <div className=\\\"recent-tags__content\\\">\n          <div className=\\\"recent-tags__loading\\\">\n            <Loader label=\\\"Loading recent tags...\\\" color=\\\"black\\\" />\n          </div>\n        </div>\n      </div>\n    </article>\n  );\n}\n",
    "language":"typescript",
    "lines":310,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/footer-nav/FooterNav.test.tsx":{
    "content":"import { render, screen } from '@testing-library/react';\nimport FooterNav from './FooterNav';\n\n// Mock the components\njest.mock('../docs-link/DocsLink', () => ({\n  DocsLink: () => <div data-testid=\\\"mock-docs-link\\\">Docs Link</div>\n}));\n\njest.mock('../discord-link/DiscordLink', () => ({\n  DiscordLink: () => <div data-testid=\\\"mock-discord-link\\\">Discord Link</div>\n}));\n\ndescribe('FooterNav', () => {\n  beforeEach(() => {\n    render(<FooterNav />);\n  });\n\n  it('renders the component with correct structure and classes', () => {\n    const container = screen.getByRole('list').parentElement;\n    const listItems = screen.getAllByRole('listitem');\n\n    expect(screen.getByRole('list')).toHaveClass('footer-nav__list');\n    expect(container).toHaveClass('footer-nav__container');\n    expect(listItems).toHaveLength(2);\n  });\n\n  it('renders the DocsLink and DiscordLink components', () => {\n    expect(screen.getByTestId('mock-docs-link')).toBeInTheDocument();\n    expect(screen.getByTestId('mock-discord-link')).toBeInTheDocument();\n  });\n});\n",
    "language":"typescript",
    "lines":32,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/footer-nav/FooterNav.tsx":{
    "content":"import React from 'react';\nimport { DiscordLink } from '../discord-link/DiscordLink';\nimport { DocsLink } from '../docs-link/DocsLink';\nimport './FooterNav.css';\n\nconst FooterNav = (): React.JSX.Element => {\n  return (\n    <div className=\\\"footer-nav__container\\\">\n      <ul className=\\\"footer-nav__list\\\">\n        <li>\n          <DocsLink />\n        </li>\n        <li>\n          <DiscordLink />\n        </li>\n      </ul>\n    </div>\n  );\n};\n\nexport default FooterNav;\n",
    "language":"typescript",
    "lines":22,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/EmojiApprovalPanel.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport './EmojiApprovalPanel.css';\n\ninterface CustomEmoji {\n  id: number;\n  name: string;\n  description: string;\n  encrypted_image_data: string;\n  category: string;\n  user_id: number;\n  created_at: string;\n  creator_email: string;\n  image_data: string | null;\n  approval_status?: 'pending' | 'approved' | 'rejected';\n  reviewed_by?: number;\n  reviewed_at?: string;\n  review_notes?: string;\n  is_globally_available?: boolean;\n}\n\ninterface PaginationInfo {\n  page: number;\n  limit: number;\n  total: number;\n  totalPages: number;\n  hasNext: boolean;\n  hasPrev: boolean;\n}\n\nexport default function EmojiApprovalPanel() {\n  const [emojis, setEmojis] = useState<CustomEmoji[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [statusFilter, setStatusFilter] = useState<\n    'all' | 'pending' | 'approved' | 'rejected'\n  >('pending');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [pagination, setPagination] = useState<PaginationInfo | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [selectedEmojis, setSelectedEmojis] = useState<Set<number>>(new Set());\n  const [showRejectModal, setShowRejectModal] = useState(false);\n  const [rejectingEmojiId, setRejectingEmojiId] = useState<number | null>(null);\n  const [rejectReason, setRejectReason] = useState('');\n\n  // Fetch emojis\n  const fetchEmojis = async (page = 1) => {\n    setLoading(true);\n    try {\n      const params = new URLSearchParams({\n        status: statusFilter,\n        page: page.toString(),\n        limit: '20',\n        search: searchTerm\n      });\n\n      const response = await fetch(`/api/admin/emojis?${params}`);\n      if (response.ok) {\n        const data = await response.json();\n        setEmojis(data.emojis || []);\n        setPagination(data.pagination);\n      } else {\n        console.error('Failed to fetch emojis:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Error fetching emojis:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchEmojis(currentPage);\n  }, [statusFilter, currentPage]);\n\n  // Handle search\n  const handleSearch = () => {\n    setCurrentPage(1);\n    fetchEmojis(1);\n  };\n\n  // Handle emoji approval\n  const handleApproveEmoji = async (emojiId: number) => {\n    try {\n      const response = await fetch('/api/admin/emojis', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          emojiId,\n          action: 'approve'\n        })\n      });\n\n      if (response.ok) {\n        fetchEmojis(currentPage);\n      } else {\n        console.error('Failed to approve emoji');\n      }\n    } catch (error) {\n      console.error('Error approving emoji:', error);\n    }\n  };\n\n  // Handle emoji rejection\n  const handleRejectEmoji = async (emojiId: number, reason: string) => {\n    try {\n      const response = await fetch('/api/admin/emojis', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          emojiId,\n          action: 'reject',\n          reason\n        })\n      });\n\n      if (response.ok) {\n        fetchEmojis(currentPage);\n        setShowRejectModal(false);\n        setRejectReason('');\n        setRejectingEmojiId(null);\n      } else {\n        console.error('Failed to reject emoji');\n      }\n    } catch (error) {\n      console.error('Error rejecting emoji:', error);\n    }\n  };\n\n  // Handle emoji deletion\n  const handleDeleteEmoji = async (\n    emojiId: number,\n    reason: string = 'Deleted by admin'\n  ) => {\n    if (!confirm('Are you sure you want to permanently delete this emoji?')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(\n        `/api/admin/emojis?id=${emojiId}&reason=${encodeURIComponent(reason)}`,\n        {\n          method: 'DELETE'\n        }\n      );\n\n      if (response.ok) {\n        fetchEmojis(currentPage);\n      } else {\n        console.error('Failed to delete emoji');\n      }\n    } catch (error) {\n      console.error('Error deleting emoji:', error);\n    }\n  };\n\n  // Handle bulk approval\n  const handleBulkApprove = async () => {\n    if (selectedEmojis.size === 0) return;\n\n    for (const emojiId of selectedEmojis) {\n      await handleApproveEmoji(emojiId);\n    }\n    setSelectedEmojis(new Set());\n  };\n\n  // Handle emoji selection\n  const toggleEmojiSelection = (emojiId: number) => {\n    const newSelected = new Set(selectedEmojis);\n    if (newSelected.has(emojiId)) {\n      newSelected.delete(emojiId);\n    } else {\n      newSelected.add(emojiId);\n    }\n    setSelectedEmojis(newSelected);\n  };\n\n  // Select all emojis\n  const selectAllEmojis = () => {\n    if (selectedEmojis.size === emojis.length) {\n      setSelectedEmojis(new Set());\n    } else {\n      setSelectedEmojis(new Set(emojis.map((e) => e.id)));\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const getStatusBadgeClass = (status: string = 'pending') => {\n    switch (status) {\n      case 'approved':\n        return 'emoji-card__status--approved';\n      case 'rejected':\n        return 'emoji-card__status--rejected';\n      default:\n        return 'emoji-card__status--pending';\n    }\n  };\n\n  return (\n    <div className=\\\"emoji-approval-panel\\\">\n      <div className=\\\"emoji-approval-panel__header\\\">\n        <h2>Emoji Management</h2>\n\n        <div className=\\\"emoji-approval-panel__controls\\\">\n          <div className=\\\"emoji-approval-panel__filter\\\">\n            <label htmlFor=\\\"status-filter\\\">Status:</label>\n            <select\n              id=\\\"status-filter\\\"\n              value={statusFilter}\n              onChange={(e) => setStatusFilter(e.target.value as any)}\n            >\n              <option value=\\\"all\\\">All Statuses</option>\n              <option value=\\\"pending\\\">Pending</option>\n              <option value=\\\"approved\\\">Approved</option>\n              <option value=\\\"rejected\\\">Rejected</option>\n            </select>\n          </div>\n\n          <div className=\\\"emoji-approval-panel__search\\\">\n            <input\n              type=\\\"text\\\"\n              placeholder=\\\"Search emojis, users, or categories...\\\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\n            />\n            <button onClick={handleSearch}>Search</button>\n          </div>\n\n          {selectedEmojis.size > 0 && (\n            <div className=\\\"emoji-approval-panel__bulk-actions\\\">\n              <span>{selectedEmojis.size} selected</span>\n              <button\n                onClick={handleBulkApprove}\n                className=\\\"emoji-approval-panel__bulk-btn emoji-approval-panel__bulk-btn--approve\\\"\n              >\n                Bulk Approve\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {loading ? (\n        <div className=\\\"emoji-approval-panel__loading\\\">Loading emojis...</div>\n      ) : (\n        <>\n          {emojis.length > 0 && (\n            <div className=\\\"emoji-approval-panel__actions\\\">\n              <label className=\\\"emoji-approval-panel__select-all\\\">\n                <input\n                  type=\\\"checkbox\\\"\n                  checked={\n                    selectedEmojis.size === emojis.length && emojis.length > 0\n                  }\n                  onChange={selectAllEmojis}\n                />\n                Select All ({emojis.length})\n              </label>\n            </div>\n          )}\n\n          <div className=\\\"emoji-approval-panel__list\\\">\n            {emojis.length === 0 ? (\n              <div className=\\\"emoji-approval-panel__empty\\\">\n                No emojis found for the current filter.\n              </div>\n            ) : (\n              emojis.map((emoji) => (\n                <div key={emoji.id} className=\\\"emoji-card\\\">\n                  <div className=\\\"emoji-card__checkbox\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={selectedEmojis.has(emoji.id)}\n                      onChange={() => toggleEmojiSelection(emoji.id)}\n                    />\n                  </div>\n\n                  <div className=\\\"emoji-card__image\\\">\n                    {emoji.image_data ? (\n                      <img\n                        src={`data:image/png;base64,${emoji.image_data}`}\n                        alt={emoji.name}\n                        width=\\\"48\\\"\n                        height=\\\"48\\\"\n                      />\n                    ) : (\n                      <div className=\\\"emoji-card__placeholder\\\">No Image</div>\n                    )}\n                  </div>\n\n                  <div className=\\\"emoji-card__info\\\">\n                    <div className=\\\"emoji-card__name\\\">:{emoji.name}:</div>\n                    <div className=\\\"emoji-card__meta\\\">\n                      <span>By: {emoji.creator_email}</span>\n                      <span>Category: {emoji.category}</span>\n                      <span>Created: {formatDate(emoji.created_at)}</span>\n                      {emoji.description && (\n                        <span>Description: {emoji.description}</span>\n                      )}\n                    </div>\n                    <span\n                      className={`emoji-card__status ${getStatusBadgeClass(emoji.approval_status)}`}\n                    >\n                      {(emoji.approval_status || 'pending').toUpperCase()}\n                    </span>\n                  </div>\n\n                  <div className=\\\"emoji-card__actions\\\">\n                    {(!emoji.approval_status ||\n                      emoji.approval_status === 'pending') && (\n                      <>\n                        <button\n                          className=\\\"emoji-card__action-btn emoji-card__action-btn--approve\\\"\n                          onClick={() => handleApproveEmoji(emoji.id)}\n                        >\n                          Approve\n                        </button>\n                        <button\n                          className=\\\"emoji-card__action-btn emoji-card__action-btn--reject\\\"\n                          onClick={() => {\n                            setRejectingEmojiId(emoji.id);\n                            setShowRejectModal(true);\n                          }}\n                        >\n                          Reject\n                        </button>\n                      </>\n                    )}\n\n                    <button\n                      className=\\\"emoji-card__action-btn emoji-card__action-btn--delete\\\"\n                      onClick={() => handleDeleteEmoji(emoji.id)}\n                    >\n                      Delete\n                    </button>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n\n          {pagination && pagination.totalPages > 1 && (\n            <div className=\\\"emoji-approval-panel__pagination\\\">\n              <button\n                disabled={!pagination.hasPrev}\n                onClick={() => setCurrentPage(currentPage - 1)}\n              >\n                Previous\n              </button>\n              <span>\n                Page {pagination.page} of {pagination.totalPages} (\n                {pagination.total} total)\n              </span>\n              <button\n                disabled={!pagination.hasNext}\n                onClick={() => setCurrentPage(currentPage + 1)}\n              >\n                Next\n              </button>\n            </div>\n          )}\n        </>\n      )}\n\n      {/* Reject Modal */}\n      {showRejectModal && (\n        <div className=\\\"emoji-approval-panel__modal-overlay\\\">\n          <div className=\\\"emoji-approval-panel__modal\\\">\n            <div className=\\\"emoji-approval-panel__modal-header\\\">\n              <h3>Reject Emoji</h3>\n              <button\n                onClick={() => setShowRejectModal(false)}\n                className=\\\"emoji-approval-panel__modal-close\\\"\n              >\n                \u00d7\n              </button>\n            </div>\n            <div className=\\\"emoji-approval-panel__modal-content\\\">\n              <label htmlFor=\\\"reject-reason\\\">Reason for rejection:</label>\n              <textarea\n                id=\\\"reject-reason\\\"\n                value={rejectReason}\n                onChange={(e) => setRejectReason(e.target.value)}\n                placeholder=\\\"Please provide a reason for rejecting this emoji...\\\"\n                rows={4}\n                required\n              />\n            </div>\n            <div className=\\\"emoji-approval-panel__modal-actions\\\">\n              <button\n                onClick={() => setShowRejectModal(false)}\n                className=\\\"emoji-approval-panel__modal-btn emoji-approval-panel__modal-btn--cancel\\\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={() =>\n                  rejectingEmojiId &&\n                  handleRejectEmoji(rejectingEmojiId, rejectReason)\n                }\n                disabled={!rejectReason.trim()}\n                className=\\\"emoji-approval-panel__modal-btn emoji-approval-panel__modal-btn--reject\\\"\n              >\n                Reject Emoji\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":423,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/SubscriptionManagementPanel.tsx":{
    "content":"'use client';\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { useOverlay } from '../../../lib/context/OverlayContext';\nimport { AssignSubscriptionModal } from './modals/AssignSubscriptionModal';\nimport { EditPlanModal } from './modals/EditPlanModal';\nimport { EditSubscriptionModal } from './modals/EditSubscriptionModal';\nimport './SubscriptionManagementPanel.css';\n\n// ================================\n// TYPES & INTERFACES\n// ================================\n\ninterface SubscriptionPlan {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  plan_type: 'tier' | 'addon' | 'bundle';\n  price_monthly_cents?: number;\n  price_yearly_cents?: number;\n  price_lifetime_cents?: number;\n  is_active: boolean;\n  sort_order: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface UserSubscription {\n  id: string;\n  user_id: string;\n  plan_id: string;\n  status:\n    | 'active'\n    | 'cancelled'\n    | 'expired'\n    | 'suspended'\n    | 'pending'\n    | 'trialing';\n  billing_cycle?: string;\n  expires_at?: string;\n  trial_ends_at?: string;\n  assigned_by?: string;\n  assignment_reason?: string;\n  created_at: string;\n  updated_at: string;\n  // Joined fields\n  plan_name: string;\n  plan_display_name: string;\n  user_name?: string;\n  user_email?: string;\n  assigned_by_name?: string;\n}\n\ninterface SubscriptionStats {\n  total_plans: number;\n  active_plans: number;\n  total_subscriptions: number;\n  active_subscriptions: number;\n  trialing_subscriptions: number;\n  expired_subscriptions: number;\n  revenue_monthly_cents: number;\n  revenue_yearly_cents: number;\n  plan_distribution: Array<{\n    plan_name: string;\n    plan_display_name: string;\n    subscriber_count: number;\n    revenue_monthly_cents: number;\n  }>;\n}\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n}\n\ntype TabType = 'overview' | 'plans' | 'subscriptions' | 'analytics';\n\nexport default function SubscriptionManagementPanel() {\n  // ================================\n  // STATE MANAGEMENT\n  // ================================\n\n  const { openOverlay, closeOverlay } = useOverlay();\n  const [activeTab, setActiveTab] = useState<TabType>('overview');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Data states\n  const [subscriptionPlans, setSubscriptionPlans] = useState<\n    SubscriptionPlan[]\n  >([]);\n  const [userSubscriptions, setUserSubscriptions] = useState<\n    UserSubscription[]\n  >([]);\n  const [subscriptionStats, setSubscriptionStats] =\n    useState<SubscriptionStats | null>(null);\n\n  // Modal states - keeping for backwards compatibility with other modals\n  const [showAssignModal, setShowAssignModal] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\n\n  // Subscription filtering and pagination\n  const [currentPage, setCurrentPage] = useState(1);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [planFilter, setPlanFilter] = useState<string>('all');\n\n  // ================================\n  // DATA FETCHING\n  // ================================\n\n  const fetchSubscriptionPlans = useCallback(async () => {\n    try {\n      const response = await fetch('/api/admin/subscription-plans');\n      if (!response.ok) {\n        if (response.status === 503) {\n          throw new Error('Subscription system not available');\n        }\n        throw new Error(\n          `Failed to fetch subscription plans: ${response.status}`\n        );\n      }\n      const plans = await response.json();\n      setSubscriptionPlans(plans);\n    } catch (error) {\n      console.error('Error fetching subscription plans:', error);\n      setError(\n        error instanceof Error\n          ? error.message\n          : 'Failed to fetch subscription plans'\n      );\n    }\n  }, []);\n\n  const fetchUserSubscriptions = useCallback(async () => {\n    try {\n      const response = await fetch('/api/admin/user-subscriptions');\n      if (!response.ok) {\n        if (response.status === 503) {\n          throw new Error('Subscription system not available');\n        }\n        throw new Error(\n          `Failed to fetch user subscriptions: ${response.status}`\n        );\n      }\n      const subscriptions = await response.json();\n      setUserSubscriptions(subscriptions);\n    } catch (error) {\n      console.error('Error fetching user subscriptions:', error);\n      setError(\n        error instanceof Error\n          ? error.message\n          : 'Failed to fetch user subscriptions'\n      );\n    }\n  }, []);\n\n  const fetchSubscriptionStats = useCallback(async () => {\n    try {\n      const response = await fetch('/api/admin/subscription-stats');\n      if (!response.ok) {\n        if (response.status === 503) {\n          throw new Error('Subscription system not available');\n        }\n        throw new Error(\n          `Failed to fetch subscription stats: ${response.status}`\n        );\n      }\n      const stats = await response.json();\n      setSubscriptionStats(stats);\n    } catch (error) {\n      console.error('Error fetching subscription stats:', error);\n      setError(\n        error instanceof Error\n          ? error.message\n          : 'Failed to fetch subscription stats'\n      );\n    }\n  }, []);\n\n  const fetchAllData = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      await Promise.all([\n        fetchSubscriptionPlans(),\n        fetchUserSubscriptions(),\n        fetchSubscriptionStats()\n      ]);\n    } catch (error) {\n      console.error('Error fetching subscription data:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, [fetchSubscriptionPlans, fetchUserSubscriptions, fetchSubscriptionStats]);\n\n  useEffect(() => {\n    fetchAllData();\n  }, [fetchAllData]);\n\n  // ================================\n  // HELPER FUNCTIONS\n  // ================================\n\n  const formatPrice = (cents?: number) => {\n    if (!cents || cents === 0) return 'Free';\n    return `$${(cents / 100).toFixed(2)}`;\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    const statusMap = {\n      active: { label: 'Active', className: 'status-badge--success' },\n      trialing: { label: 'Trial', className: 'status-badge--info' },\n      cancelled: { label: 'Cancelled', className: 'status-badge--warning' },\n      expired: { label: 'Expired', className: 'status-badge--danger' },\n      suspended: { label: 'Suspended', className: 'status-badge--danger' },\n      pending: { label: 'Pending', className: 'status-badge--secondary' }\n    };\n\n    const config = statusMap[status as keyof typeof statusMap] || {\n      label: status,\n      className: 'status-badge--secondary'\n    };\n    return (\n      <span className={`status-badge ${config.className}`}>{config.label}</span>\n    );\n  };\n\n  // ================================\n  // EVENT HANDLERS\n  // ================================\n\n  const handleCreatePlan = () => {\n    // TODO: Implement create plan modal\n    alert('Create Plan functionality coming soon!');\n  };\n\n  const handleEditPlan = (plan: SubscriptionPlan) => {\n    const modalId = `edit-plan-modal-${plan.id}`;\n\n    openOverlay({\n      id: modalId,\n      type: 'modal',\n      component: EditPlanModal,\n      props: {\n        plan,\n        onSave: async (planId: string, updates: Partial<SubscriptionPlan>) => {\n          try {\n            const response = await fetch(\n              `/api/admin/subscription-plans/${planId}`,\n              {\n                method: 'PATCH',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(updates)\n              }\n            );\n\n            if (!response.ok) {\n              const errorData = await response.json();\n              throw new Error(errorData.error || 'Failed to update plan');\n            }\n\n            // Refresh plans data\n            await fetchAllData();\n          } catch (error) {\n            console.error('Error updating plan:', error);\n            throw error; // Re-throw to show in modal\n          }\n        }\n      }\n    });\n  };\n\n  const handleSavePlan = async (\n    planId: string,\n    updates: Partial<SubscriptionPlan>\n  ) => {\n    try {\n      const response = await fetch(`/api/admin/subscription-plans/${planId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(updates)\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update plan');\n      }\n\n      // Refresh plans data\n      await fetchAllData();\n    } catch (error) {\n      console.error('Error updating plan:', error);\n      throw error; // Re-throw to show in modal\n    }\n  };\n\n  const handleTogglePlan = async (plan: SubscriptionPlan) => {\n    try {\n      const newStatus = !plan.is_active;\n      const response = await fetch(`/api/admin/subscription-plans/${plan.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          is_active: newStatus\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to ${newStatus ? 'enable' : 'disable'} plan`);\n      }\n\n      // Refresh plans data\n      await fetchAllData();\n    } catch (error) {\n      console.error('Error toggling plan status:', error);\n      setError(\n        error instanceof Error ? error.message : 'Failed to update plan status'\n      );\n    }\n  };\n\n  const handleAssignSubscription = async (\n    planId: string,\n    billingCycle: string,\n    expiresAt?: string,\n    reason?: string\n  ) => {\n    if (!selectedUser) return;\n\n    try {\n      const response = await fetch(\n        `/api/admin/users/${selectedUser.id}/assign-subscription`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            planId: parseInt(planId),\n            billingCycle,\n            expiresAt,\n            reason\n          })\n        }\n      );\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to assign subscription');\n      }\n\n      // Refresh data after successful assignment\n      await fetchAllData();\n      setSelectedUser(null);\n    } catch (error) {\n      console.error('Error assigning subscription:', error);\n      setError(\n        error instanceof Error ? error.message : 'Failed to assign subscription'\n      );\n    }\n  };\n\n  const handleEditSubscription = (subscription: UserSubscription) => {\n    const modalId = `edit-subscription-modal-${subscription.id}`;\n\n    openOverlay({\n      id: modalId,\n      type: 'modal',\n      component: EditSubscriptionModal,\n      props: {\n        subscription,\n        onSave: async (\n          subscriptionId: string,\n          updates: Partial<UserSubscription>\n        ) => {\n          try {\n            const response = await fetch(\n              `/api/admin/user-subscriptions/${subscriptionId}`,\n              {\n                method: 'PATCH',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(updates)\n              }\n            );\n\n            if (!response.ok) {\n              const errorData = await response.json();\n              throw new Error(\n                errorData.error || 'Failed to update subscription'\n              );\n            }\n\n            // Refresh subscriptions data\n            await fetchAllData();\n          } catch (error) {\n            console.error('Error updating subscription:', error);\n            throw error; // Re-throw to show in modal\n          }\n        }\n      }\n    });\n  };\n\n  const handleCancelSubscription = async (subscription: UserSubscription) => {\n    if (\n      !confirm(\n        `Are you sure you want to cancel the subscription for ${subscription.user_name || subscription.user_email}?`\n      )\n    ) {\n      return;\n    }\n\n    try {\n      const response = await fetch(\n        `/api/admin/user-subscriptions/${subscription.id}`,\n        {\n          method: 'PATCH',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            status: 'cancelled',\n            cancelled_at: new Date().toISOString()\n          })\n        }\n      );\n\n      if (!response.ok) {\n        throw new Error('Failed to cancel subscription');\n      }\n\n      // Refresh subscriptions data\n      await fetchAllData();\n    } catch (error) {\n      console.error('Error cancelling subscription:', error);\n      setError(\n        error instanceof Error ? error.message : 'Failed to cancel subscription'\n      );\n    }\n  };\n\n  // ================================\n  // SUBSCRIPTION FILTERING & PAGINATION\n  // ================================\n\n  const filteredSubscriptions = userSubscriptions.filter((subscription) => {\n    const matchesSearch =\n      !searchTerm ||\n      subscription.user_name\n        ?.toLowerCase()\n        .includes(searchTerm.toLowerCase()) ||\n      subscription.user_email\n        ?.toLowerCase()\n        .includes(searchTerm.toLowerCase()) ||\n      subscription.plan_display_name\n        .toLowerCase()\n        .includes(searchTerm.toLowerCase());\n\n    const matchesStatus =\n      statusFilter === 'all' || subscription.status === statusFilter;\n    const matchesPlan =\n      planFilter === 'all' || subscription.plan_name === planFilter;\n\n    return matchesSearch && matchesStatus && matchesPlan;\n  });\n\n  const itemsPerPage = 10;\n  const totalPages = Math.ceil(filteredSubscriptions.length / itemsPerPage);\n  const paginatedSubscriptions = filteredSubscriptions.slice(\n    (currentPage - 1) * itemsPerPage,\n    currentPage * itemsPerPage\n  );\n\n  // ================================\n  // RENDER FUNCTIONS\n  // ================================\n\n  const renderOverview = () => {\n    if (!subscriptionStats) return <div>Loading stats...</div>;\n\n    return (\n      <div className=\\\"subscription-overview\\\">\n        <div className=\\\"stats-grid\\\">\n          <div className=\\\"stat-card\\\">\n            <h3>\ud83d\udccb Total Plans</h3>\n            <div className=\\\"stat-value\\\">{subscriptionStats.total_plans}</div>\n            <div className=\\\"stat-subtitle\\\">\n              {subscriptionStats.active_plans} active\n            </div>\n          </div>\n\n          <div className=\\\"stat-card\\\">\n            <h3>\ud83d\udc65 Total Subscriptions</h3>\n            <div className=\\\"stat-value\\\">\n              {subscriptionStats.total_subscriptions}\n            </div>\n            <div className=\\\"stat-subtitle\\\">\n              {subscriptionStats.active_subscriptions} active\n            </div>\n          </div>\n\n          <div className=\\\"stat-card\\\">\n            <h3>\ud83d\ude80 Trial Users</h3>\n            <div className=\\\"stat-value\\\">\n              {subscriptionStats.trialing_subscriptions}\n            </div>\n            <div className=\\\"stat-subtitle\\\">Currently trialing</div>\n          </div>\n\n          <div className=\\\"stat-card\\\">\n            <h3>\ud83d\udcb0 Monthly Revenue</h3>\n            <div className=\\\"stat-value\\\">\n              {formatPrice(subscriptionStats.revenue_monthly_cents)}\n            </div>\n            <div className=\\\"stat-subtitle\\\">Recurring monthly</div>\n          </div>\n        </div>\n\n        <div className=\\\"plan-distribution\\\">\n          <h3>\ud83d\udcca Plan Distribution</h3>\n          <div className=\\\"distribution-list\\\">\n            {subscriptionStats.plan_distribution.map((plan) => (\n              <div key={plan.plan_name} className=\\\"distribution-item\\\">\n                <div className=\\\"distribution-info\\\">\n                  <span className=\\\"plan-name\\\">{plan.plan_display_name}</span>\n                  <span className=\\\"subscriber-count\\\">\n                    {plan.subscriber_count} subscribers\n                  </span>\n                </div>\n                <div className=\\\"distribution-revenue\\\">\n                  {formatPrice(plan.revenue_monthly_cents)}/mo\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderPlans = () => (\n    <div className=\\\"subscription-plans\\\">\n      <div className=\\\"plans-header\\\">\n        <h3>\ud83d\udccb Subscription Plans</h3>\n        <button className=\\\"btn btn-primary\\\" onClick={handleCreatePlan}>\n          \u2795 Create New Plan\n        </button>\n      </div>\n\n      <div className=\\\"plans-grid\\\">\n        {subscriptionPlans.map((plan) => (\n          <div\n            key={plan.id}\n            className={`plan-card ${!plan.is_active ? 'plan-card--inactive' : ''}`}\n          >\n            <div className=\\\"plan-header\\\">\n              <h4>{plan.display_name}</h4>\n              <span className={`plan-type plan-type--${plan.plan_type}`}>\n                {plan.plan_type}\n              </span>\n            </div>\n\n            <div className=\\\"plan-pricing\\\">\n              {plan.price_monthly_cents ? (\n                <div className=\\\"pricing-options\\\">\n                  <div className=\\\"price-option\\\">\n                    <span className=\\\"price\\\">\n                      {formatPrice(plan.price_monthly_cents)}\n                    </span>\n                    <span className=\\\"period\\\">/month</span>\n                  </div>\n                  {plan.price_yearly_cents && (\n                    <div className=\\\"price-option\\\">\n                      <span className=\\\"price\\\">\n                        {formatPrice(plan.price_yearly_cents)}\n                      </span>\n                      <span className=\\\"period\\\">/year</span>\n                    </div>\n                  )}\n                  {plan.price_lifetime_cents && (\n                    <div className=\\\"price-option\\\">\n                      <span className=\\\"price\\\">\n                        {formatPrice(plan.price_lifetime_cents)}\n                      </span>\n                      <span className=\\\"period\\\">lifetime</span>\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <div className=\\\"price-free\\\">Free</div>\n              )}\n            </div>\n\n            {plan.description && (\n              <div className=\\\"plan-description\\\">{plan.description}</div>\n            )}\n\n            <div className=\\\"plan-actions\\\">\n              <button\n                className=\\\"btn btn-secondary btn-sm\\\"\n                onClick={() => handleEditPlan(plan)}\n              >\n                \u270f\ufe0f Edit\n              </button>\n              <button\n                className={`btn btn-sm ${plan.is_active ? 'btn-danger' : 'btn-success'}`}\n                onClick={() => handleTogglePlan(plan)}\n              >\n                {plan.is_active ? '\ud83d\udeab Disable' : '\u2705 Enable'}\n              </button>\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n\n  const renderSubscriptions = () => (\n    <div className=\\\"user-subscriptions\\\">\n      <div className=\\\"subscriptions-header\\\">\n        <h3>\ud83d\udc65 User Subscriptions</h3>\n        <div className=\\\"subscriptions-actions\\\">\n          <button\n            className=\\\"btn btn-primary\\\"\n            onClick={() => setShowAssignModal(true)}\n          >\n            \u2795 Assign Subscription\n          </button>\n        </div>\n      </div>\n\n      <div className=\\\"subscriptions-filters\\\">\n        <input\n          type=\\\"text\\\"\n          placeholder=\\\"Search users or plans...\\\"\n          value={searchTerm}\n          onChange={(e) => setSearchTerm(e.target.value)}\n          className=\\\"search-input\\\"\n        />\n\n        <select\n          value={statusFilter}\n          onChange={(e) => setStatusFilter(e.target.value)}\n          className=\\\"filter-select\\\"\n        >\n          <option value=\\\"all\\\">All Statuses</option>\n          <option value=\\\"active\\\">Active</option>\n          <option value=\\\"trialing\\\">Trialing</option>\n          <option value=\\\"cancelled\\\">Cancelled</option>\n          <option value=\\\"expired\\\">Expired</option>\n          <option value=\\\"suspended\\\">Suspended</option>\n        </select>\n\n        <select\n          value={planFilter}\n          onChange={(e) => setPlanFilter(e.target.value)}\n          className=\\\"filter-select\\\"\n        >\n          <option value=\\\"all\\\">All Plans</option>\n          {subscriptionPlans.map((plan) => (\n            <option key={plan.id} value={plan.name}>\n              {plan.display_name}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      <div className=\\\"subscriptions-table-container\\\">\n        <table className=\\\"subscriptions-table\\\">\n          <thead>\n            <tr>\n              <th>User</th>\n              <th>Plan</th>\n              <th>Status</th>\n              <th>Billing</th>\n              <th>Expires</th>\n              <th>Assigned By</th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {paginatedSubscriptions.map((subscription) => (\n              <tr key={subscription.id}>\n                <td>\n                  <div className=\\\"user-info\\\">\n                    <div className=\\\"user-name\\\">\n                      {subscription.user_name || 'Unknown User'}\n                    </div>\n                    <div className=\\\"user-email\\\">{subscription.user_email}</div>\n                  </div>\n                </td>\n                <td>\n                  <div className=\\\"plan-info\\\">\n                    <div className=\\\"plan-name\\\">\n                      {subscription.plan_display_name}\n                    </div>\n                    <div className=\\\"plan-type\\\">({subscription.plan_name})</div>\n                  </div>\n                </td>\n                <td>{getStatusBadge(subscription.status)}</td>\n                <td>{subscription.billing_cycle || 'N/A'}</td>\n                <td>\n                  {subscription.expires_at\n                    ? formatDate(subscription.expires_at)\n                    : 'Never'}\n                </td>\n                <td>{subscription.assigned_by_name || 'System'}</td>\n                <td>\n                  <div className=\\\"subscription-actions\\\">\n                    <button\n                      className=\\\"btn btn-sm btn-secondary\\\"\n                      onClick={() => handleEditSubscription(subscription)}\n                    >\n                      \u270f\ufe0f Edit\n                    </button>\n                    <button\n                      className=\\\"btn btn-sm btn-danger\\\"\n                      onClick={() => handleCancelSubscription(subscription)}\n                    >\n                      \ud83d\udeab Cancel\n                    </button>\n                  </div>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      {totalPages > 1 && (\n        <div className=\\\"pagination\\\">\n          <button\n            onClick={() => setCurrentPage((prev) => Math.max(1, prev - 1))}\n            disabled={currentPage === 1}\n            className=\\\"btn btn-secondary btn-sm\\\"\n          >\n            \u2190 Previous\n          </button>\n\n          <span className=\\\"pagination-info\\\">\n            Page {currentPage} of {totalPages} ({filteredSubscriptions.length}{' '}\n            total)\n          </span>\n\n          <button\n            onClick={() =>\n              setCurrentPage((prev) => Math.min(totalPages, prev + 1))\n            }\n            disabled={currentPage === totalPages}\n            className=\\\"btn btn-secondary btn-sm\\\"\n          >\n            Next \u2192\n          </button>\n        </div>\n      )}\n    </div>\n  );\n\n  const renderAnalytics = () => (\n    <div className=\\\"subscription-analytics\\\">\n      <h3>\ud83d\udcc8 Analytics</h3>\n      <div className=\\\"analytics-placeholder\\\">\n        <p>\ud83d\udcca Advanced subscription analytics coming soon...</p>\n        <ul>\n          <li>\ud83d\udcc8 Revenue trends and forecasting</li>\n          <li>\ud83d\udc65 User acquisition and churn analysis</li>\n          <li>\ud83d\udd04 Conversion funnel metrics</li>\n          <li>\ud83d\udca1 Plan performance insights</li>\n          <li>\ud83d\udccb Custom reports and exports</li>\n        </ul>\n      </div>\n    </div>\n  );\n\n  // ================================\n  // MAIN RENDER\n  // ================================\n\n  if (loading) {\n    return (\n      <div className=\\\"subscription-management-panel\\\">\n        <div className=\\\"loading-state\\\">\n          <div className=\\\"loading-spinner\\\"></div>\n          <p>Loading subscription data...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error && error.includes('not available')) {\n    return (\n      <div className=\\\"subscription-management-panel\\\">\n        <div className=\\\"error-state\\\">\n          <div className=\\\"error-icon\\\">\u26a0\ufe0f</div>\n          <h3>Subscription System Not Available</h3>\n          <p>The subscription system is not configured or available.</p>\n          <button\n            className=\\\"btn btn-primary\\\"\n            onClick={() => window.location.reload()}\n          >\n            \ud83d\udd04 Retry\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\\\"subscription-management-panel\\\">\n      <div className=\\\"panel-header\\\">\n        <h2>\ud83d\udcb3 Subscription Management</h2>\n        <p>\n          Manage subscription plans, user subscriptions, and analytics with\n          quota system integration\n        </p>\n      </div>\n\n      {error && (\n        <div className=\\\"error-message\\\">\n          <span>\u274c {error}</span>\n          <button onClick={() => setError(null)}>\u2715</button>\n        </div>\n      )}\n\n      <div className=\\\"panel-tabs\\\">\n        <button\n          className={`tab-button ${activeTab === 'overview' ? 'tab-button--active' : ''}`}\n          onClick={() => setActiveTab('overview')}\n        >\n          \ud83d\udcca Overview\n        </button>\n        <button\n          className={`tab-button ${activeTab === 'plans' ? 'tab-button--active' : ''}`}\n          onClick={() => setActiveTab('plans')}\n        >\n          \ud83d\udccb Plans\n        </button>\n        <button\n          className={`tab-button ${activeTab === 'subscriptions' ? 'tab-button--active' : ''}`}\n          onClick={() => setActiveTab('subscriptions')}\n        >\n          \ud83d\udc65 Subscriptions\n        </button>\n        <button\n          className={`tab-button ${activeTab === 'analytics' ? 'tab-button--active' : ''}`}\n          onClick={() => setActiveTab('analytics')}\n        >\n          \ud83d\udcc8 Analytics\n        </button>\n      </div>\n\n      <div className=\\\"panel-content\\\">\n        {activeTab === 'overview' && renderOverview()}\n        {activeTab === 'plans' && renderPlans()}\n        {activeTab === 'subscriptions' && renderSubscriptions()}\n        {activeTab === 'analytics' && renderAnalytics()}\n      </div>\n\n      {/* Modals */}\n      {showAssignModal && (\n        <AssignSubscriptionModal\n          isOpen={showAssignModal}\n          onClose={() => {\n            setShowAssignModal(false);\n            setSelectedUser(null);\n          }}\n          onAssign={handleAssignSubscription}\n          userName={selectedUser?.name || ''}\n          userId={selectedUser?.id || ''}\n        />\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":895,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/AdminSubmissionItem.tsx":{
    "content":"'use client';\n\nimport { useState } from 'react';\nimport { Submission } from '../../components/submission-forms/schema';\nimport { SubmissionItem } from '../../components/submissions-list/SubmissionItem';\nimport { SubmissionWithReplies } from '../../components/submissions-list/actions';\nimport './AdminSubmissionItem.css';\nimport { AdminUserTooltip } from './AdminUserTooltip';\n\ninterface AdminSubmissionItemProps {\n  submission: SubmissionWithReplies;\n  onTagClick: (tag: string) => void;\n  onHashtagClick?: (hashtag: string) => void;\n  onMentionClick?: (mention: string, filterType: 'author' | 'mentions') => void;\n  onSubmissionUpdate?: () => void;\n  contextId: string;\n  optimisticUpdateSubmission?: (\n    submissionId: number,\n    updatedSubmission: Submission\n  ) => void;\n  optimisticRemoveSubmission?: (submissionId: number) => void;\n  onRefresh?: () => void;\n}\n\nexport function AdminSubmissionItem(props: AdminSubmissionItemProps) {\n  const [showTimeoutModal, setShowTimeoutModal] = useState(false);\n\n  // Handle timeout user\n  const handleTimeoutUser = async (\n    userId: number,\n    timeoutType: string,\n    reason: string,\n    durationHours: number\n  ) => {\n    try {\n      const response = await fetch('/api/admin/users/timeout', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          userId,\n          timeoutType,\n          reason,\n          durationHours\n        })\n      });\n\n      if (response.ok) {\n        props.onRefresh?.();\n        setShowTimeoutModal(false);\n      } else {\n        console.error('Failed to timeout user');\n      }\n    } catch (error) {\n      console.error('Error timing out user:', error);\n    }\n  };\n\n  return (\n    <div className=\\\"admin-submission-item\\\">\n      <div className=\\\"admin-submission-item__content\\\">\n        <SubmissionItem\n          {...props}\n          // Override the author component to include admin controls\n        />\n      </div>\n\n      <div className=\\\"admin-submission-item__admin-controls\\\">\n        <AdminUserTooltip\n          userId={props.submission.user_id}\n          username={props.submission.author}\n          onTimeoutUser={handleTimeoutUser}\n        />\n      </div>\n\n      {showTimeoutModal && (\n        <TimeoutModal\n          userId={props.submission.user_id}\n          username={props.submission.author}\n          onTimeout={handleTimeoutUser}\n          onClose={() => setShowTimeoutModal(false)}\n        />\n      )}\n    </div>\n  );\n}\n\n// Timeout Modal Component\ninterface TimeoutModalProps {\n  userId: number;\n  username: string;\n  onTimeout: (\n    userId: number,\n    timeoutType: string,\n    reason: string,\n    durationHours: number\n  ) => void;\n  onClose: () => void;\n}\n\nfunction TimeoutModal({\n  userId,\n  username,\n  onTimeout,\n  onClose\n}: TimeoutModalProps) {\n  const [timeoutType, setTimeoutType] = useState('post_creation');\n  const [reason, setReason] = useState('');\n  const [durationHours, setDurationHours] = useState(24);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!reason.trim()) {\n      alert('Please provide a reason for the timeout');\n      return;\n    }\n    onTimeout(userId, timeoutType, reason, durationHours);\n  };\n\n  return (\n    <div className=\\\"timeout-modal-overlay\\\">\n      <div className=\\\"timeout-modal\\\">\n        <div className=\\\"timeout-modal__header\\\">\n          <h3>Timeout User: {username}</h3>\n          <button className=\\\"timeout-modal__close\\\" onClick={onClose}>\n            \u00d7\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\\\"timeout-modal__form\\\">\n          <div className=\\\"timeout-modal__field\\\">\n            <label htmlFor=\\\"timeout-type\\\">Timeout Type:</label>\n            <select\n              id=\\\"timeout-type\\\"\n              value={timeoutType}\n              onChange={(e) => setTimeoutType(e.target.value)}\n            >\n              <option value=\\\"post_creation\\\">Post Creation</option>\n              <option value=\\\"comment_creation\\\">Comment Creation</option>\n              <option value=\\\"full_access\\\">Full Access</option>\n            </select>\n          </div>\n\n          <div className=\\\"timeout-modal__field\\\">\n            <label htmlFor=\\\"duration\\\">Duration (hours):</label>\n            <input\n              type=\\\"number\\\"\n              id=\\\"duration\\\"\n              min=\\\"1\\\"\n              max=\\\"8760\\\"\n              value={durationHours}\n              onChange={(e) => setDurationHours(parseInt(e.target.value))}\n            />\n          </div>\n\n          <div className=\\\"timeout-modal__field\\\">\n            <label htmlFor=\\\"reason\\\">Reason:</label>\n            <textarea\n              id=\\\"reason\\\"\n              value={reason}\n              onChange={(e) => setReason(e.target.value)}\n              placeholder=\\\"Please provide a reason for this timeout...\\\"\n              rows={3}\n              required\n            />\n          </div>\n\n          <div className=\\\"timeout-modal__actions\\\">\n            <button\n              type=\\\"button\\\"\n              onClick={onClose}\n              className=\\\"timeout-modal__cancel\\\"\n            >\n              Cancel\n            </button>\n            <button type=\\\"submit\\\" className=\\\"timeout-modal__submit\\\">\n              Issue Timeout\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":186,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/AlertStatusTooltip.tsx":{
    "content":"'use client';\n\nimport { InteractiveTooltip } from '@/app/components/tooltip/InteractiveTooltip';\nimport React from 'react';\nimport './AlertStatusTooltip.css';\n\nexport interface AlertStatusTooltipProps {\n  type: 'active' | 'published';\n  isActive?: boolean;\n  isPublished?: boolean;\n  children: React.ReactNode;\n}\n\ninterface StatusInfo {\n  title: string;\n  description: string;\n  icon: string;\n  purpose: string;\n  examples: string[];\n  currentState?: {\n    status: string;\n    meaning: string;\n    color: 'success' | 'warning' | 'danger' | 'info';\n  };\n}\n\nconst getStatusInfo = (\n  type: 'active' | 'published',\n  isActive?: boolean,\n  isPublished?: boolean\n): StatusInfo => {\n  const baseInfo = {\n    active: {\n      title: 'Active Status',\n      description: 'Internal system control for alert functionality',\n      icon: '\ud83d\udd27',\n      purpose: 'Technical enable/disable switch for administrators',\n      examples: [\n        'Temporarily disable during maintenance',\n        'Keep draft alerts ready but not live',\n        'Emergency pause without losing settings',\n        'System-level control independent of publishing'\n      ]\n    },\n    published: {\n      title: 'Published Status',\n      description: 'Public visibility control for end users',\n      icon: '\ud83d\udce2',\n      purpose: 'Editorial control over what users can see',\n      examples: [\n        'Draft \u2192 Review \u2192 Publish workflow',\n        'Content approval process',\n        'Scheduled publishing preparation',\n        'Public-facing visibility toggle'\n      ]\n    }\n  };\n\n  const info = baseInfo[type];\n\n  // Add current state information if values are provided\n  let currentState;\n  if (isActive !== undefined && isPublished !== undefined) {\n    if (type === 'active') {\n      currentState = {\n        status: isActive ? 'Active' : 'Inactive',\n        meaning: isActive\n          ? 'System is ready to process this alert'\n          : 'System will ignore this alert completely',\n        color: isActive ? 'success' : 'danger'\n      } as const;\n    } else {\n      currentState = {\n        status: isPublished ? 'Published' : 'Draft',\n        meaning: isPublished\n          ? 'Users can see this alert (if also active)'\n          : 'Hidden from users, in draft mode',\n        color: isPublished ? 'success' : 'warning'\n      } as const;\n    }\n  }\n\n  return { ...info, currentState };\n};\n\nconst AlertStatusTooltipContent: React.FC<{\n  info: StatusInfo;\n  type: 'active' | 'published';\n  isActive?: boolean;\n  isPublished?: boolean;\n}> = ({ info, type, isActive, isPublished }) => {\n  const showVisibilityMatrix =\n    isActive !== undefined && isPublished !== undefined;\n\n  return (\n    <div className=\\\"alert-status-tooltip\\\">\n      <div className=\\\"alert-status-tooltip__header\\\">\n        <span className=\\\"alert-status-tooltip__icon\\\">{info.icon}</span>\n        <h4 className=\\\"alert-status-tooltip__title\\\">{info.title}</h4>\n      </div>\n\n      <p className=\\\"alert-status-tooltip__description\\\">{info.description}</p>\n\n      {info.currentState && (\n        <div\n          className={`alert-status-tooltip__current alert-status-tooltip__current--${info.currentState.color}`}\n        >\n          <strong>Current State:</strong> {info.currentState.status}\n          <br />\n          <span className=\\\"alert-status-tooltip__meaning\\\">\n            {info.currentState.meaning}\n          </span>\n        </div>\n      )}\n\n      <div className=\\\"alert-status-tooltip__purpose\\\">\n        <strong>Purpose:</strong> {info.purpose}\n      </div>\n\n      <div className=\\\"alert-status-tooltip__examples\\\">\n        <strong>Use Cases:</strong>\n        <ul>\n          {info.examples.map((example, index) => (\n            <li key={index}>{example}</li>\n          ))}\n        </ul>\n      </div>\n\n      {showVisibilityMatrix && (\n        <div className=\\\"alert-status-tooltip__matrix\\\">\n          <strong>Visibility Matrix:</strong>\n          <div className=\\\"alert-status-tooltip__matrix-grid\\\">\n            <div\n              className={`alert-status-tooltip__matrix-item ${\n                !isActive && !isPublished\n                  ? 'alert-status-tooltip__matrix-item--current'\n                  : ''\n              }`}\n            >\n              <span className=\\\"alert-status-tooltip__matrix-status\\\">\u274c \u274c</span>\n              <span className=\\\"alert-status-tooltip__matrix-label\\\">\n                Disabled Draft\n              </span>\n              <span className=\\\"alert-status-tooltip__matrix-result\\\">\n                Hidden\n              </span>\n            </div>\n            <div\n              className={`alert-status-tooltip__matrix-item ${\n                isActive && !isPublished\n                  ? 'alert-status-tooltip__matrix-item--current'\n                  : ''\n              }`}\n            >\n              <span className=\\\"alert-status-tooltip__matrix-status\\\">\u2705 \u274c</span>\n              <span className=\\\"alert-status-tooltip__matrix-label\\\">\n                Active Draft\n              </span>\n              <span className=\\\"alert-status-tooltip__matrix-result\\\">\n                Hidden\n              </span>\n            </div>\n            <div\n              className={`alert-status-tooltip__matrix-item ${\n                !isActive && isPublished\n                  ? 'alert-status-tooltip__matrix-item--current'\n                  : ''\n              }`}\n            >\n              <span className=\\\"alert-status-tooltip__matrix-status\\\">\u274c \u2705</span>\n              <span className=\\\"alert-status-tooltip__matrix-label\\\">\n                Published Inactive\n              </span>\n              <span className=\\\"alert-status-tooltip__matrix-result\\\">\n                Hidden\n              </span>\n            </div>\n            <div\n              className={`alert-status-tooltip__matrix-item ${\n                isActive && isPublished\n                  ? 'alert-status-tooltip__matrix-item--current'\n                  : ''\n              }`}\n            >\n              <span className=\\\"alert-status-tooltip__matrix-status\\\">\u2705 \u2705</span>\n              <span className=\\\"alert-status-tooltip__matrix-label\\\">Live</span>\n              <span className=\\\"alert-status-tooltip__matrix-result\\\">\n                \ud83d\udfe2 Visible\n              </span>\n            </div>\n          </div>\n          <div className=\\\"alert-status-tooltip__matrix-legend\\\">\n            <span>Active | Published</span>\n          </div>\n        </div>\n      )}\n\n      <div className=\\\"alert-status-tooltip__key-point\\\">\n        <strong>\ud83d\udca1 Key Point:</strong>{' '}\n        {type === 'active'\n          ? 'Active controls system functionality - Published controls user visibility'\n          : 'Published controls user visibility - Active controls system functionality'}\n      </div>\n    </div>\n  );\n};\n\nexport const AlertStatusTooltip: React.FC<AlertStatusTooltipProps> = ({\n  type,\n  isActive,\n  isPublished,\n  children\n}) => {\n  const info = getStatusInfo(type, isActive, isPublished);\n\n  return (\n    <InteractiveTooltip\n      content={\n        <AlertStatusTooltipContent\n          info={info}\n          type={type}\n          isActive={isActive}\n          isPublished={isPublished}\n        />\n      }\n      delay={200}\n      className=\\\"alert-status-tooltip-wrapper\\\"\n    >\n      {children}\n    </InteractiveTooltip>\n  );\n};\n",
    "language":"typescript",
    "lines":233,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/AdminPostsList.tsx":{
    "content":"'use client';\n\nimport { CONTEXT_IDS } from '../../../lib/context-ids';\nimport PostsManager from '../../components/submissions-list/PostsManager';\nimport './AdminPostsList.css';\n\nexport default function AdminPostsList() {\n  return (\n    <div className=\\\"admin-posts-list\\\">\n      <h3>Recent Posts</h3>\n      <PostsManager contextId={CONTEXT_IDS.ADMIN_POSTS.toString()} />\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":15,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/CreatePermissionModal.tsx":{
    "content":"'use client';\n\n/**\n * Create Permission Modal\n * Professional modal for creating new permissions with comprehensive validation\n *\n * @author System Wizard \ud83e\uddd9\u200d\u2642\ufe0f\n * @version 1.0.0\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { z } from 'zod';\nimport './CreatePermissionModal.css';\n\n// ================================\n// TYPES & SCHEMAS\n// ================================\n\nconst PermissionSchema = z.object({\n  name: z\n    .string()\n    .min(1, 'Permission name is required')\n    .max(100, 'Permission name must be less than 100 characters')\n    .regex(\n      /^[a-zA-Z0-9_.-]+$/,\n      'Only letters, numbers, underscore, dot, and dash allowed'\n    ),\n  display_name: z\n    .string()\n    .min(1, 'Display name is required')\n    .max(200, 'Display name must be less than 200 characters'),\n  description: z.string().optional(),\n  category: z\n    .string()\n    .min(1, 'Category is required')\n    .max(50, 'Category must be less than 50 characters'),\n  is_inheritable: z.boolean(),\n  risk_level: z.enum(['low', 'medium', 'high', 'critical']),\n  dependencies: z.array(z.string()).optional(),\n  reason: z.string().optional()\n});\n\ntype PermissionFormData = z.infer<typeof PermissionSchema>;\n\ninterface CreatePermissionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  existingCategories?: string[];\n  existingPermissions?: Array<{\n    id: number;\n    name: string;\n    display_name: string;\n  }>;\n}\n\n// ================================\n// MAIN COMPONENT\n// ================================\n\nexport default function CreatePermissionModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  existingCategories = [],\n  existingPermissions = []\n}: CreatePermissionModalProps) {\n  // ================================\n  // STATE\n  // ================================\n\n  const [formData, setFormData] = useState<PermissionFormData>({\n    name: '',\n    display_name: '',\n    description: '',\n    category: '',\n    is_inheritable: false,\n    risk_level: 'low',\n    dependencies: [],\n    reason: ''\n  });\n\n  const [errors, setErrors] = useState<\n    Partial<Record<keyof PermissionFormData, string>>\n  >({});\n  const [loading, setLoading] = useState(false);\n  const [showAdvanced, setShowAdvanced] = useState(false);\n\n  // ================================\n  // EFFECTS\n  // ================================\n\n  useEffect(() => {\n    if (isOpen) {\n      // Reset form when modal opens\n      setFormData({\n        name: '',\n        display_name: '',\n        description: '',\n        category: '',\n        is_inheritable: false,\n        risk_level: 'low',\n        dependencies: [],\n        reason: ''\n      });\n      setErrors({});\n      setShowAdvanced(false);\n    }\n  }, [isOpen]);\n\n  // ================================\n  // HANDLERS\n  // ================================\n\n  const handleInputChange = (field: keyof PermissionFormData, value: any) => {\n    setFormData((prev) => ({ ...prev, [field]: value }));\n\n    // Clear error when user starts typing\n    if (errors[field]) {\n      setErrors((prev) => ({ ...prev, [field]: undefined }));\n    }\n\n    // Auto-generate name from display_name if name is empty\n    if (field === 'display_name' && !formData.name) {\n      const autoName = value\n        .toLowerCase()\n        .replace(/[^a-z0-9\\\\s]/g, '')\n        .replace(/\\\\s+/g, '_')\n        .substring(0, 50);\n      setFormData((prev) => ({ ...prev, name: autoName }));\n    }\n  };\n\n  const handleDependencyAdd = (permissionName: string) => {\n    if (permissionName && !formData.dependencies?.includes(permissionName)) {\n      setFormData((prev) => ({\n        ...prev,\n        dependencies: [...(prev.dependencies || []), permissionName]\n      }));\n    }\n  };\n\n  const handleDependencyRemove = (permissionName: string) => {\n    setFormData((prev) => ({\n      ...prev,\n      dependencies:\n        prev.dependencies?.filter((dep) => dep !== permissionName) || []\n    }));\n  };\n\n  const validateForm = (): boolean => {\n    try {\n      PermissionSchema.parse(formData);\n\n      // Check for duplicate names\n      const nameExists = existingPermissions.some(\n        (p) => p.name.toLowerCase() === formData.name.toLowerCase()\n      );\n      if (nameExists) {\n        setErrors({ name: 'Permission name already exists' });\n        return false;\n      }\n\n      setErrors({});\n      return true;\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const fieldErrors: Partial<Record<keyof PermissionFormData, string>> =\n          {};\n        error.errors.forEach((err) => {\n          const field = err.path[0] as keyof PermissionFormData;\n          fieldErrors[field] = err.message;\n        });\n        setErrors(fieldErrors);\n      }\n      return false;\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!validateForm()) return;\n\n    setLoading(true);\n    try {\n      const response = await fetch('/api/admin/permissions', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(formData)\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to create permission');\n      }\n\n      onSuccess();\n      onClose();\n    } catch (error) {\n      console.error('Error creating permission:', error);\n      setErrors({\n        name:\n          error instanceof Error ? error.message : 'Failed to create permission'\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (!loading) {\n      onClose();\n    }\n  };\n\n  // ================================\n  // RENDER HELPERS\n  // ================================\n\n  const renderRiskLevelOption = (\n    level: string,\n    description: string,\n    color: string\n  ) => (\n    <label\n      key={level}\n      className={`risk-option ${formData.risk_level === level ? 'risk-option--selected' : ''}`}\n    >\n      <input\n        type=\\\"radio\\\"\n        name=\\\"risk_level\\\"\n        value={level}\n        checked={formData.risk_level === level}\n        onChange={(e) => handleInputChange('risk_level', e.target.value)}\n        className=\\\"risk-radio\\\"\n      />\n      <div className=\\\"risk-content\\\">\n        <div\n          className=\\\"risk-indicator\\\"\n          style={{ backgroundColor: color }}\n        ></div>\n        <div className=\\\"risk-text\\\">\n          <span className=\\\"risk-level-name\\\">\n            {level.charAt(0).toUpperCase() + level.slice(1)}\n          </span>\n          <span className=\\\"risk-description\\\">{description}</span>\n        </div>\n      </div>\n    </label>\n  );\n\n  // ================================\n  // MAIN RENDER\n  // ================================\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\\\"modal-overlay\\\" onClick={handleClose}>\n      <div className=\\\"modal-container\\\" onClick={(e) => e.stopPropagation()}>\n        <div className=\\\"modal-header\\\">\n          <h2 className=\\\"modal-title\\\">\n            <span className=\\\"title-icon\\\">\ud83d\udee1\ufe0f</span>\n            Create New Permission\n          </h2>\n          <button\n            onClick={handleClose}\n            className=\\\"close-button\\\"\n            disabled={loading}\n          >\n            \u00d7\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\\\"modal-form\\\">\n          <div className=\\\"form-section\\\">\n            <h3 className=\\\"section-title\\\">Basic Information</h3>\n\n            <div className=\\\"form-grid\\\">\n              <div className=\\\"form-group\\\">\n                <label className=\\\"form-label\\\">\n                  Display Name *\n                  <span className=\\\"field-hint\\\">\n                    User-friendly name for the permission\n                  </span>\n                </label>\n                <input\n                  type=\\\"text\\\"\n                  value={formData.display_name}\n                  onChange={(e) =>\n                    handleInputChange('display_name', e.target.value)\n                  }\n                  className={`form-input ${errors.display_name ? 'form-input--error' : ''}`}\n                  placeholder=\\\"e.g., Manage Users\\\"\n                  disabled={loading}\n                />\n                {errors.display_name && (\n                  <span className=\\\"form-error\\\">{errors.display_name}</span>\n                )}\n              </div>\n\n              <div className=\\\"form-group\\\">\n                <label className=\\\"form-label\\\">\n                  System Name *\n                  <span className=\\\"field-hint\\\">\n                    Internal identifier (auto-generated)\n                  </span>\n                </label>\n                <input\n                  type=\\\"text\\\"\n                  value={formData.name}\n                  onChange={(e) => handleInputChange('name', e.target.value)}\n                  className={`form-input ${errors.name ? 'form-input--error' : ''}`}\n                  placeholder=\\\"e.g., admin.users.manage\\\"\n                  disabled={loading}\n                />\n                {errors.name && (\n                  <span className=\\\"form-error\\\">{errors.name}</span>\n                )}\n              </div>\n            </div>\n\n            <div className=\\\"form-group\\\">\n              <label className=\\\"form-label\\\">\n                Description\n                <span className=\\\"field-hint\\\">\n                  Detailed explanation of what this permission allows\n                </span>\n              </label>\n              <textarea\n                value={formData.description}\n                onChange={(e) =>\n                  handleInputChange('description', e.target.value)\n                }\n                className=\\\"form-textarea\\\"\n                placeholder=\\\"Describe what this permission allows users to do...\\\"\n                rows={3}\n                disabled={loading}\n              />\n            </div>\n\n            <div className=\\\"form-grid\\\">\n              <div className=\\\"form-group\\\">\n                <label className=\\\"form-label\\\">\n                  Category *\n                  <span className=\\\"field-hint\\\">\n                    Permission category for organization\n                  </span>\n                </label>\n                <input\n                  type=\\\"text\\\"\n                  value={formData.category}\n                  onChange={(e) =>\n                    handleInputChange('category', e.target.value)\n                  }\n                  className={`form-input ${errors.category ? 'form-input--error' : ''}`}\n                  placeholder=\\\"e.g., User Management\\\"\n                  list=\\\"categories\\\"\n                  disabled={loading}\n                />\n                <datalist id=\\\"categories\\\">\n                  {existingCategories.map((cat) => (\n                    <option key={cat} value={cat} />\n                  ))}\n                </datalist>\n                {errors.category && (\n                  <span className=\\\"form-error\\\">{errors.category}</span>\n                )}\n              </div>\n\n              <div className=\\\"form-group\\\">\n                <label className=\\\"form-label checkbox-label\\\">\n                  <input\n                    type=\\\"checkbox\\\"\n                    checked={formData.is_inheritable}\n                    onChange={(e) =>\n                      handleInputChange('is_inheritable', e.target.checked)\n                    }\n                    className=\\\"form-checkbox\\\"\n                    disabled={loading}\n                  />\n                  <span className=\\\"checkbox-text\\\">\n                    Inheritable Permission\n                    <span className=\\\"field-hint\\\">\n                      Child roles automatically inherit this permission\n                    </span>\n                  </span>\n                </label>\n              </div>\n            </div>\n          </div>\n\n          <div className=\\\"form-section\\\">\n            <h3 className=\\\"section-title\\\">Risk Assessment</h3>\n            <div className=\\\"risk-levels\\\">\n              {renderRiskLevelOption(\n                'low',\n                'Minimal impact on system security',\n                '#10b981'\n              )}\n              {renderRiskLevelOption(\n                'medium',\n                'Moderate impact on system security',\n                '#f59e0b'\n              )}\n              {renderRiskLevelOption(\n                'high',\n                'Significant impact on system security',\n                '#f97316'\n              )}\n              {renderRiskLevelOption(\n                'critical',\n                'Critical impact on system security',\n                '#ef4444'\n              )}\n            </div>\n            {errors.risk_level && (\n              <span className=\\\"form-error\\\">{errors.risk_level}</span>\n            )}\n          </div>\n\n          <div className=\\\"form-section\\\">\n            <div className=\\\"section-header\\\">\n              <h3 className=\\\"section-title\\\">Advanced Options</h3>\n              <button\n                type=\\\"button\\\"\n                onClick={() => setShowAdvanced(!showAdvanced)}\n                className=\\\"toggle-button\\\"\n                disabled={loading}\n              >\n                {showAdvanced ? '\u2191 Hide' : '\u2193 Show'}\n              </button>\n            </div>\n\n            {showAdvanced && (\n              <div className=\\\"advanced-options\\\">\n                <div className=\\\"form-group\\\">\n                  <label className=\\\"form-label\\\">\n                    Dependencies\n                    <span className=\\\"field-hint\\\">\n                      Permissions that must be granted first\n                    </span>\n                  </label>\n\n                  <div className=\\\"dependencies-section\\\">\n                    <select\n                      onChange={(e) => {\n                        if (e.target.value) {\n                          handleDependencyAdd(e.target.value);\n                          e.target.value = '';\n                        }\n                      }}\n                      className=\\\"form-select\\\"\n                      disabled={loading}\n                    >\n                      <option value=\\\"\\\">Select a dependency...</option>\n                      {existingPermissions\n                        .filter(\n                          (p) =>\n                            p.name !== formData.name &&\n                            !formData.dependencies?.includes(p.name)\n                        )\n                        .map((permission) => (\n                          <option key={permission.id} value={permission.name}>\n                            {permission.display_name} ({permission.name})\n                          </option>\n                        ))}\n                    </select>\n\n                    {formData.dependencies &&\n                      formData.dependencies.length > 0 && (\n                        <div className=\\\"dependency-list\\\">\n                          {formData.dependencies.map((dep) => (\n                            <div key={dep} className=\\\"dependency-item\\\">\n                              <span className=\\\"dependency-name\\\">{dep}</span>\n                              <button\n                                type=\\\"button\\\"\n                                onClick={() => handleDependencyRemove(dep)}\n                                className=\\\"dependency-remove\\\"\n                                disabled={loading}\n                              >\n                                \u00d7\n                              </button>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                  </div>\n                </div>\n\n                <div className=\\\"form-group\\\">\n                  <label className=\\\"form-label\\\">\n                    Reason for Creation\n                    <span className=\\\"field-hint\\\">\n                      Why is this permission being created?\n                    </span>\n                  </label>\n                  <textarea\n                    value={formData.reason}\n                    onChange={(e) =>\n                      handleInputChange('reason', e.target.value)\n                    }\n                    className=\\\"form-textarea\\\"\n                    placeholder=\\\"Explain the business need or requirement...\\\"\n                    rows={2}\n                    disabled={loading}\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div className=\\\"modal-footer\\\">\n            <button\n              type=\\\"button\\\"\n              onClick={handleClose}\n              className=\\\"cancel-button\\\"\n              disabled={loading}\n            >\n              Cancel\n            </button>\n            <button type=\\\"submit\\\" className=\\\"submit-button\\\" disabled={loading}>\n              {loading ? (\n                <>\n                  <span className=\\\"loading-spinner\\\"></span>\n                  Creating...\n                </>\n              ) : (\n                <>\n                  <span className=\\\"submit-icon\\\">\u2728</span>\n                  Create Permission\n                </>\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":542,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/PermissionManagementPanel.tsx":{
    "content":"'use client';\n\n/**\n * Permission Management Panel\n * Professional industry-grade permissions management interface\n *\n * Features:\n * - Glassmorphism design with orange undertones\n * - Full CRUD operations (Create, Read, Update, Disable, Archive)\n * - Advanced search, filtering, and sorting\n * - Real-time statistics and analytics\n * - Comprehensive audit logging\n * - Scalable architecture patterns\n *\n * @author System Wizard \ud83e\uddd9\u200d\u2642\ufe0f\n * @version 1.0.0\n */\n\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport './PermissionManagementPanel.css';\n\n// ================================\n// TYPES & INTERFACES\n// ================================\n\ninterface Permission {\n  id: number;\n  name: string;\n  display_name: string;\n  description: string;\n  category: string;\n  is_inheritable: boolean;\n  is_active: boolean;\n  is_archived: boolean;\n  is_system: boolean;\n  risk_level: 'low' | 'medium' | 'high' | 'critical';\n  sort_order: number;\n  dependencies: string[];\n  metadata: Record<string, any>;\n  created_at: string;\n  updated_at: string;\n  archived_at: string | null;\n  archived_by: number | null;\n  archive_reason: string | null;\n  usage_count: number;\n  role_count: number;\n  user_count: number;\n  last_used: string | null;\n}\n\ninterface Role {\n  id: number;\n  name: string;\n  display_name: string;\n  description: string;\n  is_active: boolean;\n  is_archived: boolean;\n  is_system: boolean;\n  is_default: boolean;\n  sort_order: number;\n  role_color: string;\n  role_icon: string;\n  metadata: Record<string, any>;\n  created_at: string;\n  updated_at: string;\n  archived_at: string | null;\n  archived_by: number | null;\n  archive_reason: string | null;\n  permission_count: number;\n  user_count: number;\n  permissions: Array<{\n    id: number;\n    name: string;\n    display_name: string;\n    category: string;\n    risk_level: string;\n  }>;\n}\n\ninterface PermissionOverview {\n  total_permissions: number;\n  active_permissions: number;\n  disabled_permissions: number;\n  archived_permissions: number;\n  total_roles: number;\n  active_roles: number;\n  disabled_roles: number;\n  archived_roles: number;\n  total_user_assignments: number;\n  active_user_assignments: number;\n  recent_changes: number;\n}\n\ntype ViewMode = 'permissions' | 'roles' | 'audit';\ntype PermissionStatus = 'all' | 'active' | 'disabled' | 'archived';\ntype RiskLevel = 'all' | 'low' | 'medium' | 'high' | 'critical';\n\n// ================================\n// MAIN COMPONENT\n// ================================\n\nexport default function PermissionManagementPanel() {\n  // ================================\n  // STATE MANAGEMENT\n  // ================================\n\n  const [viewMode, setViewMode] = useState<ViewMode>('permissions');\n  const [permissions, setPermissions] = useState<Permission[]>([]);\n  const [roles, setRoles] = useState<Role[]>([]);\n  const [overview, setOverview] = useState<PermissionOverview | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Filter and search state\n  const [searchQuery, setSearchQuery] = useState('');\n  const [statusFilter, setStatusFilter] = useState<PermissionStatus>('all');\n  const [categoryFilter, setCategoryFilter] = useState('all');\n  const [riskFilter, setRiskFilter] = useState<RiskLevel>('all');\n  const [sortBy, setSortBy] = useState('sort_order');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('asc');\n\n  // Pagination state\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize] = useState(20);\n  const [totalItems, setTotalItems] = useState(0);\n\n  // Modal state\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showArchiveModal, setShowArchiveModal] = useState(false);\n  const [selectedItem, setSelectedItem] = useState<Permission | Role | null>(\n    null\n  );\n\n  // ================================\n  // API FUNCTIONS\n  // ================================\n\n  const fetchPermissions = useCallback(async () => {\n    if (viewMode !== 'permissions') return;\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const params = new URLSearchParams({\n        search: searchQuery,\n        category: categoryFilter === 'all' ? '' : categoryFilter,\n        status: statusFilter,\n        risk_level: riskFilter,\n        sort_by: sortBy,\n        sort_order: sortOrder,\n        page: currentPage.toString(),\n        limit: pageSize.toString()\n      });\n\n      const response = await fetch(`/api/admin/permissions?${params}`);\n      if (!response.ok) throw new Error('Failed to fetch permissions');\n\n      const data = await response.json();\n      setPermissions(data.permissions || []);\n      setOverview(data.overview || null);\n      setTotalItems(data.pagination?.total || 0);\n    } catch (err) {\n      setError(\n        err instanceof Error ? err.message : 'Failed to fetch permissions'\n      );\n      console.error('Error fetching permissions:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [\n    viewMode,\n    searchQuery,\n    categoryFilter,\n    statusFilter,\n    riskFilter,\n    sortBy,\n    sortOrder,\n    currentPage,\n    pageSize\n  ]);\n\n  const fetchRoles = useCallback(async () => {\n    if (viewMode !== 'roles') return;\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      const params = new URLSearchParams({\n        search: searchQuery,\n        status: statusFilter,\n        sort_by: sortBy,\n        sort_order: sortOrder,\n        page: currentPage.toString(),\n        limit: pageSize.toString()\n      });\n\n      const response = await fetch(`/api/admin/permissions/roles?${params}`);\n      if (!response.ok) throw new Error('Failed to fetch roles');\n\n      const data = await response.json();\n      setRoles(data.roles || []);\n      setTotalItems(data.pagination?.total || 0);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch roles');\n      console.error('Error fetching roles:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [\n    viewMode,\n    searchQuery,\n    statusFilter,\n    sortBy,\n    sortOrder,\n    currentPage,\n    pageSize\n  ]);\n\n  // ================================\n  // EFFECTS\n  // ================================\n\n  useEffect(() => {\n    if (viewMode === 'permissions') {\n      fetchPermissions();\n    } else if (viewMode === 'roles') {\n      fetchRoles();\n    }\n  }, [fetchPermissions, fetchRoles, viewMode]);\n\n  // Reset pagination when filters change\n  useEffect(() => {\n    setCurrentPage(1);\n  }, [\n    searchQuery,\n    statusFilter,\n    categoryFilter,\n    riskFilter,\n    sortBy,\n    sortOrder,\n    viewMode\n  ]);\n\n  // ================================\n  // COMPUTED VALUES\n  // ================================\n\n  const categories = useMemo(() => {\n    const cats = new Set(permissions.map((p) => p.category));\n    return Array.from(cats).sort();\n  }, [permissions]);\n\n  const totalPages = Math.ceil(totalItems / pageSize);\n\n  // ================================\n  // EVENT HANDLERS\n  // ================================\n\n  const handleSearch = (query: string) => {\n    setSearchQuery(query);\n  };\n\n  const handleStatusFilter = (status: PermissionStatus) => {\n    setStatusFilter(status);\n  };\n\n  const handleCategoryFilter = (category: string) => {\n    setCategoryFilter(category);\n  };\n\n  const handleRiskFilter = (risk: RiskLevel) => {\n    setRiskFilter(risk);\n  };\n\n  const handleSort = (field: string) => {\n    if (sortBy === field) {\n      setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortBy(field);\n      setSortOrder('asc');\n    }\n  };\n\n  const handlePageChange = (page: number) => {\n    setCurrentPage(page);\n  };\n\n  const handleCreateNew = () => {\n    setSelectedItem(null);\n    setShowCreateModal(true);\n  };\n\n  const handleEdit = (item: Permission | Role) => {\n    setSelectedItem(item);\n    setShowEditModal(true);\n  };\n\n  const handleArchive = (item: Permission | Role) => {\n    setSelectedItem(item);\n    setShowArchiveModal(true);\n  };\n\n  const handleToggleStatus = async (item: Permission | Role) => {\n    try {\n      const endpoint =\n        viewMode === 'permissions'\n          ? `/api/admin/permissions/${item.id}`\n          : `/api/admin/permissions/roles/${item.id}`;\n\n      const response = await fetch(endpoint, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          is_active: !item.is_active,\n          reason: `${item.is_active ? 'Disabled' : 'Enabled'} ${viewMode === 'permissions' ? 'permission' : 'role'}`\n        })\n      });\n\n      if (!response.ok)\n        throw new Error(\n          `Failed to toggle ${viewMode === 'permissions' ? 'permission' : 'role'} status`\n        );\n\n      // Refresh data\n      if (viewMode === 'permissions') {\n        fetchPermissions();\n      } else {\n        fetchRoles();\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to toggle status');\n    }\n  };\n\n  // ================================\n  // RENDER HELPERS\n  // ================================\n\n  const renderStatusBadge = (item: Permission | Role) => {\n    if (item.is_archived) {\n      return (\n        <span className=\\\"status-badge status-badge--archived\\\">\ud83d\udce6 Archived</span>\n      );\n    }\n    if (!item.is_active) {\n      return (\n        <span className=\\\"status-badge status-badge--disabled\\\">\u23f8\ufe0f Disabled</span>\n      );\n    }\n    return <span className=\\\"status-badge status-badge--active\\\">\u2705 Active</span>;\n  };\n\n  const renderRiskBadge = (riskLevel: string | null | undefined) => {\n    if (!riskLevel) return null;\n\n    const riskConfig = {\n      low: { emoji: '\ud83d\udfe2', class: 'risk-low' },\n      medium: { emoji: '\ud83d\udfe1', class: 'risk-medium' },\n      high: { emoji: '\ud83d\udfe0', class: 'risk-high' },\n      critical: { emoji: '\ud83d\udd34', class: 'risk-critical' }\n    };\n\n    const config =\n      riskConfig[riskLevel as keyof typeof riskConfig] || riskConfig.low;\n    return (\n      <span className={`risk-badge ${config.class}`}>\n        {config.emoji} {riskLevel.charAt(0).toUpperCase() + riskLevel.slice(1)}\n      </span>\n    );\n  };\n\n  const renderSystemBadge = (isSystem: boolean) => {\n    if (!isSystem) return null;\n    return <span className=\\\"system-badge\\\">\ud83d\udd12 System</span>;\n  };\n\n  const renderOverviewStats = () => {\n    if (!overview) return null;\n\n    return (\n      <div className=\\\"overview-stats\\\">\n        <div className=\\\"stats-grid\\\">\n          <div className=\\\"stat-card stat-card--permissions\\\">\n            <div className=\\\"stat-icon\\\">\ud83d\udee1\ufe0f</div>\n            <div className=\\\"stat-content\\\">\n              <h3>Permissions</h3>\n              <div className=\\\"stat-number\\\">{overview.total_permissions}</div>\n              <div className=\\\"stat-breakdown\\\">\n                <span className=\\\"stat-item stat-item--active\\\">\n                  {overview.active_permissions} Active\n                </span>\n                <span className=\\\"stat-item stat-item--disabled\\\">\n                  {overview.disabled_permissions} Disabled\n                </span>\n                <span className=\\\"stat-item stat-item--archived\\\">\n                  {overview.archived_permissions} Archived\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\\\"stat-card stat-card--roles\\\">\n            <div className=\\\"stat-icon\\\">\ud83d\udc65</div>\n            <div className=\\\"stat-content\\\">\n              <h3>Roles</h3>\n              <div className=\\\"stat-number\\\">{overview.total_roles}</div>\n              <div className=\\\"stat-breakdown\\\">\n                <span className=\\\"stat-item stat-item--active\\\">\n                  {overview.active_roles} Active\n                </span>\n                <span className=\\\"stat-item stat-item--disabled\\\">\n                  {overview.disabled_roles} Disabled\n                </span>\n                <span className=\\\"stat-item stat-item--archived\\\">\n                  {overview.archived_roles} Archived\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\\\"stat-card stat-card--assignments\\\">\n            <div className=\\\"stat-icon\\\">\ud83d\udccb</div>\n            <div className=\\\"stat-content\\\">\n              <h3>Assignments</h3>\n              <div className=\\\"stat-number\\\">\n                {overview.total_user_assignments}\n              </div>\n              <div className=\\\"stat-breakdown\\\">\n                <span className=\\\"stat-item stat-item--active\\\">\n                  {overview.active_user_assignments} Active\n                </span>\n                <span className=\\\"stat-item stat-item--info\\\">\n                  {overview.recent_changes} Recent Changes\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderSearchAndFilters = () => (\n    <div className=\\\"search-filters\\\">\n      <div className=\\\"search-bar\\\">\n        <input\n          type=\\\"text\\\"\n          placeholder={`Search ${viewMode}...`}\n          value={searchQuery}\n          onChange={(e) => handleSearch(e.target.value)}\n          className=\\\"search-input\\\"\n        />\n        <span className=\\\"search-icon\\\">\ud83d\udd0d</span>\n      </div>\n\n      <div className=\\\"filters\\\">\n        <select\n          value={statusFilter}\n          onChange={(e) =>\n            handleStatusFilter(e.target.value as PermissionStatus)\n          }\n          className=\\\"filter-select\\\"\n        >\n          <option value=\\\"all\\\">All Status</option>\n          <option value=\\\"active\\\">Active</option>\n          <option value=\\\"disabled\\\">Disabled</option>\n          <option value=\\\"archived\\\">Archived</option>\n        </select>\n\n        {viewMode === 'permissions' && (\n          <>\n            <select\n              value={categoryFilter}\n              onChange={(e) => handleCategoryFilter(e.target.value)}\n              className=\\\"filter-select\\\"\n            >\n              <option value=\\\"all\\\">All Categories</option>\n              {categories.map((cat) => (\n                <option key={cat} value={cat}>\n                  {cat}\n                </option>\n              ))}\n            </select>\n\n            <select\n              value={riskFilter}\n              onChange={(e) => handleRiskFilter(e.target.value as RiskLevel)}\n              className=\\\"filter-select\\\"\n            >\n              <option value=\\\"all\\\">All Risk Levels</option>\n              <option value=\\\"low\\\">Low Risk</option>\n              <option value=\\\"medium\\\">Medium Risk</option>\n              <option value=\\\"high\\\">High Risk</option>\n              <option value=\\\"critical\\\">Critical Risk</option>\n            </select>\n          </>\n        )}\n\n        <select\n          value={`${sortBy}:${sortOrder}`}\n          onChange={(e) => {\n            const [field, order] = e.target.value.split(':');\n            setSortBy(field);\n            setSortOrder(order as 'asc' | 'desc');\n          }}\n          className=\\\"filter-select\\\"\n        >\n          <option value=\\\"sort_order:asc\\\">Default Order</option>\n          <option value=\\\"display_name:asc\\\">Name A-Z</option>\n          <option value=\\\"display_name:desc\\\">Name Z-A</option>\n          <option value=\\\"created_at:desc\\\">Newest First</option>\n          <option value=\\\"created_at:asc\\\">Oldest First</option>\n          <option value=\\\"usage_count:desc\\\">Most Used</option>\n          <option value=\\\"usage_count:asc\\\">Least Used</option>\n        </select>\n      </div>\n    </div>\n  );\n\n  const renderPermissionsList = () => (\n    <div className=\\\"items-list\\\">\n      {permissions.map((permission) => (\n        <div key={permission.id} className=\\\"item-card permission-card\\\">\n          <div className=\\\"item-header\\\">\n            <div className=\\\"item-title\\\">\n              <h3>{permission.display_name}</h3>\n              <code className=\\\"item-code\\\">{permission.name}</code>\n            </div>\n            <div className=\\\"item-badges\\\">\n              {renderStatusBadge(permission)}\n              {renderRiskBadge(permission.risk_level)}\n              {renderSystemBadge(permission.is_system)}\n            </div>\n          </div>\n\n          <div className=\\\"item-content\\\">\n            <p className=\\\"item-description\\\">\n              {permission.description || 'No description provided'}\n            </p>\n\n            <div className=\\\"item-meta\\\">\n              <span className=\\\"meta-item\\\">\n                <span className=\\\"meta-label\\\">Category:</span>\n                <span className=\\\"meta-value category-tag\\\">\n                  {permission.category}\n                </span>\n              </span>\n              <span className=\\\"meta-item\\\">\n                <span className=\\\"meta-label\\\">Usage:</span>\n                <span className=\\\"meta-value\\\">\n                  {permission.role_count} roles, {permission.user_count} users\n                </span>\n              </span>\n              {permission.is_inheritable && (\n                <span className=\\\"meta-item\\\">\n                  <span className=\\\"inheritable-badge\\\">\ud83d\udd17 Inheritable</span>\n                </span>\n              )}\n            </div>\n\n            {permission.dependencies && permission.dependencies.length > 0 && (\n              <div className=\\\"dependencies\\\">\n                <span className=\\\"dependencies-label\\\">Dependencies:</span>\n                {permission.dependencies.map((dep) => (\n                  <span key={dep} className=\\\"dependency-tag\\\">\n                    {dep}\n                  </span>\n                ))}\n              </div>\n            )}\n          </div>\n\n          <div className=\\\"item-actions\\\">\n            <button\n              onClick={() => handleEdit(permission)}\n              className=\\\"action-btn action-btn--edit\\\"\n              disabled={loading}\n            >\n              \u270f\ufe0f Edit\n            </button>\n\n            <button\n              onClick={() => handleToggleStatus(permission)}\n              className={`action-btn ${permission.is_active ? 'action-btn--disable' : 'action-btn--enable'}`}\n              disabled={loading || permission.is_system}\n            >\n              {permission.is_active ? '\u23f8\ufe0f Disable' : '\u25b6\ufe0f Enable'}\n            </button>\n\n            {!permission.is_system && !permission.is_archived && (\n              <button\n                onClick={() => handleArchive(permission)}\n                className=\\\"action-btn action-btn--archive\\\"\n                disabled={loading}\n              >\n                \ud83d\udce6 Archive\n              </button>\n            )}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n\n  const renderRolesList = () => (\n    <div className=\\\"items-list\\\">\n      {roles.map((role) => (\n        <div key={role.id} className=\\\"item-card role-card\\\">\n          <div className=\\\"item-header\\\">\n            <div className=\\\"item-title\\\">\n              <div className=\\\"role-title-with-icon\\\">\n                <span className=\\\"role-icon\\\" style={{ color: role.role_color }}>\n                  {getRoleIcon(role.role_icon)}\n                </span>\n                <h3>{role.display_name}</h3>\n              </div>\n              <code className=\\\"item-code\\\">{role.name}</code>\n            </div>\n            <div className=\\\"item-badges\\\">\n              {renderStatusBadge(role)}\n              {renderSystemBadge(role.is_system)}\n              {role.is_default && (\n                <span className=\\\"default-badge\\\">\u2b50 Default</span>\n              )}\n            </div>\n          </div>\n\n          <div className=\\\"item-content\\\">\n            <p className=\\\"item-description\\\">\n              {role.description || 'No description provided'}\n            </p>\n\n            <div className=\\\"item-meta\\\">\n              <span className=\\\"meta-item\\\">\n                <span className=\\\"meta-label\\\">Users:</span>\n                <span className=\\\"meta-value\\\">{role.user_count}</span>\n              </span>\n              <span className=\\\"meta-item\\\">\n                <span className=\\\"meta-label\\\">Permissions:</span>\n                <span className=\\\"meta-value\\\">{role.permission_count}</span>\n              </span>\n            </div>\n\n            {role.permissions.length > 0 && (\n              <div className=\\\"role-permissions\\\">\n                <span className=\\\"permissions-label\\\">Permissions:</span>\n                <div className=\\\"permissions-tags\\\">\n                  {role.permissions.slice(0, 5).map((permission) => (\n                    <span key={permission.id} className=\\\"permission-tag\\\">\n                      {permission.display_name}\n                    </span>\n                  ))}\n                  {role.permissions.length > 5 && (\n                    <span className=\\\"permissions-more\\\">\n                      +{role.permissions.length - 5} more\n                    </span>\n                  )}\n                </div>\n              </div>\n            )}\n          </div>\n\n          <div className=\\\"item-actions\\\">\n            <button\n              onClick={() => handleEdit(role)}\n              className=\\\"action-btn action-btn--edit\\\"\n              disabled={loading}\n            >\n              \u270f\ufe0f Edit\n            </button>\n\n            <button\n              onClick={() => handleToggleStatus(role)}\n              className={`action-btn ${role.is_active ? 'action-btn--disable' : 'action-btn--enable'}`}\n              disabled={loading || role.is_system}\n            >\n              {role.is_active ? '\u23f8\ufe0f Disable' : '\u25b6\ufe0f Enable'}\n            </button>\n\n            {!role.is_system && !role.is_archived && (\n              <button\n                onClick={() => handleArchive(role)}\n                className=\\\"action-btn action-btn--archive\\\"\n                disabled={loading}\n              >\n                \ud83d\udce6 Archive\n              </button>\n            )}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n\n  const renderPagination = () => {\n    if (totalPages <= 1) return null;\n\n    return (\n      <div className=\\\"pagination\\\">\n        <button\n          onClick={() => handlePageChange(currentPage - 1)}\n          disabled={currentPage === 1}\n          className=\\\"pagination-btn\\\"\n        >\n          \u2190 Previous\n        </button>\n\n        <div className=\\\"pagination-info\\\">\n          Page {currentPage} of {totalPages} ({totalItems} total)\n        </div>\n\n        <button\n          onClick={() => handlePageChange(currentPage + 1)}\n          disabled={currentPage === totalPages}\n          className=\\\"pagination-btn\\\"\n        >\n          Next \u2192\n        </button>\n      </div>\n    );\n  };\n\n  // ================================\n  // UTILITY FUNCTIONS\n  // ================================\n\n  const getRoleIcon = (iconName: string) => {\n    const icons: Record<string, string> = {\n      crown: '\ud83d\udc51',\n      shield: '\ud83d\udee1\ufe0f',\n      eye: '\ud83d\udc41\ufe0f',\n      users: '\ud83d\udc65',\n      pen: '\u270f\ufe0f',\n      star: '\u2b50',\n      flask: '\ud83e\uddea',\n      user: '\ud83d\udc64'\n    };\n    return icons[iconName] || '\ud83d\udc64';\n  };\n\n  // ================================\n  // MAIN RENDER\n  // ================================\n\n  return (\n    <div className=\\\"permission-management-panel\\\">\n      {/* Header */}\n      <div className=\\\"panel-header\\\">\n        <div className=\\\"header-content\\\">\n          <h1 className=\\\"panel-title\\\">\n            <span className=\\\"title-icon\\\">\ud83d\udd10</span>\n            Permission Management System\n          </h1>\n          <p className=\\\"panel-subtitle\\\">\n            Comprehensive permissions and roles management with enterprise-grade\n            security\n          </p>\n        </div>\n\n        <div className=\\\"header-actions\\\">\n          <button\n            onClick={handleCreateNew}\n            className=\\\"create-btn\\\"\n            disabled={loading}\n          >\n            <span className=\\\"btn-icon\\\">\u2795</span>\n            Create New {viewMode === 'permissions' ? 'Permission' : 'Role'}\n          </button>\n        </div>\n      </div>\n\n      {/* Navigation Tabs */}\n      <div className=\\\"nav-tabs\\\">\n        <button\n          onClick={() => setViewMode('permissions')}\n          className={`nav-tab ${viewMode === 'permissions' ? 'nav-tab--active' : ''}`}\n        >\n          \ud83d\udee1\ufe0f Permissions\n        </button>\n        <button\n          onClick={() => setViewMode('roles')}\n          className={`nav-tab ${viewMode === 'roles' ? 'nav-tab--active' : ''}`}\n        >\n          \ud83d\udc65 Roles\n        </button>\n        <button\n          onClick={() => setViewMode('audit')}\n          className={`nav-tab ${viewMode === 'audit' ? 'nav-tab--active' : ''}`}\n        >\n          \ud83d\udcca Audit Trail\n        </button>\n      </div>\n\n      {/* Overview Statistics */}\n      {viewMode === 'permissions' && renderOverviewStats()}\n\n      {/* Error Display */}\n      {error && (\n        <div className=\\\"error-message\\\">\n          <span className=\\\"error-icon\\\">\u26a0\ufe0f</span>\n          {error}\n          <button onClick={() => setError(null)} className=\\\"error-close\\\">\n            \u00d7\n          </button>\n        </div>\n      )}\n\n      {/* Search and Filters */}\n      {viewMode !== 'audit' && renderSearchAndFilters()}\n\n      {/* Content Area */}\n      <div className=\\\"content-area\\\">\n        {loading && (\n          <div className=\\\"loading-overlay\\\">\n            <div className=\\\"loading-spinner\\\"></div>\n            <p>Loading {viewMode}...</p>\n          </div>\n        )}\n\n        {!loading && viewMode === 'permissions' && renderPermissionsList()}\n        {!loading && viewMode === 'roles' && renderRolesList()}\n        {!loading && viewMode === 'audit' && (\n          <div className=\\\"audit-placeholder\\\">\n            <h3>\ud83d\udcca Audit Trail</h3>\n            <p>Comprehensive audit logging coming soon...</p>\n          </div>\n        )}\n\n        {!loading &&\n          ((viewMode === 'permissions' && permissions.length === 0) ||\n            (viewMode === 'roles' && roles.length === 0)) && (\n            <div className=\\\"empty-state\\\">\n              <div className=\\\"empty-icon\\\">\n                {viewMode === 'permissions' ? '\ud83d\udee1\ufe0f' : '\ud83d\udc65'}\n              </div>\n              <h3>No {viewMode} found</h3>\n              <p>\n                {searchQuery ||\n                statusFilter !== 'all' ||\n                categoryFilter !== 'all' ||\n                riskFilter !== 'all'\n                  ? 'Try adjusting your search criteria or filters.'\n                  : `Create your first ${viewMode === 'permissions' ? 'permission' : 'role'} to get started.`}\n              </p>\n            </div>\n          )}\n      </div>\n\n      {/* Pagination */}\n      {renderPagination()}\n\n      {/* Modals would go here */}\n      {/* TODO: Implement CreatePermissionModal, EditPermissionModal, ArchiveModal, etc. */}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":860,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel.tsx":{
    "content":"/**\n * User Management Panel - Legacy Export\n *\n * This file now serves as a simple re-export for the refactored\n * UserManagementPanel component, maintaining backward compatibility\n * while the actual implementation is now modularized.\n */\n\nexport { UserManagementPanel } from './UserManagementPanel/UserManagementPanel';\n",
    "language":"typescript",
    "lines":10,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/GlobalGuestQuotaPanel.tsx":{
    "content":"/**\n * Global Guest Quota Management Panel\n *\n * Admin interface for managing global quota settings for anonymous/guest users\n * with feature-level granularity and real-time updates.\n *\n * @version 1.0.0\n * @author System\n */\n\nimport { useCallback, useEffect, useState } from 'react';\n\n// ================================\n// TYPES & INTERFACES\n// ================================\n\ninterface GlobalGuestQuota {\n  id: number;\n  service_name: string;\n  feature_name: string;\n  quota_limit: number;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n  description: string | null;\n  created_by: number | null;\n  created_at: string;\n  updated_at: string;\n  service_display_name?: string;\n  feature_display_name?: string;\n}\n\ninterface ServiceFeature {\n  service_name: string;\n  service_display_name: string;\n  feature_name: string;\n  feature_display_name: string;\n  feature_type: string;\n  current_quota: number | null;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n}\n\ninterface ApiResponse<T> {\n  success: boolean;\n  data: T;\n  message?: string;\n  error?: string;\n}\n\n// ================================\n// MAIN COMPONENT\n// ================================\n\nexport default function GlobalGuestQuotaPanel(): React.JSX.Element {\n  // State management\n  const [quotas, setQuotas] = useState<GlobalGuestQuota[]>([]);\n  const [availableFeatures, setAvailableFeatures] = useState<ServiceFeature[]>(\n    []\n  );\n  const [loading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n  const [editingQuota, setEditingQuota] = useState<GlobalGuestQuota | null>(\n    null\n  );\n  const [showCreateForm, setShowCreateForm] = useState<boolean>(false);\n\n  // Form state for creating/editing quotas\n  const [formData, setFormData] = useState({\n    service_name: '',\n    feature_name: '',\n    quota_limit: 1,\n    is_unlimited: false,\n    reset_period: 'daily' as 'hourly' | 'daily' | 'weekly' | 'monthly',\n    description: '',\n    is_active: true\n  });\n\n  // ================================\n  // DATA FETCHING\n  // ================================\n\n  const fetchQuotas = useCallback(async (): Promise<void> => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const response = await fetch('/api/admin/quotas/global', {\n        method: 'GET',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      const result: ApiResponse<{\n        quotas: GlobalGuestQuota[];\n        available_features: ServiceFeature[];\n      }> = await response.json();\n\n      if (result.success) {\n        setQuotas(result.data.quotas);\n        setAvailableFeatures(result.data.available_features);\n      } else {\n        setError(result.error || 'Failed to fetch global quotas');\n      }\n    } catch (err) {\n      console.error('Error fetching global quotas:', err);\n      setError('Network error while fetching quotas');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchQuotas();\n  }, [fetchQuotas]);\n\n  // ================================\n  // CRUD OPERATIONS\n  // ================================\n\n  const handleCreateQuota = async (): Promise<void> => {\n    try {\n      const response = await fetch('/api/admin/quotas/global', {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(formData)\n      });\n\n      const result: ApiResponse<{ quota: GlobalGuestQuota }> =\n        await response.json();\n\n      if (result.success) {\n        await fetchQuotas(); // Refresh the list\n        setShowCreateForm(false);\n        resetForm();\n        setError(null);\n      } else {\n        setError(result.error || 'Failed to create quota');\n      }\n    } catch (err) {\n      console.error('Error creating quota:', err);\n      setError('Network error while creating quota');\n    }\n  };\n\n  const handleUpdateQuota = async (quotaId: number): Promise<void> => {\n    if (!editingQuota) return;\n\n    try {\n      const updateData = {\n        quota_limit: editingQuota.is_unlimited\n          ? undefined\n          : editingQuota.quota_limit,\n        is_unlimited: editingQuota.is_unlimited,\n        reset_period: editingQuota.reset_period,\n        description: editingQuota.description || '',\n        is_active: editingQuota.is_active\n      };\n\n      const response = await fetch(`/api/admin/quotas/global/${quotaId}`, {\n        method: 'PUT',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(updateData)\n      });\n\n      const result: ApiResponse<{ quota: GlobalGuestQuota }> =\n        await response.json();\n\n      if (result.success) {\n        await fetchQuotas(); // Refresh the list\n        setEditingQuota(null);\n        setError(null);\n      } else {\n        setError(result.error || 'Failed to update quota');\n      }\n    } catch (err) {\n      console.error('Error updating quota:', err);\n      setError('Network error while updating quota');\n    }\n  };\n\n  const handleDeleteQuota = async (quotaId: number): Promise<void> => {\n    if (\n      !confirm(\n        'Are you sure you want to delete this global quota? This will remove quota limits for this service/feature for all guest users.'\n      )\n    ) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/admin/quotas/global/${quotaId}`, {\n        method: 'DELETE',\n        credentials: 'include'\n      });\n\n      const result: ApiResponse<{ deleted: boolean }> = await response.json();\n\n      if (result.success) {\n        await fetchQuotas(); // Refresh the list\n        setError(null);\n      } else {\n        setError(result.error || 'Failed to delete quota');\n      }\n    } catch (err) {\n      console.error('Error deleting quota:', err);\n      setError('Network error while deleting quota');\n    }\n  };\n\n  // ================================\n  // FORM HELPERS\n  // ================================\n\n  const resetForm = (): void => {\n    setFormData({\n      service_name: '',\n      feature_name: '',\n      quota_limit: 1,\n      is_unlimited: false,\n      reset_period: 'daily',\n      description: '',\n      is_active: true\n    });\n  };\n\n  const getAvailableFeaturesForService = (\n    serviceName: string\n  ): ServiceFeature[] => {\n    return availableFeatures.filter((f) => f.service_name === serviceName);\n  };\n\n  const getUniqueServices = (): ServiceFeature[] => {\n    const serviceMap = new Map<string, ServiceFeature>();\n    availableFeatures.forEach((feature) => {\n      if (!serviceMap.has(feature.service_name)) {\n        serviceMap.set(feature.service_name, feature);\n      }\n    });\n    return Array.from(serviceMap.values());\n  };\n\n  // ================================\n  // RENDER METHODS\n  // ================================\n\n  const renderCreateForm = (): React.JSX.Element => (\n    <div\n      style={{\n        background: 'var(--glass-overlay-medium, var(--glass-bg-medium))',\n        padding: '20px',\n        borderRadius: '8px',\n        marginBottom: '20px',\n        border:\n          '1px solid var(--glass-border-overlay-medium, var(--glass-border-medium))',\n        backdropFilter: 'var(--glass-blur-medium)',\n        WebkitBackdropFilter: 'var(--glass-blur-medium)',\n        boxShadow: 'var(--glass-shadow-medium)'\n      }}\n    >\n      <h3\n        style={{\n          color: 'var(--dark-bg__text-color--primary)',\n          marginBottom: '15px'\n        }}\n      >\n        \ud83c\udfaf Create Global Guest Quota\n      </h3>\n\n      <div\n        style={{\n          display: 'grid',\n          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',\n          gap: '15px',\n          marginBottom: '15px'\n        }}\n      >\n        <div>\n          <label\n            style={{ color: 'white', display: 'block', marginBottom: '5px' }}\n          >\n            Service:\n          </label>\n          <select\n            value={formData.service_name}\n            onChange={(e) =>\n              setFormData({\n                ...formData,\n                service_name: e.target.value,\n                feature_name: ''\n              })\n            }\n            style={{\n              width: '100%',\n              padding: '8px',\n              borderRadius: '6px',\n              border: 'none'\n            }}\n          >\n            <option value=\\\"\\\">Select Service</option>\n            {getUniqueServices().map((service) => (\n              <option key={service.service_name} value={service.service_name}>\n                {service.service_display_name}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        <div>\n          <label\n            style={{ color: 'white', display: 'block', marginBottom: '5px' }}\n          >\n            Feature:\n          </label>\n          <select\n            value={formData.feature_name}\n            onChange={(e) =>\n              setFormData({ ...formData, feature_name: e.target.value })\n            }\n            disabled={!formData.service_name}\n            style={{\n              width: '100%',\n              padding: '8px',\n              borderRadius: '6px',\n              border: 'none'\n            }}\n          >\n            <option value=\\\"\\\">Select Feature</option>\n            {getAvailableFeaturesForService(formData.service_name).map(\n              (feature) => (\n                <option key={feature.feature_name} value={feature.feature_name}>\n                  {feature.feature_display_name}\n                </option>\n              )\n            )}\n          </select>\n        </div>\n\n        <div>\n          <label\n            style={{ color: 'white', display: 'block', marginBottom: '5px' }}\n          >\n            Quota Limit:\n          </label>\n          <input\n            type=\\\"number\\\"\n            value={formData.quota_limit}\n            onChange={(e) => {\n              const value = parseInt(e.target.value) || 0;\n              setFormData({\n                ...formData,\n                quota_limit: value,\n                is_unlimited: value === 0\n              });\n            }}\n            min=\\\"0\\\"\n            style={{\n              width: '100%',\n              padding: '8px',\n              borderRadius: '6px',\n              border: 'none'\n            }}\n            placeholder=\\\"Enter 0 for unlimited\\\"\n          />\n          <small\n            style={{\n              color: '#ccc',\n              fontSize: '12px',\n              marginTop: '2px',\n              display: 'block'\n            }}\n          >\n            \ud83d\udca1 Enter 0 for unlimited quota\n          </small>\n        </div>\n\n        <div>\n          <label\n            style={{ color: 'white', display: 'block', marginBottom: '5px' }}\n          >\n            Reset Period:\n          </label>\n          <select\n            value={formData.reset_period}\n            onChange={(e) =>\n              setFormData({ ...formData, reset_period: e.target.value as any })\n            }\n            style={{\n              width: '100%',\n              padding: '8px',\n              borderRadius: '6px',\n              border: 'none'\n            }}\n          >\n            <option value=\\\"hourly\\\">Hourly</option>\n            <option value=\\\"daily\\\">Daily</option>\n            <option value=\\\"weekly\\\">Weekly</option>\n            <option value=\\\"monthly\\\">Monthly</option>\n          </select>\n        </div>\n      </div>\n\n      <div style={{ marginBottom: '15px' }}>\n        <label\n          style={{ color: 'white', display: 'block', marginBottom: '5px' }}\n        >\n          Description (optional):\n        </label>\n        <input\n          type=\\\"text\\\"\n          value={formData.description}\n          onChange={(e) =>\n            setFormData({ ...formData, description: e.target.value })\n          }\n          style={{\n            width: '100%',\n            padding: '8px',\n            borderRadius: '6px',\n            border: 'none'\n          }}\n          placeholder=\\\"Optional description for this quota\\\"\n        />\n      </div>\n\n      <div style={{ display: 'flex', gap: '10px' }}>\n        <button\n          onClick={handleCreateQuota}\n          disabled={!formData.service_name || !formData.feature_name}\n          style={{\n            background:\n              formData.service_name && formData.feature_name\n                ? '#4CAF50'\n                : '#666',\n            color: 'white',\n            border: 'none',\n            padding: '10px 20px',\n            borderRadius: '6px',\n            cursor:\n              formData.service_name && formData.feature_name\n                ? 'pointer'\n                : 'not-allowed'\n          }}\n        >\n          \u2705 Create Quota\n        </button>\n        <button\n          onClick={() => {\n            setShowCreateForm(false);\n            resetForm();\n          }}\n          style={{\n            background: '#f44336',\n            color: 'white',\n            border: 'none',\n            padding: '10px 20px',\n            borderRadius: '6px',\n            cursor: 'pointer'\n          }}\n        >\n          \u274c Cancel\n        </button>\n      </div>\n    </div>\n  );\n\n  const renderQuotaList = (): React.JSX.Element => (\n    <div>\n      <h3 style={{ marginBottom: '15px' }}>\ud83d\udcca Current Global Guest Quotas</h3>\n\n      {quotas.length === 0 ? (\n        <p style={{ color: '#666', fontStyle: 'italic' }}>\n          No global guest quotas configured. Guest users will use system\n          defaults.\n        </p>\n      ) : (\n        <div style={{ display: 'grid', gap: '15px' }}>\n          {quotas.map((quota) => (\n            <div\n              key={quota.id}\n              style={{\n                background: quota.is_active\n                  ? 'var(--glass-overlay-medium, var(--glass-bg-medium))'\n                  : 'var(--glass-overlay-light, var(--glass-bg-light))',\n                padding: '15px',\n                borderRadius: '8px',\n                border: `1px solid ${\n                  quota.is_active\n                    ? 'var(--glass-border-overlay-medium, var(--glass-border-medium))'\n                    : 'var(--glass-border-overlay-light, var(--glass-border-light))'\n                }`,\n                backdropFilter: 'var(--glass-blur-medium)',\n                WebkitBackdropFilter: 'var(--glass-blur-medium)',\n                boxShadow: quota.is_active\n                  ? 'var(--glass-shadow-medium)'\n                  : 'var(--glass-shadow-light)'\n              }}\n            >\n              {editingQuota?.id === quota.id ? (\n                <div>\n                  <h4 style={{ marginBottom: '10px' }}>\n                    \ud83d\udd27 Editing: {quota.service_display_name} -{' '}\n                    {quota.feature_display_name}\n                  </h4>\n\n                  <div\n                    style={{\n                      display: 'grid',\n                      gridTemplateColumns:\n                        'repeat(auto-fit, minmax(200px, 1fr))',\n                      gap: '10px',\n                      marginBottom: '10px'\n                    }}\n                  >\n                    <div>\n                      <label\n                        style={{\n                          display: 'block',\n                          marginBottom: '5px',\n                          fontWeight: 'bold'\n                        }}\n                      >\n                        Quota Limit:\n                      </label>\n                      <input\n                        type=\\\"number\\\"\n                        value={\n                          editingQuota.quota_limit === -1\n                            ? 0\n                            : editingQuota.quota_limit\n                        }\n                        onChange={(e) => {\n                          const value = parseInt(e.target.value) || 0;\n                          setEditingQuota({\n                            ...editingQuota,\n                            quota_limit: value,\n                            is_unlimited: value === 0\n                          });\n                        }}\n                        min=\\\"0\\\"\n                        style={{\n                          width: '100%',\n                          padding: '6px',\n                          borderRadius: '4px',\n                          border: '1px solid #ccc'\n                        }}\n                        placeholder=\\\"Enter 0 for unlimited\\\"\n                      />\n                      <small\n                        style={{\n                          color: '#666',\n                          fontSize: '11px',\n                          marginTop: '2px',\n                          display: 'block'\n                        }}\n                      >\n                        \ud83d\udca1 Enter 0 for unlimited quota\n                      </small>\n                    </div>\n\n                    <div>\n                      <label\n                        style={{\n                          display: 'block',\n                          marginBottom: '5px',\n                          fontWeight: 'bold'\n                        }}\n                      >\n                        Reset Period:\n                      </label>\n                      <select\n                        value={editingQuota.reset_period}\n                        onChange={(e) =>\n                          setEditingQuota({\n                            ...editingQuota,\n                            reset_period: e.target.value\n                          })\n                        }\n                        style={{\n                          width: '100%',\n                          padding: '6px',\n                          borderRadius: '4px',\n                          border: '1px solid #ccc'\n                        }}\n                      >\n                        <option value=\\\"hourly\\\">Hourly</option>\n                        <option value=\\\"daily\\\">Daily</option>\n                        <option value=\\\"weekly\\\">Weekly</option>\n                        <option value=\\\"monthly\\\">Monthly</option>\n                      </select>\n                    </div>\n\n                    <div>\n                      <label\n                        style={{\n                          display: 'block',\n                          marginBottom: '5px',\n                          fontWeight: 'bold'\n                        }}\n                      >\n                        <input\n                          type=\\\"checkbox\\\"\n                          checked={editingQuota.is_active}\n                          onChange={(e) =>\n                            setEditingQuota({\n                              ...editingQuota,\n                              is_active: e.target.checked\n                            })\n                          }\n                          style={{ marginRight: '5px' }}\n                        />\n                        Active\n                      </label>\n                    </div>\n                  </div>\n\n                  <div style={{ marginBottom: '10px' }}>\n                    <label\n                      style={{\n                        display: 'block',\n                        marginBottom: '5px',\n                        fontWeight: 'bold'\n                      }}\n                    >\n                      Description:\n                    </label>\n                    <input\n                      type=\\\"text\\\"\n                      value={editingQuota.description || ''}\n                      onChange={(e) =>\n                        setEditingQuota({\n                          ...editingQuota,\n                          description: e.target.value\n                        })\n                      }\n                      style={{\n                        width: '100%',\n                        padding: '6px',\n                        borderRadius: '4px',\n                        border: '1px solid #ccc'\n                      }}\n                      placeholder=\\\"Optional description\\\"\n                    />\n                  </div>\n\n                  <div style={{ display: 'flex', gap: '10px' }}>\n                    <button\n                      onClick={() => handleUpdateQuota(quota.id)}\n                      style={{\n                        background: '#4CAF50',\n                        color: 'white',\n                        border: 'none',\n                        padding: '8px 16px',\n                        borderRadius: '4px',\n                        cursor: 'pointer'\n                      }}\n                    >\n                      \ud83d\udcbe Save Changes\n                    </button>\n                    <button\n                      onClick={() => setEditingQuota(null)}\n                      style={{\n                        background: '#f44336',\n                        color: 'white',\n                        border: 'none',\n                        padding: '8px 16px',\n                        borderRadius: '4px',\n                        cursor: 'pointer'\n                      }}\n                    >\n                      \u274c Cancel\n                    </button>\n                  </div>\n                </div>\n              ) : (\n                <div>\n                  <div\n                    style={{\n                      display: 'flex',\n                      justifyContent: 'space-between',\n                      alignItems: 'flex-start',\n                      marginBottom: '10px'\n                    }}\n                  >\n                    <h4 style={{ margin: 0 }}>\n                      {quota.service_display_name} -{' '}\n                      {quota.feature_display_name}\n                      {!quota.is_active && (\n                        <span style={{ color: '#999', marginLeft: '10px' }}>\n                          (Inactive)\n                        </span>\n                      )}\n                    </h4>\n                    <div style={{ display: 'flex', gap: '5px' }}>\n                      <button\n                        onClick={() => setEditingQuota(quota)}\n                        style={{\n                          background: '#2196F3',\n                          color: 'white',\n                          border: 'none',\n                          padding: '5px 10px',\n                          borderRadius: '4px',\n                          cursor: 'pointer',\n                          fontSize: '12px'\n                        }}\n                      >\n                        \u270f\ufe0f Edit\n                      </button>\n                      <button\n                        onClick={() => handleDeleteQuota(quota.id)}\n                        style={{\n                          background: '#f44336',\n                          color: 'white',\n                          border: 'none',\n                          padding: '5px 10px',\n                          borderRadius: '4px',\n                          cursor: 'pointer',\n                          fontSize: '12px'\n                        }}\n                      >\n                        \ud83d\uddd1\ufe0f Delete\n                      </button>\n                    </div>\n                  </div>\n\n                  <div\n                    style={{\n                      display: 'grid',\n                      gridTemplateColumns:\n                        'repeat(auto-fit, minmax(150px, 1fr))',\n                      gap: '10px',\n                      fontSize: '14px'\n                    }}\n                  >\n                    <div>\n                      <strong>Quota:</strong>{' '}\n                      {quota.is_unlimited || quota.quota_limit === -1\n                        ? '\u267e\ufe0f Unlimited (0)'\n                        : `${quota.quota_limit} per ${quota.reset_period}`}\n                    </div>\n                    {quota.description && (\n                      <div>\n                        <strong>Description:</strong> {quota.description}\n                      </div>\n                    )}\n                    <div>\n                      <strong>Created:</strong>{' '}\n                      {new Date(quota.created_at).toLocaleDateString()}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n\n  // ================================\n  // MAIN RENDER\n  // ================================\n\n  if (loading) {\n    return (\n      <div style={{ padding: '20px', textAlign: 'center' }}>\n        <div style={{ fontSize: '24px', marginBottom: '10px' }}>\u23f3</div>\n        <p>Loading global guest quotas...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ padding: '20px' }}>\n      <div\n        style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          marginBottom: '20px'\n        }}\n      >\n        <h2>\ud83c\udfaf Global Guest Quota Management</h2>\n        <button\n          onClick={() => setShowCreateForm(true)}\n          disabled={showCreateForm}\n          style={{\n            background: showCreateForm ? '#666' : '#4CAF50',\n            color: 'white',\n            border: 'none',\n            padding: '10px 20px',\n            borderRadius: '6px',\n            cursor: showCreateForm ? 'not-allowed' : 'pointer'\n          }}\n        >\n          \u2795 Add New Quota\n        </button>\n      </div>\n\n      {error && (\n        <div\n          style={{\n            background: '#ffebee',\n            color: '#c62828',\n            padding: '10px',\n            borderRadius: '6px',\n            marginBottom: '20px',\n            border: '1px solid #e57373'\n          }}\n        >\n          \u26a0\ufe0f {error}\n        </div>\n      )}\n\n      {showCreateForm && renderCreateForm()}\n      {renderQuotaList()}\n\n      <div\n        style={{\n          marginTop: '30px',\n          padding: '15px',\n          background: 'var(--glass-overlay-light, var(--glass-bg-light))',\n          borderRadius: '8px',\n          border:\n            '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n          backdropFilter: 'var(--glass-blur-light)',\n          WebkitBackdropFilter: 'var(--glass-blur-light)',\n          boxShadow: 'var(--glass-shadow-light)'\n        }}\n      >\n        <h4 style={{ margin: '0 0 10px 0' }}>\n          \ud83d\udca1 How Global Guest Quotas Work:\n        </h4>\n        <ul style={{ margin: 0, paddingLeft: '20px' }}>\n          <li>\n            <strong>Priority:</strong> Global quotas apply to anonymous users\n            when no user-specific overrides exist\n          </li>\n          <li>\n            <strong>Feature-Level:</strong> Set different quotas for different\n            services/features to avoid unintended impacts\n          </li>\n          <li>\n            <strong>IP-Based:</strong> Quotas are tracked by IP address and\n            optional machine fingerprinting\n          </li>\n          <li>\n            <strong>Reset Periods:</strong> Choose hourly, daily, weekly, or\n            monthly reset cycles\n          </li>\n          <li>\n            <strong>Unlimited:</strong> Check &ldquo;Unlimited&rdquo; to remove\n            quota restrictions entirely\n          </li>\n        </ul>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":868,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/CustomAlertsPanel.tsx":{
    "content":"'use client';\n\n/**\n * Custom Alerts Management Panel\n *\n * Provides comprehensive admin interface for managing custom alerts:\n * - Create, edit, delete, and disable custom alerts\n * - Targeting options (all users, authenticated, subscribers, admins, roles, specific users)\n * - Scheduling and priority management\n * - Analytics and performance tracking\n *\n * @version 1.0.0\n * @author System Wizard \ud83e\uddd9\u200d\u2642\ufe0f\n */\n\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState\n} from 'react';\nimport { AlertStatusTooltip } from './AlertStatusTooltip';\nimport './CustomAlertsPanel.css';\n\n// Force logging function to bypass console silencer\nconst forceLog = (\n  message: string,\n  data?: any,\n  level: 'info' | 'warn' | 'error' | 'debug' = 'info'\n) => {\n  if (typeof window !== 'undefined' && (window as any).__originalConsole) {\n    const logMethod =\n      (window as any).__originalConsole[level] ||\n      (window as any).__originalConsole.log;\n    logMethod(message, data);\n  }\n};\n\n// ================================\n// TYPES & INTERFACES\n// ================================\n\ninterface CustomAlert {\n  id: number;\n  title: string;\n  message?: string;\n  details?: string;\n  alert_type:\n    | 'info'\n    | 'warning'\n    | 'error'\n    | 'success'\n    | 'maintenance'\n    | 'custom';\n  target_audience:\n    | 'all'\n    | 'authenticated'\n    | 'subscribers'\n    | 'admins'\n    | 'role_based'\n    | 'specific_users';\n  target_roles?: string[];\n  target_users?: number[];\n  priority: number;\n  icon?: string;\n  dismissible: boolean;\n  persistent: boolean;\n  start_date?: string;\n  end_date?: string;\n  expires_at?: string;\n  is_active: boolean;\n  is_published: boolean;\n  created_by: number;\n  updated_by?: number;\n  created_at: string;\n  updated_at: string;\n  actions?: Array<{\n    label: string;\n    action: string;\n    variant?: 'primary' | 'secondary' | 'danger';\n  }>;\n  metadata?: Record<string, any>;\n  created_by_name?: string;\n  updated_by_name?: string;\n}\n\ninterface AlertFormData {\n  title: string;\n  message: string;\n  details: string;\n  alert_type: CustomAlert['alert_type'];\n  target_audience: CustomAlert['target_audience'];\n  target_roles: string[];\n  target_users: string;\n  priority: number;\n  icon: string;\n  dismissible: boolean;\n  persistent: boolean;\n  start_date: string;\n  end_date: string;\n  expires_at: string;\n  is_active: boolean;\n  is_published: boolean;\n}\n\n// Helper function to create a stable key for alert comparison\nconst createAlertKey = (alert: CustomAlert): string => {\n  return `${alert.id}-${alert.title}-${alert.is_active}-${alert.is_published}-${alert.updated_at}`;\n};\n\n// Helper function to check if two alert arrays are equivalent\nconst areAlertsEqual = (prev: CustomAlert[], next: CustomAlert[]): boolean => {\n  if (prev.length !== next.length) return false;\n\n  const prevKeys = prev.map(createAlertKey).sort();\n  const nextKeys = next.map(createAlertKey).sort();\n\n  return prevKeys.every((key, index) => key === nextKeys[index]);\n};\n\n// ================================\n// MAIN COMPONENT\n// ================================\n\nexport default function CustomAlertsPanel() {\n  const [alerts, setAlerts] = useState<CustomAlert[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [editingAlert, setEditingAlert] = useState<CustomAlert | null>(null);\n  const [lastRefreshTime, setLastRefreshTime] = useState<string>('');\n  const lastFetchRef = useRef<string>(''); // Track last successful fetch signature\n  const [formData, setFormData] = useState<AlertFormData>({\n    title: '',\n    message: '',\n    details: '',\n    alert_type: 'info',\n    target_audience: 'all',\n    target_roles: [],\n    target_users: '',\n    priority: 0,\n    icon: '',\n    dismissible: true,\n    persistent: false,\n    start_date: '',\n    end_date: '',\n    expires_at: '',\n    is_active: true,\n    is_published: false\n  });\n\n  // ================================\n  // DATA FETCHING\n  // ================================\n\n  const fetchAlerts = useCallback(async () => {\n    try {\n      setError(null);\n\n      const response = await fetch('/api/admin/alerts', {\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        let errorMessage;\n        try {\n          const errorData = JSON.parse(errorText);\n          errorMessage =\n            errorData.error ||\n            `HTTP ${response.status}: ${response.statusText}`;\n        } catch {\n          errorMessage = `HTTP ${response.status}: ${response.statusText}`;\n        }\n        throw new Error(errorMessage);\n      }\n\n      const data = await response.json();\n      const newAlerts = Array.isArray(data.alerts)\n        ? data.alerts\n        : Array.isArray(data)\n          ? data\n          : [];\n\n      forceLog('\ud83e\uddd9\u200d\u2642\ufe0f Raw API response:', {\n        dataType: typeof data,\n        isArray: Array.isArray(data),\n        hasAlertsProperty: 'alerts' in data,\n        alertCount: newAlerts.length,\n        firstAlertId: newAlerts[0]?.id,\n        firstAlertTitle: newAlerts[0]?.title,\n        firstAlertUpdated: newAlerts[0]?.updated_at\n      });\n\n      // Create a signature of the current fetch to compare with previous\n      const currentSignature = JSON.stringify(\n        newAlerts.map(createAlertKey).sort()\n      );\n\n      // Only update state if data actually changed\n      if (lastFetchRef.current !== currentSignature) {\n        lastFetchRef.current = currentSignature;\n        setAlerts(newAlerts);\n      }\n\n      // Only set loading to false on first successful load\n      if (loading) {\n        setLoading(false);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch alerts');\n      if (loading) {\n        setLoading(false);\n      }\n    }\n  }, [loading]);\n\n  // ================================\n  // POLLING FOR UPDATES (OPTIMIZED)\n  // ================================\n\n  // Smart polling that only updates when data changes\n  useEffect(() => {\n    const interval = setInterval(() => {\n      if (!loading) {\n        fetchAlerts();\n      }\n    }, 15000); // Poll every 15 seconds (increased from 10 for less aggressive polling)\n\n    return () => clearInterval(interval);\n  }, [loading, fetchAlerts]);\n\n  // ================================\n  // INITIAL DATA LOADING\n  // ================================\n\n  useEffect(() => {\n    fetchAlerts();\n  }, [fetchAlerts]);\n\n  // ================================\n  // FORM HANDLERS\n  // ================================\n\n  const handleInputChange = (field: keyof AlertFormData, value: any) => {\n    setFormData((prev) => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const resetForm = () => {\n    setFormData({\n      title: '',\n      message: '',\n      details: '',\n      alert_type: 'info',\n      target_audience: 'all',\n      target_roles: [],\n      target_users: '',\n      priority: 0,\n      icon: '',\n      dismissible: true,\n      persistent: false,\n      start_date: '',\n      end_date: '',\n      expires_at: '',\n      is_active: true,\n      is_published: false\n    });\n    setEditingAlert(null);\n  };\n\n  const handleEdit = (alert: CustomAlert) => {\n    setEditingAlert(alert);\n\n    // Safely handle target_users - could be array, string, or undefined\n    let targetUsersString = '';\n    if (alert.target_users) {\n      if (Array.isArray(alert.target_users)) {\n        targetUsersString = alert.target_users.join(', ');\n      } else if (typeof alert.target_users === 'string') {\n        targetUsersString = alert.target_users;\n      } else {\n        // Handle case where it might be a single number or other type\n        targetUsersString = String(alert.target_users);\n      }\n    }\n\n    // Safely handle target_roles - could be array, string, or undefined\n    let targetRolesArray: string[] = [];\n    if (alert.target_roles) {\n      if (Array.isArray(alert.target_roles)) {\n        targetRolesArray = alert.target_roles;\n      } else if (typeof alert.target_roles === 'string') {\n        try {\n          // Try to parse as JSON if it's a string\n          const parsed = JSON.parse(alert.target_roles);\n          targetRolesArray = Array.isArray(parsed) ? parsed : [];\n        } catch {\n          // If not JSON, treat as single role\n          targetRolesArray = [alert.target_roles];\n        }\n      }\n    }\n\n    setFormData({\n      title: alert.title,\n      message: alert.message || '',\n      details: alert.details || '',\n      alert_type: alert.alert_type,\n      target_audience: alert.target_audience,\n      target_roles: targetRolesArray,\n      target_users: targetUsersString,\n      priority: alert.priority,\n      icon: alert.icon || '',\n      dismissible: alert.dismissible,\n      persistent: alert.persistent,\n      start_date: alert.start_date\n        ? new Date(alert.start_date).toISOString().slice(0, 16)\n        : '',\n      end_date: alert.end_date\n        ? new Date(alert.end_date).toISOString().slice(0, 16)\n        : '',\n      expires_at: alert.expires_at\n        ? new Date(alert.expires_at).toISOString().slice(0, 16)\n        : '',\n      is_active: alert.is_active,\n      is_published: alert.is_published\n    });\n    setShowCreateModal(true);\n  };\n\n  // ================================\n  // CRUD OPERATIONS\n  // ================================\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    try {\n      const payload = {\n        ...formData,\n        target_roles: Array.isArray(formData.target_roles)\n          ? formData.target_roles\n          : formData.target_roles\n            ? [formData.target_roles]\n            : [],\n        target_users: formData.target_users\n          ? formData.target_users\n              .split(',')\n              .map((id) => parseInt(id.trim()))\n              .filter((id) => !isNaN(id))\n          : [],\n        start_date: formData.start_date || undefined,\n        end_date: formData.end_date || undefined,\n        expires_at: formData.expires_at || undefined\n      };\n\n      const url = editingAlert\n        ? `/api/admin/alerts/${editingAlert.id}`\n        : '/api/admin/alerts';\n      const method = editingAlert ? 'PUT' : 'POST';\n\n      forceLog('\ud83e\uddd9\u200d\u2642\ufe0f Submitting alert:', { url, method, payload });\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify(payload)\n      });\n\n      forceLog('\ud83e\uddd9\u200d\u2642\ufe0f Response status:', {\n        status: response.status,\n        statusText: response.statusText\n      });\n\n      if (!response.ok) {\n        let errorData;\n        const responseText = await response.text();\n        forceLog('\ud83e\uddd9\u200d\u2642\ufe0f Error response text:', responseText);\n\n        try {\n          errorData = JSON.parse(responseText);\n        } catch {\n          errorData = {\n            error:\n              responseText || `HTTP ${response.status}: ${response.statusText}`\n          };\n        }\n\n        let errorMessage =\n          errorData.error || errorData.message || 'Failed to save alert';\n\n        // If validation failed, include details\n        if (errorData.details && Array.isArray(errorData.details)) {\n          const validationErrors = errorData.details\n            .map(\n              (detail: any) => `${detail.path?.join('.')}: ${detail.message}`\n            )\n            .join(', ');\n          errorMessage += ` - ${validationErrors}`;\n        }\n\n        forceLog('\ud83e\uddd9\u200d\u2642\ufe0f Save error:', { errorMessage, errorData }, 'error');\n        throw new Error(errorMessage);\n      }\n\n      // Clear banner cache and refresh\n      if (typeof window !== 'undefined' && (window as any).__refreshBanners) {\n        (window as any).__refreshBanners();\n      }\n\n      await fetchAlerts();\n      setShowCreateModal(false);\n      resetForm();\n    } catch (err) {\n      const errorMessage =\n        err instanceof Error ? err.message : 'Failed to save alert';\n      forceLog('\ud83e\uddd9\u200d\u2642\ufe0f Submit error:', { errorMessage, err }, 'error');\n      setError(errorMessage);\n    }\n  };\n\n  const handleDelete = async (alertId: number) => {\n    if (!confirm('Are you sure you want to delete this alert?')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/admin/alerts/${alertId}`, {\n        method: 'DELETE',\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to delete alert');\n      }\n\n      // Clear banner cache and refresh\n      if (typeof window !== 'undefined' && (window as any).__refreshBanners) {\n        (window as any).__refreshBanners();\n      }\n\n      await fetchAlerts();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to delete alert');\n    }\n  };\n\n  const handleToggleStatus = async (\n    alert: CustomAlert,\n    field: 'is_active' | 'is_published'\n  ) => {\n    try {\n      const response = await fetch(`/api/admin/alerts/${alert.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          [field]: !alert[field]\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to update alert ${field}`);\n      }\n\n      // Clear banner cache and refresh\n      if (typeof window !== 'undefined' && (window as any).__refreshBanners) {\n        (window as any).__refreshBanners();\n      }\n\n      // Force cache reset so fetchAlerts will update\n      lastFetchRef.current = '';\n      await fetchAlerts();\n    } catch (err) {\n      setError(\n        err instanceof Error ? err.message : `Failed to update alert ${field}`\n      );\n    }\n  };\n\n  // ================================\n  // UTILITY FUNCTIONS (MEMOIZED)\n  // ================================\n\n  const getAlertTypeIcon = useCallback((type: CustomAlert['alert_type']) => {\n    const icons = {\n      info: '\ud83d\udca1',\n      warning: '\u26a0\ufe0f',\n      error: '\u274c',\n      success: '\u2705',\n      maintenance: '\ud83d\udd27',\n      custom: '\ud83c\udfa8'\n    };\n    return icons[type];\n  }, []);\n\n  const getTargetAudienceLabel = useCallback(\n    (audience: CustomAlert['target_audience']) => {\n      const labels = {\n        all: 'All Users',\n        authenticated: 'Authenticated Users',\n        subscribers: 'Subscribers',\n        admins: 'Administrators',\n        role_based: 'Role-Based',\n        specific_users: 'Specific Users'\n      };\n      return labels[audience];\n    },\n    []\n  );\n\n  const formatDate = useCallback((dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  }, []);\n\n  // Memoize sorted alerts to prevent unnecessary re-sorts\n  const sortedAlerts = useMemo(() => {\n    return [...alerts].sort(\n      (a, b) =>\n        new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n    );\n  }, [alerts]);\n\n  // ================================\n  // RENDER\n  // ================================\n\n  if (loading) {\n    return (\n      <div className=\\\"custom-alerts-panel\\\">\n        <div className=\\\"loading-state\\\">\n          <div className=\\\"loading-spinner\\\"></div>\n          <p>Loading custom alerts...</p>\n          <p\n            style={{\n              fontSize: '0.8rem',\n              color: 'var(--light-bg__text-color--secondary)',\n              marginTop: '1rem'\n            }}\n          >\n            Debug: Fetching from /api/admin/alerts...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  // Show ANY error prominently for debugging\n  if (error) {\n    return (\n      <div className=\\\"custom-alerts-panel\\\">\n        <div className=\\\"loading-state\\\">\n          <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>\u274c</div>\n          <h3 style={{ color: 'var(--error)', marginBottom: '1rem' }}>\n            Error Loading Alerts\n          </h3>\n          <div\n            style={{\n              background: 'var(--error-background)',\n              border: '1px solid var(--error)',\n              borderRadius: 'var(--border-radius)',\n              padding: '1rem',\n              marginBottom: '1rem',\n              textAlign: 'left',\n              maxWidth: '600px'\n            }}\n          >\n            <strong>Error Details:</strong>\n            <pre\n              style={{\n                whiteSpace: 'pre-wrap',\n                fontSize: '0.9rem',\n                margin: '0.5rem 0 0 0',\n                color: 'var(--error)'\n              }}\n            >\n              {error}\n            </pre>\n          </div>\n          <div\n            style={{ display: 'flex', gap: '1rem', justifyContent: 'center' }}\n          >\n            <button\n              className=\\\"btn btn-primary\\\"\n              onClick={() => {\n                setError(null);\n                fetchAlerts();\n              }}\n            >\n              \ud83d\udd04 Retry\n            </button>\n            <button\n              className=\\\"btn btn-secondary\\\"\n              onClick={() => (window.location.href = '/api/auth/signin')}\n            >\n              \ud83d\udd11 Sign In Again\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Show authentication error prominently\n  if (\n    error &&\n    (error.includes('Unauthorized') ||\n      error.includes('Authentication required'))\n  ) {\n    return (\n      <div className=\\\"custom-alerts-panel\\\">\n        <div className=\\\"loading-state\\\">\n          <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>\ud83d\udd10</div>\n          <h3 style={{ color: 'var(--error)', marginBottom: '1rem' }}>\n            Authentication Required\n          </h3>\n          <p style={{ marginBottom: '1rem' }}>\n            You need to log in to access the admin panel.\n          </p>\n          <button\n            className=\\\"btn btn-primary\\\"\n            onClick={() => (window.location.href = '/api/auth/signin')}\n          >\n            \ud83d\udd11 Sign In\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Show admin access error\n  if (error && error.includes('Admin access required')) {\n    return (\n      <div className=\\\"custom-alerts-panel\\\">\n        <div className=\\\"loading-state\\\">\n          <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>\ud83d\udeab</div>\n          <h3 style={{ color: 'var(--error)', marginBottom: '1rem' }}>\n            Admin Access Required\n          </h3>\n          <p style={{ marginBottom: '1rem' }}>\n            You don&apos;t have permission to access this admin feature.\n          </p>\n          <button\n            className=\\\"btn btn-secondary\\\"\n            onClick={() => (window.location.href = '/')}\n          >\n            \ud83c\udfe0 Go Home\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\\\"custom-alerts-panel\\\">\n      <div className=\\\"panel-header\\\">\n        <h2>Custom Alerts Management \ud83c\udfaf</h2>\n        <p>Create, edit, and manage custom alerts for different user groups</p>\n        {lastRefreshTime && (\n          <p\n            style={{\n              fontSize: '0.8rem',\n              color: 'var(--light-bg__text-color--secondary)'\n            }}\n          >\n            Last refreshed: {lastRefreshTime}\n          </p>\n        )}\n        <button\n          className=\\\"btn btn-primary\\\"\n          onClick={() => setShowCreateModal(true)}\n        >\n          \u2795 Create New Alert\n        </button>\n      </div>\n\n      {error && (\n        <div className=\\\"error-message\\\">\n          <span>\u274c {error}</span>\n          <button onClick={() => setError(null)}>\u2715</button>\n        </div>\n      )}\n\n      <div className=\\\"alerts-grid\\\">\n        {Array.isArray(sortedAlerts) &&\n          sortedAlerts.map((alert) => (\n            <div\n              key={alert.id}\n              className={`alert-card alert-card--${alert.alert_type}`}\n            >\n              <div className=\\\"alert-card__header\\\">\n                <div className=\\\"alert-card__title\\\">\n                  <span className=\\\"alert-icon\\\">\n                    {alert.icon || getAlertTypeIcon(alert.alert_type)}\n                  </span>\n                  <h3>{alert.title}</h3>\n                </div>\n                <div className=\\\"alert-card__actions\\\">\n                  <button\n                    className=\\\"btn btn-sm btn-secondary\\\"\n                    onClick={() => handleEdit(alert)}\n                    title=\\\"Edit alert\\\"\n                  >\n                    \u270f\ufe0f\n                  </button>\n                  <button\n                    className=\\\"btn btn-sm btn-danger\\\"\n                    onClick={() => handleDelete(alert.id)}\n                    title=\\\"Delete alert\\\"\n                  >\n                    \ud83d\uddd1\ufe0f\n                  </button>\n                </div>\n              </div>\n\n              <div className=\\\"alert-card__content\\\">\n                {alert.message && (\n                  <p className=\\\"alert-message\\\">{alert.message}</p>\n                )}\n\n                <div className=\\\"alert-meta\\\">\n                  <div className=\\\"meta-item\\\">\n                    <strong>Target:</strong>{' '}\n                    {getTargetAudienceLabel(alert.target_audience)}\n                  </div>\n                  <div className=\\\"meta-item\\\">\n                    <strong>Priority:</strong> {alert.priority}\n                  </div>\n                  <div className=\\\"meta-item\\\">\n                    <strong>Created:</strong> {formatDate(alert.created_at)}\n                  </div>\n                  {alert.created_by_name && (\n                    <div className=\\\"meta-item\\\">\n                      <strong>By:</strong> {alert.created_by_name}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\\\"alert-status\\\">\n                  <label className=\\\"status-toggle\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={alert.is_active}\n                      onChange={() => handleToggleStatus(alert, 'is_active')}\n                    />\n                    <span className=\\\"toggle-slider\\\"></span>\n                    <AlertStatusTooltip\n                      type=\\\"active\\\"\n                      isActive={alert.is_active}\n                      isPublished={alert.is_published}\n                    >\n                      <span>Active</span>\n                    </AlertStatusTooltip>\n                  </label>\n                  <label className=\\\"status-toggle\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={alert.is_published}\n                      onChange={() => handleToggleStatus(alert, 'is_published')}\n                    />\n                    <span className=\\\"toggle-slider\\\"></span>\n                    <AlertStatusTooltip\n                      type=\\\"published\\\"\n                      isActive={alert.is_active}\n                      isPublished={alert.is_published}\n                    >\n                      <span>Published</span>\n                    </AlertStatusTooltip>\n                  </label>\n                </div>\n              </div>\n            </div>\n          ))}\n      </div>\n\n      {Array.isArray(sortedAlerts) && sortedAlerts.length === 0 && (\n        <div className=\\\"empty-state\\\">\n          <h3>No Custom Alerts Yet \ud83d\udce2</h3>\n          <p>\n            Create your first custom alert to start engaging with your users!\n          </p>\n          <button\n            className=\\\"btn btn-primary\\\"\n            onClick={() => setShowCreateModal(true)}\n          >\n            \u2795 Create First Alert\n          </button>\n        </div>\n      )}\n\n      {/* Create/Edit Modal */}\n      {showCreateModal && (\n        <div className=\\\"modal-overlay\\\">\n          <div className=\\\"modal-content\\\">\n            <div className=\\\"modal-header\\\">\n              <h3>{editingAlert ? 'Edit Alert' : 'Create New Alert'}</h3>\n              <button\n                className=\\\"modal-close\\\"\n                onClick={() => {\n                  setShowCreateModal(false);\n                  resetForm();\n                }}\n              >\n                \u2715\n              </button>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\\\"alert-form\\\">\n              <div className=\\\"form-grid\\\">\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"title\\\">Title *</label>\n                  <input\n                    id=\\\"title\\\"\n                    type=\\\"text\\\"\n                    value={formData.title}\n                    onChange={(e) => handleInputChange('title', e.target.value)}\n                    required\n                    maxLength={200}\n                  />\n                </div>\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"alert_type\\\">Type</label>\n                  <select\n                    id=\\\"alert_type\\\"\n                    value={formData.alert_type}\n                    onChange={(e) =>\n                      handleInputChange('alert_type', e.target.value)\n                    }\n                  >\n                    <option value=\\\"info\\\">Info \ud83d\udca1</option>\n                    <option value=\\\"warning\\\">Warning \u26a0\ufe0f</option>\n                    <option value=\\\"error\\\">Error \u274c</option>\n                    <option value=\\\"success\\\">Success \u2705</option>\n                    <option value=\\\"maintenance\\\">Maintenance \ud83d\udd27</option>\n                    <option value=\\\"custom\\\">Custom \ud83c\udfa8</option>\n                  </select>\n                </div>\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"priority\\\">Priority</label>\n                  <input\n                    id=\\\"priority\\\"\n                    type=\\\"number\\\"\n                    value={formData.priority}\n                    onChange={(e) =>\n                      handleInputChange('priority', parseInt(e.target.value))\n                    }\n                    min={-100}\n                    max={100}\n                  />\n                  <small>Higher numbers show first (-100 to 100)</small>\n                </div>\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"icon\\\">Icon (Emoji)</label>\n                  <input\n                    id=\\\"icon\\\"\n                    type=\\\"text\\\"\n                    value={formData.icon}\n                    onChange={(e) => handleInputChange('icon', e.target.value)}\n                    maxLength={20}\n                    placeholder=\\\"\ud83c\udf89\\\"\n                  />\n                </div>\n\n                <div className=\\\"form-group form-group--full\\\">\n                  <label htmlFor=\\\"message\\\">Message</label>\n                  <textarea\n                    id=\\\"message\\\"\n                    value={formData.message}\n                    onChange={(e) =>\n                      handleInputChange('message', e.target.value)\n                    }\n                    rows={3}\n                  />\n                </div>\n\n                <div className=\\\"form-group form-group--full\\\">\n                  <label htmlFor=\\\"details\\\">Details</label>\n                  <textarea\n                    id=\\\"details\\\"\n                    value={formData.details}\n                    onChange={(e) =>\n                      handleInputChange('details', e.target.value)\n                    }\n                    rows={2}\n                  />\n                </div>\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"target_audience\\\">Target Audience</label>\n                  <select\n                    id=\\\"target_audience\\\"\n                    value={formData.target_audience}\n                    onChange={(e) =>\n                      handleInputChange('target_audience', e.target.value)\n                    }\n                  >\n                    <option value=\\\"all\\\">All Users</option>\n                    <option value=\\\"authenticated\\\">Authenticated Users</option>\n                    <option value=\\\"subscribers\\\">Subscribers</option>\n                    <option value=\\\"admins\\\">Administrators</option>\n                    <option value=\\\"role_based\\\">Role-Based</option>\n                    <option value=\\\"specific_users\\\">Specific Users</option>\n                  </select>\n                </div>\n\n                {formData.target_audience === 'specific_users' && (\n                  <div className=\\\"form-group\\\">\n                    <label htmlFor=\\\"target_users\\\">User IDs</label>\n                    <input\n                      id=\\\"target_users\\\"\n                      type=\\\"text\\\"\n                      value={formData.target_users}\n                      onChange={(e) =>\n                        handleInputChange('target_users', e.target.value)\n                      }\n                      placeholder=\\\"1, 2, 3\\\"\n                    />\n                    <small>Comma-separated user IDs</small>\n                  </div>\n                )}\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"start_date\\\">Start Date</label>\n                  <input\n                    id=\\\"start_date\\\"\n                    type=\\\"datetime-local\\\"\n                    value={formData.start_date}\n                    onChange={(e) =>\n                      handleInputChange('start_date', e.target.value)\n                    }\n                  />\n                </div>\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"end_date\\\">End Date</label>\n                  <input\n                    id=\\\"end_date\\\"\n                    type=\\\"datetime-local\\\"\n                    value={formData.end_date}\n                    onChange={(e) =>\n                      handleInputChange('end_date', e.target.value)\n                    }\n                  />\n                </div>\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"expires_at\\\">Auto-Dismiss At</label>\n                  <input\n                    id=\\\"expires_at\\\"\n                    type=\\\"datetime-local\\\"\n                    value={formData.expires_at}\n                    onChange={(e) =>\n                      handleInputChange('expires_at', e.target.value)\n                    }\n                  />\n                </div>\n\n                <div className=\\\"form-group form-group--checkboxes\\\">\n                  <label className=\\\"checkbox-label\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={formData.dismissible}\n                      onChange={(e) =>\n                        handleInputChange('dismissible', e.target.checked)\n                      }\n                    />\n                    Dismissible\n                  </label>\n                  <label className=\\\"checkbox-label\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={formData.persistent}\n                      onChange={(e) =>\n                        handleInputChange('persistent', e.target.checked)\n                      }\n                    />\n                    Persistent (survives page reloads)\n                  </label>\n                  <label className=\\\"checkbox-label\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={formData.is_active}\n                      onChange={(e) =>\n                        handleInputChange('is_active', e.target.checked)\n                      }\n                    />\n                    <AlertStatusTooltip\n                      type=\\\"active\\\"\n                      isActive={formData.is_active}\n                      isPublished={formData.is_published}\n                    >\n                      <span>Active</span>\n                    </AlertStatusTooltip>\n                  </label>\n                  <label className=\\\"checkbox-label\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={formData.is_published}\n                      onChange={(e) =>\n                        handleInputChange('is_published', e.target.checked)\n                      }\n                    />\n                    <AlertStatusTooltip\n                      type=\\\"published\\\"\n                      isActive={formData.is_active}\n                      isPublished={formData.is_published}\n                    >\n                      <span>Published</span>\n                    </AlertStatusTooltip>\n                  </label>\n                </div>\n              </div>\n\n              <div className=\\\"modal-actions\\\">\n                <button\n                  type=\\\"button\\\"\n                  className=\\\"btn btn-secondary\\\"\n                  onClick={() => {\n                    setShowCreateModal(false);\n                    resetForm();\n                  }}\n                >\n                  Cancel\n                </button>\n                <button type=\\\"submit\\\" className=\\\"btn btn-primary\\\">\n                  {editingAlert ? 'Update Alert' : 'Create Alert'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":1054,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/AdminUserTooltip.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport './AdminUserTooltip.css';\n\ninterface AdminUserTooltipProps {\n  userId: number;\n  username: string;\n  onTimeoutUser: (\n    userId: number,\n    timeoutType: string,\n    reason: string,\n    durationHours: number\n  ) => void;\n}\n\ninterface TimeoutStatus {\n  is_timed_out: boolean;\n  expires_at?: string;\n  reason?: string;\n}\n\nexport function AdminUserTooltip({\n  userId,\n  username,\n  onTimeoutUser\n}: AdminUserTooltipProps) {\n  const [showTooltip, setShowTooltip] = useState(false);\n  const [showTimeoutForm, setShowTimeoutForm] = useState(false);\n  const [timeoutStatus, setTimeoutStatus] = useState<TimeoutStatus | null>(\n    null\n  );\n  const [loading, setLoading] = useState(false);\n\n  // Form state\n  const [timeoutType, setTimeoutType] = useState('post_creation');\n  const [reason, setReason] = useState('');\n  const [durationHours, setDurationHours] = useState(24);\n\n  // Check timeout status when tooltip opens\n  useEffect(() => {\n    if (showTooltip && !timeoutStatus) {\n      checkTimeoutStatus();\n    }\n  }, [showTooltip]);\n\n  const checkTimeoutStatus = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch(\n        `/api/admin/users/timeout?userId=${userId}&type=post_creation`\n      );\n      if (response.ok) {\n        const data = await response.json();\n        setTimeoutStatus(data);\n      }\n    } catch (error) {\n      console.error('Error checking timeout status:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleTimeoutSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!reason.trim()) {\n      alert('Please provide a reason for the timeout');\n      return;\n    }\n\n    await onTimeoutUser(userId, timeoutType, reason, durationHours);\n    setShowTimeoutForm(false);\n    setShowTooltip(false);\n    // Refresh timeout status\n    setTimeoutStatus(null);\n  };\n\n  const formatTimeRemaining = (expiresAt: string) => {\n    const now = new Date();\n    const expires = new Date(expiresAt);\n    const diff = expires.getTime() - now.getTime();\n\n    if (diff <= 0) return 'Expired';\n\n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n\n    if (hours > 0) {\n      return `${hours}h ${minutes}m remaining`;\n    }\n    return `${minutes}m remaining`;\n  };\n\n  return (\n    <div className=\\\"admin-user-tooltip\\\">\n      <button\n        className=\\\"admin-user-tooltip__trigger\\\"\n        onMouseEnter={() => setShowTooltip(true)}\n        onMouseLeave={() => !showTimeoutForm && setShowTooltip(false)}\n        onClick={() => setShowTooltip(!showTooltip)}\n      >\n        \ud83d\udc64 {username}\n      </button>\n\n      {showTooltip && (\n        <div\n          className=\\\"admin-user-tooltip__content\\\"\n          onMouseEnter={() => setShowTooltip(true)}\n          onMouseLeave={() => !showTimeoutForm && setShowTooltip(false)}\n        >\n          <div className=\\\"admin-user-tooltip__header\\\">\n            <strong>Admin Controls: {username}</strong>\n          </div>\n\n          <div className=\\\"admin-user-tooltip__info\\\">\n            <div className=\\\"admin-user-tooltip__status\\\">\n              {loading ? (\n                <span>Checking timeout status...</span>\n              ) : timeoutStatus?.is_timed_out ? (\n                <div className=\\\"admin-user-tooltip__timeout-active\\\">\n                  <span className=\\\"admin-user-tooltip__timeout-indicator\\\">\n                    \u23f0 Timed Out\n                  </span>\n                  <div className=\\\"admin-user-tooltip__timeout-details\\\">\n                    <div>Reason: {timeoutStatus.reason}</div>\n                    {timeoutStatus.expires_at && (\n                      <div>{formatTimeRemaining(timeoutStatus.expires_at)}</div>\n                    )}\n                  </div>\n                </div>\n              ) : (\n                <span className=\\\"admin-user-tooltip__status-normal\\\">\n                  \u2705 Normal Status\n                </span>\n              )}\n            </div>\n          </div>\n\n          <div className=\\\"admin-user-tooltip__actions\\\">\n            {!showTimeoutForm ? (\n              <button\n                className=\\\"admin-user-tooltip__timeout-btn\\\"\n                onClick={() => setShowTimeoutForm(true)}\n                disabled={timeoutStatus?.is_timed_out}\n              >\n                {timeoutStatus?.is_timed_out\n                  ? 'Already Timed Out'\n                  : 'Issue Timeout'}\n              </button>\n            ) : (\n              <form\n                onSubmit={handleTimeoutSubmit}\n                className=\\\"admin-user-tooltip__timeout-form\\\"\n              >\n                <div className=\\\"admin-user-tooltip__form-field\\\">\n                  <label>Type:</label>\n                  <select\n                    value={timeoutType}\n                    onChange={(e) => setTimeoutType(e.target.value)}\n                  >\n                    <option value=\\\"post_creation\\\">Post Creation</option>\n                    <option value=\\\"comment_creation\\\">Comment Creation</option>\n                    <option value=\\\"full_access\\\">Full Access</option>\n                  </select>\n                </div>\n\n                <div className=\\\"admin-user-tooltip__form-field\\\">\n                  <label>Duration (hours):</label>\n                  <input\n                    type=\\\"number\\\"\n                    min=\\\"1\\\"\n                    max=\\\"8760\\\"\n                    value={durationHours}\n                    onChange={(e) => setDurationHours(parseInt(e.target.value))}\n                  />\n                </div>\n\n                <div className=\\\"admin-user-tooltip__form-field\\\">\n                  <label>Reason:</label>\n                  <textarea\n                    value={reason}\n                    onChange={(e) => setReason(e.target.value)}\n                    placeholder=\\\"Reason for timeout...\\\"\n                    rows={2}\n                    required\n                  />\n                </div>\n\n                <div className=\\\"admin-user-tooltip__form-actions\\\">\n                  <button type=\\\"submit\\\" className=\\\"admin-user-tooltip__submit\\\">\n                    Timeout\n                  </button>\n                  <button\n                    type=\\\"button\\\"\n                    onClick={() => setShowTimeoutForm(false)}\n                    className=\\\"admin-user-tooltip__cancel\\\"\n                  >\n                    Cancel\n                  </button>\n                </div>\n              </form>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":209,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/HeaderSection.tsx":{
    "content":"/**\n * Header Section Component\n *\n * Handles the panel header with title, description, search functionality,\n * and action buttons. This component is focused solely on the header area.\n */\n\nimport React from 'react';\nimport { InteractiveTooltip } from '../../../components/tooltip/InteractiveTooltip';\n\ninterface HeaderSectionProps {\n  showFilterPanel: boolean;\n  activeFiltersCount: number;\n  searchQuery: string;\n  showSearchResults: boolean;\n  isSearching: boolean;\n  searchOverlayContent: React.ReactNode;\n  onToggleFilterPanel: () => void;\n  onExportAll: () => void;\n  onSearchQueryChange: (value: string) => void;\n  onSearchFocus: () => void;\n  onSearchBlur: () => void;\n  onSearchClear: () => void;\n}\n\nexport const HeaderSection: React.FC<HeaderSectionProps> = ({\n  showFilterPanel,\n  activeFiltersCount,\n  searchQuery,\n  showSearchResults,\n  isSearching,\n  searchOverlayContent,\n  onToggleFilterPanel,\n  onExportAll,\n  onSearchQueryChange,\n  onSearchFocus,\n  onSearchBlur,\n  onSearchClear\n}) => {\n  return (\n    <div className=\\\"panel-header\\\">\n      <div className=\\\"header-content\\\">\n        <h2 className=\\\"panel-title\\\">User Management</h2>\n        <p className=\\\"panel-description\\\">\n          Manage user accounts, roles, subscriptions, and permissions\n        </p>\n      </div>\n\n      <div className=\\\"header-actions\\\">\n        <button\n          className={`filter-toggle-btn ${showFilterPanel ? 'active' : ''}`}\n          onClick={onToggleFilterPanel}\n          title=\\\"Toggle column filters\\\"\n        >\n          <span className=\\\"filter-icon\\\">\ud83d\udd0d</span>\n          <span className=\\\"filter-label\\\">Filters</span>\n          {activeFiltersCount > 0 && (\n            <span className=\\\"filter-count\\\">{activeFiltersCount}</span>\n          )}\n        </button>\n\n        <button\n          className=\\\"export-all-btn\\\"\n          onClick={onExportAll}\n          title=\\\"Export all user data\\\"\n        >\n          <span className=\\\"export-icon\\\">\ud83d\udcca</span>\n          <span className=\\\"export-label\\\">Export All</span>\n        </button>\n\n        {/* Smart Search Input with InteractiveTooltip */}\n        <div className=\\\"search-container\\\">\n          <InteractiveTooltip\n            content={searchOverlayContent}\n            show={showSearchResults}\n            className=\\\"search-overlay-tooltip\\\"\n            triggerOnClick={false}\n          >\n            <div className=\\\"search-input-wrapper\\\">\n              <div className=\\\"search-input-icon\\\">\n                {isSearching ? (\n                  <div className=\\\"search-spinner\\\"></div>\n                ) : (\n                  <span>\ud83d\udd0d</span>\n                )}\n              </div>\n              <input\n                type=\\\"text\\\"\n                value={searchQuery}\n                onChange={(e) => onSearchQueryChange(e.target.value)}\n                placeholder=\\\"Search users by name, email, or ID...\\\"\n                className=\\\"search-input\\\"\n                onFocus={onSearchFocus}\n                onBlur={onSearchBlur}\n              />\n              {searchQuery && (\n                <button className=\\\"search-clear-btn\\\" onClick={onSearchClear}>\n                  \u2715\n                </button>\n              )}\n            </div>\n          </InteractiveTooltip>\n        </div>\n      </div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":108,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/FilterPanel.tsx":{
    "content":"/**\n * Filter Panel Component\n *\n * Handles the column filtering interface, allowing users to add, modify,\n * and remove filters. This component is focused solely on filter management.\n */\n\nimport React from 'react';\nimport {\n  FILTERABLE_COLUMNS,\n  getOperatorLabel,\n  getValidOperators\n} from './constants';\nimport type { ColumnFilter } from './types';\n\ninterface FilterPanelProps {\n  showFilterPanel: boolean;\n  activeFiltersCount: number;\n  columnFilters: ColumnFilter[];\n  onTogglePanel: () => void;\n  onClearAllFilters: () => void;\n  onAddFilter: (column: string) => void;\n  onUpdateFilter: (index: number, updates: Partial<ColumnFilter>) => void;\n  onRemoveFilter: (index: number) => void;\n}\n\nexport const FilterPanel: React.FC<FilterPanelProps> = ({\n  showFilterPanel,\n  activeFiltersCount,\n  columnFilters,\n  onTogglePanel,\n  onClearAllFilters,\n  onAddFilter,\n  onUpdateFilter,\n  onRemoveFilter\n}) => {\n  if (!showFilterPanel) return null;\n\n  return (\n    <div className=\\\"filter-panel\\\">\n      <div className=\\\"filter-panel-header\\\">\n        <h3>Column Filters</h3>\n        <div className=\\\"filter-panel-actions\\\">\n          {activeFiltersCount > 0 && (\n            <button\n              className=\\\"clear-filters-btn\\\"\n              onClick={onClearAllFilters}\n              title=\\\"Clear all filters\\\"\n            >\n              Clear All ({activeFiltersCount})\n            </button>\n          )}\n          <button\n            className=\\\"close-filter-panel-btn\\\"\n            onClick={onTogglePanel}\n            title=\\\"Close filter panel\\\"\n          >\n            \u2715\n          </button>\n        </div>\n      </div>\n\n      <div className=\\\"filter-panel-content\\\">\n        {/* Add Filter Dropdown */}\n        <div className=\\\"add-filter-section\\\">\n          <label>Add Filter:</label>\n          <select\n            onChange={(e) => {\n              if (e.target.value) {\n                onAddFilter(e.target.value);\n                e.target.value = '';\n              }\n            }}\n            className=\\\"add-filter-select\\\"\n          >\n            <option value=\\\"\\\">Select column to filter...</option>\n            {FILTERABLE_COLUMNS.map((column) => (\n              <option key={column.key} value={column.key}>\n                {column.label}\n              </option>\n            ))}\n          </select>\n        </div>\n\n        {/* Active Filters */}\n        <div className=\\\"active-filters-section\\\">\n          {columnFilters.map((filter, index) => (\n            <div key={index} className=\\\"filter-row\\\">\n              <div className=\\\"filter-column\\\">\n                <select\n                  value={filter.column}\n                  onChange={(e) =>\n                    onUpdateFilter(index, { column: e.target.value })\n                  }\n                  className=\\\"filter-column-select\\\"\n                >\n                  {FILTERABLE_COLUMNS.map((column) => (\n                    <option key={column.key} value={column.key}>\n                      {column.label}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\\\"filter-operator\\\">\n                <select\n                  value={filter.operator}\n                  onChange={(e) =>\n                    onUpdateFilter(index, {\n                      operator: e.target.value as any\n                    })\n                  }\n                  className=\\\"filter-operator-select\\\"\n                >\n                  {(() => {\n                    const column = FILTERABLE_COLUMNS.find(\n                      (col) => col.key === filter.column\n                    );\n                    const validOperators = column\n                      ? getValidOperators(column.type)\n                      : (['contains', 'equals'] as any[]);\n\n                    return validOperators.map((operator) => (\n                      <option key={operator} value={operator}>\n                        {getOperatorLabel(operator)}\n                      </option>\n                    ));\n                  })()}\n                </select>\n              </div>\n\n              {!['is_empty', 'is_not_empty'].includes(filter.operator) && (\n                <div className=\\\"filter-value\\\">\n                  {(() => {\n                    const column = FILTERABLE_COLUMNS.find(\n                      (col) => col.key === filter.column\n                    );\n\n                    if (column?.type === 'select' && column.options) {\n                      return (\n                        <select\n                          value={filter.value}\n                          onChange={(e) =>\n                            onUpdateFilter(index, {\n                              value: e.target.value\n                            })\n                          }\n                          className=\\\"filter-value-select\\\"\n                        >\n                          <option value=\\\"\\\">Select value...</option>\n                          {column.options.map((option) => (\n                            <option key={option} value={option}>\n                              {option}\n                            </option>\n                          ))}\n                        </select>\n                      );\n                    } else if (column?.type === 'boolean') {\n                      return (\n                        <select\n                          value={filter.value}\n                          onChange={(e) =>\n                            onUpdateFilter(index, {\n                              value: e.target.value\n                            })\n                          }\n                          className=\\\"filter-value-select\\\"\n                        >\n                          <option value=\\\"\\\">Select status...</option>\n                          <option value=\\\"true\\\">Timed Out</option>\n                          <option value=\\\"false\\\">Active</option>\n                        </select>\n                      );\n                    } else if (column?.type === 'date') {\n                      return (\n                        <input\n                          type=\\\"date\\\"\n                          value={filter.value}\n                          onChange={(e) =>\n                            onUpdateFilter(index, {\n                              value: e.target.value\n                            })\n                          }\n                          className=\\\"filter-value-input\\\"\n                        />\n                      );\n                    } else {\n                      return (\n                        <input\n                          type=\\\"text\\\"\n                          value={filter.value}\n                          onChange={(e) =>\n                            onUpdateFilter(index, {\n                              value: e.target.value\n                            })\n                          }\n                          placeholder=\\\"Enter filter value...\\\"\n                          className=\\\"filter-value-input\\\"\n                        />\n                      );\n                    }\n                  })()}\n                </div>\n              )}\n\n              <div className=\\\"filter-actions\\\">\n                <label className=\\\"filter-active-checkbox\\\">\n                  <input\n                    type=\\\"checkbox\\\"\n                    checked={filter.active}\n                    onChange={(e) =>\n                      onUpdateFilter(index, {\n                        active: e.target.checked\n                      })\n                    }\n                  />\n                  <span className=\\\"checkbox-label\\\">Active</span>\n                </label>\n\n                <button\n                  className=\\\"remove-filter-btn\\\"\n                  onClick={() => onRemoveFilter(index)}\n                  title=\\\"Remove filter\\\"\n                >\n                  \ud83d\uddd1\ufe0f\n                </button>\n              </div>\n            </div>\n          ))}\n\n          {columnFilters.length === 0 && (\n            <div className=\\\"no-filters-message\\\">\n              No filters added yet. Select a column above to add your first\n              filter.\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":242,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/utils.tsx":{
    "content":"/**\n * Utility functions for User Management Panel\n *\n * This module contains helper functions for data manipulation,\n * formatting, and business logic used throughout the user\n * management system.\n */\n\nimport React from 'react';\nimport type { ManagementUser } from './types';\n\n// ================================\n// DATA FIELD UTILITIES\n// ================================\n\n/**\n * Get field value from user object for filtering and sorting\n * @param user - The user object\n * @param field - The field name to extract\n * @returns The field value as a string\n */\nexport const getFieldValue = (user: ManagementUser, field: string): string => {\n  switch (field) {\n    case 'name':\n      return user.name || '';\n    case 'email':\n    case 'contact': // Support both 'email' and 'contact' field names\n      return user.email || '';\n    case 'provider_name':\n      return user.provider_name || '';\n    case 'role_names':\n      return user.role_names || '';\n    case 'is_timed_out':\n      return user.is_timed_out ? 'true' : 'false'; // Return actual boolean string for filtering\n    case 'subscriptions':\n      if (user.subscriptions && user.subscriptions.length > 0) {\n        return user.subscriptions.map((sub) => sub.plan_name).join(', ');\n      }\n      return 'Free';\n    case 'active_timeout_reason':\n      return user.active_timeout_reason || '';\n    case 'created_at':\n      return user.created_at;\n    case 'timeout_expires': // Add support for timeout expiration sorting\n      return user.timeout_expires || '';\n    default:\n      return '';\n  }\n};\n\n/**\n * Get display value for UI presentation\n * @param user - The user object\n * @param field - The field name to format\n * @returns The formatted display value\n */\nexport const getDisplayValue = (\n  user: ManagementUser,\n  field: string\n): string => {\n  switch (field) {\n    case 'is_timed_out':\n      return user.is_timed_out ? 'Timed Out' : 'Active';\n    default:\n      return getFieldValue(user, field);\n  }\n};\n\n// ================================\n// DATE FORMATTING UTILITIES\n// ================================\n\n/**\n * Format date string for display\n * @param dateString - ISO date string\n * @returns Formatted date string\n */\nexport const formatDate = (dateString: string): string => {\n  return new Date(dateString).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n};\n\n// ================================\n// BADGE GENERATION UTILITIES\n// ================================\n\n/**\n * Generate status badge JSX for a user\n * @param user - The user object\n * @returns JSX element for status badge\n */\nexport const getStatusBadge = (user: ManagementUser): React.JSX.Element => {\n  // Only handle timeout status - no subscription logic here\n  if (user.is_timed_out && user.active_timeout_reason) {\n    return (\n      <span\n        className=\\\"status-badge status-badge--timeout\\\"\n        title={user.active_timeout_reason}\n      >\n        Timed Out\n      </span>\n    );\n  }\n\n  return <span className=\\\"status-badge status-badge--active\\\">Active</span>;\n};\n\n/**\n * Generate plans display JSX for a user\n * @param user - The user object\n * @returns JSX element for plans display\n */\nexport const getPlansDisplay = (user: ManagementUser): React.JSX.Element => {\n  if (user.subscriptions && user.subscriptions.length > 0) {\n    return (\n      <div className=\\\"plans-info\\\">\n        {user.subscriptions.map((sub) => (\n          <span\n            key={sub.id}\n            className={`plan-badge plan-badge--${sub.status}`}\n            title={`${sub.plan_name} (${sub.status})`}\n          >\n            {sub.plan_name}\n          </span>\n        ))}\n      </div>\n    );\n  }\n\n  return <span className=\\\"plan-badge plan-badge--free\\\">Free</span>;\n};\n",
    "language":"typescript",
    "lines":137,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/UserManagementPanel.tsx":{
    "content":"'use client';\n\n/**\n * User Management Panel - Main Component\n *\n * This is the main orchestrator component that coordinates between\n * smaller, focused components and manages the overall state flow.\n * Now dramatically reduced in size by delegating to specialized components.\n */\n\nimport { usePaginationMode } from '@/lib/context/UserPreferencesContext';\nimport React, { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { AssignRoleModal } from '../modals/AssignRoleModal';\nimport { AssignSubscriptionModal } from '../modals/AssignSubscriptionModal';\nimport { ExportModal } from '../modals/ExportModal';\nimport { TimeoutModal, type TimeoutOptions } from '../modals/TimeoutModal';\nimport { UserDetailsModal } from '../modals/UserDetailsModal';\n\n// Import our extracted modules\nimport '../UserManagementPanel.css';\nimport { ErrorState, LoadingState, SearchOverlayContent } from './components';\nimport { SORTABLE_COLUMNS } from './constants';\nimport { FilterPanel } from './FilterPanel';\nimport { HeaderSection } from './HeaderSection';\nimport {\n  useColumnFiltering,\n  useColumnSorting,\n  useInfiniteScroll,\n  usePaginatedUsers,\n  useSmartSearch,\n  useUsersData\n} from './hooks';\nimport { PaginationSection } from './PaginationSection';\nimport { QuotaManagement } from './QuotaManagement';\nimport type { AdminUserManagementPanelProps, ManagementUser } from './types';\nimport { UserTable } from './UserTable';\n\nexport const UserManagementPanel: React.FC<AdminUserManagementPanelProps> = ({\n  onUserUpdate\n}) => {\n  // All the hooks for data management\n  const {\n    users,\n    loading,\n    error,\n    currentPage,\n    totalPages,\n    loadUsers,\n    goToPage,\n    setError\n  } = useUsersData();\n  const {\n    searchQuery,\n    searchResults,\n    isSearching,\n    showSearchResults,\n    setSearchQuery,\n    setShowSearchResults,\n    handleSearchChange,\n    handleSearchResultSelect\n  } = useSmartSearch();\n  const {\n    columnFilters,\n    showFilterPanel,\n    activeFiltersCount,\n    setShowFilterPanel,\n    applyColumnFilters,\n    addColumnFilter,\n    updateColumnFilter,\n    removeColumnFilter,\n    clearAllFilters\n  } = useColumnFiltering(users);\n  const { currentSort, handleSort, getSortIndicator } = useColumnSorting();\n  const { mode: paginationMode } = usePaginationMode();\n\n  // Process users through filters and sorting\n  const filteredUsers = useMemo(() => {\n    const filtered = applyColumnFilters(users);\n    if (!currentSort.direction || !currentSort.column) return filtered;\n\n    const sortColumn = SORTABLE_COLUMNS.find(\n      (col) => col.key === currentSort.column\n    );\n    if (!sortColumn?.sortable) return filtered;\n\n    return [...filtered].sort((a, b) => {\n      if (sortColumn.customSortFn) {\n        return sortColumn.customSortFn(a, b, currentSort.direction!);\n      }\n      return 0;\n    });\n  }, [users, applyColumnFilters, currentSort]);\n\n  const { displayedUsers, hasMoreUsers, isLoadingMore, loadMoreUsers } =\n    useInfiniteScroll(filteredUsers);\n  const paginatedUsers = usePaginatedUsers(\n    filteredUsers,\n    currentPage,\n    paginationMode,\n    displayedUsers\n  );\n\n  // Modal states\n  const [selectedUser, setSelectedUser] = React.useState<ManagementUser | null>(\n    null\n  );\n  const [showRoleModal, setShowRoleModal] = React.useState(false);\n  const [showSubscriptionModal, setShowSubscriptionModal] =\n    React.useState(false);\n  const [showQuotaModal, setShowQuotaModal] = React.useState(false);\n  const [roleAssignmentUser, setRoleAssignmentUser] =\n    React.useState<ManagementUser | null>(null);\n  const [subscriptionAssignmentUser, setSubscriptionAssignmentUser] =\n    React.useState<ManagementUser | null>(null);\n  const [quotaManagementUser, setQuotaManagementUser] =\n    React.useState<ManagementUser | null>(null);\n  const [showTimeoutModal, setShowTimeoutModal] = React.useState(false);\n  const [timeoutUser, setTimeoutUser] = React.useState<ManagementUser | null>(\n    null\n  );\n  const [showExportModal, setShowExportModal] = React.useState(false);\n  const [showUserDetailsModal, setShowUserDetailsModal] = React.useState(false);\n\n  const tableContainerRef = useRef<HTMLDivElement>(null);\n\n  // Effects\n  useEffect(() => {\n    loadUsers();\n  }, [loadUsers]);\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (searchQuery.trim().length >= 2) handleSearchChange(searchQuery);\n    }, 300);\n    return () => clearTimeout(timeoutId);\n  }, [searchQuery, handleSearchChange]);\n\n  useEffect(() => {\n    if (paginationMode !== 'infinite') return;\n    const container = tableContainerRef.current;\n    if (!container) return;\n\n    const handleScroll = () => {\n      const { scrollTop, scrollHeight, clientHeight } = container;\n      if (scrollTop + clientHeight >= scrollHeight - 100) loadMoreUsers();\n    };\n\n    container.addEventListener('scroll', handleScroll);\n    return () => container.removeEventListener('scroll', handleScroll);\n  }, [loadMoreUsers, paginationMode]);\n\n  // Action handlers (simplified)\n  const handleViewUser = useCallback(async (userId: string) => {\n    try {\n      const response = await fetch(`/api/admin/users/${userId}`);\n      if (response.ok) {\n        const userData = await response.json();\n        setSelectedUser(userData);\n        setShowUserDetailsModal(true);\n      }\n    } catch (error) {\n      console.error('Error loading user details:', error);\n    }\n  }, []);\n\n  const handleAssignRole = useCallback(\n    async (roleId: string, expiresAt?: string, reason?: string) => {\n      if (!roleAssignmentUser) return;\n      try {\n        const response = await fetch(\n          `/api/admin/users/${roleAssignmentUser.id}/roles`,\n          {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ roleId, expiresAt, reason })\n          }\n        );\n        if (response.ok) {\n          await loadUsers(currentPage);\n          onUserUpdate?.();\n        }\n      } catch (error) {\n        console.error('Error assigning role:', error);\n      }\n    },\n    [roleAssignmentUser, currentPage, loadUsers, onUserUpdate]\n  );\n\n  const handleManageSubscription = useCallback(\n    async (\n      planId: string,\n      billingCycle: string,\n      expiresAt?: string,\n      reason?: string\n    ) => {\n      if (!subscriptionAssignmentUser) return;\n      try {\n        const response = await fetch(\n          `/api/admin/users/${subscriptionAssignmentUser.id}/subscriptions`,\n          {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ planId, billingCycle, expiresAt, reason })\n          }\n        );\n        if (response.ok) {\n          await loadUsers(currentPage);\n          onUserUpdate?.();\n        }\n      } catch (error) {\n        console.error('Error managing subscription:', error);\n      }\n    },\n    [subscriptionAssignmentUser, currentPage, loadUsers, onUserUpdate]\n  );\n\n  const handleManageQuota = useCallback((user: ManagementUser) => {\n    setQuotaManagementUser(user);\n    setShowQuotaModal(true);\n  }, []);\n\n  const handleQuotaUpdate = useCallback(() => {\n    // Refresh user data after quota update\n    loadUsers(currentPage);\n    onUserUpdate?.();\n  }, [loadUsers, currentPage, onUserUpdate]);\n\n  const handleTimeoutUser = useCallback((user: ManagementUser) => {\n    setTimeoutUser(user);\n    setShowTimeoutModal(true);\n  }, []);\n\n  const handleRevokeTimeout = useCallback(\n    async (user: ManagementUser) => {\n      if (!user.active_timeout_id) return;\n      const confirmed = window.confirm(\n        `Revoke timeout for ${user.name || user.email}?`\n      );\n      if (!confirmed) return;\n\n      try {\n        const response = await fetch(`/api/admin/users/timeout/revoke`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            timeoutId: user.active_timeout_id,\n            reason: 'Revoked via admin panel'\n          })\n        });\n        if (response.ok) {\n          await loadUsers(currentPage);\n          onUserUpdate?.();\n        }\n      } catch (error) {\n        console.error('Error revoking timeout:', error);\n      }\n    },\n    [currentPage, loadUsers, onUserUpdate]\n  );\n\n  const handleTimeoutSubmit = useCallback(\n    async (userId: string, options: TimeoutOptions) => {\n      try {\n        const response = await fetch(`/api/admin/users/timeout`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            userId: parseInt(userId),\n            timeoutType: options.timeoutType,\n            reason: options.reason,\n            durationHours: options.durationHours\n          })\n        });\n        if (response.ok) {\n          await loadUsers(currentPage);\n          onUserUpdate?.();\n        }\n      } catch (error) {\n        console.error('Error timing out user:', error);\n      }\n    },\n    [currentPage, loadUsers, onUserUpdate]\n  );\n\n  // Search overlay content\n  const searchOverlayContent = useMemo(() => {\n    if (!showSearchResults) return null;\n    return (\n      <div className=\\\"user-search-overlay-content\\\">\n        <SearchOverlayContent\n          isSearching={isSearching}\n          searchResults={searchResults}\n          searchQuery={searchQuery}\n          onResultSelect={handleSearchResultSelect}\n        />\n      </div>\n    );\n  }, [\n    showSearchResults,\n    isSearching,\n    searchResults,\n    searchQuery,\n    handleSearchResultSelect\n  ]);\n\n  // Early returns\n  if (loading && users.length === 0) return <LoadingState />;\n  if (error)\n    return <ErrorState error={error} onRetry={() => loadUsers(currentPage)} />;\n\n  return (\n    <div className=\\\"user-management-panel\\\">\n      <HeaderSection\n        showFilterPanel={showFilterPanel}\n        activeFiltersCount={activeFiltersCount}\n        searchQuery={searchQuery}\n        showSearchResults={showSearchResults}\n        isSearching={isSearching}\n        searchOverlayContent={searchOverlayContent}\n        onToggleFilterPanel={() => setShowFilterPanel(!showFilterPanel)}\n        onExportAll={() => setShowExportModal(true)}\n        onSearchQueryChange={setSearchQuery}\n        onSearchFocus={() => setShowSearchResults(true)}\n        onSearchBlur={() => setTimeout(() => setShowSearchResults(false), 200)}\n        onSearchClear={() => {\n          setSearchQuery('');\n          setShowSearchResults(false);\n        }}\n      />\n\n      <FilterPanel\n        showFilterPanel={showFilterPanel}\n        activeFiltersCount={activeFiltersCount}\n        columnFilters={columnFilters}\n        onTogglePanel={() => setShowFilterPanel(!showFilterPanel)}\n        onClearAllFilters={clearAllFilters}\n        onAddFilter={addColumnFilter}\n        onUpdateFilter={updateColumnFilter}\n        onRemoveFilter={removeColumnFilter}\n      />\n\n      <UserTable\n        users={paginatedUsers}\n        paginationMode={paginationMode}\n        isLoadingMore={isLoadingMore}\n        hasMoreUsers={hasMoreUsers}\n        currentSort={currentSort}\n        onSort={handleSort}\n        getSortIndicator={getSortIndicator}\n        onViewUser={handleViewUser}\n        onAssignRole={(user) => {\n          setRoleAssignmentUser(user);\n          setShowRoleModal(true);\n        }}\n        onManageSubscription={(user) => {\n          setSubscriptionAssignmentUser(user);\n          setShowSubscriptionModal(true);\n        }}\n        onManageQuota={handleManageQuota}\n        onExportData={(user) => {\n          setSelectedUser(user);\n          setShowExportModal(true);\n        }}\n        onTimeoutUser={handleTimeoutUser}\n        onRevokeTimeout={handleRevokeTimeout}\n        tableContainerRef={tableContainerRef}\n      />\n\n      <PaginationSection\n        paginationMode={paginationMode}\n        currentPage={currentPage}\n        totalPages={totalPages}\n        paginatedUsers={paginatedUsers}\n        filteredUsers={filteredUsers}\n        users={users}\n        activeFiltersCount={activeFiltersCount}\n        hasMoreUsers={hasMoreUsers}\n        onGoToPage={goToPage}\n      />\n\n      {/* Modals */}\n      {showRoleModal && roleAssignmentUser && (\n        <AssignRoleModal\n          userName={\n            roleAssignmentUser.name ||\n            roleAssignmentUser.email ||\n            'Unknown User'\n          }\n          userId={roleAssignmentUser.id}\n          isOpen={showRoleModal}\n          onClose={() => {\n            setShowRoleModal(false);\n            setRoleAssignmentUser(null);\n          }}\n          onAssign={handleAssignRole}\n        />\n      )}\n\n      {showSubscriptionModal && subscriptionAssignmentUser && (\n        <AssignSubscriptionModal\n          userName={\n            subscriptionAssignmentUser.name ||\n            subscriptionAssignmentUser.email ||\n            'Unknown User'\n          }\n          userId={subscriptionAssignmentUser.id}\n          isOpen={showSubscriptionModal}\n          onClose={() => {\n            setShowSubscriptionModal(false);\n            setSubscriptionAssignmentUser(null);\n          }}\n          onAssign={handleManageSubscription}\n        />\n      )}\n\n      {showQuotaModal && quotaManagementUser && (\n        <QuotaManagement\n          user={quotaManagementUser}\n          isOpen={showQuotaModal}\n          onClose={() => {\n            setShowQuotaModal(false);\n            setQuotaManagementUser(null);\n          }}\n          onUpdate={handleQuotaUpdate}\n        />\n      )}\n\n      {showTimeoutModal && timeoutUser && (\n        <TimeoutModal\n          user={timeoutUser}\n          isOpen={showTimeoutModal}\n          onClose={() => {\n            setShowTimeoutModal(false);\n            setTimeoutUser(null);\n          }}\n          onTimeout={async (userId: string, options: TimeoutOptions) => {\n            try {\n              const response = await fetch(\n                `/api/admin/users/${userId}/timeout`,\n                {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify(options)\n                }\n              );\n              if (response.ok) {\n                await loadUsers(currentPage);\n                onUserUpdate?.();\n              }\n            } catch (error) {\n              console.error('Error applying timeout:', error);\n            }\n          }}\n        />\n      )}\n\n      {showExportModal && (\n        <ExportModal\n          users={paginatedUsers}\n          selectedUser={selectedUser}\n          isOpen={showExportModal}\n          onClose={() => {\n            setShowExportModal(false);\n            setSelectedUser(null);\n          }}\n        />\n      )}\n\n      {showUserDetailsModal && selectedUser && (\n        <UserDetailsModal\n          user={selectedUser}\n          isOpen={showUserDetailsModal}\n          onClose={() => {\n            setShowUserDetailsModal(false);\n            setSelectedUser(null);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":481,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/components.tsx":{
    "content":"/**\n * UI Components for User Management Panel\n *\n * This module contains smaller, reusable UI components used\n * throughout the user management system, promoting component\n * composition and reusability.\n */\n\nimport React from 'react';\nimport { Avatar } from '../../../components/avatar/Avatar';\nimport { LoadingButton } from '../../../components/ui/LoadingButton';\nimport type {\n  ManagementUser,\n  SearchResult,\n  UserActionsMenuProps\n} from './types';\n\n// ================================\n// USER ACTIONS MENU COMPONENT\n// ================================\n\n/**\n * Actions menu for individual user management\n * Provides contextual actions like view, assign role, timeout, etc.\n */\nexport const UserActionsMenu: React.FC<UserActionsMenuProps> = ({\n  user,\n  onViewUser,\n  onAssignRole,\n  onManageSubscription,\n  onManageQuota,\n  onExportData,\n  onTimeoutUser,\n  onRevokeTimeout,\n  closeTooltip\n}) => (\n  <div className=\\\"user-actions-menu\\\">\n    <LoadingButton\n      className=\\\"action-menu-item\\\"\n      onClick={() => {\n        onViewUser(user.id);\n        closeTooltip?.();\n      }}\n      globalLoadingMessage=\\\"Loading user details...\\\"\n      loadingText=\\\"Loading...\\\"\n      variant=\\\"ghost\\\"\n      size=\\\"sm\\\"\n    >\n      <span className=\\\"action-icon\\\">\ud83d\udc41\ufe0f</span>\n      <span className=\\\"action-label\\\">View Details</span>\n    </LoadingButton>\n\n    <button\n      className=\\\"action-menu-item\\\"\n      onClick={() => {\n        onAssignRole(user);\n        closeTooltip?.();\n      }}\n    >\n      <span className=\\\"action-icon\\\">\ud83c\udfad</span>\n      <span className=\\\"action-label\\\">Assign Role</span>\n    </button>\n\n    <button\n      className=\\\"action-menu-item\\\"\n      onClick={() => {\n        onManageSubscription(user);\n        closeTooltip?.();\n      }}\n    >\n      <span className=\\\"action-icon\\\">\ud83d\udc8e</span>\n      <span className=\\\"action-label\\\">Manage Subscription</span>\n    </button>\n\n    <button\n      className=\\\"action-menu-item\\\"\n      onClick={() => {\n        onManageQuota(user);\n        closeTooltip?.();\n      }}\n    >\n      <span className=\\\"action-icon\\\">\u26a1</span>\n      <span className=\\\"action-label\\\">Manage Quota</span>\n    </button>\n\n    <button\n      className=\\\"action-menu-item\\\"\n      onClick={() => {\n        onExportData(user);\n        closeTooltip?.();\n      }}\n    >\n      <span className=\\\"action-icon\\\">\ud83d\udcca</span>\n      <span className=\\\"action-label\\\">Export Data</span>\n    </button>\n\n    <div className=\\\"action-menu-divider\\\"></div>\n\n    {user.is_timed_out ? (\n      <LoadingButton\n        className=\\\"action-menu-item action-menu-item--danger\\\"\n        onClick={() => {\n          onRevokeTimeout(user);\n          closeTooltip?.();\n        }}\n        globalLoadingMessage=\\\"Revoking timeout...\\\"\n        loadingText=\\\"Revoking...\\\"\n        variant=\\\"danger\\\"\n        size=\\\"sm\\\"\n      >\n        <span className=\\\"action-icon\\\">\ud83d\udd13</span>\n        <span className=\\\"action-label\\\">Revoke Timeout</span>\n      </LoadingButton>\n    ) : (\n      <LoadingButton\n        className=\\\"action-menu-item action-menu-item--warning\\\"\n        onClick={() => {\n          onTimeoutUser(user);\n          closeTooltip?.();\n        }}\n        globalLoadingMessage=\\\"Applying timeout...\\\"\n        loadingText=\\\"Timing out...\\\"\n        variant=\\\"secondary\\\"\n        size=\\\"sm\\\"\n      >\n        <span className=\\\"action-icon\\\">\u23f0</span>\n        <span className=\\\"action-label\\\">Timeout User</span>\n      </LoadingButton>\n    )}\n  </div>\n);\n\n// ================================\n// SEARCH OVERLAY COMPONENTS\n// ================================\n\ninterface SearchOverlayProps {\n  isSearching: boolean;\n  searchResults: SearchResult[];\n  searchQuery: string;\n  onResultSelect: (user: SearchResult) => void;\n}\n\n/**\n * Search overlay content for the smart search functionality\n */\nexport const SearchOverlayContent: React.FC<SearchOverlayProps> = ({\n  isSearching,\n  searchResults,\n  searchQuery,\n  onResultSelect\n}) => {\n  if (isSearching) {\n    return (\n      <div className=\\\"search-overlay-loading\\\">\n        <span>\ud83d\udd0d</span> Searching users...\n      </div>\n    );\n  }\n\n  if (searchResults.length === 0 && searchQuery.trim().length >= 2) {\n    return (\n      <div className=\\\"search-overlay-no-results\\\">\n        <span>\ud83d\udc64</span> No users found for &ldquo;{searchQuery}&rdquo;\n      </div>\n    );\n  }\n\n  return (\n    <>\n      {searchResults.map((user) => (\n        <button\n          key={user.id}\n          className=\\\"search-overlay-item\\\"\n          onClick={() => onResultSelect(user)}\n        >\n          <div className=\\\"search-result-avatars\\\">\n            {/* Provider account image */}\n            {user.image && (\n              <img\n                src={user.image}\n                alt=\\\"Provider avatar\\\"\n                className=\\\"search-result-provider-avatar\\\"\n              />\n            )}\n            {/* Seeded avatar */}\n            <Avatar seed={user.id} size=\\\"xxs\\\" />\n          </div>\n          <div className=\\\"search-result-info\\\">\n            <span className=\\\"search-result-name\\\">\n              {user.name || 'Unnamed User'}\n            </span>\n            <span className=\\\"search-result-email\\\">{user.email}</span>\n            {(user.role_names || (user.roles && user.roles.length > 0)) && (\n              <div className=\\\"search-result-roles\\\">\n                {user.role_names\n                  ? user.role_names.split(', ').map((roleName, index) => (\n                      <span\n                        key={index}\n                        className=\\\"role-badge role-badge--small\\\"\n                      >\n                        {roleName}\n                      </span>\n                    ))\n                  : user.roles?.map((role) => (\n                      <span\n                        key={role.id}\n                        className=\\\"role-badge role-badge--small\\\"\n                      >\n                        {role.name}\n                      </span>\n                    ))}\n              </div>\n            )}\n          </div>\n        </button>\n      ))}\n    </>\n  );\n};\n\n// ================================\n// USER TABLE CELL COMPONENTS\n// ================================\n\ninterface UserInfoCellProps {\n  user: ManagementUser;\n}\n\n/**\n * User info cell with dual avatars and user details\n */\nexport const UserInfoCell: React.FC<UserInfoCellProps> = ({ user }) => (\n  <td className=\\\"user-info-cell\\\">\n    <div className=\\\"user-avatars\\\">\n      {/* Provider account image */}\n      {user.image && (\n        <img\n          src={user.image}\n          alt=\\\"Provider avatar\\\"\n          className=\\\"provider-avatar\\\"\n          title=\\\"Provider account image\\\"\n        />\n      )}\n      {/* Seeded avatar */}\n      <Avatar seed={user.id} size=\\\"sm\\\" enableTooltip={true} tooltipScale={2} />\n    </div>\n    <div className=\\\"user-details\\\">\n      <div className=\\\"user-name-row\\\">\n        <span className=\\\"user-name\\\">{user.name || 'Unnamed User'}</span>\n      </div>\n      <div className=\\\"user-id-row\\\">\n        <span className=\\\"user-id\\\">ID: {user.id}</span>\n      </div>\n    </div>\n  </td>\n);\n\ninterface RolesCellProps {\n  user: ManagementUser;\n}\n\n/**\n * Roles cell with role badges\n */\nexport const RolesCell: React.FC<RolesCellProps> = ({ user }) => (\n  <td className=\\\"roles-cell\\\">\n    <div className=\\\"roles-container\\\">\n      <div className=\\\"roles-list\\\">\n        {user.role_names ? (\n          user.role_names.split(', ').map((roleName, index) => (\n            <span key={index} className=\\\"role-badge\\\">\n              {roleName}\n            </span>\n          ))\n        ) : (\n          <span className=\\\"no-roles\\\">No roles</span>\n        )}\n      </div>\n    </div>\n  </td>\n);\n\ninterface TimeoutDetailsCellProps {\n  user: ManagementUser;\n  formatDate: (dateString: string) => string;\n}\n\n/**\n * Timeout details cell with timeout information\n */\nexport const TimeoutDetailsCell: React.FC<TimeoutDetailsCellProps> = ({\n  user,\n  formatDate\n}) => (\n  <td className=\\\"timeout-details-cell\\\">\n    {user.is_timed_out ? (\n      <div className=\\\"timeout-info\\\">\n        {user.active_timeout_reason && (\n          <div className=\\\"timeout-reason-row\\\">\n            <span className=\\\"timeout-reason\\\">\n              \u23f0 {user.active_timeout_reason}\n            </span>\n          </div>\n        )}\n        {user.timeout_expires && (\n          <div className=\\\"timeout-expires-row\\\">\n            <span className=\\\"timeout-expires\\\">\n              Expires: {formatDate(user.timeout_expires)}\n            </span>\n          </div>\n        )}\n      </div>\n    ) : (\n      <span className=\\\"no-timeout\\\">No active timeout</span>\n    )}\n  </td>\n);\n\n// ================================\n// LOADING AND STATE COMPONENTS\n// ================================\n\n/**\n * Loading state component\n */\nexport const LoadingState: React.FC = () => (\n  <div className=\\\"user-management-panel\\\">\n    <div className=\\\"loading-state\\\">\n      <div className=\\\"loading-spinner\\\"></div>\n      <p>Loading users...</p>\n    </div>\n  </div>\n);\n\ninterface ErrorStateProps {\n  error: string;\n  onRetry: () => void;\n}\n\n/**\n * Error state component\n */\nexport const ErrorState: React.FC<ErrorStateProps> = ({ error, onRetry }) => (\n  <div className=\\\"user-management-panel\\\">\n    <div className=\\\"error-state\\\">\n      <p>Error: {error}</p>\n      <button onClick={onRetry} className=\\\"btn btn--primary\\\">\n        Retry\n      </button>\n    </div>\n  </div>\n);\n\n/**\n * Infinite scroll loading indicator\n */\nexport const InfiniteScrollLoading: React.FC = () => (\n  <div className=\\\"infinite-scroll-loading\\\">\n    <div className=\\\"loading-spinner\\\"></div>\n    <span>Loading more users...</span>\n  </div>\n);\n\n/**\n * End of list indicator for infinite scroll\n */\nexport const InfiniteScrollEnd: React.FC = () => (\n  <div className=\\\"infinite-scroll-end\\\">\n    <span>You&apos;ve reached the end of the list! \ufffd\ufffd</span>\n  </div>\n);\n",
    "language":"typescript",
    "lines":373,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/PaginationSection.tsx":{
    "content":"/**\n * Pagination Section Component\n *\n * Handles pagination information display and controls for both traditional\n * and infinite scroll modes. This component is focused solely on pagination.\n */\n\nimport React from 'react';\nimport type { ManagementUser } from './types';\n\ninterface PaginationSectionProps {\n  paginationMode: 'traditional' | 'infinite';\n  currentPage: number;\n  totalPages: number;\n  paginatedUsers: ManagementUser[];\n  filteredUsers: ManagementUser[];\n  users: ManagementUser[];\n  activeFiltersCount: number;\n  hasMoreUsers: boolean;\n  onGoToPage: (page: number) => void;\n}\n\nexport const PaginationSection: React.FC<PaginationSectionProps> = ({\n  paginationMode,\n  currentPage,\n  totalPages,\n  paginatedUsers,\n  filteredUsers,\n  users,\n  activeFiltersCount,\n  hasMoreUsers,\n  onGoToPage\n}) => {\n  return (\n    <div className=\\\"pagination\\\">\n      <div className=\\\"pagination-info-section\\\">\n        {paginationMode === 'traditional' ? (\n          <>\n            <span className=\\\"pagination-info\\\">\n              Page {currentPage} of {totalPages}\n            </span>\n            <span className=\\\"results-info\\\">\n              {activeFiltersCount > 0 ? (\n                <>\n                  Showing {paginatedUsers.length} of {filteredUsers.length}{' '}\n                  filtered results\n                  {filteredUsers.length !== users.length && (\n                    <span className=\\\"total-results\\\">\n                      {' '}\n                      (from {users.length} total)\n                    </span>\n                  )}\n                </>\n              ) : (\n                <>\n                  Showing {paginatedUsers.length} of {users.length} users\n                </>\n              )}\n            </span>\n          </>\n        ) : (\n          <span className=\\\"results-info\\\">\n            {activeFiltersCount > 0 ? (\n              <>\n                Showing {paginatedUsers.length} of {filteredUsers.length}{' '}\n                filtered results\n                {filteredUsers.length !== users.length && (\n                  <span className=\\\"total-results\\\">\n                    {' '}\n                    (from {users.length} total)\n                  </span>\n                )}\n                {hasMoreUsers && (\n                  <span className=\\\"scroll-hint\\\">\n                    {' '}\n                    \u2022 Scroll down to load more\n                  </span>\n                )}\n              </>\n            ) : (\n              <>\n                Showing {paginatedUsers.length} of {users.length} users\n                {hasMoreUsers && (\n                  <span className=\\\"scroll-hint\\\">\n                    {' '}\n                    \u2022 Scroll down to load more\n                  </span>\n                )}\n              </>\n            )}\n          </span>\n        )}\n      </div>\n\n      {/* Traditional Pagination Controls */}\n      {paginationMode === 'traditional' && (\n        <div className=\\\"pagination-controls\\\">\n          <button\n            className=\\\"btn btn--secondary\\\"\n            onClick={() => onGoToPage(currentPage - 1)}\n            disabled={currentPage === 1}\n          >\n            Previous\n          </button>\n          <button\n            className=\\\"btn btn--secondary\\\"\n            onClick={() => onGoToPage(currentPage + 1)}\n            disabled={currentPage === totalPages}\n          >\n            Next\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":117,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/QuotaManagement.tsx":{
    "content":"/**\n * Quota Management Component - Redesigned for Agnostic Quota Architecture\n *\n * This component now works with the new agnostic quota system where:\n * - Subscriptions provide base quotas\n * - Overrides are used only for exceptional cases (higher than subscription)\n * - Clear visibility into quota sources and effective limits\n * - Simplified interface focused on administrative overrides\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { TimestampWithTooltip } from '../../../components/ui/TimestampWithTooltip';\nimport type { ManagementUser } from './types';\n\ninterface EffectiveQuotaData {\n  service_name: string;\n  feature_name: string;\n  display_name: string;\n  current_usage: number;\n  // Subscription quota\n  subscription_quota_limit: number | null;\n  subscription_is_unlimited: boolean;\n  subscription_plan_name?: string;\n  // Override quota\n  override_quota_limit: number | null;\n  override_is_unlimited: boolean;\n  override_reason?: string;\n  // Effective (active) quota\n  effective_quota_limit: number;\n  effective_is_unlimited: boolean;\n  effective_source: 'subscription_plan' | 'user_override' | 'none';\n  reset_date: string;\n  reset_period: string;\n}\n\ninterface QuotaManagementProps {\n  user: ManagementUser;\n  isOpen: boolean;\n  onClose: () => void;\n  onUpdate?: () => void;\n}\n\nexport const QuotaManagement: React.FC<QuotaManagementProps> = ({\n  user,\n  isOpen,\n  onClose,\n  onUpdate\n}) => {\n  const [quotaData, setQuotaData] = useState<EffectiveQuotaData[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [editingQuota, setEditingQuota] = useState<string | null>(null);\n  const [newOverrideLimit, setNewOverrideLimit] = useState<number>(0);\n  const [isUnlimited, setIsUnlimited] = useState(false);\n  const [resetPeriod, setResetPeriod] = useState<\n    'daily' | 'weekly' | 'monthly'\n  >('daily');\n  const [reason, setReason] = useState('');\n  const [savingQuota, setSavingQuota] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (isOpen && user.id) {\n      loadUserQuotaData();\n    }\n  }, [isOpen, user.id]);\n\n  const loadUserQuotaData = async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await fetch(\n        `/api/admin/users/${user.id}/effective-quotas`,\n        {\n          credentials: 'include'\n        }\n      );\n\n      if (response.ok) {\n        const result = await response.json();\n        setQuotaData(result.data?.quotas || []);\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || 'Failed to load quota data');\n      }\n    } catch (err) {\n      setError('Error loading quota data');\n      console.error('Error loading quota data:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAddOverride = (\n    serviceName: string,\n    featureName: string,\n    currentSubscriptionLimit: number | null\n  ) => {\n    setEditingQuota(`${serviceName}.${featureName}`);\n    // Set minimum override to be higher than subscription limit\n    const minOverride = currentSubscriptionLimit\n      ? currentSubscriptionLimit + 1\n      : 1;\n    setNewOverrideLimit(minOverride);\n    setIsUnlimited(false);\n    setResetPeriod('daily');\n    setReason('');\n  };\n\n  const handleEditOverride = (\n    serviceName: string,\n    featureName: string,\n    currentOverrideLimit: number,\n    unlimited: boolean,\n    currentResetPeriod: string = 'daily'\n  ) => {\n    setEditingQuota(`${serviceName}.${featureName}`);\n    setNewOverrideLimit(currentOverrideLimit === -1 ? 0 : currentOverrideLimit);\n    setIsUnlimited(unlimited);\n    setResetPeriod(currentResetPeriod as 'daily' | 'weekly' | 'monthly');\n    setReason('');\n  };\n\n  const handleSaveOverride = async () => {\n    if (!editingQuota) return;\n\n    const [serviceName, featureName] = editingQuota.split('.');\n    const quotaItem = quotaData.find(\n      (q) => q.service_name === serviceName && q.feature_name === featureName\n    );\n\n    if (!quotaItem) return;\n\n    // Validation: Override must be higher than subscription quota (unless unlimited)\n    if (\n      !isUnlimited &&\n      quotaItem.subscription_quota_limit !== null &&\n      newOverrideLimit <= quotaItem.subscription_quota_limit\n    ) {\n      setError(\n        `Override quota must be higher than subscription quota (${quotaItem.subscription_quota_limit})`\n      );\n      return;\n    }\n\n    if (!reason.trim()) {\n      setError('Please provide a reason for this quota override');\n      return;\n    }\n\n    setSavingQuota(`${serviceName}.${featureName}`);\n\n    try {\n      const response = await fetch(\n        `/api/admin/users/${user.id}/quota-overrides`,\n        {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({\n            service_name: serviceName,\n            feature_name: featureName,\n            quota_limit: isUnlimited ? null : newOverrideLimit,\n            is_unlimited: isUnlimited,\n            reset_period: resetPeriod,\n            reason: reason.trim()\n          })\n        }\n      );\n\n      if (response.ok) {\n        await loadUserQuotaData();\n        setEditingQuota(null);\n        setError(null);\n        onUpdate?.();\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || 'Failed to save quota override');\n      }\n    } catch (err) {\n      setError('Error saving quota override');\n      console.error('Error saving quota override:', err);\n    } finally {\n      setSavingQuota(null);\n    }\n  };\n\n  const handleRemoveOverride = async (\n    serviceName: string,\n    featureName: string\n  ) => {\n    if (\n      !confirm(\n        `Remove quota override for ${serviceName}? This will revert to subscription-based quota.`\n      )\n    ) {\n      return;\n    }\n\n    try {\n      const response = await fetch(\n        `/api/admin/users/${user.id}/quota-overrides`,\n        {\n          method: 'DELETE',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({\n            service_name: serviceName,\n            feature_name: featureName\n          })\n        }\n      );\n\n      if (response.ok) {\n        await loadUserQuotaData();\n        onUpdate?.();\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || 'Failed to remove quota override');\n      }\n    } catch (err) {\n      setError('Error removing quota override');\n      console.error('Error removing quota override:', err);\n    }\n  };\n\n  const handleResetUsage = async (serviceName: string, featureName: string) => {\n    if (\n      !confirm(\n        `Reset usage for ${serviceName}? This will set current usage to 0.`\n      )\n    ) {\n      return;\n    }\n\n    try {\n      const response = await fetch(\n        `/api/admin/users/${user.id}/quota-usage/reset`,\n        {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({\n            service_name: serviceName,\n            feature_name: featureName,\n            reason: `Usage reset by admin for ${user.name || user.email}`\n          })\n        }\n      );\n\n      if (response.ok) {\n        await loadUserQuotaData();\n        onUpdate?.();\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || 'Failed to reset usage');\n      }\n    } catch (err) {\n      setError('Error resetting usage');\n      console.error('Error resetting usage:', err);\n    }\n  };\n\n  const getQuotaSourceBadge = (source: string) => {\n    switch (source) {\n      case 'subscription_plan':\n        return (\n          <span className=\\\"quota-source-badge quota-source--subscription\\\">\n            \ud83d\udccb Subscription\n          </span>\n        );\n      case 'user_override':\n        return (\n          <span className=\\\"quota-source-badge quota-source--override\\\">\n            \u26a1 Override\n          </span>\n        );\n      default:\n        return (\n          <span className=\\\"quota-source-badge quota-source--none\\\">\n            \u274c No Quota\n          </span>\n        );\n    }\n  };\n\n  const getUsagePercentage = (\n    current: number,\n    limit: number,\n    unlimited: boolean\n  ) => {\n    if (unlimited) return 0;\n    return Math.min((current / limit) * 100, 100);\n  };\n\n  const getUsageColor = (percentage: number) => {\n    if (percentage >= 100) return 'linear-gradient(90deg, #ef4444, #dc2626)';\n    if (percentage >= 80) return 'linear-gradient(90deg, #f59e0b, #d97706)';\n    return 'linear-gradient(90deg, #10b981, #059669)';\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <>\n      <style jsx>{`\n        .quota-source-badge {\n          padding: 0.25rem 0.5rem;\n          border-radius: 12px;\n          font-size: 0.75rem;\n          font-weight: 600;\n          text-transform: uppercase;\n        }\n        .quota-source--subscription {\n          background: rgba(59, 130, 246, 0.1);\n          color: #3b82f6;\n          border: 1px solid rgba(59, 130, 246, 0.3);\n        }\n        .quota-source--override {\n          background: rgba(168, 85, 247, 0.1);\n          color: #a855f7;\n          border: 1px solid rgba(168, 85, 247, 0.3);\n        }\n        .quota-source--none {\n          background: rgba(239, 68, 68, 0.1);\n          color: #ef4444;\n          border: 1px solid rgba(239, 68, 68, 0.3);\n        }\n      `}</style>\n\n      <div\n        style={{\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          background: 'rgba(0, 0, 0, 0.8)',\n          backdropFilter: 'blur(8px)',\n          WebkitBackdropFilter: 'blur(8px)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 9999,\n          padding: '20px'\n        }}\n      >\n        <div\n          style={{\n            background: 'var(--glass-overlay-medium, var(--glass-bg-medium))',\n            border:\n              '1px solid var(--glass-border-overlay-medium, var(--glass-border-medium))',\n            borderRadius: '16px',\n            backdropFilter: 'var(--glass-blur-medium)',\n            WebkitBackdropFilter: 'var(--glass-blur-medium)',\n            boxShadow: 'var(--glass-shadow-medium)',\n            maxWidth: '900px',\n            width: '100%',\n            maxHeight: '90vh',\n            overflow: 'hidden',\n            display: 'flex',\n            flexDirection: 'column'\n          }}\n        >\n          {/* Header */}\n          <div\n            style={{\n              padding: '24px 32px',\n              borderBottom:\n                '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between'\n            }}\n          >\n            <div>\n              <h3\n                style={{\n                  margin: 0,\n                  color: 'var(--dark-bg__text-color--primary)',\n                  fontSize: '20px',\n                  fontWeight: '600'\n                }}\n              >\n                \ud83c\udfaf Quota Management\n              </h3>\n              <p\n                style={{\n                  margin: '4px 0 0 0',\n                  color: 'var(--dark-bg__text-color--secondary)',\n                  fontSize: '14px'\n                }}\n              >\n                {user.name || user.email} - Subscription + Override Integration\n              </p>\n            </div>\n            <button\n              onClick={onClose}\n              style={{\n                background: 'none',\n                border: 'none',\n                color: 'var(--dark-bg__text-color--secondary)',\n                fontSize: '24px',\n                cursor: 'pointer',\n                padding: '8px',\n                borderRadius: '8px',\n                transition: 'all 0.2s ease'\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.background =\n                  'var(--glass-overlay-light, var(--glass-bg-light))';\n                e.currentTarget.style.color =\n                  'var(--dark-bg__text-color--primary)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.background = 'none';\n                e.currentTarget.style.color =\n                  'var(--dark-bg__text-color--secondary)';\n              }}\n            >\n              \u2715\n            </button>\n          </div>\n\n          {/* Body */}\n          <div\n            style={{\n              padding: '24px 32px',\n              flex: 1,\n              overflow: 'auto'\n            }}\n          >\n            {loading ? (\n              <div\n                style={{\n                  textAlign: 'center',\n                  padding: '40px',\n                  color: 'var(--dark-bg__text-color--secondary)'\n                }}\n              >\n                <div style={{ fontSize: '32px', marginBottom: '16px' }}>\u23f3</div>\n                <p>Loading quota data...</p>\n              </div>\n            ) : error ? (\n              <div\n                style={{\n                  background: 'rgba(239, 68, 68, 0.1)',\n                  border: '1px solid rgba(239, 68, 68, 0.3)',\n                  borderRadius: '12px',\n                  padding: '20px',\n                  textAlign: 'center',\n                  marginBottom: '20px'\n                }}\n              >\n                <div style={{ fontSize: '24px', marginBottom: '12px' }}>\u26a0\ufe0f</div>\n                <p style={{ color: '#ef4444', margin: '0 0 16px 0' }}>\n                  {error}\n                </p>\n                <button\n                  onClick={() => {\n                    setError(null);\n                    loadUserQuotaData();\n                  }}\n                  style={{\n                    background: '#ef4444',\n                    color: 'white',\n                    border: 'none',\n                    padding: '8px 16px',\n                    borderRadius: '6px',\n                    cursor: 'pointer'\n                  }}\n                >\n                  \ud83d\udd04 Retry\n                </button>\n              </div>\n            ) : (\n              <div\n                style={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: '20px'\n                }}\n              >\n                {quotaData.length === 0 ? (\n                  <div\n                    style={{\n                      textAlign: 'center',\n                      padding: '40px',\n                      color: 'var(--dark-bg__text-color--secondary)'\n                    }}\n                  >\n                    <div style={{ fontSize: '32px', marginBottom: '16px' }}>\n                      \ud83d\udcca\n                    </div>\n                    <p>No quota data available for this user.</p>\n                    <p style={{ fontSize: '14px', marginTop: '8px' }}>\n                      User may need a subscription plan or quota override.\n                    </p>\n                  </div>\n                ) : (\n                  quotaData.map((quota) => (\n                    <div\n                      key={`${quota.service_name}-${quota.feature_name}`}\n                      style={{\n                        background:\n                          'var(--glass-overlay-light, var(--glass-bg-light))',\n                        border:\n                          '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n                        borderRadius: '12px',\n                        padding: '20px',\n                        backdropFilter: 'var(--glass-blur-light)',\n                        WebkitBackdropFilter: 'var(--glass-blur-light)'\n                      }}\n                    >\n                      {/* Quota Header */}\n                      <div\n                        style={{\n                          display: 'flex',\n                          alignItems: 'center',\n                          justifyContent: 'space-between',\n                          marginBottom: '16px'\n                        }}\n                      >\n                        <div>\n                          <h4\n                            style={{\n                              margin: 0,\n                              color: 'var(--dark-bg__text-color--primary)',\n                              fontSize: '16px',\n                              fontWeight: '600'\n                            }}\n                          >\n                            {quota.display_name}\n                          </h4>\n                          <div style={{ marginTop: '4px' }}>\n                            {getQuotaSourceBadge(quota.effective_source)}\n                          </div>\n                        </div>\n                        <div style={{ textAlign: 'right' }}>\n                          <div\n                            style={{\n                              color: quota.effective_is_unlimited\n                                ? '#10b981'\n                                : 'var(--dark-bg__text-color--primary)',\n                              fontSize: '24px',\n                              fontWeight: '700'\n                            }}\n                          >\n                            {quota.effective_is_unlimited\n                              ? '\u221e'\n                              : quota.effective_quota_limit}\n                          </div>\n                          <div\n                            style={{\n                              color: 'var(--dark-bg__text-color--secondary)',\n                              fontSize: '12px'\n                            }}\n                          >\n                            {quota.reset_period} limit\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Quota Breakdown */}\n                      <div style={{ marginBottom: '16px' }}>\n                        <div\n                          style={{\n                            display: 'grid',\n                            gridTemplateColumns: '1fr 1fr',\n                            gap: '12px',\n                            fontSize: '14px'\n                          }}\n                        >\n                          <div>\n                            <strong\n                              style={{\n                                color: 'var(--dark-bg__text-color--primary)'\n                              }}\n                            >\n                              Subscription:\n                            </strong>\n                            <div\n                              style={{\n                                color: 'var(--dark-bg__text-color--secondary)'\n                              }}\n                            >\n                              {quota.subscription_is_unlimited\n                                ? '\u221e'\n                                : quota.subscription_quota_limit || 'None'}\n                              {quota.subscription_plan_name &&\n                                ` (${quota.subscription_plan_name})`}\n                            </div>\n                          </div>\n                          <div>\n                            <strong\n                              style={{\n                                color: 'var(--dark-bg__text-color--primary)'\n                              }}\n                            >\n                              Override:\n                            </strong>\n                            <div\n                              style={{\n                                color: 'var(--dark-bg__text-color--secondary)'\n                              }}\n                            >\n                              {quota.override_is_unlimited\n                                ? '\u221e'\n                                : quota.override_quota_limit || 'None'}\n                              {quota.override_reason && (\n                                <div\n                                  style={{\n                                    fontSize: '12px',\n                                    fontStyle: 'italic'\n                                  }}\n                                >\n                                  \\\"{quota.override_reason}\\\"\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Usage Display */}\n                      <div style={{ marginBottom: '16px' }}>\n                        <div\n                          style={{\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'space-between',\n                            marginBottom: '8px'\n                          }}\n                        >\n                          <span\n                            style={{\n                              color: 'var(--dark-bg__text-color--secondary)',\n                              fontSize: '14px'\n                            }}\n                          >\n                            Current Usage:\n                          </span>\n                          <span\n                            style={{\n                              color: 'var(--dark-bg__text-color--primary)',\n                              fontSize: '16px',\n                              fontWeight: '600'\n                            }}\n                          >\n                            {quota.current_usage}\n                            {!quota.effective_is_unlimited &&\n                              ` / ${quota.effective_quota_limit}`}\n                          </span>\n                        </div>\n                        {!quota.effective_is_unlimited && (\n                          <div\n                            style={{\n                              background:\n                                'var(--glass-overlay-dark, var(--glass-bg-dark))',\n                              borderRadius: '8px',\n                              height: '8px',\n                              overflow: 'hidden'\n                            }}\n                          >\n                            <div\n                              style={{\n                                background: getUsageColor(\n                                  getUsagePercentage(\n                                    quota.current_usage,\n                                    quota.effective_quota_limit,\n                                    quota.effective_is_unlimited\n                                  )\n                                ),\n                                height: '100%',\n                                width: `${getUsagePercentage(quota.current_usage, quota.effective_quota_limit, quota.effective_is_unlimited)}%`,\n                                transition: 'width 0.3s ease'\n                              }}\n                            />\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Reset Info */}\n                      <div\n                        style={{\n                          marginBottom: '16px',\n                          fontSize: '14px',\n                          color: 'var(--dark-bg__text-color--secondary)'\n                        }}\n                      >\n                        <div>\n                          Resets:{' '}\n                          <TimestampWithTooltip timestamp={quota.reset_date} />\n                        </div>\n                      </div>\n\n                      {/* Actions */}\n                      <div>\n                        {editingQuota ===\n                        `${quota.service_name}.${quota.feature_name}` ? (\n                          <div\n                            style={{\n                              background:\n                                'var(--glass-overlay-medium, var(--glass-bg-medium))',\n                              border:\n                                '1px solid var(--glass-border-overlay-medium, var(--glass-border-medium))',\n                              borderRadius: '8px',\n                              padding: '16px'\n                            }}\n                          >\n                            <div style={{ marginBottom: '16px' }}>\n                              <label\n                                style={{\n                                  display: 'block',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  fontSize: '14px',\n                                  fontWeight: '500',\n                                  marginBottom: '8px'\n                                }}\n                              >\n                                Override Limit:\n                              </label>\n                              <input\n                                type=\\\"number\\\"\n                                value={newOverrideLimit}\n                                onChange={(e) => {\n                                  const value = parseInt(e.target.value) || 0;\n                                  setNewOverrideLimit(value);\n                                }}\n                                min={\n                                  quota.subscription_quota_limit\n                                    ? quota.subscription_quota_limit + 1\n                                    : 1\n                                }\n                                disabled={isUnlimited}\n                                style={{\n                                  width: '100%',\n                                  padding: '12px',\n                                  borderRadius: '8px',\n                                  border:\n                                    '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n                                  background:\n                                    'var(--glass-overlay-light, var(--glass-bg-light))',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  fontSize: '14px'\n                                }}\n                              />\n                              <small\n                                style={{\n                                  color:\n                                    'var(--dark-bg__text-color--secondary)',\n                                  fontSize: '12px',\n                                  display: 'block',\n                                  marginTop: '4px'\n                                }}\n                              >\n                                Must be higher than subscription quota (\n                                {quota.subscription_quota_limit || 'none'})\n                              </small>\n                            </div>\n\n                            <div style={{ marginBottom: '16px' }}>\n                              <label\n                                style={{\n                                  display: 'flex',\n                                  alignItems: 'center',\n                                  gap: '8px',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  fontSize: '14px',\n                                  fontWeight: '500',\n                                  cursor: 'pointer'\n                                }}\n                              >\n                                <input\n                                  type=\\\"checkbox\\\"\n                                  checked={isUnlimited}\n                                  onChange={(e) =>\n                                    setIsUnlimited(e.target.checked)\n                                  }\n                                  style={{\n                                    width: '16px',\n                                    height: '16px',\n                                    accentColor: 'var(--brand-primary)'\n                                  }}\n                                />\n                                Unlimited Override\n                              </label>\n                            </div>\n\n                            <div style={{ marginBottom: '16px' }}>\n                              <label\n                                style={{\n                                  display: 'block',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  fontSize: '14px',\n                                  fontWeight: '500',\n                                  marginBottom: '8px'\n                                }}\n                              >\n                                Reset Period:\n                              </label>\n                              <select\n                                value={resetPeriod}\n                                onChange={(e) =>\n                                  setResetPeriod(\n                                    e.target.value as\n                                      | 'daily'\n                                      | 'weekly'\n                                      | 'monthly'\n                                  )\n                                }\n                                style={{\n                                  width: '100%',\n                                  padding: '12px',\n                                  borderRadius: '8px',\n                                  border:\n                                    '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n                                  background:\n                                    'var(--glass-overlay-light, var(--glass-bg-light))',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  fontSize: '14px'\n                                }}\n                              >\n                                <option value=\\\"daily\\\">Daily</option>\n                                <option value=\\\"weekly\\\">Weekly</option>\n                                <option value=\\\"monthly\\\">Monthly</option>\n                              </select>\n                            </div>\n\n                            <div style={{ marginBottom: '16px' }}>\n                              <label\n                                style={{\n                                  display: 'block',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  fontSize: '14px',\n                                  fontWeight: '500',\n                                  marginBottom: '8px'\n                                }}\n                              >\n                                Reason (Required):\n                              </label>\n                              <input\n                                type=\\\"text\\\"\n                                value={reason}\n                                onChange={(e) => setReason(e.target.value)}\n                                placeholder=\\\"Why is this override needed?\\\"\n                                required\n                                style={{\n                                  width: '100%',\n                                  padding: '12px',\n                                  borderRadius: '8px',\n                                  border:\n                                    '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n                                  background:\n                                    'var(--glass-overlay-light, var(--glass-bg-light))',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  fontSize: '14px'\n                                }}\n                              />\n                            </div>\n\n                            <div style={{ display: 'flex', gap: '12px' }}>\n                              <button\n                                onClick={handleSaveOverride}\n                                disabled={\n                                  savingQuota ===\n                                    `${quota.service_name}.${quota.feature_name}` ||\n                                  !reason.trim()\n                                }\n                                style={{\n                                  background:\n                                    'linear-gradient(135deg, #10b981, #059669)',\n                                  color: 'white',\n                                  border: 'none',\n                                  padding: '10px 20px',\n                                  borderRadius: '8px',\n                                  cursor: 'pointer',\n                                  fontSize: '14px',\n                                  fontWeight: '500',\n                                  opacity:\n                                    savingQuota ===\n                                      `${quota.service_name}.${quota.feature_name}` ||\n                                    !reason.trim()\n                                      ? 0.6\n                                      : 1\n                                }}\n                              >\n                                {savingQuota ===\n                                `${quota.service_name}.${quota.feature_name}`\n                                  ? '\u23f3 Saving...'\n                                  : '\u2705 Save Override'}\n                              </button>\n                              <button\n                                onClick={() => setEditingQuota(null)}\n                                style={{\n                                  background:\n                                    'var(--glass-overlay-light, var(--glass-bg-light))',\n                                  color: 'var(--dark-bg__text-color--primary)',\n                                  border:\n                                    '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n                                  padding: '10px 20px',\n                                  borderRadius: '8px',\n                                  cursor: 'pointer',\n                                  fontSize: '14px',\n                                  fontWeight: '500'\n                                }}\n                              >\n                                \u274c Cancel\n                              </button>\n                            </div>\n                          </div>\n                        ) : (\n                          <div\n                            style={{\n                              display: 'flex',\n                              gap: '12px',\n                              flexWrap: 'wrap'\n                            }}\n                          >\n                            {quota.effective_source === 'user_override' ? (\n                              <button\n                                onClick={() =>\n                                  handleEditOverride(\n                                    quota.service_name,\n                                    quota.feature_name,\n                                    quota.override_quota_limit!,\n                                    quota.override_is_unlimited,\n                                    quota.reset_period\n                                  )\n                                }\n                                style={{\n                                  background:\n                                    'linear-gradient(135deg, #a855f7, #9333ea)',\n                                  color: 'white',\n                                  border: 'none',\n                                  padding: '8px 16px',\n                                  borderRadius: '6px',\n                                  cursor: 'pointer',\n                                  fontSize: '13px',\n                                  fontWeight: '500'\n                                }}\n                              >\n                                \u270f\ufe0f Edit Override\n                              </button>\n                            ) : (\n                              <button\n                                onClick={() =>\n                                  handleAddOverride(\n                                    quota.service_name,\n                                    quota.feature_name,\n                                    quota.subscription_quota_limit\n                                  )\n                                }\n                                style={{\n                                  background:\n                                    'linear-gradient(135deg, #3b82f6, #2563eb)',\n                                  color: 'white',\n                                  border: 'none',\n                                  padding: '8px 16px',\n                                  borderRadius: '6px',\n                                  cursor: 'pointer',\n                                  fontSize: '13px',\n                                  fontWeight: '500'\n                                }}\n                              >\n                                \u26a1 Add Override\n                              </button>\n                            )}\n\n                            {quota.effective_source === 'user_override' && (\n                              <button\n                                onClick={() =>\n                                  handleRemoveOverride(\n                                    quota.service_name,\n                                    quota.feature_name\n                                  )\n                                }\n                                style={{\n                                  background:\n                                    'linear-gradient(135deg, #ef4444, #dc2626)',\n                                  color: 'white',\n                                  border: 'none',\n                                  padding: '8px 16px',\n                                  borderRadius: '6px',\n                                  cursor: 'pointer',\n                                  fontSize: '13px',\n                                  fontWeight: '500'\n                                }}\n                              >\n                                \ud83d\uddd1\ufe0f Remove Override\n                              </button>\n                            )}\n\n                            {quota.current_usage > 0 && (\n                              <button\n                                onClick={() =>\n                                  handleResetUsage(\n                                    quota.service_name,\n                                    quota.feature_name\n                                  )\n                                }\n                                style={{\n                                  background:\n                                    'linear-gradient(135deg, #f59e0b, #d97706)',\n                                  color: 'white',\n                                  border: 'none',\n                                  padding: '8px 16px',\n                                  borderRadius: '6px',\n                                  cursor: 'pointer',\n                                  fontSize: '13px',\n                                  fontWeight: '500'\n                                }}\n                              >\n                                \ud83d\udd04 Reset Usage\n                              </button>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          <div\n            style={{\n              padding: '20px 32px',\n              borderTop:\n                '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center'\n            }}\n          >\n            <div\n              style={{\n                fontSize: '12px',\n                color: 'var(--dark-bg__text-color--secondary)'\n              }}\n            >\n              \ud83d\udca1 Overrides are only used when they provide higher quotas than\n              subscriptions\n            </div>\n            <button\n              onClick={onClose}\n              style={{\n                background: 'var(--glass-overlay-light, var(--glass-bg-light))',\n                color: 'var(--dark-bg__text-color--primary)',\n                border:\n                  '1px solid var(--glass-border-overlay-light, var(--glass-border-light))',\n                padding: '12px 24px',\n                borderRadius: '8px',\n                cursor: 'pointer',\n                fontSize: '14px',\n                fontWeight: '500'\n              }}\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n};\n",
    "language":"typescript",
    "lines":1068,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/UserTable.tsx":{
    "content":"/**\n * User Table Component\n *\n * Handles the rendering of the users table with sorting, pagination indicators,\n * and individual user rows. This component is focused solely on table presentation.\n */\n\nimport React from 'react';\nimport { InteractiveTooltip } from '../../../components/tooltip/InteractiveTooltip';\nimport {\n  InfiniteScrollEnd,\n  InfiniteScrollLoading,\n  RolesCell,\n  TimeoutDetailsCell,\n  UserActionsMenu,\n  UserInfoCell\n} from './components';\nimport { SORTABLE_COLUMNS } from './constants';\nimport type { ManagementUser } from './types';\nimport { formatDate, getPlansDisplay, getStatusBadge } from './utils';\n\ninterface UserTableProps {\n  users: ManagementUser[];\n  paginationMode: 'traditional' | 'infinite';\n  isLoadingMore: boolean;\n  hasMoreUsers: boolean;\n  currentSort: { column: string; direction: 'asc' | 'desc' | null };\n  onSort: (columnKey: string) => void;\n  getSortIndicator: (columnKey: string) => string;\n  onViewUser: (userId: string) => void;\n  onAssignRole: (user: ManagementUser) => void;\n  onManageSubscription: (user: ManagementUser) => void;\n  onManageQuota: (user: ManagementUser) => void;\n  onExportData: (user: ManagementUser) => void;\n  onTimeoutUser: (user: ManagementUser) => void;\n  onRevokeTimeout: (user: ManagementUser) => void;\n  tableContainerRef: React.RefObject<HTMLDivElement>;\n}\n\nexport const UserTable: React.FC<UserTableProps> = ({\n  users,\n  paginationMode,\n  isLoadingMore,\n  hasMoreUsers,\n  currentSort,\n  onSort,\n  getSortIndicator,\n  onViewUser,\n  onAssignRole,\n  onManageSubscription,\n  onManageQuota,\n  onExportData,\n  onTimeoutUser,\n  onRevokeTimeout,\n  tableContainerRef\n}) => {\n  return (\n    <div\n      className=\\\"users-table-container\\\"\n      ref={tableContainerRef}\n      tabIndex={0}\n      role=\\\"region\\\"\n      aria-label=\\\"User management table with horizontal and vertical scrolling\\\"\n    >\n      <table className=\\\"users-table\\\">\n        <thead>\n          <tr>\n            {SORTABLE_COLUMNS.map((column) => (\n              <th\n                key={column.key}\n                className={column.sortable ? 'sortable-header' : ''}\n                onClick={column.sortable ? () => onSort(column.key) : undefined}\n                title={column.sortable ? 'Click to sort' : undefined}\n              >\n                {column.label}\n                {getSortIndicator(column.key)}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody>\n          {users.map((user) => (\n            <tr key={user.id} className=\\\"user-row\\\">\n              {/* Actions column */}\n              <td className=\\\"actions-cell\\\">\n                <InteractiveTooltip\n                  content={\n                    <UserActionsMenu\n                      user={user}\n                      onViewUser={onViewUser}\n                      onAssignRole={onAssignRole}\n                      onManageSubscription={onManageSubscription}\n                      onManageQuota={onManageQuota}\n                      onExportData={onExportData}\n                      onTimeoutUser={onTimeoutUser}\n                      onRevokeTimeout={onRevokeTimeout}\n                      closeTooltip={() => {}}\n                    />\n                  }\n                  triggerOnClick={true}\n                  className=\\\"user-actions-tooltip\\\"\n                >\n                  <button className=\\\"hamburger-menu-btn\\\" title=\\\"User Actions\\\">\n                    <span className=\\\"hamburger-icon\\\">\u22ee</span>\n                  </button>\n                </InteractiveTooltip>\n              </td>\n\n              {/* User column with dual avatars */}\n              <UserInfoCell user={user} />\n\n              {/* Contact column */}\n              <td className=\\\"contact-cell\\\">\n                <div className=\\\"contact-row\\\">\n                  <span className=\\\"user-email\\\">{user.email}</span>\n                </div>\n              </td>\n\n              {/* Provider column */}\n              <td className=\\\"provider-cell\\\">\n                <div className=\\\"provider-row\\\">\n                  <span className=\\\"provider-name\\\">\n                    {user.provider_name || 'Not Available'}\n                  </span>\n                </div>\n              </td>\n\n              {/* Roles column */}\n              <RolesCell user={user} />\n\n              {/* Status column */}\n              <td className=\\\"status-cell\\\">{getStatusBadge(user)}</td>\n\n              {/* Plans column */}\n              <td className=\\\"plans-cell\\\">{getPlansDisplay(user)}</td>\n\n              {/* Timeout Details column */}\n              <TimeoutDetailsCell user={user} formatDate={formatDate} />\n\n              {/* Joined column */}\n              <td className=\\\"joined-cell\\\">\n                <div className=\\\"joined-row\\\">\n                  <span className=\\\"joined-date\\\">\n                    {formatDate(user.created_at)}\n                  </span>\n                </div>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n\n      {/* Infinite Scroll Loading Indicator */}\n      {paginationMode === 'infinite' && isLoadingMore && (\n        <InfiniteScrollLoading />\n      )}\n\n      {/* End of List Indicator for Infinite Scroll */}\n      {paginationMode === 'infinite' && !hasMoreUsers && users.length > 0 && (\n        <InfiniteScrollEnd />\n      )}\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":165,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/modals/TimeoutModal.tsx":{
    "content":"'use client';\n\nimport React, { useCallback, useState } from 'react';\nimport './TimeoutModal.css';\n\ninterface TimeoutModalProps {\n  user: {\n    id: string;\n    name: string | null;\n    email: string | null;\n  };\n  isOpen: boolean;\n  onClose: () => void;\n  onTimeout: (userId: string, options: TimeoutOptions) => Promise<void>;\n}\n\nexport interface TimeoutOptions {\n  timeoutType: 'post_creation' | 'comment_creation' | 'full_access';\n  reason: string;\n  durationHours: number;\n  customDuration?: {\n    days: number;\n    hours: number;\n    minutes: number;\n  };\n}\n\nconst TIMEOUT_PRESETS = [\n  { label: '1 Hour', hours: 1 },\n  { label: '6 Hours', hours: 6 },\n  { label: '24 Hours (1 Day)', hours: 24 },\n  { label: '72 Hours (3 Days)', hours: 72 },\n  { label: '168 Hours (1 Week)', hours: 168 },\n  { label: '720 Hours (30 Days)', hours: 720 },\n  { label: 'Custom', hours: 0 }\n];\n\nconst TIMEOUT_TYPES = [\n  {\n    value: 'post_creation' as const,\n    label: 'Post Creation',\n    description: 'User cannot create new posts'\n  },\n  {\n    value: 'comment_creation' as const,\n    label: 'Comment Creation',\n    description: 'User cannot create comments or replies'\n  },\n  {\n    value: 'full_access' as const,\n    label: 'Full Access',\n    description: 'User cannot perform any actions'\n  }\n];\n\nconst COMMON_REASONS = [\n  'Violation of community guidelines',\n  'Spam or excessive posting',\n  'Inappropriate content',\n  'Harassment or abuse',\n  'Multiple rule violations',\n  'Temporary cooling off period',\n  'Administrative action'\n];\n\nexport function TimeoutModal({\n  user,\n  isOpen,\n  onClose,\n  onTimeout\n}: TimeoutModalProps) {\n  const [timeoutType, setTimeoutType] =\n    useState<TimeoutOptions['timeoutType']>('post_creation');\n  const [reason, setReason] = useState('');\n  const [selectedPreset, setSelectedPreset] = useState(24); // Default to 24 hours\n  const [customDays, setCustomDays] = useState(0);\n  const [customHours, setCustomHours] = useState(1);\n  const [customMinutes, setCustomMinutes] = useState(0);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const isCustomDuration = selectedPreset === 0;\n  const totalHours = isCustomDuration\n    ? customDays * 24 + customHours + customMinutes / 60\n    : selectedPreset;\n\n  const handleSubmit = useCallback(\n    async (e: React.FormEvent) => {\n      e.preventDefault();\n\n      if (!reason.trim()) {\n        setError('Please provide a reason for the timeout');\n        return;\n      }\n\n      if (totalHours <= 0) {\n        setError('Duration must be greater than 0');\n        return;\n      }\n\n      if (totalHours > 8760) {\n        // 1 year max\n        setError('Duration cannot exceed 1 year (8760 hours)');\n        return;\n      }\n\n      setIsSubmitting(true);\n      setError(null);\n\n      try {\n        const options: TimeoutOptions = {\n          timeoutType,\n          reason: reason.trim(),\n          durationHours: totalHours,\n          ...(isCustomDuration && {\n            customDuration: {\n              days: customDays,\n              hours: customHours,\n              minutes: customMinutes\n            }\n          })\n        };\n\n        await onTimeout(user.id, options);\n        handleClose();\n      } catch (err) {\n        setError(\n          err instanceof Error ? err.message : 'Failed to issue timeout'\n        );\n      } finally {\n        setIsSubmitting(false);\n      }\n    },\n    [\n      user.id,\n      timeoutType,\n      reason,\n      totalHours,\n      isCustomDuration,\n      customDays,\n      customHours,\n      customMinutes,\n      onTimeout\n    ]\n  );\n\n  const handleClose = useCallback(() => {\n    if (isSubmitting) return;\n\n    // Reset form\n    setTimeoutType('post_creation');\n    setReason('');\n    setSelectedPreset(24);\n    setCustomDays(0);\n    setCustomHours(1);\n    setCustomMinutes(0);\n    setError(null);\n    onClose();\n  }, [isSubmitting, onClose]);\n\n  const formatDuration = useCallback(() => {\n    if (totalHours <= 0) return 'Invalid duration';\n\n    const days = Math.floor(totalHours / 24);\n    const hours = Math.floor(totalHours % 24);\n    const minutes = Math.round((totalHours % 1) * 60);\n\n    const parts = [];\n    if (days > 0) parts.push(`${days} day${days !== 1 ? 's' : ''}`);\n    if (hours > 0) parts.push(`${hours} hour${hours !== 1 ? 's' : ''}`);\n    if (minutes > 0 && days === 0)\n      parts.push(`${minutes} minute${minutes !== 1 ? 's' : ''}`);\n\n    return parts.join(', ') || '0 minutes';\n  }, [totalHours]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\\\"timeout-modal-overlay\\\" onClick={handleClose}>\n      <div className=\\\"timeout-modal\\\" onClick={(e) => e.stopPropagation()}>\n        <div className=\\\"timeout-modal__header\\\">\n          <h2 className=\\\"timeout-modal__title\\\">Issue Timeout</h2>\n          <button\n            type=\\\"button\\\"\n            className=\\\"timeout-modal__close\\\"\n            onClick={handleClose}\n            disabled={isSubmitting}\n          >\n            \u2715\n          </button>\n        </div>\n\n        <div className=\\\"timeout-modal__user-info\\\">\n          <strong>User:</strong> {user.name || 'Unknown'} ({user.email})\n        </div>\n\n        <form onSubmit={handleSubmit} className=\\\"timeout-modal__form\\\">\n          {/* Timeout Type */}\n          <div className=\\\"timeout-modal__field\\\">\n            <label className=\\\"timeout-modal__label\\\">\n              Timeout Type <span className=\\\"required\\\">*</span>\n            </label>\n            <div className=\\\"timeout-modal__radio-group\\\">\n              {TIMEOUT_TYPES.map((type) => (\n                <label key={type.value} className=\\\"timeout-modal__radio-item\\\">\n                  <input\n                    type=\\\"radio\\\"\n                    name=\\\"timeoutType\\\"\n                    value={type.value}\n                    checked={timeoutType === type.value}\n                    onChange={(e) =>\n                      setTimeoutType(\n                        e.target.value as TimeoutOptions['timeoutType']\n                      )\n                    }\n                    disabled={isSubmitting}\n                  />\n                  <div className=\\\"timeout-modal__radio-content\\\">\n                    <div className=\\\"timeout-modal__radio-label\\\">\n                      {type.label}\n                    </div>\n                    <div className=\\\"timeout-modal__radio-description\\\">\n                      {type.description}\n                    </div>\n                  </div>\n                </label>\n              ))}\n            </div>\n          </div>\n\n          {/* Duration */}\n          <div className=\\\"timeout-modal__field\\\">\n            <label className=\\\"timeout-modal__label\\\">\n              Duration <span className=\\\"required\\\">*</span>\n            </label>\n            <div className=\\\"timeout-modal__duration-presets\\\">\n              {TIMEOUT_PRESETS.map((preset) => (\n                <button\n                  key={preset.hours}\n                  type=\\\"button\\\"\n                  className={`timeout-modal__preset ${selectedPreset === preset.hours ? 'active' : ''}`}\n                  onClick={() => setSelectedPreset(preset.hours)}\n                  disabled={isSubmitting}\n                >\n                  {preset.label}\n                </button>\n              ))}\n            </div>\n\n            {isCustomDuration && (\n              <div className=\\\"timeout-modal__custom-duration\\\">\n                <div className=\\\"timeout-modal__duration-inputs\\\">\n                  <div className=\\\"timeout-modal__duration-input\\\">\n                    <label>Days</label>\n                    <input\n                      type=\\\"number\\\"\n                      min=\\\"0\\\"\n                      max=\\\"365\\\"\n                      value={customDays}\n                      onChange={(e) =>\n                        setCustomDays(parseInt(e.target.value) || 0)\n                      }\n                      disabled={isSubmitting}\n                    />\n                  </div>\n                  <div className=\\\"timeout-modal__duration-input\\\">\n                    <label>Hours</label>\n                    <input\n                      type=\\\"number\\\"\n                      min=\\\"0\\\"\n                      max=\\\"23\\\"\n                      value={customHours}\n                      onChange={(e) =>\n                        setCustomHours(parseInt(e.target.value) || 0)\n                      }\n                      disabled={isSubmitting}\n                    />\n                  </div>\n                  <div className=\\\"timeout-modal__duration-input\\\">\n                    <label>Minutes</label>\n                    <input\n                      type=\\\"number\\\"\n                      min=\\\"0\\\"\n                      max=\\\"59\\\"\n                      value={customMinutes}\n                      onChange={(e) =>\n                        setCustomMinutes(parseInt(e.target.value) || 0)\n                      }\n                      disabled={isSubmitting}\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\\\"timeout-modal__duration-preview\\\">\n              <strong>Total Duration:</strong> {formatDuration()}\n              {totalHours > 0 && (\n                <span className=\\\"timeout-modal__expires\\\">\n                  {' '}\n                  (Expires:{' '}\n                  {new Date(\n                    Date.now() + totalHours * 60 * 60 * 1000\n                  ).toLocaleString()}\n                  )\n                </span>\n              )}\n            </div>\n          </div>\n\n          {/* Reason */}\n          <div className=\\\"timeout-modal__field\\\">\n            <label className=\\\"timeout-modal__label\\\" htmlFor=\\\"timeout-reason\\\">\n              Reason <span className=\\\"required\\\">*</span>\n            </label>\n            <div className=\\\"timeout-modal__reason-presets\\\">\n              {COMMON_REASONS.map((commonReason) => (\n                <button\n                  key={commonReason}\n                  type=\\\"button\\\"\n                  className=\\\"timeout-modal__reason-preset\\\"\n                  onClick={() => setReason(commonReason)}\n                  disabled={isSubmitting}\n                >\n                  {commonReason}\n                </button>\n              ))}\n            </div>\n            <textarea\n              id=\\\"timeout-reason\\\"\n              value={reason}\n              onChange={(e) => setReason(e.target.value)}\n              placeholder=\\\"Enter the reason for this timeout...\\\"\n              rows={3}\n              className=\\\"timeout-modal__textarea\\\"\n              disabled={isSubmitting}\n              required\n            />\n          </div>\n\n          {error && <div className=\\\"timeout-modal__error\\\">{error}</div>}\n\n          <div className=\\\"timeout-modal__actions\\\">\n            <button\n              type=\\\"button\\\"\n              onClick={handleClose}\n              className=\\\"timeout-modal__cancel\\\"\n              disabled={isSubmitting}\n            >\n              Cancel\n            </button>\n            <button\n              type=\\\"submit\\\"\n              className=\\\"timeout-modal__submit\\\"\n              disabled={isSubmitting || !reason.trim() || totalHours <= 0}\n            >\n              {isSubmitting ? 'Issuing Timeout...' : 'Issue Timeout'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":366,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/modals/AssignSubscriptionModal.tsx":{
    "content":"'use client';\n\nimport React, { useCallback, useEffect, useState } from 'react';\nimport './AssignSubscriptionModal.css';\n\n// ================================\n// TYPES & INTERFACES\n// ================================\n\ninterface SubscriptionPlan {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  plan_type: 'tier' | 'addon' | 'bundle';\n  price_monthly_cents?: number;\n  price_yearly_cents?: number;\n  price_lifetime_cents?: number;\n  is_active: boolean;\n}\n\ninterface AssignSubscriptionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onAssign: (\n    planId: string,\n    billingCycle: string,\n    expiresAt?: string,\n    reason?: string\n  ) => Promise<void>;\n  userName: string;\n  userId: string;\n}\n\nexport const AssignSubscriptionModal: React.FC<\n  AssignSubscriptionModalProps\n> = ({ isOpen, onClose, onAssign, userName, userId }) => {\n  // ================================\n  // STATE MANAGEMENT\n  // ================================\n\n  const [subscriptionPlans, setSubscriptionPlans] = useState<\n    SubscriptionPlan[]\n  >([]);\n  const [loading, setLoading] = useState(true);\n  const [assigning, setAssigning] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Form state\n  const [selectedPlanId, setSelectedPlanId] = useState<string>('');\n  const [billingCycle, setBillingCycle] = useState<string>('monthly');\n  const [expiresAt, setExpiresAt] = useState<string>('');\n  const [reason, setReason] = useState<string>('');\n  const [hasExpiration, setHasExpiration] = useState<boolean>(false);\n\n  // ================================\n  // DATA FETCHING\n  // ================================\n\n  const fetchSubscriptionPlans = useCallback(async () => {\n    try {\n      setError(null);\n      const response = await fetch('/api/admin/subscription-plans');\n\n      if (!response.ok) {\n        throw new Error(\n          `Failed to fetch subscription plans: ${response.status}`\n        );\n      }\n\n      const plans = await response.json();\n      setSubscriptionPlans(\n        plans.filter((plan: SubscriptionPlan) => plan.is_active)\n      );\n    } catch (error) {\n      console.error('Error fetching subscription plans:', error);\n      setError(\n        error instanceof Error\n          ? error.message\n          : 'Failed to fetch subscription plans'\n      );\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchSubscriptionPlans();\n    }\n  }, [isOpen, fetchSubscriptionPlans]);\n\n  // ================================\n  // FORM VALIDATION\n  // ================================\n\n  const validateForm = (): string | null => {\n    if (!selectedPlanId) {\n      return 'Please select a subscription plan';\n    }\n\n    if (!billingCycle) {\n      return 'Please select a billing cycle';\n    }\n\n    if (hasExpiration && !expiresAt) {\n      return 'Please set an expiration date';\n    }\n\n    if (hasExpiration && expiresAt) {\n      const expirationDate = new Date(expiresAt);\n      const now = new Date();\n      if (expirationDate <= now) {\n        return 'Expiration date must be in the future';\n      }\n    }\n\n    return null;\n  };\n\n  // ================================\n  // EVENT HANDLERS\n  // ================================\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    const validationError = validateForm();\n    if (validationError) {\n      setError(validationError);\n      return;\n    }\n\n    setAssigning(true);\n    setError(null);\n\n    try {\n      await onAssign(\n        selectedPlanId,\n        billingCycle,\n        hasExpiration ? expiresAt : undefined,\n        reason || undefined\n      );\n\n      // Reset form and close modal\n      resetForm();\n      onClose();\n    } catch (error) {\n      console.error('Error assigning subscription:', error);\n      setError(\n        error instanceof Error ? error.message : 'Failed to assign subscription'\n      );\n    } finally {\n      setAssigning(false);\n    }\n  };\n\n  const resetForm = () => {\n    setSelectedPlanId('');\n    setBillingCycle('monthly');\n    setExpiresAt('');\n    setReason('');\n    setHasExpiration(false);\n    setError(null);\n  };\n\n  const handleClose = () => {\n    if (!assigning) {\n      resetForm();\n      onClose();\n    }\n  };\n\n  // ================================\n  // HELPER FUNCTIONS\n  // ================================\n\n  const formatPrice = (cents?: number) => {\n    if (!cents || cents === 0) return 'Free';\n    return `$${(cents / 100).toFixed(2)}`;\n  };\n\n  const getSelectedPlan = () => {\n    return subscriptionPlans.find((plan) => plan.id === selectedPlanId);\n  };\n\n  const getBillingCycleOptions = (): Array<{\n    value: string;\n    label: string;\n  }> => {\n    const selectedPlan = getSelectedPlan();\n    if (!selectedPlan) return [];\n\n    const options: Array<{ value: string; label: string }> = [];\n\n    if (selectedPlan.price_monthly_cents !== undefined) {\n      options.push({\n        value: 'monthly',\n        label: `Monthly - ${formatPrice(selectedPlan.price_monthly_cents)}/month`\n      });\n    }\n\n    if (selectedPlan.price_yearly_cents !== undefined) {\n      options.push({\n        value: 'yearly',\n        label: `Yearly - ${formatPrice(selectedPlan.price_yearly_cents)}/year`\n      });\n    }\n\n    if (selectedPlan.price_lifetime_cents !== undefined) {\n      options.push({\n        value: 'lifetime',\n        label: `Lifetime - ${formatPrice(selectedPlan.price_lifetime_cents)} once`\n      });\n    }\n\n    if (options.length === 0 && selectedPlan.name === 'free') {\n      options.push({\n        value: 'free',\n        label: 'Free Plan'\n      });\n    }\n\n    return options;\n  };\n\n  // ================================\n  // RENDER HELPERS\n  // ================================\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\\\"modal-overlay\\\" onClick={handleClose}>\n      <div className=\\\"modal-content\\\" onClick={(e) => e.stopPropagation()}>\n        <div className=\\\"modal-header\\\">\n          <h3>Assign Subscription</h3>\n          <button\n            className=\\\"modal-close\\\"\n            onClick={handleClose}\n            disabled={assigning}\n          >\n            \u2715\n          </button>\n        </div>\n\n        <div className=\\\"modal-body\\\">\n          {loading ? (\n            <div className=\\\"loading-state\\\">\n              <div className=\\\"loading-spinner\\\"></div>\n              <p>Loading subscription plans...</p>\n            </div>\n          ) : (\n            <>\n              <div className=\\\"user-info\\\">\n                <h4>\ud83d\udc64 Assigning to:</h4>\n                <p>\n                  <strong>{userName}</strong>\n                </p>\n                <p className=\\\"user-id\\\">User ID: {userId}</p>\n              </div>\n\n              {error && (\n                <div className=\\\"error-message\\\">\n                  <span>\u274c {error}</span>\n                </div>\n              )}\n\n              <form onSubmit={handleSubmit}>\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"subscription-plan\\\">\n                    \ud83d\udccb Subscription Plan <span className=\\\"required\\\">*</span>\n                  </label>\n                  <select\n                    id=\\\"subscription-plan\\\"\n                    value={selectedPlanId}\n                    onChange={(e) => {\n                      setSelectedPlanId(e.target.value);\n                      setBillingCycle(''); // Reset billing cycle when plan changes\n                    }}\n                    required\n                    disabled={assigning}\n                  >\n                    <option value=\\\"\\\">Select a plan...</option>\n                    {subscriptionPlans.map((plan) => (\n                      <option key={plan.id} value={plan.id}>\n                        {plan.display_name} ({plan.plan_type})\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                {selectedPlanId && (\n                  <div className=\\\"form-group\\\">\n                    <label htmlFor=\\\"billing-cycle\\\">\n                      \ud83d\udcb3 Billing Cycle <span className=\\\"required\\\">*</span>\n                    </label>\n                    <select\n                      id=\\\"billing-cycle\\\"\n                      value={billingCycle}\n                      onChange={(e) => setBillingCycle(e.target.value)}\n                      required\n                      disabled={assigning}\n                    >\n                      <option value=\\\"\\\">Select billing cycle...</option>\n                      {getBillingCycleOptions().map((option) => (\n                        <option key={option.value} value={option.value}>\n                          {option.label}\n                        </option>\n                      ))}\n                    </select>\n                  </div>\n                )}\n\n                <div className=\\\"form-group\\\">\n                  <label className=\\\"checkbox-label\\\">\n                    <input\n                      type=\\\"checkbox\\\"\n                      checked={hasExpiration}\n                      onChange={(e) => setHasExpiration(e.target.checked)}\n                      disabled={assigning}\n                    />\n                    \ud83d\udcc5 Set expiration date\n                  </label>\n                </div>\n\n                {hasExpiration && (\n                  <div className=\\\"form-group\\\">\n                    <label htmlFor=\\\"expires-at\\\">\n                      Expires At <span className=\\\"required\\\">*</span>\n                    </label>\n                    <input\n                      type=\\\"datetime-local\\\"\n                      id=\\\"expires-at\\\"\n                      value={expiresAt}\n                      onChange={(e) => setExpiresAt(e.target.value)}\n                      required={hasExpiration}\n                      disabled={assigning}\n                    />\n                  </div>\n                )}\n\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"reason\\\">\ud83d\udcdd Assignment Reason</label>\n                  <textarea\n                    id=\\\"reason\\\"\n                    value={reason}\n                    onChange={(e) => setReason(e.target.value)}\n                    placeholder=\\\"Optional reason for this assignment...\\\"\n                    rows={3}\n                    disabled={assigning}\n                  />\n                </div>\n\n                <div className=\\\"form-actions\\\">\n                  <button\n                    type=\\\"button\\\"\n                    className=\\\"btn btn-secondary\\\"\n                    onClick={handleClose}\n                    disabled={assigning}\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    type=\\\"submit\\\"\n                    className=\\\"btn btn-primary\\\"\n                    disabled={assigning || !selectedPlanId}\n                  >\n                    {assigning ? '\ud83d\udd04 Assigning...' : '\u2705 Assign Subscription'}\n                  </button>\n                </div>\n              </form>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":380,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/modals/UserDetailsModal.tsx":{
    "content":"'use client';\n\nimport React from 'react';\nimport { Avatar } from '../../../components/avatar/Avatar';\n\ninterface UserRole {\n  id: string;\n  name: string;\n  display_name: string;\n  assigned_at: string;\n  expires_at?: string | null;\n  reason?: string | null;\n}\n\ninterface UserSubscription {\n  id: string;\n  service_name: string;\n  plan_name: string;\n  status: string;\n  expires_at: string | null;\n}\n\ninterface UserTimeout {\n  id: string;\n  reason: string;\n  expires_at: string;\n  created_at: string;\n  is_active: boolean;\n}\n\ninterface User {\n  id: string;\n  name: string | null;\n  email: string | null;\n  image: string | null;\n  created_at: string;\n  provider_name?: string | null;\n  is_timed_out?: boolean;\n  active_timeout_id?: number | null;\n  active_timeout_reason?: string | null;\n  timeout_expires?: string | null;\n  profile_public?: boolean;\n  bio?: string | null;\n  location?: string | null;\n  role_names?: string | null;\n  has_admin?: boolean;\n  has_moderator?: boolean;\n  roles?: UserRole[];\n  subscriptions?: UserSubscription[];\n  timeouts?: UserTimeout[];\n}\n\ninterface UserDetailsModalProps {\n  user: User;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport const UserDetailsModal: React.FC<UserDetailsModalProps> = ({\n  user,\n  isOpen,\n  onClose\n}) => {\n  if (!isOpen || !user) return null;\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const formatDateOnly = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const getStatusBadge = () => {\n    if (user.is_timed_out) {\n      return <span className=\\\"timeout-status active\\\">\u23f0 Timed Out</span>;\n    }\n    return <span className=\\\"status-badge active\\\">\u2705 Active</span>;\n  };\n\n  return (\n    <div className=\\\"modal-overlay\\\" onClick={onClose}>\n      <div\n        className=\\\"modal-content modal-content--large\\\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Modal Header */}\n        <div className=\\\"modal-header\\\">\n          <div className=\\\"modal-user-info\\\">\n            <div className=\\\"modal-user-avatars\\\">\n              {/* Provider account image */}\n              {user.image && (\n                <img\n                  src={user.image}\n                  alt=\\\"Provider avatar\\\"\n                  className=\\\"modal-provider-avatar\\\"\n                />\n              )}\n              {/* Seeded avatar */}\n              <Avatar seed={user.id} size=\\\"lg\\\" />\n            </div>\n            <div className=\\\"modal-user-details\\\">\n              <h3>{user.name || 'Unnamed User'}</h3>\n              <p>{user.email}</p>\n              <p className=\\\"user-id-display\\\">ID: {user.id}</p>\n            </div>\n          </div>\n          <button className=\\\"modal-close-btn\\\" onClick={onClose}>\n            \u2715\n          </button>\n        </div>\n\n        {/* Modal Body */}\n        <div className=\\\"modal-body\\\">\n          <div className=\\\"user-details-grid\\\">\n            {/* Basic Information Section */}\n            <div className=\\\"detail-section\\\">\n              <h4>\ud83d\udc64 Basic Information</h4>\n              <div className=\\\"detail-item\\\">\n                <label>Status:</label>\n                <span>{getStatusBadge()}</span>\n              </div>\n              <div className=\\\"detail-item\\\">\n                <label>Name:</label>\n                <span>{user.name || 'Not provided'}</span>\n              </div>\n              <div className=\\\"detail-item\\\">\n                <label>Email:</label>\n                <span>{user.email}</span>\n              </div>\n              <div className=\\\"detail-item\\\">\n                <label>Provider:</label>\n                <span>{user.provider_name || 'Not Available'}</span>\n              </div>\n              <div className=\\\"detail-item\\\">\n                <label>Joined:</label>\n                <span>{formatDate(user.created_at)}</span>\n              </div>\n              {user.location && (\n                <div className=\\\"detail-item\\\">\n                  <label>Location:</label>\n                  <span>{user.location}</span>\n                </div>\n              )}\n              <div className=\\\"detail-item\\\">\n                <label>Profile Public:</label>\n                <span>{user.profile_public ? 'Yes' : 'No'}</span>\n              </div>\n            </div>\n\n            {/* Bio Section */}\n            {user.bio && (\n              <div className=\\\"detail-section\\\">\n                <h4>\ud83d\udcdd Bio</h4>\n                <div className=\\\"bio-content\\\">\n                  <p>{user.bio}</p>\n                </div>\n              </div>\n            )}\n\n            {/* Roles Section */}\n            <div className=\\\"detail-section\\\">\n              <h4>\ud83c\udfad Roles & Permissions</h4>\n              <div className=\\\"roles-management\\\">\n                {user.roles && user.roles.length > 0 ? (\n                  user.roles.map((role) => (\n                    <div key={role.id} className=\\\"role-item\\\">\n                      <div>\n                        <strong>{role.display_name}</strong>\n                        <div className=\\\"role-date\\\">\n                          Assigned: {formatDateOnly(role.assigned_at)}\n                          {role.expires_at && (\n                            <span>\n                              {' '}\n                              \u2022 Expires: {formatDateOnly(role.expires_at)}\n                            </span>\n                          )}\n                          {role.reason && <span> \u2022 Reason: {role.reason}</span>}\n                        </div>\n                      </div>\n                    </div>\n                  ))\n                ) : (\n                  <div className=\\\"no-data\\\">No roles assigned</div>\n                )}\n              </div>\n            </div>\n\n            {/* Subscriptions Section */}\n            <div className=\\\"detail-section\\\">\n              <h4>\ud83d\udc8e Subscriptions</h4>\n              <div className=\\\"subscriptions-management\\\">\n                {user.subscriptions && user.subscriptions.length > 0 ? (\n                  user.subscriptions.map((subscription) => (\n                    <div key={subscription.id} className=\\\"subscription-item\\\">\n                      <div>\n                        <strong>{subscription.plan_name}</strong>\n                        <div className=\\\"subscription-meta\\\">\n                          <span\n                            className={`subscription-status ${subscription.status}`}\n                          >\n                            {subscription.status.toUpperCase()}\n                          </span>\n                          <div className=\\\"subscription-details\\\">\n                            <span>Service: {subscription.service_name}</span>\n                            {subscription.expires_at && (\n                              <span>\n                                Expires:{' '}\n                                {formatDateOnly(subscription.expires_at)}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))\n                ) : (\n                  <div className=\\\"no-data\\\">No active subscriptions</div>\n                )}\n              </div>\n            </div>\n\n            {/* Timeout Information */}\n            {user.is_timed_out && (\n              <div className=\\\"detail-section\\\">\n                <h4>\u23f0 Current Timeout</h4>\n                <div className=\\\"timeout-info-detailed\\\">\n                  <div className=\\\"detail-item\\\">\n                    <label>Status:</label>\n                    <span className=\\\"timeout-status active\\\">Active</span>\n                  </div>\n                  {user.active_timeout_reason && (\n                    <div className=\\\"detail-item\\\">\n                      <label>Reason:</label>\n                      <span>{user.active_timeout_reason}</span>\n                    </div>\n                  )}\n                  {user.timeout_expires && (\n                    <div className=\\\"detail-item\\\">\n                      <label>Expires:</label>\n                      <span>{formatDate(user.timeout_expires)}</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {/* Timeout History */}\n            {user.timeouts && user.timeouts.length > 0 && (\n              <div className=\\\"detail-section\\\">\n                <h4>\ud83d\udccb Timeout History</h4>\n                <div className=\\\"timeouts-management\\\">\n                  {user.timeouts.map((timeout) => (\n                    <div key={timeout.id} className=\\\"timeout-item\\\">\n                      <div>\n                        <strong>{timeout.reason}</strong>\n                        <div className=\\\"timeout-details\\\">\n                          <span\n                            className={`timeout-status ${timeout.is_active ? 'active' : 'expired'}`}\n                          >\n                            {timeout.is_active ? 'Active' : 'Expired'}\n                          </span>\n                          <div className=\\\"timeout-date\\\">\n                            Created: {formatDateOnly(timeout.created_at)}\n                            <br />\n                            Expires: {formatDateOnly(timeout.expires_at)}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Modal Footer */}\n        <div className=\\\"modal-footer\\\">\n          <div className=\\\"modal-actions\\\">\n            <button\n              type=\\\"button\\\"\n              className=\\\"btn btn--secondary\\\"\n              onClick={onClose}\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":304,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/modals/AssignRoleModal.tsx":{
    "content":"'use client';\n\nimport React, { useEffect, useState } from 'react';\n\nexport interface Role {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n}\n\nexport interface AssignRoleModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onAssign: (\n    roleId: string,\n    expiresAt?: string,\n    reason?: string\n  ) => Promise<void>;\n  userName: string;\n  userId: string;\n  currentRoles?: Role[];\n}\n\nexport const AssignRoleModal: React.FC<AssignRoleModalProps> = ({\n  isOpen,\n  onClose,\n  onAssign,\n  userName,\n  userId,\n  currentRoles = []\n}) => {\n  const [selectedRole, setSelectedRole] = useState('');\n  const [expiresAt, setExpiresAt] = useState('');\n  const [reason, setReason] = useState('');\n  const [availableRoles, setAvailableRoles] = useState<Role[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // Load available roles\n  useEffect(() => {\n    if (isOpen) {\n      loadAvailableRoles();\n    }\n  }, [isOpen]);\n\n  const loadAvailableRoles = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch('/api/admin/roles');\n      if (response.ok) {\n        const roles = await response.json();\n        // Filter out roles the user already has\n        const currentRoleIds = currentRoles.map((r) => r.id);\n        const filteredRoles = roles.filter(\n          (role: Role) => !currentRoleIds.includes(role.id)\n        );\n        setAvailableRoles(filteredRoles);\n      }\n    } catch (error) {\n      console.error('Failed to load roles:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedRole) return;\n\n    setIsSubmitting(true);\n    try {\n      await onAssign(selectedRole, expiresAt || undefined, reason || undefined);\n      handleClose();\n    } catch (error) {\n      console.error('Failed to assign role:', error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleClose = () => {\n    setSelectedRole('');\n    setExpiresAt('');\n    setReason('');\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\\\"modal-overlay\\\" onClick={handleClose}>\n      <div\n        className=\\\"modal-content\\\"\n        onClick={(e) => e.stopPropagation()}\n        style={{ maxWidth: '500px' }}\n      >\n        <div className=\\\"modal-header\\\">\n          <div>\n            <h3>\ud83c\udfad Assign Role to {userName}</h3>\n            <p\n              style={{\n                margin: '4px 0 0 0',\n                color: 'var(--text-secondary)',\n                fontSize: '0.9rem'\n              }}\n            >\n              ID: {userId}\n            </p>\n          </div>\n          <button className=\\\"modal-close-btn\\\" onClick={handleClose}>\n            \u2715\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit}>\n          <div className=\\\"modal-body\\\">\n            {loading ? (\n              <div\n                style={{\n                  display: 'flex',\n                  justifyContent: 'center',\n                  padding: '2rem'\n                }}\n              >\n                <div className=\\\"loading-spinner\\\"></div>\n              </div>\n            ) : (\n              <div\n                style={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: '1rem'\n                }}\n              >\n                {/* Role Selection */}\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"role-select\\\">Role *</label>\n                  <select\n                    id=\\\"role-select\\\"\n                    value={selectedRole}\n                    onChange={(e) => setSelectedRole(e.target.value)}\n                    required\n                    className=\\\"admin-select\\\"\n                  >\n                    <option value=\\\"\\\">Select a role...</option>\n                    {availableRoles.map((role) => (\n                      <option key={role.id} value={role.id}>\n                        {role.display_name} ({role.name})\n                      </option>\n                    ))}\n                  </select>\n                  {availableRoles.length === 0 && !loading && (\n                    <div className=\\\"form-help\\\">\n                      No additional roles available for this user.\n                    </div>\n                  )}\n                </div>\n\n                {/* Role Description */}\n                {selectedRole && (\n                  <div\n                    style={{\n                      padding: '12px',\n                      background: 'var(--light-background--secondary)',\n                      borderRadius: '6px',\n                      fontSize: '0.9rem'\n                    }}\n                  >\n                    <strong>Role Description:</strong>\n                    <br />\n                    {availableRoles.find((r) => r.id === selectedRole)\n                      ?.description || 'No description available.'}\n                  </div>\n                )}\n\n                {/* Expiration Date */}\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"expires-at\\\">Expires At (Optional)</label>\n                  <input\n                    type=\\\"datetime-local\\\"\n                    id=\\\"expires-at\\\"\n                    value={expiresAt}\n                    onChange={(e) => setExpiresAt(e.target.value)}\n                    min={new Date().toISOString().slice(0, 16)}\n                    style={{\n                      padding: '8px 12px',\n                      border: '2px solid var(--light-background--tertiary)',\n                      borderRadius: '6px',\n                      fontSize: '14px',\n                      width: '100%'\n                    }}\n                  />\n                  <div className=\\\"form-help\\\">\n                    Leave empty for permanent role assignment.\n                  </div>\n                </div>\n\n                {/* Reason */}\n                <div className=\\\"form-group\\\">\n                  <label htmlFor=\\\"reason\\\">Reason (Optional)</label>\n                  <textarea\n                    id=\\\"reason\\\"\n                    value={reason}\n                    onChange={(e) => setReason(e.target.value)}\n                    placeholder=\\\"Reason for role assignment...\\\"\n                    rows={3}\n                    style={{\n                      padding: '8px 12px',\n                      border: '2px solid var(--light-background--tertiary)',\n                      borderRadius: '6px',\n                      fontSize: '14px',\n                      width: '100%',\n                      resize: 'vertical',\n                      fontFamily: 'inherit'\n                    }}\n                  />\n                </div>\n\n                {/* Current Roles Display */}\n                {currentRoles.length > 0 && (\n                  <div>\n                    <label style={{ marginBottom: '8px', display: 'block' }}>\n                      Current Roles:\n                    </label>\n                    <div\n                      style={{ display: 'flex', gap: '4px', flexWrap: 'wrap' }}\n                    >\n                      {currentRoles.map((role) => (\n                        <span key={role.id} className=\\\"role-badge\\\">\n                          {role.display_name}\n                        </span>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          <div className=\\\"modal-footer\\\">\n            <div className=\\\"modal-actions\\\">\n              <button\n                type=\\\"button\\\"\n                className=\\\"btn btn--secondary\\\"\n                onClick={handleClose}\n                disabled={isSubmitting}\n              >\n                Cancel\n              </button>\n              <button\n                type=\\\"submit\\\"\n                className=\\\"btn btn--primary\\\"\n                disabled={!selectedRole || isSubmitting || loading}\n              >\n                {isSubmitting ? '\ud83d\udd04 Assigning...' : '\ud83c\udfad Assign Role'}\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n",
    "language":"typescript",
    "lines":265,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/modals/EditPlanModal.tsx":{
    "content":"'use client';\n\nimport React, { useState } from 'react';\nimport { useOverlay } from '../../../../lib/context/OverlayContext';\nimport './EditPlanModal.css';\n\ninterface Plan {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  plan_type: 'tier' | 'addon' | 'bundle';\n  price_monthly_cents?: number;\n  price_yearly_cents?: number;\n  price_lifetime_cents?: number;\n  is_active: boolean;\n  sort_order: number;\n}\n\ninterface EditPlanModalProps {\n  onSave: (planId: string, updates: Partial<Plan>) => Promise<void>;\n  plan: Plan;\n}\n\nexport function EditPlanModal({ onSave, plan }: EditPlanModalProps) {\n  const { closeOverlay } = useOverlay();\n  const [formData, setFormData] = useState({\n    display_name: plan.display_name,\n    description: plan.description || '',\n    plan_type: plan.plan_type,\n    price_monthly_cents: plan.price_monthly_cents || 0,\n    price_yearly_cents: plan.price_yearly_cents || 0,\n    price_lifetime_cents: plan.price_lifetime_cents || 0,\n    is_active: plan.is_active,\n    sort_order: plan.sort_order\n  });\n\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const updates: Partial<Plan> = {\n        display_name: formData.display_name,\n        description: formData.description,\n        plan_type: formData.plan_type,\n        price_monthly_cents: formData.price_monthly_cents,\n        price_yearly_cents: formData.price_yearly_cents,\n        price_lifetime_cents: formData.price_lifetime_cents,\n        is_active: formData.is_active,\n        sort_order: formData.sort_order\n      };\n\n      await onSave(plan.id, updates);\n      closeOverlay(`edit-plan-modal-${plan.id}`);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to update plan');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const formatCentsTodollars = (cents: number) => {\n    return (cents / 100).toFixed(2);\n  };\n\n  const formatDollarsToCents = (dollars: string) => {\n    return Math.round(parseFloat(dollars || '0') * 100);\n  };\n\n  return (\n    <div className=\\\"edit-plan-modal\\\">\n      <div className=\\\"edit-plan-modal__header\\\">\n        <h2>\u270f\ufe0f Edit Plan: {plan.display_name}</h2>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\\\"edit-plan-modal__form\\\">\n        <div className=\\\"edit-plan-modal__form-grid\\\">\n          <div className=\\\"edit-plan-modal__form-group\\\">\n            <label htmlFor=\\\"display_name\\\" className=\\\"edit-plan-modal__label\\\">\n              Display Name\n            </label>\n            <input\n              type=\\\"text\\\"\n              id=\\\"display_name\\\"\n              value={formData.display_name}\n              onChange={(e) =>\n                setFormData({ ...formData, display_name: e.target.value })\n              }\n              required\n              className=\\\"edit-plan-modal__input\\\"\n              placeholder=\\\"Free Tier\\\"\n            />\n          </div>\n\n          <div className=\\\"edit-plan-modal__form-group\\\">\n            <label htmlFor=\\\"plan_type\\\" className=\\\"edit-plan-modal__label\\\">\n              Plan Type\n            </label>\n            <select\n              id=\\\"plan_type\\\"\n              value={formData.plan_type}\n              onChange={(e) =>\n                setFormData({\n                  ...formData,\n                  plan_type: e.target.value as Plan['plan_type']\n                })\n              }\n              className=\\\"edit-plan-modal__select\\\"\n            >\n              <option value=\\\"tier\\\">Tier</option>\n              <option value=\\\"addon\\\">Add-on</option>\n              <option value=\\\"bundle\\\">Bundle</option>\n            </select>\n          </div>\n\n          <div className=\\\"edit-plan-modal__form-group edit-plan-modal__form-group--full-width\\\">\n            <label htmlFor=\\\"description\\\" className=\\\"edit-plan-modal__label\\\">\n              Description (Optional)\n            </label>\n            <textarea\n              id=\\\"description\\\"\n              value={formData.description}\n              onChange={(e) =>\n                setFormData({ ...formData, description: e.target.value })\n              }\n              className=\\\"edit-plan-modal__textarea\\\"\n              placeholder=\\\"Plan description...\\\"\n              rows={3}\n            />\n          </div>\n\n          <div className=\\\"edit-plan-modal__form-group\\\">\n            <label htmlFor=\\\"price_monthly\\\" className=\\\"edit-plan-modal__label\\\">\n              Monthly Price ($)\n            </label>\n            <input\n              type=\\\"number\\\"\n              id=\\\"price_monthly\\\"\n              value={formatCentsTodollars(formData.price_monthly_cents)}\n              onChange={(e) =>\n                setFormData({\n                  ...formData,\n                  price_monthly_cents: formatDollarsToCents(e.target.value)\n                })\n              }\n              step=\\\"0.01\\\"\n              min=\\\"0\\\"\n              className=\\\"edit-plan-modal__input\\\"\n              placeholder=\\\"0.00\\\"\n            />\n          </div>\n\n          <div className=\\\"edit-plan-modal__form-group\\\">\n            <label htmlFor=\\\"price_yearly\\\" className=\\\"edit-plan-modal__label\\\">\n              Yearly Price ($)\n            </label>\n            <input\n              type=\\\"number\\\"\n              id=\\\"price_yearly\\\"\n              value={formatCentsTodollars(formData.price_yearly_cents)}\n              onChange={(e) =>\n                setFormData({\n                  ...formData,\n                  price_yearly_cents: formatDollarsToCents(e.target.value)\n                })\n              }\n              step=\\\"0.01\\\"\n              min=\\\"0\\\"\n              className=\\\"edit-plan-modal__input\\\"\n              placeholder=\\\"0.00\\\"\n            />\n          </div>\n\n          <div className=\\\"edit-plan-modal__form-group\\\">\n            <label htmlFor=\\\"price_lifetime\\\" className=\\\"edit-plan-modal__label\\\">\n              Lifetime Price ($)\n            </label>\n            <input\n              type=\\\"number\\\"\n              id=\\\"price_lifetime\\\"\n              value={formatCentsTodollars(formData.price_lifetime_cents)}\n              onChange={(e) =>\n                setFormData({\n                  ...formData,\n                  price_lifetime_cents: formatDollarsToCents(e.target.value)\n                })\n              }\n              step=\\\"0.01\\\"\n              min=\\\"0\\\"\n              className=\\\"edit-plan-modal__input\\\"\n              placeholder=\\\"0.00\\\"\n            />\n          </div>\n\n          <div className=\\\"edit-plan-modal__form-group\\\">\n            <label htmlFor=\\\"sort_order\\\" className=\\\"edit-plan-modal__label\\\">\n              Sort Order\n            </label>\n            <input\n              type=\\\"number\\\"\n              id=\\\"sort_order\\\"\n              value={formData.sort_order}\n              onChange={(e) =>\n                setFormData({\n                  ...formData,\n                  sort_order: parseInt(e.target.value)\n                })\n              }\n              min=\\\"0\\\"\n              className=\\\"edit-plan-modal__input\\\"\n              placeholder=\\\"0\\\"\n            />\n          </div>\n\n          <div className=\\\"edit-plan-modal__form-group edit-plan-modal__checkbox-group\\\">\n            <label className=\\\"edit-plan-modal__checkbox-label\\\">\n              <input\n                type=\\\"checkbox\\\"\n                checked={formData.is_active}\n                onChange={(e) =>\n                  setFormData({ ...formData, is_active: e.target.checked })\n                }\n                className=\\\"edit-plan-modal__checkbox\\\"\n              />\n              <span className=\\\"edit-plan-modal__checkbox-text\\\">\n                Plan is active\n              </span>\n            </label>\n          </div>\n        </div>\n\n        {error && (\n          <div className=\\\"edit-plan-modal__error\\\">\n            <span>\u274c {error}</span>\n          </div>\n        )}\n\n        <div className=\\\"edit-plan-modal__actions\\\">\n          <button\n            type=\\\"submit\\\"\n            className=\\\"edit-plan-modal__btn edit-plan-modal__btn--primary\\\"\n            disabled={isLoading}\n          >\n            {isLoading ? '\u23f3 Saving...' : '\ud83d\udcbe Save Changes'}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":256,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/modals/ExportModal.tsx":{
    "content":"'use client';\n\nimport { useCallback, useMemo, useState } from 'react';\nimport './ExportModal.css';\n\ninterface User {\n  id: string;\n  name: string | null;\n  email: string | null;\n  image: string | null;\n  created_at: string;\n  provider_name?: string | null;\n  is_timed_out?: boolean;\n  active_timeout_id?: number | null;\n  active_timeout_reason?: string | null;\n  timeout_expires?: string | null;\n  role_names?: string | null;\n  has_admin?: boolean;\n  has_moderator?: boolean;\n  subscriptions?: Array<{\n    id: string;\n    service_name: string;\n    plan_name: string;\n    status: string;\n    expires_at: string | null;\n  }>;\n}\n\ninterface ExportModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  users: User[];\n  selectedUser?: User | null;\n}\n\ntype ExportFormat = 'csv' | 'html' | 'markdown' | 'json';\ntype ExportScope = 'all' | 'current' | 'selected';\n\nconst EXPORT_FORMATS = [\n  {\n    value: 'csv' as const,\n    label: 'CSV',\n    description: 'Comma-separated values for spreadsheets',\n    icon: '\ud83d\udcca'\n  },\n  {\n    value: 'html' as const,\n    label: 'HTML Table',\n    description: 'Rich HTML table with styling',\n    icon: '\ud83c\udf10'\n  },\n  {\n    value: 'markdown' as const,\n    label: 'Markdown',\n    description: 'Markdown table format',\n    icon: '\ud83d\udcdd'\n  },\n  {\n    value: 'json' as const,\n    label: 'JSON',\n    description: 'Structured JSON data',\n    icon: '\ud83d\udd27'\n  }\n];\n\nconst EXPORT_SCOPES = [\n  {\n    value: 'all' as const,\n    label: 'All Users',\n    description: 'Export all users in the system'\n  },\n  {\n    value: 'current' as const,\n    label: 'Current Page',\n    description: 'Export only users on current page'\n  },\n  {\n    value: 'selected' as const,\n    label: 'Selected User',\n    description: 'Export only the selected user'\n  }\n];\n\nconst DATA_FIELDS = [\n  { key: 'id', label: 'User ID', default: true },\n  { key: 'name', label: 'Name', default: true },\n  { key: 'email', label: 'Email', default: true },\n  { key: 'provider_name', label: 'Provider', default: true },\n  { key: 'role_names', label: 'Roles', default: true },\n  { key: 'is_timed_out', label: 'Timeout Status', default: true },\n  { key: 'active_timeout_reason', label: 'Timeout Reason', default: false },\n  { key: 'timeout_expires', label: 'Timeout Expires', default: false },\n  { key: 'created_at', label: 'Join Date', default: true },\n  { key: 'has_admin', label: 'Is Admin', default: false },\n  { key: 'has_moderator', label: 'Is Moderator', default: false },\n  { key: 'subscriptions', label: 'Subscriptions', default: false }\n];\n\nexport function ExportModal({\n  isOpen,\n  onClose,\n  users,\n  selectedUser\n}: ExportModalProps) {\n  const [format, setFormat] = useState<ExportFormat>('csv');\n  const [scope, setScope] = useState<ExportScope>('current');\n  const [selectedFields, setSelectedFields] = useState<string[]>(\n    DATA_FIELDS.filter((field) => field.default).map((field) => field.key)\n  );\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportPreview, setExportPreview] = useState<string>('');\n  const [showPreview, setShowPreview] = useState(false);\n\n  const exportData = useMemo(() => {\n    switch (scope) {\n      case 'all':\n        return users; // In real implementation, this would fetch all users\n      case 'current':\n        return users;\n      case 'selected':\n        return selectedUser ? [selectedUser] : [];\n      default:\n        return users;\n    }\n  }, [scope, users, selectedUser]);\n\n  const filteredData = useMemo(() => {\n    return exportData.map((user) => {\n      const filtered: any = {};\n      selectedFields.forEach((field) => {\n        switch (field) {\n          case 'subscriptions':\n            filtered[field] =\n              user.subscriptions\n                ?.map((sub) => `${sub.plan_name} (${sub.status})`)\n                .join('; ') || 'None';\n            break;\n          case 'is_timed_out':\n            filtered[field] = user.is_timed_out ? 'Yes' : 'No';\n            break;\n          case 'created_at':\n          case 'timeout_expires':\n            filtered[field] = user[field]\n              ? new Date(user[field]!).toLocaleString()\n              : '';\n            break;\n          default:\n            filtered[field] = user[field as keyof User] || '';\n        }\n      });\n      return filtered;\n    });\n  }, [exportData, selectedFields]);\n\n  const generateExport = useCallback((format: ExportFormat, data: any[]) => {\n    switch (format) {\n      case 'csv':\n        return generateCSV(data);\n      case 'html':\n        return generateHTML(data);\n      case 'markdown':\n        return generateMarkdown(data);\n      case 'json':\n        return generateJSON(data);\n      default:\n        return '';\n    }\n  }, []);\n\n  const generateCSV = (data: any[]) => {\n    if (data.length === 0) return '';\n\n    const headers = Object.keys(data[0]);\n    const csvHeaders = headers.join(',');\n    const csvRows = data.map((row) =>\n      headers\n        .map((header) => {\n          const value = row[header]?.toString() || '';\n          // Escape quotes and wrap in quotes if contains comma or quote\n          if (\n            value.includes(',') ||\n            value.includes('\\\"') ||\n            value.includes('\\\\n')\n          ) {\n            return `\\\"${value.replace(/\\\"/g, '\\\"\\\"')}\\\"`;\n          }\n          return value;\n        })\n        .join(',')\n    );\n\n    return [csvHeaders, ...csvRows].join('\\\\n');\n  };\n\n  const generateHTML = (data: any[]) => {\n    if (data.length === 0) return '<p>No data to export</p>';\n\n    const headers = Object.keys(data[0]);\n    const headerRow = headers\n      .map(\n        (header) =>\n          `<th>${DATA_FIELDS.find((f) => f.key === header)?.label || header}</th>`\n      )\n      .join('');\n\n    const dataRows = data\n      .map(\n        (row) =>\n          `<tr>${headers.map((header) => `<td>${row[header] || ''}</td>`).join('')}</tr>`\n      )\n      .join('');\n\n    return `\n<!DOCTYPE html>\n<html>\n<head>\n    <title>User Export - ${new Date().toLocaleDateString()}</title>\n    <style>\n        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 20px; }\n        table { border-collapse: collapse; width: 100%; margin-top: 20px; }\n        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n        th { background-color: #f5f5f5; font-weight: 600; }\n        tr:nth-child(even) { background-color: #f9f9f9; }\n        .export-info { color: #666; margin-bottom: 20px; }\n    </style>\n</head>\n<body>\n    <h1>User Data Export</h1>\n    <div class=\\\"export-info\\\">\n        <p>Generated on: ${new Date().toLocaleString()}</p>\n        <p>Total records: ${data.length}</p>\n        <p>Export scope: ${EXPORT_SCOPES.find((s) => s.value === scope)?.label}</p>\n    </div>\n    <table>\n        <thead><tr>${headerRow}</tr></thead>\n        <tbody>${dataRows}</tbody>\n    </table>\n</body>\n</html>`;\n  };\n\n  const generateMarkdown = (data: any[]) => {\n    if (data.length === 0) return 'No data to export';\n\n    const headers = Object.keys(data[0]);\n    const headerLabels = headers.map(\n      (header) => DATA_FIELDS.find((f) => f.key === header)?.label || header\n    );\n\n    const headerRow = `| ${headerLabels.join(' | ')} |`;\n    const separatorRow = `| ${headers.map(() => '---').join(' | ')} |`;\n    const dataRows = data.map(\n      (row) =>\n        `| ${headers.map((header) => (row[header] || '').toString().replace(/\\\\|/g, '\\\\\\\\|')).join(' | ')} |`\n    );\n\n    return [\n      `# User Data Export`,\n      ``,\n      `**Generated:** ${new Date().toLocaleString()}  `,\n      `**Records:** ${data.length}  `,\n      `**Scope:** ${EXPORT_SCOPES.find((s) => s.value === scope)?.label}  `,\n      ``,\n      headerRow,\n      separatorRow,\n      ...dataRows\n    ].join('\\\\n');\n  };\n\n  const generateJSON = (data: any[]) => {\n    return JSON.stringify(\n      {\n        exportInfo: {\n          generatedAt: new Date().toISOString(),\n          totalRecords: data.length,\n          exportScope: scope,\n          selectedFields: selectedFields\n        },\n        data: data\n      },\n      null,\n      2\n    );\n  };\n\n  const handlePreview = useCallback(() => {\n    const preview = generateExport(format, filteredData.slice(0, 5)); // Preview first 5 rows\n    setExportPreview(preview);\n    setShowPreview(true);\n  }, [format, filteredData, generateExport]);\n\n  const handleExport = useCallback(async () => {\n    setIsExporting(true);\n\n    try {\n      const content = generateExport(format, filteredData);\n      const timestamp = new Date().toISOString().split('T')[0];\n      const filename = `users-export-${timestamp}.${format === 'html' ? 'html' : format}`;\n\n      // Create and download file\n      const blob = new Blob([content], {\n        type:\n          format === 'csv'\n            ? 'text/csv'\n            : format === 'html'\n              ? 'text/html'\n              : format === 'json'\n                ? 'application/json'\n                : 'text/plain'\n      });\n\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n\n      // Close modal after successful export\n      setTimeout(() => {\n        onClose();\n      }, 1000);\n    } catch (error) {\n      console.error('Export failed:', error);\n    } finally {\n      setIsExporting(false);\n    }\n  }, [format, filteredData, generateExport, onClose]);\n\n  const handleFieldToggle = useCallback((fieldKey: string) => {\n    setSelectedFields((prev) =>\n      prev.includes(fieldKey)\n        ? prev.filter((f) => f !== fieldKey)\n        : [...prev, fieldKey]\n    );\n  }, []);\n\n  const handleSelectAllFields = useCallback(() => {\n    setSelectedFields(DATA_FIELDS.map((f) => f.key));\n  }, []);\n\n  const handleSelectDefaultFields = useCallback(() => {\n    setSelectedFields(DATA_FIELDS.filter((f) => f.default).map((f) => f.key));\n  }, []);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\\\"export-modal-overlay\\\" onClick={onClose}>\n      <div className=\\\"export-modal\\\" onClick={(e) => e.stopPropagation()}>\n        <div className=\\\"export-modal__header\\\">\n          <h2 className=\\\"export-modal__title\\\">Export User Data</h2>\n          <button\n            type=\\\"button\\\"\n            className=\\\"export-modal__close\\\"\n            onClick={onClose}\n            disabled={isExporting}\n          >\n            \u2715\n          </button>\n        </div>\n\n        <div className=\\\"export-modal__content\\\">\n          {/* Export Format Selection */}\n          <div className=\\\"export-modal__section\\\">\n            <h3 className=\\\"export-modal__section-title\\\">Export Format</h3>\n            <div className=\\\"export-format-grid\\\">\n              {EXPORT_FORMATS.map((fmt) => (\n                <label key={fmt.value} className=\\\"export-format-option\\\">\n                  <input\n                    type=\\\"radio\\\"\n                    name=\\\"format\\\"\n                    value={fmt.value}\n                    checked={format === fmt.value}\n                    onChange={(e) => setFormat(e.target.value as ExportFormat)}\n                    disabled={isExporting}\n                  />\n                  <div className=\\\"export-format-content\\\">\n                    <div className=\\\"export-format-header\\\">\n                      <span className=\\\"export-format-icon\\\">{fmt.icon}</span>\n                      <span className=\\\"export-format-label\\\">{fmt.label}</span>\n                    </div>\n                    <span className=\\\"export-format-description\\\">\n                      {fmt.description}\n                    </span>\n                  </div>\n                </label>\n              ))}\n            </div>\n          </div>\n\n          {/* Export Scope Selection */}\n          <div className=\\\"export-modal__section\\\">\n            <h3 className=\\\"export-modal__section-title\\\">Export Scope</h3>\n            <div className=\\\"export-scope-options\\\">\n              {EXPORT_SCOPES.map((scopeOption) => (\n                <label key={scopeOption.value} className=\\\"export-scope-option\\\">\n                  <input\n                    type=\\\"radio\\\"\n                    name=\\\"scope\\\"\n                    value={scopeOption.value}\n                    checked={scope === scopeOption.value}\n                    onChange={(e) => setScope(e.target.value as ExportScope)}\n                    disabled={\n                      isExporting ||\n                      (scopeOption.value === 'selected' && !selectedUser)\n                    }\n                  />\n                  <div className=\\\"export-scope-content\\\">\n                    <span className=\\\"export-scope-label\\\">\n                      {scopeOption.label}\n                    </span>\n                    <span className=\\\"export-scope-description\\\">\n                      {scopeOption.description}\n                    </span>\n                    {scopeOption.value === 'current' && (\n                      <span className=\\\"export-scope-count\\\">\n                        ({users.length} users)\n                      </span>\n                    )}\n                    {scopeOption.value === 'selected' && selectedUser && (\n                      <span className=\\\"export-scope-count\\\">(1 user)</span>\n                    )}\n                  </div>\n                </label>\n              ))}\n            </div>\n          </div>\n\n          {/* Field Selection */}\n          <div className=\\\"export-modal__section\\\">\n            <div className=\\\"export-fields-header\\\">\n              <h3 className=\\\"export-modal__section-title\\\">Select Fields</h3>\n              <div className=\\\"export-fields-actions\\\">\n                <button\n                  type=\\\"button\\\"\n                  className=\\\"export-fields-action\\\"\n                  onClick={handleSelectAllFields}\n                  disabled={isExporting}\n                >\n                  Select All\n                </button>\n                <button\n                  type=\\\"button\\\"\n                  className=\\\"export-fields-action\\\"\n                  onClick={handleSelectDefaultFields}\n                  disabled={isExporting}\n                >\n                  Default Fields\n                </button>\n              </div>\n            </div>\n            <div className=\\\"export-fields-grid\\\">\n              {DATA_FIELDS.map((field) => (\n                <label key={field.key} className=\\\"export-field-option\\\">\n                  <input\n                    type=\\\"checkbox\\\"\n                    checked={selectedFields.includes(field.key)}\n                    onChange={() => handleFieldToggle(field.key)}\n                    disabled={isExporting}\n                  />\n                  <span className=\\\"export-field-label\\\">{field.label}</span>\n                  {field.default && (\n                    <span className=\\\"export-field-default\\\">Default</span>\n                  )}\n                </label>\n              ))}\n            </div>\n          </div>\n\n          {/* Export Info */}\n          <div className=\\\"export-modal__info\\\">\n            <div className=\\\"export-info-item\\\">\n              <strong>Records to export:</strong> {filteredData.length}\n            </div>\n            <div className=\\\"export-info-item\\\">\n              <strong>Selected fields:</strong> {selectedFields.length}\n            </div>\n          </div>\n        </div>\n\n        <div className=\\\"export-modal__actions\\\">\n          <button\n            type=\\\"button\\\"\n            onClick={handlePreview}\n            className=\\\"export-modal__preview\\\"\n            disabled={isExporting || selectedFields.length === 0}\n          >\n            Preview\n          </button>\n          <button\n            type=\\\"button\\\"\n            onClick={onClose}\n            className=\\\"export-modal__cancel\\\"\n            disabled={isExporting}\n          >\n            Cancel\n          </button>\n          <button\n            type=\\\"button\\\"\n            onClick={handleExport}\n            className=\\\"export-modal__export\\\"\n            disabled={\n              isExporting ||\n              selectedFields.length === 0 ||\n              filteredData.length === 0\n            }\n          >\n            {isExporting ? 'Exporting...' : `Export ${format.toUpperCase()}`}\n          </button>\n        </div>\n\n        {/* Preview Modal */}\n        {showPreview && (\n          <div\n            className=\\\"export-preview-overlay\\\"\n            onClick={() => setShowPreview(false)}\n          >\n            <div\n              className=\\\"export-preview-modal\\\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <div className=\\\"export-preview-header\\\">\n                <h3>Export Preview ({format.toUpperCase()})</h3>\n                <button onClick={() => setShowPreview(false)}>\u2715</button>\n              </div>\n              <div className=\\\"export-preview-content\\\">\n                <pre>{exportPreview}</pre>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":539,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/modals/EditSubscriptionModal.tsx":{
    "content":"'use client';\n\nimport React, { useState } from 'react';\nimport { useOverlay } from '../../../../lib/context/OverlayContext';\nimport './EditSubscriptionModal.css';\n\ninterface Subscription {\n  id: string;\n  user_id: string;\n  plan_id: string;\n  status:\n    | 'active'\n    | 'cancelled'\n    | 'expired'\n    | 'suspended'\n    | 'pending'\n    | 'trialing';\n  billing_cycle?: string;\n  expires_at?: string;\n  trial_ends_at?: string;\n  assignment_reason?: string;\n  user_name?: string;\n  user_email?: string;\n  plan_display_name: string;\n}\n\ninterface EditSubscriptionModalProps {\n  onSave: (\n    subscriptionId: string,\n    updates: Partial<Subscription>\n  ) => Promise<void>;\n  subscription: Subscription;\n}\n\nexport function EditSubscriptionModal({\n  onSave,\n  subscription\n}: EditSubscriptionModalProps) {\n  const { closeOverlay } = useOverlay();\n  const [formData, setFormData] = useState({\n    status: subscription.status,\n    billing_cycle: subscription.billing_cycle || '',\n    expires_at: subscription.expires_at\n      ? subscription.expires_at.split('T')[0]\n      : '',\n    trial_ends_at: subscription.trial_ends_at\n      ? subscription.trial_ends_at.split('T')[0]\n      : '',\n    assignment_reason: subscription.assignment_reason || ''\n  });\n\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const updates: Partial<Subscription> = {\n        status: formData.status,\n        billing_cycle: formData.billing_cycle || undefined,\n        expires_at: formData.expires_at\n          ? `${formData.expires_at}T23:59:59Z`\n          : undefined,\n        trial_ends_at: formData.trial_ends_at\n          ? `${formData.trial_ends_at}T23:59:59Z`\n          : undefined,\n        assignment_reason: formData.assignment_reason || undefined\n      };\n\n      await onSave(subscription.id, updates);\n      closeOverlay(`edit-subscription-modal-${subscription.id}`);\n    } catch (err) {\n      setError(\n        err instanceof Error ? err.message : 'Failed to update subscription'\n      );\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\\\"edit-subscription-modal\\\">\n      <div className=\\\"edit-subscription-modal__header\\\">\n        <h2>\u270f\ufe0f Edit Subscription</h2>\n      </div>\n\n      <div className=\\\"edit-subscription-modal__user-info\\\">\n        <h3>\ud83d\udc64 {subscription.user_name || 'Unknown User'}</h3>\n        <p>{subscription.user_email}</p>\n        <p>\n          <strong>Plan:</strong> {subscription.plan_display_name}\n        </p>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\\\"edit-subscription-modal__form\\\">\n        <div className=\\\"edit-subscription-modal__form-grid\\\">\n          <div className=\\\"edit-subscription-modal__form-group\\\">\n            <label htmlFor=\\\"status\\\" className=\\\"edit-subscription-modal__label\\\">\n              Status\n            </label>\n            <select\n              id=\\\"status\\\"\n              value={formData.status}\n              onChange={(e) =>\n                setFormData({\n                  ...formData,\n                  status: e.target.value as Subscription['status']\n                })\n              }\n              className=\\\"edit-subscription-modal__select\\\"\n              required\n            >\n              <option value=\\\"active\\\">Active</option>\n              <option value=\\\"trialing\\\">Trialing</option>\n              <option value=\\\"cancelled\\\">Cancelled</option>\n              <option value=\\\"expired\\\">Expired</option>\n              <option value=\\\"suspended\\\">Suspended</option>\n              <option value=\\\"pending\\\">Pending</option>\n            </select>\n          </div>\n\n          <div className=\\\"edit-subscription-modal__form-group\\\">\n            <label\n              htmlFor=\\\"billing_cycle\\\"\n              className=\\\"edit-subscription-modal__label\\\"\n            >\n              Billing Cycle\n            </label>\n            <select\n              id=\\\"billing_cycle\\\"\n              value={formData.billing_cycle}\n              onChange={(e) =>\n                setFormData({ ...formData, billing_cycle: e.target.value })\n              }\n              className=\\\"edit-subscription-modal__select\\\"\n            >\n              <option value=\\\"\\\">No billing cycle</option>\n              <option value=\\\"monthly\\\">Monthly</option>\n              <option value=\\\"yearly\\\">Yearly</option>\n              <option value=\\\"lifetime\\\">Lifetime</option>\n            </select>\n          </div>\n\n          <div className=\\\"edit-subscription-modal__form-group\\\">\n            <label\n              htmlFor=\\\"expires_at\\\"\n              className=\\\"edit-subscription-modal__label\\\"\n            >\n              Expires At\n            </label>\n            <input\n              type=\\\"date\\\"\n              id=\\\"expires_at\\\"\n              value={formData.expires_at}\n              onChange={(e) =>\n                setFormData({ ...formData, expires_at: e.target.value })\n              }\n              className=\\\"edit-subscription-modal__input\\\"\n            />\n            <small className=\\\"edit-subscription-modal__help\\\">\n              Leave empty for no expiration\n            </small>\n          </div>\n\n          <div className=\\\"edit-subscription-modal__form-group\\\">\n            <label\n              htmlFor=\\\"trial_ends_at\\\"\n              className=\\\"edit-subscription-modal__label\\\"\n            >\n              Trial Ends At\n            </label>\n            <input\n              type=\\\"date\\\"\n              id=\\\"trial_ends_at\\\"\n              value={formData.trial_ends_at}\n              onChange={(e) =>\n                setFormData({ ...formData, trial_ends_at: e.target.value })\n              }\n              className=\\\"edit-subscription-modal__input\\\"\n            />\n            <small className=\\\"edit-subscription-modal__help\\\">\n              Only for trialing subscriptions\n            </small>\n          </div>\n\n          <div className=\\\"edit-subscription-modal__form-group edit-subscription-modal__form-group--full-width\\\">\n            <label\n              htmlFor=\\\"assignment_reason\\\"\n              className=\\\"edit-subscription-modal__label\\\"\n            >\n              Assignment Reason\n            </label>\n            <textarea\n              id=\\\"assignment_reason\\\"\n              value={formData.assignment_reason}\n              onChange={(e) =>\n                setFormData({\n                  ...formData,\n                  assignment_reason: e.target.value\n                })\n              }\n              className=\\\"edit-subscription-modal__textarea\\\"\n              placeholder=\\\"Reason for this subscription assignment...\\\"\n              rows={3}\n            />\n          </div>\n        </div>\n\n        {error && (\n          <div className=\\\"edit-subscription-modal__error\\\">\n            <span>\u274c {error}</span>\n          </div>\n        )}\n\n        <div className=\\\"edit-subscription-modal__actions\\\">\n          <button\n            type=\\\"submit\\\"\n            className=\\\"edit-subscription-modal__btn edit-subscription-modal__btn--primary\\\"\n            disabled={isLoading}\n          >\n            {isLoading ? '\u23f3 Saving...' : '\ud83d\udcbe Save Changes'}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":231,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/MysticalLoader.tsx":{
    "content":"'use client';\n\nimport styles from './MysticalLoader.module.css';\n\ninterface MysticalLoaderProps {\n  message?: string;\n  fullScreen?: boolean;\n}\n\nexport function MysticalLoader({\n  message = 'Channeling mystical energies...',\n  fullScreen = false\n}: MysticalLoaderProps) {\n  const containerClass = fullScreen\n    ? styles.loading__fullscreen\n    : styles.loading__container;\n\n  return (\n    <div className={containerClass}>\n      <div className={styles.loading__content}>\n        {/* Mystical spinning crystal */}\n        <div className={styles.mystical__crystal}>\n          <div className={styles.crystal__core}>\ud83d\udd2e</div>\n          <div className={styles.crystal__aura}></div>\n        </div>\n\n        {/* Floating mystical symbols */}\n        <div className={styles.mystical__symbols}>\n          <span className={`${styles.symbol} ${styles.symbol__1}`}>\u2728</span>\n          <span className={`${styles.symbol} ${styles.symbol__2}`}>\u26a1</span>\n          <span className={`${styles.symbol} ${styles.symbol__3}`}>\ud83c\udf1f</span>\n          <span className={`${styles.symbol} ${styles.symbol__4}`}>\ud83d\udcab</span>\n        </div>\n\n        {/* Loading message */}\n        <div className={styles.loading__message}>\n          <h3 className={styles.message__title}>\ud83e\uddd9\u200d\u2642\ufe0f Mystical Card Generator</h3>\n          <p className={styles.message__text}>{message}</p>\n          <div className={styles.loading__dots}>\n            <span></span>\n            <span></span>\n            <span></span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":49,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/WelcomeInterface.tsx":{
    "content":"'use client';\n\nimport { InstantLink } from '../../components/ui/InstantLink';\nimport { QuotaDisplay } from './QuotaDisplay';\nimport styles from './WelcomeInterface.module.css';\n\ninterface WelcomeInterfaceProps {\n  remainingGenerations: number;\n  quotaLimit: number;\n  hasInitializedQuota: boolean;\n  isQuotaExceeded: boolean;\n  resetDate?: Date | null;\n  loadGenerationId: string;\n  setLoadGenerationId: (id: string) => void;\n  onNewGeneration: () => void;\n  onLoadGeneration: () => void;\n}\n\nexport function WelcomeInterface({\n  remainingGenerations,\n  quotaLimit,\n  hasInitializedQuota,\n  isQuotaExceeded,\n  resetDate,\n  loadGenerationId,\n  setLoadGenerationId,\n  onNewGeneration,\n  onLoadGeneration\n}: WelcomeInterfaceProps) {\n  return (\n    <article className={styles.welcome__container}>\n      <div className={styles.welcome__container_fade}>\n        <div className={styles.welcome__intro}>\n          <h2>\ud83d\udd2e Enter the Realm of Mystical Creation \ud83d\udd2e</h2>\n          <p>\n            Ancient energies await your command. Choose your sacred path to\n            weave enchanted social media cards blessed with mystical geometry\n            and profound wisdom.\n          </p>\n        </div>\n\n        {/* Mobile Quota Display - compact version for welcome interface */}\n        <div className={styles.welcome__mobile__quota}>\n          <QuotaDisplay\n            remainingGenerations={remainingGenerations}\n            quotaLimit={quotaLimit}\n            hasInitializedQuota={hasInitializedQuota}\n            isQuotaExceeded={isQuotaExceeded}\n            resetDate={resetDate}\n            showMeter\n            welcome\n          />\n        </div>\n\n        <div className={styles.path__buttons}>\n          <button\n            onClick={onNewGeneration}\n            className={`${styles.path__button__large} ${styles.path__button__new}`}\n            disabled={isQuotaExceeded}\n          >\n            <div className={styles.button__icon}>\ud83c\udd95</div>\n            <div className={styles.button__content}>\n              <h3>Create New</h3>\n              <p>Generate a fresh mystical card</p>\n            </div>\n          </button>\n\n          <button\n            onClick={() => setLoadGenerationId(' ')}\n            className={`${styles.path__button__large} ${styles.path__button__load}`}\n          >\n            <div className={styles.button__icon}>\ud83d\udd0d</div>\n            <div className={styles.button__content}>\n              <h3>Load Previous</h3>\n              <p>Retrieve an existing generation</p>\n            </div>\n          </button>\n        </div>\n\n        {loadGenerationId && (\n          <div className={styles.load__input__group}>\n            <label className={styles.load__label}>\ud83d\udd2e Generation ID:</label>\n            <div className={styles.load__input__container}>\n              <input\n                type=\\\"text\\\"\n                value={loadGenerationId}\n                onChange={(e) => setLoadGenerationId(e.target.value)}\n                placeholder=\\\"Paste your generation ID here...\\\"\n                className={styles.load__input}\n              />\n              <button\n                onClick={onLoadGeneration}\n                className={styles.load__button}\n                disabled={!loadGenerationId.trim()}\n              >\n                Load \ud83d\udd2e\n              </button>\n            </div>\n            <p className={styles.load__help}>\n              \ud83d\udca1 Generation IDs look like:{' '}\n              <code>01234567-89ab-cdef-0123-456789abcdef</code>\n            </p>\n          </div>\n        )}\n\n        {isQuotaExceeded && (\n          <div className={styles.quota__notice}>\n            <p>\u26a1 Daily quota reached!</p>\n            <InstantLink href=\\\"/subscription\\\" className={styles.upgrade__link}>\n              Upgrade to Pro for unlimited generations \ud83d\ude80\n            </InstantLink>\n          </div>\n        )}\n      </div>\n    </article>\n  );\n}\n",
    "language":"typescript",
    "lines":118,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/QuotaDisplay.tsx":{
    "content":"'use client';\n\nimport { InteractiveTooltip } from '../../components/tooltip/InteractiveTooltip';\nimport { InstantLink } from '../../components/ui/InstantLink';\nimport { TimestampWithTooltip } from '../../components/ui/TimestampWithTooltip';\nimport { QuotaState } from '../types/generation';\nimport styles from './QuotaDisplay.module.css';\n\ninterface QuotaDisplayProps extends QuotaState {\n  showMeter?: boolean;\n  mobile?: boolean;\n  welcome?: boolean;\n}\n\nexport function QuotaDisplay({\n  remainingGenerations,\n  quotaLimit,\n  hasInitializedQuota,\n  isQuotaExceeded,\n  resetDate,\n  showMeter = false,\n  mobile = false,\n  welcome = false\n}: QuotaDisplayProps) {\n  const containerClass = welcome\n    ? styles.quota__welcome\n    : mobile\n      ? styles.quota__mobile\n      : styles.quota__section;\n\n  // Helper function to render quota text with optional tooltip\n  const renderQuotaText = (text: string) => {\n    if (!resetDate) {\n      return <span className={styles.quota__text}>{text}</span>;\n    }\n\n    const tooltipContent = (\n      <div style={{ padding: '8px 12px', textAlign: 'center' }}>\n        <div\n          style={{\n            fontSize: '13px',\n            fontWeight: '600',\n            color: 'white',\n            marginBottom: '6px'\n          }}\n        >\n          \ud83d\udd04 Quota Resets\n        </div>\n        <TimestampWithTooltip\n          date={resetDate}\n          abbreviated={false}\n          showSeconds={true}\n        />\n      </div>\n    );\n\n    return (\n      <InteractiveTooltip content={tooltipContent} delay={200}>\n        <span\n          className={styles.quota__text}\n          style={{\n            textDecoration: 'underline',\n            textDecorationStyle: 'dotted',\n            textUnderlineOffset: '2px',\n            cursor: 'help'\n          }}\n        >\n          {text}\n        </span>\n      </InteractiveTooltip>\n    );\n  };\n\n  const quotaText = hasInitializedQuota\n    ? `${remainingGenerations}/${quotaLimit} ${mobile || welcome ? 'enchantment today' : 'enchantment today'}`\n    : 'Channeling energy...';\n\n  const simpleQuotaText = `${remainingGenerations} spell remaining (until tomorrow)`;\n\n  return (\n    <div className={containerClass}>\n      <h3>\u26a1 Mystical Energy</h3>\n      <div className={styles.quota__display}>\n        {showMeter ? (\n          <div className={styles.quota__meter}>\n            <div className={styles.quota__bar}>\n              <div\n                className={styles.quota__fill}\n                style={{\n                  width: `${Math.min((remainingGenerations / quotaLimit) * 100, 100)}%`\n                }}\n              />\n            </div>\n            {renderQuotaText(quotaText)}\n          </div>\n        ) : (\n          renderQuotaText(simpleQuotaText)\n        )}\n\n        {isQuotaExceeded && (\n          <InstantLink href=\\\"/subscription\\\" className={styles.quota__upgrade}>\n            {mobile ? 'Upgrade \ud83d\udd2e' : 'Ascend to Archmage \ud83d\udd2e'}\n          </InstantLink>\n        )}\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":109,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/AdvancedControls.tsx":{
    "content":"'use client';\n\nimport { GenerationOptions } from '../types/generation';\nimport styles from './AdvancedControls.module.css';\nimport formStyles from './FormElements.module.css';\n\ninterface AdvancedControlsProps {\n  options: Partial<GenerationOptions>;\n  onOptionsChange: (options: Partial<GenerationOptions>) => void;\n  isProUser: boolean;\n  isReadonly?: boolean;\n}\n\nexport function AdvancedControls({\n  options,\n  onOptionsChange,\n  isProUser,\n  isReadonly = false\n}: AdvancedControlsProps) {\n  const disabled = !isProUser || isReadonly;\n\n  const handleChange = (key: keyof GenerationOptions, value: any) => {\n    if (disabled) return;\n    onOptionsChange({\n      ...options,\n      [key]: value\n    });\n  };\n\n  return (\n    <div className={styles.advanced__options}>\n      {!isProUser && (\n        <div className={styles.advanced__paywall__notice}>\n          <h4>\ud83d\ude80 Unlock Advanced Magic</h4>\n          <p>\n            Get precise control over avatar positioning, text layout, visual\n            styling, and more with Pro subscription.\n          </p>\n          <a href=\\\"/subscription\\\" className={styles.advanced__upgrade__link}>\n            Upgrade to Pro \u26a1\n          </a>\n        </div>\n      )}\n\n      <div className={styles.advanced__controls__grid}>\n        {/* Positioning Controls */}\n        <div className={formStyles.form__section}>\n          <h5 className={formStyles.form__subsection__title}>\n            \ud83d\udccd Avatar Positioning\n          </h5>\n          <div className={formStyles.form__row}>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Avatar X</span>\n              <input\n                type=\\\"number\\\"\n                value={options.avatarX || ''}\n                onChange={(e) =>\n                  handleChange('avatarX', parseInt(e.target.value) || undefined)\n                }\n                disabled={disabled}\n                placeholder=\\\"Auto\\\"\n                min=\\\"0\\\"\n                max=\\\"2000\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Avatar Y</span>\n              <input\n                type=\\\"number\\\"\n                value={options.avatarY || ''}\n                onChange={(e) =>\n                  handleChange('avatarY', parseInt(e.target.value) || undefined)\n                }\n                disabled={disabled}\n                placeholder=\\\"Auto\\\"\n                min=\\\"0\\\"\n                max=\\\"2000\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Avatar Size</span>\n              <input\n                type=\\\"number\\\"\n                value={options.avatarSize || ''}\n                onChange={(e) =>\n                  handleChange(\n                    'avatarSize',\n                    parseInt(e.target.value) || undefined\n                  )\n                }\n                disabled={disabled}\n                placeholder=\\\"Auto\\\"\n                min=\\\"50\\\"\n                max=\\\"500\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n          </div>\n        </div>\n\n        {/* Text Controls */}\n        <div className={formStyles.form__section}>\n          <h5 className={formStyles.form__subsection__title}>\ud83d\udcdd Text Layout</h5>\n          <div className={formStyles.form__row}>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Text Max Width</span>\n              <input\n                type=\\\"number\\\"\n                value={options.textMaxWidth || ''}\n                onChange={(e) =>\n                  handleChange(\n                    'textMaxWidth',\n                    parseInt(e.target.value) || undefined\n                  )\n                }\n                disabled={disabled}\n                placeholder=\\\"Auto\\\"\n                min=\\\"200\\\"\n                max=\\\"1000\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Text Start Y</span>\n              <input\n                type=\\\"number\\\"\n                value={options.textStartY || ''}\n                onChange={(e) =>\n                  handleChange(\n                    'textStartY',\n                    parseInt(e.target.value) || undefined\n                  )\n                }\n                disabled={disabled}\n                placeholder=\\\"Auto\\\"\n                min=\\\"50\\\"\n                max=\\\"800\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Text Padding</span>\n              <input\n                type=\\\"number\\\"\n                value={options.textPadding || ''}\n                onChange={(e) =>\n                  handleChange(\n                    'textPadding',\n                    parseInt(e.target.value) || undefined\n                  )\n                }\n                disabled={disabled}\n                placeholder=\\\"30\\\"\n                min=\\\"10\\\"\n                max=\\\"100\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n          </div>\n        </div>\n\n        {/* Visual Controls */}\n        <div className={formStyles.form__section}>\n          <h5 className={formStyles.form__subsection__title}>\n            \ud83c\udfa8 Visual Effects\n          </h5>\n          <div className={formStyles.form__row}>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Font Size</span>\n              <input\n                type=\\\"number\\\"\n                value={options.fontSize || ''}\n                onChange={(e) =>\n                  handleChange(\n                    'fontSize',\n                    parseInt(e.target.value) || undefined\n                  )\n                }\n                disabled={disabled}\n                placeholder=\\\"Auto\\\"\n                min=\\\"12\\\"\n                max=\\\"72\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Line Height</span>\n              <input\n                type=\\\"number\\\"\n                step=\\\"0.1\\\"\n                value={options.lineHeight || ''}\n                onChange={(e) =>\n                  handleChange(\n                    'lineHeight',\n                    parseFloat(e.target.value) || undefined\n                  )\n                }\n                disabled={disabled}\n                placeholder=\\\"1.4\\\"\n                min=\\\"1.0\\\"\n                max=\\\"3.0\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Border Opacity</span>\n              <input\n                type=\\\"number\\\"\n                step=\\\"0.1\\\"\n                value={options.borderOpacity || ''}\n                onChange={(e) =>\n                  handleChange(\n                    'borderOpacity',\n                    parseFloat(e.target.value) || undefined\n                  )\n                }\n                disabled={disabled}\n                placeholder=\\\"0.7\\\"\n                min=\\\"0\\\"\n                max=\\\"1\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n          </div>\n        </div>\n\n        {/* Pattern Controls */}\n        <div className={formStyles.form__section}>\n          <h5 className={formStyles.form__subsection__title}>\n            \ud83c\udf1f Pattern Magic\n          </h5>\n          <div className={formStyles.form__row}>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Border Color</span>\n              <input\n                type=\\\"color\\\"\n                value={options.borderColor || '#ffffff'}\n                onChange={(e) => handleChange('borderColor', e.target.value)}\n                disabled={disabled}\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n                style={{ height: '56px' }} // Match other input heights\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>Pattern Seed</span>\n              <input\n                type=\\\"text\\\"\n                value={options.patternSeed || ''}\n                onChange={(e) =>\n                  handleChange('patternSeed', e.target.value || undefined)\n                }\n                disabled={disabled}\n                placeholder=\\\"Auto-generated\\\"\n                className={`${formStyles.form__input} ${disabled ? formStyles.form__input__disabled : ''}`}\n              />\n            </label>\n            <label className={formStyles.form__checkbox__label}>\n              <input\n                type=\\\"checkbox\\\"\n                checked={options.glassBackground || false}\n                onChange={(e) =>\n                  handleChange('glassBackground', e.target.checked)\n                }\n                disabled={disabled}\n                className={formStyles.form__checkbox}\n              />\n              <span className={formStyles.label__text}>\n                Glass Background Effect\n              </span>\n            </label>\n          </div>\n        </div>\n      </div>\n\n      {disabled && (\n        <div className={styles.upgrade__overlay}>\n          <div className={styles.upgrade__content}>\n            <h4>\ud83d\udd2e Unlock Advanced Magic</h4>\n            <p>\n              Gain precise control over every aspect of your mystical cards!\n            </p>\n            <button\n              className={styles.upgrade__button}\n              onClick={() => (window.location.href = '/subscription')}\n            >\n              Ascend to Archmage \u26a1\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":296,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/AspectRatioSelector.tsx":{
    "content":"'use client';\n\nimport { AspectRatioConfig } from '../constants/aspectRatios';\nimport styles from './AspectRatioSelector.module.css';\n\ninterface AspectRatioSelectorProps {\n  selectedRatio: string;\n  onRatioChange: (ratio: string) => void;\n  options: AspectRatioConfig[];\n  disabled?: boolean;\n}\n\nexport function AspectRatioSelector({\n  selectedRatio,\n  onRatioChange,\n  options,\n  disabled = false\n}: AspectRatioSelectorProps) {\n  const currentOption = options.find((option) => option.key === selectedRatio);\n\n  return (\n    <div className={styles.aspect__ratio__container}>\n      <div className={styles.aspect__ratio__selector}>\n        <label htmlFor=\\\"aspect-ratio-select\\\" className={styles.selector__label}>\n          Aspect Ratio:\n        </label>\n        <select\n          id=\\\"aspect-ratio-select\\\"\n          value={selectedRatio}\n          onChange={(e) => onRatioChange(e.target.value)}\n          className={styles.selector__dropdown}\n          disabled={disabled}\n        >\n          {options.map((option) => (\n            <option key={option.key} value={option.key}>\n              {option.name} ({option.dimensions})\n            </option>\n          ))}\n        </select>\n      </div>\n\n      {currentOption && (\n        <div className={styles.aspect__ratio__info}>\n          <div className={styles.ratio__info}>\n            <span className={styles.ratio__name}>{currentOption.name}</span>\n            <span className={styles.ratio__dimensions}>\n              {currentOption.dimensions}\n            </span>\n            <span className={styles.ratio__description}>\n              {currentOption.description}\n            </span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":58,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/GenerationForm.tsx":{
    "content":"'use client';\n\nimport { useState } from 'react';\nimport { Card } from '../../components/card/Card';\nimport { InstantLink } from '../../components/ui/InstantLink';\nimport type { GenerationOptions } from '../types/generation';\nimport { AdvancedControls } from './AdvancedControls';\nimport formStyles from './FormElements.module.css';\n\nexport interface AspectRatioOption {\n  key: string;\n  name: string;\n  width: number;\n  height: number;\n  description: string;\n  dimensions: string;\n}\n\ninterface GenerationFormProps {\n  currentSeed: string;\n  setCurrentSeed: (seed: string) => void;\n  avatarSeed: string;\n  setAvatarSeed: (seed: string) => void;\n  customQuote: string;\n  setCustomQuote: (quote: string) => void;\n  customAuthor: string;\n  setCustomAuthor: (author: string) => void;\n  customWidth: string;\n  setCustomWidth: (width: string) => void;\n  customHeight: string;\n  setCustomHeight: (height: string) => void;\n  shapeCount: string;\n  setShapeCount: (count: string) => void;\n  isQuotaExceeded: boolean;\n  isGenerating: boolean;\n  onGenerate: () => void;\n  onRandomize: () => void;\n  isCollapsed?: boolean;\n  onToggleCollapse?: () => void;\n  // Aspect ratio props\n  selectedRatio: AspectRatioOption;\n  onRatioChange: (ratio: AspectRatioOption) => void;\n  aspectRatioOptions: AspectRatioOption[];\n  // Advanced configuration (Pro features)\n  generationOptions?: {\n    avatarX?: number;\n    avatarY?: number;\n    avatarSize?: number;\n    textMaxWidth?: number;\n    textStartY?: number;\n    fontSize?: number;\n    borderOpacity?: number;\n    textPadding?: number;\n    lineHeight?: number;\n    borderColor?: string;\n    patternSeed?: string;\n    glassBackground?: boolean;\n  };\n  // Advanced options state and handlers\n  advancedOptions?: Partial<GenerationOptions>;\n  onAdvancedOptionsChange?: (options: Partial<GenerationOptions>) => void;\n  isProUser?: boolean;\n  // Read-only state for loaded generations\n  isReadOnly?: boolean;\n}\n\nexport function GenerationForm({\n  currentSeed,\n  setCurrentSeed,\n  avatarSeed,\n  setAvatarSeed,\n  customQuote,\n  setCustomQuote,\n  customAuthor,\n  setCustomAuthor,\n  customWidth,\n  setCustomWidth,\n  customHeight,\n  setCustomHeight,\n  shapeCount,\n  setShapeCount,\n  isQuotaExceeded,\n  isGenerating,\n  onGenerate,\n  onRandomize,\n  isCollapsed,\n  onToggleCollapse,\n  selectedRatio,\n  onRatioChange,\n  aspectRatioOptions,\n  generationOptions,\n  advancedOptions,\n  onAdvancedOptionsChange,\n  isProUser,\n  isReadOnly = false\n}: GenerationFormProps) {\n  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);\n  const [editingSeed, setEditingSeed] = useState<'main' | 'avatar' | null>(\n    null\n  );\n  const [tempSeed, setTempSeed] = useState('');\n\n  const handleSeedEdit = (type: 'main' | 'avatar') => {\n    const currentValue = type === 'main' ? currentSeed : avatarSeed;\n    setTempSeed(currentValue);\n    setEditingSeed(type);\n  };\n\n  const handleSeedSave = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingSeed === 'main') {\n      setCurrentSeed(tempSeed);\n    } else if (editingSeed === 'avatar') {\n      setAvatarSeed(tempSeed);\n    }\n    setEditingSeed(null);\n    setTempSeed('');\n  };\n\n  const handleSeedCancel = () => {\n    setEditingSeed(null);\n    setTempSeed('');\n  };\n\n  return (\n    <Card width=\\\"full\\\" className={formStyles.generation__form__container}>\n      {/* Form Header */}\n      <div className={formStyles.form__header}>\n        <div className={formStyles.form__title__container}>\n          <h3 className={formStyles.form__title}>Configuration</h3>\n          {onToggleCollapse && (\n            <button\n              onClick={onToggleCollapse}\n              className={formStyles.form__collapse__button}\n              title={isCollapsed ? 'Expand form' : 'Collapse form'}\n            >\n              <span>{isCollapsed ? 'Expand' : 'Collapse'}</span>\n              <span\n                className={`${formStyles.form__collapse__chevron} ${\n                  isCollapsed\n                    ? formStyles['form__collapse__chevron--collapsed']\n                    : formStyles['form__collapse__chevron--expanded']\n                }`}\n              >\n                \u25bc\n              </span>\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Collapsible Form Content */}\n      <div\n        className={`${formStyles.form__collapsible__content} ${\n          isCollapsed\n            ? formStyles['form__collapsible__content--collapsed']\n            : formStyles['form__collapsible__content--expanded']\n        }`}\n      >\n        {/* Read-only banner for loaded generations */}\n        {isReadOnly && (\n          <div className={formStyles.form__readonly__banner}>\n            <span className={formStyles.readonly__icon}>\ud83d\udd12</span>\n            <div className={formStyles.readonly__text}>\n              <strong>Viewing Loaded Generation</strong>\n              <p>\n                This configuration is read-only. Create a new generation to make\n                changes.\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* Free Configuration Section */}\n        <div className={formStyles.form__section}>\n          <h4 className={formStyles.form__section__title}>\n            \u26a1 Free Configuration\n          </h4>\n\n          {/* Seeds Section */}\n          <div className={formStyles.seed__controls__container}>\n            <div className={formStyles.seed__controls}>\n              <div className={formStyles.seed__control__group}>\n                <label className={formStyles.form__label}>\n                  <span className={formStyles.label__text}>\ud83c\udfb2 Main Seed</span>\n                  <div className={formStyles.seed__display__container}>\n                    {editingSeed === 'main' ? (\n                      <div className={formStyles.seed__edit__container}>\n                        <input\n                          type=\\\"text\\\"\n                          value={tempSeed}\n                          onChange={(e) => setTempSeed(e.target.value)}\n                          className={formStyles.seed__input}\n                          placeholder=\\\"Enter custom seed...\\\"\n                        />\n                        <button\n                          onClick={handleSeedSave}\n                          className={formStyles.seed__save}\n                        >\n                          \u2713\n                        </button>\n                        <button\n                          onClick={handleSeedCancel}\n                          className={formStyles.seed__cancel}\n                        >\n                          \u2715\n                        </button>\n                      </div>\n                    ) : (\n                      <div className={formStyles.seed__display}>\n                        <input\n                          type=\\\"text\\\"\n                          value={currentSeed}\n                          readOnly\n                          className={formStyles.seed__display__input}\n                          placeholder=\\\"Auto-generated seed\\\"\n                        />\n                        <button\n                          onClick={() => handleSeedEdit('main')}\n                          className={formStyles.seed__edit__btn}\n                          title=\\\"Edit seed\\\"\n                          disabled={isReadOnly}\n                        >\n                          \u270f\ufe0f\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                </label>\n              </div>\n\n              <div className={formStyles.seed__control__group}>\n                <label className={formStyles.form__label}>\n                  <span className={formStyles.label__text}>\ud83e\uddd9\u200d\u2642\ufe0f Avatar Seed</span>\n                  <div className={formStyles.seed__display__container}>\n                    {editingSeed === 'avatar' ? (\n                      <div className={formStyles.seed__edit__container}>\n                        <input\n                          type=\\\"text\\\"\n                          value={tempSeed}\n                          onChange={(e) => setTempSeed(e.target.value)}\n                          className={formStyles.seed__input}\n                          placeholder=\\\"Leave empty to use main seed\\\"\n                        />\n                        <button\n                          onClick={handleSeedSave}\n                          className={formStyles.seed__save}\n                        >\n                          \u2713\n                        </button>\n                        <button\n                          onClick={handleSeedCancel}\n                          className={formStyles.seed__cancel}\n                        >\n                          \u2715\n                        </button>\n                      </div>\n                    ) : (\n                      <div className={formStyles.seed__display}>\n                        <input\n                          type=\\\"text\\\"\n                          value={avatarSeed}\n                          readOnly\n                          className={formStyles.seed__display__input}\n                          placeholder=\\\"Custom avatar seed (leave empty for random)\\\"\n                        />\n                        <button\n                          onClick={() => handleSeedEdit('avatar')}\n                          className={formStyles.seed__edit__btn}\n                          title=\\\"Edit avatar seed\\\"\n                          disabled={isReadOnly}\n                        >\n                          \u270f\ufe0f\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                </label>\n              </div>\n            </div>\n          </div>\n\n          {/* Quote and Author Section - Author first, both full width */}\n          <div className={formStyles.form__section}>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>\ud83d\udc64 Author</span>\n              <input\n                type=\\\"text\\\"\n                value={customAuthor}\n                onChange={(e) => setCustomAuthor(e.target.value)}\n                className={`${formStyles.form__input} ${isReadOnly ? formStyles.form__input__disabled : ''}`}\n                placeholder=\\\"Quote author (leave empty for random)\\\"\n                disabled={isReadOnly}\n              />\n            </label>\n\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>\ud83d\udcac Quote</span>\n              <textarea\n                value={customQuote}\n                onChange={(e) => setCustomQuote(e.target.value)}\n                className={`${formStyles.form__textarea} ${isReadOnly ? formStyles.form__input__disabled : ''}`}\n                placeholder=\\\"Enter custom quote (leave empty for random quote)\\\"\n                rows={3}\n                disabled={isReadOnly}\n              />\n            </label>\n          </div>\n\n          {/* Aspect Ratio Section */}\n          <div className={formStyles.form__row}>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>\ud83d\udcd0 Aspect Ratio</span>\n              <select\n                value={selectedRatio.key}\n                onChange={(e) => {\n                  const ratio = aspectRatioOptions.find(\n                    (r) => r.key === e.target.value\n                  );\n                  if (ratio) onRatioChange(ratio);\n                }}\n                className={`${formStyles.form__input} ${isReadOnly ? formStyles.form__input__disabled : ''}`}\n                disabled={isReadOnly}\n              >\n                {aspectRatioOptions.map((ratio) => (\n                  <option key={ratio.key} value={ratio.key}>\n                    {ratio.name} ({ratio.dimensions})\n                  </option>\n                ))}\n              </select>\n            </label>\n          </div>\n\n          {/* Dimensions Section */}\n          <div className={`${formStyles.form__row} dimensions__row`}>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>\ud83d\udccf Width</span>\n              <input\n                type=\\\"number\\\"\n                value={customWidth}\n                onChange={(e) => setCustomWidth(e.target.value)}\n                className={`${formStyles.form__input} ${isReadOnly ? formStyles.form__input__disabled : ''}`}\n                placeholder=\\\"Auto\\\"\n                min=\\\"400\\\"\n                max=\\\"2000\\\"\n                disabled={isReadOnly}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>\ud83d\udccf Height</span>\n              <input\n                type=\\\"number\\\"\n                value={customHeight}\n                onChange={(e) => setCustomHeight(e.target.value)}\n                className={`${formStyles.form__input} ${isReadOnly ? formStyles.form__input__disabled : ''}`}\n                placeholder=\\\"Auto\\\"\n                min=\\\"400\\\"\n                max=\\\"2000\\\"\n                disabled={isReadOnly}\n              />\n            </label>\n            <label className={formStyles.form__label}>\n              <span className={formStyles.label__text}>\ud83d\udd22 Shape Count</span>\n              <input\n                type=\\\"number\\\"\n                value={shapeCount}\n                onChange={(e) => setShapeCount(e.target.value)}\n                className={`${formStyles.form__input} ${isReadOnly ? formStyles.form__input__disabled : ''}`}\n                placeholder=\\\"8\\\"\n                min=\\\"0\\\"\n                max=\\\"20\\\"\n                disabled={isReadOnly}\n              />\n            </label>\n          </div>\n        </div>\n\n        {/* Pro Configuration Section */}\n        <div className={formStyles.form__pro__section}>\n          <div className={formStyles.form__pro__header}>\n            <h4 className={formStyles.form__section__title}>\n              \u26a1 Pro Configuration Options\n              <span className={formStyles.pro__badge}>PRO</span>\n            </h4>\n            <button\n              onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}\n              className={formStyles.form__toggle__button}\n            >\n              <span>{isAdvancedOpen ? 'Hide Details' : 'Show Details'}</span>\n              <span\n                className={`${formStyles.form__toggle__chevron} ${\n                  isAdvancedOpen\n                    ? formStyles['form__toggle__chevron--expanded']\n                    : formStyles['form__toggle__chevron--collapsed']\n                }`}\n              >\n                \u25bc\n              </span>\n            </button>\n          </div>\n\n          <div\n            className={`${formStyles.form__advanced__content} ${\n              isAdvancedOpen\n                ? formStyles['form__advanced__content--expanded']\n                : formStyles['form__advanced__content--collapsed']\n            }`}\n          >\n            <AdvancedControls\n              options={advancedOptions || {}}\n              onOptionsChange={onAdvancedOptionsChange || (() => {})}\n              isProUser={isProUser || false}\n              isReadonly={!isProUser || isReadOnly}\n            />\n          </div>\n        </div>\n\n        {/* Action Buttons */}\n        <div className={formStyles.form__buttons}>\n          <button\n            onClick={onRandomize}\n            className={`${formStyles.randomize__button} ${isQuotaExceeded || isReadOnly ? formStyles.randomize__button__disabled : ''}`}\n            disabled={isQuotaExceeded || isReadOnly}\n            title={\n              isReadOnly\n                ? 'Cannot modify loaded generation'\n                : 'Randomize all fields'\n            }\n          >\n            \ud83c\udfb2 Randomize All\n          </button>\n\n          <button\n            onClick={onGenerate}\n            className={`${formStyles.generate__button} ${\n              isQuotaExceeded || isGenerating || isReadOnly\n                ? formStyles.generate__button__disabled\n                : ''\n            }`}\n            disabled={isQuotaExceeded || isGenerating || isReadOnly}\n            title={isReadOnly ? 'Cannot modify loaded generation' : undefined}\n          >\n            {isReadOnly\n              ? '\ud83d\udd12 Read-Only Generation'\n              : isGenerating\n                ? '\ud83d\udd2e Generating...'\n                : '\u26a1 Generate Image'}\n          </button>\n        </div>\n\n        {isQuotaExceeded && (\n          <div className={formStyles.form__upgrade__notice}>\n            <h4>\u26a1 Daily Quota Exceeded</h4>\n            <p>\n              Upgrade to Pro for unlimited generations and advanced features!\n            </p>\n            <InstantLink\n              href=\\\"/subscription\\\"\n              className={formStyles.form__upgrade__button}\n            >\n              Upgrade to Pro \ud83d\ude80\n            </InstantLink>\n          </div>\n        )}\n      </div>\n    </Card>\n  );\n}\n",
    "language":"typescript",
    "lines":469,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/GenerationDisplay.tsx":{
    "content":"'use client';\n\nimport styles from './GenerationDisplay.module.css';\n\ninterface GenerationDisplayProps {\n  generationId: string;\n  svgContent: string;\n  onCopyId: () => void;\n}\n\nexport function GenerationDisplay({\n  generationId,\n  svgContent,\n  onCopyId\n}: GenerationDisplayProps) {\n  // Only require svgContent - generationId can be empty in local development\n  if (!svgContent) {\n    return null;\n  }\n\n  return (\n    <div className={styles.generation__display__container}>\n      <div className={styles.generation__header}>\n        <h4 className={styles.generation__title}>\ud83c\udfa8 Generated Image</h4>\n        {generationId && (\n          <div className={styles.generation__id}>\n            <span className={styles.id__label}>ID:</span>\n            <code className={styles.id__value}>{generationId}</code>\n            <button\n              onClick={onCopyId}\n              className={styles.copy__button}\n              title=\\\"Copy Generation ID\\\"\n            >\n              \ud83d\udccb Copy\n            </button>\n          </div>\n        )}\n      </div>\n\n      <div className={styles.image__wrapper}>\n        <div\n          className={styles.og__image}\n          dangerouslySetInnerHTML={{ __html: svgContent }}\n        />\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":49,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/components/RegenerationDialog.tsx":{
    "content":"'use client';\n\nimport styles from './RegenerationDialog.module.css';\n\ninterface RegenerationDialogProps {\n  isOpen: boolean;\n  onChoice: (choice: 'same' | 'random') => void;\n  onClose: () => void;\n}\n\nexport function RegenerationDialog({\n  isOpen,\n  onChoice,\n  onClose\n}: RegenerationDialogProps) {\n  if (!isOpen) return null;\n\n  return (\n    <div className={styles.dialog__overlay}>\n      <div className={styles.dialog__container}>\n        <div className={styles.dialog__header}>\n          <h3 className={styles.dialog__title}>\ud83d\udd2e Regeneration Options</h3>\n          <button\n            onClick={onClose}\n            className={styles.dialog__close}\n            title=\\\"Close dialog\\\"\n          >\n            \u2715\n          </button>\n        </div>\n\n        <div className={styles.dialog__content}>\n          <p className={styles.dialog__message}>\n            You haven&apos;t changed any form values since the last generation.\n            How would you like to proceed?\n          </p>\n\n          <div className={styles.dialog__options}>\n            <button\n              onClick={() => onChoice('same')}\n              className={`${styles.dialog__button} ${styles.dialog__button__primary}`}\n            >\n              <div className={styles.dialog__button__icon}>\ud83d\udd04</div>\n              <div className={styles.dialog__button__content}>\n                <h4>Same Configuration</h4>\n                <p>Regenerate with current settings</p>\n              </div>\n            </button>\n\n            <button\n              onClick={() => onChoice('random')}\n              className={`${styles.dialog__button} ${styles.dialog__button__secondary}`}\n            >\n              <div className={styles.dialog__button__icon}>\ud83c\udfb2</div>\n              <div className={styles.dialog__button__content}>\n                <h4>Use Random</h4>\n                <p>Clear form and generate with random values</p>\n              </div>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":66,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/page.tsx":{
    "content":"import { About } from './components/about/About';\nimport { Card } from './components/card/Card';\nimport { DiscordEmbed } from './components/discord-embed/DiscordEmbed';\nimport FadeIn from './components/fade-in/FadeIn';\nimport { PageAside } from './components/page-aside/PageAside';\nimport { PageContainer } from './components/page-container/PageContainer';\nimport PageContent from './components/page-content/PageContent';\nimport PageHeader from './components/page-header/PageHeader';\nimport { TwitchChat } from './components/twitch-chat';\nimport './globals.css';\nimport styles from './page.module.css';\n\nexport default async function Home() {\n  return (\n    <div style={{ position: 'relative', width: '100%' }}>\n      <PageContainer>\n        <PageHeader>\n          <FadeIn>\n            <h2>About</h2>\n          </FadeIn>\n        </PageHeader>\n        <PageContent>\n          <article className={styles.home__container}>\n            <FadeIn className={styles.home__container_fade}>\n              <Card className={styles.home__container_item_full}>\n                <About />\n              </Card>\n\n              <Card className={styles.home__container_item_full}>\n                <TwitchChat\n                  username=\\\"strixun\\\"\n                  height=\\\"500px\\\"\n                  className={styles.home__twitch_chat}\n                  minimal\n                  hideHeader\n                />\n              </Card>\n            </FadeIn>\n          </article>\n        </PageContent>\n      </PageContainer>\n\n      <PageAside className={styles.discord_aside} bottomMargin={0}>\n        <FadeIn>\n          <DiscordEmbed />\n        </FadeIn>\n      </PageAside>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":51,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/test-banners/page.tsx":{
    "content":"'use client';\n\n/**\n * Test Banner System Page\n *\n * Demonstrates the enhanced banner system with various test scenarios.\n */\n\nimport { useState } from 'react';\n\nexport default function TestBannersPage() {\n  const [testResults, setTestResults] = useState<string[]>([]);\n\n  const addResult = (message: string) => {\n    setTestResults((prev) => [\n      ...prev,\n      `${new Date().toLocaleTimeString()}: ${message}`\n    ]);\n  };\n\n  const testRateLimit = async () => {\n    try {\n      addResult('\ud83e\uddea Testing rate limit notification...');\n\n      const response = await fetch('/api/admin/test-rate-limit', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ testType: 'normal' })\n      });\n\n      if (response.status === 429) {\n        addResult('\u2705 Rate limit test successful - banner should appear');\n      } else if (response.status === 401) {\n        addResult('\u26a0\ufe0f Authentication required for rate limit test');\n      } else {\n        addResult(`\u274c Unexpected response: ${response.status}`);\n      }\n    } catch (error) {\n      addResult(`\u274c Rate limit test failed: ${error}`);\n    }\n  };\n\n  const testAttackAlert = async () => {\n    try {\n      addResult('\ud83d\udea8 Testing security attack notification...');\n\n      const response = await fetch('/api/admin/test-rate-limit', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ testType: 'attack' })\n      });\n\n      if (response.status === 429) {\n        addResult('\u2705 Attack alert test successful - red banner should appear');\n      } else if (response.status === 401) {\n        addResult('\u26a0\ufe0f Authentication required for attack alert test');\n      } else {\n        addResult(`\u274c Unexpected response: ${response.status}`);\n      }\n    } catch (error) {\n      addResult(`\u274c Attack alert test failed: ${error}`);\n    }\n  };\n\n  const testDatabaseAlerts = async () => {\n    try {\n      addResult('\ud83d\udcbe Testing database alerts...');\n\n      const response = await fetch('/api/alerts/active');\n\n      if (response.ok) {\n        const alerts = await response.json();\n        addResult(`\u2705 Found ${alerts.length} active database alerts`);\n        alerts.forEach((alert: any, index: number) => {\n          addResult(`  ${index + 1}. \\\"${alert.title}\\\" (${alert.alert_type})`);\n        });\n      } else if (response.status === 401) {\n        addResult('\u26a0\ufe0f Authentication required for database alerts');\n      } else {\n        addResult(`\u274c Database alerts test failed: ${response.status}`);\n      }\n    } catch (error) {\n      addResult(`\u274c Database alerts test failed: ${error}`);\n    }\n  };\n\n  const triggerRefresh = () => {\n    addResult('\ud83d\udd04 Triggering manual banner refresh...');\n    window.dispatchEvent(new CustomEvent('refresh-alerts'));\n    addResult('\u2705 Refresh event sent');\n  };\n\n  const injectTestBanner = () => {\n    addResult('\ud83e\uddea Injecting test banner manually...');\n\n    // Create a fake rate limit info to trigger a banner\n    const testRateLimit = {\n      retryAfter: 30,\n      error: 'Test rate limit banner - manually injected',\n      quotaType: 'test',\n      penaltyLevel: 1\n    };\n\n    sessionStorage.setItem('rate-limit-info', JSON.stringify(testRateLimit));\n\n    // Trigger refresh\n    window.dispatchEvent(new CustomEvent('refresh-alerts'));\n\n    addResult('\u2705 Test banner injected! Should appear in 5 seconds or less');\n  };\n\n  const clearResults = () => {\n    setTestResults([]);\n  };\n\n  return (\n    <div className=\\\"min-h-screen bg-gray-50 py-8\\\">\n      <div className=\\\"max-w-4xl mx-auto px-4\\\">\n        <div className=\\\"bg-white rounded-lg shadow-lg p-6\\\">\n          <h1 className=\\\"text-3xl font-bold text-gray-900 mb-2\\\">\n            \ud83e\uddd9\u200d\u2642\ufe0f Enhanced Banner System Test\n          </h1>\n          <p className=\\\"text-gray-600 mb-8\\\">\n            Test the enhanced banner system with database alerts, rate limits,\n            and real-time updates.\n          </p>\n\n          {/* Test Controls */}\n          <div className=\\\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8\\\">\n            <button\n              onClick={testRateLimit}\n              className=\\\"bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-3 px-4 rounded-lg transition-colors\\\"\n            >\n              \u26a1 Test Rate Limit\n            </button>\n\n            <button\n              onClick={testAttackAlert}\n              className=\\\"bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-colors\\\"\n            >\n              \ud83d\udea8 Test Attack Alert\n            </button>\n\n            <button\n              onClick={testDatabaseAlerts}\n              className=\\\"bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors\\\"\n            >\n              \ud83d\udcbe Test DB Alerts\n            </button>\n\n            <button\n              onClick={triggerRefresh}\n              className=\\\"bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-4 rounded-lg transition-colors\\\"\n            >\n              \ud83d\udd04 Refresh Banners\n            </button>\n\n            <button\n              onClick={injectTestBanner}\n              className=\\\"bg-purple-500 hover:bg-purple-600 text-white font-medium py-3 px-4 rounded-lg transition-colors\\\"\n            >\n              \ud83e\uddea Inject Test Banner\n            </button>\n          </div>\n\n          {/* System Info */}\n          <div className=\\\"bg-gray-100 rounded-lg p-4 mb-6\\\">\n            <h2 className=\\\"text-lg font-semibold text-gray-800 mb-3\\\">\n              \ud83d\udcca System Information\n            </h2>\n            <div className=\\\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\\\">\n              <div>\n                <strong>Polling Interval:</strong> 5 seconds\n              </div>\n              <div>\n                <strong>Banner Position:</strong> Full width, top-stacked\n              </div>\n              <div>\n                <strong>Data Sources:</strong> Database alerts, Rate limits,\n                Timeouts\n              </div>\n              <div>\n                <strong>Animation:</strong> Slide-in with staggered timing\n              </div>\n            </div>\n          </div>\n\n          {/* Test Results */}\n          <div className=\\\"bg-gray-900 text-green-400 rounded-lg p-4 font-mono text-sm\\\">\n            <div className=\\\"flex justify-between items-center mb-3\\\">\n              <h2 className=\\\"text-lg font-semibold\\\">\ud83d\udcdd Test Results</h2>\n              <button\n                onClick={clearResults}\n                className=\\\"bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs\\\"\n              >\n                Clear\n              </button>\n            </div>\n\n            <div className=\\\"space-y-1 max-h-64 overflow-y-auto\\\">\n              {testResults.length === 0 ? (\n                <div className=\\\"text-gray-500\\\">\n                  No tests run yet. Click a test button above to start.\n                </div>\n              ) : (\n                testResults.map((result, index) => (\n                  <div key={index} className=\\\"break-words\\\">\n                    {result}\n                  </div>\n                ))\n              )}\n            </div>\n          </div>\n\n          {/* Instructions */}\n          <div className=\\\"mt-8 bg-blue-50 border-l-4 border-blue-400 p-4\\\">\n            <h3 className=\\\"text-lg font-semibold text-blue-900 mb-2\\\">\n              \ud83d\udccb How to Use\n            </h3>\n            <ol className=\\\"list-decimal list-inside space-y-2 text-blue-800\\\">\n              <li>\n                <strong>Inject Test Banner:</strong> Creates a fake rate limit\n                banner immediately (best for testing)\n              </li>\n              <li>\n                <strong>Rate Limit Test:</strong> Triggers a rate limit\n                notification (requires authentication)\n              </li>\n              <li>\n                <strong>Attack Alert Test:</strong> Triggers a security alert\n                banner (requires authentication)\n              </li>\n              <li>\n                <strong>Database Alerts:</strong> Fetches and displays active\n                alerts from the database\n              </li>\n              <li>\n                <strong>Refresh Banners:</strong> Manually triggers a banner\n                system refresh\n              </li>\n              <li>\n                <strong>Watch the top of the page</strong> for banners to appear\n                with animations\n              </li>\n            </ol>\n          </div>\n\n          {/* Features */}\n          <div className=\\\"mt-6 bg-green-50 border-l-4 border-green-400 p-4\\\">\n            <h3 className=\\\"text-lg font-semibold text-green-900 mb-2\\\">\n              \u2728 Enhanced Features\n            </h3>\n            <ul className=\\\"list-disc list-inside space-y-1 text-green-800\\\">\n              <li>\ud83c\udfa8 Beautiful gradients and animations</li>\n              <li>\u23f1\ufe0f Live countdown timers for rate limits</li>\n              <li>\ud83d\udcca Progress bars showing time remaining</li>\n              <li>\ud83c\udfaf Priority-based stacking</li>\n              <li>\ud83d\udd04 Real-time polling (5-second intervals)</li>\n              <li>\ud83d\udcbe Database alert integration</li>\n              <li>\ud83d\udcf1 Fully responsive design</li>\n              <li>\ud83c\udfad Custom icons and colors per alert type</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":269,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/page.tsx":{
    "content":"import { redirect } from 'next/navigation';\nimport { Suspense } from 'react';\nimport { requireAdmin } from '../../lib/permissions/permissions';\nimport Loader from '../components/loader/Loader';\nimport AdminDashboard from './AdminDashboard';\n\n// Force dynamic rendering and disable caching\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n\nexport const metadata = {\n  title: 'Admin Dashboard - Idling.app',\n  description:\n    'Administrative dashboard for managing users, content, and emojis'\n};\n\nexport default async function AdminPage() {\n  // Check admin permissions\n  const hasAccess = await requireAdmin();\n\n  if (!hasAccess) {\n    redirect('/');\n  }\n\n  return (\n    <div className=\\\"admin-page\\\">\n      <Suspense fallback={<Loader />}>\n        <AdminDashboard />\n      </Suspense>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":33,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/page.tsx":{
    "content":"'use client';\n\nimport { useSearchParams } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport FadeIn from '../components/fade-in/FadeIn';\nimport { PageAside } from '../components/page-aside/PageAside';\nimport { PageContainer } from '../components/page-container/PageContainer';\nimport PageContent from '../components/page-content/PageContent';\nimport PageHeader from '../components/page-header/PageHeader';\nimport { GenerationDisplay } from './components/GenerationDisplay';\nimport { GenerationForm } from './components/GenerationForm';\nimport { MysticalLoader } from './components/MysticalLoader';\nimport { QuotaDisplay } from './components/QuotaDisplay';\nimport { RegenerationDialog } from './components/RegenerationDialog';\nimport { WelcomeInterface } from './components/WelcomeInterface';\nimport { ASPECT_RATIO_OPTIONS } from './constants/aspectRatios';\nimport { useFormState } from './hooks/useFormState';\nimport { useGenerationLoader } from './hooks/useGenerationLoader';\nimport { useImageGeneration } from './hooks/useImageGeneration';\nimport { useQuotaTracking } from './hooks/useQuotaTracking';\nimport { useWelcomeFlow } from './hooks/useWelcomeFlow';\nimport styles from './page.module.css';\nimport { GenerationOptions } from './types/generation';\nimport {\n  convertSvgToPng,\n  downloadFile,\n  generateFilename\n} from './utils/fileUtils';\n\nexport default function OgImageViewer() {\n  const searchParams = useSearchParams();\n\n  // Core state\n  const [svgContent, setSvgContent] = useState<string>('');\n  const [selectedRatio, setSelectedRatio] = useState<string>('default');\n  const [currentGenerationId, setCurrentGenerationId] = useState<string>('');\n  const [error, setError] = useState<string>('');\n  const [isLoadedGeneration, setIsLoadedGeneration] = useState<boolean>(false);\n\n  // Advanced options state for Pro features\n  const [advancedOptions, setAdvancedOptions] = useState<\n    Partial<GenerationOptions>\n  >({});\n\n  // Custom hooks for clean separation of concerns\n  const { formState, setFormState, updateField, clearFormState } =\n    useFormState();\n  const [isFormCollapsed, setIsFormCollapsed] = useState(true);\n  const quotaState = useQuotaTracking();\n  const welcomeFlow = useWelcomeFlow();\n  const generationLoader = useGenerationLoader({\n    setFormState,\n    setSvgContent,\n    setSelectedRatio,\n    setError,\n    // Callback when generation is loaded - keep form collapsed and mark as loaded\n    onGenerationLoaded: () => {\n      setIsFormCollapsed(true);\n      setIsLoadedGeneration(true);\n    }\n  });\n\n  // Sync aspect ratio changes with form fields\n  useEffect(() => {\n    const aspectConfig = ASPECT_RATIO_OPTIONS.find(\n      (opt) => opt.key === selectedRatio\n    );\n    if (aspectConfig) {\n      updateField('customWidth', aspectConfig.width.toString());\n      updateField('customHeight', aspectConfig.height.toString());\n    }\n  }, [selectedRatio, updateField]);\n\n  // Image generation hook\n  const {\n    isGenerating,\n    generationOptions,\n    handleGenerate,\n    handleRandomize,\n    clearGeneration,\n    showRegenerationDialog,\n    handleRegenerationChoice,\n    handleCloseRegenerationDialog\n  } = useImageGeneration({\n    currentSeed: formState.currentSeed,\n    avatarSeed: formState.avatarSeed,\n    selectedRatio,\n    customQuote: formState.customQuote,\n    customAuthor: formState.customAuthor,\n    customWidth: formState.customWidth,\n    customHeight: formState.customHeight,\n    shapeCount: formState.shapeCount,\n    isQuotaExceeded: quotaState.isQuotaExceeded,\n    advancedOptions: advancedOptions,\n    setCurrentSeed: (seed) => updateField('currentSeed', seed),\n    setAvatarSeed: (seed) => updateField('avatarSeed', seed),\n    setCustomQuote: (quote) => updateField('customQuote', quote),\n    setCustomAuthor: (author) => updateField('customAuthor', author),\n    setCustomWidth: (width) => updateField('customWidth', width),\n    setCustomHeight: (height) => updateField('customHeight', height),\n    setShapeCount: (count) => updateField('shapeCount', count),\n    setCurrentGenerationId: (id) => {\n      setCurrentGenerationId(id);\n      // Auto-collapse form after successful generation\n      if (id) {\n        setIsFormCollapsed(true);\n        setIsLoadedGeneration(false); // Mark as new generation\n      }\n    },\n    setRemainingGenerations: (count: number, limit?: number) =>\n      quotaState.updateQuota(count, limit),\n    setHasInitializedQuota: () => {}, // Handled by quota hook\n    setSvgContent\n  });\n\n  // ALWAYS clear form when starting new generation - no exceptions\n  const handleNewGeneration = () => {\n    // FIRST: Clear ALL form state completely\n    clearFormState();\n    setAdvancedOptions({});\n    setSelectedRatio('default');\n    clearGeneration();\n\n    // SECOND: Clear all generation display state\n    setSvgContent('');\n    setCurrentGenerationId('');\n    setError('');\n\n    // THIRD: Set UI state for new generation\n    welcomeFlow.handleNewGeneration();\n    setIsFormCollapsed(false);\n    setIsLoadedGeneration(false);\n  };\n\n  // Handle copy generation ID\n  const handleCopyId = () => {\n    navigator.clipboard.writeText(currentGenerationId);\n  };\n\n  // Load generation by ID from URL (only for direct links)\n  useEffect(() => {\n    const generationIdFromUrl = searchParams.get('id');\n    if (generationIdFromUrl && generationIdFromUrl !== currentGenerationId) {\n      // FIRST: Clear form before loading\n      clearFormState();\n      setAdvancedOptions({});\n      setSelectedRatio('default');\n      clearGeneration();\n      setSvgContent('');\n      setCurrentGenerationId('');\n      setError('');\n\n      // SECOND: Load the generation\n      generationLoader.loadGeneration(generationIdFromUrl).then((id) => {\n        if (id) {\n          setCurrentGenerationId(id);\n          setIsLoadedGeneration(true); // Mark as loaded generation\n        }\n      });\n    }\n  }, [searchParams, currentGenerationId]);\n\n  // Initialize form state on component mount - ensure clean start unless loading generation\n  useEffect(() => {\n    const generationIdFromUrl = searchParams.get('id');\n\n    // Only clear form if we're not loading a specific generation\n    if (!generationIdFromUrl) {\n      clearFormState();\n      setSelectedRatio('default');\n      setAdvancedOptions({});\n      setSvgContent('');\n      setCurrentGenerationId('');\n      setError('');\n      setIsLoadedGeneration(false);\n      clearGeneration(); // Clear generation hook state including lastGenerationParams\n    }\n  }, []); // Run only once on mount\n\n  // Download handlers\n  const handleSaveAsPng = async () => {\n    try {\n      const pngBlob = await convertSvgToPng(svgContent);\n      downloadFile(\n        pngBlob,\n        generateFilename('png', formState.currentSeed, selectedRatio)\n      );\n    } catch (err) {\n      setError('Failed to convert to PNG. Please try again.');\n    }\n  };\n\n  const handleSaveAsSvg = () => {\n    if (!svgContent) {\n      setError('No SVG content available');\n      return;\n    }\n\n    const svgBlob = new Blob([svgContent], { type: 'image/svg+xml' });\n    downloadFile(\n      svgBlob,\n      generateFilename('svg', formState.currentSeed, selectedRatio)\n    );\n  };\n\n  // ALWAYS clear form and image when returning to welcome - no exceptions\n  useEffect(() => {\n    if (welcomeFlow.showWelcome) {\n      // Force clear ALL state when returning to welcome - no conditions\n      clearFormState();\n      clearGeneration();\n      setSvgContent('');\n      setCurrentGenerationId('');\n      setSelectedRatio('default');\n      setError('');\n      setIsFormCollapsed(true);\n      setIsLoadedGeneration(false);\n      setAdvancedOptions({});\n    }\n  }, [welcomeFlow.showWelcome]);\n\n  // Cleanup on component unmount\n  useEffect(() => {\n    return () => {\n      // Clear all state when component unmounts (navigation away from page)\n      clearFormState();\n      clearGeneration();\n      welcomeFlow.clearWelcomeFlow();\n      setSvgContent('');\n      setCurrentGenerationId('');\n      setError('');\n    };\n  }, [clearFormState, clearGeneration, welcomeFlow.clearWelcomeFlow]);\n\n  // Loading states\n  if (generationLoader.isLoading) {\n    return (\n      <PageContainer>\n        <PageHeader>\n          <FadeIn>\n            <h2>\ud83e\uddd9\u200d\u2642\ufe0f Mystical Card Generator</h2>\n            <p>\n              Retrieving your enchanted creation from the mystical archives...\n            </p>\n          </FadeIn>\n        </PageHeader>\n        <PageContent>\n          <MysticalLoader message=\\\"Summoning your previous generation from the ancient archives...\\\" />\n        </PageContent>\n      </PageContainer>\n    );\n  }\n\n  if (error) {\n    return (\n      <PageContainer>\n        <PageHeader>\n          <FadeIn>\n            <h2>Card Generator</h2>\n            <p>Error: {error}</p>\n            <button\n              onClick={() => setError('')}\n              className={styles.header__button}\n            >\n              Try Again\n            </button>\n          </FadeIn>\n        </PageHeader>\n      </PageContainer>\n    );\n  }\n\n  return (\n    <PageContainer>\n      <PageHeader>\n        <FadeIn>\n          <div\n            className={`${styles.header__content} ${styles.header__centered}`}\n          >\n            <div className={styles.header__text}>\n              <h1>\ud83e\uddd9\u200d\u2642\ufe0f Mystical Card Generator</h1>\n              <p>\n                {welcomeFlow.showWelcome\n                  ? 'Harness ancient wisdom to forge enchanted social media cards'\n                  : 'Channel mystical energies into beautiful social media cards'}\n              </p>\n            </div>\n\n            {!welcomeFlow.showWelcome && (\n              <div className={styles.header__controls}>\n                <div className={styles.header__buttons}>\n                  <button\n                    onClick={welcomeFlow.returnToWelcome}\n                    className={`${styles.header__button} ${styles['header__button--welcome']}`}\n                    title=\\\"Back to welcome\\\"\n                  >\n                    \u2190 Welcome\n                  </button>\n                  <button\n                    onClick={handleSaveAsPng}\n                    className={`${styles.header__button} ${styles['header__button--png']}`}\n                    title=\\\"PNG - Raster image, best for social media\\\"\n                    disabled={!svgContent}\n                  >\n                    \ud83d\udce5 PNG\n                  </button>\n                  <button\n                    onClick={handleSaveAsSvg}\n                    className={`${styles.header__button} ${styles['header__button--svg']}`}\n                    title=\\\"SVG - Vector image, scalable and smaller\\\"\n                    disabled={!svgContent}\n                  >\n                    \ud83d\udce5 SVG\n                  </button>\n                  {/* Mobile Quota Display - only visible when aside is hidden */}\n                  <div className={styles.mobile__quota__display}>\n                    <QuotaDisplay\n                      remainingGenerations={quotaState.remainingGenerations}\n                      quotaLimit={quotaState.quotaLimit}\n                      hasInitializedQuota={quotaState.hasInitializedQuota}\n                      isQuotaExceeded={quotaState.isQuotaExceeded}\n                      resetDate={quotaState.resetDate}\n                      showMeter\n                      mobile\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </FadeIn>\n      </PageHeader>\n\n      <PageContent>\n        {welcomeFlow.showWelcome ? (\n          <FadeIn>\n            <WelcomeInterface\n              remainingGenerations={quotaState.remainingGenerations}\n              quotaLimit={quotaState.quotaLimit}\n              hasInitializedQuota={quotaState.hasInitializedQuota}\n              isQuotaExceeded={quotaState.isQuotaExceeded}\n              resetDate={quotaState.resetDate}\n              loadGenerationId={welcomeFlow.loadGenerationId}\n              setLoadGenerationId={welcomeFlow.setLoadGenerationId}\n              onNewGeneration={handleNewGeneration}\n              onLoadGeneration={welcomeFlow.handleLoadGeneration}\n            />\n          </FadeIn>\n        ) : (\n          <article className={styles.viewer__container}>\n            <FadeIn className={styles.viewer__container_fade}>\n              <GenerationForm\n                currentSeed={formState.currentSeed}\n                setCurrentSeed={(seed) => updateField('currentSeed', seed)}\n                avatarSeed={formState.avatarSeed}\n                setAvatarSeed={(seed) => updateField('avatarSeed', seed)}\n                customQuote={formState.customQuote}\n                setCustomQuote={(quote) => updateField('customQuote', quote)}\n                customAuthor={formState.customAuthor}\n                setCustomAuthor={(author) =>\n                  updateField('customAuthor', author)\n                }\n                customWidth={formState.customWidth}\n                setCustomWidth={(width) => updateField('customWidth', width)}\n                customHeight={formState.customHeight}\n                setCustomHeight={(height) =>\n                  updateField('customHeight', height)\n                }\n                shapeCount={formState.shapeCount}\n                setShapeCount={(count) => updateField('shapeCount', count)}\n                isQuotaExceeded={quotaState.isQuotaExceeded}\n                isGenerating={isGenerating}\n                onGenerate={handleGenerate}\n                onRandomize={handleRandomize}\n                isCollapsed={isFormCollapsed}\n                onToggleCollapse={() => setIsFormCollapsed(!isFormCollapsed)}\n                selectedRatio={\n                  ASPECT_RATIO_OPTIONS.find((r) => r.key === selectedRatio) ||\n                  ASPECT_RATIO_OPTIONS[0]\n                }\n                onRatioChange={(ratio) => setSelectedRatio(ratio.key)}\n                aspectRatioOptions={ASPECT_RATIO_OPTIONS}\n                generationOptions={generationOptions}\n                advancedOptions={advancedOptions}\n                onAdvancedOptionsChange={setAdvancedOptions}\n                isProUser={false} // TODO: Connect to actual Pro user status\n                isReadOnly={isLoadedGeneration}\n              />\n\n              <GenerationDisplay\n                generationId={currentGenerationId}\n                svgContent={svgContent}\n                onCopyId={handleCopyId}\n              />\n            </FadeIn>\n          </article>\n        )}\n      </PageContent>\n\n      <PageAside className={styles.features_aside} bottomMargin={10}>\n        <FadeIn>\n          <QuotaDisplay\n            remainingGenerations={quotaState.remainingGenerations}\n            quotaLimit={quotaState.quotaLimit}\n            hasInitializedQuota={quotaState.hasInitializedQuota}\n            isQuotaExceeded={quotaState.isQuotaExceeded}\n            resetDate={quotaState.resetDate}\n            showMeter\n          />\n\n          {/* Mystical Codex */}\n          <div className={styles.features__section}>\n            <h3>\ud83d\udcdc Arcane Knowledge</h3>\n            <div className={styles.features__grid}>\n              <div className={styles.feature__card}>\n                <h4>\n                  <span className={styles.feature__icon}>\ud83c\udfaf</span>\n                  Pro Tips\n                </h4>\n                <p>\n                  Use custom seeds for reproducible results. Save your\n                  Generation ID to retrieve previous generations!\n                </p>\n              </div>\n              <div className={styles.feature__card}>\n                <h4>\n                  <span className={styles.feature__icon}>\u2699\ufe0f</span>\n                  Advanced Magic\n                </h4>\n                <p>\n                  Unlock custom quotes, dimensions, and shape counts with Pro\n                  subscription (coming soon) for unlimited creativity.\n                </p>\n              </div>\n              <div className={styles.feature__card}>\n                <h4>\n                  <span className={styles.feature__icon}>\ud83d\udcf1</span>\n                  Perfect Formats\n                </h4>\n                <p>\n                  Choose from 7+ aspect ratios: Instagram, YouTube, LinkedIn,\n                  Twitter, Facebook, and more!\n                </p>\n              </div>\n              <div className={styles.feature__card}>\n                <h4>\n                  <span className={styles.feature__icon}>\ud83d\udcbe</span>\n                  Export Options\n                </h4>\n                <p>\n                  Download as PNG for social media or SVG for scalable vector\n                  graphics. Both formats supported!\n                </p>\n              </div>\n              <div className={styles.feature__card}>\n                <h4>\n                  <span className={styles.feature__icon}>\ud83d\udd04</span>\n                  Generation History\n                </h4>\n                <p>\n                  Every creation gets a unique ID. Load previous generations\n                  anytime using the ID lookup feature.\n                </p>\n              </div>\n              <div className={styles.feature__card}>\n                <h4>\n                  <span className={styles.feature__icon}>\ud83c\udfa8</span>\n                  Sacred Geometry\n                </h4>\n                <p>\n                  Algorithmically generated patterns based on mathematical\n                  principles and mystical symbolism.\n                </p>\n              </div>\n            </div>\n          </div>\n        </FadeIn>\n      </PageAside>\n\n      {/* Regeneration Dialog */}\n      <RegenerationDialog\n        isOpen={showRegenerationDialog}\n        onChoice={handleRegenerationChoice}\n        onClose={handleCloseRegenerationDialog}\n      />\n    </PageContainer>\n  );\n}\n",
    "language":"typescript",
    "lines":489,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/coins/page.tsx":{
    "content":"import { auth } from '../../lib/auth';\nimport { Card } from '../components/card/Card';\nimport Coin from '../components/coin/Coin';\n\nexport default async function Coins() {\n  const session = await auth();\n\n  return (\n    <article>\n      <Card width=\\\"min\\\">\n        <Coin seed={session?.user?.name || ''} />\n      </Card>\n    </article>\n  );\n}\n",
    "language":"typescript",
    "lines":16,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/profile/[username]/page.tsx":{
    "content":"import { notFound } from 'next/navigation';\nimport { getUserProfileByDatabaseId } from '../../../lib/actions/profile.actions';\nimport { auth } from '../../../lib/auth';\nimport {\n  cleanContentForSocialSharing,\n  extractEmbedUrls,\n  getFirstYouTubeUrl\n} from '../../../lib/utils/social-sharing';\nimport { Card } from '../../components/card/Card';\nimport FadeIn from '../../components/fade-in/FadeIn';\nimport { PageAside } from '../../components/page-aside/PageAside';\nimport { PageContainer } from '../../components/page-container/PageContainer';\nimport PageContent from '../../components/page-content/PageContent';\nimport { ProfilePageClient } from './ProfilePageClient';\nimport './profile-page.css';\n\ninterface ProfilePageProps {\n  params: {\n    username: string;\n  };\n}\n\nexport default async function ProfilePage({ params }: ProfilePageProps) {\n  const { username } = params;\n\n  // Decode username in case it contains special characters\n  const decodedUsername = decodeURIComponent(username);\n\n  try {\n    // \u2705 CRITICAL: Only database ID-based URLs supported after migration 0010\n    // Username-based URLs are no longer supported for maximum reliability\n    if (!/^\\\\d+$/.test(decodedUsername)) {\n      // Not a database ID - return 404 instead of trying username lookup\n      notFound();\n    }\n\n    // Direct database ID lookup - only supported method\n    const userProfile = await getUserProfileByDatabaseId(decodedUsername);\n    const session = await auth();\n\n    if (!userProfile) {\n      notFound();\n    }\n\n    // Check if this is the user's own profile\n    // Convert both IDs to strings for proper comparison\n    const isOwnProfile =\n      session?.user?.id?.toString() === userProfile.id?.toString();\n\n    // Check if profile is private and user is not the owner\n    const isPrivateProfile = userProfile.profile_public === false;\n    const canViewProfile = isOwnProfile || !isPrivateProfile;\n\n    // If profile is private and user is not the owner, show private profile message\n    if (!canViewProfile) {\n      return (\n        <div\n          style={{\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            minHeight: '70vh',\n            padding: '2rem',\n            width: '100%'\n          }}\n        >\n          <div\n            style={{\n              maxWidth: '600px',\n              width: '100%'\n            }}\n          >\n            <article className=\\\"profile-page\\\">\n              <FadeIn className=\\\"profile-page__fade\\\">\n                <Card width=\\\"full\\\" className=\\\"profile-page__main-card\\\">\n                  <div className=\\\"profile-page__private-notice\\\">\n                    <div className=\\\"profile-page__private-icon\\\">\ud83d\udd12</div>\n                    <h2 className=\\\"profile-page__private-title\\\">\n                      Private Profile\n                    </h2>\n                    <p className=\\\"profile-page__private-message\\\">\n                      This user has set their profile to private. Only they can\n                      view their profile information.\n                    </p>\n                    <div className=\\\"profile-page__private-actions\\\">\n                      <a href=\\\"/posts\\\" className=\\\"profile-page__private-link\\\">\n                        \u2190 Browse Posts\n                      </a>\n                    </div>\n                  </div>\n                </Card>\n              </FadeIn>\n            </article>\n          </div>\n        </div>\n      );\n    }\n\n    const joinDate = userProfile.created_at\n      ? new Date(userProfile.created_at).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric'\n        })\n      : null;\n\n    const lastActivity = userProfile.last_activity\n      ? new Date(userProfile.last_activity).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric'\n        })\n      : null;\n\n    return (\n      <PageContainer>\n        <PageContent>\n          <article className=\\\"profile-page\\\">\n            <FadeIn className=\\\"profile-page__fade\\\">\n              <Card width=\\\"full\\\" className=\\\"profile-page__main-card\\\">\n                <ProfilePageClient\n                  userProfile={userProfile}\n                  isOwnProfile={isOwnProfile}\n                />\n              </Card>\n            </FadeIn>\n          </article>\n        </PageContent>\n\n        <PageAside className=\\\"profile-page__aside\\\" bottomMargin={10}>\n          <FadeIn>\n            <Card width=\\\"full\\\">\n              <h3 className=\\\"profile-page__aside-title\\\">Profile Info</h3>\n              <div className=\\\"profile-page__info-grid\\\">\n                {joinDate && (\n                  <div className=\\\"profile-page__info-item\\\">\n                    <span className=\\\"profile-page__info-icon\\\">\ud83d\udcc5</span>\n                    <div className=\\\"profile-page__info-content\\\">\n                      <span className=\\\"profile-page__info-label\\\">Joined</span>\n                      <span className=\\\"profile-page__info-value\\\">\n                        {joinDate}\n                      </span>\n                    </div>\n                  </div>\n                )}\n\n                {lastActivity && (\n                  <div className=\\\"profile-page__info-item\\\">\n                    <span className=\\\"profile-page__info-icon\\\">\ud83d\udd25</span>\n                    <div className=\\\"profile-page__info-content\\\">\n                      <span className=\\\"profile-page__info-label\\\">\n                        Last Active\n                      </span>\n                      <span className=\\\"profile-page__info-value\\\">\n                        {lastActivity}\n                      </span>\n                    </div>\n                  </div>\n                )}\n\n                <div className=\\\"profile-page__info-item\\\">\n                  <span className=\\\"profile-page__info-icon\\\">\ud83d\udcca</span>\n                  <div className=\\\"profile-page__info-content\\\">\n                    <span className=\\\"profile-page__info-label\\\">\n                      Total Posts\n                    </span>\n                    <span className=\\\"profile-page__info-value\\\">\n                      {userProfile.total_submissions || 0}\n                    </span>\n                  </div>\n                  <a\n                    href={`/posts?author=${userProfile.id}`}\n                    className=\\\"profile-page__info-link\\\"\n                    title=\\\"View all posts by this user\\\"\n                  >\n                    View All \u2192\n                  </a>\n                </div>\n\n                <div className=\\\"profile-page__info-item\\\">\n                  <span className=\\\"profile-page__info-icon\\\">\ud83d\udcac</span>\n                  <div className=\\\"profile-page__info-content\\\">\n                    <span className=\\\"profile-page__info-label\\\">Replies</span>\n                    <span className=\\\"profile-page__info-value\\\">\n                      {userProfile.replies_count || 0}\n                    </span>\n                  </div>\n                  <a\n                    href={`/posts?author=${userProfile.id}&onlyReplies=true`}\n                    className=\\\"profile-page__info-link\\\"\n                    title=\\\"View only replies by this user\\\"\n                  >\n                    View Replies \u2192\n                  </a>\n                </div>\n\n                <div className=\\\"profile-page__info-item\\\">\n                  <span className=\\\"profile-page__info-icon\\\">\ud83c\udf1f</span>\n                  <div className=\\\"profile-page__info-content\\\">\n                    <span className=\\\"profile-page__info-label\\\">Profile</span>\n                    <span className=\\\"profile-page__info-value\\\">\n                      {userProfile.profile_public !== false\n                        ? 'Public'\n                        : 'Private'}\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              {isOwnProfile && (\n                <div className=\\\"profile-page__owner-actions\\\">\n                  <div className=\\\"profile-page__owner-note\\\">\n                    <span className=\\\"profile-page__owner-icon\\\">\u2139\ufe0f</span>\n                    <p>\n                      This is your profile. You can edit your bio in the main\n                      section.\n                    </p>\n                  </div>\n                </div>\n              )}\n            </Card>\n          </FadeIn>\n        </PageAside>\n      </PageContainer>\n    );\n  } catch (error) {\n    console.error('Error loading profile page:', error);\n\n    // If it's a database connection error or other server error,\n    // show the not found page rather than crashing\n    notFound();\n  }\n}\n\n// Generate metadata for the page\nexport async function generateMetadata({ params }: ProfilePageProps) {\n  const { username } = params;\n  const decodedUsername = decodeURIComponent(username);\n\n  try {\n    // \u2705 Only database ID-based URLs supported after migration 0010\n    if (!/^\\\\d+$/.test(decodedUsername)) {\n      return {\n        title: 'Invalid Profile URL | Idling.app',\n        description: 'Profile URLs must use database IDs only.',\n        robots: 'noindex, nofollow'\n      };\n    }\n\n    // Direct database ID lookup\n    const userProfile = await getUserProfileByDatabaseId(decodedUsername);\n\n    if (!userProfile) {\n      return {\n        title: 'User Not Found | Idling.app',\n        description: 'The requested user profile could not be found.',\n        robots: 'noindex, nofollow' // Don't index not found pages\n      };\n    }\n\n    // Check if profile is private\n    const isPrivateProfile = userProfile.profile_public === false;\n\n    if (isPrivateProfile) {\n      return {\n        title: 'Private Profile | Idling.app',\n        description: 'This user has set their profile to private.',\n        robots: 'noindex, nofollow' // Don't index private profiles\n      };\n    }\n\n    const displayName =\n      userProfile.username || userProfile.name || 'Anonymous User';\n\n    // Check for YouTube URLs and other embeds in the bio for enhanced social sharing\n    const youtubeUrl = userProfile.bio\n      ? getFirstYouTubeUrl(userProfile.bio)\n      : null;\n    const embedUrls = userProfile.bio ? extractEmbedUrls(userProfile.bio) : [];\n\n    // Determine the best description based on available rich media\n    let cleanBioForSocial: string | null = null;\n    let hasRichMedia = false;\n\n    if (userProfile.bio) {\n      if (\n        youtubeUrl ||\n        (embedUrls.length > 0 && embedUrls.some((url) => isImageUrl(url)))\n      ) {\n        // If we have rich media, strip embeds from description to avoid redundancy\n        cleanBioForSocial = cleanContentForSocialSharing(userProfile.bio, {\n          removeEmbeds: true, // Remove embeds since we're showing them as rich media\n          maxLength: 160\n        });\n        hasRichMedia = true;\n      } else {\n        // No rich media, convert embeds to URLs for readable descriptions\n        cleanBioForSocial = cleanContentForSocialSharing(userProfile.bio, {\n          convertEmbedsToUrls: true, // Convert ![embed](url) to just url\n          maxLength: 160\n        });\n      }\n    }\n\n    const fallbackDescription = `View ${displayName}'s profile, activity stats, and contributions on Idling.app.`;\n\n    // Base metadata\n    const baseMetadata = {\n      title: `${displayName} - User Profile | Idling.app`,\n      description: cleanBioForSocial || fallbackDescription\n    };\n\n    // Enhanced Open Graph metadata\n    const openGraphMetadata: any = {\n      title: `${displayName} - Profile`,\n      description:\n        cleanBioForSocial ||\n        `View ${displayName}'s profile and activity on Idling.app.`,\n      type: 'profile',\n      siteName: 'Idling.app',\n      url: `https://idling.app/profile/${decodedUsername}`\n    };\n\n    // Enhanced Twitter Card metadata\n    const twitterMetadata: any = {\n      card: 'summary',\n      title: `${displayName} - Profile`,\n      description:\n        cleanBioForSocial ||\n        `View ${displayName}'s profile and activity on Idling.app.`,\n      site: '@idlingapp' // Update with your actual Twitter handle\n    };\n\n    // If there's a YouTube URL, enhance the metadata for rich video embeds\n    if (youtubeUrl) {\n      // Extract video ID for enhanced metadata\n      const videoId = extractYouTubeVideoId(youtubeUrl);\n\n      if (videoId) {\n        // Use larger card type for video content\n        twitterMetadata.card = 'player';\n        twitterMetadata.player = `https://www.youtube.com/embed/${videoId}`;\n        twitterMetadata.playerWidth = 560;\n        twitterMetadata.playerHeight = 315;\n\n        // Add video-specific Open Graph metadata\n        openGraphMetadata.type = 'video.other';\n        openGraphMetadata.video = `https://www.youtube.com/embed/${videoId}`;\n        openGraphMetadata.videoSecureUrl = `https://www.youtube.com/embed/${videoId}`;\n        openGraphMetadata.videoType = 'text/html';\n        openGraphMetadata.videoWidth = 560;\n        openGraphMetadata.videoHeight = 315;\n\n        // Add YouTube thumbnail as image\n        openGraphMetadata.images = [\n          {\n            url: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,\n            width: 1280,\n            height: 720,\n            alt: `YouTube video from ${displayName}'s profile`\n          }\n        ];\n\n        twitterMetadata.image = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;\n      }\n    } else if (embedUrls.length > 0) {\n      // Check for image embeds in order of preference\n      const imageUrls = embedUrls.filter((url) => isImageUrl(url));\n\n      if (imageUrls.length > 0) {\n        const firstImageUrl = imageUrls[0];\n        openGraphMetadata.images = [\n          {\n            url: firstImageUrl,\n            alt: `Image from ${displayName}'s profile`\n          }\n        ];\n        twitterMetadata.card = 'summary_large_image';\n        twitterMetadata.image = firstImageUrl;\n      }\n    }\n\n    return {\n      ...baseMetadata,\n      openGraph: openGraphMetadata,\n      twitter: twitterMetadata\n    };\n  } catch (error) {\n    console.error('Error generating metadata for profile page:', error);\n\n    // Fallback metadata for error cases\n    return {\n      title: 'Profile | Idling.app',\n      description: 'User profile page on Idling.app',\n      robots: 'noindex, nofollow' // Don't index error pages\n    };\n  }\n}\n\n/**\n * Extract YouTube video ID from various YouTube URL formats\n */\nfunction extractYouTubeVideoId(url: string): string | null {\n  const patterns = [\n    /(?:youtube\\\\.com\\\\/watch\\\\?v=|youtu\\\\.be\\\\/)([^&\\\\n?#]+)/,\n    /youtube\\\\.com\\\\/embed\\\\/([^&\\\\n?#]+)/,\n    /youtube\\\\.com\\\\/v\\\\/([^&\\\\n?#]+)/\n  ];\n\n  for (const pattern of patterns) {\n    const match = url.match(pattern);\n    if (match) return match[1];\n  }\n  return null;\n}\n\n/**\n * Check if URL is likely an image\n */\nfunction isImageUrl(url: string): boolean {\n  return /\\\\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|avif|tiff|tif)(\\\\?.*)?$/i.test(\n    url\n  );\n}\n",
    "language":"typescript",
    "lines":425,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/test-redirect/page.tsx":{
    "content":"'use client';\n\nexport default function TestRedirect() {\n  const testRedirect = () => {\n    // This should redirect to /og-image-viewer when accessed from a browser\n    window.open('/api/og-image?seed=test-123', '_blank');\n  };\n\n  const testDirect = () => {\n    // This should show the image directly\n    window.open('/api/og-image?seed=test-123&direct=true', '_blank');\n  };\n\n  return (\n    <div className=\\\"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4\\\">\n      <div className=\\\"max-w-2xl mx-auto\\\">\n        <h1 className=\\\"text-3xl font-bold text-gray-900 dark:text-white mb-8 text-center\\\">\n          Test OG Image Redirect\n        </h1>\n\n        <div className=\\\"space-y-4\\\">\n          <div className=\\\"bg-white dark:bg-gray-800 rounded-lg p-6\\\">\n            <h2 className=\\\"text-xl font-semibold text-gray-900 dark:text-white mb-4\\\">\n              Browser Redirect Test\n            </h2>\n            <p className=\\\"text-gray-600 dark:text-gray-400 mb-4\\\">\n              This should redirect to the OG Image Viewer page:\n            </p>\n            <button\n              onClick={testRedirect}\n              className=\\\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\\\"\n            >\n              Test Redirect: /api/og-image\n            </button>\n          </div>\n\n          <div className=\\\"bg-white dark:bg-gray-800 rounded-lg p-6\\\">\n            <h2 className=\\\"text-xl font-semibold text-gray-900 dark:text-white mb-4\\\">\n              Direct API Test\n            </h2>\n            <p className=\\\"text-gray-600 dark:text-gray-400 mb-4\\\">\n              This should show the image directly (bypassing redirect):\n            </p>\n            <button\n              onClick={testDirect}\n              className=\\\"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600\\\"\n            >\n              Test Direct: /api/og-image?direct=true\n            </button>\n          </div>\n\n          <div className=\\\"bg-white dark:bg-gray-800 rounded-lg p-6\\\">\n            <h2 className=\\\"text-xl font-semibold text-gray-900 dark:text-white mb-4\\\">\n              Manual Links\n            </h2>\n            <div className=\\\"space-y-2\\\">\n              <div>\n                <a\n                  href=\\\"/api/og-image?seed=test-123\\\"\n                  target=\\\"_blank\\\"\n                  className=\\\"text-blue-500 hover:text-blue-600 underline\\\"\n                >\n                  /api/og-image?seed=test-123 (should redirect)\n                </a>\n              </div>\n              <div>\n                <a\n                  href=\\\"/api/og-image?seed=test-123&direct=true\\\"\n                  target=\\\"_blank\\\"\n                  className=\\\"text-green-500 hover:text-green-600 underline\\\"\n                >\n                  /api/og-image?seed=test-123&direct=true (direct)\n                </a>\n              </div>\n              <div>\n                <a\n                  href=\\\"/og-image-viewer?seed=test-123\\\"\n                  target=\\\"_blank\\\"\n                  className=\\\"text-purple-500 hover:text-purple-600 underline\\\"\n                >\n                  /og-image-viewer?seed=test-123 (viewer directly)\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":91,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/subscription/page.tsx":{
    "content":"'use client';\n\nimport { useSearchParams } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport FadeIn from '../components/fade-in/FadeIn';\nimport { PageContainer } from '../components/page-container/PageContainer';\nimport PageContent from '../components/page-content/PageContent';\nimport PageHeader from '../components/page-header/PageHeader';\nimport { InstantLink } from '../components/ui/InstantLink';\nimport styles from './subscription.module.css';\n\ninterface SubscriptionTier {\n  name: string;\n  price: string;\n  features: string[];\n  dailyLimit: string;\n}\n\ninterface SubscriptionData {\n  tier: SubscriptionTier;\n  message: string;\n  paymentUrl: string;\n  currentLimits: {\n    free: {\n      dailyGenerations: number;\n      advancedOptions: boolean;\n    };\n  };\n}\n\nexport default function SubscriptionPage() {\n  const searchParams = useSearchParams();\n  const [subscriptionData, setSubscriptionData] =\n    useState<SubscriptionData | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n\n  const tier = searchParams.get('tier') || 'pro';\n  const fromQuotaLimit = searchParams.get('from') === 'quota-limit';\n\n  useEffect(() => {\n    const fetchSubscriptionData = async () => {\n      try {\n        setIsLoading(true);\n        const response = await fetch(`/api/subscription?tier=${tier}`);\n\n        if (!response.ok) {\n          throw new Error('Failed to fetch subscription data');\n        }\n\n        const data = await response.json();\n        setSubscriptionData(data);\n      } catch (err) {\n        setError(\n          err instanceof Error\n            ? err.message\n            : 'Failed to load subscription data'\n        );\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchSubscriptionData();\n  }, [tier]);\n\n  if (isLoading) {\n    return (\n      <PageContainer>\n        <PageHeader>\n          <FadeIn>\n            <h2>Subscription Plans</h2>\n            <p>Loading subscription options...</p>\n          </FadeIn>\n        </PageHeader>\n      </PageContainer>\n    );\n  }\n\n  if (error) {\n    return (\n      <PageContainer>\n        <PageHeader>\n          <FadeIn>\n            <h2>Subscription Plans</h2>\n            <p>Error loading subscription data: {error}</p>\n          </FadeIn>\n        </PageHeader>\n      </PageContainer>\n    );\n  }\n\n  return (\n    <PageContainer>\n      <PageHeader>\n        <FadeIn>\n          <div className={styles.header__content}>\n            <h2>Upgrade Your Plan</h2>\n            {fromQuotaLimit ? (\n              <p className={styles.quota__message}>\n                \ud83d\ude80 You&apos;ve reached your daily limit of{' '}\n                {subscriptionData?.currentLimits.free.dailyGenerations}{' '}\n                generations. Upgrade to continue creating amazing images!\n              </p>\n            ) : (\n              <p>\n                Choose a plan that fits your needs and unlock unlimited\n                creativity.\n              </p>\n            )}\n          </div>\n        </FadeIn>\n      </PageHeader>\n\n      <PageContent>\n        <article className={styles.subscription__container}>\n          <FadeIn className={styles.subscription__container_fade}>\n            {/* Current Plan Limits */}\n            <div className={styles.current__plan}>\n              <h3>Current Plan: Free</h3>\n              <div className={styles.plan__limits}>\n                <div className={styles.limit__item}>\n                  <span className={styles.limit__label}>\n                    Daily Generations:\n                  </span>\n                  <span className={styles.limit__value}>\n                    {subscriptionData?.currentLimits.free.dailyGenerations}\n                  </span>\n                </div>\n                <div className={styles.limit__item}>\n                  <span className={styles.limit__label}>Advanced Options:</span>\n                  <span className={styles.limit__value}>\n                    {subscriptionData?.currentLimits.free.advancedOptions\n                      ? 'Enabled'\n                      : 'Disabled'}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Subscription Tier */}\n            {subscriptionData && (\n              <div className={styles.tier__card}>\n                <div className={styles.tier__header}>\n                  <h3 className={styles.tier__name}>\n                    {subscriptionData.tier.name}\n                  </h3>\n                  <div className={styles.tier__price}>\n                    {subscriptionData.tier.price}\n                  </div>\n                </div>\n\n                <div className={styles.tier__features}>\n                  <h4>What you get:</h4>\n                  <ul className={styles.features__list}>\n                    {subscriptionData.tier.features.map((feature, index) => (\n                      <li key={index} className={styles.feature__item}>\n                        \u2713 {feature}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n\n                <div className={styles.tier__actions}>\n                  <button className={styles.upgrade__button} disabled>\n                    Coming Soon - Payment Integration\n                  </button>\n                  <p className={styles.coming__soon}>\n                    Payment processing will be available soon. For now, enjoy\n                    your free daily generations!\n                  </p>\n                </div>\n              </div>\n            )}\n\n            {/* Navigation */}\n            <div className={styles.navigation__section}>\n              <InstantLink href=\\\"/card-generator\\\" className={styles.back__link}>\n                \u2190 Back to Card Generator\n              </InstantLink>\n\n              {fromQuotaLimit && (\n                <div className={styles.quota__info}>\n                  <p>\n                    Your quota will reset tomorrow. Come back then for more free\n                    generations!\n                  </p>\n                </div>\n              )}\n            </div>\n          </FadeIn>\n        </article>\n      </PageContent>\n    </PageContainer>\n  );\n}\n",
    "language":"typescript",
    "lines":197,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/posts/page.tsx":{
    "content":"import { Metadata } from 'next';\nimport { Suspense } from 'react';\nimport { CONTEXT_IDS } from 'src/lib/context-ids';\nimport { CustomSession } from '../../auth.config';\nimport { auth } from '../../lib/auth';\nimport { Card } from '../components/card/Card';\nimport FadeIn from '../components/fade-in/FadeIn';\nimport FloatingAddPost from '../components/floating-add-post/FloatingAddPost';\nimport Loader from '../components/loader/Loader';\nimport { PageAside } from '../components/page-aside/PageAside';\nimport { PageContainer } from '../components/page-container/PageContainer';\nimport PageContent from '../components/page-content/PageContent';\nimport PageHeader from '../components/page-header/PageHeader';\nimport { RecentTags } from '../components/recent-tags/RecentTags';\nimport { RecentTagsLoader } from '../components/recent-tags/RecentTagsClient';\nimport PostsPageClient from './PostsPageClient';\nimport styles from './page.module.css';\n\n// Development-only import that gets tree-shaken in production\nlet DevSkeletonToggle: React.ComponentType | null = null;\n\nif (process.env.NODE_ENV === 'development') {\n  const devModule = require('../components/dev-tools/DevSkeletonToggle');\n  DevSkeletonToggle = devModule.DevSkeletonToggle;\n}\n\nexport const metadata: Metadata = {\n  title: 'Posts - Idling.app',\n  description: 'Browse and discover posts from the community'\n};\n\nexport default async function PostsPage() {\n  const session = (await auth()) as CustomSession | null;\n\n  return (\n    <>\n      <PageContainer>\n        <PageHeader>\n          <FadeIn>\n            <h2>Posts</h2>\n          </FadeIn>\n        </PageHeader>\n        <PageContent>\n          <article className={styles.posts__container}>\n            <FadeIn className={styles.posts__container_fade}>\n              <Card width=\\\"full\\\" className={styles.posts__container_item}>\n                <Suspense fallback={<Loader />}>\n                  {session?.user?.id && (\n                    <PostsPageClient contextId={CONTEXT_IDS.POSTS.toString()} />\n                  )}\n                </Suspense>\n              </Card>\n            </FadeIn>\n          </article>\n        </PageContent>\n\n        <PageAside className={styles.tags_aside} bottomMargin={10}>\n          <FadeIn>\n            <Card width=\\\"full\\\">\n              <Suspense fallback={<RecentTagsLoader />}>\n                <RecentTags contextId={CONTEXT_IDS.POSTS.toString()} />\n              </Suspense>\n            </Card>\n          </FadeIn>\n        </PageAside>\n      </PageContainer>\n\n      {/* Floating buttons positioned at viewport level */}\n      {session?.user?.id && <FloatingAddPost />}\n      {DevSkeletonToggle && <DevSkeletonToggle />}\n    </>\n  );\n}\n",
    "language":"typescript",
    "lines":74,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/t/[submissionId]/page.tsx":{
    "content":"import { Metadata } from 'next';\nimport { notFound } from 'next/navigation';\nimport {\n  cleanContentForSocialSharing,\n  extractEmbedUrls,\n  getFirstYouTubeUrl\n} from '../../../lib/utils/social-sharing';\nimport { Submission } from '../../components/submission-forms/schema';\nimport { getSubmissionThread } from '../../components/thread/actions';\nimport ThreadPageClient from './ThreadPageClient';\n\ninterface ThreadPageProps {\n  params: {\n    submissionId: string;\n  };\n}\n\ninterface ThreadData {\n  parent: Submission | null;\n  replies: Submission[];\n}\n\n// Generate metadata for the thread page including initial post content\nexport async function generateMetadata({\n  params\n}: ThreadPageProps): Promise<Metadata> {\n  const submissionId = parseInt(params.submissionId);\n\n  if (isNaN(submissionId)) {\n    return {\n      title: 'Thread Not Found',\n      description: 'The requested thread could not be found.'\n    };\n  }\n\n  try {\n    const threadData = await getSubmissionThread(submissionId);\n\n    if (!threadData.parent) {\n      return {\n        title: 'Thread Not Found',\n        description: 'The requested thread could not be found.'\n      };\n    }\n\n    const parent = threadData.parent;\n    const title = parent.submission_title || parent.submission_name;\n    const content = parent.submission_name;\n    const author = parent.author || 'Anonymous';\n    const replyCount = threadData.replies.length;\n    const baseUrl = process.env.NEXT_PUBLIC_APP_URL || 'https://idling.app';\n\n    // Combine title and content for comprehensive rich media detection\n    const fullContent = `${title} ${content}`.trim();\n\n    // Clean title and content for social media sharing\n    const cleanTitle = cleanContentForSocialSharing(title, {\n      convertEmbedsToUrls: true,\n      maxLength: 100 // Shorter for titles\n    });\n\n    // Check for YouTube URLs and other embeds in ALL content (title + post content)\n    const youtubeUrl = getFirstYouTubeUrl(fullContent);\n    const embedUrls = extractEmbedUrls(fullContent);\n\n    // Determine the best description based on available rich media\n    let cleanContent: string;\n    let hasRichMedia = false;\n\n    if (\n      youtubeUrl ||\n      (embedUrls.length > 0 && embedUrls.some((url) => isImageUrl(url)))\n    ) {\n      // If we have rich media, strip embeds from description to avoid redundancy\n      cleanContent = cleanContentForSocialSharing(content, {\n        removeEmbeds: true, // Remove embeds since we're showing them as rich media\n        maxLength: 150\n      });\n      hasRichMedia = true;\n    } else {\n      // No rich media, convert embeds to URLs for readable descriptions\n      cleanContent = cleanContentForSocialSharing(content, {\n        convertEmbedsToUrls: true,\n        maxLength: 150\n      });\n    }\n\n    // Enhanced metadata with thread-specific information\n    const metaTitle =\n      replyCount > 0\n        ? `${cleanTitle} (${replyCount} ${replyCount === 1 ? 'reply' : 'replies'}) - Thread Discussion | Idling.app`\n        : `${cleanTitle} - Thread Discussion | Idling.app`;\n\n    // Base Open Graph metadata\n    const openGraphMetadata: any = {\n      title: cleanTitle,\n      description: cleanContent,\n      type: 'article',\n      authors: [author],\n      publishedTime: parent.submission_datetime.toISOString(),\n      tags: parent.tags,\n      siteName: 'Idling.app',\n      url: `${baseUrl}/t/${submissionId}`\n    };\n\n    // Base Twitter Card metadata\n    const twitterMetadata: any = {\n      card: 'summary_large_image',\n      title: cleanTitle,\n      description: cleanContent,\n      creator: `@${author}`,\n      site: '@idlingapp' // Update with your actual Twitter handle\n    };\n\n    // Enhanced metadata for YouTube embeds found anywhere in the thread\n    if (youtubeUrl) {\n      const videoId = extractYouTubeVideoId(youtubeUrl);\n\n      if (videoId) {\n        // Use video player card for Twitter\n        twitterMetadata.card = 'player';\n        twitterMetadata.player = `https://www.youtube.com/embed/${videoId}`;\n        twitterMetadata.playerWidth = 560;\n        twitterMetadata.playerHeight = 315;\n\n        // Add video-specific Open Graph metadata\n        openGraphMetadata.type = 'video.other';\n        openGraphMetadata.video = `https://www.youtube.com/embed/${videoId}`;\n        openGraphMetadata.videoSecureUrl = `https://www.youtube.com/embed/${videoId}`;\n        openGraphMetadata.videoType = 'text/html';\n        openGraphMetadata.videoWidth = 560;\n        openGraphMetadata.videoHeight = 315;\n\n        // Add YouTube thumbnail as image\n        openGraphMetadata.images = [\n          {\n            url: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,\n            width: 1280,\n            height: 720,\n            alt: `YouTube video: ${cleanTitle}`\n          }\n        ];\n\n        twitterMetadata.image = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;\n      }\n    } else if (embedUrls.length > 0) {\n      // Check for image embeds in order of preference\n      const imageUrls = embedUrls.filter((url) => isImageUrl(url));\n\n      if (imageUrls.length > 0) {\n        const firstImageUrl = imageUrls[0];\n        openGraphMetadata.images = [\n          {\n            url: firstImageUrl,\n            alt: `Image from thread: ${cleanTitle}`\n          }\n        ];\n        twitterMetadata.card = 'summary_large_image';\n        twitterMetadata.image = firstImageUrl;\n      }\n    }\n\n    // Generate JSON-LD structured data\n    const jsonLd = {\n      '@context': 'https://schema.org',\n      '@type': 'DiscussionForumPosting',\n      headline: cleanTitle,\n      text: cleanContent,\n      author: {\n        '@type': 'Person',\n        name: author\n      },\n      datePublished: parent.submission_datetime.toISOString(),\n      url: `${baseUrl}/t/${submissionId}`,\n      interactionStatistic: {\n        '@type': 'InteractionCounter',\n        interactionType: 'https://schema.org/ReplyAction',\n        userInteractionCount: replyCount\n      },\n      mainEntityOfPage: {\n        '@type': 'WebPage',\n        '@id': `${baseUrl}/t/${submissionId}`\n      },\n      publisher: {\n        '@type': 'Organization',\n        name: 'Idling.app',\n        url: baseUrl\n      },\n      ...(parent.tags.length > 0 && {\n        keywords: parent.tags.join(', ')\n      }),\n      // Add video metadata to structured data if YouTube video is present\n      ...(youtubeUrl && {\n        video: {\n          '@type': 'VideoObject',\n          name: cleanTitle,\n          description: cleanContent,\n          embedUrl: `https://www.youtube.com/embed/${extractYouTubeVideoId(youtubeUrl)}`,\n          thumbnailUrl: `https://img.youtube.com/vi/${extractYouTubeVideoId(youtubeUrl)}/maxresdefault.jpg`,\n          uploadDate: parent.submission_datetime.toISOString()\n        }\n      })\n    };\n\n    return {\n      title: metaTitle,\n      description: cleanContent,\n      keywords: [\n        'thread',\n        'discussion',\n        'community',\n        'forum',\n        ...parent.tags,\n        author\n      ]\n        .filter(Boolean)\n        .join(', '),\n      authors: [{ name: author }],\n      openGraph: openGraphMetadata,\n      twitter: twitterMetadata,\n      robots: {\n        index: true,\n        follow: true,\n        googleBot: {\n          index: true,\n          follow: true,\n          'max-video-preview': -1,\n          'max-image-preview': 'large',\n          'max-snippet': -1\n        }\n      },\n      other: {\n        'application-ld+json': JSON.stringify(jsonLd)\n      }\n    };\n  } catch (error) {\n    console.error('Error generating thread metadata:', error);\n    return {\n      title: 'Thread - Idling.app',\n      description: 'Join the discussion on Idling.app'\n    };\n  }\n}\n\n/**\n * Extract YouTube video ID from various YouTube URL formats\n */\nfunction extractYouTubeVideoId(url: string): string | null {\n  const patterns = [\n    /(?:youtube\\\\.com\\\\/watch\\\\?v=|youtu\\\\.be\\\\/)([^&\\\\n?#]+)/,\n    /youtube\\\\.com\\\\/embed\\\\/([^&\\\\n?#]+)/,\n    /youtube\\\\.com\\\\/v\\\\/([^&\\\\n?#]+)/\n  ];\n\n  for (const pattern of patterns) {\n    const match = url.match(pattern);\n    if (match) return match[1];\n  }\n  return null;\n}\n\n/**\n * Check if URL is likely an image\n */\nfunction isImageUrl(url: string): boolean {\n  return /\\\\.(jpg|jpeg|png|gif|webp|svg|bmp|ico|avif|tiff|tif)(\\\\?.*)?$/i.test(\n    url\n  );\n}\n\nexport default async function ThreadPage({ params }: ThreadPageProps) {\n  const submissionId = parseInt(params.submissionId);\n\n  if (isNaN(submissionId)) {\n    notFound();\n  }\n\n  // Pre-fetch thread data for SSR\n  let initialThreadData: ThreadData | null = null;\n  try {\n    initialThreadData = await getSubmissionThread(submissionId);\n    if (!initialThreadData.parent) {\n      notFound();\n    }\n  } catch (error) {\n    console.error('Error loading thread data:', error);\n    notFound();\n  }\n\n  return (\n    <ThreadPageClient\n      submissionId={submissionId}\n      initialThreadData={initialThreadData}\n    />\n  );\n}\n",
    "language":"typescript",
    "lines":297,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/game/page.tsx":{
    "content":"import { redirect } from 'next/navigation';\nimport { GameWrapper } from '../components/game/GameWrapper';\nimport styles from '../page.module.css';\n\nexport default function Game() {\n  const isDisabled = true;\n\n  if (isDisabled) {\n    return redirect('/');\n  }\n\n  return (\n    <article className={styles.main}>\n      <GameWrapper />\n    </article>\n  );\n}\n",
    "language":"typescript",
    "lines":18,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/auth/callback/page.tsx":{
    "content":"import { redirect } from 'next/navigation';\nimport { Suspense } from 'react';\nimport { auth } from '../../../lib/auth';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport Loader from '../../components/loader/Loader';\nimport { PageContainer } from '../../components/page-container/PageContainer';\nimport { InstantLink } from '../../components/ui/InstantLink';\nimport { AutoRedirect } from './AutoRedirect';\nimport './callback.css';\n\ninterface CallbackSearchParams {\n  redirect?: string;\n  error?: string;\n  provider?: string;\n  state?: string;\n}\n\n// Component for handling OAuth account linking conflicts\nfunction OAuthAccountConflictHandler({ provider }: { provider?: string }) {\n  const providerName = provider\n    ? provider.charAt(0).toUpperCase() + provider.slice(1)\n    : 'OAuth';\n\n  return (\n    <div className=\\\"callback__error callback__error--account-conflict\\\">\n      <div className=\\\"callback__icon callback__icon--error\\\">\ud83d\udd17</div>\n      <h2 className=\\\"callback__title\\\">Account Already Linked</h2>\n      <div className=\\\"callback__message\\\">\n        <p>\n          The {providerName} account you&apos;re trying to sign in with is\n          already linked to another user account.\n        </p>\n        <p>\n          This usually happens when you&apos;ve previously signed in with a\n          different email address or account.\n        </p>\n      </div>\n\n      <div className=\\\"callback__solutions\\\">\n        <h3>What would you like to do?</h3>\n\n        <div className=\\\"callback__solution-options\\\">\n          <div className=\\\"callback__solution-option\\\">\n            <h4>Option 1: Sign in with your existing account</h4>\n            <p>\n              If you remember your other account, sign in with that instead.\n            </p>\n            <InstantLink\n              href={NAV_PATHS.SIGNIN}\n              className=\\\"callback__button callback__button--primary\\\"\n            >\n              Sign in with different account\n            </InstantLink>\n          </div>\n\n          <div className=\\\"callback__solution-option\\\">\n            <h4>Option 2: Unlink and relink this account</h4>\n            <p>\n              We can help you unlink this {providerName} account from the other\n              user and link it to your current account.\n            </p>\n            <InstantLink\n              href={`/auth/unlink-account?provider=${provider || 'oauth'}`}\n              className=\\\"callback__button callback__button--secondary\\\"\n            >\n              Unlink and relink account\n            </InstantLink>\n          </div>\n\n          <div className=\\\"callback__solution-option\\\">\n            <h4>Option 3: Contact support</h4>\n            <p>\n              If you need help resolving this issue, our support team can assist\n              you.\n            </p>\n            <InstantLink\n              href=\\\"/support\\\"\n              className=\\\"callback__button callback__button--tertiary\\\"\n            >\n              Contact Support\n            </InstantLink>\n          </div>\n        </div>\n      </div>\n\n      <div className=\\\"callback__actions\\\">\n        <InstantLink\n          href={NAV_PATHS.ROOT}\n          className=\\\"callback__button callback__button--secondary\\\"\n        >\n          Go Home\n        </InstantLink>\n      </div>\n    </div>\n  );\n}\n\nfunction CallbackContent({\n  searchParams\n}: {\n  searchParams: CallbackSearchParams;\n}) {\n  const { redirect: redirectTo, error, provider } = searchParams;\n\n  if (error) {\n    // Special handling for OAuth account linking conflicts\n    if (error === 'OAuthAccountNotLinked') {\n      return <OAuthAccountConflictHandler provider={provider} />;\n    }\n\n    return (\n      <div className=\\\"callback__error\\\">\n        <div className=\\\"callback__icon callback__icon--error\\\">\u26a0\ufe0f</div>\n        <h2 className=\\\"callback__title\\\">Authentication Error</h2>\n        <p className=\\\"callback__message\\\">\n          {error === 'OAuthSignin' &&\n            'There was an error with the OAuth sign-in process.'}\n          {error === 'OAuthCallback' &&\n            'There was an error during the OAuth callback.'}\n          {error === 'OAuthCreateAccount' && 'Could not create OAuth account.'}\n          {error === 'EmailCreateAccount' && 'Could not create email account.'}\n          {error === 'Callback' &&\n            'There was an error in the callback handler.'}\n          {error === 'EmailSignin' && 'Check your email for the sign-in link.'}\n          {error === 'CredentialsSignin' && 'Invalid credentials provided.'}\n          {error === 'SessionRequired' && 'Please sign in to access this page.'}\n          {![\n            'OAuthSignin',\n            'OAuthCallback',\n            'OAuthCreateAccount',\n            'EmailCreateAccount',\n            'Callback',\n            'OAuthAccountNotLinked',\n            'EmailSignin',\n            'CredentialsSignin',\n            'SessionRequired'\n          ].includes(error) && 'An unexpected authentication error occurred.'}\n        </p>\n        <div className=\\\"callback__actions\\\">\n          <InstantLink\n            href={NAV_PATHS.SIGNIN}\n            className=\\\"callback__button callback__button--primary\\\"\n          >\n            Try Again\n          </InstantLink>\n          <InstantLink\n            href={NAV_PATHS.ROOT}\n            className=\\\"callback__button callback__button--secondary\\\"\n          >\n            Go Home\n          </InstantLink>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <AutoRedirect redirectTo={redirectTo || NAV_PATHS.ROOT} />\n      <div className=\\\"callback__success\\\">\n        <div className=\\\"callback__icon callback__icon--success\\\">\n          <div className=\\\"callback__spinner\\\"></div>\n        </div>\n        <h2 className=\\\"callback__title\\\">\n          {provider\n            ? `Signing in with ${provider.charAt(0).toUpperCase() + provider.slice(1)}...`\n            : 'Completing sign-in...'}\n        </h2>\n        <p className=\\\"callback__message\\\">\n          Please wait while we finish setting up your account.\n        </p>\n        <div className=\\\"callback__progress\\\">\n          <div className=\\\"callback__progress-bar\\\">\n            <div className=\\\"callback__progress-fill\\\"></div>\n          </div>\n          <span className=\\\"callback__progress-text\\\">\n            Redirecting you shortly...\n          </span>\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default async function CallbackPage({\n  searchParams\n}: {\n  searchParams: CallbackSearchParams;\n}) {\n  const session = await auth();\n\n  // If user is already authenticated, redirect them immediately\n  if (session) {\n    const redirectTo = searchParams.redirect || NAV_PATHS.ROOT;\n    redirect(redirectTo);\n  }\n\n  return (\n    <PageContainer>\n      <div className=\\\"callback__container\\\">\n        <Suspense fallback={<Loader />}>\n          <CallbackContent searchParams={searchParams} />\n        </Suspense>\n      </div>\n    </PageContainer>\n  );\n}\n",
    "language":"typescript",
    "lines":208,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/auth/signin/page.tsx":{
    "content":"import { redirect } from 'next/navigation';\nimport { PageContainer } from 'src/app/components/page-container/PageContainer';\nimport { auth } from '../../../lib/auth';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport { ClientSignIn } from '../../components/auth-buttons/ClientAuthButtons';\nimport { SignInProviders } from '../../components/auth-buttons/types';\nimport { OAuthAccountConflictHandler } from './OAuthAccountConflictHandler';\nimport './page.css';\n\nexport default async function Page({\n  searchParams\n}: {\n  searchParams: Record<string, string>;\n}) {\n  const session = await auth();\n  let providers: SignInProviders[] = ['twitch', 'google'];\n  const redirectTo = searchParams.redirect || NAV_PATHS.ROOT;\n  const error = searchParams.error;\n  const provider = searchParams.provider;\n\n  // Handle OAuth account linking conflicts\n  if (error === 'OAuthAccountNotLinked') {\n    return (\n      <PageContainer>\n        <div className=\\\"signin__container\\\">\n          <OAuthAccountConflictHandler provider={provider} />\n        </div>\n      </PageContainer>\n    );\n  }\n\n  if (session && searchParams.redirect) {\n    redirect(searchParams.redirect);\n  } else if (session && !searchParams.redirect) {\n    redirect(NAV_PATHS.ROOT);\n  }\n\n  return (\n    <PageContainer>\n      <article className=\\\"signin__container\\\">\n        <div className=\\\"signin__header\\\">\n          <h1 className=\\\"signin__title\\\">Welcome to Idling App</h1>\n          <p className=\\\"signin__subtitle\\\">\n            Choose your preferred sign-in method to continue\n          </p>\n        </div>\n        <div className=\\\"signin__providers\\\">\n          {providers.map((provider) => (\n            <ClientSignIn\n              key={provider}\n              provider={provider}\n              redirectTo={redirectTo}\n            />\n          ))}\n        </div>\n      </article>\n    </PageContainer>\n  );\n}\n",
    "language":"typescript",
    "lines":60,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/auth/unlink-account/page.tsx":{
    "content":"import { redirect } from 'next/navigation';\nimport { auth } from '../../../lib/auth';\nimport { NAV_PATHS } from '../../../lib/routes';\nimport { PageContainer } from '../../components/page-container/PageContainer';\nimport { InstantLink } from '../../components/ui/InstantLink';\nimport { UnauthenticatedUnlinkForm } from './UnauthenticatedUnlinkForm';\nimport { UnlinkAccountForm } from './UnlinkAccountForm';\nimport './page.css';\n\ninterface UnlinkAccountSearchParams {\n  provider?: string;\n  redirect?: string;\n}\n\nexport default async function UnlinkAccountPage({\n  searchParams\n}: {\n  searchParams: UnlinkAccountSearchParams;\n}) {\n  const session = await auth();\n  const { provider, redirect: redirectTo } = searchParams;\n\n  // If no provider specified, redirect to callback with error\n  if (!provider) {\n    redirect(`${NAV_PATHS.CALLBACK}?error=OAuthAccountNotLinked`);\n  }\n\n  // If user is not authenticated, show unauthenticated unlink form\n  if (!session) {\n    return (\n      <PageContainer>\n        <div className=\\\"unlink-account__container\\\">\n          <div className=\\\"unlink-account__header\\\">\n            <div className=\\\"unlink-account__icon\\\">\ud83d\udd17</div>\n            <h1 className=\\\"unlink-account__title\\\">Unlink OAuth Account</h1>\n            <p className=\\\"unlink-account__subtitle\\\">\n              Resolve account linking conflicts\n            </p>\n          </div>\n\n          <div className=\\\"unlink-account__content\\\">\n            <div className=\\\"unlink-account__info\\\">\n              <h2>About Account Linking Conflicts</h2>\n              <p>\n                When you try to sign in with an OAuth provider (like Google or\n                Twitch) that&apos;s already linked to another account, we need\n                to resolve this conflict.\n              </p>\n\n              <div className=\\\"unlink-account__steps\\\">\n                <h3>How this works:</h3>\n                <ol>\n                  <li>\n                    We&apos;ll find the account that currently has this{' '}\n                    {provider} account linked\n                  </li>\n                  <li>We&apos;ll unlink it from that account</li>\n                  <li>You can then link it to your current account</li>\n                  <li>This process is safe and won&apos;t delete any data</li>\n                </ol>\n              </div>\n\n              <div className=\\\"unlink-account__warning\\\">\n                <h3>\u26a0\ufe0f Important Notes:</h3>\n                <ul>\n                  <li>\n                    This will only unlink the OAuth provider, not delete any\n                    user accounts\n                  </li>\n                  <li>All user data and submissions will be preserved</li>\n                  <li>\n                    You&apos;ll need to sign in with the other account to\n                    complete the process\n                  </li>\n                  <li>\n                    If you don&apos;t have access to the other account, contact\n                    support\n                  </li>\n                </ul>\n              </div>\n            </div>\n\n            <UnauthenticatedUnlinkForm\n              provider={provider}\n              redirectTo={redirectTo || NAV_PATHS.ROOT}\n            />\n          </div>\n\n          <div className=\\\"unlink-account__actions\\\">\n            <InstantLink\n              href={NAV_PATHS.ROOT}\n              className=\\\"unlink-account__button unlink-account__button--secondary\\\"\n            >\n              Cancel\n            </InstantLink>\n            <InstantLink\n              href=\\\"/support\\\"\n              className=\\\"unlink-account__button unlink-account__button--tertiary\\\"\n            >\n              Need Help?\n            </InstantLink>\n          </div>\n        </div>\n      </PageContainer>\n    );\n  }\n\n  // If user is authenticated, show authenticated unlink form\n  return (\n    <PageContainer>\n      <div className=\\\"unlink-account__container\\\">\n        <div className=\\\"unlink-account__header\\\">\n          <div className=\\\"unlink-account__icon\\\">\ud83d\udd17</div>\n          <h1 className=\\\"unlink-account__title\\\">Unlink OAuth Account</h1>\n          <p className=\\\"unlink-account__subtitle\\\">\n            Resolve account linking conflicts\n          </p>\n        </div>\n\n        <div className=\\\"unlink-account__content\\\">\n          <div className=\\\"unlink-account__info\\\">\n            <h2>About Account Linking Conflicts</h2>\n            <p>\n              When you try to sign in with an OAuth provider (like Google or\n              Twitch) that&apos;s already linked to another account, we need to\n              resolve this conflict.\n            </p>\n\n            <div className=\\\"unlink-account__steps\\\">\n              <h3>How this works:</h3>\n              <ol>\n                <li>\n                  We&apos;ll find the account that currently has this {provider}{' '}\n                  account linked\n                </li>\n                <li>We&apos;ll unlink it from that account</li>\n                <li>You can then link it to your current account</li>\n                <li>This process is safe and won&apos;t delete any data</li>\n              </ol>\n            </div>\n\n            <div className=\\\"unlink-account__warning\\\">\n              <h3>\u26a0\ufe0f Important Notes:</h3>\n              <ul>\n                <li>\n                  This will only unlink the OAuth provider, not delete any user\n                  accounts\n                </li>\n                <li>All user data and submissions will be preserved</li>\n                <li>\n                  You&apos;ll need to sign in with the other account to complete\n                  the process\n                </li>\n                <li>\n                  If you don&apos;t have access to the other account, contact\n                  support\n                </li>\n              </ul>\n            </div>\n          </div>\n\n          <UnlinkAccountForm\n            provider={provider}\n            redirectTo={redirectTo || NAV_PATHS.ROOT}\n            currentUserEmail={session.user.email ?? null}\n          />\n        </div>\n\n        <div className=\\\"unlink-account__actions\\\">\n          <InstantLink\n            href={NAV_PATHS.ROOT}\n            className=\\\"unlink-account__button unlink-account__button--secondary\\\"\n          >\n            Cancel\n          </InstantLink>\n          <InstantLink\n            href=\\\"/support\\\"\n            className=\\\"unlink-account__button unlink-account__button--tertiary\\\"\n          >\n            Need Help?\n          </InstantLink>\n        </div>\n      </div>\n    </PageContainer>\n  );\n}\n",
    "language":"typescript",
    "lines":187,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/my-posts/page.tsx":{
    "content":"import { Metadata } from 'next';\nimport { redirect } from 'next/navigation';\nimport { Suspense } from 'react';\nimport { CustomSession } from '../../auth.config';\nimport { auth } from '../../lib/auth';\nimport { CONTEXT_IDS } from '../../lib/context-ids';\nimport { Card } from '../components/card/Card';\nimport FadeIn from '../components/fade-in/FadeIn';\nimport FloatingAddPost from '../components/floating-add-post/FloatingAddPost';\nimport Loader from '../components/loader/Loader';\nimport { PageAside } from '../components/page-aside/PageAside';\nimport { PageContainer } from '../components/page-container/PageContainer';\nimport PageContent from '../components/page-content/PageContent';\nimport PageHeader from '../components/page-header/PageHeader';\nimport { RecentTags } from '../components/recent-tags/RecentTags';\nimport { RecentTagsLoader } from '../components/recent-tags/RecentTagsClient';\nimport MyPostsPageClient from './MyPostsPageClient';\nimport styles from './page.module.css';\n\n// Development-only import that gets tree-shaken in production\nlet DevSkeletonToggle: React.ComponentType | null = null;\n\nif (process.env.NODE_ENV === 'development') {\n  const devModule = require('../components/dev-tools/DevSkeletonToggle');\n  DevSkeletonToggle = devModule.DevSkeletonToggle;\n}\n\nexport const metadata: Metadata = {\n  title: 'My Posts - Idling.app',\n  description: 'Manage and view your posts'\n};\n\nexport default async function MyPostsPage() {\n  const session = (await auth()) as CustomSession | null;\n\n  if (!session?.user?.id) {\n    redirect('/auth/signin?callbackUrl=/my-posts');\n  }\n\n  return (\n    <>\n      <PageContainer>\n        <PageHeader>\n          <FadeIn>\n            <h2>My Posts</h2>\n          </FadeIn>\n        </PageHeader>\n        <PageContent>\n          <article className={styles.posts__container}>\n            <FadeIn className={styles.posts__container_fade}>\n              <Card width=\\\"full\\\" className={styles.posts__container_item}>\n                <Suspense fallback={<Loader />}>\n                  <MyPostsPageClient\n                    contextId={CONTEXT_IDS.MY_POSTS.toString()}\n                  />\n                </Suspense>\n              </Card>\n            </FadeIn>\n          </article>\n        </PageContent>\n\n        <PageAside className={styles.tags_aside} bottomMargin={10}>\n          <FadeIn>\n            <Card width=\\\"full\\\">\n              <Suspense fallback={<RecentTagsLoader />}>\n                <RecentTags\n                  contextId={CONTEXT_IDS.MY_POSTS.toString()}\n                  onlyMine\n                />\n              </Suspense>\n            </Card>\n          </FadeIn>\n        </PageAside>\n      </PageContainer>\n\n      {/* Floating buttons positioned at viewport level */}\n      {session?.user?.id && <FloatingAddPost />}\n      {DevSkeletonToggle && <DevSkeletonToggle />}\n    </>\n  );\n}\n",
    "language":"typescript",
    "lines":82,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/test-thread/page.tsx":{
    "content":"'use client';\n\nimport { useState } from 'react';\nimport Thread from '../components/thread/Thread';\n\nexport default function TestThreadPage() {\n  const [submissionId, setSubmissionId] = useState<number>(1);\n\n  return (\n    <div style={{ padding: '2rem' }}>\n      <h1>Thread Test Page</h1>\n      <div style={{ marginBottom: '2rem' }}>\n        <label>\n          Submission ID to test:\n          <input\n            type=\\\"number\\\"\n            value={submissionId}\n            onChange={(e) => setSubmissionId(Number(e.target.value))}\n            style={{ marginLeft: '1rem', padding: '0.5rem' }}\n          />\n        </label>\n      </div>\n\n      <div style={{ border: '1px solid #ccc', padding: '1rem' }}>\n        <Thread submissionId={submissionId} />\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":30,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/test-dismissal/page.tsx":{
    "content":"'use client';\n\nimport { useEffect, useState } from 'react';\n\nexport default function TestDismissalPage() {\n  const [dismissedAlerts, setDismissedAlerts] = useState<string[]>([]);\n  const [bannerDebug, setBannerDebug] = useState<any>(null);\n\n  useEffect(() => {\n    // Load current dismissed alerts\n    const loadDismissedAlerts = () => {\n      try {\n        const dismissed = JSON.parse(\n          localStorage.getItem('dismissedAlerts') || '[]'\n        );\n        setDismissedAlerts(dismissed);\n      } catch (error) {\n        setDismissedAlerts([]);\n      }\n    };\n\n    loadDismissedAlerts();\n\n    // Check banner debug info\n    const checkBannerDebug = () => {\n      if (typeof window !== 'undefined' && (window as any).__bannerDebug) {\n        setBannerDebug((window as any).__bannerDebug());\n      }\n    };\n\n    checkBannerDebug();\n    const interval = setInterval(() => {\n      loadDismissedAlerts();\n      checkBannerDebug();\n    }, 2000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  const clearDismissedAlerts = () => {\n    if (\n      typeof window !== 'undefined' &&\n      (window as any).__clearDismissedAlerts\n    ) {\n      const result = (window as any).__clearDismissedAlerts();\n      alert(result);\n    } else {\n      localStorage.removeItem('dismissedAlerts');\n      setDismissedAlerts([]);\n      // Manually refresh banners\n      window.dispatchEvent(new CustomEvent('refresh-alerts'));\n    }\n  };\n\n  const refreshBanners = () => {\n    if (typeof window !== 'undefined' && (window as any).__refreshBanners) {\n      (window as any).__refreshBanners();\n    }\n  };\n\n  return (\n    <div style={{ padding: '20px', maxWidth: '800px', margin: '0 auto' }}>\n      <h1>\ud83e\uddea Banner Dismissal Test Page</h1>\n\n      <div style={{ marginBottom: '20px' }}>\n        <h2>\ud83d\udccb Instructions</h2>\n        <ol>\n          <li>\n            Make sure you're <strong>not logged in</strong> (anonymous user)\n          </li>\n          <li>Look for the welcome banner at the top of the page</li>\n          <li>Click the \\\"\u2715\\\" button to dismiss it</li>\n          <li>Refresh the page - the banner should stay dismissed</li>\n          <li>\n            Use the \\\"Clear Dismissed Alerts\\\" button to reset and see the banner\n            again\n          </li>\n        </ol>\n      </div>\n\n      <div style={{ marginBottom: '20px' }}>\n        <h2>\ud83d\udd27 Controls</h2>\n        <button\n          onClick={refreshBanners}\n          style={{\n            padding: '10px 20px',\n            marginRight: '10px',\n            backgroundColor: '#007bff',\n            color: 'white',\n            border: 'none',\n            borderRadius: '5px',\n            cursor: 'pointer'\n          }}\n        >\n          \ud83d\udd04 Refresh Banners\n        </button>\n        <button\n          onClick={clearDismissedAlerts}\n          style={{\n            padding: '10px 20px',\n            backgroundColor: '#dc3545',\n            color: 'white',\n            border: 'none',\n            borderRadius: '5px',\n            cursor: 'pointer'\n          }}\n        >\n          \ud83d\uddd1\ufe0f Clear Dismissed Alerts\n        </button>\n      </div>\n\n      <div style={{ marginBottom: '20px' }}>\n        <h2>\ud83d\udcca Current State</h2>\n        <div\n          style={{\n            background: '#f8f9fa',\n            padding: '15px',\n            borderRadius: '5px',\n            fontFamily: 'monospace',\n            fontSize: '14px'\n          }}\n        >\n          <strong>Dismissed Alerts in localStorage:</strong>\n          <pre>{JSON.stringify(dismissedAlerts, null, 2)}</pre>\n\n          {bannerDebug && (\n            <>\n              <strong>Banner System Debug:</strong>\n              <pre>{JSON.stringify(bannerDebug, null, 2)}</pre>\n            </>\n          )}\n        </div>\n      </div>\n\n      <div style={{ marginBottom: '20px' }}>\n        <h2>\u2705 Expected Behavior</h2>\n        <ul>\n          <li>\n            <strong>When anonymous:</strong> Dismissing banners stores alert IDs\n            in localStorage\n          </li>\n          <li>\n            <strong>On page refresh:</strong> Dismissed banners don't appear\n            again\n          </li>\n          <li>\n            <strong>When authenticated:</strong> Dismissals are stored in\n            database instead\n          </li>\n          <li>\n            <strong>localStorage cleanup:</strong> Old dismissals are\n            automatically cleaned up\n          </li>\n        </ul>\n      </div>\n\n      <div\n        style={{\n          background: '#e7f3ff',\n          padding: '15px',\n          borderRadius: '5px',\n          marginTop: '20px'\n        }}\n      >\n        <h3>\ud83c\udfaf Test Scenario</h3>\n        <p>\n          The welcome banner \\\"Welcome to the Enhanced Alert System! \ud83c\udf89\\\" should\n          be dismissible for anonymous users and stay dismissed across page\n          reloads using localStorage caching.\n        </p>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":175,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/settings/page.tsx":{
    "content":"'use client';\n\nimport { useSession } from 'next-auth/react';\nimport { useState } from 'react';\nimport {\n  useProfileVisibility,\n  useUserPreferences\n} from '../../lib/context/UserPreferencesContext';\nimport './settings.css';\n\ninterface SettingsCategory {\n  id: string;\n  title: string;\n  description: string;\n  icon: string;\n  expanded: boolean;\n}\n\nexport default function SettingsPage() {\n  const { data: session, status } = useSession();\n  const {\n    spacingTheme,\n    setSpacingTheme,\n    paginationMode,\n    setPaginationMode,\n    emojiPanelBehavior,\n    setEmojiPanelBehavior,\n    fontPreference,\n    setFontPreference,\n    accessibilityFocusMode,\n    setAccessibilityFocusMode,\n    isUpdatingSpacingTheme,\n    isUpdatingPaginationMode,\n    isUpdatingEmojiPanelBehavior,\n    isUpdatingFontPreference,\n    isUpdatingAccessibilityFocusMode,\n    spacingThemeError,\n    paginationModeError,\n    emojiPanelBehaviorError,\n    fontPreferenceError,\n    accessibilityFocusModeError\n  } = useUserPreferences();\n\n  const {\n    visibility: profileVisibility,\n    setVisibility: setProfileVisibility,\n    isUpdating: isUpdatingProfileVisibility,\n    error: profileVisibilityError\n  } = useProfileVisibility();\n\n  // Category expansion state\n  const [categories, setCategories] = useState<SettingsCategory[]>([\n    {\n      id: 'appearance',\n      title: 'Appearance',\n      description: 'Customize how the site looks and feels',\n      icon: '\ud83c\udfa8',\n      expanded: true\n    },\n    {\n      id: 'behavior',\n      title: 'Behavior',\n      description: 'Control how the site behaves and responds',\n      icon: '\u2699\ufe0f',\n      expanded: true\n    },\n    {\n      id: 'accessibility',\n      title: 'Accessibility',\n      description: 'Make the site easier to use for everyone',\n      icon: '\u267f',\n      expanded: true\n    },\n    {\n      id: 'privacy',\n      title: 'Privacy & Profile',\n      description: 'Control your profile visibility and data',\n      icon: '\ud83d\udd12',\n      expanded: session?.user ? true : false\n    }\n  ]);\n\n  const toggleCategory = (categoryId: string) => {\n    setCategories((prev) =>\n      prev.map((cat) =>\n        cat.id === categoryId ? { ...cat, expanded: !cat.expanded } : cat\n      )\n    );\n  };\n\n  if (status === 'loading') {\n    return (\n      <div className=\\\"settings-page\\\">\n        <div className=\\\"settings-page__loading\\\">\n          <div className=\\\"loading-spinner\\\"></div>\n          <span>Loading settings...</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\\\"settings-page\\\">\n      <div className=\\\"settings-page__container\\\">\n        <div className=\\\"settings-page__header\\\">\n          <h1 className=\\\"settings-page__title\\\">Settings</h1>\n          <p className=\\\"settings-page__description\\\">\n            Customize your experience and preferences\n          </p>\n        </div>\n\n        <div className=\\\"settings-page__content\\\">\n          {/* Appearance Category */}\n          <div className=\\\"settings-category\\\">\n            <button\n              className=\\\"settings-category__header\\\"\n              onClick={() => toggleCategory('appearance')}\n              aria-expanded={\n                categories.find((c) => c.id === 'appearance')?.expanded\n              }\n            >\n              <div className=\\\"settings-category__header-content\\\">\n                <span className=\\\"settings-category__icon\\\">\ud83c\udfa8</span>\n                <div className=\\\"settings-category__header-text\\\">\n                  <h2 className=\\\"settings-category__title\\\">Appearance</h2>\n                  <p className=\\\"settings-category__description\\\">\n                    Customize how the site looks and feels\n                  </p>\n                </div>\n              </div>\n              <span className=\\\"settings-category__toggle\\\">\n                {categories.find((c) => c.id === 'appearance')?.expanded\n                  ? '\u2212'\n                  : '+'}\n              </span>\n            </button>\n\n            {categories.find((c) => c.id === 'appearance')?.expanded && (\n              <div className=\\\"settings-category__content\\\">\n                <div className=\\\"settings-grid\\\">\n                  {/* Font Preference */}\n                  <div className=\\\"settings-card\\\">\n                    <div className=\\\"settings-card__header\\\">\n                      <h3 className=\\\"settings-card__title\\\">Font Family</h3>\n                      <span className=\\\"settings-card__current\\\">\n                        {fontPreference === 'monospace' ? 'Code' : 'Reading'}\n                      </span>\n                    </div>\n                    <div className=\\\"settings-card__options\\\">\n                      <button\n                        className={`settings-option ${fontPreference === 'monospace' ? 'settings-option--active' : ''}`}\n                        onClick={() => setFontPreference('monospace')}\n                        disabled={isUpdatingFontPreference}\n                        aria-pressed={fontPreference === 'monospace'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83d\udd24</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">Code</span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Fira Code - Perfect for coding\n                          </span>\n                        </div>\n                      </button>\n                      <button\n                        className={`settings-option ${fontPreference === 'default' ? 'settings-option--active' : ''}`}\n                        onClick={() => setFontPreference('default')}\n                        disabled={isUpdatingFontPreference}\n                        aria-pressed={fontPreference === 'default'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83d\udcd6</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Reading\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            System fonts - Easy on the eyes\n                          </span>\n                        </div>\n                      </button>\n                    </div>\n                    {fontPreferenceError && (\n                      <div className=\\\"settings-card__error\\\">\n                        {fontPreferenceError}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Display Density */}\n                  <div className=\\\"settings-card\\\">\n                    <div className=\\\"settings-card__header\\\">\n                      <h3 className=\\\"settings-card__title\\\">Display Density</h3>\n                      <span className=\\\"settings-card__current\\\">\n                        {spacingTheme === 'cozy' ? 'Cozy' : 'Compact'}\n                      </span>\n                    </div>\n                    <div className=\\\"settings-card__options\\\">\n                      <button\n                        className={`settings-option ${spacingTheme === 'cozy' ? 'settings-option--active' : ''}`}\n                        onClick={() => setSpacingTheme('cozy')}\n                        disabled={isUpdatingSpacingTheme}\n                        aria-pressed={spacingTheme === 'cozy'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83d\udcd6</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">Cozy</span>\n                          <span className=\\\"settings-option__desc\\\">\n                            More spacing, easier to read\n                          </span>\n                        </div>\n                      </button>\n                      <button\n                        className={`settings-option ${spacingTheme === 'compact' ? 'settings-option--active' : ''}`}\n                        onClick={() => setSpacingTheme('compact')}\n                        disabled={isUpdatingSpacingTheme}\n                        aria-pressed={spacingTheme === 'compact'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83d\udcca</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Compact\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Less spacing, more content\n                          </span>\n                        </div>\n                      </button>\n                    </div>\n                    {spacingThemeError && (\n                      <div className=\\\"settings-card__error\\\">\n                        {spacingThemeError}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Behavior Category */}\n          <div className=\\\"settings-category\\\">\n            <button\n              className=\\\"settings-category__header\\\"\n              onClick={() => toggleCategory('behavior')}\n              aria-expanded={\n                categories.find((c) => c.id === 'behavior')?.expanded\n              }\n            >\n              <div className=\\\"settings-category__header-content\\\">\n                <span className=\\\"settings-category__icon\\\">\u2699\ufe0f</span>\n                <div className=\\\"settings-category__header-text\\\">\n                  <h2 className=\\\"settings-category__title\\\">Behavior</h2>\n                  <p className=\\\"settings-category__description\\\">\n                    Control how the site behaves and responds\n                  </p>\n                </div>\n              </div>\n              <span className=\\\"settings-category__toggle\\\">\n                {categories.find((c) => c.id === 'behavior')?.expanded\n                  ? '\u2212'\n                  : '+'}\n              </span>\n            </button>\n\n            {categories.find((c) => c.id === 'behavior')?.expanded && (\n              <div className=\\\"settings-category__content\\\">\n                <div className=\\\"settings-grid\\\">\n                  {/* Page Navigation */}\n                  <div className=\\\"settings-card\\\">\n                    <div className=\\\"settings-card__header\\\">\n                      <h3 className=\\\"settings-card__title\\\">Page Navigation</h3>\n                      <span className=\\\"settings-card__current\\\">\n                        {paginationMode === 'traditional'\n                          ? 'Traditional'\n                          : 'Infinite Scroll'}\n                      </span>\n                    </div>\n                    <div className=\\\"settings-card__options\\\">\n                      <button\n                        className={`settings-option ${paginationMode === 'traditional' ? 'settings-option--active' : ''}`}\n                        onClick={() => setPaginationMode('traditional')}\n                        disabled={isUpdatingPaginationMode}\n                        aria-pressed={paginationMode === 'traditional'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83d\udcc4</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Traditional\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Page numbers with next/previous\n                          </span>\n                        </div>\n                      </button>\n                      <button\n                        className={`settings-option ${paginationMode === 'infinite' ? 'settings-option--active' : ''}`}\n                        onClick={() => setPaginationMode('infinite')}\n                        disabled={isUpdatingPaginationMode}\n                        aria-pressed={paginationMode === 'infinite'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\u221e</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Infinite Scroll\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Auto-load content as you scroll\n                          </span>\n                        </div>\n                      </button>\n                    </div>\n                    {paginationModeError && (\n                      <div className=\\\"settings-card__error\\\">\n                        {paginationModeError}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Emoji Panel Behavior */}\n                  <div className=\\\"settings-card\\\">\n                    <div className=\\\"settings-card__header\\\">\n                      <h3 className=\\\"settings-card__title\\\">Emoji Panel</h3>\n                      <span className=\\\"settings-card__current\\\">\n                        {emojiPanelBehavior === 'close_after_select'\n                          ? 'Close After Select'\n                          : 'Stay Open'}\n                      </span>\n                    </div>\n                    <div className=\\\"settings-card__options\\\">\n                      <button\n                        className={`settings-option ${emojiPanelBehavior === 'close_after_select' ? 'settings-option--active' : ''}`}\n                        onClick={() =>\n                          setEmojiPanelBehavior('close_after_select')\n                        }\n                        disabled={isUpdatingEmojiPanelBehavior}\n                        aria-pressed={\n                          emojiPanelBehavior === 'close_after_select'\n                        }\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83c\udfaf</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Close After Select\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Panel closes after picking one emoji\n                          </span>\n                        </div>\n                      </button>\n                      <button\n                        className={`settings-option ${emojiPanelBehavior === 'stay_open' ? 'settings-option--active' : ''}`}\n                        onClick={() => setEmojiPanelBehavior('stay_open')}\n                        disabled={isUpdatingEmojiPanelBehavior}\n                        aria-pressed={emojiPanelBehavior === 'stay_open'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83d\udccc</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Stay Open\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Pick multiple emojis before closing\n                          </span>\n                        </div>\n                      </button>\n                    </div>\n                    {emojiPanelBehaviorError && (\n                      <div className=\\\"settings-card__error\\\">\n                        {emojiPanelBehaviorError}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Accessibility Category */}\n          <div className=\\\"settings-category\\\">\n            <button\n              className=\\\"settings-category__header\\\"\n              onClick={() => toggleCategory('accessibility')}\n              aria-expanded={\n                categories.find((c) => c.id === 'accessibility')?.expanded\n              }\n            >\n              <div className=\\\"settings-category__header-content\\\">\n                <span className=\\\"settings-category__icon\\\">\u267f</span>\n                <div className=\\\"settings-category__header-text\\\">\n                  <h2 className=\\\"settings-category__title\\\">Accessibility</h2>\n                  <p className=\\\"settings-category__description\\\">\n                    Make the site easier to use for everyone\n                  </p>\n                </div>\n              </div>\n              <span className=\\\"settings-category__toggle\\\">\n                {categories.find((c) => c.id === 'accessibility')?.expanded\n                  ? '\u2212'\n                  : '+'}\n              </span>\n            </button>\n\n            {categories.find((c) => c.id === 'accessibility')?.expanded && (\n              <div className=\\\"settings-category__content\\\">\n                <div className=\\\"settings-grid\\\">\n                  {/* Accessibility Focus */}\n                  <div className=\\\"settings-card\\\">\n                    <div className=\\\"settings-card__header\\\">\n                      <h3 className=\\\"settings-card__title\\\">Focus Indicators</h3>\n                      <span className=\\\"settings-card__current\\\">\n                        {accessibilityFocusMode === 'enabled'\n                          ? 'Enabled'\n                          : 'Disabled'}\n                      </span>\n                    </div>\n                    <div className=\\\"settings-card__options\\\">\n                      <button\n                        className={`settings-option ${accessibilityFocusMode === 'disabled' ? 'settings-option--active' : ''}`}\n                        onClick={() => setAccessibilityFocusMode('disabled')}\n                        disabled={isUpdatingAccessibilityFocusMode}\n                        aria-pressed={accessibilityFocusMode === 'disabled'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83c\udfaf</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Disabled\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Clean visual design without focus outlines\n                          </span>\n                        </div>\n                      </button>\n                      <button\n                        className={`settings-option ${accessibilityFocusMode === 'enabled' ? 'settings-option--active' : ''}`}\n                        onClick={() => setAccessibilityFocusMode('enabled')}\n                        disabled={isUpdatingAccessibilityFocusMode}\n                        aria-pressed={accessibilityFocusMode === 'enabled'}\n                      >\n                        <span className=\\\"settings-option__icon\\\">\ud83d\udd0d</span>\n                        <div className=\\\"settings-option__content\\\">\n                          <span className=\\\"settings-option__label\\\">\n                            Enabled\n                          </span>\n                          <span className=\\\"settings-option__desc\\\">\n                            Show focus outlines for keyboard navigation\n                          </span>\n                        </div>\n                      </button>\n                    </div>\n                    {accessibilityFocusModeError && (\n                      <div className=\\\"settings-card__error\\\">\n                        {accessibilityFocusModeError}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Privacy & Profile Category - Only show for authenticated users */}\n          {session?.user && (\n            <div className=\\\"settings-category\\\">\n              <button\n                className=\\\"settings-category__header\\\"\n                onClick={() => toggleCategory('privacy')}\n                aria-expanded={\n                  categories.find((c) => c.id === 'privacy')?.expanded\n                }\n              >\n                <div className=\\\"settings-category__header-content\\\">\n                  <span className=\\\"settings-category__icon\\\">\ud83d\udd12</span>\n                  <div className=\\\"settings-category__header-text\\\">\n                    <h2 className=\\\"settings-category__title\\\">\n                      Privacy & Profile\n                    </h2>\n                    <p className=\\\"settings-category__description\\\">\n                      Control your profile visibility and data\n                    </p>\n                  </div>\n                </div>\n                <span className=\\\"settings-category__toggle\\\">\n                  {categories.find((c) => c.id === 'privacy')?.expanded\n                    ? '\u2212'\n                    : '+'}\n                </span>\n              </button>\n\n              {categories.find((c) => c.id === 'privacy')?.expanded && (\n                <div className=\\\"settings-category__content\\\">\n                  <div className=\\\"settings-grid\\\">\n                    {/* Profile Visibility */}\n                    <div className=\\\"settings-card\\\">\n                      <div className=\\\"settings-card__header\\\">\n                        <h3 className=\\\"settings-card__title\\\">\n                          Profile Visibility\n                        </h3>\n                        <span className=\\\"settings-card__current\\\">\n                          {profileVisibility === 'public'\n                            ? 'Public'\n                            : 'Private'}\n                        </span>\n                      </div>\n                      <div className=\\\"settings-card__options\\\">\n                        <button\n                          className={`settings-option ${profileVisibility === 'public' ? 'settings-option--active' : ''}`}\n                          onClick={() => setProfileVisibility('public')}\n                          disabled={isUpdatingProfileVisibility}\n                          aria-pressed={profileVisibility === 'public'}\n                        >\n                          <span className=\\\"settings-option__icon\\\">\ud83c\udf10</span>\n                          <div className=\\\"settings-option__content\\\">\n                            <span className=\\\"settings-option__label\\\">\n                              Public\n                            </span>\n                            <span className=\\\"settings-option__desc\\\">\n                              Profile visible to everyone\n                            </span>\n                          </div>\n                        </button>\n                        <button\n                          className={`settings-option ${profileVisibility === 'private' ? 'settings-option--active' : ''}`}\n                          onClick={() => setProfileVisibility('private')}\n                          disabled={isUpdatingProfileVisibility}\n                          aria-pressed={profileVisibility === 'private'}\n                        >\n                          <span className=\\\"settings-option__icon\\\">\ud83d\udd12</span>\n                          <div className=\\\"settings-option__content\\\">\n                            <span className=\\\"settings-option__label\\\">\n                              Private\n                            </span>\n                            <span className=\\\"settings-option__desc\\\">\n                              Profile hidden from others\n                            </span>\n                          </div>\n                        </button>\n                      </div>\n                      {profileVisibilityError && (\n                        <div className=\\\"settings-card__error\\\">\n                          {profileVisibilityError}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Account Status */}\n          <div className=\\\"settings-account-status\\\">\n            {session?.user ? (\n              <div className=\\\"settings-account-status__content\\\">\n                <div className=\\\"settings-account-status__info\\\">\n                  <span className=\\\"settings-account-status__icon\\\">\u2705</span>\n                  <div className=\\\"settings-account-status__details\\\">\n                    <div className=\\\"settings-account-status__status\\\">\n                      Signed in as{' '}\n                      <strong>{session.user.name || session.user.email}</strong>\n                    </div>\n                    <div className=\\\"settings-account-status__note\\\">\n                      Settings sync across devices\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div className=\\\"settings-account-status__content\\\">\n                <div className=\\\"settings-account-status__info\\\">\n                  <span className=\\\"settings-account-status__icon\\\">\u26a0\ufe0f</span>\n                  <div className=\\\"settings-account-status__details\\\">\n                    <div className=\\\"settings-account-status__status\\\">\n                      <strong>Not signed in</strong>\n                    </div>\n                    <div className=\\\"settings-account-status__note\\\">\n                      Settings saved locally only\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":587,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/layout.tsx":{
    "content":"import type { Metadata, Viewport } from 'next';\nimport { SessionProvider } from 'next-auth/react';\nimport { Inter } from 'next/font/google';\nimport { Suspense } from 'react';\nimport { GlobalLoadingProvider } from '../lib/context/GlobalLoadingContext';\nimport { NavigationLoadingProvider } from '../lib/context/NavigationLoadingContext';\nimport { OverlayProvider } from '../lib/context/OverlayContext';\nimport { UserPreferencesProvider } from '../lib/context/UserPreferencesContext';\nimport { JotaiProvider } from '../lib/state/JotaiProvider';\nimport { SessionRefreshHandler } from './components/auth-buttons/SessionRefreshHandler';\nimport AvatarsBackground from './components/avatars-background/AvatarsBackground';\nimport SimpleBannerSystem from './components/banner-system/SimpleBannerSystem';\nimport { NotFoundErrorBoundary } from './components/error-boundary/NotFoundErrorBoundary';\nimport FadeIn from './components/fade-in/FadeIn';\nimport Footer from './components/footer/Footer';\nimport Header from './components/header/Header';\nimport Loader from './components/loader/Loader';\nimport MessageTickerWithInterval from './components/message-ticker/MessageTickerWithInterval';\nimport PWAInstallPrompt from './components/pwa-install/PWAInstallPrompt';\nimport { HardResetManager } from './components/service-worker/HardResetManager';\nimport { ServiceWorkerRegistration } from './components/service-worker/ServiceWorkerRegistration';\nimport TimeoutBanner from './components/timeout-banner/TimeoutBanner';\nimport { NavigationLoadingBar } from './components/ui/NavigationLoadingBar';\nimport { OverlayRenderer } from './components/ui/OverlayRenderer';\nimport './fonts.css';\nimport './globals.css';\n// Import service worker cleanup utilities to make them globally available\nimport '../lib/utils/service-worker-cleanup';\nimport { GrammarlyCleanup } from './components/ui/GrammarlyCleanup';\n\nconst inter = Inter({ subsets: ['latin'] });\n\nexport const metadata: Metadata = {\n  title: 'Idling.app',\n  description: 'Revisit often to see the latest changes and play!',\n  manifest: '/manifest.json',\n  openGraph: {\n    title: 'Idling.app',\n    description: 'Revisit often to see the latest changes and play!',\n    type: 'website',\n    siteName: 'Idling.app',\n    images: [\n      {\n        url: '/api/og-image?seed=idling-app-social-share&quote=Revisit%20often%20to%20see%20the%20latest%20changes%20and%20play!&author=Idling.app',\n        width: 1200,\n        height: 630,\n        alt: 'Idling.app - Wisdom & Community'\n      }\n    ]\n  },\n  twitter: {\n    card: 'summary_large_image',\n    title: 'Idling.app',\n    description: 'Revisit often to see the latest changes and play!',\n    images: [\n      '/api/og-image?seed=idling-app-social-share&quote=Revisit%20often%20to%20see%20the%20latest%20changes%20and%20play!&author=Idling.app'\n    ]\n  },\n  appleWebApp: {\n    capable: true,\n    statusBarStyle: 'default',\n    title: 'Idling App'\n  }\n};\n\nexport const viewport: Viewport = {\n  width: 'device-width',\n  initialScale: 1,\n  viewportFit: 'cover',\n  themeColor: '#ff6b35'\n};\n\n// Global console silencer for production\nconst ConsoleProductionSilencer = () => {\n  if (process.env.NODE_ENV === 'production') {\n    return (\n      <script\n        dangerouslySetInnerHTML={{\n          __html: `\n            (function() {\n              if (typeof window !== 'undefined' && window.console) {\n                // Store original console methods for potential debugging\n                window.__originalConsole = {\n                  log: console.log,\n                  info: console.info,\n                  warn: console.warn,\n                  error: console.error,\n                  debug: console.debug,\n                  trace: console.trace,\n                  group: console.group,\n                  groupCollapsed: console.groupCollapsed,\n                  groupEnd: console.groupEnd\n                };\n                \n                // Replace console methods with no-ops\n                console.log = function() {};\n                console.info = function() {};\n                console.warn = function() {};\n                console.error = function() {};\n                console.debug = function() {};\n                console.trace = function() {};\n                console.group = function() {};\n                console.groupCollapsed = function() {};\n                console.groupEnd = function() {};\n                \n                // Handle postMessage safely without breaking normal operations\n                const originalPostMessage = window.postMessage;\n                window.postMessage = function(message, targetOrigin, transfer) {\n                  // Only filter out console-related messages, let everything else pass through normally\n                  if (typeof message === 'object' && message && message.type === 'console') {\n                    return; // Silently ignore console messages\n                  }\n                  \n                  // For all other messages, call original postMessage with proper error handling\n                  try {\n                    return originalPostMessage.call(this, message, targetOrigin, transfer);\n                  } catch (error) {\n                    // If targetOrigin is undefined/null, use window.location.origin as fallback\n                    if (error.message && error.message.includes('Invalid target origin')) {\n                      const safeTargetOrigin = targetOrigin || window.location.origin;\n                      return originalPostMessage.call(this, message, safeTargetOrigin, transfer);\n                    }\n                    // Re-throw other errors\n                    throw error;\n                  }\n                };\n                \n                // Override iframe console access\n                const originalCreateElement = document.createElement;\n                document.createElement = function(tagName) {\n                  const element = originalCreateElement.call(this, tagName);\n                  if (tagName.toLowerCase() === 'iframe') {\n                    element.addEventListener('load', function() {\n                      try {\n                        if (this.contentWindow && this.contentWindow.console) {\n                          this.contentWindow.console.log = function() {};\n                          this.contentWindow.console.info = function() {};\n                          this.contentWindow.console.warn = function() {};\n                          this.contentWindow.console.error = function() {};\n                          this.contentWindow.console.debug = function() {};\n                          this.contentWindow.console.trace = function() {};\n                          this.contentWindow.console.group = function() {};\n                          this.contentWindow.console.groupCollapsed = function() {};\n                          this.contentWindow.console.groupEnd = function() {};\n                        }\n                      } catch (e) {\n                        // Cross-origin iframe, can't access console\n                      }\n                    });\n                  }\n                  return element;\n                };\n              }\n            })();\n          `\n        }}\n      />\n    );\n  }\n  return null;\n};\n\nexport default function RootLayout({\n  children\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\\\"en\\\">\n      <head>\n        <ConsoleProductionSilencer />\n        {/* Standard favicon */}\n        <link\n          key=\\\"favicon-ico\\\"\n          rel=\\\"icon\\\"\n          href=\\\"/favicon.ico\\\"\n          type=\\\"image/x-icon\\\"\n          sizes=\\\"16x16\\\"\n        />\n        <link\n          key=\\\"favicon-16x16\\\"\n          rel=\\\"icon\\\"\n          href=\\\"/favicon-16x16.png\\\"\n          type=\\\"image/png\\\"\n          sizes=\\\"16x16\\\"\n        />\n        <link\n          key=\\\"favicon-32x32\\\"\n          rel=\\\"icon\\\"\n          href=\\\"/favicon-32x32.png\\\"\n          type=\\\"image/png\\\"\n          sizes=\\\"32x32\\\"\n        />\n\n        {/* Apple touch icons */}\n        <link\n          key=\\\"apple-touch-icon\\\"\n          rel=\\\"apple-touch-icon\\\"\n          href=\\\"/apple-touch-icon.png\\\"\n          sizes=\\\"180x180\\\"\n        />\n\n        {/* Android chrome icons */}\n        <link\n          key=\\\"android-chrome-192\\\"\n          rel=\\\"icon\\\"\n          href=\\\"/android-chrome-192x192.png\\\"\n          type=\\\"image/png\\\"\n          sizes=\\\"192x192\\\"\n        />\n        <link\n          key=\\\"android-chrome-512\\\"\n          rel=\\\"icon\\\"\n          href=\\\"/android-chrome-512x512.png\\\"\n          type=\\\"image/png\\\"\n          sizes=\\\"512x512\\\"\n        />\n\n        {/* PWA manifest */}\n        <link key=\\\"manifest\\\" rel=\\\"manifest\\\" href=\\\"/manifest.json\\\" />\n\n        {/* PWA meta tags */}\n        <meta key=\\\"theme-color\\\" name=\\\"theme-color\\\" content=\\\"#ff6b35\\\" />\n        <meta\n          key=\\\"background-color\\\"\n          name=\\\"background-color\\\"\n          content=\\\"#000000\\\"\n        />\n        <meta key=\\\"display\\\" name=\\\"display\\\" content=\\\"standalone\\\" />\n        <meta key=\\\"orientation\\\" name=\\\"orientation\\\" content=\\\"portrait-primary\\\" />\n\n        {/* Apple PWA meta tags */}\n        <meta\n          key=\\\"apple-mobile-web-app-capable\\\"\n          name=\\\"apple-mobile-web-app-capable\\\"\n          content=\\\"yes\\\"\n        />\n        <meta\n          key=\\\"apple-mobile-web-app-status-bar-style\\\"\n          name=\\\"apple-mobile-web-app-status-bar-style\\\"\n          content=\\\"default\\\"\n        />\n        <meta\n          key=\\\"apple-mobile-web-app-title\\\"\n          name=\\\"apple-mobile-web-app-title\\\"\n          content=\\\"Idling App\\\"\n        />\n\n        {/* Microsoft PWA meta tags */}\n        <meta\n          key=\\\"msapplication-tile-color\\\"\n          name=\\\"msapplication-TileColor\\\"\n          content=\\\"#ff6b35\\\"\n        />\n        <meta\n          key=\\\"msapplication-tile-image\\\"\n          name=\\\"msapplication-TileImage\\\"\n          content=\\\"/android-chrome-192x192.png\\\"\n        />\n\n        {/* Additional PWA optimizations */}\n        <meta\n          key=\\\"mobile-web-app-capable\\\"\n          name=\\\"mobile-web-app-capable\\\"\n          content=\\\"yes\\\"\n        />\n        <meta\n          key=\\\"application-name\\\"\n          name=\\\"application-name\\\"\n          content=\\\"Idling App\\\"\n        />\n        <meta key=\\\"app-version\\\" name=\\\"app-version\\\" content=\\\"0.256.1\\\" />\n\n        {/* Google AdSense */}\n        <script\n          key=\\\"google-adsense\\\"\n          async\n          src=\\\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3757286003859686\\\"\n          crossOrigin=\\\"anonymous\\\"\n        ></script>\n      </head>\n\n      <body className={inter.className}>\n        <GrammarlyCleanup />\n        <ServiceWorkerRegistration />\n        <HardResetManager />\n        <SessionProvider>\n          <UserPreferencesProvider>\n            <NavigationLoadingProvider>\n              <GlobalLoadingProvider>\n                <NavigationLoadingBar />\n                <SessionRefreshHandler />\n                <OverlayProvider>\n                  <SimpleBannerSystem />\n                  <TimeoutBanner />\n                  <main>\n                    <AvatarsBackground />\n\n                    <Header />\n\n                    <MessageTickerWithInterval />\n\n                    <Suspense fallback={<Loader />}>\n                      <JotaiProvider>\n                        <NotFoundErrorBoundary>\n                          <FadeIn>{children}</FadeIn>\n                        </NotFoundErrorBoundary>\n                      </JotaiProvider>\n                    </Suspense>\n                  </main>\n                  <Footer />\n                  <OverlayRenderer />\n                  <PWAInstallPrompt />\n                </OverlayProvider>\n              </GlobalLoadingProvider>\n            </NavigationLoadingProvider>\n          </UserPreferencesProvider>\n        </SessionProvider>\n      </body>\n    </html>\n  );\n}\n",
    "language":"typescript",
    "lines":323,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/layout.tsx":{
    "content":"import { redirect } from 'next/navigation';\nimport { ReactNode } from 'react';\nimport { auth } from '../../lib/auth';\nimport { requireAdmin } from '../../lib/permissions/permissions';\n\n// Force dynamic rendering for all admin routes\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n\ninterface AdminLayoutProps {\n  children: ReactNode;\n}\n\n/**\n * Admin Layout - Protects ALL admin routes\n *\n * This layout ensures that:\n * 1. User is authenticated (has valid session)\n * 2. User has admin permissions\n * 3. Redirects unauthorized users to home page\n *\n * Applied to ALL routes under /admin/*\n */\nexport default async function AdminLayout({ children }: AdminLayoutProps) {\n  // First check: Ensure user is authenticated\n  const session = await auth();\n\n  if (!session?.user?.id) {\n    // No session - redirect to home\n    redirect('/');\n  }\n\n  // Second check: Ensure user has admin permissions\n  const hasAdminAccess = await requireAdmin();\n\n  if (!hasAdminAccess) {\n    // Not an admin - redirect to home\n    redirect('/');\n  }\n\n  // User is authenticated AND has admin permissions - allow access\n  return (\n    <div className=\\\"admin-layout\\\">\n      <div className=\\\"admin-content\\\">{children}</div>\n    </div>\n  );\n}\n",
    "language":"typescript",
    "lines":48,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/layout.tsx":{
    "content":"import { Suspense } from 'react';\nimport { MysticalLoader } from './components/MysticalLoader';\n\nfunction LoadingFallback() {\n  return (\n    <MysticalLoader\n      message=\\\"Awakening the ancient card creation chamber...\\\"\n      fullScreen={true}\n    />\n  );\n}\n\nexport default function OgImageViewerLayout({\n  children\n}: {\n  children: React.ReactNode;\n}) {\n  return <Suspense fallback={<LoadingFallback />}>{children}</Suspense>;\n}\n",
    "language":"typescript",
    "lines":20,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/utils/fileUtils.ts":{
    "content":"export const convertSvgToPng = async (svgContent: string): Promise<Blob> => {\n  return new Promise((resolve, reject) => {\n    if (!svgContent) {\n      reject(new Error('No SVG content available'));\n      return;\n    }\n\n    const img = new Image();\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n\n    if (!ctx) {\n      reject(new Error('Could not get canvas context'));\n      return;\n    }\n\n    img.onload = () => {\n      canvas.width = img.naturalWidth || img.width;\n      canvas.height = img.naturalHeight || img.height;\n      ctx.drawImage(img, 0, 0);\n\n      canvas.toBlob((blob) => {\n        if (blob) {\n          resolve(blob);\n        } else {\n          reject(new Error('Failed to create PNG blob'));\n        }\n      }, 'image/png');\n    };\n\n    img.onerror = () => {\n      reject(new Error('Failed to load SVG as image'));\n    };\n\n    const svgBlob = new Blob([svgContent], { type: 'image/svg+xml' });\n    const svgUrl = URL.createObjectURL(svgBlob);\n    img.src = svgUrl;\n  });\n};\n\nexport const downloadFile = (blob: Blob, filename: string) => {\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n};\n\nexport const generateFilename = (\n  type: 'png' | 'svg',\n  currentSeed: string,\n  selectedRatio: string\n) => {\n  const timestamp = new Date().toISOString().slice(0, 19).replace(/[:.]/g, '-');\n  const seed = currentSeed;\n  const ratioSuffix = selectedRatio !== 'default' ? `-${selectedRatio}` : '';\n  const baseName = seed\n    ? `og-image-${seed}${ratioSuffix}`\n    : `og-image-${timestamp}${ratioSuffix}`;\n  return `${baseName}.${type}`;\n}; ",
    "language":"typescript",
    "lines":64,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/utils/imageUpload.ts":{
    "content":"// Helper function to upload image file\nexport const uploadImageFile = async (file: File): Promise<string> => {\n  const formData = new FormData();\n  formData.append('image', file);\n\n  const response = await fetch('/api/upload/image', {\n    method: 'POST',\n    body: formData\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || 'Failed to upload image');\n  }\n\n  const result = await response.json();\n  return result.url;\n};\n\n// Helper function to convert file to data URL for temporary storage\nexport const fileToDataURL = (file: File): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result as string);\n    reader.onerror = reject;\n    reader.readAsDataURL(file);\n  });\n};\n",
    "language":"typescript",
    "lines":29,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/filter-bar/utils/get-tags.ts":{
    "content":"/**\n * when provided with a stringified comma delimited list of tags, return a string[] where each row is a single tag\n * @example getTagsFromSearchParams('bacon,donut') => ['bacon','donut']\n * @example getTagsFromSearchParams('bacon, donut ') => ['bacon','donut']\n * @example getTagsFromSearchParams('') => []\n */\nexport function getTagsFromSearchParams(searchParams: string): string[] {\n  if (!searchParams) return [];\n\n  return searchParams\n    .split(',')\n    .map((tag) => tag.trim())\n    .filter(Boolean);\n}\n",
    "language":"typescript",
    "lines":15,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/useTooltipState.ts":{
    "content":"import { useRef, useState } from 'react';\n\nexport const useTooltipState = () => {\n  const [showTooltip, setShowTooltip] = useState(false);\n  const [showModal, setShowModal] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [showControls, setShowControls] = useState(true);\n  const [mounted, setMounted] = useState(false);\n  const [tooltipData, setTooltipData] = useState<any>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [timeAgo, setTimeAgo] = useState<string>('');\n\n  const hideTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const timerRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const isHoveringRef = useRef(false);\n  const shouldFetchRef = useRef(true);\n\n  return {\n    showTooltip,\n    setShowTooltip,\n    showModal,\n    setShowModal,\n    isFullscreen,\n    setIsFullscreen,\n    showControls,\n    setShowControls,\n    mounted,\n    setMounted,\n    tooltipData,\n    setTooltipData,\n    loading,\n    setLoading,\n    error,\n    setError,\n    timeAgo,\n    setTimeAgo,\n    hideTimeoutRef,\n    timerRef,\n    isHoveringRef,\n    shouldFetchRef\n  };\n};\n",
    "language":"typescript",
    "lines":44,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/useLinkPreview.ts":{
    "content":"import { useEffect, useState } from 'react';\n\nexport interface LinkPreviewData {\n  title: string;\n  description?: string;\n  image?: string;\n  url: string;\n}\n\nexport function useLinkPreview(url: string | null) {\n  const [data, setData] = useState<LinkPreviewData | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    let isMounted = true;\n\n    const fetchPreview = async () => {\n      if (!url) {\n        setData(null);\n        setLoading(false);\n        setError(null);\n        return;\n      }\n\n      setLoading(true);\n      setError(null);\n\n      try {\n        const response = await fetch(\n          `/api/link-preview?url=${encodeURIComponent(url)}`\n        );\n        if (!response.ok) throw new Error('Failed to fetch preview');\n\n        const previewData = await response.json();\n        if (isMounted) {\n          setData(previewData);\n        }\n      } catch (err) {\n        if (isMounted) {\n          setError(\n            err instanceof Error ? err.message : 'Failed to load preview'\n          );\n        }\n      } finally {\n        if (isMounted) {\n          setLoading(false);\n        }\n      }\n    };\n\n    fetchPreview();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [url]);\n\n  return { data, loading, error };\n}\n",
    "language":"typescript",
    "lines":61,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/useTooltipPosition.ts":{
    "content":"import { RefObject, useCallback, useState } from 'react';\n\nexport const useTooltipPosition = (\n  tooltipRef: RefObject<HTMLElement>,\n  tooltipContentRef: RefObject<HTMLElement>\n) => {\n  const [position, setPosition] = useState({ top: 0, left: 0 });\n\n  const updatePosition = useCallback(() => {\n    if (!tooltipRef.current || !tooltipContentRef.current) return;\n\n    const triggerRect = tooltipRef.current.getBoundingClientRect();\n    const tooltipRect = tooltipContentRef.current.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n\n    const PADDING = 8;\n    \n    // Calculate preferred position (below the trigger)\n    let top = triggerRect.bottom + PADDING;\n    let left = triggerRect.left + triggerRect.width / 2 - tooltipRect.width / 2;\n\n    // Check if there's enough space below the trigger\n    const spaceBelow = viewportHeight - triggerRect.bottom;\n    const spaceAbove = triggerRect.top;\n    const tooltipHeight = tooltipRect.height;\n\n    // If not enough space below, but more space above, position above\n    if (spaceBelow < tooltipHeight + PADDING && spaceAbove > spaceBelow) {\n      top = triggerRect.top - tooltipHeight - PADDING;\n    }\n\n    // Adjust horizontal position if tooltip would go off-screen\n    if (left < PADDING) {\n      left = PADDING;\n    } else if (left + tooltipRect.width > viewportWidth - PADDING) {\n      left = viewportWidth - tooltipRect.width - PADDING;\n    }\n\n    // Final check: if tooltip would still go off-screen vertically, \n    // position it in the best available space\n    if (top < PADDING) {\n      top = PADDING;\n    } else if (top + tooltipHeight > viewportHeight - PADDING) {\n      // If there's more space above than below, position above\n      if (spaceAbove > spaceBelow) {\n        top = Math.max(PADDING, triggerRect.top - tooltipHeight - PADDING);\n      } else {\n        // Otherwise, position at the bottom of available space\n        top = viewportHeight - tooltipHeight - PADDING;\n      }\n    }\n\n    setPosition({ top, left });\n  }, [tooltipRef, tooltipContentRef]);\n\n  return { position, updatePosition };\n};\n",
    "language":"typescript",
    "lines":59,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/useTooltipHandlers.ts":{
    "content":"import { MutableRefObject, useCallback } from 'react';\n\ninterface UseTooltipHandlersProps {\n  showTooltip: boolean;\n  setShowTooltip: (show: boolean) => void;\n  setShowModal: (show: boolean) => void;\n  setIsFullscreen: (fullscreen: boolean) => void;\n  setShowControls: (show: boolean) => void;\n  isFullscreen: boolean;\n  showControls: boolean;\n  hideTimeoutRef: MutableRefObject<ReturnType<typeof setTimeout> | null>;\n  isHoveringRef: MutableRefObject<boolean>;\n  shouldFetchRef: MutableRefObject<boolean>;\n  updatePosition: () => void;\n  fetchPreview: () => void;\n  url: string;\n  enableCtrlClick: boolean;\n}\n\n// Utility function to detect mobile devices\nconst isMobileDevice = () => {\n  return window.matchMedia('(hover: none) and (pointer: coarse)').matches;\n};\n\nexport const useTooltipHandlers = ({\n  showTooltip,\n  setShowTooltip,\n  setShowModal,\n  setIsFullscreen,\n  setShowControls,\n  isFullscreen,\n  showControls,\n  hideTimeoutRef,\n  isHoveringRef,\n  shouldFetchRef,\n  updatePosition,\n  fetchPreview,\n  url,\n  enableCtrlClick\n}: UseTooltipHandlersProps) => {\n  const handleMouseEnter = useCallback(() => {\n    // Don't trigger hover events on mobile devices\n    if (isMobileDevice()) return;\n\n    isHoveringRef.current = true;\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n      hideTimeoutRef.current = null;\n    }\n\n    const timeout = setTimeout(() => {\n      setShowTooltip(true);\n      setTimeout(updatePosition, 0);\n      fetchPreview();\n    }, 300);\n\n    return () => clearTimeout(timeout);\n  }, [\n    setShowTooltip,\n    updatePosition,\n    fetchPreview,\n    hideTimeoutRef,\n    isHoveringRef\n  ]);\n\n  const handleMouseLeave = useCallback(() => {\n    // Don't trigger hover events on mobile devices\n    if (isMobileDevice()) return;\n\n    isHoveringRef.current = false;\n    hideTimeoutRef.current = setTimeout(() => {\n      if (!isHoveringRef.current) {\n        setShowTooltip(false);\n        shouldFetchRef.current = true;\n      }\n    }, 300);\n  }, [setShowTooltip, hideTimeoutRef, isHoveringRef, shouldFetchRef]);\n\n  const handleTooltipMouseEnter = useCallback(() => {\n    // Don't trigger hover events on mobile devices\n    if (isMobileDevice()) return;\n\n    isHoveringRef.current = true;\n    if (hideTimeoutRef.current) {\n      clearTimeout(hideTimeoutRef.current);\n      hideTimeoutRef.current = null;\n    }\n  }, [hideTimeoutRef, isHoveringRef]);\n\n  const handleTooltipMouseLeave = useCallback(() => {\n    // Don't trigger hover events on mobile devices\n    if (isMobileDevice()) return;\n\n    isHoveringRef.current = false;\n    handleMouseLeave();\n  }, [handleMouseLeave, isHoveringRef]);\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent) => {\n      const isMobile = isMobileDevice();\n\n      if (isMobile) {\n        // On mobile: prevent default link behavior and show tooltip instead\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (!showTooltip) {\n          // Show tooltip\n          setShowTooltip(true);\n          setTimeout(updatePosition, 0);\n          fetchPreview();\n        } else {\n          // Hide tooltip if already showing\n          setShowTooltip(false);\n          shouldFetchRef.current = true;\n        }\n        return;\n      }\n\n      // Desktop behavior\n      if ((e.ctrlKey || e.metaKey) && enableCtrlClick) {\n        e.preventDefault();\n        setShowTooltip(false);\n        setShowModal(true);\n      } else {\n        // Regular click - open link in new tab\n        window.open(url, '_blank', 'noopener,noreferrer');\n      }\n    },\n    [\n      url,\n      enableCtrlClick,\n      setShowTooltip,\n      setShowModal,\n      showTooltip,\n      updatePosition,\n      fetchPreview,\n      shouldFetchRef\n    ]\n  );\n\n  const handleModalClose = useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      setShowModal(false);\n      document.body.classList.remove('modal-open');\n    },\n    [setShowModal]\n  );\n\n  const handleModalContentClick = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n  }, []);\n\n  const handleFullscreenToggle = useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      setIsFullscreen(!isFullscreen);\n    },\n    [isFullscreen, setIsFullscreen]\n  );\n\n  const handleControlsToggle = useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      setShowControls(!showControls);\n    },\n    [showControls, setShowControls]\n  );\n\n  return {\n    handleMouseEnter,\n    handleMouseLeave,\n    handleTooltipMouseEnter,\n    handleTooltipMouseLeave,\n    handleClick,\n    handleModalClose,\n    handleModalContentClick,\n    handleFullscreenToggle,\n    handleControlsToggle\n  };\n};\n",
    "language":"typescript",
    "lines":183,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/usePaginationPreRequest.ts":{
    "content":"'use client';\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { createLogger } from '@/lib/logging';\nimport { getSubmissionsPaginationCount, GetSubmissionsPaginationCountResponse } from '../components/submissions-list/actions';\nimport { PostFilters } from '@/lib/types/filters';\nimport { Filter } from '@/lib/state/atoms';\n\nconst logger = createLogger({\n  context: { component: 'usePaginationPreRequest' }\n});\n\ninterface UsePaginationPreRequestProps {\n  onlyMine?: boolean;\n  userId?: string;\n  filters?: Filter<PostFilters>[];\n  pageSize?: number;\n  includeThreadReplies?: boolean;\n  enabled?: boolean;\n}\n\ninterface PaginationPreRequestState {\n  isLoading: boolean;\n  data: {\n    totalRecords: number;\n    expectedItems: number;\n  } | null;\n  error: string | null;\n  lastRequestKey: string;\n}\n\nexport function usePaginationPreRequest({\n  onlyMine = false,\n  userId = '',\n  filters = [],\n  pageSize = 10,\n  includeThreadReplies = false,\n  enabled = true\n}: UsePaginationPreRequestProps) {\n  const [state, setState] = useState<PaginationPreRequestState>({\n    isLoading: false,\n    data: null,\n    error: null,\n    lastRequestKey: ''\n  });\n\n  const executePreRequest = useCallback(async () => {\n    if (!enabled) return;\n\n    // Create a key to prevent duplicate requests\n    const requestKey = JSON.stringify({\n      onlyMine,\n      userId,\n      filters,\n      pageSize,\n      includeThreadReplies\n    });\n\n    // Skip if this exact request was already made\n    if (state.lastRequestKey === requestKey && state.data) {\n      logger.debug('Skipping duplicate pagination pre-request', { requestKey });\n      return;\n    }\n\n    logger.group('paginationPreRequest');\n    logger.debug('Starting pagination pre-request', {\n      onlyMine,\n      userId,\n      filtersCount: filters.length,\n      pageSize,\n      includeThreadReplies\n    });\n\n    setState(prev => ({\n      ...prev,\n      isLoading: true,\n      error: null,\n      lastRequestKey: requestKey\n    }));\n\n    try {\n      const result = await getSubmissionsPaginationCount({\n        onlyMine,\n        userId,\n        filters,\n        pageSize,\n        includeThreadReplies\n      });\n\n      if (result.data) {\n        setState(prev => ({\n          ...prev,\n          isLoading: false,\n          data: result.data!,\n          error: null\n        }));\n\n        logger.debug('Pagination pre-request successful', {\n          totalRecords: result.data.totalRecords,\n          expectedItems: result.data.expectedItems\n        });\n      } else {\n        setState(prev => ({\n          ...prev,\n          isLoading: false,\n          data: null,\n          error: result.error || 'Failed to fetch pagination count'\n        }));\n\n        logger.error('Pagination pre-request failed', new Error(result.error || 'Unknown error'));\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        data: null,\n        error: errorMessage\n      }));\n\n      logger.error('Pagination pre-request error', error as Error);\n    } finally {\n      logger.groupEnd();\n    }\n  }, [onlyMine, userId, filters, pageSize, includeThreadReplies, enabled, state.lastRequestKey, state.data]);\n\n  const reset = useCallback(() => {\n    setState({\n      isLoading: false,\n      data: null,\n      error: null,\n      lastRequestKey: ''\n    });\n  }, []);\n\n  // Execute pre-request when parameters change\n  useEffect(() => {\n    if (enabled) {\n      executePreRequest();\n    }\n  }, [executePreRequest, enabled]);\n\n  return {\n    ...state,\n    executePreRequest,\n    reset\n  };\n}\n\nexport default usePaginationPreRequest;\n",
    "language":"typescript",
    "lines":151,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/usePostModal.ts":{
    "content":"'use client';\n\nimport { useCallback } from 'react';\nimport { useOverlay } from '../../lib/context/OverlayContext';\nimport { PostModal } from '../components/ui/PostModal';\n\nexport interface UsePostModalOptions {\n  onClose?: () => void;\n}\n\nexport const usePostModal = (options: UsePostModalOptions = {}) => {\n  const { openOverlay, closeOverlay } = useOverlay();\n\n  const openCreateModal = useCallback(() => {\n    const modalId = 'create-post-modal';\n\n    openOverlay({\n      id: modalId,\n      type: 'modal',\n      component: PostModal,\n      props: {\n        mode: 'create',\n        onClose: () => {\n          closeOverlay(modalId);\n          options.onClose?.();\n        }\n      }\n    });\n  }, [openOverlay, closeOverlay, options]);\n\n  const openViewModal = useCallback(\n    (postId: string, title?: string, content?: React.ReactNode) => {\n      const modalId = `view-post-modal-${postId}`;\n\n      openOverlay({\n        id: modalId,\n        type: 'modal',\n        component: PostModal,\n        props: {\n          mode: 'view',\n          postId,\n          title,\n          content,\n          onClose: () => {\n            closeOverlay(modalId);\n            options.onClose?.();\n          }\n        }\n      });\n    },\n    [openOverlay, closeOverlay, options]\n  );\n\n  const openEditModal = useCallback(\n    (postId: string) => {\n      const modalId = `edit-post-modal-${postId}`;\n\n      openOverlay({\n        id: modalId,\n        type: 'modal',\n        component: PostModal,\n        props: {\n          mode: 'edit',\n          postId,\n          onClose: () => {\n            closeOverlay(modalId);\n            options.onClose?.();\n          }\n        }\n      });\n    },\n    [openOverlay, closeOverlay, options]\n  );\n\n  const closeAllPostModals = useCallback(() => {\n    // Close all post-related modals\n    closeOverlay('create-post-modal');\n    // Note: view and edit modals have dynamic IDs, so they need to be closed individually\n    // or the overlay system should provide a way to close by pattern\n  }, [closeOverlay]);\n\n  return {\n    openCreateModal,\n    openViewModal,\n    openEditModal,\n    closeAllPostModals\n  };\n};\n",
    "language":"typescript",
    "lines":89,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/useEmojis.ts":{
    "content":"/**\n * useEmojis Hook\n * React hook for fetching and managing emojis with OS detection\n */\n\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useOSDetection } from '../../lib/utils/os-detection';\n\nexport interface EmojiData {\n  id: number;\n  emoji_id: string;\n  unicode_codepoint?: string;\n  unicode_char?: string;\n  name: string;\n  description?: string;\n  category: {\n    id: number;\n    name: string;\n    display_name: string;\n  };\n  tags: string[];\n  aliases: string[];\n  keywords?: string[];\n  is_custom?: boolean;\n  custom_image_url?: string;\n  usage_count?: number;\n  version_min?: string;\n}\n\nexport interface EmojiCategory {\n  id: number;\n  name: string;\n  display_name: string;\n  description?: string;\n  emoji_count: number;\n}\n\nexport interface EmojiFilters {\n  category?: string;\n  search?: string;\n  includeCustom?: boolean;\n  includeUsage?: boolean;\n}\n\nexport interface EmojiResponse {\n  emojis: EmojiData[];\n  categories: EmojiCategory[];\n  os_info: {\n    os: string;\n    version?: string;\n    is_supported: boolean;\n    emoji_support: {\n      supports_unicode: boolean;\n      supports_custom: boolean;\n      max_emoji_version: string;\n      recommended_format: string;\n    };\n  };\n  total_count: number;\n  page: number;\n  per_page: number;\n}\n\nexport interface UseEmojisOptions {\n  autoFetch?: boolean;\n  defaultFilters?: EmojiFilters;\n  pageSize?: number;\n}\n\nexport interface UseEmojisReturn {\n  emojis: EmojiData[];\n  categories: EmojiCategory[];\n  osInfo: EmojiResponse['os_info'] | null;\n  loading: boolean;\n  error: string | null;\n  hasMore: boolean;\n  currentPage: number;\n  totalCount: number;\n  filters: EmojiFilters;\n\n  // Actions\n  fetchEmojis: (filters?: EmojiFilters, page?: number) => Promise<void>;\n  loadMore: () => Promise<void>;\n  setFilters: (filters: EmojiFilters) => void;\n  searchEmojis: (query: string) => void;\n  selectCategory: (category: string | null) => void;\n  refreshEmojis: () => Promise<void>;\n  trackEmojiUsage: (\n    emojiId: string,\n    emojiType: 'windows' | 'mac' | 'custom'\n  ) => Promise<void>;\n}\n\n// Global cache to prevent duplicate API requests\ninterface EmojiCache {\n  data: EmojiResponse | null;\n  timestamp: number;\n  promise: Promise<EmojiResponse> | null;\n}\n\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\nlet globalEmojiCache: EmojiCache = {\n  data: null,\n  timestamp: 0,\n  promise: null\n};\n\nexport function useEmojis(options: UseEmojisOptions = {}): UseEmojisReturn {\n  const { autoFetch = true, defaultFilters = {}, pageSize = 50 } = options;\n\n  const osInfo = useOSDetection();\n\n  // State\n  const [emojis, setEmojis] = useState<EmojiData[]>([]);\n  const [categories, setCategories] = useState<EmojiCategory[]>([]);\n  const [apiOsInfo, setApiOsInfo] = useState<EmojiResponse['os_info'] | null>(\n    null\n  );\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalCount, setTotalCount] = useState(0);\n  const [hasMore, setHasMore] = useState(false);\n  const [filters, setFiltersState] = useState<EmojiFilters>({\n    includeCustom: true,\n    includeUsage: true,\n    ...defaultFilters\n  });\n\n  // Memoize filters to prevent unnecessary re-renders of fetchEmojis\n  const memoizedFilters = useMemo(\n    () => filters,\n    [\n      filters.category,\n      filters.search,\n      filters.includeCustom,\n      filters.includeUsage\n    ]\n  );\n\n  // Check if cache is valid\n  const isCacheValid = useCallback(() => {\n    return (\n      globalEmojiCache.data &&\n      Date.now() - globalEmojiCache.timestamp < CACHE_DURATION\n    );\n  }, []);\n\n  // Fetch emojis from API with caching - Remove filters dependency to prevent re-renders\n  const fetchEmojis = useCallback(\n    async (newFilters?: EmojiFilters, page: number = 1) => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        // Use memoized filters to prevent re-renders\n        const activeFilters = newFilters || memoizedFilters;\n\n        // For initial fetch without filters, use cache\n        if (page === 1 && !activeFilters.category && !activeFilters.search) {\n          if (isCacheValid()) {\n            const cachedData = globalEmojiCache.data!;\n            setEmojis(cachedData.emojis);\n            setCategories(cachedData.categories);\n            setApiOsInfo(cachedData.os_info);\n            setCurrentPage(page);\n            setTotalCount(cachedData.total_count);\n            setHasMore(\n              cachedData.emojis.length === pageSize &&\n                cachedData.emojis.length < cachedData.total_count\n            );\n            if (newFilters) {\n              setFiltersState(newFilters);\n            }\n            setLoading(false);\n            return;\n          }\n\n          // If there's already a pending request, wait for it\n          if (globalEmojiCache.promise) {\n            const cachedData = await globalEmojiCache.promise;\n            setEmojis(cachedData.emojis);\n            setCategories(cachedData.categories);\n            setApiOsInfo(cachedData.os_info);\n            setCurrentPage(page);\n            setTotalCount(cachedData.total_count);\n            setHasMore(\n              cachedData.emojis.length === pageSize &&\n                cachedData.emojis.length < cachedData.total_count\n            );\n            if (newFilters) {\n              setFiltersState(newFilters);\n            }\n            setLoading(false);\n            return;\n          }\n        }\n\n        const params = new URLSearchParams({\n          page: page.toString(),\n          per_page: pageSize.toString(),\n          ...(activeFilters.category && { category: activeFilters.category }),\n          ...(activeFilters.search && { search: activeFilters.search }),\n          ...(activeFilters.includeCustom !== undefined && {\n            include_custom: activeFilters.includeCustom.toString()\n          }),\n          ...(activeFilters.includeUsage !== undefined && {\n            include_usage: activeFilters.includeUsage.toString()\n          })\n        });\n\n        // Create the fetch promise\n        const fetchPromise = fetch(`/api/emojis?${params}`).then(\n          async (response) => {\n            if (!response.ok) {\n              const errorData = await response.json();\n              throw new Error(errorData.error || 'Failed to fetch emojis');\n            }\n            return response.json() as Promise<EmojiResponse>;\n          }\n        );\n\n        // Cache the promise for initial requests\n        if (page === 1 && !activeFilters.category && !activeFilters.search) {\n          globalEmojiCache.promise = fetchPromise;\n        }\n\n        const data = await fetchPromise;\n\n        // Cache the result for initial requests\n        if (page === 1 && !activeFilters.category && !activeFilters.search) {\n          globalEmojiCache.data = data;\n          globalEmojiCache.timestamp = Date.now();\n          globalEmojiCache.promise = null;\n        }\n\n        if (page === 1) {\n          setEmojis(data.emojis);\n        } else {\n          setEmojis((prev) => [...prev, ...data.emojis]);\n        }\n\n        setCategories(data.categories);\n        setApiOsInfo(data.os_info);\n        setCurrentPage(page);\n        setTotalCount(data.total_count);\n        setHasMore(\n          data.emojis.length === pageSize &&\n            data.emojis.length < data.total_count\n        );\n\n        if (newFilters) {\n          setFiltersState(newFilters);\n        }\n      } catch (err) {\n        const errorMessage =\n          err instanceof Error ? err.message : 'Unknown error occurred';\n        setError(errorMessage);\n        console.error('Error fetching emojis:', err);\n\n        // Clear cache on error\n        if (globalEmojiCache.promise) {\n          globalEmojiCache.promise = null;\n        }\n      } finally {\n        setLoading(false);\n      }\n    },\n    [pageSize, isCacheValid, memoizedFilters]\n  );\n\n  // Load more emojis (pagination)\n  const loadMore = useCallback(async () => {\n    if (!hasMore || loading) return;\n    await fetchEmojis(memoizedFilters, currentPage + 1);\n  }, [fetchEmojis, memoizedFilters, currentPage, hasMore, loading]);\n\n  // Set filters and refetch - FIXED: Use current filters from state\n  const setFilters = useCallback(\n    (newFilters: EmojiFilters) => {\n      setFiltersState((currentFilters) => {\n        const mergedFilters = { ...currentFilters, ...newFilters };\n        setCurrentPage(1);\n        fetchEmojis(mergedFilters, 1);\n        return mergedFilters;\n      });\n    },\n    [fetchEmojis]\n  );\n\n  // Search emojis - FIXED: Use current filters from state\n  const searchEmojis = useCallback(\n    (query: string) => {\n      setFiltersState((currentFilters) => {\n        const searchFilters = { ...currentFilters, search: query || undefined };\n        setCurrentPage(1);\n        fetchEmojis(searchFilters, 1);\n        return searchFilters;\n      });\n    },\n    [fetchEmojis]\n  );\n\n  // Select category - FIXED: Use current filters from state\n  const selectCategory = useCallback(\n    (category: string | null) => {\n      setFiltersState((currentFilters) => {\n        const categoryFilters = {\n          ...currentFilters,\n          category: category || undefined\n        };\n        setCurrentPage(1);\n        fetchEmojis(categoryFilters, 1);\n        return categoryFilters;\n      });\n    },\n    [fetchEmojis]\n  );\n\n  // Refresh emojis - FIXED: Use current filters from state\n  const refreshEmojis = useCallback(async () => {\n    // Clear cache on refresh\n    globalEmojiCache.data = null;\n    globalEmojiCache.timestamp = 0;\n    globalEmojiCache.promise = null;\n\n    setCurrentPage(1);\n    // Use current filters from state\n    setFiltersState((currentFilters) => {\n      fetchEmojis(currentFilters, 1);\n      return currentFilters;\n    });\n  }, [fetchEmojis]);\n\n  // Track emoji usage\n  const trackEmojiUsage = useCallback(\n    async (emojiId: string, emojiType: 'windows' | 'mac' | 'custom') => {\n      try {\n        await fetch('/api/emojis/usage', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            emoji_id: emojiId,\n            emoji_type: emojiType\n          })\n        });\n\n        // Don't refresh emojis immediately to avoid double renders\n        // Usage counts will be updated on next natural refresh\n      } catch (err) {\n        console.error('Error tracking emoji usage:', err);\n        // Don't throw error for usage tracking failures\n      }\n    },\n    [filters.includeUsage] // Remove refreshEmojis dependency to prevent re-renders\n  );\n\n  // Auto-fetch on mount if enabled - FIXED: Only run once on mount\n  useEffect(() => {\n    if (autoFetch && osInfo.isSupported) {\n      fetchEmojis();\n    }\n  }, [autoFetch, osInfo.isSupported, fetchEmojis]);\n\n  return {\n    emojis,\n    categories,\n    osInfo: apiOsInfo,\n    loading,\n    error,\n    hasMore,\n    currentPage,\n    totalCount,\n    filters,\n\n    // Actions\n    fetchEmojis,\n    loadMore,\n    setFilters,\n    searchEmojis,\n    selectCategory,\n    refreshEmojis,\n    trackEmojiUsage\n  };\n}\n\n// Helper hook for emoji picker\nexport function useEmojiPicker() {\n  const {\n    emojis,\n    categories,\n    loading,\n    error,\n    searchEmojis,\n    selectCategory,\n    trackEmojiUsage,\n    filters\n  } = useEmojis({\n    autoFetch: true,\n    defaultFilters: {\n      includeCustom: true,\n      includeUsage: true\n    }\n  });\n\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Handle category selection\n  const handleCategorySelect = useCallback(\n    (categoryName: string | null) => {\n      setSelectedCategory(categoryName);\n      selectCategory(categoryName);\n    },\n    [selectCategory]\n  );\n\n  // Handle search\n  const handleSearch = useCallback(\n    (query: string) => {\n      setSearchQuery(query);\n      searchEmojis(query);\n    },\n    [searchEmojis]\n  );\n\n  // Handle emoji selection\n  const handleEmojiSelect = useCallback(\n    (emoji: EmojiData) => {\n      const emojiType = emoji.is_custom\n        ? 'custom'\n        : filters.category === 'windows'\n          ? 'windows'\n          : 'mac';\n\n      trackEmojiUsage(emoji.emoji_id, emojiType);\n\n      return emoji.is_custom ? emoji.custom_image_url : emoji.unicode_char;\n    },\n    [trackEmojiUsage, filters.category]\n  );\n\n  return {\n    emojis,\n    categories,\n    loading,\n    error,\n    selectedCategory,\n    searchQuery,\n    handleCategorySelect,\n    handleSearch,\n    handleEmojiSelect\n  };\n}\n\n// Helper function to get emoji display value\nexport function getEmojiDisplay(emoji: EmojiData): string {\n  if (emoji.is_custom && emoji.custom_image_url) {\n    return emoji.custom_image_url; // Return data URL for custom emojis\n  }\n  return emoji.unicode_char || emoji.name;\n}\n\n// Helper function to format emoji for text insertion\nexport function formatEmojiForText(emoji: EmojiData): string {\n  // Always use colon syntax for both custom and standard emojis\n  // This ensures they are properly tokenized by the RichTextParser\n  return `:${emoji.emoji_id}:`;\n}\n",
    "language":"typescript",
    "lines":472,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/hooks/useTooltipCache.ts":{
    "content":"import { useCallback, useState } from 'react';\n\ninterface CachedData {\n  data: any;\n  timestamp: number;\n  accessCount: number;\n  lastAccessed: number;\n}\n\ninterface CacheEntry {\n  key: string;\n  data: CachedData;\n}\n\nconst CACHE_KEY_PREFIX = 'link_tooltip_cache_';\nconst CACHE_METADATA_KEY = 'link_tooltip_cache_metadata';\nconst DEFAULT_CACHE_DURATION = 60 * 60 * 1000; // 1 hour\nconst MAX_CACHE_SIZE = 50; // Maximum number of cached items\nconst MAX_CACHE_SIZE_BYTES = 5 * 1024 * 1024; // 5MB total cache size limit\n\nexport const useTooltipCache = (\n  url: string,\n  cacheDuration = DEFAULT_CACHE_DURATION\n) => {\n  const [isCached, setIsCached] = useState(false);\n  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);\n\n  const getCacheKey = (url: string) => `${CACHE_KEY_PREFIX}${url}`;\n\n  // Get cache metadata (list of all cached keys with their access info)\n  const getCacheMetadata = (): CacheEntry[] => {\n    try {\n      const metadata = localStorage.getItem(CACHE_METADATA_KEY);\n      return metadata ? JSON.parse(metadata) : [];\n    } catch (error) {\n      console.warn('Failed to get cache metadata:', error);\n      return [];\n    }\n  };\n\n  // Update cache metadata\n  const updateCacheMetadata = (entries: CacheEntry[]) => {\n    try {\n      localStorage.setItem(CACHE_METADATA_KEY, JSON.stringify(entries));\n    } catch (error) {\n      console.warn('Failed to update cache metadata:', error);\n    }\n  };\n\n  // Calculate approximate size of cached data\n  const getCacheSizeBytes = (data: any): number => {\n    try {\n      return new Blob([JSON.stringify(data)]).size;\n    } catch (error) {\n      return 0;\n    }\n  };\n\n  // Get total cache size in bytes\n  const getTotalCacheSize = (): number => {\n    try {\n      const metadata = getCacheMetadata();\n      return metadata.reduce((total, entry) => {\n        return total + getCacheSizeBytes(entry.data);\n      }, 0);\n    } catch (error) {\n      return 0;\n    }\n  };\n\n  // LRU eviction: remove oldest/least used items\n  const evictOldestItems = (requiredSpace: number = 0) => {\n    try {\n      const metadata = getCacheMetadata();\n      \n      // Sort by last accessed time (oldest first)\n      const sortedEntries = metadata.sort((a, b) => \n        a.data.lastAccessed - b.data.lastAccessed\n      );\n\n      let freedSpace = 0;\n      const entriesToRemove: string[] = [];\n\n      // Remove items until we have enough space\n      for (const entry of sortedEntries) {\n        const entrySize = getCacheSizeBytes(entry.data);\n        entriesToRemove.push(entry.key);\n        freedSpace += entrySize;\n        \n        // Remove from localStorage\n        localStorage.removeItem(entry.key);\n        \n        if (freedSpace >= requiredSpace && metadata.length - entriesToRemove.length <= MAX_CACHE_SIZE) {\n          break;\n        }\n      }\n\n      // Update metadata\n      const remainingEntries = metadata.filter(entry => !entriesToRemove.includes(entry.key));\n      updateCacheMetadata(remainingEntries);\n\n      // Log eviction info for debugging (removed for production)\n    } catch (error) {\n      console.warn('Failed to evict cache items:', error);\n    }\n  };\n\n  // Check if we need to evict items before adding new data\n  const ensureCacheSpace = (newDataSize: number) => {\n    const currentSize = getTotalCacheSize();\n    const metadata = getCacheMetadata();\n    \n    // Check if we're over the limit in number of items\n    if (metadata.length >= MAX_CACHE_SIZE) {\n      evictOldestItems();\n    }\n    \n    // Check if we're over the size limit\n    if (currentSize + newDataSize > MAX_CACHE_SIZE_BYTES) {\n      evictOldestItems(newDataSize);\n    }\n  };\n\n  const getCachedData = useCallback(\n    (url: string): CachedData | null => {\n      const cacheKey = getCacheKey(url);\n      const cached = localStorage.getItem(cacheKey);\n      if (!cached) return null;\n\n      try {\n        const { data, timestamp, accessCount = 0, lastAccessed = timestamp } = JSON.parse(cached);\n        const now = Date.now();\n\n        if (now - timestamp > cacheDuration) {\n          localStorage.removeItem(cacheKey);\n          // Remove from metadata\n          const metadata = getCacheMetadata();\n          const updatedMetadata = metadata.filter(entry => entry.key !== cacheKey);\n          updateCacheMetadata(updatedMetadata);\n          return null;\n        }\n\n        // Update access info\n        const updatedData: CachedData = {\n          data,\n          timestamp,\n          accessCount: accessCount + 1,\n          lastAccessed: now\n        };\n        localStorage.setItem(cacheKey, JSON.stringify(updatedData));\n\n        // Update metadata\n        const metadata = getCacheMetadata();\n        const existingIndex = metadata.findIndex(entry => entry.key === cacheKey);\n        if (existingIndex >= 0) {\n          metadata[existingIndex].data = updatedData;\n        }\n        updateCacheMetadata(metadata);\n\n        return updatedData;\n      } catch (error) {\n        console.warn('Failed to parse cached data:', error);\n        localStorage.removeItem(cacheKey);\n        return null;\n      }\n    },\n    [cacheDuration]\n  );\n\n  const setCachedData = useCallback((url: string, data: any) => {\n    const cacheKey = getCacheKey(url);\n    const newDataSize = getCacheSizeBytes(data);\n    \n    // Ensure we have space for the new data\n    ensureCacheSpace(newDataSize);\n\n    const now = Date.now();\n    const cacheData: CachedData = {\n      data,\n      timestamp: now,\n      accessCount: 1,\n      lastAccessed: now\n    };\n\n    try {\n      localStorage.setItem(cacheKey, JSON.stringify(cacheData));\n      \n      // Update metadata\n      const metadata = getCacheMetadata();\n      const existingIndex = metadata.findIndex(entry => entry.key === cacheKey);\n      \n      if (existingIndex >= 0) {\n        metadata[existingIndex].data = cacheData;\n      } else {\n        metadata.push({ key: cacheKey, data: cacheData });\n      }\n      \n      updateCacheMetadata(metadata);\n      setIsCached(true);\n      setLastUpdated(new Date());\n    } catch (error) {\n      console.warn('Failed to cache data:', error);\n      // If we can't store the data, try to clear some space and retry\n      evictOldestItems(newDataSize);\n      try {\n        localStorage.setItem(cacheKey, JSON.stringify(cacheData));\n        setIsCached(true);\n        setLastUpdated(new Date());\n      } catch (retryError) {\n        console.error('Failed to cache data after eviction:', retryError);\n      }\n    }\n  }, []);\n\n  // Clear all cache entries\n  const clearAllCache = useCallback(() => {\n    try {\n      const metadata = getCacheMetadata();\n      \n      // Remove all cached items\n      metadata.forEach(entry => {\n        localStorage.removeItem(entry.key);\n      });\n      \n      // Clear metadata\n      localStorage.removeItem(CACHE_METADATA_KEY);\n      \n      setIsCached(false);\n      setLastUpdated(null);\n      \n      // Log cache clearing info for debugging (removed for production)\n    } catch (error) {\n      console.warn('Failed to clear cache:', error);\n    }\n  }, []);\n\n  // Get cache statistics\n  const getCacheStats = useCallback(() => {\n    try {\n      const metadata = getCacheMetadata();\n      const totalSize = getTotalCacheSize();\n      \n      return {\n        entryCount: metadata.length,\n        totalSizeBytes: totalSize,\n        totalSizeMB: (totalSize / (1024 * 1024)).toFixed(2),\n        maxEntries: MAX_CACHE_SIZE,\n        maxSizeMB: (MAX_CACHE_SIZE_BYTES / (1024 * 1024)).toFixed(2)\n      };\n    } catch (error) {\n      console.warn('Failed to get cache stats:', error);\n      return null;\n    }\n  }, []);\n\n  return {\n    isCached,\n    lastUpdated,\n    setIsCached,\n    setLastUpdated,\n    getCachedData,\n    setCachedData,\n    clearAllCache,\n    getCacheStats\n  };\n};\n",
    "language":"typescript",
    "lines":267,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/hooks/useQuotaTracking.ts":{
    "content":"import { useSession } from 'next-auth/react';\nimport { useEffect, useRef, useState } from 'react';\nimport { QuotaState } from '../types/generation';\n\nexport function useQuotaTracking(): QuotaState & {\n  updateQuota: (remaining: number, limit?: number, resetDate?: Date | null) => void;\n  initializeQuota: () => Promise<void>;\n  quotaError?: string;\n} {\n  const { data: session, status } = useSession();\n  const [remainingGenerations, setRemainingGenerations] = useState<number>(0);\n  const [quotaLimit, setQuotaLimit] = useState<number>(0);\n  const [hasInitializedQuota, setHasInitializedQuota] = useState<boolean>(false);\n  const [resetDate, setResetDate] = useState<Date | null>(null);\n  const [quotaError, setQuotaError] = useState<string | undefined>(undefined);\n  \n  // Track previous auth state to detect changes\n  const previousUserIdRef = useRef<string | null>(null);\n\n  // Don't show quota exceeded until we've actually initialized\n  const isQuotaExceeded = hasInitializedQuota && remainingGenerations <= 0;\n\n  const updateQuota = (remaining: number, limit?: number, resetDate?: Date | null) => {\n    setRemainingGenerations(remaining);\n    if (limit !== undefined) {\n      setQuotaLimit(limit);\n    }\n    if (resetDate !== undefined) {\n      setResetDate(resetDate);\n    }\n    setHasInitializedQuota(true);\n  };\n\n  const initializeQuota = async () => {\n    try {\n      setQuotaError(undefined); // Clear previous errors\n      const response = await fetch('/api/og-image?format=json&dry-run=true', {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.remainingGenerations !== undefined && data.quotaLimit !== undefined) {\n          // Extract quota limit and reset date from the response\n          const limit = data.quotaLimit || data.quota_limit;\n          const resetDateValue = data.resetDate || data.reset_date ? new Date(data.resetDate || data.reset_date) : null;\n          updateQuota(data.remainingGenerations, limit, resetDateValue);\n          return; // Success - exit early\n        } else {\n          console.error('Quota data missing from API response:', data);\n          setQuotaError('Quota data missing from API response');\n        }\n      } else {\n        const errorData = await response.json().catch(() => ({}));\n        console.error('API request failed:', response.status, errorData);\n        setQuotaError(`API request failed with status ${response.status}`);\n      }\n    } catch (error) {\n      console.error('Failed to initialize quota:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';\n      setQuotaError(`Unable to load quota information: ${errorMessage}`);\n    }\n    \n    // Fallback: Always provide working quota values even if API fails\n    // This ensures the UI never breaks - user gets reasonable defaults\n    console.warn('Using fallback quota values due to API failure');\n    updateQuota(1, 1, new Date(Date.now() + 86400000)); // 1 generation, resets tomorrow\n  };\n\n  // Auto-initialize on mount\n  useEffect(() => {\n    initializeQuota().catch(console.error);\n  }, []);\n\n  // Monitor auth state changes and refresh quota when auth changes\n  useEffect(() => {\n    // Skip if session is still loading\n    if (status === 'loading') return;\n\n    const currentUserId = session?.user?.id || null;\n    const previousUserId = previousUserIdRef.current;\n\n    // Check if auth state has changed (login, logout, or user switch)\n    const authStateChanged = currentUserId !== previousUserId;\n\n    if (authStateChanged) {\n      // Reset quota state and reinitialize\n      setHasInitializedQuota(false);\n      setRemainingGenerations(0);\n      setQuotaLimit(0);\n      setResetDate(null);\n      setQuotaError(undefined);\n      \n      // Reinitialize quota with new auth state\n      initializeQuota().catch(console.error);\n\n      // Update the ref for next comparison\n      previousUserIdRef.current = currentUserId;\n    }\n  }, [session?.user?.id, status]);\n\n  return {\n    remainingGenerations,\n    quotaLimit,\n    hasInitializedQuota,\n    isQuotaExceeded,\n    resetDate,\n    updateQuota,\n    initializeQuota,\n    quotaError\n  };\n} ",
    "language":"typescript",
    "lines":111,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/hooks/useImageGeneration.ts":{
    "content":"import { useCallback, useRef, useState } from 'react';\nimport { formatRetryAfter } from '../../../lib/utils/timeFormatting';\nimport { GenerationOptions } from '../types/generation';\n\ninterface UseImageGenerationProps {\n  currentSeed: string;\n  avatarSeed: string;\n  selectedRatio: string;\n  customQuote: string;\n  customAuthor: string;\n  customWidth: string;\n  customHeight: string;\n  shapeCount: string;\n  isQuotaExceeded: boolean;\n  // Advanced options for Pro features\n  advancedOptions?: Partial<GenerationOptions>;\n  setCurrentSeed: (seed: string) => void;\n  setAvatarSeed: (seed: string) => void;\n  setCustomQuote: (quote: string) => void;\n  setCustomAuthor: (author: string) => void;\n  setCustomWidth: (width: string) => void;\n  setCustomHeight: (height: string) => void;\n  setShapeCount: (count: string) => void;\n  setCurrentGenerationId: (id: string) => void;\n  setRemainingGenerations: (count: number, limit?: number) => void;\n  setHasInitializedQuota: (initialized: boolean) => void;\n  setSvgContent: (content: string) => void;\n}\n\ninterface FormSnapshot {\n  currentSeed: string;\n  avatarSeed: string;\n  selectedRatio: string;\n  customQuote: string;\n  customAuthor: string;\n  customWidth: string;\n  customHeight: string;\n  shapeCount: string;\n}\n\nexport function useImageGeneration(props: UseImageGenerationProps) {\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [error, setError] = useState<string>('');\n  const [generationOptions, setGenerationOptions] = useState<any>(null);\n  const [showRegenerationDialog, setShowRegenerationDialog] = useState(false);\n  \n  // Track the last generation parameters for comparison\n  const lastGenerationParams = useRef<FormSnapshot | null>(null);\n\n  // Create current form snapshot\n  const getCurrentFormSnapshot = useCallback((): FormSnapshot => ({\n    currentSeed: props.currentSeed,\n    avatarSeed: props.avatarSeed,\n    selectedRatio: props.selectedRatio,\n    customQuote: props.customQuote,\n    customAuthor: props.customAuthor,\n    customWidth: props.customWidth,\n    customHeight: props.customHeight,\n    shapeCount: props.shapeCount\n  }), [props]);\n\n  // Compare form snapshots\n  const areFormSnapshotsEqual = useCallback((a: FormSnapshot, b: FormSnapshot): boolean => {\n    return (\n      a.currentSeed === b.currentSeed &&\n      a.avatarSeed === b.avatarSeed &&\n      a.selectedRatio === b.selectedRatio &&\n      a.customQuote === b.customQuote &&\n      a.customAuthor === b.customAuthor &&\n      a.customWidth === b.customWidth &&\n      a.customHeight === b.customHeight &&\n      a.shapeCount === b.shapeCount\n    );\n  }, []);\n\n  // Internal generation function\n  const performGeneration = useCallback(async (forceRandom = false) => {\n    if (props.isQuotaExceeded) {\n      setError('Daily quota exceeded. Please upgrade to Pro for unlimited generations.');\n      return;\n    }\n\n    setIsGenerating(true);\n    setError('');\n\n    try {\n      // Build URL with ALL parameters\n      const params = new URLSearchParams();\n      \n      // Always include basic parameters\n      params.set('format', 'json');\n      params.set('ratio', props.selectedRatio);\n      \n      // If forcing random, skip user-provided parameters to get server randomization\n      if (!forceRandom) {\n        // Add optional parameters only if they have values\n        if (props.currentSeed) params.set('seed', props.currentSeed);\n        if (props.avatarSeed) params.set('avatarSeed', props.avatarSeed);\n        if (props.customQuote) params.set('quote', props.customQuote);\n        if (props.customAuthor) params.set('author', props.customAuthor);\n        if (props.customWidth) params.set('width', props.customWidth);\n        if (props.customHeight) params.set('height', props.customHeight);\n        if (props.shapeCount) params.set('shapes', props.shapeCount);\n        \n        // Add advanced options if they exist\n        if (props.advancedOptions) {\n          if (props.advancedOptions.avatarX !== undefined) params.set('avatarX', props.advancedOptions.avatarX.toString());\n          if (props.advancedOptions.avatarY !== undefined) params.set('avatarY', props.advancedOptions.avatarY.toString());\n          if (props.advancedOptions.avatarSize !== undefined) params.set('avatarSize', props.advancedOptions.avatarSize.toString());\n          if (props.advancedOptions.textMaxWidth !== undefined) params.set('textMaxWidth', props.advancedOptions.textMaxWidth.toString());\n          if (props.advancedOptions.textStartY !== undefined) params.set('textStartY', props.advancedOptions.textStartY.toString());\n          if (props.advancedOptions.fontSize !== undefined) params.set('fontSize', props.advancedOptions.fontSize.toString());\n          if (props.advancedOptions.borderColor) params.set('borderColor', props.advancedOptions.borderColor);\n          if (props.advancedOptions.borderOpacity !== undefined) params.set('borderOpacity', props.advancedOptions.borderOpacity.toString());\n          if (props.advancedOptions.patternSeed) params.set('patternSeed', props.advancedOptions.patternSeed);\n          if (props.advancedOptions.textPadding !== undefined) params.set('textPadding', props.advancedOptions.textPadding.toString());\n          if (props.advancedOptions.lineHeight !== undefined) params.set('lineHeight', props.advancedOptions.lineHeight.toString());\n          // Always set glassBackground - default to true if not explicitly set\n          const glassBackgroundValue = props.advancedOptions.glassBackground !== undefined ? props.advancedOptions.glassBackground : true;\n          params.set('glassBackground', glassBackgroundValue.toString());\n        } else {\n          // No advanced options provided, use default glass background\n          params.set('glassBackground', 'true');\n        }\n      }\n      // For forceRandom=true, we only send ratio and format, letting server randomize everything\n\n      const response = await fetch(`/api/og-image?${params.toString()}`, {\n        credentials: 'include'\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      \n      // Update all state with response data\n      props.setSvgContent(data.svg);\n      props.setCurrentGenerationId(data.id);\n      props.setRemainingGenerations(data.remainingGenerations, data.quotaLimit);\n      props.setHasInitializedQuota(true);\n      \n      // Store generation options for form display\n      setGenerationOptions(data.generationOptions);\n      \n      // ALWAYS update form fields with actual used values from the generation\n      // This shows the user exactly what was used to create the image\n      if (data.generationOptions.seed !== undefined) {\n        props.setCurrentSeed(data.generationOptions.seed);\n      }\n      if (data.generationOptions.avatarSeed !== undefined) {\n        props.setAvatarSeed(data.generationOptions.avatarSeed);\n      }\n      \n      // Update quote fields with what was actually used (including server-generated random quotes)\n      if (data.generationOptions.quote !== undefined) {\n        props.setCustomQuote(data.generationOptions.quote);\n      }\n      if (data.generationOptions.author !== undefined) {\n        props.setCustomAuthor(data.generationOptions.author);\n      }\n      \n      // Update dimension fields with what was actually used\n      if (data.generationOptions.customWidth !== undefined) {\n        props.setCustomWidth(data.generationOptions.customWidth.toString());\n      }\n      if (data.generationOptions.customHeight !== undefined) {\n        props.setCustomHeight(data.generationOptions.customHeight.toString());\n      }\n      \n      // Update shape count with what was actually used\n      if (data.generationOptions.shapeCount !== undefined) {\n        props.setShapeCount(data.generationOptions.shapeCount.toString());\n      }\n\n      // Store the current form snapshot as the last generation params\n      lastGenerationParams.current = getCurrentFormSnapshot();\n\n      // Development logging\n      if (process.env.NODE_ENV === 'development') {\n        // eslint-disable-next-line no-console\n        console.log('\ud83c\udfa8 Generation successful:', {\n          id: data.id,\n          remainingGenerations: data.remainingGenerations,\n          generationOptions: data.generationOptions,\n          forceRandom\n        });\n      }\n\n    } catch (error) {\n      console.error('\u274c Generation failed:', error);\n      \n      let errorMessage = 'Generation failed. Please try again.';\n      \n      if (error instanceof Error) {\n        errorMessage = error.message;\n        \n        // Enhanced error handling for rate limits and quotas\n        if (error.message.includes('rate limit') || error.message.includes('quota')) {\n          // Try to extract retryAfter from error if available\n          const match = error.message.match(/try again in (\\\\d+)/i);\n          if (match) {\n            const seconds = parseInt(match[1]);\n            const humanTime = formatRetryAfter(seconds);\n            errorMessage = error.message.replace(/try again in \\\\d+/i, `try again in ${humanTime}`);\n          }\n        }\n      }\n      \n      setError(errorMessage);\n    } finally {\n      // Always reset loading state whether success or error\n      setIsGenerating(false);\n    }\n  }, [props, getCurrentFormSnapshot]);\n\n  // Main generate handler with UX improvements\n  const handleGenerate = useCallback(async () => {\n    const currentSnapshot = getCurrentFormSnapshot();\n    \n    // Check if this is a repeat generation with same parameters\n    if (lastGenerationParams.current && areFormSnapshotsEqual(currentSnapshot, lastGenerationParams.current)) {\n      // Show regeneration dialog\n      setShowRegenerationDialog(true);\n      return;\n    }\n\n    // Form has changed or this is first generation, proceed normally\n    await performGeneration(false);\n  }, [getCurrentFormSnapshot, areFormSnapshotsEqual, performGeneration]);\n\n  // Handle regeneration dialog choices\n  const handleRegenerationChoice = useCallback(async (choice: 'same' | 'random') => {\n    setShowRegenerationDialog(false);\n    \n    if (choice === 'same') {\n      // Regenerate with same configuration\n      await performGeneration(false);\n    } else {\n      // Randomize form first, then generate with random server values\n      handleRandomize();\n      // Use setTimeout to ensure state updates are applied before generation\n      setTimeout(() => {\n        performGeneration(true);\n      }, 0);\n    }\n  }, [performGeneration]);\n\n  // Close regeneration dialog\n  const handleCloseRegenerationDialog = useCallback(() => {\n    setShowRegenerationDialog(false);\n  }, []);\n\n  const handleRandomize = useCallback(() => {\n    // Clear all seeds to let server generate random ones\n    props.setCurrentSeed('');\n    props.setAvatarSeed('');\n    \n    // Clear quote and author to get random server-generated ones\n    props.setCustomQuote('');\n    props.setCustomAuthor('');\n    \n    // Clear generation options since we're starting fresh\n    setGenerationOptions(null);\n    \n    // Clear last generation params so next generate won't trigger dialog\n    lastGenerationParams.current = null;\n  }, [props]);\n\n  // Clear all generation state\n  const clearGeneration = useCallback(() => {\n    setIsGenerating(false);\n    setError('');\n    setGenerationOptions(null);\n    setShowRegenerationDialog(false);\n    lastGenerationParams.current = null;\n  }, []);\n\n  return {\n    isGenerating,\n    error,\n    setError,\n    generationOptions,\n    showRegenerationDialog,\n    handleGenerate,\n    handleRandomize,\n    handleRegenerationChoice,\n    handleCloseRegenerationDialog,\n    clearGeneration\n  };\n} ",
    "language":"typescript",
    "lines":293,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/hooks/useAspectRatioSync.ts":{
    "content":"import { useEffect } from 'react';\nimport { ASPECT_RATIO_OPTIONS, AspectRatioConfig } from '../constants/aspectRatios';\nimport { GenerationFormState } from '../types/generation';\n\ninterface UseAspectRatioSyncProps {\n  selectedRatio: string;\n  formState: GenerationFormState;\n  setFormState: (updater: (prev: GenerationFormState) => GenerationFormState) => void;\n}\n\nexport function useAspectRatioSync({\n  selectedRatio,\n  formState,\n  setFormState\n}: UseAspectRatioSyncProps) {\n  \n  useEffect(() => {\n    // Find the selected ratio configuration\n    const ratioConfig = ASPECT_RATIO_OPTIONS.find(option => option.key === selectedRatio);\n    \n    if (ratioConfig) {\n      // Only update if the current form values are empty or different\n      const shouldUpdateWidth = !formState.customWidth || \n        parseInt(formState.customWidth) !== ratioConfig.width;\n      const shouldUpdateHeight = !formState.customHeight || \n        parseInt(formState.customHeight) !== ratioConfig.height;\n      \n      if (shouldUpdateWidth || shouldUpdateHeight) {\n        setFormState(prev => ({\n          ...prev,\n          customWidth: ratioConfig.width.toString(),\n          customHeight: ratioConfig.height.toString()\n        }));\n      }\n    }\n  }, [selectedRatio, formState.customWidth, formState.customHeight, setFormState]);\n\n  // Helper function to get current ratio config\n  const getCurrentRatioConfig = (): AspectRatioConfig | undefined => {\n    return ASPECT_RATIO_OPTIONS.find(option => option.key === selectedRatio);\n  };\n\n  return {\n    getCurrentRatioConfig\n  };\n} ",
    "language":"typescript",
    "lines":46,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/hooks/useWelcomeFlow.ts":{
    "content":"import { useRouter, useSearchParams } from 'next/navigation';\nimport { useCallback, useEffect, useState } from 'react';\n\nexport function useWelcomeFlow() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const [showWelcome, setShowWelcome] = useState<boolean>(true);\n  const [loadGenerationId, setLoadGenerationId] = useState<string>('');\n\n  // Check if we should skip welcome (URL has generation ID)\n  useEffect(() => {\n    const generationIdFromUrl = searchParams.get('id');\n    if (generationIdFromUrl) {\n      setShowWelcome(false);\n    }\n  }, [searchParams]);\n\n  const handleLoadGeneration = () => {\n    if (loadGenerationId.trim()) {\n      setShowWelcome(false);\n      // Use Next.js router for smooth client-side navigation instead of full page reload\n      router.push(`/card-generator?id=${loadGenerationId.trim()}`);\n    }\n  };\n\n  const handleNewGeneration = () => {\n    setShowWelcome(false);\n  };\n\n  const returnToWelcome = () => {\n    setShowWelcome(true);\n    setLoadGenerationId('');\n    // Clear URL parameters by navigating to clean route\n    router.replace('/card-generator');\n  };\n\n  // Clear welcome flow state\n  const clearWelcomeFlow = useCallback(() => {\n    setShowWelcome(true);\n    setLoadGenerationId('');\n  }, []);\n\n  return {\n    showWelcome,\n    loadGenerationId,\n    setLoadGenerationId,\n    handleLoadGeneration,\n    handleNewGeneration,\n    returnToWelcome,\n    clearWelcomeFlow\n  };\n} ",
    "language":"typescript",
    "lines":52,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/hooks/useGenerationLoader.ts":{
    "content":"import { useState } from 'react';\nimport { GenerationFormState, GenerationOptions } from '../types/generation';\n\ninterface UseGenerationLoaderProps {\n  setFormState: (updater: (prev: GenerationFormState) => GenerationFormState) => void;\n  setSvgContent: (content: string) => void;\n  setSelectedRatio: (ratio: string) => void;\n  setError: (error: string) => void;\n  onGenerationLoaded?: () => void;\n}\n\nconst initialFormState: GenerationFormState = {\n  currentSeed: '',\n  avatarSeed: '',\n  customQuote: '',\n  customAuthor: '',\n  customWidth: '',\n  customHeight: '',\n  shapeCount: ''\n};\n\nexport function useGenerationLoader({\n  setFormState,\n  setSvgContent,\n  setSelectedRatio,\n  setError,\n  onGenerationLoaded\n}: UseGenerationLoaderProps) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [loadedOptions, setLoadedOptions] = useState<GenerationOptions | null>(null);\n\n  const loadGeneration = async (id: string): Promise<string | null> => {\n    try {\n      setIsLoading(true);\n      setError('');\n\n      // Immediately clear existing content to show clean loading state\n      setSvgContent('');\n      setFormState(() => initialFormState);\n      setSelectedRatio('default');\n      setLoadedOptions(null);\n\n      const response = await fetch(`/api/og-image/${id}?format=json`, {\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Generation not found');\n      }\n\n      const data = await response.json();\n\n      // Update form state with loaded data\n      setSelectedRatio(data.aspectRatio || 'default');\n      setFormState((prev) => ({\n        ...prev,\n        currentSeed: data.seed || '',\n        avatarSeed: data.generationOptions?.avatarSeed || data.generationOptions?.seed || '',\n        customQuote: data.generationOptions?.quoteText || '',\n        customAuthor: data.generationOptions?.quoteAuthor || '',\n        customWidth: data.generationOptions?.customWidth?.toString() || '',\n        customHeight: data.generationOptions?.customHeight?.toString() || '',\n        shapeCount: data.generationOptions?.shapeCount?.toString() || ''\n      }));\n\n      setSvgContent(data.svg);\n      setLoadedOptions(data.generationOptions);\n\n      if (onGenerationLoaded) {\n        onGenerationLoaded();\n      }\n\n      return id;\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to load generation';\n      setError(errorMessage);\n      \n      // Reset to clean state on error\n      setSvgContent('');\n      setFormState(() => initialFormState);\n      setSelectedRatio('default');\n      setLoadedOptions(null);\n      \n      return null;\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return {\n    isLoading,\n    loadedOptions,\n    loadGeneration\n  };\n} ",
    "language":"typescript",
    "lines":95,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/card-generator/hooks/useFormState.ts":{
    "content":"import { useCallback, useState } from 'react';\nimport { GenerationFormState } from '../types/generation';\n\nconst initialFormState: GenerationFormState = {\n    currentSeed: '',\n    avatarSeed: '',\n    customQuote: '',\n    customAuthor: '',\n    customWidth: '',\n    customHeight: '',\n    shapeCount: ''\n};\n\nexport function useFormState() {\n  const [formState, setFormState] = useState<GenerationFormState>(initialFormState);\n\n  // Helper functions for updating individual fields - memoized to prevent infinite loops\n  const updateField = useCallback((field: keyof GenerationFormState, value: string) => {\n    setFormState(prev => ({ ...prev, [field]: value }));\n  }, []); // Empty dependency array since setFormState is stable\n\n  // Clear all form fields back to initial state\n  const clearFormState = useCallback(() => {\n    setFormState(initialFormState);\n  }, []);\n\n  return {\n    formState,\n    setFormState,\n    updateField,\n    clearFormState\n  };\n} ",
    "language":"typescript",
    "lines":33,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/hooks/useTextInsertion.ts":{
    "content":"import { useCallback } from 'react';\nimport { TextManipulator } from '../../../../../lib/utils/text-extraction';\n\ninterface UseTextInsertionProps {\n  value: string;\n  onChange: (value: string) => void;\n  richInputRef?: React.RefObject<any>;\n}\n\nexport function useTextInsertion({\n  value,\n  onChange,\n  richInputRef\n}: UseTextInsertionProps) {\n  \n  const insertAtCursor = useCallback(\n    (text: string) => {\n      if (richInputRef?.current?.insertText) {\n        // Use the rich input's native insertText method for proper cursor positioning\n        richInputRef.current.insertText(text);\n\n        // Ensure focus is maintained\n        setTimeout(() => {\n          if (richInputRef.current?.focus) {\n            richInputRef.current.focus();\n          }\n        }, 0);\n      } else if (richInputRef?.current?.getState) {\n        // Enhanced fallback: insert at current cursor position\n        const currentState = richInputRef.current.getState();\n        const currentText = currentState.rawText;\n        const cursorPosition = currentState.cursorPosition.index;\n\n        const result = TextManipulator.insertAtPosition(currentText, text, cursorPosition);\n\n        onChange(result.newText);\n\n        // Set cursor position after insertion using rich input's methods\n        setTimeout(() => {\n          if (richInputRef.current) {\n            if (richInputRef.current.focus) {\n              richInputRef.current.focus();\n            }\n            // Use setCursor method if available (preferred over setSelection)\n            if (richInputRef.current.setCursor) {\n              richInputRef.current.setCursor({ index: result.newCursorPosition });\n            } else if (richInputRef.current.setCursorPosition) {\n              richInputRef.current.setCursorPosition(result.newCursorPosition);\n            } else if (richInputRef.current.setSelection) {\n              richInputRef.current.setSelection({\n                start: { index: result.newCursorPosition },\n                end: { index: result.newCursorPosition },\n                direction: 'none'\n              });\n            }\n          }\n        }, 0);\n      } else {\n        // Final fallback: append to current value\n        onChange(value + text);\n\n        // Try to focus the input\n        setTimeout(() => {\n          if (richInputRef?.current?.focus) {\n            richInputRef.current.focus();\n          }\n        }, 0);\n      }\n    },\n    [value, onChange, richInputRef]\n  );\n\n  const replaceTextRange = useCallback(\n    (startPos: number, endPos: number, newText: string) => {\n      const result = TextManipulator.replaceBetween(value, newText, startPos, endPos);\n      onChange(result.newText);\n\n      // Set cursor position after replacement\n      setTimeout(() => {\n        if (richInputRef?.current) {\n          if (richInputRef.current.focus) {\n            richInputRef.current.focus();\n          }\n          if (richInputRef.current.setCursor) {\n            richInputRef.current.setCursor({ index: result.newCursorPosition });\n          }\n        }\n      }, 0);\n\n      return result;\n    },\n    [value, onChange, richInputRef]\n  );\n\n  return {\n    insertAtCursor,\n    replaceTextRange\n  };\n} ",
    "language":"typescript",
    "lines":99,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/hooks/useSearchOverlay.ts":{
    "content":"import { useCallback, useState } from 'react';\nimport { emojiParser } from '../../../../../lib/utils/parsers/emoji-parser';\nimport { useFloatingToolbar } from './useFloatingToolbar';\n\ninterface SearchOverlayState {\n  visible: boolean;\n  type: 'hashtag' | 'mention' | 'emoji' | null;\n  query: string;\n  triggerIndex: number;\n}\n\ninterface UseSearchOverlayProps {\n  value: string;\n  onChange: (value: string) => void;\n  existingHashtags: string[];\n  existingUserIds: string[];\n  mentionFilterType: 'author' | 'mentions';\n  enableHashtags: boolean;\n  enableUserMentions: boolean;\n  enableEmojis: boolean;\n}\n\nexport function useSearchOverlay({\n  value,\n  onChange,\n  existingHashtags,\n  existingUserIds,\n  mentionFilterType,\n  enableHashtags,\n  enableUserMentions,\n  enableEmojis\n}: UseSearchOverlayProps) {\n  const [searchOverlay, setSearchOverlay] = useState<SearchOverlayState>({\n    visible: false,\n    type: null,\n    query: '',\n    triggerIndex: -1\n  });\n\n  const [emojiResults, setEmojiResults] = useState<any[]>([]);\n\n  // Use existing hooks for hashtag and mention search\n  const {\n    hashtagQuery,\n    setHashtagQuery,\n    mentionQuery,\n    setMentionQuery,\n    hashtagResults,\n    mentionResults,\n    loadingHashtags,\n    loadingMentions\n  } = useFloatingToolbar(existingHashtags, existingUserIds);\n\n  // Get search results based on overlay type\n  const getSearchResults = useCallback(() => {\n    if (!searchOverlay.visible || !searchOverlay.type) return [];\n\n    switch (searchOverlay.type) {\n      case 'hashtag':\n        return hashtagResults;\n      case 'mention':\n        return mentionResults;\n      case 'emoji':\n        return emojiResults;\n      default:\n        return [];\n    }\n  }, [searchOverlay, hashtagResults, mentionResults, emojiResults]);\n\n  // Check if search is loading\n  const isSearchLoading = useCallback(() => {\n    if (!searchOverlay.visible || !searchOverlay.type) return false;\n\n    switch (searchOverlay.type) {\n      case 'hashtag':\n        return loadingHashtags;\n      case 'mention':\n        return loadingMentions;\n      case 'emoji':\n        return false; // Emoji search is synchronous\n      default:\n        return false;\n    }\n  }, [searchOverlay, loadingHashtags, loadingMentions]);\n\n  // Handle search result selection\n  const handleSearchResultSelect = useCallback(\n    (item: any) => {\n      const currentValue = value || '';\n      const triggerIndex = searchOverlay.triggerIndex;\n      const queryLength = searchOverlay.query.length;\n      const replaceEndIndex = triggerIndex + 1 + queryLength; // +1 for trigger character\n\n      // Generate the structured text\n      let insertText = '';\n      if (searchOverlay.type === 'mention') {\n        insertText = `@[${item.displayName || item.label}|${item.value}|${mentionFilterType}] `;\n      } else if (searchOverlay.type === 'hashtag') {\n        insertText = item.value.startsWith('#')\n          ? `${item.value} `\n          : `#${item.value} `;\n      } else if (searchOverlay.type === 'emoji') {\n        insertText = item.unicode || `:${item.name}:`;\n      }\n\n      const beforeTrigger = currentValue.substring(0, triggerIndex);\n      const afterQuery = currentValue.substring(replaceEndIndex);\n      const newValue = beforeTrigger + insertText + afterQuery;\n\n      onChange(newValue);\n      hideSearchOverlay();\n    },\n    [value, searchOverlay, onChange, mentionFilterType]\n  );\n\n  // Hide search overlay\n  const hideSearchOverlay = useCallback(() => {\n    setSearchOverlay({\n      visible: false,\n      type: null,\n      query: '',\n      triggerIndex: -1\n    });\n  }, []);\n\n  // Detect trigger and show overlay\n  const detectTriggerAndShowOverlay = useCallback(\n    (text: string, cursorPosition: number) => {\n      if (!text || cursorPosition < 0) {\n        hideSearchOverlay();\n        return;\n      }\n\n      const beforeCursor = text.substring(0, cursorPosition);\n\n      // Find the closest trigger character before cursor\n      const hashIndex = beforeCursor.lastIndexOf('#');\n      const atIndex = beforeCursor.lastIndexOf('@');\n      const colonIndex = beforeCursor.lastIndexOf(':');\n\n      const triggers = [\n        { index: hashIndex, type: 'hashtag' as const, char: '#' },\n        { index: atIndex, type: 'mention' as const, char: '@' },\n        { index: colonIndex, type: 'emoji' as const, char: ':' }\n      ].filter((t) => t.index >= 0);\n\n      if (triggers.length === 0) {\n        hideSearchOverlay();\n        return;\n      }\n\n      // Get the most recent trigger\n      const lastTrigger = triggers.reduce((latest, current) =>\n        current.index > latest.index ? current : latest\n      );\n\n      const query = beforeCursor.substring(lastTrigger.index + 1);\n\n      // Enhanced termination conditions for different trigger types\n      if (lastTrigger.type === 'hashtag') {\n        if (\n          query.includes(' ') ||\n          (query === '' && beforeCursor.endsWith('# ')) ||\n          /^[a-zA-Z0-9_-]+\\\\s/.test(query)\n        ) {\n          hideSearchOverlay();\n          return;\n        }\n\n        const textAfterTrigger = text.substring(lastTrigger.index);\n        const hashtagMatch = textAfterTrigger.match(/^#([a-zA-Z0-9_-]+)\\\\s/);\n        if (\n          hashtagMatch &&\n          cursorPosition === lastTrigger.index + hashtagMatch[0].length\n        ) {\n          hideSearchOverlay();\n          return;\n        }\n      } else if (lastTrigger.type === 'mention') {\n        if (\n          query.includes('[') ||\n          query.includes(']') ||\n          /^[a-zA-Z0-9_-]+\\\\]\\\\s/.test(query)\n        ) {\n          hideSearchOverlay();\n          return;\n        }\n\n        const textAfterTrigger = text.substring(lastTrigger.index);\n        const mentionMatch = textAfterTrigger.match(\n          /^@\\\\[[^|\\\\]]+\\\\|[^|\\\\]]+\\\\|[^|\\\\]]+\\\\]\\\\s/\n        );\n        if (\n          mentionMatch &&\n          cursorPosition === lastTrigger.index + mentionMatch[0].length\n        ) {\n          hideSearchOverlay();\n          return;\n        }\n      } else if (lastTrigger.type === 'emoji') {\n        if (query.includes(' ') || query.endsWith(':')) {\n          hideSearchOverlay();\n          return;\n        }\n      }\n\n      // Don't show overlay for very short queries (but allow 1 character for emoji)\n      const minQueryLength = lastTrigger.type === 'emoji' ? 1 : 2;\n      if (query.length < minQueryLength) {\n        hideSearchOverlay();\n        return;\n      }\n\n      // Update search queries based on type\n      if (lastTrigger.type === 'hashtag' && enableHashtags) {\n        setHashtagQuery(query);\n      } else if (lastTrigger.type === 'mention' && enableUserMentions) {\n        setMentionQuery(query);\n      } else if (lastTrigger.type === 'emoji' && enableEmojis) {\n        // Use emojiParser to get emoji suggestions\n        try {\n          const results = emojiParser.getSuggestions(query, 10);\n          setEmojiResults(results);\n        } catch (error) {\n          console.warn('Error getting emoji suggestions:', error);\n          setEmojiResults([]);\n        }\n      }\n\n      // Store search overlay state\n      setSearchOverlay({\n        visible: true,\n        type: lastTrigger.type,\n        query: query,\n        triggerIndex: lastTrigger.index\n      });\n    },\n    [\n      enableHashtags,\n      enableUserMentions,\n      enableEmojis,\n      setHashtagQuery,\n      setMentionQuery,\n      hideSearchOverlay\n    ]\n  );\n\n  return {\n    searchOverlay,\n    searchResults: getSearchResults(),\n    isSearchLoading: isSearchLoading(),\n    handleSearchResultSelect,\n    detectTriggerAndShowOverlay,\n    hideSearchOverlay\n  };\n} ",
    "language":"typescript",
    "lines":256,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/hooks/useFocusManagement.ts":{
    "content":"import { useCallback, useEffect, useRef, useState } from 'react';\n\ninterface UseFocusManagementProps {\n  containerRef: React.RefObject<HTMLElement>;\n  onFocusChange?: (isFocused: boolean) => void;\n  blurDelay?: number;\n}\n\nexport function useFocusManagement({\n  containerRef,\n  onFocusChange,\n  blurDelay = 150\n}: UseFocusManagementProps) {\n  const [isFocused, setIsFocused] = useState(false);\n  const [isInteracting, setIsInteracting] = useState(false);\n  const focusTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const handleFocus = useCallback(() => {\n    // Clear any pending focus loss\n    if (focusTimeoutRef.current) {\n      clearTimeout(focusTimeoutRef.current);\n      focusTimeoutRef.current = null;\n    }\n    \n    if (!isFocused) {\n      setIsFocused(true);\n      onFocusChange?.(true);\n    }\n  }, [isFocused, onFocusChange]);\n\n  const handleBlur = useCallback(() => {\n    // Don't immediately lose focus - use a timeout to check if focus truly left\n    if (focusTimeoutRef.current) {\n      clearTimeout(focusTimeoutRef.current);\n    }\n\n    focusTimeoutRef.current = setTimeout(() => {\n      // Only lose focus if we're not interacting and focus has truly left the component\n      if (!isInteracting) {\n        const activeElement = document.activeElement;\n        const container = containerRef.current;\n\n        // Check if focus is still within our component\n        if (\n          !container ||\n          !activeElement ||\n          !container.contains(activeElement)\n        ) {\n          setIsFocused(false);\n          onFocusChange?.(false);\n        }\n      }\n    }, blurDelay);\n  }, [isInteracting, containerRef, onFocusChange, blurDelay]);\n\n  const setInteracting = useCallback((interacting: boolean) => {\n    setIsInteracting(interacting);\n  }, []);\n\n  // Cleanup timeout on unmount\n  useEffect(() => {\n    return () => {\n      if (focusTimeoutRef.current) {\n        clearTimeout(focusTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    isFocused,\n    handleFocus,\n    handleBlur,\n    setInteracting\n  };\n} ",
    "language":"typescript",
    "lines":75,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/hooks/useFloatingToolbar.ts":{
    "content":"import { useEffect, useMemo, useState } from 'react';\nimport {\n  HashtagResult,\n  searchHashtags,\n  searchUsers,\n  UserResult\n} from '../../../../../lib/actions/search.actions';\n\nexport const useFloatingToolbar = (\n  existingHashtags: string[] = [],\n  existingUserIds: string[] = []\n) => {\n  const [hashtagQuery, setHashtagQuery] = useState('');\n  const [mentionQuery, setMentionQuery] = useState('');\n  const [hashtagResults, setHashtagResults] = useState<any[]>([]);\n  const [mentionResults, setMentionResults] = useState<any[]>([]);\n  const [loadingHashtags, setLoadingHashtags] = useState(false);\n  const [loadingMentions, setLoadingMentions] = useState(false);\n\n  // Create stable string representations for dependency comparison\n  const existingHashtagsKey = useMemo(\n    () => existingHashtags.sort().join(','),\n    [existingHashtags]\n  );\n  const existingUserIdsKey = useMemo(\n    () => existingUserIds.sort().join(','),\n    [existingUserIds]\n  );\n\n  // Search hashtags using real server action\n  useEffect(() => {\n    if (hashtagQuery.length >= 2) {\n      setLoadingHashtags(true);\n\n      // Use the existing hashtag search server action\n      const searchHashtagsAsync = async () => {\n        try {\n          const result = await searchHashtags(hashtagQuery, 1, 10);\n\n          // Transform the server action response to match expected format and mark disabled\n          const transformedResults = result.items.map(\n            (hashtag: HashtagResult) => {\n              const hashtagValue = hashtag.value.startsWith('#')\n                ? hashtag.value\n                : `#${hashtag.value}`;\n              const isDisabled = existingHashtags.includes(hashtagValue);\n\n              return {\n                id: hashtag.id,\n                label: hashtag.label,\n                value: hashtag.value,\n                count: hashtag.count,\n                disabled: isDisabled\n              };\n            }\n          );\n\n          setHashtagResults(transformedResults);\n        } catch (error) {\n          console.warn('Error searching hashtags:', error);\n          // Fallback to simple suggestion\n          const fallbackValue = hashtagQuery.startsWith('#')\n            ? hashtagQuery\n            : `#${hashtagQuery}`;\n          const isDisabled = existingHashtags.includes(fallbackValue);\n\n          setHashtagResults([\n            {\n              id: `${hashtagQuery}-1`,\n              label: hashtagQuery,\n              value: fallbackValue,\n              count: 0,\n              disabled: isDisabled\n            }\n          ]);\n        } finally {\n          setLoadingHashtags(false);\n        }\n      };\n\n      const timeoutId = setTimeout(searchHashtagsAsync, 300); // Debounce\n      return () => {\n        clearTimeout(timeoutId);\n        // Ensure loading state is cleared if component unmounts or query changes\n        setLoadingHashtags(false);\n      };\n    } else {\n      setHashtagResults([]);\n      setLoadingHashtags(false);\n    }\n  }, [hashtagQuery, existingHashtagsKey, existingHashtags]);\n\n  // Search mentions using real server action\n  useEffect(() => {\n    if (mentionQuery.length >= 2) {\n      setLoadingMentions(true);\n\n      // Use the existing user search server action\n      const searchUsersAsync = async () => {\n        try {\n          const result = await searchUsers(mentionQuery, 1, 10);\n\n          // Transform the server action response to match expected format and mark disabled\n          const transformedResults = result.items.map((user: UserResult) => {\n            const isDisabled = existingUserIds.includes(user.value);\n\n            return {\n              id: user.id,\n              label: user.label,\n              value: user.value,\n              displayName: user.displayName,\n              avatar: user.avatar,\n              isAuthor: false,\n              disabled: isDisabled\n            };\n          });\n\n          setMentionResults(transformedResults);\n        } catch (error) {\n          console.warn('Error searching users:', error);\n          // Fallback to simple suggestion\n          const fallbackValue = `${mentionQuery}-id`;\n          const isDisabled = existingUserIds.includes(fallbackValue);\n\n          setMentionResults([\n            {\n              id: `${mentionQuery}-user`,\n              label: `${mentionQuery}`,\n              value: fallbackValue,\n              displayName: `${mentionQuery}`,\n              avatar: null,\n              isAuthor: false,\n              disabled: isDisabled\n            }\n          ]);\n        } finally {\n          setLoadingMentions(false);\n        }\n      };\n\n      const timeoutId = setTimeout(searchUsersAsync, 300); // Debounce\n      return () => {\n        clearTimeout(timeoutId);\n        // Ensure loading state is cleared if component unmounts or query changes\n        setLoadingMentions(false);\n      };\n    } else {\n      setMentionResults([]);\n      setLoadingMentions(false);\n    }\n  }, [mentionQuery, existingUserIdsKey, existingUserIds]);\n\n  return {\n    hashtagQuery,\n    setHashtagQuery,\n    mentionQuery,\n    setMentionQuery,\n    hashtagResults,\n    mentionResults,\n    loadingHashtags,\n    loadingMentions\n  };\n};\n",
    "language":"typescript",
    "lines":164,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/hooks/useValueExtraction.ts":{
    "content":"import { useMemo } from 'react';\nimport { TextExtractor } from '../../../../../lib/utils/text-extraction';\n\nexport function useValueExtraction(value: string) {\n  // Memoize extracted values to prevent unnecessary re-renders\n  const existingHashtags = useMemo(\n    () => TextExtractor.extractHashtags(value),\n    [value]\n  );\n  \n  const existingUserIds = useMemo(\n    () => TextExtractor.extractUserIds(value),\n    [value]\n  );\n\n  const existingMentions = useMemo(\n    () => TextExtractor.extractUserMentions(value),\n    [value]\n  );\n\n  const existingUrls = useMemo(\n    () => TextExtractor.extractUrls(value),\n    [value]\n  );\n\n  return {\n    existingHashtags,\n    existingUserIds,\n    existingMentions,\n    existingUrls\n  };\n} ",
    "language":"typescript",
    "lines":32,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/hooks/useSubmissionForm.ts":{
    "content":"import { useRouter } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport { buildThreadUrl } from '../../../../../lib/routes';\nimport { getEffectiveCharacterCount } from '../../../../../lib/utils/string';\nimport { validateTagsInput } from '../../../../../lib/utils/string/tag-regex';\nimport { createSubmissionAction, editSubmissionAction } from '../../actions';\n\ninterface UseSubmissionFormProps {\n  mode: 'create' | 'reply' | 'edit';\n  initialTitle?: string;\n  initialContent?: string;\n  initialTags?: string;\n  replyToAuthor?: string;\n  submissionId?: number;\n  parentId?: number;\n  onSuccess?: (result?: any) => void;\n}\n\nexport const useSubmissionForm = ({\n  mode,\n  initialTitle = '',\n  initialContent = '',\n  initialTags = '',\n  replyToAuthor,\n  submissionId,\n  parentId,\n  onSuccess\n}: UseSubmissionFormProps) => {\n  const router = useRouter();\n  const [formData, setFormData] = useState({\n    title: '',\n    content: '',\n    tags: ''\n  });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState('');\n  const [tagErrors, setTagErrors] = useState<string[]>([]);\n  const [contentViewMode, setContentViewMode] = useState<'preview' | 'raw'>(\n    'preview'\n  );\n\n  // Initialize form data based on mode\n  useEffect(() => {\n    const initializeForm = async () => {\n      if (mode === 'edit') {\n        setFormData({\n          title: initialTitle,\n          content: initialContent,\n          tags: initialTags\n        });\n      } else if (mode === 'reply' && replyToAuthor) {\n        // Create properly formatted mention for reply\n        try {\n          const { getUserInfo } = await import(\n            '../../../../../lib/actions/search.actions'\n          );\n          const userInfo = await getUserInfo(replyToAuthor);\n\n          const properMention =\n            userInfo && userInfo.userId\n              ? `@[${replyToAuthor}|${userInfo.userId}|author] `\n              : `@${replyToAuthor} `;\n\n          setFormData({\n            title: '',\n            content: properMention,\n            tags: ''\n          });\n        } catch (error) {\n          console.error('Error creating mention format:', error);\n          setFormData({\n            title: '',\n            content: `@${replyToAuthor} `,\n            tags: ''\n          });\n        }\n      } else {\n        setFormData({\n          title: '',\n          content: '',\n          tags: ''\n        });\n      }\n    };\n\n    initializeForm();\n  }, [mode, initialTitle, initialContent, initialTags, replyToAuthor]);\n\n  const handleInputChange = (field: keyof typeof formData, value: string) => {\n    setFormData((prev) => ({\n      ...prev,\n      [field]: value\n    }));\n\n    // Validate tags if tags field changed\n    if (field === 'tags') {\n      const validationErrors = validateTagsInput(value);\n      setTagErrors(validationErrors);\n    }\n  };\n\n  const processTemporaryImages = async (content: string): Promise<string> => {\n    // Find all temporary image pills\n    const tempImageRegex =\n      /!\\\\[([^\\\\]]*)\\\\]\\\\(data:temp-image;name=[^;]*;(data:image\\\\/[^;]*;base64,[A-Za-z0-9+/=]+)\\\\)/g;\n    const tempImages: Array<{\n      fullMatch: string;\n      behavior: string;\n      dataURL: string;\n      start: number;\n      end: number;\n    }> = [];\n\n    let match;\n    while ((match = tempImageRegex.exec(content)) !== null) {\n      tempImages.push({\n        fullMatch: match[0],\n        behavior: match[1],\n        dataURL: match[2],\n        start: match.index,\n        end: match.index + match[0].length\n      });\n    }\n\n    if (tempImages.length === 0) {\n      return content;\n    }\n\n    // Convert data URLs back to files and upload them\n    const { uploadImageFile } = await import('../utils/imageUpload');\n    const uploadPromises = tempImages.map(async (tempImage) => {\n      try {\n        const response = await fetch(tempImage.dataURL);\n        const blob = await response.blob();\n        const file = new File([blob], 'pasted-image.png', { type: blob.type });\n        const uploadedURL = await uploadImageFile(file);\n        return { ...tempImage, uploadedURL };\n      } catch (error) {\n        console.error('Failed to upload temporary image:', error);\n        return { ...tempImage, uploadedURL: null };\n      }\n    });\n\n    const uploadResults = await Promise.all(uploadPromises);\n\n    // Replace temporary pills with uploaded URLs (process from end to start)\n    let processedContent = content;\n    const sortedResults = uploadResults.sort((a, b) => b.start - a.start);\n\n    for (const result of sortedResults) {\n      if (result.uploadedURL) {\n        const newPill = `![${result.behavior}](${result.uploadedURL})`;\n        processedContent =\n          processedContent.slice(0, result.start) +\n          newPill +\n          processedContent.slice(result.end);\n      } else {\n        processedContent =\n          processedContent.slice(0, result.start) +\n          '[Image upload failed]' +\n          processedContent.slice(result.end);\n      }\n    }\n\n    return processedContent;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validation\n    if (!formData.title.trim()) {\n      setError('Title is required');\n      return;\n    }\n\n    if (!formData.content.trim()) {\n      setError('Content is required');\n      return;\n    }\n\n    if (getEffectiveCharacterCount(formData.title) > 255) {\n      setError('Title must be 255 characters or less');\n      return;\n    }\n\n    if (getEffectiveCharacterCount(formData.content) > 1000) {\n      setError('Content must be 1000 characters or less');\n      return;\n    }\n\n    if (tagErrors.length > 0) {\n      setError('Please fix tag errors before submitting');\n      return;\n    }\n\n    if (mode === 'reply' && !parentId) {\n      setError('Parent ID is required for replies');\n      return;\n    }\n\n    if (mode === 'edit' && !submissionId) {\n      setError('Submission ID is required for editing');\n      return;\n    }\n\n    setIsSubmitting(true);\n    setError('');\n\n    try {\n      // Process temporary images in title and content before submission\n      const processedTitle = await processTemporaryImages(formData.title);\n      const processedContent = await processTemporaryImages(formData.content);\n\n      const submitFormData = new FormData();\n      submitFormData.append('submission_title', processedTitle.trim());\n      submitFormData.append('submission_content', processedContent.trim());\n      submitFormData.append('submission_tags', formData.tags.trim());\n\n      // Add parent ID for replies\n      if (mode === 'reply' && parentId) {\n        submitFormData.append('thread_parent_id', parentId.toString());\n      }\n\n      // Add submission ID for edits\n      if (mode === 'edit' && submissionId) {\n        submitFormData.append('submission_id', submissionId.toString());\n      }\n\n      // Choose the correct action based on mode\n      const action =\n        mode === 'edit' ? editSubmissionAction : createSubmissionAction;\n      const result = await action({ status: 0 }, submitFormData);\n\n      if (result.status === 1) {\n        // Reset form only for create/reply modes, not edit\n        if (mode !== 'edit') {\n          if (mode === 'reply' && replyToAuthor) {\n            // Try to get proper mention format for reset\n            try {\n              const { getUserInfo } = await import(\n                '../../../../../lib/actions/search.actions'\n              );\n              const userInfo = await getUserInfo(replyToAuthor);\n\n              const properMention =\n                userInfo && userInfo.userId\n                  ? `@[${replyToAuthor}|${userInfo.userId}|author] `\n                  : `@${replyToAuthor} `;\n\n              setFormData({\n                title: '',\n                content: properMention,\n                tags: ''\n              });\n            } catch (error) {\n              console.error('Error creating mention format for reset:', error);\n              setFormData({\n                title: '',\n                content: `@${replyToAuthor} `,\n                tags: ''\n              });\n            }\n          } else {\n            setFormData({\n              title: '',\n              content: '',\n              tags: ''\n            });\n          }\n        }\n        setTagErrors([]);\n\n        // Handle redirect for reply mode - only redirect if not already on thread page\n        if (mode === 'reply' && parentId) {\n          // Check if we're already on the thread page\n          const currentPath = window.location.pathname;\n          const threadPath = buildThreadUrl(parentId);\n\n          // Only redirect if we're not already on the thread page\n          if (!currentPath.includes(`/t/${parentId}`)) {\n            // Use setTimeout to allow the success callback to run first\n            setTimeout(() => {\n              router.push(threadPath);\n            }, 100);\n          }\n        }\n\n        // Call success callback\n        if (onSuccess) {\n          onSuccess(result);\n        }\n      } else {\n        const errorMessage =\n          result.error ||\n          `Failed to ${mode === 'reply' ? 'submit reply' : mode === 'edit' ? 'update post' : 'create post'}`;\n        setError(errorMessage);\n      }\n    } catch (err) {\n      console.error('Submission error:', err);\n      setError('An unexpected error occurred. Please try again.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const isFormValid =\n    formData.title.trim() && formData.content.trim() && tagErrors.length === 0;\n  const titleCharsRemaining = 255 - getEffectiveCharacterCount(formData.title);\n  const contentCharsRemaining =\n    1000 - getEffectiveCharacterCount(formData.content);\n\n  return {\n    formData,\n    isSubmitting,\n    error,\n    tagErrors,\n    contentViewMode,\n    setContentViewMode,\n    handleInputChange,\n    handleSubmit,\n    isFormValid,\n    titleCharsRemaining,\n    contentCharsRemaining\n  };\n};\n",
    "language":"typescript",
    "lines":327,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/shared-submission-form/hooks/useUrlAutoConversion.ts":{
    "content":"import { useCallback } from 'react';\nimport { createURLPill, findDomainConfig } from '../../../../../lib/config/url-pills';\nimport { TextManipulator } from '../../../../../lib/utils/text-extraction';\n\ninterface UseUrlAutoConversionProps {\n  value: string;\n  onChange: (value: string) => void;\n  richInputRef?: React.RefObject<any>;\n}\n\nexport function useUrlAutoConversion({\n  value,\n  onChange,\n  richInputRef\n}: UseUrlAutoConversionProps) {\n  \n  const handleValueChangeWithURLDetection = useCallback(\n    (newValue: string, previousValue?: string) => {\n      const prevValue = previousValue || value || '';\n      if (newValue.length <= prevValue.length) {\n        return newValue; // Don't convert on deletion\n      }\n\n      const textAdded = newValue.length - prevValue.length;\n      const lastChar = newValue[newValue.length - 1];\n\n      // Scenario 1: User typed a space or newline after URL\n      const isSpaceOrNewlineTrigger =\n        (lastChar === ' ' || lastChar === '\\\\n') && textAdded === 1;\n\n      // Scenario 2: User pasted content (significant text addition)\n      const isPasteTrigger = textAdded > 5; // Arbitrary threshold for paste detection\n\n      if (!isSpaceOrNewlineTrigger && !isPasteTrigger) {\n        return newValue; // Only convert on space/newline or paste\n      }\n\n      // Get cursor position from rich input\n      let cursorPosition = newValue.length;\n      if (richInputRef?.current?.getState) {\n        const state = richInputRef.current.getState();\n        cursorPosition = state?.cursorPosition?.index || newValue.length;\n      }\n\n      let textToCheck: string;\n      let searchEndIndex: number;\n\n      if (isSpaceOrNewlineTrigger) {\n        // For space/newline trigger, check the word before the trigger\n        textToCheck = newValue.slice(0, cursorPosition - 1);\n        searchEndIndex = cursorPosition - 1;\n      } else {\n        // For paste trigger, check all the newly added text\n        textToCheck = newValue.slice(0, cursorPosition);\n        searchEndIndex = cursorPosition;\n      }\n\n      // Find URLs in the text to check\n      const words = textToCheck.split(/[\\\\s\\\\n]+/);\n      const lastWord = words[words.length - 1];\n\n      // Check if the last word is a URL\n      if (lastWord) {\n        const urlRegex = /^https?:\\\\/\\\\/[^\\\\s<>\\\"{}|\\\\\\\\^`[\\\\]]+$/;\n        const isURL = urlRegex.test(lastWord);\n\n        if (isURL) {\n          const url = lastWord;\n          const domainConfig = findDomainConfig(url);\n\n          if (domainConfig) {\n            // Convert URL to structured pill format\n            const pillFormat = createURLPill(url, domainConfig.defaultBehavior);\n\n            // Find the URL position in the text\n            const urlStartIndex = textToCheck.lastIndexOf(lastWord);\n            const urlEndIndex = urlStartIndex + lastWord.length;\n\n            let newContent: string;\n            let newCursorPos: number;\n\n            if (isSpaceOrNewlineTrigger) {\n              // Keep the space/newline that triggered the conversion\n              const result = TextManipulator.replaceBetween(\n                newValue,\n                pillFormat + lastChar,\n                urlStartIndex,\n                urlEndIndex + 1\n              );\n              newContent = result.newText;\n              newCursorPos = result.newCursorPosition;\n            } else {\n              // For paste, just replace the URL\n              const result = TextManipulator.replaceBetween(\n                newValue,\n                pillFormat,\n                urlStartIndex,\n                urlEndIndex\n              );\n              newContent = result.newText;\n              newCursorPos = result.newCursorPosition;\n            }\n\n            // Update the content\n            onChange(newContent);\n\n            // Set cursor position after the pill using rich input API\n            setTimeout(() => {\n              if (richInputRef?.current) {\n                richInputRef.current.setCursor?.({ index: newCursorPos });\n                richInputRef.current.focus?.();\n              }\n            }, 0);\n\n            return newContent;\n          }\n        }\n      }\n\n      return newValue;\n    },\n    [value, onChange, richInputRef]\n  );\n\n  return {\n    handleValueChangeWithURLDetection\n  };\n} ",
    "language":"typescript",
    "lines":128,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/hooks/usePostsManagerState.ts":{
    "content":"'use client';\n\nimport { usePathname } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport { useUserPreferences } from '../../../../lib/context/UserPreferencesContext';\n\nexport interface PostsManagerState {\n  spacingTheme: 'cozy' | 'compact';\n  includeThreadReplies: boolean;\n  setIncludeThreadReplies: (include: boolean) => void;\n  isMobile: boolean;\n  infiniteScrollMode: boolean;\n  setInfiniteScrollMode: (mode: boolean) => Promise<void>;\n  showFilters: boolean;\n  setShowFilters: (show: boolean) => void;\n}\n\nexport function usePostsManagerState(): PostsManagerState {\n  const { spacingTheme, paginationMode, setPaginationMode } =\n    useUserPreferences();\n  const pathname = usePathname();\n  const [includeThreadReplies, setIncludeThreadReplies] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n\n  // Detect mobile screen size\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth <= 768);\n    };\n\n    // Check on mount\n    checkMobile();\n\n    // Add resize listener\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n\n  // Convert pagination mode to boolean for backward compatibility\n  const infiniteScrollMode = paginationMode === 'infinite';\n  const setInfiniteScrollMode = async (mode: boolean) => {\n    await setPaginationMode(mode ? 'infinite' : 'traditional');\n  };\n\n  // Initialize filter visibility state properly to avoid flicker\n  const [showFilters, setShowFilters] = useState(() => {\n    // Only access localStorage on client side to avoid hydration mismatch\n    if (typeof window === 'undefined') {\n      return false; // Default to collapsed on server side\n    }\n\n    // Check localStorage first, fallback to theme-based default\n    const saved = localStorage.getItem('posts-manager-filters-expanded');\n    if (saved !== null) {\n      return saved === 'true';\n    }\n    return spacingTheme === 'cozy'; // Show filters by default in cozy mode, hide in compact mode\n  });\n\n  // Save filter visibility to localStorage when it changes\n  useEffect(() => {\n    localStorage.setItem(\n      'posts-manager-filters-expanded',\n      showFilters.toString()\n    );\n  }, [showFilters]);\n\n  return {\n    spacingTheme,\n    includeThreadReplies,\n    setIncludeThreadReplies,\n    isMobile,\n    infiniteScrollMode,\n    setInfiniteScrollMode,\n    showFilters,\n    setShowFilters\n  };\n}\n",
    "language":"typescript",
    "lines":79,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/hooks/usePostsManagerHandlers.ts":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { useAtom } from 'jotai';\nimport { useCallback, useRef } from 'react';\nimport { getSubmissionsFiltersAtom, shouldUpdateAtom } from '../../../../lib/state/atoms';\nimport { PostFilters } from '../../../../lib/types/filters';\n\nconst logger = createLogger({\n  context: {\n    component: 'usePostsManagerHandlers',\n    module: 'hooks'\n  },\n  enabled: true\n});\n\nexport interface PostsManagerHandlers {\n  handleAddFilter: (filter: any) => void;\n  handleAddFilters: (filterList: any[]) => void;\n  handleTagClick: (tag: string) => void;\n  handleHashtagClick: (hashtag: string) => void;\n  handleMentionClick: (\n    mention: string,\n    filterType: 'author' | 'mentions'\n  ) => void;\n  handleToggleThreadReplies: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  handleNewPostClick: () => void;\n  handleRefresh: () => void;\n  handleFilterSuccess: () => void;\n  handleUpdateFilter: (name: string, value: string) => void;\n  handleTextSearch: (searchText: string) => void;\n}\n\nexport interface PostsManagerHandlersOptions {\n  addFilter: (filter: any) => void;\n  addFilters: (filters: any[]) => void;\n  removeFilter: (filterName: PostFilters, filterValue?: string) => void;\n  updateFilter: (filterName: PostFilters, newValue: string) => void;\n  setIncludeThreadReplies: (value: boolean) => void;\n  onNewPostClick?: () => void;\n  contextId: string; // Add contextId to access filters from atom\n}\n\nexport function usePostsManagerHandlers({\n  addFilter,\n  addFilters,\n  removeFilter,\n  updateFilter,\n  setIncludeThreadReplies,\n  onNewPostClick,\n  contextId\n}: PostsManagerHandlersOptions): PostsManagerHandlers {\n  const [, setShouldUpdate] = useAtom(shouldUpdateAtom);\n  const [filtersState] = useAtom(getSubmissionsFiltersAtom(contextId));\n\n  // Use refs for stable function references\n  const addFilterRef = useRef(addFilter);\n  addFilterRef.current = addFilter;\n\n  // Filter handlers without automatic expansion\n  const handleAddFilter = useCallback(\n    (filter: any) => {\n      addFilter(filter);\n    },\n    [addFilter]\n  );\n\n  const handleAddFilters = useCallback(\n    (filterList: any[]) => {\n      logger.debug('[RACE_FIX] \u2795 ADD_FILTERS: Adding filters', { filterList });\n      addFilters(filterList);\n    },\n    [addFilters]\n  );\n\n  // Optimize callbacks with useCallback to prevent child re-renders\n  const handleTagClick = useCallback(\n    (tag: string) => {\n      // Store tags without # prefix to match URL format and prevent normalization conflicts\n      const normalizedTag = tag.startsWith('#') ? tag.slice(1) : tag;\n      \n      // Get current filters at execution time from atom (not from dependencies)\n      const currentFilters = filtersState.filters;\n      const existingTagFilters = currentFilters.filter(f => f.name === 'tags');\n      const willHaveMultipleTags = existingTagFilters.length >= 1; // Will have multiple after adding this one\n      \n      // Debug logging\n      logger.debug('[RACE_FIX] \ud83c\udff7\ufe0f TAG_CLICK: Tag click handler called', {\n        tag,\n        normalizedTag,\n        existingTagFilters,\n        willHaveMultipleTags,\n        currentFiltersLength: currentFilters.length\n      });\n      \n      // Prepare filters to add\n      const filtersToAdd = [\n        { name: 'tags', value: normalizedTag }\n      ];\n      \n      // Add tagLogic if we'll have multiple tags\n      if (willHaveMultipleTags) {\n        filtersToAdd.push({ name: 'tagLogic', value: 'OR' });\n      }\n      \n      logger.debug('[RACE_FIX] \ud83c\udff7\ufe0f TAG_CLICK: Filters to add', { filtersToAdd });\n      \n      // Add all filters atomically to prevent double fetches\n      addFilters(filtersToAdd);\n    },\n    [addFilters] // Remove filtersState.filters from dependencies\n  );\n\n  const handleHashtagClick = useCallback(\n    (hashtag: string) => {\n      // Store tags without # prefix to match URL format and prevent normalization conflicts\n      const normalizedHashtag = hashtag.startsWith('#') ? hashtag.slice(1) : hashtag;\n      \n      // Get current filters at execution time from atom (not from dependencies)\n      const currentFilters = filtersState.filters;\n      const existingTagFilters = currentFilters.filter(f => f.name === 'tags');\n      const willHaveMultipleTags = existingTagFilters.length >= 1; // Will have multiple after adding this one\n      \n      // Prepare filters to add\n      const filtersToAdd = [\n        { name: 'tags', value: normalizedHashtag }\n      ];\n      \n      // Add tagLogic if we'll have multiple tags\n      if (willHaveMultipleTags) {\n        filtersToAdd.push({ name: 'tagLogic', value: 'OR' });\n      }\n        \n      // Add all filters atomically to prevent double fetches\n      addFilters(filtersToAdd);\n    },\n    [addFilters] // Remove filtersState.filters from dependencies\n  );\n\n  const handleMentionClick = useCallback(\n    (mention: string, filterType: 'author' | 'mentions') => {\n      addFilter({\n        name: filterType,\n        value: mention.replace('@', '')\n      });\n    },\n    [addFilter]\n  );\n\n  const handleToggleThreadReplies = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setIncludeThreadReplies(e.target.checked);\n    },\n    [setIncludeThreadReplies]\n  );\n\n  const handleNewPostClick = useCallback(() => {\n    if (onNewPostClick) {\n      onNewPostClick();\n    }\n  }, [onNewPostClick]);\n\n  const handleRefresh = useCallback(() => {\n    // Trigger a refresh using the shouldUpdateAtom mechanism\n    setShouldUpdate(true);\n  }, [setShouldUpdate]);\n\n  const handleFilterSuccess = useCallback(() => {\n    // This callback is triggered when filters are successfully added\n    // Can be used for additional logic if needed\n  }, []);\n\n  const handleUpdateFilter = useCallback(\n    (name: string, value: string) => {\n      // Use single updateFilter operation instead of remove + add\n      updateFilter(name as PostFilters, value);\n    },\n    [updateFilter]\n  );\n\n  const handleTextSearch = useCallback(\n    (searchText: string) => {\n      // Remove existing search filter first\n      removeFilter('search' as PostFilters);\n\n      // Add new search filter if text is provided\n      if (searchText.trim().length > 0) {\n        addFilter({ name: 'search', value: searchText.trim() });\n      }\n    },\n    [addFilter, removeFilter]\n  );\n\n  return {\n    handleAddFilter,\n    handleAddFilters,\n    handleTagClick,\n    handleHashtagClick,\n    handleMentionClick,\n    handleToggleThreadReplies,\n    handleNewPostClick,\n    handleRefresh,\n    handleFilterSuccess,\n    handleUpdateFilter,\n    handleTextSearch\n  };\n}\n",
    "language":"typescript",
    "lines":208,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/hooks/useScrollRestoration.ts":{
    "content":"'use client';\n\nimport { createLogger } from '@/lib/logging';\nimport { usePathname } from 'next/navigation';\nimport { useEffect } from 'react';\nimport { highlightScrollTarget } from '../../../../lib/utils/scroll-highlight';\nimport {\n    generateScrollKey,\n    storeOrUpdateScrollPosition\n} from '../../../../lib/utils/scroll-position';\n\n// Create hook-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'useScrollRestoration',\n    module: 'components/submissions-list/hooks'\n  },\n  enabled: false // Temporarily disable scroll restoration logging\n});\n\nexport interface ScrollRestorationOptions {\n  isLoading: boolean;\n  submissions: any[];\n  pagination: {\n    currentPage: number;\n  };\n  filters: Array<{ name: string; value: any }>;\n  infiniteScrollMode: boolean;\n}\n\nexport function useScrollRestoration({\n  isLoading,\n  submissions,\n  pagination,\n  filters,\n  infiniteScrollMode\n}: ScrollRestorationOptions) {\n  const pathname = usePathname();\n\n  // Handle scroll restoration from thread navigation\n  useEffect(() => {\n    const restoreKey = sessionStorage.getItem('restore-scroll-key');\n    const restorePosition = sessionStorage.getItem('restore-scroll-position');\n\n    if (restoreKey && restorePosition && !isLoading && submissions.length > 0) {\n      try {\n        const position = JSON.parse(restorePosition);\n\n        // Check if we're on the correct page\n        const expectedPage = position.currentPage || 1;\n        const currentPage = pagination.currentPage;\n\n        logger.group('scrollRestoration');\n        logger.debug('Checking scroll restoration from back navigation', {\n          restoreKey,\n          position,\n          expectedPage,\n          currentPage,\n          submissionsCount: submissions.length,\n          isLoading,\n          currentFilters: filters\n        });\n\n        // Only restore scroll if we're on the expected page and have data\n        if (currentPage === expectedPage && submissions.length > 0) {\n          logger.debug('Restoring scroll position from back navigation', {\n            scrollY: position.scrollY\n          });\n\n          // Clean up session storage immediately to prevent re-restoration\n          sessionStorage.removeItem('restore-scroll-key');\n          sessionStorage.removeItem('restore-scroll-position');\n\n          // Wait for virtual scrolling system to be ready and then restore scroll\n          const attemptScrollRestore = (attempts = 0, maxAttempts = 15) => {\n            const submissionsContainer = document.querySelector(\n              '.submissions-list--virtual'\n            ) as HTMLElement;\n\n            if (!submissionsContainer) {\n              if (attempts < maxAttempts) {\n                setTimeout(\n                  () => attemptScrollRestore(attempts + 1, maxAttempts),\n                  150\n                );\n              } else {\n                logger.warn(\n                  'Submissions container not found after max attempts',\n                  {\n                    attempts,\n                    maxAttempts\n                  }\n                );\n              }\n              return;\n            }\n\n            // Check if virtual scrolling has rendered content\n            const hasContent = submissionsContainer.querySelector(\n              '.submissions-list__content'\n            );\n            const hasItems =\n              submissionsContainer.querySelectorAll('.submissions-list__item')\n                .length > 0;\n\n            // Also check for actual submission items with test IDs\n            const submissionItems = submissionsContainer.querySelectorAll(\n              '[data-testid*=\\\"submission-item\\\"]'\n            );\n\n            if (!hasContent || (!hasItems && submissionItems.length === 0)) {\n              if (attempts < maxAttempts) {\n                logger.debug('Waiting for virtual content to render', {\n                  attempt: attempts + 1,\n                  hasContent: !!hasContent,\n                  hasItems,\n                  submissionItemsCount: submissionItems.length\n                });\n                setTimeout(\n                  () => attemptScrollRestore(attempts + 1, maxAttempts),\n                  250\n                );\n              } else {\n                logger.warn('Virtual content not ready after max attempts', {\n                  attempts,\n                  maxAttempts\n                });\n              }\n              return;\n            }\n\n            // Virtual scrolling is ready, now scroll\n            if (position.scrollY && position.scrollY > 0) {\n              // Set scrollTop directly for more reliable scrolling\n              submissionsContainer.scrollTop = position.scrollY;\n\n              // Also try smooth scrolling as a fallback\n              submissionsContainer.scrollTo({\n                top: position.scrollY,\n                behavior: 'smooth'\n              });\n\n              // Apply highlight animation to the element at the scroll position\n              setTimeout(() => {\n                const highlighted = highlightScrollTarget(\n                  submissionsContainer,\n                  position.scrollY,\n                  {\n                    duration: 3500,\n                    offset: 150,\n                    intensity: 'normal',\n                    speed: 'normal',\n                    enablePulse: true,\n                    enableScale: true\n                  }\n                );\n\n                if (highlighted) {\n                  logger.debug('Applied scroll restoration highlight');\n                } else {\n                  logger.warn('Failed to find element to highlight');\n                }\n              }, 200); // Small delay to ensure scroll is complete\n\n              logger.debug('Successfully scrolled submissions container', {\n                targetScrollY: position.scrollY,\n                actualScrollTop: submissionsContainer.scrollTop,\n                attempts: attempts + 1\n              });\n\n              // Clear the stored scroll position for this key to prevent future unwanted restorations\n              const scrollKey = generateScrollKey(window.location.pathname, {\n                page: position.currentPage,\n                filters: position.filters,\n                searchParams: new URLSearchParams(window.location.search)\n              });\n\n              logger.debug(\n                'Clearing stored scroll position to prevent future unwanted restorations',\n                {\n                  scrollKey\n                }\n              );\n\n              // Clear from localStorage after successful restoration\n              try {\n                const stored = localStorage.getItem('app-scroll-positions');\n                if (stored) {\n                  const positions = JSON.parse(stored);\n                  delete positions[scrollKey];\n                  localStorage.setItem(\n                    'app-scroll-positions',\n                    JSON.stringify(positions)\n                  );\n                }\n              } catch (error) {\n                logger.warn('Failed to clear stored scroll position', {\n                  error: error instanceof Error ? error.message : String(error)\n                });\n              }\n            }\n          };\n\n          // Start the scroll restoration process with a longer initial delay\n          setTimeout(() => attemptScrollRestore(), 300);\n        }\n        logger.groupEnd();\n      } catch (error) {\n        logger.warn('Failed to restore scroll position', {\n          error: error instanceof Error ? error.message : String(error)\n        });\n        // Clean up invalid data\n        sessionStorage.removeItem('restore-scroll-key');\n        sessionStorage.removeItem('restore-scroll-position');\n        logger.groupEnd();\n      }\n    } else {\n      logger.group('scrollRestoration');\n      logger.debug('No back navigation detected, skipping scroll restoration', {\n        hasRestoreKey: !!restoreKey,\n        hasRestorePosition: !!restorePosition,\n        isLoading,\n        submissionsLength: submissions.length\n      });\n      logger.groupEnd();\n    }\n  }, [isLoading, submissions.length, pagination.currentPage, filters]);\n\n  // Track scroll position for navigation restoration\n  useEffect(() => {\n    if (\n      typeof window === 'undefined' ||\n      isLoading ||\n      submissions.length === 0\n    ) {\n      return;\n    }\n\n    let scrollTimeout: ReturnType<typeof setTimeout>;\n    let isUserScrolling = false;\n    let hasRestoredScroll = false;\n\n    const handleScroll = () => {\n      // Mark that user is actively scrolling\n      isUserScrolling = true;\n\n      // Debounce scroll updates to avoid excessive localStorage writes\n      clearTimeout(scrollTimeout);\n      scrollTimeout = setTimeout(() => {\n        const submissionsContainer = document.querySelector(\n          '.submissions-list--virtual'\n        ) as HTMLElement;\n\n        if (submissionsContainer) {\n          const scrollY = submissionsContainer.scrollTop;\n\n          // Generate scroll key for current state\n          const scrollKey = generateScrollKey(window.location.pathname, {\n            page: pagination.currentPage,\n            filters: filters.reduce(\n              (acc, filter) => {\n                acc[filter.name] = filter.value;\n                return acc;\n              },\n              {} as Record<string, any>\n            ),\n            searchParams: new URLSearchParams(window.location.search)\n          });\n\n          // If user has manually scrolled after initial load, we should reset stored positions\n          if (isUserScrolling && !hasRestoredScroll) {\n            logger.debug(\n              'User manually scrolled - resetting stored scroll positions to prevent unwanted restoration'\n            );\n\n            // Clear any stored scroll position for this page to prevent future unwanted restorations\n            try {\n              const stored = localStorage.getItem('app-scroll-positions');\n              if (stored) {\n                const positions = JSON.parse(stored);\n                // Clear all positions for this pathname to be thorough\n                Object.keys(positions).forEach((key) => {\n                  if (key.includes(window.location.pathname)) {\n                    delete positions[key];\n                  }\n                });\n                localStorage.setItem(\n                  'app-scroll-positions',\n                  JSON.stringify(positions)\n                );\n              }\n            } catch (error) {\n              logger.warn('Failed to clear stored scroll positions', {\n                error: error instanceof Error ? error.message : String(error)\n              });\n            }\n\n            // Mark that we've handled the user scroll reset\n            hasRestoredScroll = true;\n          }\n\n          // Update stored scroll position for future back navigation\n          storeOrUpdateScrollPosition(\n            scrollKey,\n            {\n              currentPage: pagination.currentPage,\n              filters: filters.reduce(\n                (acc, filter) => {\n                  acc[filter.name] = filter.value;\n                  return acc;\n                },\n                {} as Record<string, any>\n              )\n            },\n            scrollY\n          );\n        }\n\n        // Reset the scrolling flag after a delay\n        setTimeout(() => {\n          isUserScrolling = false;\n        }, 1000);\n      }, 250); // 250ms debounce\n    };\n\n    const submissionsContainer = document.querySelector(\n      '.submissions-list--virtual'\n    ) as HTMLElement;\n\n    if (submissionsContainer) {\n      submissionsContainer.addEventListener('scroll', handleScroll, {\n        passive: true\n      });\n\n      return () => {\n        clearTimeout(scrollTimeout);\n        submissionsContainer.removeEventListener('scroll', handleScroll);\n      };\n    }\n  }, [isLoading, submissions.length, pagination.currentPage, filters]);\n\n  // Scroll restoration effect for traditional pagination\n  useEffect(() => {\n    // Only run on client side\n    if (typeof window === 'undefined') return;\n\n    // Restore scroll position when data loads\n    if (submissions.length > 0 && !isLoading && !infiniteScrollMode) {\n      const scrollKey = generateScrollKey(pathname, {\n        page: pagination.currentPage,\n        filters: filters.reduce(\n          (acc, filter) => {\n            acc[filter.name] = filter.value;\n            return acc;\n          },\n          {} as Record<string, any>\n        ),\n        searchParams: new URLSearchParams(window.location.search)\n      });\n\n      logger.group('scrollRestoration');\n      logger.debug('Attempting scroll restoration', {\n        scrollKey,\n        submissionsLength: submissions.length,\n        isLoading,\n        infiniteScrollMode,\n        pathname,\n        currentPage: pagination.currentPage\n      });\n\n      const attemptScrollRestore = (attempts = 0, maxAttempts = 15) => {\n        try {\n          const storedPosition = localStorage.getItem(scrollKey);\n          \n          // Early exit if no stored position - don't retry\n          if (!storedPosition) {\n            if (attempts === 0) {\n              logger.debug('No stored scroll position found, skipping restoration', {\n                scrollKey,\n                attempts,\n                maxAttempts\n              });\n            }\n            return; // Exit immediately, don't retry\n          }\n\n          logger.debug('Stored scroll position', {\n            storedPosition,\n            attempts,\n            maxAttempts\n          });\n\n          const position = parseInt(storedPosition, 10);\n          if (!isNaN(position) && position > 0) {\n            // Check if we can scroll to this position\n            const maxScroll = Math.max(\n              0,\n              document.documentElement.scrollHeight - window.innerHeight\n            );\n\n            if (position <= maxScroll + 100) {\n              // Allow some tolerance\n              window.scrollTo({\n                top: position,\n                behavior: 'auto' // Instant scroll for restoration\n              });\n\n              logger.debug('Scroll restored successfully', {\n                position,\n                maxScroll,\n                attempts\n              });\n\n              // Clear the stored position after successful restoration\n              try {\n                localStorage.removeItem(scrollKey);\n              } catch (error) {\n                logger.warn('Failed to clear stored scroll position', {\n                  scrollKey,\n                  error:\n                    error instanceof Error ? error.message : String(error)\n                });\n              }\n\n              return; // Success, exit\n            }\n          }\n\n          // If we can't restore yet and haven't exceeded max attempts\n          if (attempts < maxAttempts) {\n            logger.debug('Retrying scroll restoration', {\n              attempts: attempts + 1,\n              maxAttempts\n            });\n            setTimeout(() => attemptScrollRestore(attempts + 1), 100);\n          } else {\n            logger.warn('Max scroll restoration attempts reached', {\n              attempts,\n              maxAttempts,\n              scrollKey\n            });\n          }\n        } catch (error) {\n          logger.warn('Failed to restore scroll position', {\n            scrollKey,\n            attempts,\n            error: error instanceof Error ? error.message : String(error)\n          });\n        }\n      };\n\n      // Start restoration attempt\n      attemptScrollRestore();\n      logger.groupEnd();\n    } else {\n      logger.group('scrollRestoration');\n      logger.debug('Skipping scroll restoration', {\n        submissionsLength: submissions.length,\n        isLoading,\n        infiniteScrollMode\n      });\n      logger.groupEnd();\n    }\n  }, [\n    submissions,\n    isLoading,\n    infiniteScrollMode,\n    pathname,\n    filters,\n    pagination\n  ]);\n\n  // Cleanup scroll positions on unmount\n  useEffect(() => {\n    return () => {\n      try {\n        // Clean up any stored scroll positions when component unmounts\n        const keys = Object.keys(localStorage);\n        const scrollKeys = keys.filter((key) => key.startsWith('scroll-'));\n        scrollKeys.forEach((key) => {\n          try {\n            localStorage.removeItem(key);\n          } catch (error) {\n            logger.debug('Failed to remove scroll key', {\n              key,\n              error: error instanceof Error ? error.message : String(error)\n            });\n          }\n        });\n      } catch (error) {\n        logger.warn('Failed to clear stored scroll positions', {\n          error: error instanceof Error ? error.message : String(error)\n        });\n      }\n    };\n  }, []);\n}\n",
    "language":"typescript",
    "lines":498,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/hooks/useTextSearchInput.ts":{
    "content":"import { useCallback, useEffect, useRef, useState } from 'react';\n\nexport interface UseTextSearchInputProps {\n  initialValue?: string;\n  value?: string;\n  onChange?: (value: string) => void;\n  onSearch: (searchText: string) => void;\n  minLength?: number;\n}\n\nexport const useTextSearchInput = ({\n  initialValue = '',\n  value,\n  onChange,\n  onSearch,\n  minLength = 2\n}: UseTextSearchInputProps) => {\n  const [inputValue, setInputValue] = useState(initialValue);\n  const [searchTerms, setSearchTerms] = useState<string[]>([]);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // Handle controlled vs uncontrolled mode\n  const currentValue = value !== undefined ? value : inputValue;\n  \n  const handleValueChange = useCallback(\n    (newValue: string) => {\n      if (onChange) {\n        onChange(newValue);\n      } else {\n        setInputValue(newValue);\n      }\n    },\n    [onChange]\n  );\n\n  // Sync initial value changes\n  useEffect(() => {\n    if (value === undefined && initialValue !== inputValue) {\n      setInputValue(initialValue);\n    }\n  }, [initialValue, inputValue, value]);\n\n  // Parse search terms from input with quote support\n  const parseSearchTerms = useCallback(\n    (text: string): string[] => {\n      const trimmedText = text.trim();\n      if (!trimmedText) return [];\n\n      const terms: string[] = [];\n      const regex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n      let match;\n\n      while ((match = regex.exec(trimmedText)) !== null) {\n        const quotedTerm = match[1];\n        const unquotedTerm = match[2];\n        const term = quotedTerm || unquotedTerm;\n        \n        if (term && term.length >= minLength) {\n          terms.push(term.toLowerCase());\n        }\n      }\n\n      return terms;\n    },\n    [minLength]\n  );\n\n  // Handle input change (for regular input mode)\n  const handleInputChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const newValue = e.target.value;\n      handleValueChange(newValue);\n\n      if (newValue.trim().length === 0) {\n        setSearchTerms([]);\n        onSearch('');\n        return;\n      }\n\n      const terms = parseSearchTerms(newValue);\n      setSearchTerms(terms);\n      onSearch(newValue);\n    },\n    [handleValueChange, parseSearchTerms, onSearch]\n  );\n\n  // Handle smart input change (from SmartPillInput)\n  const handleSmartInputChange = useCallback(\n    (newValue: string) => {\n      handleValueChange(newValue);\n\n      // Extract text-only content for search (remove pills)\n      const textOnly = newValue\n        .replace(/@\\\\[[^\\\\]]+\\\\]/g, '') // Remove structured mentions @[user|id|type]\n        .replace(/#\\\\w+/g, '') // Remove hashtags\n        .trim();\n\n      if (textOnly.length === 0) {\n        setSearchTerms([]);\n        onSearch('');\n        return;\n      }\n\n      const terms = parseSearchTerms(textOnly);\n      setSearchTerms(terms);\n      onSearch(textOnly);\n    },\n    [handleValueChange, parseSearchTerms, onSearch]\n  );\n\n  // Handle clear button\n  const handleClear = useCallback(() => {\n    handleValueChange('');\n    setSearchTerms([]);\n    onSearch('');\n    inputRef.current?.focus();\n  }, [handleValueChange, onSearch]);\n\n  // Handle keyboard shortcuts\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Escape') {\n        handleClear();\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n      }\n    },\n    [handleClear]\n  );\n\n  return {\n    currentValue,\n    searchTerms,\n    inputRef,\n    hasValue: currentValue.length > 0,\n    hasValidSearch: searchTerms.length > 0,\n    handleInputChange,\n    handleSmartInputChange,\n    handleClear,\n    handleKeyDown\n  };\n}; ",
    "language":"typescript",
    "lines":142,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/components/hooks/useFilterStatus.ts":{
    "content":"import { useMemo } from 'react';\n\nexport interface FilterCounts {\n  tags: number;\n  authors: number;\n  mentions: number;\n  search: number;\n}\n\nexport interface UseFilterStatusProps {\n  filterCounts?: FilterCounts;\n  totalActiveFilters?: number;\n  hasValidSearch: boolean;\n  searchTerms: string[];\n}\n\nexport const useFilterStatus = ({\n  filterCounts,\n  totalActiveFilters,\n  hasValidSearch,\n  searchTerms\n}: UseFilterStatusProps) => {\n  const shouldShowStatus = useMemo(() => {\n    return hasValidSearch || (filterCounts && totalActiveFilters && totalActiveFilters > 0);\n  }, [hasValidSearch, filterCounts, totalActiveFilters]);\n\n  const searchStatusText = useMemo(() => {\n    if (!hasValidSearch) return null;\n    \n    return `Searching for ${searchTerms.length} term${searchTerms.length !== 1 ? 's' : ''}`;\n  }, [hasValidSearch, searchTerms]);\n\n  const filterStatusText = useMemo(() => {\n    if (!filterCounts || !totalActiveFilters || totalActiveFilters <= 0) {\n      return null;\n    }\n\n    const filterStrings = [\n      filterCounts.tags > 0 &&\n        `${filterCounts.tags} tag${filterCounts.tags !== 1 ? 's' : ''}`,\n      filterCounts.authors > 0 &&\n        `${filterCounts.authors} author${filterCounts.authors !== 1 ? 's' : ''}`,\n      filterCounts.mentions > 0 &&\n        `${filterCounts.mentions} mention${filterCounts.mentions !== 1 ? 's' : ''}`\n    ].filter(Boolean);\n\n    return filterStrings.length > 0 ? `Filtering by ${filterStrings.join(', ')}` : null;\n  }, [filterCounts, totalActiveFilters]);\n\n  const statusText = useMemo(() => {\n    const parts = [searchStatusText, filterStatusText].filter(Boolean);\n    return parts.length > 0 ? parts.join(' \u2022 ') : null;\n  }, [searchStatusText, filterStatusText]);\n\n  return {\n    shouldShowStatus,\n    statusText\n  };\n}; ",
    "language":"typescript",
    "lines":59,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/MachineFingerprint.ts":{
    "content":"// Note: This service should only be used in server-side API routes, not middleware\nimport { createHash } from 'crypto';\nimport { NextRequest } from 'next/server';\n\nexport interface MachineFingerprint {\n  fingerprintId: string;\n  ipAddress: string;\n  userAgent: string;\n  acceptLanguage: string;\n  acceptEncoding: string;\n  platform: string;\n  timezone: string;\n  screenResolution: string;\n}\n\nexport interface FingerprintComponents {\n  ipHash: string;\n  userAgentCore: string;\n  browserFamily: string;\n  osFamily: string;\n  languageGroup: string;\n  timezoneGroup: string;\n  networkClass: string;\n}\n\nexport class MachineFingerprintService {\n  /**\n   * Generate multiple fingerprint components for fuzzy matching\n   * This creates overlapping identifiers that are harder to bypass\n   */\n  static generateFingerprint(request: NextRequest, clientData?: {\n    timezone?: string;\n    screenResolution?: string;\n    platform?: string;\n  }): MachineFingerprint & { components: FingerprintComponents } {\n    const ipAddress = this.getClientIP(request);\n    const userAgent = request.headers.get('user-agent') || 'unknown';\n    const acceptLanguage = request.headers.get('accept-language') || 'unknown';\n    const acceptEncoding = request.headers.get('accept-encoding') || 'unknown';\n    \n    // Use client-provided data or fallback to header data\n    const platform = clientData?.platform || this.extractPlatformFromUserAgent(userAgent);\n    const timezone = clientData?.timezone || 'unknown';\n    const screenResolution = clientData?.screenResolution || 'unknown';\n\n    // Generate fuzzy matching components\n    const components = this.generateFingerprintComponents(\n      ipAddress, userAgent, acceptLanguage, timezone, platform\n    );\n\n    // Create main fingerprint hash from stable components\n    const fingerprintData = [\n      components.ipHash,\n      components.userAgentCore,\n      components.browserFamily,\n      components.osFamily,\n      components.languageGroup,\n      components.timezoneGroup\n    ].join('|');\n\n    const fingerprintId = createHash('sha256')\n      .update(fingerprintData)\n      .digest('hex')\n      .substring(0, 16); // Use first 16 chars for readability\n\n    return {\n      fingerprintId,\n      ipAddress,\n      userAgent,\n      acceptLanguage,\n      acceptEncoding,\n      platform,\n      timezone,\n      screenResolution,\n      components\n    };\n  }\n\n  /**\n   * Generate fuzzy fingerprint components for overlapping detection\n   */\n  private static generateFingerprintComponents(\n    ipAddress: string,\n    userAgent: string,\n    acceptLanguage: string,\n    timezone: string,\n    platform: string\n  ): FingerprintComponents {\n    // IP-based hash (handles dynamic IPs within same ISP/location)\n    const ipParts = ipAddress.split('.');\n    const ipNetwork = ipParts.length >= 3 ? `${ipParts[0]}.${ipParts[1]}.${ipParts[2]}` : ipAddress;\n    const ipHash = createHash('md5').update(ipNetwork).digest('hex').substring(0, 8);\n\n    // User agent core (stable across minor version updates)\n    const userAgentCore = this.extractUserAgentCore(userAgent);\n    \n    // Browser family (Chrome, Firefox, Safari, etc.)\n    const browserFamily = this.extractBrowserFamily(userAgent);\n    \n    // OS family (Windows, macOS, Linux, etc.)\n    const osFamily = this.extractOSFamily(userAgent, platform);\n    \n    // Language group (en, es, fr, etc. - ignore region variants)\n    const languageGroup = acceptLanguage.split(',')[0]?.split('-')[0] || 'unknown';\n    \n    // Timezone group (group by UTC offset ranges)\n    const timezoneGroup = this.getTimezoneGroup(timezone);\n    \n    // Network class (based on IP range patterns)\n    const networkClass = this.getNetworkClass(ipAddress);\n\n    return {\n      ipHash,\n      userAgentCore,\n      browserFamily,\n      osFamily,\n      languageGroup,\n      timezoneGroup,\n      networkClass\n    };\n  }\n\n  /**\n   * Check if two fingerprints are likely from the same machine using fuzzy matching\n   */\n  static calculateSimilarity(fp1: FingerprintComponents, fp2: FingerprintComponents): number {\n    let score = 0;\n    let maxScore = 0;\n\n    // IP network similarity (high weight)\n    maxScore += 30;\n    if (fp1.ipHash === fp2.ipHash) score += 30;\n    \n    // User agent core similarity (high weight)\n    maxScore += 25;\n    if (fp1.userAgentCore === fp2.userAgentCore) score += 25;\n    \n    // Browser family (medium weight)\n    maxScore += 15;\n    if (fp1.browserFamily === fp2.browserFamily) score += 15;\n    \n    // OS family (medium weight)\n    maxScore += 15;\n    if (fp1.osFamily === fp2.osFamily) score += 15;\n    \n    // Language group (low weight)\n    maxScore += 8;\n    if (fp1.languageGroup === fp2.languageGroup) score += 8;\n    \n    // Timezone group (low weight)\n    maxScore += 4;\n    if (fp1.timezoneGroup === fp2.timezoneGroup) score += 4;\n    \n    // Network class (low weight)\n    maxScore += 3;\n    if (fp1.networkClass === fp2.networkClass) score += 3;\n\n    return (score / maxScore) * 100;\n  }\n\n  /**\n   * Get client IP address from request headers\n   */\n  private static getClientIP(request: NextRequest): string {\n    return (\n      request.headers.get('x-forwarded-for') ||\n      request.headers.get('x-real-ip') ||\n      request.headers.get('cf-connecting-ip') ||\n      'unknown'\n    );\n  }\n\n  /**\n   * Extract platform information from user agent\n   */\n  private static extractPlatformFromUserAgent(userAgent: string): string {\n    const ua = userAgent.toLowerCase();\n    \n    if (ua.includes('windows')) return 'windows';\n    if (ua.includes('macintosh') || ua.includes('mac os')) return 'macos';\n    if (ua.includes('linux')) return 'linux';\n    if (ua.includes('android')) return 'android';\n    if (ua.includes('iphone') || ua.includes('ipad')) return 'ios';\n    \n    return 'unknown';\n  }\n\n  /**\n   * Extract stable user agent core (remove version numbers that change frequently)\n   */\n  private static extractUserAgentCore(userAgent: string): string {\n    return userAgent\n      .replace(/\\\\d+\\\\.\\\\d+(\\\\.\\\\d+)?/g, 'X.X') // Replace version numbers\n      .replace(/\\\\s+/g, ' ') // Normalize spaces\n      .substring(0, 100); // Limit length\n  }\n\n  /**\n   * Extract browser family from user agent\n   */\n  private static extractBrowserFamily(userAgent: string): string {\n    const ua = userAgent.toLowerCase();\n    \n    if (ua.includes('chrome') && !ua.includes('edge')) return 'chrome';\n    if (ua.includes('firefox')) return 'firefox';\n    if (ua.includes('safari') && !ua.includes('chrome')) return 'safari';\n    if (ua.includes('edge')) return 'edge';\n    if (ua.includes('opera')) return 'opera';\n    \n    return 'unknown';\n  }\n\n  /**\n   * Extract OS family from user agent and platform\n   */\n  private static extractOSFamily(userAgent: string, platform: string): string {\n    const ua = userAgent.toLowerCase();\n    const p = platform.toLowerCase();\n    \n    if (ua.includes('windows') || p.includes('windows')) return 'windows';\n    if (ua.includes('mac') || p.includes('macos')) return 'macos';\n    if (ua.includes('linux') || p.includes('linux')) return 'linux';\n    if (ua.includes('android') || p.includes('android')) return 'android';\n    if (ua.includes('ios') || p.includes('ios')) return 'ios';\n    \n    return 'unknown';\n  }\n\n  /**\n   * Group timezones by UTC offset ranges\n   */\n  private static getTimezoneGroup(timezone: string): string {\n    if (timezone === 'unknown') return 'unknown';\n    \n    // Extract UTC offset if present\n    const offsetMatch = timezone.match(/UTC([+-]\\\\d+)/);\n    if (offsetMatch) {\n      const offset = parseInt(offsetMatch[1]);\n      if (offset >= -12 && offset <= -8) return 'americas-west';\n      if (offset >= -7 && offset <= -4) return 'americas-east';\n      if (offset >= -3 && offset <= 2) return 'europe-africa';\n      if (offset >= 3 && offset <= 8) return 'asia-west';\n      if (offset >= 9 && offset <= 12) return 'asia-east';\n    }\n    \n    return 'unknown';\n  }\n\n  /**\n   * Classify network type based on IP patterns\n   */\n  private static getNetworkClass(ipAddress: string): string {\n    if (ipAddress === 'unknown') return 'unknown';\n    \n    const parts = ipAddress.split('.');\n    if (parts.length !== 4) return 'unknown';\n    \n    const first = parseInt(parts[0]);\n    const second = parseInt(parts[1]);\n    \n    // Private networks\n    if (first === 192 && second === 168) return 'private-192';\n    if (first === 10) return 'private-10';\n    if (first === 172 && second >= 16 && second <= 31) return 'private-172';\n    \n    // Common ISP ranges (simplified)\n    if (first >= 1 && first <= 126) return 'class-a';\n    if (first >= 128 && first <= 191) return 'class-b';\n    if (first >= 192 && first <= 223) return 'class-c';\n    \n    return 'unknown';\n  }\n\n  /**\n   * Validate that a fingerprint is reasonable (not obviously spoofed)\n   */\n  static validateFingerprint(fingerprint: MachineFingerprint): boolean {\n    // Basic validation - ensure critical fields are present\n    if (!fingerprint.ipAddress || fingerprint.ipAddress === 'unknown') return false;\n    if (!fingerprint.userAgent || fingerprint.userAgent === 'unknown') return false;\n    if (!fingerprint.fingerprintId || fingerprint.fingerprintId.length < 8) return false;\n    \n    return true;\n  }\n} ",
    "language":"typescript",
    "lines":285,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/DatabaseService.ts":{
    "content":"import sql from '../../../../lib/db';\nimport { GenerationMetadata, StoredGeneration } from '../types';\n\nexport interface OGGenerationRecord {\n  id: string;\n  seed: string;\n  aspect_ratio: string;\n  quote_text?: string;\n  quote_author?: string;\n  custom_width?: number;\n  custom_height?: number;\n  shape_count?: number;\n  client_ip?: string;\n  user_agent?: string;\n  svg_content?: string;\n  width?: number;\n  height?: number;\n  created_at: Date;\n}\n\nexport interface CreateOGGenerationParams {\n  seed: string;\n  aspectRatio: string;\n  quoteText?: string;\n  quoteAuthor?: string;\n  customWidth?: number;\n  customHeight?: number;\n  shapeCount?: number;\n  ipAddress: string;\n  userAgent: string;\n  svgContent: string;\n  width: number;\n  height: number;\n  generationOptions?: any; // Full generation config object\n  machineFingerprint?: string;\n  fingerprintData?: any; // Full fingerprint data\n}\n\ninterface OGGeneration {\n  id: string;\n  seed: string;\n  aspect_ratio: string;\n  quote_text: string | null;\n  quote_author: string | null;\n  custom_width: number | null;\n  custom_height: number | null;\n  shape_count: number | null;\n  client_ip: string;\n  user_agent: string;\n  svg_content: string;\n  width: number;\n  height: number;\n  generation_options: any;\n  created_at: Date;\n  updated_at: Date;\n}\n\nexport class DatabaseService {\n  private static instance: DatabaseService;\n\n  // Use singleton pattern with shared database connection\n  public static getInstance(): DatabaseService {\n    if (!DatabaseService.instance) {\n      DatabaseService.instance = new DatabaseService();\n    }\n    return DatabaseService.instance;\n  }\n\n  private constructor() {\n    // Private constructor for singleton pattern\n  }\n\n  private isDatabaseAvailable(): boolean {\n    // Never connect to database during build time\n    if (process.env.NODE_ENV === 'production' && process.env.NEXT_PHASE === 'phase-production-build') {\n      return false;\n    }\n\n    // Skip database in development if specified\n    if (process.env.SKIP_DATABASE === 'true') {\n      return false;\n    }\n\n    // Check if required environment variables are present\n    return !!(\n      process.env.POSTGRES_HOST &&\n      process.env.POSTGRES_USER &&\n      process.env.POSTGRES_DB &&\n      process.env.POSTGRES_PASSWORD\n    );\n  }\n\n  // New OG Generation tracking methods\n  public async recordGeneration(params: CreateOGGenerationParams): Promise<string> {\n    if (!this.isDatabaseAvailable()) {\n      throw new Error('Database not available');\n    }\n\n    try {\n      const result = await sql<OGGeneration[]>`\n        INSERT INTO og_generations (\n          seed, aspect_ratio, quote_text, quote_author, custom_width, custom_height, \n          shape_count, client_ip, user_agent, svg_content, width, height, generation_options\n        ) VALUES (\n          ${params.seed}, ${params.aspectRatio}, ${params.quoteText || null}, \n          ${params.quoteAuthor || null}, ${params.customWidth || null}, \n          ${params.customHeight || null}, ${params.shapeCount || null}, \n          ${params.ipAddress}, ${params.userAgent}, ${params.svgContent}, \n          ${params.width}, ${params.height}, ${JSON.stringify(params.generationOptions || {})}\n        )\n        RETURNING id\n              `;\n\n        return result[0]?.id || '';\n    } catch (error) {\n      console.error('Failed to record generation:', error);\n      throw error;\n    }\n  }\n\n  public async getOGGenerationById(id: string): Promise<OGGenerationRecord | null> {\n    if (!this.isDatabaseAvailable()) {\n      return null;\n    }\n\n    try {\n      const result = await sql<OGGeneration[]>`\n        SELECT * FROM og_generations WHERE id = ${id}\n      `;\n      return (result[0] as OGGenerationRecord) || null;\n    } catch (error) {\n      console.error('Failed to get generation by ID:', error);\n      return null;\n    }\n  }\n\n  public async getOGGenerationsBySeed(seed: string, limit: number = 10): Promise<OGGenerationRecord[]> {\n    if (!this.isDatabaseAvailable()) {\n      return [];\n    }\n\n    try {\n      const result = await sql<OGGeneration[]>`\n        SELECT * FROM og_generations \n        WHERE seed = ${seed}\n        ORDER BY created_at DESC \n        LIMIT ${limit}\n      `;\n      return result as unknown as OGGenerationRecord[];\n    } catch (error) {\n      console.error('Failed to get generations by seed:', error);\n      return [];\n    }\n  }\n\n  public async getDailyGenerationCount(ipAddress: string, machineFingerprint?: string): Promise<number> {\n    if (!this.isDatabaseAvailable()) {\n      return 0; // If database not available, allow generations\n    }\n\n    try {\n      // If we have a machine fingerprint, use fuzzy matching\n      if (machineFingerprint) {\n        const result = await sql<{ count: string }[]>`\n          SELECT COUNT(*) as count \n          FROM og_generations \n          WHERE (\n            client_ip = ${ipAddress} \n            OR machine_fingerprint = ${machineFingerprint}\n            OR fingerprint_data->>'ipHash' = (\n              SELECT fingerprint_data->>'ipHash' \n              FROM og_generations \n              WHERE machine_fingerprint = ${machineFingerprint} \n              LIMIT 1\n            )\n          )\n          AND created_at >= CURRENT_DATE\n        `;\n        return parseInt(result[0]?.count || '0', 10);\n      }\n      \n      // Fallback to IP-only checking\n      const result = await sql<{ count: string }[]>`\n        SELECT COUNT(*) as count \n        FROM og_generations \n        WHERE client_ip = ${ipAddress} \n        AND created_at >= CURRENT_DATE\n      `;\n\n      return parseInt(result[0]?.count || '0', 10);\n    } catch (error) {\n      console.error('Failed to get daily generation count:', error);\n      return 0; // On error, allow generations\n    }\n  }\n\n  public async getOGGenerationStats(): Promise<{\n    total: number;\n    today: number;\n    uniqueSeeds: number;\n    topAspectRatios: Array<{ aspect_ratio: string; count: number }>;\n  } | null> {\n    if (!this.isDatabaseAvailable()) {\n      return null;\n    }\n\n    try {\n      const [totalResult, todayResult, uniqueSeedsResult, topRatiosResult] = await Promise.all([\n        sql`SELECT COUNT(*) as total FROM og_generations`,\n        sql`SELECT COUNT(*) as today FROM og_generations WHERE created_at >= CURRENT_DATE`,\n        sql`SELECT COUNT(DISTINCT seed) as unique_seeds FROM og_generations`,\n        sql`\n          SELECT aspect_ratio, COUNT(*) as count \n          FROM og_generations \n          GROUP BY aspect_ratio \n          ORDER BY count DESC \n          LIMIT 5\n        `\n      ]);\n\n      return {\n        total: parseInt(totalResult[0]?.total || '0'),\n        today: parseInt(todayResult[0]?.today || '0'),\n        uniqueSeeds: parseInt(uniqueSeedsResult[0]?.unique_seeds || '0'),\n        topAspectRatios: topRatiosResult as unknown as Array<{ aspect_ratio: string; count: number }>\n      };\n    } catch (error) {\n      console.error('Failed to get generation stats:', error);\n      return null;\n    }\n  }\n\n  // Legacy stored generation methods (kept for compatibility)\n  async storeGeneration(\n    metadata: GenerationMetadata,\n    svgContent: string\n  ): Promise<string> {\n    if (!this.isDatabaseAvailable()) {\n      throw new Error('Database not configured');\n    }\n\n    try {\n      const result = await sql`\n        INSERT INTO stored_generations (\n          seed, quote_text, quote_author, avatar_seed, \n          client_ip, user_agent, svg_content, metadata\n        ) VALUES (\n          ${metadata.seed},\n          ${metadata.quote?.text || null},\n          ${metadata.quote?.author || null},\n          ${metadata.seed},\n          ${metadata.clientInfo.ip},\n          ${metadata.clientInfo.userAgent},\n          ${svgContent},\n          ${JSON.stringify(metadata)}\n        )\n        RETURNING id\n      `;\n      return result[0].id;\n    } catch (error) {\n      console.error('Failed to store generation:', error);\n      throw error;\n    }\n  }\n\n  async getGeneration(id: string): Promise<{\n    id: string;\n    seed: string;\n    aspectRatio: string;\n    svg: string;\n    dimensions: { width: number; height: number };\n    generationOptions: any;\n    createdAt: Date;\n  } | null> {\n    if (!this.isDatabaseAvailable()) {\n      throw new Error('Database not available');\n    }\n\n    try {\n      const result = await sql<OGGeneration[]>`\n        SELECT * FROM og_generations WHERE id = ${id} LIMIT 1\n      `;\n\n      if (result.length === 0) {\n        return null;\n      }\n\n      const generation = result[0];\n      return {\n        id: generation.id,\n        seed: generation.seed,\n        aspectRatio: generation.aspect_ratio,\n        svg: generation.svg_content,\n        dimensions: {\n          width: generation.width,\n          height: generation.height\n        },\n        generationOptions: generation.generation_options || {},\n        createdAt: generation.created_at\n      };\n    } catch (error) {\n      console.error('Failed to get generation:', error);\n      throw error;\n    }\n  }\n\n  async getRecentGenerations(\n    clientIp: string,\n    limit: number = 10\n  ): Promise<Omit<StoredGeneration, 'svg_content'>[]> {\n    if (!this.isDatabaseAvailable()) {\n      return [];\n    }\n\n    try {\n      const result = await sql`\n        SELECT id, seed, quote_text, quote_author, avatar_seed, \n               client_ip, user_agent, metadata, created_at\n        FROM stored_generations \n        WHERE client_ip = ${clientIp}\n        ORDER BY created_at DESC \n        LIMIT ${limit}\n      `;\n      return result as unknown as Omit<StoredGeneration, 'svg_content'>[];\n    } catch (error) {\n      console.error('Failed to get recent generations:', error);\n      return [];\n    }\n  }\n\n  async countGenerations(\n    clientIp: string,\n    userAgent: string,\n    hoursBack: number\n  ): Promise<number> {\n    if (!this.isDatabaseAvailable()) {\n      return 0;\n    }\n\n    try {\n      const result = await sql`\n        SELECT COUNT(*) as count \n        FROM stored_generations \n        WHERE client_ip = ${clientIp}\n          AND user_agent = ${userAgent}\n          AND created_at > NOW() - INTERVAL '${hoursBack} hours'\n      `;\n      return parseInt(result[0]?.count || '0');\n    } catch (error) {\n      console.error('Failed to count generations:', error);\n      return 0;\n    }\n  }\n\n  async cleanupOldGenerations(daysOld: number = 30): Promise<number> {\n    if (!this.isDatabaseAvailable()) {\n      return 0;\n    }\n\n    try {\n      const result = await sql`\n        DELETE FROM stored_generations \n        WHERE created_at < NOW() - INTERVAL '${daysOld} days'\n      `;\n      return result.count || 0;\n    } catch (error) {\n      console.error('Failed to cleanup old generations:', error);\n      return 0;\n    }\n  }\n\n  storedGenerationToMetadata(stored: StoredGeneration): GenerationMetadata {\n    // Create metadata from stored generation\n    return {\n      id: stored.id,\n      seed: stored.seed,\n      quote: {\n        text: stored.quote_text,\n        author: stored.quote_author\n      },\n      aspectRatio: stored.aspect_ratio,\n      dimensions: {\n        width: stored.width,\n        height: stored.height\n      },\n      shapeCount: stored.shape_count,\n      customDimensions: stored.custom_width || stored.custom_height ? {\n        width: stored.custom_width,\n        height: stored.custom_height\n      } : undefined,\n      generatedAt: stored.created_at,\n      clientInfo: {\n        ip: stored.client_ip,\n        userAgent: stored.user_agent\n      }\n    };\n  }\n} ",
    "language":"typescript",
    "lines":398,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/QuoteService.ts":{
    "content":"import { FALLBACK_QUOTES, QUOTE_APIS } from '../config';\nimport { QuoteData } from '../types';\n\nexport class QuoteService {\n  private weightedPool: number[] = [];\n  private currentPoolIndex = 0;\n\n  constructor() {\n    this.initializeWeightedPool();\n  }\n\n  /**\n   * Initialize weighted pool based on API weights\n   */\n  private initializeWeightedPool(): void {\n    this.weightedPool = [];\n    QUOTE_APIS.forEach((api, index) => {\n      // Add the API index to the pool based on its weight\n      for (let i = 0; i < api.weight; i++) {\n        this.weightedPool.push(index);\n      }\n    });\n    // Shuffle the pool for better distribution\n    for (let i = this.weightedPool.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [this.weightedPool[i], this.weightedPool[j]] = [this.weightedPool[j], this.weightedPool[i]];\n    }\n  }\n\n  /**\n   * Get next API using weighted round-robin\n   */\n  private getNextAPIIndex(): number {\n    if (this.weightedPool.length === 0) {\n      this.initializeWeightedPool();\n    }\n\n    const apiIndex = this.weightedPool[this.currentPoolIndex];\n    this.currentPoolIndex = (this.currentPoolIndex + 1) % this.weightedPool.length;\n\n    // Reinitialize pool when we've gone through all entries\n    if (this.currentPoolIndex === 0) {\n      this.initializeWeightedPool();\n    }\n\n    return apiIndex;\n  }\n\n  /**\n   * Fetch quote using round-robin with fallback\n   */\n  async fetchRandomQuote(): Promise<QuoteData> {\n    const maxRetries = QUOTE_APIS.length; // Try all APIs if needed\n\n    for (let attempt = 0; attempt < maxRetries; attempt++) {\n      const apiIndex = this.getNextAPIIndex();\n      const apiConfig = QUOTE_APIS[apiIndex];\n\n      try {\n        // Create timeout controller\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\n        \n        const response = await fetch(apiConfig.url, {\n          cache: 'no-cache',\n          signal: controller.signal,\n          headers: {\n            'User-Agent': 'Idling.app OG Image Generator',\n            ...(apiConfig.headers || {})\n          }\n        });\n\n        clearTimeout(timeoutId);\n\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        const quote = apiConfig.transform(data);\n\n        // Validate quote data\n        if (!quote.text || !quote.author || quote.text.length < 10) {\n          throw new Error('Invalid quote data received');\n        }\n\n        return quote;\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.warn(`\u26a0\ufe0f Failed to fetch from ${apiConfig.name}:`, error);\n        // Continue to next API\n      }\n    }\n\n    // If all APIs fail, return fallback quotes\n    // eslint-disable-next-line no-console\n    console.log('\u274c All quote APIs failed, using fallback quotes');\n    const randomIndex = Math.floor(Math.random() * FALLBACK_QUOTES.length);\n    return FALLBACK_QUOTES[randomIndex];\n  }\n\n  /**\n   * Get a quote either from custom input or fetch from APIs\n   */\n  async getQuote(customQuote?: string | null, customAuthor?: string | null): Promise<QuoteData> {\n    if (customQuote) {\n      return {\n        text: customQuote,\n        author: customAuthor || 'Idling.app'\n      };\n    }\n\n    return this.fetchRandomQuote();\n  }\n} ",
    "language":"typescript",
    "lines":115,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/SVGGenerator.ts":{
    "content":"import { AspectRatioConfig, AvatarPositioning, QuoteData, TextPositioning } from '../types';\nimport { escapeXml, wrapTextForSVG } from '../utils';\nimport { BasePatternGenerator } from './patterns/BasePatternGenerator';\n\nexport class SVGGenerator {\n  private patternGenerator = new BasePatternGenerator();\n\n  generateSVG(\n    avatarSvg: string,\n    quote: QuoteData,\n    patternSeed: string,\n    config: AspectRatioConfig,\n    aspectRatio: string,\n    avatarPositioning: AvatarPositioning,\n    shapeCount?: number,\n    allCustomOptions?: {\n      // Visual styling (7)\n      fontSize?: number;\n      borderColor?: string;\n      borderOpacity?: number;\n      patternSeed?: string;\n      textPadding?: number;\n      lineHeight?: number;\n      glassBackground?: boolean;\n      \n      // Positioning overrides (5) \n      avatarX?: number;\n      avatarY?: number;\n      avatarSize?: number;\n      textMaxWidth?: number;\n      textStartY?: number;\n    }\n  ): {\n    svg: string;\n    actualValues: {\n      // All actual values used during generation\n      fontSize: number;\n      borderColor: string;\n      borderOpacity: number;\n      patternSeed: string;\n      textPadding: number;\n      lineHeight: number;\n      glassBackground: boolean;\n      avatarX: number;\n      avatarY: number;\n      avatarSize: number;\n      textMaxWidth: number;\n      textStartY: number;\n      shapeCount: number;\n    };\n  } {\n    const { width, height } = config;\n\n    // Use custom positioning overrides if provided\n    const finalAvatarX = allCustomOptions?.avatarX ?? avatarPositioning.x;\n    const finalAvatarY = allCustomOptions?.avatarY ?? avatarPositioning.y;\n    const finalAvatarSize = allCustomOptions?.avatarSize ?? avatarPositioning.size;\n    const finalTextMaxWidth = allCustomOptions?.textMaxWidth ?? config.textMaxWidth;\n    const finalTextStartY = allCustomOptions?.textStartY ?? config.textStartY;\n    const finalShapeCount = shapeCount ?? 8;\n\n    // Generate background patterns and get predominant color for border\n    const backgroundResult = this.patternGenerator.generateBackgroundPattern(\n      patternSeed,\n      width,\n      height,\n      finalShapeCount\n    );\n    const finalBorderColor = allCustomOptions?.borderColor ?? backgroundResult.predominantColor;\n    const finalBorderOpacity = allCustomOptions?.borderOpacity ?? 0.7;\n    const finalGlassBackground = allCustomOptions?.glassBackground ?? true;\n\n    // Calculate text positioning with custom styles\n    const finalFontSize = allCustomOptions?.fontSize;\n    const finalLineHeight = allCustomOptions?.lineHeight;\n    const textPositioning = this.calculateTextPositioning(\n      quote, \n      { ...config, textMaxWidth: finalTextMaxWidth, textStartY: finalTextStartY }, \n      aspectRatio, \n      finalFontSize,\n      finalLineHeight\n    );\n\n    // Calculate glass background for text with custom padding\n    const finalTextPadding = allCustomOptions?.textPadding ?? 30;\n    const glassBackground = this.calculateGlassBackground(\n      textPositioning,\n      width,\n      finalTextMaxWidth,\n      finalTextPadding\n    );\n\n    const svg = this.buildSVG(\n      width,\n      height,\n      finalBorderColor,\n      finalBorderOpacity,\n      backgroundResult.patterns,\n      avatarSvg,\n      { x: finalAvatarX, y: finalAvatarY, size: finalAvatarSize },\n      quote,\n      textPositioning,\n      finalGlassBackground ? glassBackground : null\n    );\n\n    return {\n      svg,\n      actualValues: {\n        fontSize: textPositioning.fontSize,\n        borderColor: finalBorderColor,\n        borderOpacity: finalBorderOpacity,\n        patternSeed: patternSeed,\n        textPadding: finalTextPadding,\n        lineHeight: finalLineHeight ?? 1.4,\n        glassBackground: finalGlassBackground,\n        avatarX: finalAvatarX,\n        avatarY: finalAvatarY,\n        avatarSize: finalAvatarSize,\n        textMaxWidth: finalTextMaxWidth,\n        textStartY: finalTextStartY,\n        shapeCount: finalShapeCount\n      }\n    };\n  }\n\n  getPatternResult(seed: string, width: number, height: number, shapeCount?: number) {\n    return this.patternGenerator.generateBackgroundPattern(seed, width, height, shapeCount);\n  }\n\n  private calculateTextPositioning(\n    quote: QuoteData,\n    config: AspectRatioConfig,\n    aspectRatio: string,\n    customFontSize?: number,\n    customLineHeight?: number\n  ): TextPositioning {\n    const { width, height, textMaxWidth, textStartY } = config;\n\n    // Dynamic font sizing based on aspect ratio and quote length\n    let fontSize = customFontSize || 36;\n    if (!customFontSize) {\n      const aspectRatioFactor = Math.min(width / 1200, height / 630);\n      fontSize = Math.floor(fontSize * aspectRatioFactor);\n\n      if (quote.text.length > 100) fontSize = Math.floor(fontSize * 0.9);\n      else if (quote.text.length > 150) fontSize = Math.floor(fontSize * 0.8);\n      else if (quote.text.length > 200) fontSize = Math.floor(fontSize * 0.7);\n\n      // Ensure minimum readable font size\n      fontSize = Math.max(fontSize, 18);\n    }\n\n    // Wrap text\n    const quoteText = `\\\"${quote.text}\\\" \u2014 ${quote.author}`;\n    const maxCharsPerLine = Math.floor(textMaxWidth / (fontSize * 0.6));\n    const lines = wrapTextForSVG(quoteText, maxCharsPerLine);\n\n    // Calculate text positioning - better logic for narrow formats\n    const lineHeight = (customLineHeight || 1.4) * fontSize;\n    const totalTextHeight = lines.length * lineHeight;\n\n    let adjustedTextStartY;\n    if (height < 500) {\n      // For very narrow formats like LinkedIn/Twitter banners\n      adjustedTextStartY = height * 0.7;\n    } else if (height < 700) {\n      // For medium height formats like YouTube\n      adjustedTextStartY = textStartY + (height - 630) * 0.2;\n    } else {\n      // For other tall formats like 4:3\n      adjustedTextStartY = textStartY + (height - 630) * 0.1;\n    }\n\n    const finalTextStartY = adjustedTextStartY - totalTextHeight / 2;\n\n    return {\n      startY: finalTextStartY,\n      maxWidth: textMaxWidth,\n      fontSize,\n      lines\n    };\n  }\n\n  private calculateGlassBackground(\n    textPositioning: TextPositioning,\n    width: number,\n    textMaxWidth: number,\n    customPadding?: number\n  ): { x: number; y: number; width: number; height: number } {\n    const padding = customPadding || 30;\n    const longestLine = textPositioning.lines.reduce(\n      (max, line) => (line.length > max.length ? line : max),\n      ''\n    );\n    const approxCharWidth = textPositioning.fontSize * 0.45;\n    const textWidth = Math.min(\n      longestLine.length * approxCharWidth + padding * 2,\n      textMaxWidth\n    );\n    const lineHeight = textPositioning.fontSize * 1.4;\n    const totalTextHeight = textPositioning.lines.length * lineHeight;\n    const textHeight = totalTextHeight + padding * 0.8;\n    const glassX = (width - textWidth) / 2;\n    const glassY = textPositioning.startY - 27 - (textHeight - totalTextHeight) / 2;\n\n    return {\n      x: glassX,\n      y: glassY,\n      width: textWidth,\n      height: textHeight\n    };\n  }\n\n  private buildSVG(\n    width: number,\n    height: number,\n    borderColor: string,\n    borderOpacity: number,\n    backgroundPatterns: string,\n    avatarSvg: string,\n    avatarPositioning: AvatarPositioning,\n    quote: QuoteData,\n    textPositioning: TextPositioning,\n    glassBackground: { x: number; y: number; width: number; height: number } | null\n  ): string {\n    const lineHeight = textPositioning.fontSize * 1.4;\n\n    return `<svg width=\\\"${width}\\\" height=\\\"${height}\\\" viewBox=\\\"0 0 ${width} ${height}\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\n  <defs>\n    <!-- Radial gradient mask for avatar fade effect -->\n    <radialGradient id=\\\"avatarFade\\\" cx=\\\"50%\\\" cy=\\\"50%\\\" r=\\\"35%\\\">\n      <stop offset=\\\"0%\\\" style=\\\"stop-color:white;stop-opacity:1\\\" />\n      <stop offset=\\\"60%\\\" style=\\\"stop-color:white;stop-opacity:1\\\" />\n      <stop offset=\\\"75%\\\" style=\\\"stop-color:white;stop-opacity:0.9\\\" />\n      <stop offset=\\\"85%\\\" style=\\\"stop-color:white;stop-opacity:0.6\\\" />\n      <stop offset=\\\"95%\\\" style=\\\"stop-color:white;stop-opacity:0.2\\\" />\n      <stop offset=\\\"100%\\\" style=\\\"stop-color:white;stop-opacity:0\\\" />\n    </radialGradient>\n    \n    <!-- Mask using the radial gradient -->\n    <mask id=\\\"avatarMask\\\">\n      <rect x=\\\"0\\\" y=\\\"0\\\" width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"url(#avatarFade)\\\"/>\n    </mask>\n    \n    <!-- Clipping path for rounded corners -->\n    <clipPath id=\\\"roundedClip\\\">\n      <rect x=\\\"8\\\" y=\\\"8\\\" width=\\\"${width - 16}\\\" height=\\\"${height - 16}\\\" rx=\\\"12\\\" ry=\\\"12\\\"/>\n    </clipPath>\n    \n    <!-- Glass filter for text background -->\n    <filter id=\\\"glassFilter\\\" x=\\\"-50%\\\" y=\\\"-50%\\\" width=\\\"200%\\\" height=\\\"200%\\\">\n      <feGaussianBlur in=\\\"SourceGraphic\\\" stdDeviation=\\\"3\\\"/>\n      <feColorMatrix type=\\\"matrix\\\" values=\\\"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.8 0\\\"/>\n    </filter>\n    \n    <!-- Backdrop blur effect -->\n    <filter id=\\\"backdropBlur\\\" x=\\\"-50%\\\" y=\\\"-50%\\\" width=\\\"200%\\\" height=\\\"200%\\\">\n      <feGaussianBlur in=\\\"SourceGraphic\\\" stdDeviation=\\\"8\\\"/>\n    </filter>\n\n  </defs>\n  \n  <!-- Outer border with procedural color -->\n  <rect width=\\\"${width}\\\" height=\\\"${height}\\\" rx=\\\"20\\\" ry=\\\"20\\\" fill=\\\"${borderColor}\\\" opacity=\\\"${borderOpacity}\\\"/>\n  \n  <!-- Inner background with rounded corners -->\n  <rect x=\\\"8\\\" y=\\\"8\\\" width=\\\"${width - 16}\\\" height=\\\"${height - 16}\\\" rx=\\\"12\\\" ry=\\\"12\\\" fill=\\\"#0a0a0a\\\"/>\n  \n  <!-- Dynamic Pattern Background with clipping -->\n  <g clip-path=\\\"url(#roundedClip)\\\">\n    ${backgroundPatterns}\n  </g>\n  \n  <!-- Avatar with fade effect -->\n  <g mask=\\\"url(#avatarMask)\\\">\n    <image href=\\\"data:image/svg+xml;base64,${Buffer.from(avatarSvg).toString('base64')}\\\" \n           x=\\\"${avatarPositioning.x}\\\" y=\\\"${avatarPositioning.y}\\\" width=\\\"${avatarPositioning.size}\\\" height=\\\"${avatarPositioning.size}\\\"/>\n  </g>\n  \n  <!-- Glass background for text -->\n  ${glassBackground ? `<rect x=\\\"${glassBackground.x}\\\" y=\\\"${glassBackground.y}\\\" width=\\\"${glassBackground.width}\\\" height=\\\"${glassBackground.height}\\\" \n        rx=\\\"16\\\" ry=\\\"16\\\" \n        fill=\\\"rgba(0, 0, 0, 0.6)\\\" \n        stroke=\\\"rgba(255, 255, 255, 0.1)\\\" \n        stroke-width=\\\"1\\\"\n        filter=\\\"url(#glassFilter)\\\"/>` : ''}\n  \n  <!-- Text -->\n  ${textPositioning.lines\n    .map(\n      (line, index) =>\n        `<text x=\\\"${width / 2}\\\" y=\\\"${textPositioning.startY + index * lineHeight}\\\" \n           text-anchor=\\\"middle\\\" \n           fill=\\\"white\\\" \n           font-family=\\\"system-ui, -apple-system, sans-serif\\\" \n           font-size=\\\"${textPositioning.fontSize}px\\\"\n           style=\\\"font-size: ${textPositioning.fontSize}px !important; text-shadow: 0 2px 4px rgba(0,0,0,0.8);\\\">${escapeXml(line)}</text>`\n    )\n    .join('\\\\n  ')}\n</svg>`;\n  }\n} ",
    "language":"typescript",
    "lines":302,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/OGImageService.ts":{
    "content":"import {\n  checkGuestQuota,\n  recordGuestUsage\n} from '@/lib/actions/quota.actions';\nimport { auth } from '@/lib/auth';\nimport { EnhancedQuotaService } from '@/lib/services/EnhancedQuotaService';\nimport { NextRequest } from 'next/server';\nimport { formatRetryAfter } from '../../../../lib/utils/timeFormatting';\nimport { ASPECT_RATIOS } from '../config';\nimport { AvatarService } from './AvatarService';\nimport { DatabaseService } from './DatabaseService';\nimport { QuoteService } from './QuoteService';\nimport { SVGGenerator } from './SVGGenerator';\n\n// Server actions handle all quota operations\n\ninterface GenerationConfig {\n  // Direct user controls (8)\n  seed: string;\n  avatarSeed: string;\n  quote?: string;\n  author?: string;\n  aspectRatio: string;\n  customWidth?: number;\n  customHeight?: number;\n  shapeCount?: number;\n\n  // Positioning controls (5)\n  avatarX?: number;\n  avatarY?: number;\n  avatarSize?: number;\n  textMaxWidth?: number;\n  textStartY?: number;\n\n  // Visual controls (7)\n  fontSize?: number;\n  borderColor?: string;\n  borderOpacity?: number;\n  patternSeed?: string;\n  textPadding?: number;\n  lineHeight?: number;\n  glassBackground?: boolean;\n}\n\ninterface GenerationResponse {\n  svg: string;\n  seed: string;\n  dimensions: { width: number; height: number };\n  aspectRatio: string;\n  generationOptions: GenerationConfig;\n  remainingGenerations: number;\n  quotaLimit?: number;\n  resetDate?: Date | null;\n  generationId?: string;\n  id?: string;\n}\n\nexport class OGImageService {\n  private quoteService = new QuoteService();\n  private avatarService = new AvatarService();\n  private svgGenerator = new SVGGenerator();\n  private databaseService = DatabaseService.getInstance();\n\n  constructor() {\n    // Initialize services\n  }\n\n  async generateImage(request: NextRequest): Promise<GenerationResponse> {\n    const { searchParams } = new URL(request.url);\n    const isDryRun = searchParams.get('dry-run') === 'true';\n    \n    // Get client IP and machine fingerprint for enhanced quota tracking\n    const clientIP = this.getClientIP(request);\n    const userAgent = request.headers.get('user-agent') || '';\n    const machineFingerprint = this.generateMachineFingerprint(request);\n    \n    // Check if user is authenticated\n    const session = await auth();\n    const userId = session?.user?.id;\n    \n    let quotaCheck: any;\n    \n    if (userId) {\n      // Authenticated user - use EnhancedQuotaService\n      quotaCheck = await EnhancedQuotaService.checkUserQuota(\n        parseInt(userId), \n        'og_generator', \n        'daily_generations'\n      );\n    } else {\n      // Anonymous guest - use global guest quota system\n      quotaCheck = await checkGuestQuota(\n        { \n          client_ip: clientIP, \n          machine_fingerprint: machineFingerprint,\n          user_agent_hash: this.hashUserAgent(userAgent)\n        },\n        'og_generator',\n        'daily_generations'\n      );\n    }\n    \n    // Check quota limits\n    if (!isDryRun && !quotaCheck.allowed) {\n      const resetTime = quotaCheck.reset_date || new Date(Date.now() + 86400000);\n      const retryAfterSeconds = Math.ceil((resetTime.getTime() - Date.now()) / 1000);\n      const humanTime = formatRetryAfter(retryAfterSeconds);\n      \n      const quotaMessage = quotaCheck.is_unlimited \n        ? 'Unlimited generations available'\n        : `${quotaCheck.current_usage}/${quotaCheck.quota_limit} generations used (${quotaCheck.quota_source})`;\n      \n      throw new Error(`Daily generation limit exceeded. ${quotaMessage}. Try again in ${humanTime} or upgrade to Pro for unlimited generations.`);\n    }\n\n    // If dry run, just return quota info\n    if (isDryRun) {\n      return {\n        svg: '',\n        seed: '',\n        dimensions: { width: 0, height: 0 },\n        aspectRatio: 'default',\n        generationOptions: this.buildGenerationConfig(searchParams),\n        remainingGenerations: quotaCheck.remaining === -1 ? 999999 : quotaCheck.remaining,\n        quotaLimit: quotaCheck.quota_limit === -1 ? 999999 : quotaCheck.quota_limit,\n        resetDate: quotaCheck.reset_date,\n        generationId: '',\n        id: ''\n      };\n    }\n\n    // Build complete generation config\n    const config = this.buildGenerationConfig(searchParams);\n    \n    // Generate the image with actual values\n    const result = await this.callGenerationAPI(config);\n\n    // Record usage in the appropriate quota system and get updated quota info\n    let updatedQuotaCheck: any;\n    if (userId) {\n      // Record for authenticated user using EnhancedQuotaService\n      const usageRecord = await EnhancedQuotaService.recordUserUsage(\n        parseInt(userId),\n        'og_generator',\n        'daily_generations',\n        1,\n        {\n          ip_address: clientIP,\n          user_agent: userAgent,\n          machine_fingerprint: machineFingerprint,\n          generation_config: config\n        }\n      );\n      // Get updated quota info after recording usage\n      updatedQuotaCheck = await EnhancedQuotaService.checkUserQuota(\n        parseInt(userId), \n        'og_generator', \n        'daily_generations'\n      );\n    } else {\n      // Record for guest user\n      const usageRecord = await recordGuestUsage(\n        {\n          client_ip: clientIP,\n          machine_fingerprint: machineFingerprint,\n          user_agent_hash: this.hashUserAgent(userAgent)\n        },\n        'og_generator',\n        'daily_generations',\n        1,\n        {\n          generation_config: config,\n          user_agent: userAgent\n        }\n      );\n      // Get updated quota info after recording usage\n      updatedQuotaCheck = await checkGuestQuota(\n        { \n          client_ip: clientIP, \n          machine_fingerprint: machineFingerprint,\n          user_agent_hash: this.hashUserAgent(userAgent)\n        },\n        'og_generator',\n        'daily_generations'\n      );\n    }\n\n    // Record generation in database (for historical tracking)\n    let generationId: string | undefined;\n    try {\n      generationId = await this.databaseService.recordGeneration({\n        seed: result.actualSeed,\n        aspectRatio: config.aspectRatio,\n        quoteText: result.actualQuote?.text || undefined,\n        quoteAuthor: result.actualQuote?.author || undefined,\n        customWidth: config.customWidth,\n        customHeight: config.customHeight,\n        shapeCount: config.shapeCount,\n        ipAddress: clientIP,\n        userAgent: request.headers.get('user-agent') || '',\n        svgContent: result.svg,\n        width: result.dimensions.width,\n        height: result.dimensions.height,\n        generationOptions: config\n      });\n    } catch (error) {\n      // Database recording failed, continue without ID\n      console.error('Failed to record generation:', error);\n    }\n\n    // Build the actual generation options with ALL the values that were used\n    const actualGenerationOptions: GenerationConfig = {\n      // Direct user controls (8) - actual values used\n      seed: result.actualSeed,\n      avatarSeed: result.actualAvatarSeed,\n      quote: result.actualQuote?.text || undefined,\n      author: result.actualQuote?.author || undefined,\n      aspectRatio: config.aspectRatio,\n      customWidth: result.dimensions.width,\n      customHeight: result.dimensions.height,\n      shapeCount: result.actualShapeCount,\n      \n      // Positioning controls (5) - actual values used\n      avatarX: result.actualAvatarPositioning?.x,\n      avatarY: result.actualAvatarPositioning?.y,\n      avatarSize: result.actualAvatarPositioning?.size,\n      textMaxWidth: result.actualTextMaxWidth,\n      textStartY: result.actualTextStartY,\n      \n      // Visual controls (7) - actual values used\n      fontSize: result.actualFontSize,\n      borderColor: result.actualBorderColor,\n      borderOpacity: result.actualBorderOpacity,\n      patternSeed: result.actualPatternSeed,\n      textPadding: result.actualTextPadding,\n      lineHeight: result.actualLineHeight,\n      glassBackground: result.actualGlassBackground || false\n    };\n\n    return {\n      ...result,\n      generationOptions: actualGenerationOptions,\n      remainingGenerations: updatedQuotaCheck.remaining === -1 ? 999999 : updatedQuotaCheck.remaining,\n      quotaLimit: updatedQuotaCheck.quota_limit === -1 ? 999999 : updatedQuotaCheck.quota_limit,\n      resetDate: updatedQuotaCheck.reset_date,\n      generationId: generationId || undefined,\n      id: generationId || undefined // For compatibility\n    };\n  }\n\n  private buildGenerationConfig(searchParams: URLSearchParams): GenerationConfig {\n    // Extract all parameters from URL\n    const customSeed = searchParams.get('seed');\n    const avatarSeed = searchParams.get('avatarSeed');\n    const customQuote = searchParams.get('quote');\n    const customAuthor = searchParams.get('author');\n    const aspectRatio = searchParams.get('ratio') || searchParams.get('aspect') || 'default';\n    \n    const customWidth = searchParams.get('width') ? parseInt(searchParams.get('width')!) : undefined;\n    const customHeight = searchParams.get('height') ? parseInt(searchParams.get('height')!) : undefined;\n    const shapeCount = searchParams.get('shapes') ? parseInt(searchParams.get('shapes')!) : undefined;\n    \n    // Advanced positioning controls\n    const avatarX = searchParams.get('avatarX') ? parseFloat(searchParams.get('avatarX')!) : undefined;\n    const avatarY = searchParams.get('avatarY') ? parseFloat(searchParams.get('avatarY')!) : undefined;\n    const avatarSize = searchParams.get('avatarSize') ? parseFloat(searchParams.get('avatarSize')!) : undefined;\n    const textMaxWidth = searchParams.get('textMaxWidth') ? parseFloat(searchParams.get('textMaxWidth')!) : undefined;\n    const textStartY = searchParams.get('textStartY') ? parseFloat(searchParams.get('textStartY')!) : undefined;\n    const fontSize = searchParams.get('fontSize') ? parseFloat(searchParams.get('fontSize')!) : undefined;\n    \n    // Visual styling controls\n    const borderColor = searchParams.get('borderColor') || undefined;\n    const borderOpacity = searchParams.get('borderOpacity') ? parseFloat(searchParams.get('borderOpacity')!) : undefined;\n    const patternSeed = searchParams.get('patternSeed') || undefined;\n    const textPadding = searchParams.get('textPadding') ? parseFloat(searchParams.get('textPadding')!) : undefined;\n    const lineHeight = searchParams.get('lineHeight') ? parseFloat(searchParams.get('lineHeight')!) : undefined;\n    const glassBackground = searchParams.get('glassBackground') === 'true';\n\n    return {\n      seed: customSeed || '',\n      avatarSeed: avatarSeed || '',\n      quote: customQuote || undefined,\n      author: customAuthor || undefined,\n      aspectRatio,\n      customWidth,\n      customHeight,\n      shapeCount,\n      avatarX,\n      avatarY,\n      avatarSize,\n      textMaxWidth,\n      textStartY,\n      fontSize,\n      borderColor,\n      borderOpacity,\n      patternSeed,\n      textPadding,\n      lineHeight,\n      glassBackground\n    };\n  }\n\n  private async callGenerationAPI(config: GenerationConfig): Promise<{ \n    svg: string; \n    seed: string; \n    dimensions: { width: number; height: number }; \n    aspectRatio: string;\n    // Actual values used during generation\n    actualSeed: string;\n    actualAvatarSeed: string;\n    actualQuote: { text: string; author: string };\n    actualShapeCount: number;\n    actualAvatarPositioning: { x: number; y: number; size: number };\n    actualTextMaxWidth: number;\n    actualTextStartY: number;\n    actualFontSize: number;\n    actualBorderColor: string;\n    actualBorderOpacity: number;\n    actualPatternSeed: string;\n    actualTextPadding: number;\n    actualLineHeight: number;\n    actualGlassBackground: boolean;\n  }> {\n    try {\n      // Use the actual seed or generate a random one\n      const actualSeed = config.seed || Math.random().toString(36).substring(2, 15);\n      const actualAvatarSeed = config.avatarSeed || actualSeed;\n      \n      // Get aspect ratio configuration\n      const aspectConfig = ASPECT_RATIOS[config.aspectRatio] || ASPECT_RATIOS['default'];\n      \n      // Apply custom dimensions if provided\n      const finalConfig = {\n        ...aspectConfig,\n        width: config.customWidth || aspectConfig.width,\n        height: config.customHeight || aspectConfig.height,\n        // Override positioning if custom values provided\n        avatarX: config.avatarX !== undefined ? config.avatarX : aspectConfig.avatarX,\n        avatarY: config.avatarY !== undefined ? config.avatarY : aspectConfig.avatarY,\n        avatarSize: config.avatarSize !== undefined ? config.avatarSize : aspectConfig.avatarSize\n      };\n\n      // Get quote (custom or random)\n      let actualQuote;\n      if (config.quote || config.author) {\n        actualQuote = {\n          text: config.quote || 'The journey of a thousand miles begins with one step.',\n          author: config.author || 'Lao Tzu'\n        };\n      } else {\n        actualQuote = await this.quoteService.fetchRandomQuote();\n      }\n\n      // Generate avatar\n      const avatarSvg = this.avatarService.generateAvatar(actualAvatarSeed);\n\n      // Calculate avatar positioning\n      const actualAvatarPositioning = this.avatarService.calculateAvatarPositioning(\n        finalConfig,\n        config.aspectRatio\n      );\n\n      // Generate pattern seed if not provided\n      const actualPatternSeed = config.patternSeed || actualSeed;\n\n      // Determine actual shape count\n      const actualShapeCount = config.shapeCount || 8; // Default from config\n\n      // Generate SVG using the SVGGenerator with ALL options\n      const svgResult = this.svgGenerator.generateSVG(\n        avatarSvg,\n        actualQuote,\n        actualPatternSeed,\n        finalConfig,\n        config.aspectRatio,\n        actualAvatarPositioning,\n        actualShapeCount,\n        {\n          // Visual styling options\n          fontSize: config.fontSize,\n          borderColor: config.borderColor,\n          borderOpacity: config.borderOpacity,\n          patternSeed: config.patternSeed,\n          textPadding: config.textPadding,\n          lineHeight: config.lineHeight,\n          glassBackground: config.glassBackground,\n          \n          // Positioning overrides\n          avatarX: config.avatarX,\n          avatarY: config.avatarY,\n          avatarSize: config.avatarSize,\n          textMaxWidth: config.textMaxWidth,\n          textStartY: config.textStartY\n        }\n      );\n\n      return {\n        svg: svgResult.svg,\n        seed: actualSeed,\n        dimensions: {\n          width: finalConfig.width,\n          height: finalConfig.height\n        },\n        aspectRatio: config.aspectRatio,\n        // Return all actual values used from SVGGenerator\n        actualSeed,\n        actualAvatarSeed,\n        actualQuote,\n        actualShapeCount: svgResult.actualValues.shapeCount,\n        actualAvatarPositioning: { \n          x: svgResult.actualValues.avatarX, \n          y: svgResult.actualValues.avatarY, \n          size: svgResult.actualValues.avatarSize \n        },\n        actualTextMaxWidth: svgResult.actualValues.textMaxWidth,\n        actualTextStartY: svgResult.actualValues.textStartY,\n        actualFontSize: svgResult.actualValues.fontSize,\n        actualBorderColor: svgResult.actualValues.borderColor,\n        actualBorderOpacity: svgResult.actualValues.borderOpacity,\n        actualPatternSeed: svgResult.actualValues.patternSeed,\n        actualTextPadding: svgResult.actualValues.textPadding,\n        actualLineHeight: svgResult.actualValues.lineHeight,\n        actualGlassBackground: svgResult.actualValues.glassBackground\n      };\n    } catch (error) {\n      console.error('Direct generation failed:', error);\n      \n      // Return fallback image on error\n      const aspectConfig = ASPECT_RATIOS[config.aspectRatio] || ASPECT_RATIOS['default'];\n      const fallbackSvg = this.generateFallbackImage(config.aspectRatio);\n      const fallbackSeed = config.seed || 'fallback';\n      \n      return {\n        svg: fallbackSvg,\n        seed: fallbackSeed,\n        dimensions: {\n          width: aspectConfig.width,\n          height: aspectConfig.height\n        },\n        aspectRatio: config.aspectRatio,\n        // Fallback actual values\n        actualSeed: fallbackSeed,\n        actualAvatarSeed: fallbackSeed,\n        actualQuote: { text: 'Idling.app', author: 'Wisdom & Community' },\n        actualShapeCount: 0,\n        actualAvatarPositioning: { x: aspectConfig.width / 2, y: aspectConfig.height * 0.3, size: 100 },\n        actualTextMaxWidth: aspectConfig.width * 0.8,\n        actualTextStartY: aspectConfig.height * 0.6,\n        actualFontSize: 42,\n        actualBorderColor: '#ffffff',\n        actualBorderOpacity: 0.7,\n        actualPatternSeed: fallbackSeed,\n        actualTextPadding: 30,\n        actualLineHeight: 1.4,\n        actualGlassBackground: false\n      };\n    }\n  }\n\n  private getClientIP(request: NextRequest): string {\n    return (\n      request.headers.get('x-forwarded-for') ||\n      request.headers.get('x-real-ip') ||\n      'unknown'\n    );\n  }\n\n  generateFallbackImage(aspectRatio: string = 'default'): string {\n    const config = ASPECT_RATIOS[aspectRatio] || ASPECT_RATIOS['default'];\n    const { width, height } = config;\n    \n    const centerX = width / 2;\n    const centerY1 = height * 0.4;\n    const centerY2 = height * 0.52;\n    const centerY3 = height * 0.62;\n    const viewBox = `0 0 ${width} ${height}`;\n    \n    return `<svg width=\\\"${width}\\\" height=\\\"${height}\\\" viewBox=\\\"${viewBox}\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\n  <defs>\n    <linearGradient id=\\\"bg\\\" x1=\\\"0%\\\" y1=\\\"0%\\\" x2=\\\"100%\\\" y2=\\\"100%\\\">\n      <stop offset=\\\"0%\\\" style=\\\"stop-color:#1a1a2e;stop-opacity:1\\\" />\n      <stop offset=\\\"50%\\\" style=\\\"stop-color:#16213e;stop-opacity:1\\\" />\n      <stop offset=\\\"100%\\\" style=\\\"stop-color:#0f3460;stop-opacity:1\\\" />\n    </linearGradient>\n    <linearGradient id=\\\"titleGrad\\\" x1=\\\"0%\\\" y1=\\\"0%\\\" x2=\\\"100%\\\" y2=\\\"0%\\\">\n      <stop offset=\\\"0%\\\" style=\\\"stop-color:#ff6b35;stop-opacity:1\\\" />\n      <stop offset=\\\"100%\\\" style=\\\"stop-color:#f7931e;stop-opacity:1\\\" />\n    </linearGradient>\n  </defs>\n  \n  <!-- Background -->\n  <rect width=\\\"${width}\\\" height=\\\"${height}\\\" fill=\\\"url(#bg)\\\"/>\n  \n  <!-- Decorative elements -->\n  <circle cx=\\\"${width * 0.15}\\\" cy=\\\"${height * 0.2}\\\" r=\\\"40\\\" fill=\\\"rgba(255,107,53,0.1)\\\"/>\n  <circle cx=\\\"${width * 0.85}\\\" cy=\\\"${height * 0.8}\\\" r=\\\"60\\\" fill=\\\"rgba(247,147,30,0.1)\\\"/>\n  <circle cx=\\\"${width * 0.9}\\\" cy=\\\"${height * 0.15}\\\" r=\\\"25\\\" fill=\\\"rgba(255,255,255,0.05)\\\"/>\n  \n  <!-- Main title -->\n  <text x=\\\"${centerX}\\\" y=\\\"${centerY1}\\\" text-anchor=\\\"middle\\\" fill=\\\"url(#titleGrad)\\\" \n        font-family=\\\"system-ui, -apple-system, sans-serif\\\" font-size=\\\"72\\\" font-weight=\\\"700\\\"\n        style=\\\"font-size: 72px !important; letter-spacing: -2px;\\\">Idling.app</text>\n  \n  <!-- Subtitle -->\n  <text x=\\\"${centerX}\\\" y=\\\"${centerY2}\\\" text-anchor=\\\"middle\\\" fill=\\\"rgba(255,255,255,0.9)\\\" \n        font-family=\\\"system-ui, -apple-system, sans-serif\\\" font-size=\\\"28\\\" font-weight=\\\"400\\\"\n        style=\\\"font-size: 28px !important;\\\">Wisdom &amp; Community</text>\n  \n  <!-- Description -->\n  <text x=\\\"${centerX}\\\" y=\\\"${centerY3}\\\" text-anchor=\\\"middle\\\" fill=\\\"rgba(255,255,255,0.7)\\\" \n        font-family=\\\"system-ui, -apple-system, sans-serif\\\" font-size=\\\"20\\\" font-weight=\\\"300\\\"\n        style=\\\"font-size: 20px !important;\\\">Revisit often to see the latest changes and play!</text>\n</svg>`;\n  }\n\n  private generateMachineFingerprint(request: NextRequest): string {\n    // Simple machine fingerprinting based on headers\n    const userAgent = request.headers.get('user-agent') || '';\n    const acceptLanguage = request.headers.get('accept-language') || '';\n    const acceptEncoding = request.headers.get('accept-encoding') || '';\n    \n    const fingerprint = `${userAgent}|${acceptLanguage}|${acceptEncoding}`;\n    \n    // Create a simple hash\n    let hash = 0;\n    for (let i = 0; i < fingerprint.length; i++) {\n      const char = fingerprint.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    \n    return Math.abs(hash).toString(36).substring(0, 32);\n  }\n\n  private hashUserAgent(userAgent: string): string {\n    // Simple hash for user agent\n    let hash = 0;\n    for (let i = 0; i < userAgent.length; i++) {\n      const char = userAgent.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash;\n    }\n    return Math.abs(hash).toString(36).substring(0, 64);\n  }\n} ",
    "language":"typescript",
    "lines":545,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/patterns/ShapePatternGenerator.ts":{
    "content":"export class ShapePatternGenerator {\n  generateShapePattern(\n    layerType: number,\n    layerColor: string,\n    layerOpacity: number,\n    random: () => number,\n    width: number,\n    height: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    if (layerType < 0.06) {\n      this.generateCircles(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else if (layerType < 0.12) {\n      this.generateHexagons(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else if (layerType < 0.18) {\n      this.generateStars(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else if (layerType < 0.24) {\n      this.generateTriangles(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else if (layerType < 0.3) {\n      this.generateEllipses(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else if (layerType < 0.35) {\n      this.generateCrosses(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else {\n      this.generateArcs(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    }\n  }\n\n  private generateCircles(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numCircles = Math.floor(20 + random() * 80);\n    for (let i = 0; i < numCircles; i++) {\n      const x = random() * width;\n      const y = random() * height;\n      const radius = 3 + random() * 20;\n      const opacity = Math.max(0.3, layerOpacity * (0.6 + random() * 0.4));\n      patterns.push(\n        `<circle cx=\\\"${x}\\\" cy=\\\"${y}\\\" r=\\\"${radius}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateHexagons(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numHexagons = Math.floor(10 + random() * 30);\n    for (let i = 0; i < numHexagons; i++) {\n      const centerX = random() * width;\n      const centerY = random() * height;\n      const size = 8 + random() * 25;\n      const rotation = random() * 60;\n      const points = [];\n      for (let j = 0; j < 6; j++) {\n        const angle = (j * 60 + rotation) * (Math.PI / 180);\n        const x = centerX + Math.cos(angle) * size;\n        const y = centerY + Math.sin(angle) * size;\n        points.push(`${x},${y}`);\n      }\n      const opacity = Math.max(0.25, layerOpacity * (0.4 + random() * 0.4));\n      const filled = random() > 0.6;\n      if (filled) {\n        patterns.push(\n          `<polygon points=\\\"${points.join(' ')}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      } else {\n        patterns.push(\n          `<polygon points=\\\"${points.join(' ')}\\\" fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${1 + random() * 2}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      }\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateStars(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numStars = Math.floor(8 + random() * 20);\n    for (let i = 0; i < numStars; i++) {\n      const centerX = random() * width;\n      const centerY = random() * height;\n      const outerRadius = 10 + random() * 20;\n      const innerRadius = outerRadius * (0.4 + random() * 0.3);\n      const spikes = 5 + Math.floor(random() * 3); // 5-7 spikes\n      const rotation = random() * 360;\n      const points = [];\n      for (let j = 0; j < spikes * 2; j++) {\n        const angle = ((j * 180) / spikes + rotation) * (Math.PI / 180);\n        const radius = j % 2 === 0 ? outerRadius : innerRadius;\n        const x = centerX + Math.cos(angle) * radius;\n        const y = centerY + Math.sin(angle) * radius;\n        points.push(`${x},${y}`);\n      }\n      const opacity = Math.max(0.3, layerOpacity * (0.5 + random() * 0.3));\n      patterns.push(\n        `<polygon points=\\\"${points.join(' ')}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateTriangles(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numTriangles = Math.floor(15 + random() * 35);\n    for (let i = 0; i < numTriangles; i++) {\n      const centerX = random() * width;\n      const centerY = random() * height;\n      const size = 8 + random() * 30;\n      const rotation = random() * 360;\n      const triangleType = random();\n      let points = [];\n\n      if (triangleType < 0.33) {\n        // Equilateral triangle\n        for (let j = 0; j < 3; j++) {\n          const angle = (j * 120 + rotation) * (Math.PI / 180);\n          const x = centerX + Math.cos(angle) * size;\n          const y = centerY + Math.sin(angle) * size;\n          points.push(`${x},${y}`);\n        }\n      } else if (triangleType < 0.66) {\n        // Right triangle\n        const x1 = centerX;\n        const y1 = centerY;\n        const x2 = centerX + size;\n        const y2 = centerY;\n        const x3 = centerX;\n        const y3 = centerY + size;\n        points = [`${x1},${y1}`, `${x2},${y2}`, `${x3},${y3}`];\n      } else {\n        // Isosceles triangle\n        const x1 = centerX;\n        const y1 = centerY - size;\n        const x2 = centerX - size * 0.7;\n        const y2 = centerY + size * 0.5;\n        const x3 = centerX + size * 0.7;\n        const y3 = centerY + size * 0.5;\n        points = [`${x1},${y1}`, `${x2},${y2}`, `${x3},${y3}`];\n      }\n\n      const opacity = Math.max(0.25, layerOpacity * (0.4 + random() * 0.4));\n      const filled = random() > 0.5;\n      if (filled) {\n        patterns.push(\n          `<polygon points=\\\"${points.join(' ')}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      } else {\n        patterns.push(\n          `<polygon points=\\\"${points.join(' ')}\\\" fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${1 + random() * 2}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      }\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateEllipses(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numEllipses = Math.floor(12 + random() * 25);\n    for (let i = 0; i < numEllipses; i++) {\n      const cx = random() * width;\n      const cy = random() * height;\n      const rx = 5 + random() * 25;\n      const ry = 5 + random() * 25;\n      const rotation = random() * 180;\n      const opacity = Math.max(0.25, layerOpacity * (0.4 + random() * 0.4));\n      const filled = random() > 0.4;\n      const ellipseTransform = `rotate(${rotation} ${cx} ${cy})`;\n      const ellipseBase = `<ellipse cx=\\\"${cx}\\\" cy=\\\"${cy}\\\" rx=\\\"${rx}\\\" ry=\\\"${ry}\\\"`;\n      if (filled) {\n        patterns.push(\n          `${ellipseBase} fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\" transform=\\\"${ellipseTransform}\\\"/>`\n        );\n      } else {\n        const strokeWidth = 1 + random() * 3;\n        patterns.push(\n          `${ellipseBase} fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${strokeWidth}\\\" opacity=\\\"${opacity}\\\" transform=\\\"${ellipseTransform}\\\"/>`\n        );\n      }\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateCrosses(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numCrosses = Math.floor(8 + random() * 20);\n    for (let i = 0; i < numCrosses; i++) {\n      const centerX = random() * width;\n      const centerY = random() * height;\n      const size = 8 + random() * 20;\n      const thickness = 2 + random() * 6;\n      const rotation = random() * 45;\n      const opacity = Math.max(0.3, layerOpacity * (0.5 + random() * 0.3));\n\n      // Create cross as two rectangles\n      const transform = `rotate(${rotation} ${centerX} ${centerY})`;\n      const rectBase = `fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\" transform=\\\"${transform}\\\"`;\n      const rect1 = `<rect x=\\\"${centerX - size}\\\" y=\\\"${centerY - thickness / 2}\\\" width=\\\"${size * 2}\\\" height=\\\"${thickness}\\\" ${rectBase}/>`;\n      const rect2 = `<rect x=\\\"${centerX - thickness / 2}\\\" y=\\\"${centerY - size}\\\" width=\\\"${thickness}\\\" height=\\\"${size * 2}\\\" ${rectBase}/>`;\n      patterns.push(rect1);\n      patterns.push(rect2);\n      colorUsage[layerColor] += 2;\n    }\n  }\n\n  private generateArcs(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numArcs = Math.floor(6 + random() * 15);\n    for (let i = 0; i < numArcs; i++) {\n      const startX = random() * width;\n      const startY = random() * height;\n      const radius = 20 + random() * 60;\n      const startAngle = random() * 360;\n      const endAngle = startAngle + 60 + random() * 180;\n      const opacity = Math.max(0.25, layerOpacity * (0.4 + random() * 0.4));\n      const strokeWidth = 2 + random() * 5;\n\n      // Create arc using path\n      const startAngleRad = startAngle * (Math.PI / 180);\n      const endAngleRad = endAngle * (Math.PI / 180);\n      const x1 = startX + Math.cos(startAngleRad) * radius;\n      const y1 = startY + Math.sin(startAngleRad) * radius;\n      const x2 = startX + Math.cos(endAngleRad) * radius;\n      const y2 = startY + Math.sin(endAngleRad) * radius;\n      const largeArc = Math.abs(endAngle - startAngle) > 180 ? 1 : 0;\n\n      patterns.push(\n        `<path d=\\\"M ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}\\\" fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${strokeWidth}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n      colorUsage[layerColor]++;\n    }\n  }\n} ",
    "language":"typescript",
    "lines":279,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/patterns/BasePatternGenerator.ts":{
    "content":"import { BackgroundPatternResult } from '../../types';\nimport { seededRandom } from '../../utils';\nimport { LinePatternGenerator } from './LinePatternGenerator';\nimport { OrganicPatternGenerator } from './OrganicPatternGenerator';\nimport { ShapePatternGenerator } from './ShapePatternGenerator';\n\n\nexport class BasePatternGenerator {\n  private shapeGenerator = new ShapePatternGenerator();\n  private lineGenerator = new LinePatternGenerator();\n  private organicGenerator = new OrganicPatternGenerator();\n\n  /**\n   * Generate completely random procedural patterns\n   */\n  generateBackgroundPattern(\n    seed: string,\n    width: number = 1200,\n    height: number = 630,\n    shapeCount?: number\n  ): BackgroundPatternResult {\n    // eslint-disable-next-line no-console\n    console.log(`\ud83c\udfa8 Pattern Generation Started - Seed: ${seed}`);\n\n    const random = seededRandom(seed);\n    const patterns: string[] = [];\n\n    // Use brighter, more contrasting colors against dark background\n    const colorOptions = [\n      '#ff6b35', // Orange (brand)\n      '#118ab2', // Blue (brand)\n      '#06d6a0', // Green\n      '#f72585', // Pink\n      '#7209b7', // Purple\n      '#ffd60a', // Yellow\n      '#f77f00', // Amber\n      '#d00000' // Red\n    ];\n\n    const primaryColor = colorOptions[Math.floor(random() * colorOptions.length)];\n    let secondaryColor = colorOptions[Math.floor(random() * colorOptions.length)];\n    // Ensure secondary is different from primary\n    while (secondaryColor === primaryColor) {\n      secondaryColor = colorOptions[Math.floor(random() * colorOptions.length)];\n    }\n\n    // Higher base opacity for better visibility against dark background\n    const baseOpacity = 0.4 + random() * 0.4; // 0.4-0.8 for much better visibility\n\n    // Track color usage to determine predominant color\n    const colorUsage = { [primaryColor]: 0, [secondaryColor]: 0 };\n\n    // Add subtle gradient base\n    patterns.push(this.createGradientBase(primaryColor, secondaryColor, width, height));\n\n    // Generate pattern layers with configurable shape count\n    const defaultLayers = Math.floor(5 + random() * 4); // 5-8 layers default\n    const numLayers = shapeCount ? Math.max(3, Math.min(15, shapeCount)) : defaultLayers;\n\n    for (let layer = 0; layer < numLayers; layer++) {\n      const layerType = random();\n      const layerColor = random() > 0.5 ? primaryColor : secondaryColor;\n      colorUsage[layerColor]++;\n      const layerOpacity = baseOpacity * (0.3 + random() * 0.7);\n\n      this.generateLayerPatterns(\n        layerType,\n        layerColor,\n        layerOpacity,\n        random,\n        width,\n        height,\n        patterns,\n        colorUsage\n      );\n    }\n\n    // Fallback: ensure we always have at least some visible patterns\n    if (patterns.length < 10) {\n      // eslint-disable-next-line no-console\n      console.log(\n        `\u26a0\ufe0f Too few patterns (${patterns.length}), adding fallback elements`\n      );\n      this.addFallbackPatterns(random, width, height, primaryColor, secondaryColor, patterns, colorUsage);\n    }\n\n    // Determine predominant color\n    const predominantColor =\n      colorUsage[primaryColor] >= colorUsage[secondaryColor]\n        ? primaryColor\n        : secondaryColor;\n\n    const result = patterns.join('\\\\n  ');\n\n    return {\n      patterns: result,\n      predominantColor: predominantColor\n    };\n  }\n\n  private createGradientBase(\n    primaryColor: string,\n    secondaryColor: string,\n    width: number,\n    height: number\n  ): string {\n    return `\n          <defs>\n        <linearGradient id=\\\"bgGrad\\\" x1=\\\"0%\\\" y1=\\\"0%\\\" x2=\\\"100%\\\" y2=\\\"100%\\\">\n          <stop offset=\\\"0%\\\" style=\\\"stop-color:${primaryColor};stop-opacity:0.08\\\" />\n          <stop offset=\\\"100%\\\" style=\\\"stop-color:${secondaryColor};stop-opacity:0.04\\\" />\n        </linearGradient>\n      </defs>\n      <rect x=\\\"8\\\" y=\\\"8\\\" width=\\\"${width - 16}\\\" height=\\\"${height - 16}\\\" rx=\\\"12\\\" ry=\\\"12\\\" fill=\\\"url(#bgGrad)\\\"/>\n  `;\n  }\n\n  private generateLayerPatterns(\n    layerType: number,\n    layerColor: string,\n    layerOpacity: number,\n    random: () => number,\n    width: number,\n    height: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    if (layerType < 0.4) {\n      // Shape patterns (circles, hexagons, stars, triangles, ellipses, crosses, arcs)\n      this.shapeGenerator.generateShapePattern(\n        layerType,\n        layerColor,\n        layerOpacity,\n        random,\n        width,\n        height,\n        patterns,\n        colorUsage\n      );\n    } else if (layerType < 0.8) {\n      // Line patterns (lines, spirals, zigzags, dots/dashes)\n      this.lineGenerator.generateLinePattern(\n        layerType,\n        layerColor,\n        layerOpacity,\n        random,\n        width,\n        height,\n        patterns,\n        colorUsage\n      );\n    } else {\n      // Organic patterns (polygons, grids, blobs, waves)\n      this.organicGenerator.generateOrganicPattern(\n        layerType,\n        layerColor,\n        layerOpacity,\n        random,\n        width,\n        height,\n        patterns,\n        colorUsage\n      );\n    }\n  }\n\n  private addFallbackPatterns(\n    random: () => number,\n    width: number,\n    height: number,\n    primaryColor: string,\n    secondaryColor: string,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    // Add guaranteed visible elements\n    for (let i = 0; i < 30; i++) {\n      const x = random() * width;\n      const y = random() * height;\n      const radius = 5 + random() * 15;\n      const color = random() > 0.5 ? primaryColor : secondaryColor;\n      colorUsage[color]++;\n      patterns.push(\n        `<circle cx=\\\"${x}\\\" cy=\\\"${y}\\\" r=\\\"${radius}\\\" fill=\\\"${color}\\\" opacity=\\\"0.5\\\"/>`\n      );\n    }\n\n    // Add some guaranteed lines\n    for (let i = 0; i < 15; i++) {\n      const x1 = random() * width;\n      const y1 = random() * height;\n      const x2 = random() * width;\n      const y2 = random() * height;\n      const color = random() > 0.5 ? primaryColor : secondaryColor;\n      colorUsage[color]++;\n      patterns.push(\n        `<line x1=\\\"${x1}\\\" y1=\\\"${y1}\\\" x2=\\\"${x2}\\\" y2=\\\"${y2}\\\" stroke=\\\"${color}\\\" stroke-width=\\\"2\\\" opacity=\\\"0.4\\\"/>`\n      );\n    }\n  }\n} ",
    "language":"typescript",
    "lines":201,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/patterns/OrganicPatternGenerator.ts":{
    "content":"export class OrganicPatternGenerator {\n  generateOrganicPattern(\n    layerType: number,\n    layerColor: string,\n    layerOpacity: number,\n    random: () => number,\n    width: number,\n    height: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    if (layerType < 0.85) {\n      this.generatePolygons(random, width, height, layerColor, layerOpacity, patterns);\n    } else if (layerType < 0.9) {\n      this.generateGridPattern(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else if (layerType < 0.95) {\n      this.generateBlobs(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else {\n      this.generateWaves(random, width, height, layerColor, layerOpacity, patterns);\n    }\n  }\n\n  private generatePolygons(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[]\n  ): void {\n    const numPolygons = Math.floor(10 + random() * 30);\n    for (let i = 0; i < numPolygons; i++) {\n      const centerX = random() * width;\n      const centerY = random() * height;\n      const sides = Math.floor(3 + random() * 5); // 3-7 sides\n      const radius = 10 + random() * 40;\n      const rotation = random() * Math.PI * 2;\n\n      const points = [];\n      for (let s = 0; s < sides; s++) {\n        const angle = (s / sides) * Math.PI * 2 + rotation;\n        const x = centerX + Math.cos(angle) * radius;\n        const y = centerY + Math.sin(angle) * radius;\n        points.push(`${x},${y}`);\n      }\n\n      const opacity = Math.max(0.25, layerOpacity * (0.4 + random() * 0.4));\n      const filled = random() > 0.7;\n      if (filled) {\n        patterns.push(\n          `<polygon points=\\\"${points.join(' ')}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      } else {\n        patterns.push(\n          `<polygon points=\\\"${points.join(' ')}\\\" fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${1 + random() * 3}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      }\n    }\n  }\n\n  private generateGridPattern(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const spacing = 30 + random() * 80;\n    const elementSize = 5 + random() * 20;\n    const gridRotation = random() * 45;\n\n    for (let x = 0; x < width + 200; x += spacing) {\n      for (let y = 0; y < height + 70; y += spacing) {\n        if (random() > 0.3) {\n          // Skip some elements for randomness\n          const finalX = x + (random() - 0.5) * spacing * 0.4;\n          const finalY = y + (random() - 0.5) * spacing * 0.4;\n          const opacity = Math.max(\n            0.3,\n            layerOpacity * (0.5 + random() * 0.3)\n          );\n\n          const shapeType = random();\n          const centerX = width / 2;\n          const centerY = height / 2;\n          const transform = `rotate(${gridRotation} ${centerX} ${centerY})`;\n\n          if (shapeType < 0.33) {\n            // Circle\n            patterns.push(\n              `<circle cx=\\\"${finalX}\\\" cy=\\\"${finalY}\\\" r=\\\"${elementSize}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\" transform=\\\"${transform}\\\"/>`\n            );\n          } else if (shapeType < 0.66) {\n            // Square\n            const rectSize = elementSize * 2;\n            patterns.push(\n              `<rect x=\\\"${finalX - elementSize}\\\" y=\\\"${finalY - elementSize}\\\" ` +\n                `width=\\\"${rectSize}\\\" height=\\\"${rectSize}\\\" fill=\\\"${layerColor}\\\" ` +\n                `opacity=\\\"${opacity}\\\" transform=\\\"${transform}\\\"/>`\n            );\n          } else {\n            // Diamond\n            const points = `${finalX},${finalY - elementSize} ${finalX + elementSize},${finalY} ${finalX},${finalY + elementSize} ${finalX - elementSize},${finalY}`;\n            patterns.push(\n              `<polygon points=\\\"${points}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\" transform=\\\"${transform}\\\"/>`\n            );\n          }\n          colorUsage[layerColor]++;\n        }\n      }\n    }\n  }\n\n  private generateBlobs(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numBlobs = Math.floor(5 + random() * 15);\n    for (let i = 0; i < numBlobs; i++) {\n      const centerX = random() * width;\n      const centerY = random() * height;\n      const baseRadius = 15 + random() * 30;\n      const points = 8 + Math.floor(random() * 8); // 8-15 points for organic shape\n      const opacity = Math.max(0.2, layerOpacity * (0.3 + random() * 0.4));\n\n      let pathData = '';\n      for (let p = 0; p < points; p++) {\n        const angle = (p / points) * Math.PI * 2;\n        const radiusVariation = 0.7 + random() * 0.6; // 0.7-1.3 multiplier\n        const radius = baseRadius * radiusVariation;\n        const x = centerX + Math.cos(angle) * radius;\n        const y = centerY + Math.sin(angle) * radius;\n\n        if (p === 0) {\n          pathData = `M ${x} ${y}`;\n        } else {\n          // Use smooth curves for organic feel\n          const prevAngle = ((p - 1) / points) * Math.PI * 2;\n          const prevRadius = baseRadius * (0.7 + random() * 0.6);\n          const prevX = centerX + Math.cos(prevAngle) * prevRadius;\n          const prevY = centerY + Math.sin(prevAngle) * prevRadius;\n\n          const cp1X =\n            prevX + Math.cos(prevAngle + Math.PI / 2) * radius * 0.3;\n          const cp1Y =\n            prevY + Math.sin(prevAngle + Math.PI / 2) * radius * 0.3;\n          const cp2X = x + Math.cos(angle - Math.PI / 2) * radius * 0.3;\n          const cp2Y = y + Math.sin(angle - Math.PI / 2) * radius * 0.3;\n\n          pathData += ` C ${cp1X} ${cp1Y}, ${cp2X} ${cp2Y}, ${x} ${y}`;\n        }\n      }\n      pathData += ' Z'; // Close the path\n\n      patterns.push(\n        `<path d=\\\"${pathData}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateWaves(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[]\n  ): void {\n    const numWaves = Math.floor(5 + random() * 15);\n    for (let i = 0; i < numWaves; i++) {\n      const startX = random() * width;\n      const startY = random() * height;\n      const amplitude = 20 + random() * 60;\n      const frequency = 0.01 + random() * 0.02;\n      const length = 100 + random() * 400;\n      const angle = random() * Math.PI * 2;\n\n      let pathData = `M ${startX} ${startY}`;\n      for (let t = 0; t < length; t += 5) {\n        const x = startX + Math.cos(angle) * t;\n        const y =\n          startY + Math.sin(angle) * t + Math.sin(t * frequency) * amplitude;\n        pathData += ` L ${x} ${y}`;\n      }\n\n      const opacity = Math.max(0.25, layerOpacity * (0.4 + random() * 0.4));\n      patterns.push(\n        `<path d=\\\"${pathData}\\\" fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${1 + random() * 3}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n    }\n  }\n} ",
    "language":"typescript",
    "lines":200,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/services/patterns/LinePatternGenerator.ts":{
    "content":"export class LinePatternGenerator {\n  generateLinePattern(\n    layerType: number,\n    layerColor: string,\n    layerOpacity: number,\n    random: () => number,\n    width: number,\n    height: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    if (layerType < 0.55) {\n      this.generateLines(random, width, height, layerColor, layerOpacity, patterns);\n    } else if (layerType < 0.65) {\n      this.generateSpirals(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else if (layerType < 0.75) {\n      this.generateZigzags(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    } else {\n      this.generateDotsAndDashes(random, width, height, layerColor, layerOpacity, patterns, colorUsage);\n    }\n  }\n\n  private generateLines(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[]\n  ): void {\n    const numLines = Math.floor(15 + random() * 40);\n    for (let i = 0; i < numLines; i++) {\n      const x1 = random() * width;\n      const y1 = random() * height;\n      const length = 50 + random() * 200;\n      const angle = random() * Math.PI * 2;\n      const x2 = x1 + Math.cos(angle) * length;\n      const y2 = y1 + Math.sin(angle) * length;\n      const strokeWidth = 1 + random() * 4;\n      const opacity = Math.max(0.25, layerOpacity * (0.5 + random() * 0.5));\n      patterns.push(\n        `<line x1=\\\"${x1}\\\" y1=\\\"${y1}\\\" x2=\\\"${x2}\\\" y2=\\\"${y2}\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${strokeWidth}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n    }\n  }\n\n  private generateSpirals(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numSpirals = Math.floor(3 + random() * 8);\n    for (let i = 0; i < numSpirals; i++) {\n      const centerX = random() * width;\n      const centerY = random() * height;\n      const maxRadius = 20 + random() * 50;\n      const turns = 2 + random() * 4;\n      const strokeWidth = 1 + random() * 3;\n      const opacity = Math.max(0.2, layerOpacity * (0.3 + random() * 0.4));\n\n      let pathData = `M ${centerX} ${centerY}`;\n      const steps = Math.floor(turns * 20);\n      for (let step = 1; step <= steps; step++) {\n        const angle = (step / steps) * turns * 2 * Math.PI;\n        const radius = (step / steps) * maxRadius;\n        const x = centerX + Math.cos(angle) * radius;\n        const y = centerY + Math.sin(angle) * radius;\n        pathData += ` L ${x} ${y}`;\n      }\n\n      patterns.push(\n        `<path d=\\\"${pathData}\\\" fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${strokeWidth}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateZigzags(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numZigzags = Math.floor(5 + random() * 12);\n    for (let i = 0; i < numZigzags; i++) {\n      const startX = random() * width;\n      const startY = random() * height;\n      const length = 100 + random() * 200;\n      const amplitude = 10 + random() * 30;\n      const frequency = 3 + random() * 5;\n      const angle = random() * Math.PI * 2;\n      const strokeWidth = 1 + random() * 3;\n      const opacity = Math.max(0.25, layerOpacity * (0.4 + random() * 0.4));\n\n      let pathData = `M ${startX} ${startY}`;\n      const steps = Math.floor(frequency * 4);\n      for (let step = 1; step <= steps; step++) {\n        const progress = step / steps;\n        const baseX = startX + Math.cos(angle) * length * progress;\n        const baseY = startY + Math.sin(angle) * length * progress;\n        const offsetX =\n          Math.cos(angle + Math.PI / 2) *\n          amplitude *\n          Math.sin(progress * frequency * Math.PI);\n        const offsetY =\n          Math.sin(angle + Math.PI / 2) *\n          amplitude *\n          Math.sin(progress * frequency * Math.PI);\n        pathData += ` L ${baseX + offsetX} ${baseY + offsetY}`;\n      }\n\n      patterns.push(\n        `<path d=\\\"${pathData}\\\" fill=\\\"none\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${strokeWidth}\\\" opacity=\\\"${opacity}\\\"/>`\n      );\n      colorUsage[layerColor]++;\n    }\n  }\n\n  private generateDotsAndDashes(\n    random: () => number,\n    width: number,\n    height: number,\n    layerColor: string,\n    layerOpacity: number,\n    patterns: string[],\n    colorUsage: Record<string, number>\n  ): void {\n    const numDots = Math.floor(30 + random() * 70);\n    for (let i = 0; i < numDots; i++) {\n      const x = random() * width;\n      const y = random() * height;\n      const isDash = random() > 0.6;\n      const opacity = Math.max(0.3, layerOpacity * (0.5 + random() * 0.4));\n\n      if (isDash) {\n        const length = 5 + random() * 15;\n        const angle = random() * Math.PI * 2;\n        const x2 = x + Math.cos(angle) * length;\n        const y2 = y + Math.sin(angle) * length;\n        const strokeWidth = 1 + random() * 3;\n        patterns.push(\n          `<line x1=\\\"${x}\\\" y1=\\\"${y}\\\" x2=\\\"${x2}\\\" y2=\\\"${y2}\\\" stroke=\\\"${layerColor}\\\" stroke-width=\\\"${strokeWidth}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      } else {\n        const radius = 1 + random() * 4;\n        patterns.push(\n          `<circle cx=\\\"${x}\\\" cy=\\\"${y}\\\" r=\\\"${radius}\\\" fill=\\\"${layerColor}\\\" opacity=\\\"${opacity}\\\"/>`\n        );\n      }\n      colorUsage[layerColor]++;\n    }\n  }\n} ",
    "language":"typescript",
    "lines":160,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/index.ts":{
    "content":"/**\n * User Management Panel Module Exports\n * \n * This index file provides clean exports for all the UserManagementPanel\n * modules, making it easy to import specific functionality while\n * maintaining module boundaries.\n */\n\n// Main component export\nexport { UserManagementPanel } from './UserManagementPanel';\n\n// Specialized components\nexport { FilterPanel } from './FilterPanel';\nexport { HeaderSection } from './HeaderSection';\nexport { PaginationSection } from './PaginationSection';\nexport { UserTable } from './UserTable';\n\n// Type definitions\nexport type * from './types';\n\n// Constants and configuration\nexport * from './constants';\n\n// Utility functions\nexport * from './utils';\n\n// Custom hooks\nexport * from './hooks';\n\n// UI Components\nexport * from './components';\n",
    "language":"typescript",
    "lines":32,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/hooks.ts":{
    "content":"/**\n * Custom hooks for User Management Panel\n * \n * This module contains reusable hooks that encapsulate complex state\n * management logic, API calls, and data processing for the user\n * management system.\n */\n\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { USERS_PER_LOAD, USERS_PER_PAGE } from './constants';\nimport type {\n    ColumnFilter,\n    ColumnSort,\n    ManagementUser,\n    SearchResult\n} from './types';\nimport { getFieldValue } from './utils';\n\n// ================================\n// DATA LOADING HOOKS\n// ================================\n\n/**\n * Hook for loading and managing users data\n */\nexport const useUsersData = () => {\n  const [users, setUsers] = useState<ManagementUser[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(1);\n\n  const loadUsers = useCallback(async (page: number = 1) => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await fetch(`/api/admin/users?page=${page}&limit=20`);\n      if (!response.ok) {\n        throw new Error('Failed to load users');\n      }\n\n      const data = await response.json();\n      setUsers(data.users);\n      setCurrentPage(data.currentPage);\n      setTotalPages(data.totalPages);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Unknown error');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const goToPage = useCallback(\n    (page: number) => {\n      if (page >= 1 && page <= totalPages) {\n        loadUsers(page);\n      }\n    },\n    [totalPages, loadUsers]\n  );\n\n  return {\n    users,\n    loading,\n    error,\n    currentPage,\n    totalPages,\n    loadUsers,\n    goToPage,\n    setError\n  };\n};\n\n// ================================\n// SEARCH HOOKS\n// ================================\n\n/**\n * Hook for managing smart search functionality\n */\nexport const useSmartSearch = () => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchResults, setSearchResults] = useState<SearchResult[]>([]);\n  const [isSearching, setIsSearching] = useState(false);\n  const [showSearchResults, setShowSearchResults] = useState(false);\n\n  const handleSearchChange = useCallback(async (value: string) => {\n    setSearchQuery(value);\n\n    if (value.trim().length < 2) {\n      setSearchResults([]);\n      setShowSearchResults(false);\n      return;\n    }\n\n    setIsSearching(true);\n    setShowSearchResults(true);\n\n    try {\n      const response = await fetch(\n        `/api/admin/users/search?q=${encodeURIComponent(value.trim())}`\n      );\n      if (response.ok) {\n        const data = await response.json();\n        setSearchResults(data.users || []);\n      } else {\n        console.error('Search failed:', response.statusText);\n        setSearchResults([]);\n      }\n    } catch (error) {\n      console.error('Search error:', error);\n      setSearchResults([]);\n    } finally {\n      setIsSearching(false);\n    }\n  }, []);\n\n  const handleSearchResultSelect = useCallback((user: SearchResult) => {\n    const managementUser: ManagementUser = {\n      ...user,\n      created_at: new Date().toISOString(), // Placeholder, will be fetched with full details\n      timeouts: []\n    };\n    setShowSearchResults(false);\n    setSearchQuery('');\n    return managementUser;\n  }, []);\n\n  return {\n    searchQuery,\n    searchResults,\n    isSearching,\n    showSearchResults,\n    setSearchQuery,\n    setShowSearchResults,\n    handleSearchChange,\n    handleSearchResultSelect\n  };\n};\n\n// ================================\n// FILTERING HOOKS\n// ================================\n\n/**\n * Hook for managing column filtering\n */\nexport const useColumnFiltering = (users: ManagementUser[]) => {\n  const [columnFilters, setColumnFilters] = useState<ColumnFilter[]>([]);\n  const [showFilterPanel, setShowFilterPanel] = useState(false);\n  const [activeFiltersCount, setActiveFiltersCount] = useState(0);\n\n  // Apply column filters to users\n  const applyColumnFilters = useCallback(\n    (userList: ManagementUser[]): ManagementUser[] => {\n      // If no filters are active, return all users\n      if (columnFilters.length === 0 || activeFiltersCount === 0) {\n        return userList;\n      }\n\n      const filtered = userList.filter((user) => {\n        return columnFilters.every((filter) => {\n          if (!filter.active) return true;\n\n          const fieldValue = getFieldValue(user, filter.column);\n          const filterValue = filter.value.toLowerCase().trim();\n\n          switch (filter.operator) {\n            case 'contains':\n              return fieldValue.toLowerCase().includes(filterValue);\n            case 'not_contains':\n              return !fieldValue.toLowerCase().includes(filterValue);\n            case 'equals':\n              return fieldValue.toLowerCase() === filterValue;\n            case 'not_equals':\n              return fieldValue.toLowerCase() !== filterValue;\n            case 'starts_with':\n              return fieldValue.toLowerCase().startsWith(filterValue);\n            case 'ends_with':\n              return fieldValue.toLowerCase().endsWith(filterValue);\n            case 'is_empty':\n              return !fieldValue || fieldValue.trim() === '';\n            case 'is_not_empty':\n              return fieldValue && fieldValue.trim() !== '';\n            case 'date_before':\n              return new Date(fieldValue) < new Date(filter.value);\n            case 'date_after':\n              return new Date(fieldValue) > new Date(filter.value);\n            case 'date_equals':\n              return (\n                new Date(fieldValue).toDateString() ===\n                new Date(filter.value).toDateString()\n              );\n            default:\n              return true;\n          }\n        });\n      });\n\n      return filtered;\n    },\n    [columnFilters, activeFiltersCount]\n  );\n\n  // Update active filters count\n  useEffect(() => {\n    const activeCount = columnFilters.filter((filter) => filter.active).length;\n    setActiveFiltersCount(activeCount);\n  }, [columnFilters]);\n\n  // Filter management functions\n  const addColumnFilter = useCallback((column: string) => {\n    const newFilter: ColumnFilter = {\n      column,\n      operator: 'contains',\n      value: '',\n      active: false\n    };\n    setColumnFilters((prev) => [...prev, newFilter]);\n  }, []);\n\n  const updateColumnFilter = useCallback(\n    (index: number, updates: Partial<ColumnFilter>) => {\n      setColumnFilters((prev) =>\n        prev.map((filter, i) =>\n          i === index ? { ...filter, ...updates } : filter\n        )\n      );\n    },\n    []\n  );\n\n  const removeColumnFilter = useCallback((index: number) => {\n    setColumnFilters((prev) => prev.filter((_, i) => i !== index));\n  }, []);\n\n  const clearAllFilters = useCallback(() => {\n    setColumnFilters([]);\n    setActiveFiltersCount(0);\n  }, []);\n\n  return {\n    columnFilters,\n    showFilterPanel,\n    activeFiltersCount,\n    setShowFilterPanel,\n    applyColumnFilters,\n    addColumnFilter,\n    updateColumnFilter,\n    removeColumnFilter,\n    clearAllFilters\n  };\n};\n\n// ================================\n// SORTING HOOKS\n// ================================\n\n/**\n * Hook for managing column sorting\n */\nexport const useColumnSorting = () => {\n  const [currentSort, setCurrentSort] = useState<ColumnSort>({\n    column: '',\n    direction: null\n  });\n\n  const handleSort = useCallback((columnKey: string) => {\n    setCurrentSort((prev) => {\n      if (prev.column === columnKey) {\n        // Cycle through: asc -> desc -> null -> asc\n        const newDirection = \n          prev.direction === 'asc' ? 'desc' :\n          prev.direction === 'desc' ? null : 'asc';\n        return { column: columnKey, direction: newDirection };\n      } else {\n        // New column, start with ascending\n        return { column: columnKey, direction: 'asc' };\n      }\n    });\n  }, []);\n\n  const getSortIndicator = useCallback(\n    (columnKey: string): string => {\n      if (currentSort.column !== columnKey) return '';\n      switch (currentSort.direction) {\n        case 'asc':\n          return ' \u2191';\n        case 'desc':\n          return ' \u2193';\n        default:\n          return '';\n      }\n    },\n    [currentSort]\n  );\n\n  return {\n    currentSort,\n    handleSort,\n    getSortIndicator\n  };\n};\n\n// ================================\n// PAGINATION HOOKS\n// ================================\n\n/**\n * Hook for managing infinite scroll pagination\n */\nexport const useInfiniteScroll = (filteredUsers: ManagementUser[]) => {\n  const [displayedUsers, setDisplayedUsers] = useState<ManagementUser[]>([]);\n  const [hasMoreUsers, setHasMoreUsers] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n\n  // Load more users for infinite scroll\n  const loadMoreUsers = useCallback(() => {\n    if (isLoadingMore || !hasMoreUsers) return;\n\n    setIsLoadingMore(true);\n\n    // Simulate loading delay for better UX\n    setTimeout(() => {\n      const currentDisplayed = displayedUsers.length;\n      const nextBatch = filteredUsers.slice(\n        currentDisplayed,\n        currentDisplayed + USERS_PER_LOAD\n      );\n\n      if (nextBatch.length > 0) {\n        setDisplayedUsers((prev) => [...prev, ...nextBatch]);\n        setHasMoreUsers(\n          currentDisplayed + nextBatch.length < filteredUsers.length\n        );\n      } else {\n        setHasMoreUsers(false);\n      }\n\n      setIsLoadingMore(false);\n    }, 300);\n  }, [displayedUsers, filteredUsers, isLoadingMore, hasMoreUsers]);\n\n  // Initialize displayed users when filteredUsers change\n  useEffect(() => {\n    const initialUsers = filteredUsers.slice(0, USERS_PER_LOAD);\n    setDisplayedUsers(initialUsers);\n    setHasMoreUsers(initialUsers.length < filteredUsers.length);\n  }, [filteredUsers]);\n\n  return {\n    displayedUsers,\n    hasMoreUsers,\n    isLoadingMore,\n    loadMoreUsers\n  };\n};\n\n/**\n * Hook for getting paginated users based on pagination mode\n */\nexport const usePaginatedUsers = (\n  filteredUsers: ManagementUser[],\n  currentPage: number,\n  paginationMode: 'traditional' | 'infinite',\n  displayedUsers: ManagementUser[]\n) => {\n  return useMemo(() => {\n    if (paginationMode === 'infinite') {\n      return displayedUsers;\n    } else {\n      // Traditional pagination\n      const startIndex = (currentPage - 1) * USERS_PER_PAGE;\n      const endIndex = startIndex + USERS_PER_PAGE;\n      return filteredUsers.slice(startIndex, endIndex);\n    }\n  }, [paginationMode, displayedUsers, filteredUsers, currentPage]);\n}; ",
    "language":"typescript",
    "lines":379,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/constants.ts":{
    "content":"/**\n * Constants and configuration for User Management Panel\n * \n * This module contains all the static configuration data including\n * filterable columns, sortable columns, and operational constants\n * used throughout the user management system.\n */\n\nimport type { FilterableColumn, FilterOperator, ManagementUser, SortableColumn } from './types';\n\n// ================================\n// PAGINATION CONSTANTS\n// ================================\n\nexport const USERS_PER_PAGE = 10;\nexport const USERS_PER_LOAD = 10; // For infinite scroll\n\n// ================================\n// FILTERABLE COLUMNS CONFIGURATION\n// ================================\n\nexport const FILTERABLE_COLUMNS: FilterableColumn[] = [\n  { key: 'name', label: 'User Name', type: 'text' },\n  { key: 'email', label: 'Contact Email', type: 'email' },\n  {\n    key: 'provider_name',\n    label: 'Provider',\n    type: 'select',\n    options: ['Twitch', 'Discord', 'GitHub', 'Google']\n  },\n  { key: 'role_names', label: 'Roles', type: 'text' },\n  {\n    key: 'is_timed_out',\n    label: 'Status',\n    type: 'boolean'\n  },\n  {\n    key: 'subscriptions',\n    label: 'Plans',\n    type: 'select',\n    options: ['Free', 'Premium', 'Pro']\n  },\n  { key: 'active_timeout_reason', label: 'Timeout Reason', type: 'text' },\n  { key: 'created_at', label: 'Join Date', type: 'date' }\n];\n\n// ================================\n// SORTABLE COLUMNS CONFIGURATION\n// ================================\n\nexport const SORTABLE_COLUMNS: SortableColumn[] = [\n  {\n    key: 'actions',\n    label: 'Actions',\n    sortable: false,\n    sortType: 'string'\n  },\n  {\n    key: 'name',\n    label: 'User',\n    sortable: true,\n    sortType: 'custom',\n    customSortFn: (a, b, direction) => {\n      // Sort by name, fallback to ID if names are equal/null\n      const nameA = (a.name || '').toLowerCase();\n      const nameB = (b.name || '').toLowerCase();\n\n      if (nameA !== nameB) {\n        const result = nameA.localeCompare(nameB);\n        return direction === 'asc' ? result : -result;\n      }\n\n      // Fallback to ID comparison\n      const idA = parseInt(a.id);\n      const idB = parseInt(b.id);\n      const result = idA - idB;\n      return direction === 'asc' ? result : -result;\n    }\n  },\n  {\n    key: 'email',\n    label: 'Contact',\n    sortable: true,\n    sortType: 'string'\n  },\n  {\n    key: 'provider_name',\n    label: 'Provider',\n    sortable: true,\n    sortType: 'string'\n  },\n  {\n    key: 'role_names',\n    label: 'Roles',\n    sortable: true,\n    sortType: 'custom',\n    customSortFn: (a, b, direction) => {\n      // Sort by role count first, then alphabetically by role names\n      const roleCountA = a.role_count || 0;\n      const roleCountB = b.role_count || 0;\n\n      if (roleCountA !== roleCountB) {\n        const result = roleCountA - roleCountB;\n        return direction === 'asc' ? result : -result;\n      }\n\n      // Fallback to alphabetical by role names\n      const rolesA = (a.role_names || '').toLowerCase();\n      const rolesB = (b.role_names || '').toLowerCase();\n      const result = rolesA.localeCompare(rolesB);\n      return direction === 'asc' ? result : -result;\n    }\n  },\n  {\n    key: 'is_timed_out',\n    label: 'Status',\n    sortable: true,\n    sortType: 'boolean'\n  },\n  {\n    key: 'subscriptions',\n    label: 'Plans',\n    sortable: true,\n    sortType: 'custom',\n    customSortFn: (a, b, direction) => {\n      // Define subscription tier hierarchy\n      const getTierValue = (user: ManagementUser): number => {\n        if (user.subscriptions && user.subscriptions.length > 0) {\n          const plans = user.subscriptions.map((sub) =>\n            sub.plan_name.toLowerCase()\n          );\n          if (plans.includes('pro')) return 3;\n          if (plans.includes('premium')) return 2;\n          return 1; // Any other plan\n        }\n        return 0; // Free/no subscription\n      };\n\n      const tierA = getTierValue(a);\n      const tierB = getTierValue(b);\n      const result = tierA - tierB;\n      return direction === 'asc' ? result : -result;\n    }\n  },\n  {\n    key: 'timeout_expires',\n    label: 'Timeout Details',\n    sortable: true,\n    sortType: 'custom',\n    customSortFn: (a, b, direction) => {\n      // Sort by timeout status first (timed out users first), then by expiration date\n      const timedOutA = a.is_timed_out ? 1 : 0;\n      const timedOutB = b.is_timed_out ? 1 : 0;\n\n      if (timedOutA !== timedOutB) {\n        const result = timedOutB - timedOutA; // Timed out users first\n        return direction === 'asc' ? result : -result;\n      }\n\n      // If both have same timeout status, sort by expiration date\n      if (a.timeout_expires && b.timeout_expires) {\n        const dateA = new Date(a.timeout_expires).getTime();\n        const dateB = new Date(b.timeout_expires).getTime();\n        const result = dateA - dateB;\n        return direction === 'asc' ? result : -result;\n      }\n\n      // Handle cases where one has expiration and other doesn't\n      if (a.timeout_expires && !b.timeout_expires)\n        return direction === 'asc' ? -1 : 1;\n      if (!a.timeout_expires && b.timeout_expires)\n        return direction === 'asc' ? 1 : -1;\n\n      return 0;\n    }\n  },\n  {\n    key: 'created_at',\n    label: 'Joined',\n    sortable: true,\n    sortType: 'date'\n  }\n];\n\n// ================================\n// FILTER OPERATOR UTILITIES\n// ================================\n\n/**\n * Get valid operators for a given column type\n * @param columnType - The type of column to get operators for\n * @returns Array of valid filter operators\n */\nexport const getValidOperators = (\n  columnType: FilterableColumn['type']\n): FilterOperator[] => {\n  switch (columnType) {\n    case 'text':\n    case 'email':\n      return [\n        'contains',\n        'not_contains',\n        'equals',\n        'not_equals',\n        'starts_with',\n        'ends_with',\n        'is_empty',\n        'is_not_empty'\n      ];\n\n    case 'select':\n      return ['equals', 'not_equals', 'is_empty', 'is_not_empty'];\n\n    case 'boolean':\n      return ['equals', 'not_equals'];\n\n    case 'date':\n      return [\n        'date_equals',\n        'date_before',\n        'date_after',\n        'is_empty',\n        'is_not_empty'\n      ];\n\n    default:\n      return ['contains', 'equals'];\n  }\n};\n\n/**\n * Get user-friendly label for filter operators\n * @param operator - The filter operator\n * @returns Human-readable label for the operator\n */\nexport const getOperatorLabel = (operator: FilterOperator): string => {\n  switch (operator) {\n    case 'contains':\n      return 'Contains';\n    case 'not_contains':\n      return 'Does not contain';\n    case 'equals':\n      return 'Equals';\n    case 'not_equals':\n      return 'Does not equal';\n    case 'starts_with':\n      return 'Starts with';\n    case 'ends_with':\n      return 'Ends with';\n    case 'is_empty':\n      return 'Is empty';\n    case 'is_not_empty':\n      return 'Is not empty';\n    case 'date_before':\n      return 'Before date';\n    case 'date_after':\n      return 'After date';\n    case 'date_equals':\n      return 'On date';\n    default:\n      return operator;\n  }\n}; ",
    "language":"typescript",
    "lines":263,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/admin/components/UserManagementPanel/types.ts":{
    "content":"/**\n * Type definitions for User Management Panel\n * \n * This module contains all the interfaces and types used throughout\n * the user management system, providing a central location for\n * type definitions and ensuring consistency across components.\n */\n\n// ================================\n// USER MANAGEMENT INTERFACES\n// ================================\n\nexport interface ManagementUser {\n  id: string;\n  name: string | null;\n  email: string | null;\n  image: string | null;\n  created_at: string;\n  provider_name?: string | null;\n  is_timed_out?: boolean;\n  active_timeout_id?: number | null;\n  active_timeout_reason?: string | null;\n  timeout_expires?: string | null;\n  // Role summary from API\n  role_count?: number;\n  role_names?: string | null;\n  has_admin?: boolean;\n  has_moderator?: boolean;\n  // Legacy format for compatibility\n  roles?: ManagementUserRole[];\n  subscriptions?: ManagementUserSubscription[];\n  timeouts?: ManagementUserTimeout[];\n}\n\nexport interface ManagementUserRole {\n  id: string;\n  name: string;\n  display_name: string;\n  assigned_at: string;\n}\n\nexport interface ManagementUserSubscription {\n  id: string;\n  service_name: string;\n  plan_name: string;\n  status: string;\n  expires_at: string | null;\n}\n\nexport interface ManagementUserTimeout {\n  id: string;\n  reason: string;\n  expires_at: string;\n  created_at: string;\n  is_active: boolean;\n}\n\nexport interface SearchResult {\n  id: string;\n  name: string | null;\n  email: string | null;\n  image: string | null;\n  role_names?: string | null;\n  roles?: ManagementUserRole[];\n  subscriptions?: ManagementUserSubscription[];\n}\n\n// ================================\n// COMPONENT PROP INTERFACES\n// ================================\n\nexport interface AdminUserManagementPanelProps {\n  onUserUpdate?: () => void;\n}\n\nexport interface UserActionsMenuProps {\n  user: ManagementUser;\n  onViewUser: (userId: string) => void;\n  onAssignRole: (user: ManagementUser) => void;\n  onManageSubscription: (user: ManagementUser) => void;\n  onManageQuota: (user: ManagementUser) => void;\n  onExportData: (user: ManagementUser) => void;\n  onTimeoutUser: (user: ManagementUser) => void;\n  onRevokeTimeout: (user: ManagementUser) => void;\n  closeTooltip?: () => void;\n}\n\n// ================================\n// FILTERING INTERFACES\n// ================================\n\nexport interface ColumnFilter {\n  column: string;\n  operator: FilterOperator;\n  value: string;\n  active: boolean;\n}\n\nexport type FilterOperator =\n  | 'contains'\n  | 'equals'\n  | 'starts_with'\n  | 'ends_with'\n  | 'not_contains'\n  | 'not_equals'\n  | 'is_empty'\n  | 'is_not_empty'\n  | 'date_before'\n  | 'date_after'\n  | 'date_equals';\n\nexport interface FilterableColumn {\n  key: string;\n  label: string;\n  type: 'text' | 'email' | 'date' | 'boolean' | 'select';\n  options?: string[]; // For select type filters\n}\n\n// ================================\n// SORTING INTERFACES\n// ================================\n\nexport type SortDirection = 'asc' | 'desc' | null;\n\nexport interface ColumnSort {\n  column: string;\n  direction: SortDirection;\n}\n\nexport interface SortableColumn {\n  key: string;\n  label: string;\n  sortable: boolean;\n  sortType: 'string' | 'number' | 'date' | 'boolean' | 'custom';\n  customSortFn?: (\n    a: ManagementUser,\n    b: ManagementUser,\n    direction: 'asc' | 'desc'\n  ) => number;\n} ",
    "language":"typescript",
    "lines":140,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/gitlab-link/gitlab-link-test-ids.ts":{
    "content":"export const GITLAB_LINK_TEST_IDS = {\n  LINK: 'https://gitlab.com/underwood_inc/idling-app'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/message-ticker/actions.ts":{
    "content":"'use server';\n\nexport interface BuddhaQuoteResponse {\n  id: string;\n  text: string;\n  byId: string;\n  byName: string;\n  byImage: string;\n}\n\nexport async function fetchBuddha(): Promise<BuddhaQuoteResponse | null> {\n  const res: Response = await fetch('https://buddha-api.com/api/random', {\n    cache: 'no-cache'\n  });\n\n  if (!res.ok) {\n    console.error('Failed to fetch messages');\n    return null;\n  }\n\n  return res.json();\n}\n",
    "language":"typescript",
    "lines":23,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-buttons/actions.ts":{
    "content":"'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { redirect } from 'next/navigation';\nimport { signIn, signOut } from 'src/lib/auth';\nimport { NAV_PATHS } from 'src/lib/routes';\nimport { SignInProviders } from './types';\n\nexport async function signInAction(\n  provider: SignInProviders,\n  redirectTo?: string\n) {\n  await signIn(provider, {\n    redirectTo: redirectTo || NAV_PATHS.ROOT\n  });\n\n  // Revalidate all paths to clear auth-related caches\n  revalidatePath('/', 'layout');\n}\n\nexport async function signOutAction() {\n  await signOut();\n\n  // Revalidate all paths to clear auth-related caches\n  revalidatePath('/', 'layout');\n\n  // Redirect to home page\n  redirect(NAV_PATHS.ROOT);\n}\n",
    "language":"typescript",
    "lines":30,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-buttons/types.ts":{
    "content":"export type SignInProviders = 'twitch' | 'google';\n",
    "language":"typescript",
    "lines":2,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/schema.ts":{
    "content":"import { z, ZodError } from 'zod';\n\nexport const SUBMISSION_NAME_MAX_LENGTH = 255;\n\n// \u2705 Post-migration 0010: Submissions now use only user_id for user identification\n// OAuth provider IDs are no longer used for lookups, ensuring stability across username changes\nexport const submissionSchema = z.object({\n  submission_id: z.number(),\n  submission_name: z.string(),\n  submission_title: z\n    .string()\n    .min(1, 'Title is required')\n    .max(255, 'Title must be 255 characters or less'),\n  submission_datetime: z.date(),\n  user_id: z.number().min(1), // Only user identifier after migration 0010\n  author: z.string(), // User's display name from users table (for display only)\n  author_bio: z.string().nullable().optional(), // User's bio from users table\n  tags: z.array(z.string()),\n  thread_parent_id: z.number().nullable()\n});\n\nexport const deleteSubmissionSchema = z.object({\n  submission_id: z.coerce.number().gte(1),\n  submission_name: z.string().min(1).max(SUBMISSION_NAME_MAX_LENGTH)\n});\n\nexport const editSubmissionSchema = z.object({\n  submission_id: z.coerce.number().gte(1),\n  submission_title: z\n    .string()\n    .min(1, 'Title is required')\n    .max(255, 'Title must be 255 characters or less'),\n  submission_name: z\n    .string()\n    .min(1, 'Submission name is required')\n    .max(SUBMISSION_NAME_MAX_LENGTH),\n  tags: z.array(z.string()).optional()\n});\n\nexport type Submission = z.infer<typeof submissionSchema>;\nexport type CreateSubmission = z.infer<typeof submissionSchema>;\nexport type DeleteSubmission = z.infer<typeof deleteSubmissionSchema>;\nexport type EditSubmission = z.infer<typeof editSubmissionSchema>;\n\n/**\n * CREATE Submission Schema Parser\n */\nexport function parseSubmission({\n  submission_datetime,\n  submission_name,\n  submission_title,\n  tags,\n  thread_parent_id\n}: Partial<CreateSubmission>) {\n  return submissionSchema.safeParse({\n    submission_name: submission_name?.toString().trim(),\n    submission_title: submission_title?.toString().trim(),\n    submission_datetime,\n    tags,\n    thread_parent_id: thread_parent_id ? Number(thread_parent_id) : null\n  });\n}\n\n/**\n * DELETE Submission Schema Parser\n */\nexport function parseDeleteSubmission({\n  submission_id,\n  submission_name\n}: Partial<DeleteSubmission>) {\n  return deleteSubmissionSchema.safeParse({\n    submission_id,\n    submission_name\n  });\n}\n\n/**\n * EDIT Submission Schema Parser\n */\nexport function parseEditSubmission({\n  submission_id,\n  submission_title,\n  submission_name,\n  tags\n}: Partial<EditSubmission>) {\n  return editSubmissionSchema.safeParse({\n    submission_id,\n    submission_title: submission_title?.toString().trim(),\n    submission_name: submission_name?.toString().trim(),\n    tags\n  });\n}\n\n/**\n * Zod Error Parser\n * @returns a string containing any/all errors\n */\nexport function parseZodErrors(error: ZodError): string {\n  const errors: string[] = [];\n  const flat = error.flatten();\n\n  const getLabelByKey = (key: string) => {\n    if (key === 'submission_name') {\n      return 'post message';\n    }\n    if (key === 'submission_title') {\n      return 'title';\n    }\n    if (key === 'thread_parent_id') {\n      return 'parent thread';\n    }\n    return key;\n  };\n\n  Object.entries(flat.fieldErrors).forEach(([k, v]) => {\n    errors.push(`${getLabelByKey(k)}: ${v?.join('\\\\n')}`);\n  });\n\n  return errors.join('\\\\n');\n}\n\nexport const submissionFormSchema = z.object({\n  submission_title: z\n    .string()\n    .min(1, 'Title is required')\n    .max(255, 'Title must be 255 characters or less'),\n  submission_name: z.string().min(1, 'Submission name is required'),\n  tags: z.array(z.string()).optional()\n});\n\nexport type SubmissionForm = z.infer<typeof submissionFormSchema>;\n",
    "language":"typescript",
    "lines":132,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/actions.ts":{
    "content":"/* eslint-disable no-console */\n'use server';\nimport { revalidatePath } from 'next/cache';\nimport { CustomSession } from '../../../auth.config';\nimport { auth } from '../../../lib/auth';\nimport sql from '../../../lib/db';\nimport { getEffectiveCharacterCount } from '../../../lib/utils/string';\nimport {\n  extractTagsFromText,\n  parseTagsInput,\n  validateTagsInput\n} from '../../../lib/utils/string/tag-regex';\nimport {\n  parseDeleteSubmission,\n  parseEditSubmission,\n  parseZodErrors\n} from './schema';\n\n/**\n * Form validation action for create submission form\n */\nasync function validateCreateSubmissionForm(formData: FormData) {\n  const submissionTitle =\n    formData.get('submission_title')?.toString().trim() || '';\n  const submissionContent =\n    formData.get('submission_content')?.toString().trim() || '';\n  const tagsString = formData.get('submission_tags')?.toString().trim() || '';\n\n  // Use content as submission_name (description), fallback to title if empty\n  const submissionName = submissionContent || submissionTitle;\n\n  const submissionDatetime = new Date();\n  const session = await auth();\n\n  if (session && session.user?.name) {\n    // Basic validation - check required fields\n    if (!submissionTitle.trim()) {\n      return { errors: 'Title is required' };\n    }\n\n    // Validate title length\n    if (getEffectiveCharacterCount(submissionTitle) > 255) {\n      return { errors: 'Title must be 255 characters or less' };\n    }\n\n    // Validate content length\n    if (getEffectiveCharacterCount(submissionContent) > 1000) {\n      return { errors: 'Content must be 1000 characters or less' };\n    }\n\n    // Validate tags format\n    const tagValidationErrors = validateTagsInput(tagsString);\n    if (tagValidationErrors.length > 0) {\n      return { errors: tagValidationErrors.join(', ') };\n    }\n\n    return {\n      data: {\n        submission_title: submissionTitle,\n        submission_name: submissionName,\n        submission_content: submissionContent,\n        submission_datetime: submissionDatetime,\n        author: session.user.name,\n        tags: parseTagsInput(tagsString)\n      }\n    };\n  }\n\n  return { errors: 'Session error. Please login again.' };\n}\n\n/**\n * Form validation action exposed to client\n */\nexport async function validateCreateSubmissionFormAction(\n  prevState: { status: number; message?: string; error?: string },\n  formData: FormData\n): Promise<{ status: number; message?: string; error?: string }> {\n  const result = await validateCreateSubmissionForm(formData);\n\n  if (result.errors) {\n    return { status: -1, error: result.errors };\n  }\n\n  return { status: 0, message: '' };\n}\n\n/**\n * CREATE new submission action\n * performs SQL\n */\nexport async function createSubmissionAction(\n  prevState: {\n    status: number;\n    message?: string;\n    error?: string;\n  },\n  formData: FormData\n): Promise<{\n  status: number;\n  message?: string;\n  error?: string;\n  submission?: any;\n}> {\n  const { data, errors } = await validateCreateSubmissionForm(formData);\n  const session = (await auth()) as CustomSession;\n\n  // console.log('\ud83d\udd0d createSubmissionAction - Session:', session);\n  // console.log('\ud83d\udd0d createSubmissionAction - User:', session?.user);\n  // console.log('\ud83d\udd0d createSubmissionAction - User ID:', session?.user?.id);\n\n  if (!data) {\n    return { status: -1, error: errors };\n  }\n\n  // Authentication check - session must have user name and internal database ID\n  if (!session || !session?.user?.name || !session.user.id) {\n    // console.log('\u274c createSubmissionAction - Authentication failed');\n    // console.log('\u274c Session exists:', !!session);\n    // console.log('\u274c User name:', session?.user?.name);\n    // console.log('\u274c User ID:', session?.user?.id);\n    return { status: -1, error: 'Authentication error.' };\n  }\n\n  // console.log('\u2705 createSubmissionAction - Authentication passed');\n\n  // Extract tags from title and content (these come without # prefix)\n  const titleTags = extractTagsFromText(data.submission_title);\n  const contentTags = extractTagsFromText(data.submission_content || '');\n  const explicitTags = data.tags || [];\n\n  // Ensure all tags are normalized (without # prefix)\n  const normalizedTitleTags = titleTags.map((tag) =>\n    tag.startsWith('#') ? tag.slice(1) : tag\n  );\n  const normalizedContentTags = contentTags.map((tag) =>\n    tag.startsWith('#') ? tag.slice(1) : tag\n  );\n  const normalizedExplicitTags = explicitTags.map((tag) =>\n    tag.startsWith('#') ? tag.slice(1) : tag\n  );\n\n  // Combine all tags and remove duplicates\n  const allTags = [\n    ...new Set([\n      ...normalizedTitleTags,\n      ...normalizedContentTags,\n      ...normalizedExplicitTags\n    ])\n  ];\n\n  const threadParentId = formData.get('thread_parent_id');\n\n  // console.log(\n  //   '\ud83d\udd0d createSubmissionAction - About to insert with user ID:',\n  //   session?.user.id\n  // );\n\n  try {\n    // Use the internal database ID from the session as the primary identifier\n    const userId = parseInt(session?.user.id || '');\n\n    if (!userId || isNaN(userId)) {\n      console.error(\n        '\u274c createSubmissionAction - Invalid user ID in session:',\n        session?.user.id\n      );\n      return {\n        status: -1,\n        error: 'Invalid user session. Please sign out and sign back in.'\n      };\n    }\n\n    // Verify the user exists in our database (security check)\n    const userExists = await sql`\n      SELECT u.id, u.name\n      FROM users u \n      WHERE u.id = ${userId}\n      LIMIT 1\n    `;\n\n    if (userExists.length === 0) {\n      console.error(\n        '\u274c createSubmissionAction - User not found in database for internal ID:',\n        userId\n      );\n      return {\n        status: -1,\n        error: 'User account not found. Please sign out and sign back in.'\n      };\n    }\n\n    const user = userExists[0];\n    // console.log('\u2705 createSubmissionAction - Verified user:', {\n    //   id: user.id,\n    //   name: user.name\n    // });\n\n    const result = await sql`\n      INSERT INTO submissions (\n        submission_name, \n        submission_title, \n        submission_datetime, \n        user_id, \n        tags, \n        thread_parent_id\n      )\n      VALUES (\n        ${data.submission_name},\n        ${data.submission_title},\n        ${data.submission_datetime},\n        ${userId},\n        ${allTags},\n        ${threadParentId ? parseInt(threadParentId as string) : null}\n      )\n      RETURNING *;\n    `;\n\n    // Get the newly created submission\n    const newSubmission = result[0];\n\n    revalidatePath('/');\n    return {\n      status: 1,\n      message: `Added post: ${data.submission_title}.`,\n      submission: newSubmission\n    };\n  } catch (e) {\n    console.error('\u274c createSubmissionAction - SQL Error:', e);\n    return { status: -1, error: `Failed to create post.` };\n  }\n}\n\n/**\n * DELETE submission action\n * performs SQL\n */\nexport async function deleteSubmissionAction(\n  prevState: {\n    status: number;\n    message?: string;\n    error?: string;\n  },\n  formData: FormData\n) {\n  const session = (await auth()) as CustomSession | null;\n\n  if (!session || !session.user?.id) {\n    return { status: -1, error: 'Authentication error.' };\n  }\n\n  const userId = parseInt(session.user.id);\n  if (!userId || isNaN(userId)) {\n    return { status: -1, error: 'Invalid user session.' };\n  }\n\n  const { success, data, error } = parseDeleteSubmission({\n    submission_id: Number.parseInt(formData.get('submission_id') as string),\n    submission_name: formData.get('submission_name') as string\n  });\n\n  if (!success) {\n    return { status: -1, error: parseZodErrors(error) };\n  }\n\n  const sqlSubmissionId = data.submission_id!.toString();\n\n  try {\n    // First, check if this post has any replies\n    const replyCheck = await sql`\n      SELECT COUNT(*) as reply_count \n      FROM submissions \n      WHERE thread_parent_id = ${sqlSubmissionId}\n    `;\n\n    const replyCount = Number(replyCheck[0]?.reply_count || 0);\n\n    if (replyCount > 0) {\n      const replyText = replyCount === 1 ? 'reply' : 'replies';\n      const errorMessage =\n        `Cannot delete this post because it has ${replyCount} ${replyText}. ` +\n        `Delete the ${replyText} first to delete this post.`;\n      return {\n        status: -1,\n        error: errorMessage\n      };\n    }\n\n    // Check if the post exists and belongs to the user\n    const submissionCheck = await sql`\n      SELECT submission_id, submission_title \n      FROM submissions \n      WHERE submission_id = ${sqlSubmissionId}\n      AND user_id = ${userId}\n    `;\n\n    if (submissionCheck.length === 0) {\n      return {\n        status: -1,\n        error: 'Post not found or you do not have permission to delete it.'\n      };\n    }\n\n    // Now safe to delete\n    await sql`\n      DELETE FROM submissions\n      WHERE submission_id = ${sqlSubmissionId}\n      AND user_id = ${userId}\n    `;\n\n    revalidatePath('/');\n    return {\n      status: 1,\n      message: `Deleted post \\\"${submissionCheck[0].submission_title}\\\".`\n    };\n  } catch (e) {\n    console.error('Delete submission error:', e);\n    return { status: -1, error: `Failed to delete post.` };\n  }\n}\n\n/**\n * EDIT submission action\n * performs SQL\n */\nexport async function editSubmissionAction(\n  prevState: {\n    status: number;\n    message?: string;\n    error?: string;\n  },\n  formData: FormData\n): Promise<{\n  status: number;\n  message?: string;\n  error?: string;\n  submission?: any;\n}> {\n  const session = (await auth()) as CustomSession | null;\n\n  if (!session || !session.user?.id) {\n    return { status: -1, error: 'Authentication error.' };\n  }\n\n  const userId = parseInt(session.user.id);\n  if (!userId || isNaN(userId)) {\n    return { status: -1, error: 'Invalid user session.' };\n  }\n\n  const submissionId = Number.parseInt(formData.get('submission_id') as string);\n  const submissionTitle =\n    formData.get('submission_title')?.toString().trim() || '';\n  const submissionContent =\n    formData.get('submission_content')?.toString().trim() || '';\n  const tagsString = formData.get('submission_tags')?.toString().trim() || '';\n\n  // Use content as submission_name, fallback to title if empty\n  const submissionName = submissionContent || submissionTitle;\n\n  // Validate title length\n  if (getEffectiveCharacterCount(submissionTitle) > 255) {\n    return { status: -1, error: 'Title must be 255 characters or less' };\n  }\n\n  // Validate content length\n  if (getEffectiveCharacterCount(submissionContent) > 1000) {\n    return { status: -1, error: 'Content must be 1000 characters or less' };\n  }\n\n  // Validate tags format\n  const tagValidationErrors = validateTagsInput(tagsString);\n  if (tagValidationErrors.length > 0) {\n    return { status: -1, error: tagValidationErrors.join(', ') };\n  }\n\n  const { success, data, error } = parseEditSubmission({\n    submission_id: submissionId,\n    submission_title: submissionTitle,\n    submission_name: submissionName,\n    tags: parseTagsInput(tagsString)\n  });\n\n  if (!success) {\n    return { status: -1, error: parseZodErrors(error) };\n  }\n\n  // Extract tags from title, content, and explicit tags\n  const titleTags = extractTagsFromText(data.submission_title);\n  const contentTags = extractTagsFromText(submissionContent);\n  const explicitTags = data.tags || [];\n\n  // Ensure all tags are normalized (without # prefix)\n  const normalizedTitleTags = titleTags.map((tag) =>\n    tag.startsWith('#') ? tag.slice(1) : tag\n  );\n  const normalizedContentTags = contentTags.map((tag) =>\n    tag.startsWith('#') ? tag.slice(1) : tag\n  );\n  const normalizedExplicitTags = explicitTags.map((tag) =>\n    tag.startsWith('#') ? tag.slice(1) : tag\n  );\n\n  // Combine all tags and remove duplicates\n  const allTags = [\n    ...new Set([\n      ...normalizedTitleTags,\n      ...normalizedContentTags,\n      ...normalizedExplicitTags\n    ])\n  ];\n\n  try {\n    const result = await sql`\n      UPDATE submissions \n      SET \n        submission_title = ${data.submission_title},\n        submission_name = ${data.submission_name},\n        tags = ${allTags}\n      WHERE submission_id = ${data.submission_id}\n      AND user_id = ${userId}\n      RETURNING *;\n    `;\n\n    if (result.length === 0) {\n      return {\n        status: -1,\n        error: 'Post not found or you do not have permission to edit it.'\n      };\n    }\n\n    revalidatePath('/');\n    return {\n      status: 1,\n      message: `Updated post: ${data.submission_title}.`,\n      submission: result[0]\n    };\n  } catch (e) {\n    console.error(e);\n    return { status: -1, error: `Failed to update post.` };\n  }\n}\n\n/**\n * Check if a submission can be deleted\n * Used by UI components to show/hide delete options\n */\nexport async function canDeleteSubmission(\n  submissionId: number,\n  authorId: string\n): Promise<{\n  canDelete: boolean;\n  reason?: string;\n  replyCount?: number;\n}> {\n  try {\n    // Check if post has replies\n    const replyCheck = await sql`\n      SELECT COUNT(*) as reply_count \n      FROM submissions \n      WHERE thread_parent_id = ${submissionId.toString()}\n    `;\n\n    const replyCount = Number(replyCheck[0]?.reply_count || 0);\n\n    if (replyCount > 0) {\n      const replyText = replyCount === 1 ? 'reply' : 'replies';\n      return {\n        canDelete: false,\n        reason: `This post has ${replyCount} ${replyText} and cannot be deleted until all ${replyText} are removed.`,\n        replyCount\n      };\n    }\n\n    // Check if post exists and user owns it\n    const submissionCheck = await sql`\n      SELECT submission_id \n      FROM submissions \n      WHERE submission_id = ${submissionId.toString()}\n      AND user_id = ${parseInt(authorId)}\n    `;\n\n    if (submissionCheck.length === 0) {\n      return {\n        canDelete: false,\n        reason: 'Post not found or you do not have permission to delete it.'\n      };\n    }\n\n    return { canDelete: true };\n  } catch (e) {\n    console.error('Error checking delete permission:', e);\n    return {\n      canDelete: false,\n      reason: 'Unable to verify delete permissions.'\n    };\n  }\n}\n",
    "language":"typescript",
    "lines":498,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submission-forms/actions.test.ts":{
    "content":"import '@testing-library/jest-dom';\nimport { revalidatePath } from 'next/cache';\nimport { auth } from '../../../lib/auth';\nimport sql from '../../../lib/db';\nimport {\n  createSubmissionAction,\n  deleteSubmissionAction,\n  validateCreateSubmissionFormAction\n} from './actions';\n\n// Mock dependencies\njest.mock('../../../lib/auth', () => ({\n  auth: jest.fn()\n}));\n\njest.mock('../../../lib/db', () => ({\n  __esModule: true,\n  default: jest.fn()\n}));\n\njest.mock('next/cache', () => ({\n  revalidatePath: jest.fn()\n}));\n\n// Add this at the top of the file, after imports\nconst originalConsoleError = console.error;\nlet consoleErrorSpy: jest.SpyInstance;\n\ndescribe('Submission Form Actions', () => {\n  /**\n   * The functions we're testing might produce console.error messages.\n   * Since we want to test all possible scenarios (100% coverage),\n   * we need to prevent these error messages from appearing in our test output.\n   * This helps avoid confusion when running the tests.\n   */\n  beforeAll(() => {\n    consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {});\n  });\n\n  afterAll(() => {\n    consoleErrorSpy.mockRestore();\n    console.error = originalConsoleError;\n  });\n\n  afterEach(() => {\n    consoleErrorSpy.mockClear();\n  });\n\n  beforeEach(() => {\n    jest.resetAllMocks();\n  });\n\n  describe('validateCreateSubmissionFormAction', () => {\n    it('should return an error for invalid input', async () => {\n      const formData = new FormData();\n      formData.append('submission_name', '');\n\n      const result = await validateCreateSubmissionFormAction(\n        { status: 0 },\n        formData\n      );\n\n      expect(result.error).toBeDefined();\n    });\n\n    it('should return a success message for valid input', async () => {\n      (auth as jest.Mock).mockResolvedValue({ user: { name: 'Test User' } });\n\n      const formData = new FormData();\n      formData.append('submission_title', 'Valid Title');\n      formData.append('submission_name', 'Valid Submission');\n\n      const result = await validateCreateSubmissionFormAction(\n        { status: 0 },\n        formData\n      );\n\n      expect(result.status).toBe(0);\n      expect(result.message).toBe('');\n    });\n\n    it('should return an error for missing session', async () => {\n      (auth as jest.Mock).mockResolvedValue(null);\n\n      const formData = new FormData();\n      formData.append('submission_title', 'Valid Title');\n      formData.append('submission_name', 'Valid Submission');\n\n      const result = await validateCreateSubmissionFormAction(\n        { status: 0 },\n        formData\n      );\n\n      expect(result.error).toBe('Session error. Please login again.');\n    });\n\n    it('returns an error when session or user name is missing', async () => {\n      (auth as jest.Mock).mockResolvedValue(null);\n\n      const formData = new FormData();\n      formData.append('submission_title', 'Test Title');\n      formData.append('submission_name', 'Test Submission');\n      formData.append('submission_tags', 'tag1,tag2');\n\n      const result = await validateCreateSubmissionFormAction(\n        { status: 0 },\n        formData\n      );\n\n      expect(result.error).toBe('Session error. Please login again.');\n    });\n\n    it('should handle form data with tags', async () => {\n      (auth as jest.Mock).mockResolvedValue({ user: { name: 'Test User' } });\n\n      const formData = new FormData();\n      formData.append('submission_title', 'Valid Title');\n      formData.append('submission_content', 'Valid Submission Content');\n      formData.append('submission_tags', '#tag1,#tag2');\n\n      const result = await validateCreateSubmissionFormAction(\n        { status: 0 },\n        formData\n      );\n\n      expect(result.status).toBe(0);\n      expect(result.message).toBe('');\n    });\n  });\n\n  describe('createSubmissionAction', () => {\n    it('should create a submission successfully', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { name: 'Test User', id: '123' }\n      });\n      // Mock the user lookup first, then successful insert\n      const mockSql = jest\n        .fn()\n        .mockResolvedValueOnce([{ id: 123, name: 'Test User' }]) // User lookup\n        .mockResolvedValueOnce({ rowCount: 1 }); // Insert submission\n      (sql as unknown as jest.Mock).mockImplementation(mockSql);\n\n      const formData = new FormData();\n      formData.append('submission_title', 'New Title');\n      formData.append('submission_name', 'New Submission');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(1);\n      expect(result.message).toContain('Added post');\n      expect(revalidatePath).toHaveBeenCalledWith('/');\n    });\n\n    it('should return an error for invalid input', async () => {\n      const formData = new FormData();\n      formData.append('submission_title', ''); // Empty title should fail validation\n      formData.append('submission_name', '');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBeDefined();\n    });\n\n    it('should return an error for missing session', async () => {\n      (auth as jest.Mock).mockResolvedValue(null);\n\n      const formData = new FormData();\n      formData.append('submission_title', 'New Title');\n      formData.append('submission_name', 'New Submission');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBe('Session error. Please login again.');\n    });\n\n    it('should return an error when SQL insert fails', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { name: 'Test User', id: '123' }\n      });\n      (sql as unknown as jest.Mock).mockRejectedValue(new Error('SQL error'));\n\n      const formData = new FormData();\n      formData.append('submission_title', 'New Title');\n      formData.append('submission_name', 'New Submission');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBe('Failed to create post.');\n    });\n\n    it('should extract tags from submission title', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { name: 'Test User', id: '123' }\n      });\n      // Mock the user lookup query first\n      const mockSql = jest\n        .fn()\n        .mockResolvedValueOnce([{ id: 123, name: 'Test User' }]) // User lookup\n        .mockResolvedValueOnce({ rowCount: 1 }); // Insert submission\n      (sql as unknown as jest.Mock).mockImplementation(mockSql);\n\n      const formData = new FormData();\n      formData.append('submission_title', 'New Title #tag1 #tag2');\n      formData.append('submission_name', 'New Submission');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(mockSql).toHaveBeenCalledTimes(2);\n      // Check the second call (insert submission) contains the insert query (case insensitive)\n      const insertCall = mockSql.mock.calls[1];\n      expect(insertCall[0][0].toLowerCase()).toContain(\n        'insert into submissions'\n      );\n      // Check that tags were extracted from title - they should be in the SQL parameters array\n      const allParams = insertCall.slice(1); // Skip the query string\n      const tagsParam = allParams.find(\n        (param: any) => Array.isArray(param) && param.length === 2\n      );\n      expect(tagsParam).toEqual(['tag1', 'tag2']); // tags are normalized without # prefix\n    });\n\n    it('should handle submission without tags', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { name: 'Test User', id: '123' }\n      });\n      // Mock the user lookup query first, then successful insert\n      const mockSql = jest\n        .fn()\n        .mockResolvedValueOnce([{ id: 123, name: 'Test User' }]) // User lookup\n        .mockResolvedValueOnce({ rowCount: 1 }); // Insert submission\n      (sql as unknown as jest.Mock).mockImplementation(mockSql);\n\n      const formData = new FormData();\n      formData.append('submission_title', 'New Title without tags');\n      formData.append('submission_name', 'New Submission without tags');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(1);\n      expect(result.message).toContain('Added post');\n\n      // Split assertions for mockSql arguments\n      expect(mockSql).toHaveBeenCalledTimes(2);\n      const insertCall = mockSql.mock.calls[1];\n      expect(insertCall[0][0].toLowerCase()).toContain(\n        'insert into submissions'\n      );\n      // Check for empty tags array in the parameters\n      const allParams = insertCall.slice(1);\n      const tagsParam = allParams.find((param: any) => Array.isArray(param));\n      expect(tagsParam).toEqual([]); // tags should be empty array\n\n      expect(revalidatePath).toHaveBeenCalledWith('/');\n    });\n\n    it('should return an error when session or user information is incomplete', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { name: 'Test User' } // Missing id\n      });\n\n      const formData = new FormData();\n      formData.append('submission_title', 'New Title');\n      formData.append('submission_name', 'New Submission');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBe('Authentication error.');\n    });\n\n    it('should return an error when session is present but id is missing', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { name: 'Test User' } // Missing id\n      });\n\n      const formData = new FormData();\n      formData.append('submission_title', 'New Title');\n      formData.append('submission_name', 'New Submission');\n\n      const result = await createSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBe('Authentication error.');\n    });\n  });\n\n  describe('deleteSubmissionAction', () => {\n    it('should delete a submission successfully', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { id: '123' }\n      });\n\n      // Mock the SQL calls for delete action\n      (sql as unknown as jest.Mock)\n        .mockResolvedValueOnce([{ reply_count: 0 }]) // Reply check query\n        .mockResolvedValueOnce([\n          { submission_id: 1, submission_title: 'Test Submission' }\n        ]) // Submission check query\n        .mockResolvedValueOnce({}); // Delete query\n\n      const formData = new FormData();\n      formData.append('submission_id', '1');\n      formData.append('submission_name', 'Test Submission');\n\n      const result = await deleteSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(1);\n      expect(result.message).toContain('Deleted post');\n      // expect(revalidatePath).toHaveBeenCalledWith('/');\n    });\n\n    it('should return an error for invalid input', async () => {\n      const formData = new FormData();\n      formData.append('submission_id', 'invalid');\n\n      const result = await deleteSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBeDefined();\n    });\n\n    it('should return an error when SQL delete fails', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { id: '123' }\n      });\n      (sql as unknown as jest.Mock).mockRejectedValue(new Error('SQL error'));\n\n      const formData = new FormData();\n      formData.append('submission_id', '1');\n      formData.append('submission_name', 'Test Submission');\n\n      const result = await deleteSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBe('Failed to delete post.');\n    });\n\n    it('should return an error for missing session', async () => {\n      (auth as jest.Mock).mockResolvedValue(null);\n\n      const formData = new FormData();\n      formData.append('submission_id', '1');\n      formData.append('submission_name', 'Test Submission');\n\n      const result = await deleteSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBeDefined();\n    });\n\n    it('should return an error when session is present but id is missing', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { name: 'Test User' } // Missing id\n      });\n\n      const formData = new FormData();\n      formData.append('submission_id', '1');\n      formData.append('submission_name', 'Test Submission');\n\n      const result = await deleteSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBe('Authentication error.');\n    });\n\n    it('should return an error when parseDeleteSubmission fails', async () => {\n      (auth as jest.Mock).mockResolvedValue({\n        user: { id: '123' }\n      });\n\n      const formData = new FormData();\n      // Omit submission_id to cause parseDeleteSubmission to fail\n      formData.append('submission_name', 'Test Submission');\n\n      const result = await deleteSubmissionAction({ status: 0 }, formData);\n\n      expect(result.status).toBe(-1);\n      expect(result.error).toBeDefined();\n      expect(result.error).toContain('submission_id');\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":386,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/actions.ts":{
    "content":"'use server';\n\nimport sql from '../../../lib/db';\n\nexport interface SubmissionWithReplies {\n  submission_id: number;\n  submission_name: string;\n  submission_title: string;\n  submission_datetime: Date | null;\n  user_id: number;\n  author: string;\n  author_bio?: string;\n  tags: string[];\n  thread_parent_id: number | null;\n  replies?: SubmissionWithReplies[];\n}\n\nexport type GetSubmissionsActionArguments = {\n  onlyMine: boolean;\n  userId?: string; // Internal database user ID only\n  filters?: { name: string; value: string }[];\n  page?: number;\n  pageSize?: number;\n  includeThreadReplies?: boolean;\n};\n\nexport type GetSubmissionsActionResponse = {\n  data?: {\n    data: SubmissionWithReplies[];\n    pagination: {\n      currentPage: number;\n      pageSize: number;\n      totalRecords: number;\n    };\n  };\n  error?: string;\n};\n\nexport interface GetSubmissionsPaginationCountResponse {\n  data?: {\n    totalRecords: number;\n    expectedItems: number; // Items expected for current page size\n  };\n  error?: string;\n}\n\n// Helper function to extract user IDs from author filter values\nfunction extractUserIdsFromAuthorFilters(authors: string[]): number[] {\n  return authors\n    .map((author) => {\n      // Handle username|userId format\n      if (author.includes('|')) {\n        const [, userId] = author.split('|');\n        return parseInt(userId);\n      }\n      // Handle legacy numeric-only format\n      return parseInt(author);\n    })\n    .filter((authorId) => !isNaN(authorId) && authorId > 0);\n}\n\n// Helper function to parse search terms with proper phrase vs word handling\nfunction parseSearchTermsForDatabase(searchValue: string): Array<{\n  term: string;\n  isPhrase: boolean;\n}> {\n  const results: Array<{ term: string; isPhrase: boolean }> = [];\n  const regex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n  let match;\n\n  while ((match = regex.exec(searchValue)) !== null) {\n    const quotedTerm = match[1]; // Phrase search (exact phrase)\n    const unquotedTerm = match[2]; // Word search (individual word)\n    \n    if (quotedTerm && quotedTerm.length >= 2) {\n      // Quoted phrase - search for exact phrase\n      results.push({ term: quotedTerm.toLowerCase(), isPhrase: true });\n    } else if (unquotedTerm && unquotedTerm.length >= 2) {\n      // Individual word\n      results.push({ term: unquotedTerm.toLowerCase(), isPhrase: false });\n    }\n  }\n\n  return results;\n}\n\n/**\n * Pre-request to get pagination count for skeleton loader optimization\n * This allows us to show the exact number of skeleton items that will be loaded\n */\nexport async function getSubmissionsPaginationCount({\n  onlyMine,\n  userId,\n  filters = [],\n  pageSize = 10,\n  includeThreadReplies = false\n}: Omit<\n  GetSubmissionsActionArguments,\n  'page'\n>): Promise<GetSubmissionsPaginationCountResponse> {\n  if (onlyMine && !userId) {\n    return {\n      error: 'User ID is required for user-specific queries'\n    };\n  }\n\n  const userIdNum = userId ? parseInt(userId) : null;\n\n  try {\n    let whereClause = 'WHERE 1=1';\n    const queryParams: any[] = [];\n    let paramIndex = 1;\n\n    // Check if onlyReplies filter is active\n    const onlyRepliesFilter = filters.find((f) => f.name === 'onlyReplies');\n    const isOnlyReplies = onlyRepliesFilter?.value === 'true';\n\n    // Handle thread replies filter - but skip if onlyReplies is active\n    if (!includeThreadReplies && !isOnlyReplies) {\n      whereClause += ` AND s.thread_parent_id IS NULL`;\n    }\n\n    // Handle user filter (only mine)\n    if (onlyMine && userIdNum) {\n      whereClause += ` AND s.user_id = $${paramIndex}`;\n      queryParams.push(userIdNum);\n      paramIndex++;\n    }\n\n    // Handle dynamic filters with global logic support\n    const filterGroups: string[] = [];\n    const globalLogicFilter = filters.find((f) => f.name === 'globalLogic');\n    const globalLogic = globalLogicFilter?.value || 'AND';\n\n    // Handle multiple tag filters as a single group\n    const tagFilters = filters.filter((f) => f.name === 'tags');\n    if (tagFilters.length > 0) {\n      const tagLogicFilter = filters.find((f) => f.name === 'tagLogic');\n      const tagLogic = tagLogicFilter?.value || 'OR';\n      \n      // Each tag filter is now a separate entry, not comma-separated\n      const allTags = tagFilters.map(f => f.value.trim()).filter(Boolean);\n\n      if (allTags.length > 0) {\n        let tagGroupCondition = '';\n        \n        if (tagLogic === 'AND') {\n          // All tags must be present\n          const tagConditions: string[] = [];\n          for (const tag of allTags) {\n            tagConditions.push(`$${paramIndex} = ANY(s.tags)`);\n            queryParams.push(tag.startsWith('#') ? tag.slice(1) : tag);\n            paramIndex++;\n          }\n          tagGroupCondition = tagConditions.join(' AND ');\n        } else {\n          // Any tag can be present (OR logic)\n          const tagPlaceholders = allTags\n            .map(() => `$${paramIndex++}`)\n            .join(',');\n          tagGroupCondition = `s.tags && ARRAY[${tagPlaceholders}]`;\n          queryParams.push(\n            ...allTags.map((tag) => (tag.startsWith('#') ? tag.slice(1) : tag))\n          );\n        }\n\n        if (tagGroupCondition) {\n          filterGroups.push(`(${tagGroupCondition})`);\n        }\n      }\n    }\n\n    // Process other filters - collect multiple entries of same type\n    const authorFilters = filters.filter((f) => f.name === 'author');\n    const mentionFilters = filters.filter((f) => f.name === 'mentions');\n    const searchFilters = filters.filter((f) => f.name === 'search');\n    \n    // Handle author filters\n    if (authorFilters.length > 0) {\n      const authors = authorFilters.map((f) => f.value.trim()).filter(Boolean);\n      \n      if (authors.length > 0) {\n        const authorLogicFilter = filters.find((f) => f.name === 'authorLogic');\n        const authorLogic = globalLogic === 'AND' ? 'AND' : authorLogicFilter?.value || 'OR';\n\n        // Extract user IDs from username|userId format\n        const validAuthorIds = extractUserIdsFromAuthorFilters(authors);\n\n        if (validAuthorIds.length > 0) {\n          const groupCondition = `s.user_id IN (${validAuthorIds.map(() => `$${paramIndex++}`).join(',')})`;\n          queryParams.push(...validAuthorIds);\n          \n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n        }\n      }\n    }\n\n    // Handle mention filters\n    if (mentionFilters.length > 0) {\n      const mentions = mentionFilters.map((f) => f.value.trim()).filter(Boolean);\n      \n      if (mentions.length > 0) {\n        const mentionsLogicFilter = filters.find((f) => f.name === 'mentionsLogic');\n        const mentionsLogic = globalLogic === 'AND' ? 'AND' : mentionsLogicFilter?.value || 'OR';\n\n        if (mentionsLogic === 'AND') {\n          // All mentions must be present\n          const mentionConditions: string[] = [];\n          for (const mention of mentions) {\n            const username = mention.includes('|') ? mention.split('|')[0] : mention;\n            mentionConditions.push(\n              `(s.submission_name ILIKE $${paramIndex} OR s.submission_title ILIKE $${paramIndex})`\n            );\n            queryParams.push(`%${username}%`);\n            paramIndex++;\n          }\n          const groupCondition = mentionConditions.join(' AND ');\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n        } else {\n          // Any mention can be present (OR logic)\n          const mentionConditions = mentions.map((mention) => {\n            const username = mention.includes('|') ? mention.split('|')[0] : mention;\n            const condition = `(s.submission_name ILIKE $${paramIndex} OR s.submission_title ILIKE $${paramIndex})`;\n            queryParams.push(`%${username}%`);\n            paramIndex++;\n            return condition;\n          });\n          const groupCondition = mentionConditions.join(' OR ');\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n        }\n      }\n    }\n\n    // Handle search filters\n    if (searchFilters.length > 0) {\n      const searchValues = searchFilters.map((f) => f.value.trim()).filter((v) => v.length >= 2);\n      \n      if (searchValues.length > 0) {\n        const searchLogicFilter = filters.find((f) => f.name === 'searchLogic');\n        const searchLogic = globalLogic === 'AND' ? 'AND' : searchLogicFilter?.value || 'OR';\n\n        const allSearchConditions: string[] = [];\n        \n        for (const searchValue of searchValues) {\n          // Parse search with quote support\n          const terms: string[] = [];\n          const regex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n          let match;\n\n          while ((match = regex.exec(searchValue)) !== null) {\n            const quotedTerm = match[1];\n            const unquotedTerm = match[2];\n            const term = quotedTerm || unquotedTerm;\n            if (term && term.length >= 2) {\n              terms.push(term.toLowerCase());\n            }\n          }\n\n          if (terms.length > 0) {\n            const searchConditions = terms.map((term) => {\n              const condition = `(\n                LOWER(s.submission_name) LIKE $${paramIndex} OR \n                LOWER(s.submission_title) LIKE $${paramIndex}\n              )`;\n              queryParams.push(`%${term}%`);\n              paramIndex++;\n              return condition;\n            });\n            \n            const termOperator = searchLogic === 'AND' ? ' AND ' : ' OR ';\n            allSearchConditions.push(`(${searchConditions.join(termOperator)})`);\n          }\n        }\n        \n        if (allSearchConditions.length > 0) {\n          const searchOperator = searchLogic === 'AND' ? ' AND ' : ' OR ';\n          const groupCondition = allSearchConditions.join(searchOperator);\n          filterGroups.push(`(${groupCondition})`);\n        }\n      }\n    }\n\n    // Handle remaining single-value filters\n    for (const filter of filters) {\n      let groupCondition = '';\n\n      switch (filter.name) {\n        case 'tags':\n        case 'author':\n        case 'mentions':\n        case 'search':\n          // Skip - already handled above\n          break;\n          \n        case 'content': {\n          groupCondition = `(s.submission_title ILIKE $${paramIndex} OR s.submission_name ILIKE $${paramIndex})`;\n          queryParams.push(`%${filter.value}%`);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'title': {\n          groupCondition = `s.submission_title ILIKE $${paramIndex}`;\n          queryParams.push(`%${filter.value}%`);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'url': {\n          groupCondition = `s.submission_url ILIKE $${paramIndex}`;\n          queryParams.push(`%${filter.value}%`);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'dateFrom': {\n          groupCondition = `s.submission_datetime >= $${paramIndex}`;\n          queryParams.push(filter.value);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'dateTo': {\n          groupCondition = `s.submission_datetime <= $${paramIndex}`;\n          queryParams.push(filter.value);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'onlyReplies': {\n          // Filter to show only replies (posts with thread_parent_id)\n          if (filter.value === 'true') {\n            groupCondition = `s.thread_parent_id IS NOT NULL`;\n            if (groupCondition) {\n              filterGroups.push(`(${groupCondition})`);\n            }\n          }\n          break;\n        }\n\n        case 'onlyReplies': {\n          // Filter to show only replies (posts with thread_parent_id)\n          if (filter.value === 'true') {\n            groupCondition = `s.thread_parent_id IS NOT NULL`;\n            if (groupCondition) {\n              filterGroups.push(`(${groupCondition})`);\n            }\n          }\n          break;\n        }\n\n        // Skip logic filters as they're handled above\n        case 'tagLogic':\n        case 'authorLogic':\n        case 'mentionsLogic':\n        case 'searchLogic':\n        case 'globalLogic':\n          break;\n      }\n    }\n\n    // Apply global logic to combine filter groups\n    if (filterGroups.length > 0) {\n      const globalOperator = globalLogic === 'OR' ? ' OR ' : ' AND ';\n      whereClause += ` AND (${filterGroups.join(globalOperator)})`;\n    }\n\n    // Count total records\n    const countQuery = `\n      SELECT COUNT(*) as total\n      FROM submissions s\n      JOIN users u ON s.user_id = u.id\n      ${whereClause}\n    `;\n\n    const countResult = await sql.unsafe(countQuery, queryParams);\n    const totalRecords = parseInt(countResult[0]?.total || '0');\n\n    // Debug logging for pagination count\n    // eslint-disable-next-line no-console\n    console.log('Pagination count debug:', {\n      isOnlyReplies,\n      includeThreadReplies,\n      totalRecords,\n      whereClause,\n      queryParams\n    });\n\n    // Calculate expected items for current page (will be pageSize or less if on last page)\n    const expectedItems = Math.min(totalRecords, pageSize);\n\n    return {\n      data: {\n        totalRecords,\n        expectedItems\n      }\n    };\n  } catch (error) {\n    console.error('getSubmissionsPaginationCount error:', error);\n    return {\n      error: 'Failed to fetch pagination count'\n    };\n  }\n}\n\nexport async function getSubmissionsAction({\n  onlyMine,\n  userId,\n  filters = [],\n  page = 1,\n  pageSize = 10,\n  includeThreadReplies = false\n}: GetSubmissionsActionArguments): Promise<GetSubmissionsActionResponse> {\n  if (onlyMine && !userId) {\n    return {\n      error: 'User ID is required for user-specific queries'\n    };\n  }\n\n  const userIdNum = userId ? parseInt(userId) : null;\n\n  try {\n    let whereClause = 'WHERE 1=1';\n    const queryParams: any[] = [];\n    let paramIndex = 1;\n\n    // Check if onlyReplies filter is active\n    const onlyRepliesFilter = filters.find((f) => f.name === 'onlyReplies');\n    const isOnlyReplies = onlyRepliesFilter?.value === 'true';\n\n    // Handle thread replies filter - but skip if onlyReplies is active\n    if (!includeThreadReplies && !isOnlyReplies) {\n      whereClause += ` AND s.thread_parent_id IS NULL`;\n    }\n\n    // Handle user filter (only mine)\n    if (onlyMine && userIdNum) {\n      whereClause += ` AND s.user_id = $${paramIndex}`;\n      queryParams.push(userIdNum);\n      paramIndex++;\n    }\n\n    // Handle dynamic filters with global logic support\n    const filterGroups: string[] = [];\n    const globalLogicFilter = filters.find((f) => f.name === 'globalLogic');\n    const globalLogic = globalLogicFilter?.value || 'AND';\n\n    // Handle multiple tag filters as a single group\n    const tagFilters = filters.filter((f) => f.name === 'tags');\n    if (tagFilters.length > 0) {\n      const tagLogicFilter = filters.find((f) => f.name === 'tagLogic');\n      const tagLogic = tagLogicFilter?.value || 'OR';\n      \n      // Each tag filter is now a separate entry, not comma-separated\n      const allTags = tagFilters.map(f => f.value.trim()).filter(Boolean);\n\n      if (allTags.length > 0) {\n        let tagGroupCondition = '';\n        \n        if (tagLogic === 'AND') {\n          // All tags must be present\n          const tagConditions: string[] = [];\n          for (const tag of allTags) {\n            tagConditions.push(`$${paramIndex} = ANY(s.tags)`);\n            queryParams.push(tag.startsWith('#') ? tag.slice(1) : tag);\n            paramIndex++;\n          }\n          tagGroupCondition = tagConditions.join(' AND ');\n        } else {\n          // Any tag can be present (OR logic)\n          const tagPlaceholders = allTags\n            .map(() => `$${paramIndex++}`)\n            .join(',');\n          tagGroupCondition = `s.tags && ARRAY[${tagPlaceholders}]`;\n          queryParams.push(\n            ...allTags.map((tag) => (tag.startsWith('#') ? tag.slice(1) : tag))\n          );\n        }\n\n        if (tagGroupCondition) {\n          filterGroups.push(`(${tagGroupCondition})`);\n        }\n      }\n    }\n\n    // Process other filters - collect multiple entries of same type\n    const authorFilters = filters.filter((f) => f.name === 'author');\n    const mentionFilters = filters.filter((f) => f.name === 'mentions');\n    const searchFilters = filters.filter((f) => f.name === 'search');\n    \n    // Handle author filters\n    if (authorFilters.length > 0) {\n      const authors = authorFilters.map((f) => f.value.trim()).filter(Boolean);\n      \n      if (authors.length > 0) {\n        const authorLogicFilter = filters.find((f) => f.name === 'authorLogic');\n        const authorLogic = globalLogic === 'AND' ? 'AND' : authorLogicFilter?.value || 'OR';\n\n        // Extract user IDs from username|userId format\n        const validAuthorIds = extractUserIdsFromAuthorFilters(authors);\n\n        if (validAuthorIds.length > 0) {\n          const groupCondition = `s.user_id IN (${validAuthorIds.map(() => `$${paramIndex++}`).join(',')})`;\n          queryParams.push(...validAuthorIds);\n          \n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n        }\n      }\n    }\n\n    // Handle mention filters\n    if (mentionFilters.length > 0) {\n      const mentions = mentionFilters.map((f) => f.value.trim()).filter(Boolean);\n      \n      if (mentions.length > 0) {\n        const mentionsLogicFilter = filters.find((f) => f.name === 'mentionsLogic');\n        const mentionsLogic = globalLogic === 'AND' ? 'AND' : mentionsLogicFilter?.value || 'OR';\n\n        if (mentionsLogic === 'AND') {\n          // All mentions must be present\n          const mentionConditions: string[] = [];\n          for (const mention of mentions) {\n            const username = mention.includes('|') ? mention.split('|')[0] : mention;\n            mentionConditions.push(\n              `(s.submission_name ILIKE $${paramIndex} OR s.submission_title ILIKE $${paramIndex})`\n            );\n            queryParams.push(`%${username}%`);\n            paramIndex++;\n          }\n          const groupCondition = mentionConditions.join(' AND ');\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n        } else {\n          // Any mention can be present (OR logic)\n          const mentionConditions = mentions.map((mention) => {\n            const username = mention.includes('|') ? mention.split('|')[0] : mention;\n            const condition = `(s.submission_name ILIKE $${paramIndex} OR s.submission_title ILIKE $${paramIndex})`;\n            queryParams.push(`%${username}%`);\n            paramIndex++;\n            return condition;\n          });\n          const groupCondition = mentionConditions.join(' OR ');\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n        }\n      }\n    }\n\n    // Handle search filters\n    if (searchFilters.length > 0) {\n      const searchValues = searchFilters.map((f) => f.value.trim()).filter((v) => v.length >= 2);\n      \n      if (searchValues.length > 0) {\n        const searchLogicFilter = filters.find((f) => f.name === 'searchLogic');\n        const searchLogic = globalLogic === 'AND' ? 'AND' : searchLogicFilter?.value || 'OR';\n\n        const allSearchConditions: string[] = [];\n        \n        for (const searchValue of searchValues) {\n          // Parse search with quote support\n          const terms: string[] = [];\n          const regex = /\\\"([^\\\"]+)\\\"|(\\\\S+)/g;\n          let match;\n\n          while ((match = regex.exec(searchValue)) !== null) {\n            const quotedTerm = match[1];\n            const unquotedTerm = match[2];\n            const term = quotedTerm || unquotedTerm;\n            if (term && term.length >= 2) {\n              terms.push(term.toLowerCase());\n            }\n          }\n\n          if (terms.length > 0) {\n            const searchConditions = terms.map((term) => {\n              const condition = `(\n                LOWER(s.submission_name) LIKE $${paramIndex} OR \n                LOWER(s.submission_title) LIKE $${paramIndex}\n              )`;\n              queryParams.push(`%${term}%`);\n              paramIndex++;\n              return condition;\n            });\n            \n            const termOperator = searchLogic === 'AND' ? ' AND ' : ' OR ';\n            allSearchConditions.push(`(${searchConditions.join(termOperator)})`);\n          }\n        }\n        \n        if (allSearchConditions.length > 0) {\n          const searchOperator = searchLogic === 'AND' ? ' AND ' : ' OR ';\n          const groupCondition = allSearchConditions.join(searchOperator);\n          filterGroups.push(`(${groupCondition})`);\n        }\n      }\n    }\n\n    // Handle remaining single-value filters\n    for (const filter of filters) {\n      let groupCondition = '';\n\n      switch (filter.name) {\n        case 'tags':\n        case 'author':\n        case 'mentions':\n        case 'search':\n          // Skip - already handled above\n          break;\n          \n        case 'content': {\n          groupCondition = `(s.submission_title ILIKE $${paramIndex} OR s.submission_name ILIKE $${paramIndex})`;\n          queryParams.push(`%${filter.value}%`);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'title': {\n          groupCondition = `s.submission_title ILIKE $${paramIndex}`;\n          queryParams.push(`%${filter.value}%`);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'url': {\n          groupCondition = `s.submission_url ILIKE $${paramIndex}`;\n          queryParams.push(`%${filter.value}%`);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'dateFrom': {\n          groupCondition = `s.submission_datetime >= $${paramIndex}`;\n          queryParams.push(filter.value);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'dateTo': {\n          groupCondition = `s.submission_datetime <= $${paramIndex}`;\n          queryParams.push(filter.value);\n          paramIndex++;\n\n          if (groupCondition) {\n            filterGroups.push(`(${groupCondition})`);\n          }\n          break;\n        }\n\n        case 'onlyReplies': {\n          // Filter to show only replies (posts with thread_parent_id)\n          if (filter.value === 'true') {\n            groupCondition = `s.thread_parent_id IS NOT NULL`;\n            if (groupCondition) {\n              filterGroups.push(`(${groupCondition})`);\n            }\n          }\n          break;\n        }\n\n        case 'onlyReplies': {\n          // Filter to show only replies (posts with thread_parent_id)\n          if (filter.value === 'true') {\n            groupCondition = `s.thread_parent_id IS NOT NULL`;\n            if (groupCondition) {\n              filterGroups.push(`(${groupCondition})`);\n            }\n          }\n          break;\n        }\n\n        // Skip logic filters as they're handled above\n        case 'tagLogic':\n        case 'authorLogic':\n        case 'mentionsLogic':\n        case 'searchLogic':\n        case 'globalLogic':\n          break;\n      }\n    }\n\n    // Apply global logic to combine filter groups\n    if (filterGroups.length > 0) {\n      const globalOperator = globalLogic === 'OR' ? ' OR ' : ' AND ';\n      whereClause += ` AND (${filterGroups.join(globalOperator)})`;\n    }\n\n    // Count total records\n    const countQuery = `\n      SELECT COUNT(*) as total\n      FROM submissions s\n      JOIN users u ON s.user_id = u.id\n      ${whereClause}\n    `;\n\n    const countResult = await sql.unsafe(countQuery, queryParams);\n    const totalRecords = parseInt(countResult[0]?.total || '0');\n\n    // Calculate pagination\n    const offset = (page - 1) * pageSize;\n\n    // Main query with pagination - different structure for replies vs posts\n    let mainQuery: string;\n    \n    if (isOnlyReplies) {\n      // Simplified query for only replies - no nested replies subquery needed\n      mainQuery = `\n        SELECT \n          s.submission_id,\n          s.submission_name,\n          s.submission_title,\n          s.submission_url,\n          s.submission_datetime,\n          s.user_id,\n          s.tags,\n          s.thread_parent_id,\n          u.name as author,\n          u.bio as author_bio,\n          0 as reply_count,\n          NULL as replies\n        FROM submissions s\n        JOIN users u ON s.user_id = u.id\n        ${whereClause}\n        ORDER BY s.submission_datetime DESC\n        LIMIT $${paramIndex} OFFSET $${paramIndex + 1}\n      `;\n    } else {\n      // Full query with nested replies for posts\n      mainQuery = `\n      SELECT \n        s.submission_id,\n        s.submission_name,\n        s.submission_title,\n        s.submission_url,\n        s.submission_datetime,\n        s.user_id,\n        s.tags,\n        s.thread_parent_id,\n        u.name as author,\n        u.bio as author_bio,\n        (\n          SELECT COUNT(*)::int\n          FROM submissions replies\n          WHERE replies.thread_parent_id = s.submission_id\n        ) as reply_count,\n        (\n          SELECT json_agg(\n            json_build_object(\n              'submission_id', r.submission_id,\n              'submission_name', r.submission_name,\n              'submission_title', r.submission_title,\n              'submission_datetime', r.submission_datetime,\n              'user_id', r.user_id,\n              'author', ru.name,\n              'author_bio', ru.bio,\n              'tags', r.tags,\n              'thread_parent_id', r.thread_parent_id\n            )\n            ORDER BY r.submission_datetime ASC\n          )\n          FROM submissions r\n          JOIN users ru ON r.user_id = ru.id\n          WHERE r.thread_parent_id = s.submission_id\n        ) as replies\n      FROM submissions s\n      JOIN users u ON s.user_id = u.id\n      ${whereClause}\n      ORDER BY s.submission_datetime DESC\n      LIMIT $${paramIndex} OFFSET $${paramIndex + 1}\n    `;\n    }\n\n    queryParams.push(pageSize, offset);\n\n    const result = await sql.unsafe(mainQuery, queryParams);\n\n    // Debug logging for the first few results to understand timestamp issues\n    if (result.length > 0) {\n      // eslint-disable-next-line no-console\n      console.log('First few results from database:', {\n        isOnlyReplies,\n        count: result.length,\n        firstResult: {\n          submission_id: result[0]?.submission_id,\n          raw_submission_datetime: result[0]?.submission_datetime,\n          typeof_datetime: typeof result[0]?.submission_datetime,\n          thread_parent_id: result[0]?.thread_parent_id\n        },\n        secondResult: result[1] ? {\n          submission_id: result[1]?.submission_id,\n          raw_submission_datetime: result[1]?.submission_datetime,\n          typeof_datetime: typeof result[1]?.submission_datetime,\n          thread_parent_id: result[1]?.thread_parent_id\n        } : null\n      });\n    }\n\n    // Process results with debug logging\n    const processedData: SubmissionWithReplies[] = result.map((row: any) => {\n      let mainDate: Date | null = null;\n      \n      try {\n        const d = new Date(row.submission_datetime);\n        if (!isNaN(d.getTime()) && d.getTime() > 0) {\n          mainDate = d;\n        } else {\n          // eslint-disable-next-line no-console\n          console.error('Invalid main submission_datetime (invalid date):', {\n            submission_id: row.submission_id,\n            raw_datetime: row.submission_datetime,\n            parsed_time: d.getTime(),\n            isOnlyReplies,\n            thread_parent_id: row.thread_parent_id\n          });\n        }\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error('Invalid main submission_datetime (parse error):', {\n          submission_id: row.submission_id,\n          raw_datetime: row.submission_datetime,\n          error: error instanceof Error ? error.message : String(error),\n          isOnlyReplies,\n          thread_parent_id: row.thread_parent_id\n        });\n      }\n\n      return {\n      submission_id: row.submission_id,\n      submission_name: row.submission_name,\n      submission_title: row.submission_title,\n        submission_datetime: mainDate,\n      user_id: row.user_id,\n      author: row.author,\n      author_bio: row.author_bio,\n      tags: row.tags || [],\n      thread_parent_id: row.thread_parent_id,\n        replies: Array.isArray(row.replies)\n          ? row.replies.map((reply: any) => {\n              let dateValue = reply.submission_datetime;\n              let parsedDate: Date | null = null;\n              \n              if (dateValue && dateValue !== 0 && dateValue !== '0') {\n                try {\n                  const d = new Date(dateValue);\n                  if (!isNaN(d.getTime()) && d.getTime() > 0) {\n                    parsedDate = d;\n                  } else {\n                    // eslint-disable-next-line no-console\n                    console.error('Invalid nested reply submission_datetime (invalid date):', {\n                      reply_id: reply.submission_id,\n                      raw_datetime: dateValue,\n                      parsed_time: d.getTime(),\n                      parent_id: row.submission_id\n                    });\n                  }\n                } catch (error) {\n                  // eslint-disable-next-line no-console\n                  console.error('Invalid nested reply submission_datetime (parse error):', {\n                    reply_id: reply.submission_id,\n                    raw_datetime: dateValue,\n                    error: error instanceof Error ? error.message : String(error),\n                    parent_id: row.submission_id\n                  });\n                }\n              } else {\n                // eslint-disable-next-line no-console\n                console.warn('Missing or zero nested reply submission_datetime:', {\n                  reply_id: reply.submission_id,\n                  raw_datetime: dateValue,\n                  parent_id: row.submission_id\n                });\n              }\n              \n              return {\n                ...reply,\n                submission_datetime: parsedDate\n              };\n            })\n          : []\n      };\n    });\n\n    return {\n      data: {\n        data: processedData,\n        pagination: {\n          currentPage: page,\n          pageSize: pageSize,\n          totalRecords: totalRecords\n        }\n      }\n    };\n  } catch (error) {\n    console.error('getSubmissionsAction error:', error);\n    return {\n      error: 'Failed to fetch submissions'\n    };\n  }\n}\n\n// Helper function for the submissions manager\nexport async function getSubmissionsWithReplies({\n  filters = [],\n  page = 1,\n  pageSize = 10,\n  onlyMine = false,\n  userId,\n  includeThreadReplies = false\n}: {\n  filters?: { name: string; value: string }[];\n  page?: number;\n  pageSize?: number;\n  onlyMine?: boolean;\n  userId?: string;\n  includeThreadReplies?: boolean;\n}) {\n  return await getSubmissionsAction({\n    onlyMine,\n    userId,\n    filters,\n    page,\n    pageSize,\n    includeThreadReplies\n  });\n}\n\n/**\n * Get a single submission by ID with all its replies\n * Used for refreshing individual posts\n */\nexport async function getSubmissionById(\n  submissionId: number\n): Promise<{ data?: SubmissionWithReplies; error?: string }> {\n  try {\n    // Get the main submission\n    const mainQuery = `\n      SELECT \n        s.submission_id,\n        s.submission_name,\n        s.submission_title,\n        s.submission_url,\n        s.submission_datetime,\n        s.user_id,\n        s.tags,\n        s.thread_parent_id,\n        u.name as author,\n        u.bio as author_bio,\n        (\n          SELECT COUNT(*)::int\n          FROM submissions replies\n          WHERE replies.thread_parent_id = s.submission_id\n        ) as reply_count,\n        (\n          SELECT json_agg(\n            json_build_object(\n              'submission_id', r.submission_id,\n              'submission_name', r.submission_name,\n              'submission_title', r.submission_title,\n              'submission_datetime', r.submission_datetime,\n              'user_id', r.user_id,\n              'author', ru.name,\n              'author_bio', ru.bio,\n              'tags', r.tags,\n              'thread_parent_id', r.thread_parent_id\n            )\n            ORDER BY r.submission_datetime ASC\n          )\n          FROM submissions r\n          JOIN users ru ON r.user_id = ru.id\n          WHERE r.thread_parent_id = s.submission_id\n        ) as replies\n      FROM submissions s\n      JOIN users u ON s.user_id = u.id\n      WHERE s.submission_id = $1\n    `;\n\n    const result = await sql.unsafe(mainQuery, [submissionId]);\n\n    if (result.length === 0) {\n      return { error: 'Submission not found' };\n    }\n\n    const row = result[0];\n\n    // Process the result with the same logic as getSubmissionsAction\n    let mainDate: Date | null = null;\n    \n    try {\n      const d = new Date(row.submission_datetime);\n      if (!isNaN(d.getTime()) && d.getTime() > 0) {\n        mainDate = d;\n      } else {\n        console.error('Invalid submission_datetime (invalid date):', {\n          submission_id: row.submission_id,\n          raw_datetime: row.submission_datetime,\n          parsed_time: d.getTime()\n        });\n      }\n    } catch (error) {\n      console.error('Invalid submission_datetime (parse error):', {\n        submission_id: row.submission_id,\n        raw_datetime: row.submission_datetime,\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    const processedSubmission: SubmissionWithReplies = {\n      submission_id: row.submission_id,\n      submission_name: row.submission_name,\n      submission_title: row.submission_title,\n      submission_datetime: mainDate,\n      user_id: row.user_id,\n      author: row.author,\n      author_bio: row.author_bio,\n      tags: row.tags || [],\n      thread_parent_id: row.thread_parent_id,\n      replies: Array.isArray(row.replies)\n        ? row.replies.map((reply: any) => {\n            let dateValue = reply.submission_datetime;\n            let parsedDate: Date | null = null;\n            \n            if (dateValue && dateValue !== 0 && dateValue !== '0') {\n              try {\n                const d = new Date(dateValue);\n                if (!isNaN(d.getTime()) && d.getTime() > 0) {\n                  parsedDate = d;\n                } else {\n                  console.error('Invalid reply submission_datetime (invalid date):', {\n                    reply_id: reply.submission_id,\n                    raw_datetime: dateValue,\n                    parsed_time: d.getTime(),\n                    parent_id: row.submission_id\n                  });\n                }\n              } catch (error) {\n                console.error('Invalid reply submission_datetime (parse error):', {\n                  reply_id: reply.submission_id,\n                  raw_datetime: dateValue,\n                  error: error instanceof Error ? error.message : String(error),\n                  parent_id: row.submission_id\n                });\n              }\n            } else {\n              console.warn('Missing or zero reply submission_datetime:', {\n                reply_id: reply.submission_id,\n                raw_datetime: dateValue,\n                parent_id: row.submission_id\n              });\n            }\n            \n            return {\n              ...reply,\n              submission_datetime: parsedDate\n            };\n          })\n        : []\n    };\n\n    return { data: processedSubmission };\n  } catch (error) {\n    console.error('getSubmissionById error:', error);\n    return { error: 'Failed to fetch submission' };\n  }\n}\n",
    "language":"typescript",
    "lines":1110,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/submissions-list/actions.test.ts":{
    "content":"import { PageSize } from 'src/lib/state/atoms';\nimport { getSubmissionsAction } from './actions';\n\n// Mock the sql module BEFORE importing anything else\njest.mock('../../../lib/db', () => ({\n  __esModule: true,\n  default: {\n    unsafe: jest.fn().mockResolvedValue([])\n  }\n}));\n\nimport sql from '../../../lib/db';\nconst mockSql = (sql as any).unsafe;\n\n// Helper function to create mock database row structure\n// This should match what the SQL query actually returns (raw database format)\n// Based on the actual schema from migrations and the SQL query in actions.ts\nconst createMockDbRow = (overrides: any = {}) => ({\n  submission_id: 1,\n  submission_name: 'test-submission',\n  submission_title: 'Test Submission',\n  submission_url: 'https://example.com',\n  submission_datetime: '2023-01-01T00:00:00.000Z',  // Fixed: proper timestamp format\n  user_id: 123,\n  tags: [],\n  thread_parent_id: null,\n  author: 'Test Author',           // This comes from u.name as author in SQL JOIN\n  author_bio: 'Test Bio',          // This comes from u.bio as author_bio in SQL JOIN\n  reply_count: 0,                  // This comes from the COUNT subquery\n  replies: null,                   // This comes from the json_agg subquery\n  ...overrides\n});\n\ndescribe('getSubmissionsAction', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockSql.mockReset();\n  });\n\n  afterEach(() => {\n    jest.clearAllTimers();\n  });\n\n  it('should return paginated submissions for onlyMine=true', async () => {\n    const mockDbRows = [createMockDbRow()];\n    const mockCount = [{ total: 1 }];\n\n    mockSql.mockImplementation((query: any) => {\n      if (query.includes('SELECT COUNT(*) as total')) {\n        return Promise.resolve(mockCount);\n      }\n      return Promise.resolve(mockDbRows);\n    });\n\n    const result = await getSubmissionsAction({\n      onlyMine: true,\n      userId: '123',\n      filters: [],\n      page: 1,\n      pageSize: PageSize.TEN\n    });\n\n    expect(mockSql).toHaveBeenCalled();\n    expect(result).toBeDefined();\n    expect(result.error).toBeUndefined();\n    expect(result.data).toBeDefined();\n    expect(result.data?.data).toBeDefined();\n    expect(result.data?.data).toHaveLength(1);\n    \n    const firstItem = result.data?.data[0];\n    expect(firstItem).toBeDefined();\n    expect(firstItem?.submission_id).toBe(1);\n    expect(firstItem?.submission_title).toBe('Test Submission');\n    expect(firstItem?.author).toBe('Test Author');\n    expect(result.data?.pagination.totalRecords).toBe(1);\n  });\n\n  it('should return error when onlyMine is true but userId is falsy', async () => {\n    const result = await getSubmissionsAction({\n      onlyMine: true,\n      userId: '',\n      filters: [],\n      page: 1,\n      pageSize: PageSize.TEN\n    });\n\n    expect(result.error).toBe('User ID is required for user-specific queries');\n    expect(result.data).toBeUndefined();\n    expect(mockSql).not.toHaveBeenCalled();\n  });\n\n  it('should return paginated submissions for onlyMine=false', async () => {\n    const mockDbRows = [createMockDbRow()];\n    const mockCount = [{ total: 1 }];\n\n    mockSql.mockImplementation((query: any) => {\n      if (query.includes('SELECT COUNT(*) as total')) {\n        return Promise.resolve(mockCount);\n      }\n      return Promise.resolve(mockDbRows);\n    });\n\n    const result = await getSubmissionsAction({\n      onlyMine: false,\n      userId: '',\n      filters: [],\n      page: 1,\n      pageSize: PageSize.TEN\n    });\n\n    expect(result.data?.data).toHaveLength(1);\n    expect(result.data?.data[0]).toMatchObject({\n      submission_id: 1,\n      submission_title: 'Test Submission',\n      author: 'Test Author'\n    });\n    expect(result.data?.pagination.totalRecords).toBe(1);\n    expect(result.error).toBeUndefined();\n  });\n\n  it('should handle tag filters', async () => {\n    const mockDbRows = [createMockDbRow({ tags: ['test'] })];\n    const mockCount = [{ total: 1 }];\n\n    mockSql.mockReset();\n    mockSql.mockImplementation((query: any, params: any) => {\n      if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n      return Promise.resolve(mockDbRows);\n    });\n\n    const result = await getSubmissionsAction({\n      onlyMine: false,\n      userId: '',\n      filters: [{ name: 'tags', value: 'test' }],\n      page: 1,\n      pageSize: PageSize.TEN\n    });\n\n    expect(result.data?.data).toHaveLength(1);\n    expect(result.data?.data[0]).toMatchObject({\n      submission_id: 1,\n      submission_title: 'Test Submission',\n      tags: ['test']\n    });\n    expect(result.data?.pagination.totalRecords).toBe(1);\n    expect(result.error).toBeUndefined();\n  });\n\n  it('should handle page < 1', async () => {\n    const mockDbRows = [\n      createMockDbRow({\n        submission_datetime: '2023-01-01T00:00:00Z',\n        reply_count: 0,\n        replies: []\n      })\n    ];\n    const mockCount = [{ total: '1' }];\n\n    mockSql.mockReset();\n    mockSql.mockImplementation((query: any, params: any) => {\n      if (query.includes('COUNT')) return Promise.resolve(mockCount);\n      return Promise.resolve(mockDbRows);\n    });\n\n    const result = await getSubmissionsAction({\n      onlyMine: false,\n      userId: '',\n      filters: [],\n      page: 0,\n      pageSize: PageSize.TEN\n    });\n\n    expect(result.data?.pagination.currentPage).toBe(0);\n    expect(result.error).toBeUndefined();\n  });\n\n  it('should handle multiple tag filters', async () => {\n    const mockDbRows = [createMockDbRow({ tags: ['test', 'multiple'] })];\n    const mockCount = [{ total: 1 }];\n\n    mockSql.mockReset();\n    mockSql.mockImplementation((query: any, params: any) => {\n      if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n      return Promise.resolve(mockDbRows);\n    });\n\n    const result = await getSubmissionsAction({\n      onlyMine: true,\n      userId: '123',\n      filters: [{ name: 'tags', value: 'test,multiple' }],\n      page: 1,\n      pageSize: PageSize.TEN\n    });\n\n    expect(result.data?.data).toHaveLength(1);\n    expect(result.data?.data[0]).toMatchObject({\n      submission_id: 1,\n      submission_title: 'Test Submission',\n      tags: ['test', 'multiple']\n    });\n    expect(result.data?.pagination.totalRecords).toBe(1);\n    expect(result.error).toBeUndefined();\n  });\n\n  it('should handle empty tag filters', async () => {\n    const mockDbRows = [createMockDbRow()];\n    const mockCount = [{ total: 1 }];\n\n    mockSql.mockReset();\n    mockSql.mockImplementation((query: any, params: any) => {\n      if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n      return Promise.resolve(mockDbRows);\n    });\n\n    const result = await getSubmissionsAction({\n      onlyMine: false,\n      userId: '',\n      filters: [{ name: 'tags', value: '' }],\n      page: 1,\n      pageSize: PageSize.TEN\n    });\n\n    expect(result.data?.data).toHaveLength(1);\n    expect(result.data?.data[0]).toMatchObject({\n      submission_id: 1,\n      submission_title: 'Test Submission'\n    });\n    expect(result.data?.pagination.totalRecords).toBe(1);\n    expect(result.error).toBeUndefined();\n  });\n\n  it('should handle default values', async () => {\n    const mockDbRows = [createMockDbRow()];\n    const mockCount = [{ total: 1 }];\n\n    mockSql.mockImplementation((query: any, params: any) => {\n      if (query.includes('COUNT')) return Promise.resolve(mockCount);\n      return Promise.resolve(mockDbRows);\n    });\n\n    const result = await getSubmissionsAction({\n      page: undefined,\n      pageSize: undefined,\n      onlyMine: false,\n      userId: '123',\n      filters: []\n    });\n\n    expect(result.data?.pagination.currentPage).toBe(1);\n    expect(result.data?.pagination.pageSize).toBe(10);\n    expect(result.data?.data).toHaveLength(1);\n    expect(result.data?.pagination.totalRecords).toBe(1);\n    expect(result.error).toBeUndefined();\n  });\n\n  describe('Advanced Filter Logic', () => {\n    const mockDbRows = [createMockDbRow()];\n    const mockCount = [{ total: 1 }];\n\n    beforeEach(() => {\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows);\n      });\n    });\n\n    it('should handle tag filters with AND logic', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: 'react' },\n          { name: 'tags', value: 'typescript' },\n          { name: 'tagLogic', value: 'AND' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('= ANY(s.tags) AND'),\n        expect.arrayContaining(['react', 'typescript'])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle tag filters with OR logic', async () => {\n      const mockDbRows = [createMockDbRow({ tags: ['react', 'vue'] })];\n      const mockCount = [{ total: 1 }];\n\n      mockSql.mockReset();\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows);\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: true,\n        userId: '123',\n        filters: [{ name: 'tags', value: 'react,vue' }],\n        page: 1,\n        pageSize: PageSize.TEN\n      });\n\n      expect(result.data?.data).toHaveLength(1);\n      expect(result.data?.data[0].tags).toEqual(['react', 'vue']);\n      expect(result.error).toBeUndefined();\n\n      // Verify the mock was called\n      expect(mockSql).toHaveBeenCalled();\n    });\n\n    it('should handle author filters with OR logic', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'author', value: '123' },\n          { name: 'author', value: '456' },\n          { name: 'authorLogic', value: 'OR' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('s.user_id IN'),\n        expect.arrayContaining([123, 456])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle mentions filters with AND logic', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'mentions', value: 'user1' },\n          { name: 'mentions', value: 'user2' },\n          { name: 'mentionsLogic', value: 'AND' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('ILIKE') && expect.stringContaining('AND'),\n        expect.arrayContaining(['%user1%', '%user1%', '%user2%', '%user2%'])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle mentions filters with OR logic', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'mentions', value: 'user1' },\n          { name: 'mentions', value: 'user2' },\n          { name: 'mentionsLogic', value: 'OR' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('ILIKE') && expect.stringContaining('OR'),\n        expect.arrayContaining(['%user1%', '%user1%', '%user2%', '%user2%'])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle global logic with multiple filter groups (AND)', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: 'react' },\n          { name: 'author', value: '123' },\n          { name: 'globalLogic', value: 'AND' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('AND'),\n        expect.arrayContaining(['react', 123])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle global logic with multiple filter groups (OR)', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: 'react' },\n          { name: 'author', value: '123' },\n          { name: 'globalLogic', value: 'OR' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('OR'),\n        expect.arrayContaining(['react', 123])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle complex filter combinations', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: 'react' },\n          { name: 'tags', value: 'typescript' },\n          { name: 'tagLogic', value: 'AND' },\n          { name: 'author', value: '123' },\n          { name: 'author', value: '456' },\n          { name: 'authorLogic', value: 'OR' },\n          { name: 'mentions', value: 'user1' },\n          { name: 'mentionsLogic', value: 'OR' },\n          { name: 'globalLogic', value: 'AND' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('AND'),\n        expect.arrayContaining([\n          'react',\n          'typescript',\n          123,\n          456,\n          '%user1%',\n          '%user1%'\n        ])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle hash prefix removal from tags', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: '#react' },\n          { name: 'tags', value: '#typescript' },\n          { name: 'tagLogic', value: 'AND' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('= ANY(s.tags) AND'),\n        expect.arrayContaining(['react', 'typescript'])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should ignore empty filter values', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: '' },\n          { name: 'author', value: ' ' },\n          { name: 'mentions', value: 'user1' },\n          { name: 'mentions', value: 'user2' },\n          { name: 'mentionsLogic', value: 'AND' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('ILIKE') && expect.stringContaining('AND'),\n        expect.arrayContaining(['%user1%', '%user1%', '%user2%', '%user2%'])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle whitespace-only and comma-only filter values', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: 'react' },\n          { name: 'tags', value: 'typescript' },\n          { name: 'author', value: '123' },\n          { name: 'author', value: '456' },\n          { name: 'mentions', value: 'user1' },\n          { name: 'globalLogic', value: 'OR' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('OR'),\n        expect.arrayContaining([\n          'react',\n          'typescript',\n          123,\n          456,\n          '%user1%',\n          '%user1%'\n        ])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle special characters in filter values', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [\n          { name: 'tags', value: 'react-native' },\n          { name: 'tags', value: 'vue.js' },\n          { name: 'mentions', value: 'user@domain' },\n          { name: 'mentions', value: 'user_name' },\n          { name: 'globalLogic', value: 'AND' }\n        ],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('AND'),\n        expect.arrayContaining([\n          'react-native',\n          'vue.js',\n          '%user@domain%',\n          '%user@domain%',\n          '%user_name%',\n          '%user_name%'\n        ])\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should handle includeThreadReplies parameter', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: 10,\n        includeThreadReplies: true\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.not.stringContaining('s.thread_parent_id IS NULL'),\n        expect.any(Array)\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n\n    it('should exclude thread replies by default', async () => {\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: 10\n      });\n\n      expect(mockSql).toHaveBeenCalledWith(\n        expect.stringContaining('s.thread_parent_id IS NULL'),\n        expect.any(Array)\n      );\n      expect(result.data?.data).toHaveLength(1);\n    });\n  });\n\n  describe('Error Handling', () => {\n    beforeEach(() => {\n      // Reset mocks before each error test\n      jest.clearAllMocks();\n    });\n\n    it('should handle database errors gracefully', async () => {\n      mockSql.mockRejectedValue(\n        new Error('Database connection failed')\n      );\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: PageSize.TEN\n      });\n\n      expect(result.error).toBe('Failed to fetch submissions');\n      expect(result.data).toBeUndefined();\n    });\n\n    it('should handle count query errors', async () => {\n      mockSql.mockImplementation((query: any) => {\n        if (query.includes('COUNT')) {\n          return Promise.reject(new Error('Count query failed'));\n        }\n        return Promise.resolve([]);\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: PageSize.TEN\n      });\n\n      expect(result.error).toBe('Failed to fetch submissions');\n      expect(result.data).toBeUndefined();\n    });\n\n    it('should handle invalid count response', async () => {\n      const mockDbRows: any[] = [];\n      const mockCount: any[] = []; // Empty count result\n\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('COUNT')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows);\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: PageSize.TEN\n      });\n\n      expect(result.data?.pagination.totalRecords).toBe(0);\n      expect(result.data?.data).toEqual([]);\n    });\n\n    it('should handle invalid author IDs', async () => {\n      const mockDbRows = [createMockDbRow()];\n      const mockCount = [{ total: 1 }];\n\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('COUNT')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows);\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [{ name: 'author', value: 'invalid,NaN,123' }],\n        page: 1,\n        pageSize: PageSize.TEN\n      });\n\n      // Should handle NaN values gracefully\n      expect(result.data?.data).toHaveLength(1);\n    });\n  });\n\n  describe('Pagination Edge Cases', () => {\n    it('should handle large page numbers', async () => {\n      // Mock empty results for large page numbers\n      const mockDbRows: any[] = []; // Empty array for no results\n      const mockCount = [{ total: 10 }]; // Total exists but no results for this page\n\n      mockSql.mockReset();\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows); // Return empty array\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1000,\n        pageSize: PageSize.TEN\n      });\n\n      expect(result.data?.pagination.currentPage).toBe(1000);\n      expect(result.data?.data).toEqual([]); // Should be empty array\n    });\n\n    it('should handle large page sizes', async () => {\n      const mockDbRows = [createMockDbRow()];\n      const mockCount = [{ total: 1 }];\n\n      mockSql.mockReset();\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows);\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: 1000 as PageSize\n      });\n\n      expect(result.data?.pagination.pageSize).toBe(1000);\n      expect(result.error).toBeUndefined();\n    });\n\n    it('should handle zero page size', async () => {\n      const mockDbRows = [createMockDbRow()];\n      const mockCount = [{ total: 1 }];\n\n      mockSql.mockReset();\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows);\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: 0 as PageSize\n      });\n\n      // The implementation accepts 0 as a valid page size\n      expect(result.data?.pagination.pageSize).toBe(0);\n    });\n\n    it('should handle negative page numbers', async () => {\n      const mockDbRows = [createMockDbRow()];\n      const mockCount = [{ total: 1 }];\n\n      mockSql.mockReset();\n      mockSql.mockImplementation((query: any, params: any) => {\n        if (query.includes('SELECT COUNT(*) as total')) return Promise.resolve(mockCount);\n        return Promise.resolve(mockDbRows);\n      });\n\n      const result = await getSubmissionsAction({\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: -5,\n        pageSize: PageSize.TEN\n      });\n\n      // The implementation allows negative page numbers without clamping\n      expect(result.data?.pagination.currentPage).toBe(-5);\n    });\n  });\n});\n",
    "language":"typescript",
    "lines":758,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/twitch-chat/index.ts":{
    "content":"export { TwitchChat } from './TwitchChat';\nexport type { TwitchChatProps } from './TwitchChat';\n",
    "language":"typescript",
    "lines":3,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/index.ts":{
    "content":"export { InteractiveTooltip } from './InteractiveTooltip';\nexport { LinkTooltip } from './LinkTooltip';\nexport { MentionTooltip } from './MentionTooltip';\nexport { TooltipContent } from './TooltipContent';\nexport { TooltipModal } from './TooltipModal';\n",
    "language":"typescript",
    "lines":6,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/tooltip/link-tooltip-modal-atom.ts":{
    "content":"import { atom } from 'jotai';\n\nexport const linkTooltipModalAtom = atom<boolean>(false);\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/thread/actions.ts":{
    "content":"'use server';\n\nimport sql from '../../../lib/db';\n\nexport interface NestedSubmission {\n  submission_id: number;\n  submission_name: string;\n  submission_title: string;\n  submission_datetime: Date;\n  user_id: number;\n  author: string;\n  author_bio: string | null;\n  tags: string[];\n  thread_parent_id: number | null;\n  replies: NestedSubmission[];\n  depth?: number;\n}\n\nexport async function getSubmissionThread(\n  submissionId: number\n): Promise<{ parent: NestedSubmission | null; replies: NestedSubmission[] }> {\n  // Get the parent submission\n  const parentResult = await sql<any[]>`\n    SELECT \n      s.submission_id,\n      s.submission_name,\n      s.submission_title,\n      s.submission_datetime,\n      s.user_id,\n      u.name as author,\n      u.bio as author_bio,\n      COALESCE(s.tags, ARRAY[]::text[]) as tags,\n      s.thread_parent_id\n    FROM submissions s\n    LEFT JOIN users u ON s.user_id = u.id\n    WHERE s.submission_id = ${submissionId}\n  `;\n\n  // Get all nested replies using recursive CTE\n  const repliesResult = await sql<any[]>`\n    WITH RECURSIVE thread_replies AS (\n      -- Base case: direct replies to the main submission\n      SELECT \n        s.submission_id,\n        s.submission_name,\n        s.submission_title,\n        s.submission_datetime,\n        s.user_id,\n        u.name as author,\n        u.bio as author_bio,\n        COALESCE(s.tags, ARRAY[]::text[]) as tags,\n        s.thread_parent_id,\n        1 as depth,\n        ARRAY[s.submission_datetime] as path\n      FROM submissions s\n      LEFT JOIN users u ON s.user_id = u.id\n      WHERE s.thread_parent_id = ${submissionId}\n      \n      UNION ALL\n      \n      -- Recursive case: replies to replies\n      SELECT \n        s.submission_id,\n        s.submission_name,\n        s.submission_title,\n        s.submission_datetime,\n        s.user_id,\n        u.name as author,\n        u.bio as author_bio,\n        COALESCE(s.tags, ARRAY[]::text[]) as tags,\n        s.thread_parent_id,\n        tr.depth + 1,\n        tr.path || s.submission_datetime\n      FROM submissions s\n      LEFT JOIN users u ON s.user_id = u.id\n      INNER JOIN thread_replies tr ON s.thread_parent_id = tr.submission_id\n      WHERE tr.depth < 5 -- Limit depth to prevent infinite recursion\n    )\n    SELECT * FROM thread_replies\n    ORDER BY path ASC\n  `;\n\n  // Parse the results to ensure proper typing\n  const parseSubmission = (row: any): NestedSubmission => ({\n    submission_id: Number(row.submission_id),\n    submission_name: row.submission_name,\n    submission_title: row.submission_title || row.submission_name,\n    submission_datetime: new Date(row.submission_datetime),\n    user_id: Number(row.user_id),\n    author: row.author,\n    author_bio: row.author_bio || null,\n    tags: Array.isArray(row.tags) ? row.tags : [],\n    thread_parent_id: row.thread_parent_id\n      ? Number(row.thread_parent_id)\n      : null,\n    depth: row.depth || 0,\n    replies: []\n  });\n\n  // Build nested structure\n  const allReplies = repliesResult.map(parseSubmission);\n  const buildNestedStructure = (parentId: number): NestedSubmission[] => {\n    return allReplies\n      .filter((reply) => reply.thread_parent_id === parentId)\n      .map((reply) => ({\n        ...reply,\n        replies: buildNestedStructure(reply.submission_id)\n      }));\n  };\n\n  // Get top-level replies (direct replies to the main submission)\n  const nestedReplies = buildNestedStructure(submissionId);\n\n  return {\n    parent: parentResult[0] ? parseSubmission(parentResult[0]) : null,\n    replies: nestedReplies\n  };\n}\n",
    "language":"typescript",
    "lines":119,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/auth-avatar/index.ts":{
    "content":"export { AuthAvatar } from './AuthAvatar';\nexport { AuthAvatarServer } from './AuthAvatarServer';\n",
    "language":"typescript",
    "lines":3,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/recent-tags/schema.ts":{
    "content":"import { z } from 'zod';\n\nexport const tagSchema = z.array(z.string());\n\nexport type Tags = Required<z.infer<typeof tagSchema>>;\n",
    "language":"typescript",
    "lines":6,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/components/recent-tags/actions.ts":{
    "content":"'use server';\n\nimport sql from '../../../lib/db';\nimport { parseZodErrors } from '../submission-forms/schema';\nimport { Tags, tagSchema } from './schema';\n\nexport async function getRecentTags(\n  interval: 'months' | 'days' | 'hrs' = 'months',\n  userId?: string\n): Promise<{\n  tags: string[];\n  error: string;\n  message: string;\n}> {\n  try {\n    let subquerySql;\n\n    // TODO: cleanup once casting issues figured out for INTERVAL (if possible)\n    //\n    // return records where:\n    //   each row contains the following from the submissions table:\n    //     - a new column named 'distinct_tags' which gets all unique tags from the tags string[] column\n    //     - the submission_datetime for the accompanying unique tag found\n    //   and the records matched are from the current datetimestamp up to the last n days/hrs/months (interval)\n    //\n    // NOTE: unnest is used to destructure the string[] tags into something query friendly\n    // NOTE: due to the requirement of sorting based on datetime, the inclusion of submission_datetime will\n    // return duplicate records as the query will be specifically returning distinct on BOTH tags & submission_datetime\n    switch (interval) {\n      case 'days':\n        subquerySql = sql`\n          select distinct unnest(tags) as distinct_tags, submission_datetime\n          from submissions s\n          where s.submission_datetime >= NOW() - INTERVAL '3 days'\n          ${userId ? sql` and s.user_id = ${parseInt(userId)}` : sql``}\n        `;\n        break;\n      case 'hrs':\n        subquerySql = sql`\n          select distinct unnest(tags) as distinct_tags, submission_datetime\n          from submissions s\n          where s.submission_datetime >= NOW() - INTERVAL '3 hrs'\n          ${userId ? sql` and s.user_id = ${parseInt(userId)}` : sql``}\n        `;\n        break;\n      case 'months':\n        subquerySql = sql`\n          select distinct unnest(tags) as distinct_tags, submission_datetime\n          from submissions s\n          where s.submission_datetime >= NOW() - INTERVAL '3 months'\n          ${userId ? sql` and s.user_id = ${parseInt(userId)}` : sql``}\n        `;\n        break;\n    }\n\n    // using the above constructed query, in a new subquery, remove duplicate tags found by selecting all columns\n    // where tags are unique from the above constructed query results\n    // using a subquery this way, we can then do a final order by the corresponding submission_datetime for the unqieu tags found\n    //\n    // NOTE: further testing required to determine which records get removed during deduping as a result of distinct.\n    //       - is it a FIFO situation?\n    //       - are the records from the above constructed query in an particular order, does this impact results in this final\n    //         awaited query?\n    const result = await sql`\n      select *\n      from (\n        select distinct on(subquery.distinct_tags) * from (${subquerySql}) as subquery\n      ) as s\n      order by s.submission_datetime desc\n    `;\n\n    // reduce the results from the postgresql query above into a string array\n    if (result.length) {\n      const tags = result.reduce((accumulator, current) => {\n        accumulator.push(current.distinct_tags);\n\n        return accumulator;\n      }, [] as Tags);\n\n      // safe parse using zod schema to prevent errors from being thrown so we can handle them in our own manner\n      const { success, data, error } = tagSchema.safeParse(tags);\n\n      if (success) {\n        return { tags: data, error: '', message: '' };\n      }\n\n      return {\n        tags: [],\n        error: parseZodErrors(error),\n        message: ''\n      };\n    }\n\n    return {\n      tags: [],\n      error: '',\n      message: ''\n    };\n  } catch (error) {\n    console.error(error);\n\n    return {\n      tags: [],\n      error: 'Something went wrong...',\n      message: ''\n    };\n  }\n}\n",
    "language":"typescript",
    "lines":109,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/lib/test-selectors/components/avatar.selectors.ts":{
    "content":"export const AVATAR_SELECTORS = {\n  CONTAINER: 'avatar__container',\n  LOADER: 'avatar__loader',\n  IMG: 'avatar__img'\n} as const;\n",
    "language":"typescript",
    "lines":6,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/quotas/global/route.ts":{
    "content":"/**\n * Global Guest Quota Management API\n * \n * Provides secure endpoints for managing global quota settings for anonymous/guest users\n * with feature-level granularity to prevent unintended impacts on other systems.\n * \n * @version 1.0.0\n * @author System\n */\n\nimport { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\n// ================================\n// TYPES & SCHEMAS\n// ================================\n\ninterface GlobalGuestQuota {\n  id: number;\n  service_name: string;\n  feature_name: string;\n  quota_limit: number;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n  description: string | null;\n  created_by: number | null;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface ServiceFeature {\n  service_name: string;\n  service_display_name: string;\n  feature_name: string;\n  feature_display_name: string;\n  feature_type: string;\n  current_quota: number | null;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n}\n\nconst CreateGlobalQuotaSchema = z.object({\n  service_name: z.string().min(1).max(50),\n  feature_name: z.string().min(1).max(100),\n  quota_limit: z.number().int().min(0).optional(),\n  is_unlimited: z.boolean().default(false),\n  reset_period: z.enum(['hourly', 'daily', 'weekly', 'monthly']).default('daily'),\n  description: z.string().max(500).optional(),\n  is_active: z.boolean().default(true)\n}).transform((data) => {\n  // If quota_limit is 0, treat as unlimited\n  if (data.quota_limit === 0) {\n    return {\n      ...data,\n      is_unlimited: true\n    };\n  }\n  return data;\n});\n\nconst UpdateGlobalQuotaSchema = z.object({\n  quota_limit: z.number().int().min(0).optional(),\n  is_unlimited: z.boolean().optional(),\n  reset_period: z.enum(['hourly', 'daily', 'weekly', 'monthly']).optional(),\n  description: z.string().max(500).optional(),\n  is_active: z.boolean().optional()\n}).transform((data) => {\n  // If quota_limit is 0, treat as unlimited\n  if (data.quota_limit === 0) {\n    return {\n      ...data,\n      is_unlimited: true\n    };\n  }\n  return data;\n});\n\nconst ParamsSchema = z.object({\n  id: z.string().regex(/^\\\\d+$/, 'Invalid quota ID')\n});\n\ninterface ApiResponse<T> {\n  success: true;\n  data: T;\n  message?: string;\n}\n\ninterface ErrorResponse {\n  success: false;\n  error: string;\n  message?: string;\n  data?: any;\n}\n\n// ================================\n// HELPER FUNCTIONS\n// ================================\n\nasync function validateAdminAccess(userId: string): Promise<boolean> {\n  try {\n    const adminCheck = await sql`\n      SELECT ura.role_id, ur.name as role_name\n      FROM user_role_assignments ura\n      JOIN user_roles ur ON ura.role_id = ur.id\n      WHERE ura.user_id = ${userId}\n      AND ur.name IN ('admin', 'moderator')\n      AND ura.is_active = true\n      AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n      LIMIT 1\n    `;\n    return adminCheck.length > 0;\n  } catch (error) {\n    console.error('Admin validation error:', error);\n    return false;\n  }\n}\n\nasync function logAdminAction(\n  adminUserId: string,\n  action: string,\n  details: any,\n  reason?: string\n): Promise<void> {\n  try {\n    await sql`\n      INSERT INTO admin_actions (\n        admin_user_id, action_type, action_details, reason, created_at\n      ) VALUES (\n        ${adminUserId}, ${action}, ${JSON.stringify(details)}, ${reason || null}, NOW()\n      )\n    `;\n  } catch (error) {\n    console.error('Failed to log admin action:', error);\n  }\n}\n\nasync function getAvailableServiceFeatures(): Promise<ServiceFeature[]> {\n  const features = await sql`\n    SELECT \n      ss.name as service_name,\n      ss.display_name as service_display_name,\n      sf.name as feature_name,\n      sf.display_name as feature_display_name,\n      sf.feature_type,\n      ggq.quota_limit as current_quota,\n      COALESCE(ggq.is_unlimited, false) as is_unlimited,\n      COALESCE(ggq.reset_period, 'daily') as reset_period,\n      COALESCE(ggq.is_active, false) as is_active\n    FROM subscription_services ss\n    JOIN subscription_features sf ON ss.id = sf.service_id\n    LEFT JOIN global_guest_quotas ggq ON ss.name = ggq.service_name AND sf.name = ggq.feature_name\n    WHERE sf.feature_type = 'limit'\n    AND (sf.name LIKE '%_limit%' OR sf.name LIKE '%_generations%' OR sf.name LIKE '%_slots%' OR sf.name LIKE '%_requests%')\n    AND ss.is_active = true\n    ORDER BY ss.display_name, sf.display_name\n  `;\n\n  return features.map((feature: any): ServiceFeature => ({\n    service_name: feature.service_name,\n    service_display_name: feature.service_display_name,\n    feature_name: feature.feature_name,\n    feature_display_name: feature.feature_display_name,\n    feature_type: feature.feature_type,\n    current_quota: feature.current_quota,\n    is_unlimited: feature.is_unlimited,\n    reset_period: feature.reset_period,\n    is_active: feature.is_active\n  }));\n}\n\n// ================================\n// API HANDLERS\n// ================================\n\n/**\n * GET /api/admin/quotas/global\n * Retrieves all global guest quotas with available service/feature options\n */\nexport async function GET(\n  request: NextRequest\n): Promise<NextResponse<ApiResponse<{ quotas: GlobalGuestQuota[]; available_features: ServiceFeature[] }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Get all global guest quotas\n    const quotas = await sql`\n      SELECT \n        ggq.*,\n        ss.display_name as service_display_name,\n        sf.display_name as feature_display_name\n      FROM global_guest_quotas ggq\n      JOIN subscription_services ss ON ggq.service_name = ss.name\n      JOIN subscription_features sf ON ggq.feature_name = sf.name AND sf.service_id = ss.id\n      ORDER BY ss.display_name, sf.display_name\n    `;\n\n    // Get available service/feature combinations\n    const availableFeatures = await getAvailableServiceFeatures();\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        quotas: quotas as unknown as GlobalGuestQuota[],\n        available_features: availableFeatures\n      },\n      message: `Retrieved ${quotas.length} global quotas and ${availableFeatures.length} available features`\n    });\n\n  } catch (error) {\n    console.error('GET /api/admin/quotas/global error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to retrieve global quotas'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/admin/quotas/global\n * Creates a new global guest quota for a specific service/feature\n */\nexport async function POST(\n  request: NextRequest\n): Promise<NextResponse<ApiResponse<{ quota: GlobalGuestQuota }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const validationResult = CreateGlobalQuotaSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Invalid request data',\n          data: validationResult.error.issues \n        },\n        { status: 400 }\n      );\n    }\n\n    const { service_name, feature_name, quota_limit, is_unlimited, reset_period, description, is_active } = validationResult.data;\n\n    // Verify service and feature exist\n    const serviceFeatureExists = await sql`\n      SELECT ss.display_name as service_display_name, sf.display_name as feature_display_name\n      FROM subscription_services ss\n      JOIN subscription_features sf ON ss.id = sf.service_id\n      WHERE ss.name = ${service_name} AND sf.name = ${feature_name}\n      AND ss.is_active = true\n    `;\n\n    if (serviceFeatureExists.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Service or feature not found or inactive' },\n        { status: 404 }\n      );\n    }\n\n    // Check if quota already exists\n    const existingQuota = await sql`\n      SELECT id FROM global_guest_quotas \n      WHERE service_name = ${service_name} AND feature_name = ${feature_name}\n    `;\n\n    if (existingQuota.length > 0) {\n      return NextResponse.json(\n        { success: false, error: 'Global quota for this service/feature already exists' },\n        { status: 409 }\n      );\n    }\n\n    // Create the quota - treat 0 as unlimited\n    const finalQuotaLimit = is_unlimited || quota_limit === 0 ? -1 : (quota_limit || 1);\n    const finalIsUnlimited = is_unlimited || quota_limit === 0;\n    \n    const newQuota = await sql`\n      INSERT INTO global_guest_quotas (\n        service_name, feature_name, quota_limit, is_unlimited, \n        reset_period, description, is_active, created_by\n      ) VALUES (\n        ${service_name}, ${feature_name}, ${finalQuotaLimit}, ${finalIsUnlimited},\n        ${reset_period}, ${description || null}, ${is_active}, ${session.user.id}\n      )\n      RETURNING *\n    `;\n\n    // Log the admin action\n    await logAdminAction(\n      session.user.id,\n      'global_quota_create',\n      {\n        service_name,\n        feature_name,\n        quota_limit: finalQuotaLimit,\n        is_unlimited,\n        reset_period,\n        service_display_name: serviceFeatureExists[0].service_display_name,\n        feature_display_name: serviceFeatureExists[0].feature_display_name\n      },\n      `Created global guest quota for ${service_name}.${feature_name}`\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: { quota: newQuota[0] as GlobalGuestQuota },\n      message: `Global quota created for ${serviceFeatureExists[0].service_display_name} - ${serviceFeatureExists[0].feature_display_name}`\n    });\n\n  } catch (error) {\n    console.error('POST /api/admin/quotas/global error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to create global quota'\n      },\n      { status: 500 }\n    );\n  }\n} ",
    "language":"typescript",
    "lines":362,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/quotas/global/[id]/route.ts":{
    "content":"/**\n * Individual Global Guest Quota Management API\n * \n * Provides secure endpoints for managing specific global quota settings by ID\n * with proper validation and admin action logging.\n * \n * @version 1.0.0\n * @author System\n */\n\nimport { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\n// ================================\n// TYPES & SCHEMAS\n// ================================\n\ninterface GlobalGuestQuota {\n  id: number;\n  service_name: string;\n  feature_name: string;\n  quota_limit: number;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n  description: string | null;\n  created_by: number | null;\n  created_at: string;\n  updated_at: string;\n}\n\nconst UpdateGlobalQuotaSchema = z.object({\n  quota_limit: z.number().int().min(0).optional(),\n  is_unlimited: z.boolean().optional(),\n  reset_period: z.enum(['hourly', 'daily', 'weekly', 'monthly']).optional(),\n  description: z.string().max(500).optional(),\n  is_active: z.boolean().optional()\n}).transform((data) => {\n  // If quota_limit is 0, treat as unlimited\n  if (data.quota_limit === 0) {\n    return {\n      ...data,\n      is_unlimited: true\n    };\n  }\n  return data;\n});\n\ninterface ApiResponse<T> {\n  success: true;\n  data: T;\n  message?: string;\n}\n\ninterface ErrorResponse {\n  success: false;\n  error: string;\n  message?: string;\n  data?: any;\n}\n\n// ================================\n// HELPER FUNCTIONS\n// ================================\n\nasync function validateAdminAccess(userId: string): Promise<boolean> {\n  try {\n    const adminCheck = await sql`\n      SELECT ura.role_id, ur.name as role_name\n      FROM user_role_assignments ura\n      JOIN user_roles ur ON ura.role_id = ur.id\n      WHERE ura.user_id = ${userId}\n      AND ur.name IN ('admin', 'moderator')\n      AND ura.is_active = true\n      AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n      LIMIT 1\n    `;\n    return adminCheck.length > 0;\n  } catch (error) {\n    console.error('Admin validation error:', error);\n    return false;\n  }\n}\n\nasync function logAdminAction(\n  adminUserId: string,\n  action: string,\n  details: any,\n  reason?: string\n): Promise<void> {\n  try {\n    await sql`\n      INSERT INTO admin_actions (\n        admin_user_id, action_type, action_details, reason, created_at\n      ) VALUES (\n        ${adminUserId}, ${action}, ${JSON.stringify(details)}, ${reason || null}, NOW()\n      )\n    `;\n  } catch (error) {\n    console.error('Failed to log admin action:', error);\n  }\n}\n\n// ================================\n// API HANDLERS\n// ================================\n\n/**\n * PUT /api/admin/quotas/global/[id]\n * Updates an existing global guest quota\n */\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n): Promise<NextResponse<ApiResponse<{ quota: GlobalGuestQuota }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Validate quota ID\n    const quotaId = parseInt(params.id);\n    if (isNaN(quotaId) || quotaId <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid quota ID' },\n        { status: 400 }\n      );\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const validationResult = UpdateGlobalQuotaSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Invalid request data',\n          data: validationResult.error.issues \n        },\n        { status: 400 }\n      );\n    }\n\n    const updates = validationResult.data;\n\n    // Check if quota exists\n    const existingQuota = await sql`\n      SELECT ggq.*, ss.display_name as service_display_name, sf.display_name as feature_display_name\n      FROM global_guest_quotas ggq\n      JOIN subscription_services ss ON ggq.service_name = ss.name\n      JOIN subscription_features sf ON ggq.feature_name = sf.name AND sf.service_id = ss.id\n      WHERE ggq.id = ${quotaId}\n    `;\n\n    if (existingQuota.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Global quota not found' },\n        { status: 404 }\n      );\n    }\n\n    const currentQuota = existingQuota[0];\n\n    // Build update query dynamically\n    const updateFields: string[] = [];\n    const updateValues: any[] = [];\n    let paramIndex = 1;\n\n    // Handle quota_limit and is_unlimited together to support 0 as infinite\n    const isBecomingUnlimited = updates.is_unlimited || updates.quota_limit === 0;\n    \n    if (updates.quota_limit !== undefined) {\n      const finalQuotaLimit = isBecomingUnlimited ? -1 : updates.quota_limit;\n      updateFields.push(`quota_limit = $${paramIndex++}`);\n      updateValues.push(finalQuotaLimit);\n    }\n\n    if (updates.is_unlimited !== undefined || updates.quota_limit === 0) {\n      updateFields.push(`is_unlimited = $${paramIndex++}`);\n      updateValues.push(isBecomingUnlimited);\n      \n      // If setting to unlimited but quota_limit wasn't provided, also set quota_limit to -1\n      if (isBecomingUnlimited && updates.quota_limit === undefined) {\n        updateFields.push(`quota_limit = $${paramIndex++}`);\n        updateValues.push(-1);\n      }\n    }\n\n    if (updates.reset_period !== undefined) {\n      updateFields.push(`reset_period = $${paramIndex++}`);\n      updateValues.push(updates.reset_period);\n    }\n\n    if (updates.description !== undefined) {\n      updateFields.push(`description = $${paramIndex++}`);\n      updateValues.push(updates.description);\n    }\n\n    if (updates.is_active !== undefined) {\n      updateFields.push(`is_active = $${paramIndex++}`);\n      updateValues.push(updates.is_active);\n    }\n\n    if (updateFields.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'No valid fields to update' },\n        { status: 400 }\n      );\n    }\n\n    // Add updated_at field\n    updateFields.push(`updated_at = NOW()`);\n    updateValues.push(quotaId); // Add quota ID for WHERE clause\n\n    // Execute update\n    const updateQuery = `\n      UPDATE global_guest_quotas \n      SET ${updateFields.join(', ')}\n      WHERE id = $${paramIndex}\n      RETURNING *\n    `;\n\n    const updatedQuota = await sql.unsafe(updateQuery, updateValues);\n\n    // Log the admin action\n    await logAdminAction(\n      session.user.id,\n      'global_quota_update',\n      {\n        quota_id: quotaId,\n        service_name: currentQuota.service_name,\n        feature_name: currentQuota.feature_name,\n        service_display_name: currentQuota.service_display_name,\n        feature_display_name: currentQuota.feature_display_name,\n        old_values: {\n          quota_limit: currentQuota.quota_limit,\n          is_unlimited: currentQuota.is_unlimited,\n          reset_period: currentQuota.reset_period,\n          description: currentQuota.description,\n          is_active: currentQuota.is_active\n        },\n        new_values: updates\n      },\n      `Updated global guest quota for ${currentQuota.service_name}.${currentQuota.feature_name}`\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: { quota: updatedQuota[0] as unknown as GlobalGuestQuota },\n      message: `Global quota updated for ${currentQuota.service_display_name} - ${currentQuota.feature_display_name}`\n    });\n\n  } catch (error) {\n    console.error('PUT /api/admin/quotas/global/[id] error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to update global quota'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/admin/quotas/global/[id]\n * Deletes a global guest quota (removes quota limits for that service/feature)\n */\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n): Promise<NextResponse<ApiResponse<{ deleted: boolean }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Validate quota ID\n    const quotaId = parseInt(params.id);\n    if (isNaN(quotaId) || quotaId <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid quota ID' },\n        { status: 400 }\n      );\n    }\n\n    // Check if quota exists and get details for logging\n    const existingQuota = await sql`\n      SELECT ggq.*, ss.display_name as service_display_name, sf.display_name as feature_display_name\n      FROM global_guest_quotas ggq\n      JOIN subscription_services ss ON ggq.service_name = ss.name\n      JOIN subscription_features sf ON ggq.feature_name = sf.name AND sf.service_id = ss.id\n      WHERE ggq.id = ${quotaId}\n    `;\n\n    if (existingQuota.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Global quota not found' },\n        { status: 404 }\n      );\n    }\n\n    const quotaToDelete = existingQuota[0];\n\n    // Delete the quota\n    const deleteResult = await sql`\n      DELETE FROM global_guest_quotas \n      WHERE id = ${quotaId}\n      RETURNING id\n    `;\n\n    if (deleteResult.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Failed to delete global quota' },\n        { status: 500 }\n      );\n    }\n\n    // Log the admin action\n    await logAdminAction(\n      session.user.id,\n      'global_quota_delete',\n      {\n        quota_id: quotaId,\n        service_name: quotaToDelete.service_name,\n        feature_name: quotaToDelete.feature_name,\n        service_display_name: quotaToDelete.service_display_name,\n        feature_display_name: quotaToDelete.feature_display_name,\n        deleted_quota: {\n          quota_limit: quotaToDelete.quota_limit,\n          is_unlimited: quotaToDelete.is_unlimited,\n          reset_period: quotaToDelete.reset_period,\n          description: quotaToDelete.description,\n          is_active: quotaToDelete.is_active\n        }\n      },\n      `Deleted global guest quota for ${quotaToDelete.service_name}.${quotaToDelete.feature_name}`\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: { deleted: true },\n      message: `Global quota deleted for ${quotaToDelete.service_display_name} - ${quotaToDelete.feature_display_name}`\n    });\n\n  } catch (error) {\n    console.error('DELETE /api/admin/quotas/global/[id] error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to delete global quota'\n      },\n      { status: 500 }\n    );\n  }\n} ",
    "language":"typescript",
    "lines":389,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/emojis/route.ts":{
    "content":"/**\n * Admin Emoji Management API\n * Handles comprehensive emoji management including approval, rejection, deletion, and filtering\n */\n\nimport { checkUserPermission } from '@/lib/actions/permissions.actions';\nimport { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { withRateLimit } from '@/lib/middleware/withRateLimit';\nimport { PERMISSIONS } from '@/lib/permissions/permissions';\nimport { AdminEmojiActionSchema, AdminEmojiSearchParamsSchema } from '@/lib/schemas/admin-emojis.schema';\nimport { NextRequest, NextResponse } from 'next/server';\nimport {\n    approveCustomEmoji,\n    deleteCustomEmoji,\n    getPendingCustomEmojis,\n    rejectCustomEmoji\n} from '../../../../lib/actions/emoji.actions';\n\ninterface CustomEmoji {\n  id: number;\n  name: string;\n  description: string;\n  category: string;\n  user_id: number;\n  created_at: string;\n  creator_email: string;\n  image_data: string | null;\n  approval_status?: 'pending' | 'approved' | 'rejected';\n  reviewed_by?: number;\n  reviewed_at?: string;\n  review_notes?: string;\n}\n\n// GET /api/admin/emojis - Get emojis for admin management\nasync function getHandler(request: NextRequest) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userId = parseInt(session.user.id);\n\n    // Check if user has permission to view emojis\n    const hasPermission = await checkUserPermission(\n      userId,\n      PERMISSIONS.ADMIN.EMOJI_APPROVE\n    );\n    if (!hasPermission) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 });\n    }\n\n    // Validate query parameters\n    const { searchParams } = new URL(request.url);\n    const paramsResult = AdminEmojiSearchParamsSchema.safeParse({\n      page: searchParams.get('page'),\n      limit: searchParams.get('limit'),\n      status: searchParams.get('status'),\n      search: searchParams.get('search'),\n    });\n\n    if (!paramsResult.success) {\n      return NextResponse.json(\n        { \n          error: 'Invalid query parameters',\n          details: paramsResult.error.errors \n        },\n        { status: 400 }\n      );\n    }\n\n    const { page, limit, status, search } = paramsResult.data;\n    const offset = (page - 1) * limit;\n\n    let emojis: CustomEmoji[] = [];\n    let totalCount = 0;\n\n    if (status === 'pending' || status === 'all') {\n      // Get pending emojis using existing server action\n      const pendingEmojis = await getPendingCustomEmojis(limit, offset);\n      emojis = pendingEmojis.map(emoji => ({\n        ...emoji,\n        approval_status: 'pending' as const\n      }));\n    }\n\n    if (status === 'approved' || status === 'rejected' || status === 'all') {\n      // Build where clause for approved/rejected emojis\n      let whereClause = sql`WHERE ce.is_approved IS NOT NULL`;\n      \n      if (status === 'approved') {\n        whereClause = sql`${whereClause} AND ce.is_approved = true`;\n      } else if (status === 'rejected') {\n        whereClause = sql`${whereClause} AND ce.is_approved = false`;\n      }\n\n      if (search) {\n        const searchTerm = `%${search.toLowerCase()}%`;\n        whereClause = sql`${whereClause} AND (\n          LOWER(ce.name) LIKE ${searchTerm} OR \n          LOWER(ce.description) LIKE ${searchTerm} OR\n          LOWER(u.email) LIKE ${searchTerm}\n        )`;\n      }\n\n      // Get approved/rejected emojis\n      const approvedRejectedEmojis = await sql<CustomEmoji[]>`\n        SELECT \n          ce.id, ce.name, ce.description, ce.encrypted_image_data,\n          ce.category_id::text as category, ce.user_id, ce.created_at,\n          u.email as creator_email,\n          CASE \n            WHEN ce.is_approved = true THEN 'approved'\n            WHEN ce.is_approved = false THEN 'rejected'\n            ELSE 'pending'\n          END as approval_status,\n          ce.approved_by as reviewed_by,\n          ce.approved_at as reviewed_at\n        FROM custom_emojis ce\n        JOIN users u ON ce.user_id = u.id\n        ${whereClause}\n        ORDER BY ce.created_at DESC\n        LIMIT ${limit} OFFSET ${offset}\n      `;\n\n      if (status === 'all') {\n        emojis = [...emojis, ...approvedRejectedEmojis];\n      } else {\n        emojis = approvedRejectedEmojis;\n      }\n    }\n\n    // Apply search filter to pending emojis if needed\n    if (search && (status === 'pending' || status === 'all')) {\n      emojis = emojis.filter(emoji => \n        emoji.name.toLowerCase().includes(search.toLowerCase()) ||\n        emoji.description?.toLowerCase().includes(search.toLowerCase()) ||\n        emoji.creator_email.toLowerCase().includes(search.toLowerCase())\n      );\n    }\n\n    // Get total count for pagination\n    if (status === 'all') {\n      const countResult = await sql<{ count: number }[]>`\n        SELECT COUNT(*) as count FROM custom_emojis\n      `;\n      totalCount = countResult[0]?.count || 0;\n    } else if (status === 'pending') {\n      const countResult = await sql<{ count: number }[]>`\n        SELECT COUNT(*) as count FROM custom_emojis WHERE is_approved IS NULL\n      `;\n      totalCount = countResult[0]?.count || 0;\n    } else {\n      const countResult = await sql<{ count: number }[]>`\n        SELECT COUNT(*) as count FROM custom_emojis \n        WHERE is_approved = ${status === 'approved'}\n      `;\n      totalCount = countResult[0]?.count || 0;\n    }\n\n    return NextResponse.json({\n      emojis,\n      pagination: {\n        page,\n        limit,\n        total: totalCount,\n        totalPages: Math.ceil(totalCount / limit),\n        hasNext: offset + limit < totalCount,\n        hasPrev: page > 1\n      }\n    });\n  } catch (error) {\n    console.error('Error fetching admin emojis:', error);\n    return NextResponse.json(\n      {\n        error: error instanceof Error ? error.message : 'Failed to fetch emojis'\n      },\n      {\n        status:\n          error instanceof Error && error.message.includes('permissions')\n            ? 403\n            : 500\n      }\n    );\n  }\n}\n\n// POST /api/admin/emojis - Approve or reject emoji\nasync function postHandler(request: NextRequest) {\n  try {\n    const body = await request.json();\n    \n    // Validate request body\n    const bodyResult = AdminEmojiActionSchema.safeParse(body);\n    if (!bodyResult.success) {\n      return NextResponse.json(\n        { \n          error: 'Invalid request data',\n          details: bodyResult.error.errors \n        },\n        { status: 400 }\n      );\n    }\n\n    const { emojiId, action, reason } = bodyResult.data;\n\n    if (action === 'approve') {\n      await approveCustomEmoji(emojiId, reason);\n      return NextResponse.json({\n        success: true,\n        message: 'Emoji approved successfully'\n      });\n    } else {\n      await rejectCustomEmoji(emojiId, reason!); // reason is validated by schema\n      return NextResponse.json({\n        success: true,\n        message: 'Emoji rejected successfully'\n      });\n    }\n  } catch (error) {\n    console.error('Error processing emoji:', error);\n    return NextResponse.json(\n      {\n        error:\n          error instanceof Error ? error.message : 'Failed to process emoji'\n      },\n      {\n        status:\n          error instanceof Error && error.message.includes('permissions')\n            ? 403\n            : 500\n      }\n    );\n  }\n}\n\n// DELETE /api/admin/emojis - Delete emoji\nasync function deleteHandler(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const emojiId = parseInt(searchParams.get('id') || '0');\n    const reason = searchParams.get('reason') || 'Deleted by admin';\n\n    if (!emojiId) {\n      return NextResponse.json(\n        { error: 'Emoji ID is required' },\n        { status: 400 }\n      );\n    }\n\n    await deleteCustomEmoji(emojiId, reason);\n\n    return NextResponse.json({\n      success: true,\n      message: 'Emoji deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting emoji:', error);\n    return NextResponse.json(\n      {\n        error: error instanceof Error ? error.message : 'Failed to delete emoji'\n      },\n      {\n        status:\n          error instanceof Error && error.message.includes('permissions')\n            ? 403\n            : 500\n      }\n    );\n  }\n}\n\n// Apply rate limiting to handlers\nexport const GET = withRateLimit(getHandler);\nexport const POST = withRateLimit(postHandler);\nexport const DELETE = withRateLimit(deleteHandler);\n",
    "language":"typescript",
    "lines":278,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/permissions/[id]/route.ts":{
    "content":"/**\n * Admin Individual Permission Management API\n * Handles update, disable, archive operations for specific permissions\n * \n * @author System Wizard \ud83e\uddd9\u200d\u2642\ufe0f\n * @version 1.0.0\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { checkUserPermission } from '../../../../../lib/actions/permissions.actions';\nimport { auth } from '../../../../../lib/auth';\nimport sql from '../../../../../lib/db';\nimport { withRateLimit } from '../../../../../lib/middleware/withRateLimit';\nimport { PERMISSIONS } from '../../../../../lib/permissions/permissions';\n\nexport const runtime = 'nodejs';\n\n// ================================\n// SCHEMAS\n// ================================\n\nconst PermissionIdSchema = z.object({\n  id: z.coerce.number().positive(),\n});\n\nconst PermissionUpdateSchema = z.object({\n  display_name: z.string().min(1).max(200).optional(),\n  description: z.string().optional(),\n  category: z.string().min(1).max(50).optional(),\n  is_inheritable: z.boolean().optional(),\n  is_active: z.boolean().optional(),\n  risk_level: z.enum(['low', 'medium', 'high', 'critical']).optional(),\n  sort_order: z.number().min(0).optional(),\n  dependencies: z.array(z.string()).optional(),\n  metadata: z.record(z.any()).optional(),\n  reason: z.string().optional(),\n});\n\nconst PermissionArchiveSchema = z.object({\n  reason: z.string().min(1).max(500),\n});\n\n// ================================\n// HANDLERS\n// ================================\n\n/**\n * GET /api/admin/permissions/[id] - Get specific permission with details\n */\nasync function getHandler(request: NextRequest, { params }: { params: { id: string } }) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userId = parseInt(session.user.id);\n    const hasPermission = await checkUserPermission(userId, PERMISSIONS.ADMIN.PERMISSIONS_VIEW);\n    \n    if (!hasPermission) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 });\n    }\n\n    const { id } = PermissionIdSchema.parse({ id: params.id });\n\n    // Get permission with detailed stats\n    const permission = await sql`\n      SELECT \n        p.*,\n        COALESCE(role_stats.role_count, 0) as role_count,\n        COALESCE(user_stats.user_count, 0) as user_count,\n        COALESCE(usage_stats.recent_usage_count, 0) as recent_usage_count,\n        archived_by_user.name as archived_by_name,\n        archived_by_user.email as archived_by_email\n      FROM permissions p\n      LEFT JOIN (\n        SELECT permission_id, COUNT(*) as role_count\n        FROM role_permissions\n        WHERE is_active = TRUE\n        GROUP BY permission_id\n      ) role_stats ON p.id = role_stats.permission_id\n      LEFT JOIN (\n        SELECT permission_id, COUNT(*) as user_count\n        FROM user_permissions\n        WHERE is_active = TRUE AND granted = TRUE\n        GROUP BY permission_id\n      ) user_stats ON p.id = user_stats.permission_id\n      LEFT JOIN (\n        SELECT permission_id, COUNT(*) as recent_usage_count\n        FROM user_permissions\n        WHERE is_active = TRUE AND granted_at > CURRENT_TIMESTAMP - INTERVAL '30 days'\n        GROUP BY permission_id\n      ) usage_stats ON p.id = usage_stats.permission_id\n      LEFT JOIN users archived_by_user ON p.archived_by = archived_by_user.id\n      WHERE p.id = ${id}\n    `;\n\n    if (permission.length === 0) {\n      return NextResponse.json({ error: 'Permission not found' }, { status: 404 });\n    }\n\n    // Get roles that have this permission\n    const roles = await sql`\n      SELECT \n        ur.id, ur.name, ur.display_name, ur.role_color, ur.role_icon,\n        rp.granted_at, rp.granted_by, granted_by_user.name as granted_by_name\n      FROM role_permissions rp\n      JOIN user_roles ur ON rp.role_id = ur.id\n      LEFT JOIN users granted_by_user ON rp.granted_by = granted_by_user.id\n      WHERE rp.permission_id = ${id} AND rp.is_active = TRUE\n      ORDER BY ur.display_name\n    `;\n\n    // Get users with direct permission grants\n    const users = await sql`\n      SELECT \n        u.id, u.name, u.email, u.image,\n        up.granted, up.granted_at, up.expires_at, up.reason,\n        granted_by_user.name as granted_by_name\n      FROM user_permissions up\n      JOIN users u ON up.user_id = u.id\n      LEFT JOIN users granted_by_user ON up.granted_by = granted_by_user.id\n      WHERE up.permission_id = ${id} AND up.is_active = TRUE\n      ORDER BY up.granted_at DESC\n      LIMIT 20\n    `;\n\n    // Get recent audit history\n    const auditHistory = await sql`\n      SELECT \n        pa.action_type, pa.reason, pa.created_at,\n        u.name as admin_name, u.email as admin_email\n      FROM permissions_audit pa\n      LEFT JOIN users u ON pa.admin_user_id = u.id\n      WHERE pa.permission_id = ${id}\n      ORDER BY pa.created_at DESC\n      LIMIT 10\n    `;\n\n    return NextResponse.json({\n      permission: permission[0],\n      roles: roles,\n      users: users,\n      audit_history: auditHistory\n    });\n\n  } catch (error) {\n    console.error('Error fetching permission:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid permission ID', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to fetch permission' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PATCH /api/admin/permissions/[id] - Update permission\n */\nasync function patchHandler(request: NextRequest, { params }: { params: { id: string } }) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userId = parseInt(session.user.id);\n    const hasPermission = await checkUserPermission(userId, PERMISSIONS.ADMIN.PERMISSIONS_MANAGE);\n    \n    if (!hasPermission) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 });\n    }\n\n    const { id } = PermissionIdSchema.parse({ id: params.id });\n    const body = await request.json();\n    const data = PermissionUpdateSchema.parse(body);\n\n    // Check if permission exists\n    const existingPermission = await sql`\n      SELECT * FROM permissions WHERE id = ${id}\n    `;\n\n    if (existingPermission.length === 0) {\n      return NextResponse.json({ error: 'Permission not found' }, { status: 404 });\n    }\n\n    const permission = existingPermission[0];\n\n    // Check if it's a system permission and prevent certain changes\n    if (permission.is_system) {\n      if (data.is_active === false) {\n        return NextResponse.json(\n          { error: 'Cannot disable system permissions' },\n          { status: 403 }\n        );\n      }\n    }\n\n    // Get old data for audit\n    const oldData = permission;\n\n    // Update permission\n    const updatedPermission = await sql`\n      UPDATE permissions \n      SET \n        display_name = COALESCE(${data.display_name ?? null}, display_name),\n        description = COALESCE(${data.description ?? null}, description),\n        category = COALESCE(${data.category ?? null}, category),\n        is_inheritable = COALESCE(${data.is_inheritable ?? null}, is_inheritable),\n        is_active = COALESCE(${data.is_active ?? null}, is_active),\n        risk_level = COALESCE(${data.risk_level ?? null}, risk_level),\n        sort_order = COALESCE(${data.sort_order ?? null}, sort_order),\n        dependencies = COALESCE(${data.dependencies ?? null}, dependencies),\n        metadata = COALESCE(${data.metadata ? JSON.stringify(data.metadata) : null}, metadata),\n        updated_at = CURRENT_TIMESTAMP\n      WHERE id = ${id}\n      RETURNING *\n    `;\n\n    // Log the action\n    await sql`\n      INSERT INTO permissions_audit (\n        action_type, permission_id, admin_user_id, old_data, new_data, reason\n      ) VALUES (\n        'update', ${id}, ${userId}, \n        ${JSON.stringify(oldData)}, ${JSON.stringify(updatedPermission[0])}, \n        ${data.reason || 'Permission updated'}\n      )\n    `;\n\n    return NextResponse.json({\n      message: 'Permission updated successfully',\n      permission: updatedPermission[0]\n    });\n\n  } catch (error) {\n    console.error('Error updating permission:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to update permission' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/admin/permissions/[id] - Archive permission (soft delete)\n */\nasync function deleteHandler(request: NextRequest, { params }: { params: { id: string } }) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userId = parseInt(session.user.id);\n    const hasPermission = await checkUserPermission(userId, PERMISSIONS.ADMIN.PERMISSIONS_MANAGE);\n    \n    if (!hasPermission) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 });\n    }\n\n    const { id } = PermissionIdSchema.parse({ id: params.id });\n    const body = await request.json();\n    const { reason } = PermissionArchiveSchema.parse(body);\n\n    // Check if permission exists\n    const existingPermission = await sql`\n      SELECT * FROM permissions WHERE id = ${id}\n    `;\n\n    if (existingPermission.length === 0) {\n      return NextResponse.json({ error: 'Permission not found' }, { status: 404 });\n    }\n\n    const permission = existingPermission[0];\n\n    // Check if it's a system permission\n    if (permission.is_system) {\n      return NextResponse.json(\n        { error: 'Cannot archive system permissions' },\n        { status: 403 }\n      );\n    }\n\n    // Archive the permission (this also disables it)\n    const archivedPermission = await sql`\n      UPDATE permissions \n      SET \n        is_active = FALSE,\n        is_archived = TRUE,\n        archived_at = CURRENT_TIMESTAMP,\n        archived_by = ${userId},\n        archive_reason = ${reason},\n        updated_at = CURRENT_TIMESTAMP\n      WHERE id = ${id}\n      RETURNING *\n    `;\n\n    // Remove from all role assignments\n    await sql`\n      UPDATE role_permissions \n      SET \n        is_active = FALSE,\n        revoked_at = CURRENT_TIMESTAMP,\n        revoked_by = ${userId},\n        revoke_reason = 'Permission archived'\n      WHERE permission_id = ${id} AND is_active = TRUE\n    `;\n\n    // Remove from all user assignments\n    await sql`\n      UPDATE user_permissions \n      SET \n        is_active = FALSE,\n        revoked_at = CURRENT_TIMESTAMP,\n        revoked_by = ${userId},\n        revoke_reason = 'Permission archived'\n      WHERE permission_id = ${id} AND is_active = TRUE\n    `;\n\n    // Log the action\n    await sql`\n      INSERT INTO permissions_audit (\n        action_type, permission_id, admin_user_id, old_data, new_data, reason\n      ) VALUES (\n        'archive', ${id}, ${userId}, \n        ${JSON.stringify(permission)}, ${JSON.stringify(archivedPermission[0])}, \n        ${reason}\n      )\n    `;\n\n    return NextResponse.json({\n      message: 'Permission archived successfully',\n      permission: archivedPermission[0]\n    });\n\n  } catch (error) {\n    console.error('Error archiving permission:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to archive permission' },\n      { status: 500 }\n    );\n  }\n}\n\n// ================================\n// EXPORT HANDLERS\n// ================================\n\nexport const GET = withRateLimit(getHandler);\n\nexport const PATCH = withRateLimit(patchHandler);\n\nexport const DELETE = withRateLimit(deleteHandler); ",
    "language":"typescript",
    "lines":378,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/permissions/roles/route.ts":{
    "content":"/**\n * Admin Roles Management API\n * Handles comprehensive roles management with full CRUD operations\n * \n * @author System Wizard \ud83e\uddd9\u200d\u2642\ufe0f\n * @version 1.0.0\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { checkUserPermission } from '../../../../../lib/actions/permissions.actions';\nimport { auth } from '../../../../../lib/auth';\nimport sql from '../../../../../lib/db';\nimport { withRateLimit } from '../../../../../lib/middleware/withRateLimit';\nimport { PERMISSIONS } from '../../../../../lib/permissions/permissions';\n\nexport const runtime = 'nodejs';\n\n// ================================\n// SCHEMAS\n// ================================\n\nconst RoleSearchSchema = z.object({\n  search: z.string().optional(),\n  status: z.enum(['all', 'active', 'disabled', 'archived']).optional().default('all'),\n  sort_by: z.enum(['name', 'display_name', 'created_at', 'updated_at', 'user_count', 'permission_count', 'sort_order']).optional().default('sort_order'),\n  sort_order: z.enum(['asc', 'desc']).optional().default('asc'),\n  page: z.coerce.number().min(1).optional().default(1),\n  limit: z.coerce.number().min(1).max(100).optional().default(20),\n});\n\nconst RoleCreateSchema = z.object({\n  name: z.string().min(1).max(100).regex(/^[a-z0-9_-]+$/i, 'Invalid role name format'),\n  display_name: z.string().min(1).max(200),\n  description: z.string().optional(),\n  role_color: z.string().regex(/^#[0-9A-F]{6}$/i, 'Invalid hex color').optional().default('#6366F1'),\n  role_icon: z.string().min(1).max(50).optional().default('user'),\n  is_default: z.boolean().optional().default(false),\n  permissions: z.array(z.number()).optional().default([]),\n  metadata: z.record(z.any()).optional().default({}),\n  reason: z.string().optional(),\n});\n\nconst RoleUpdateSchema = z.object({\n  display_name: z.string().min(1).max(200).optional(),\n  description: z.string().optional(),\n  role_color: z.string().regex(/^#[0-9A-F]{6}$/i, 'Invalid hex color').optional(),\n  role_icon: z.string().min(1).max(50).optional(),\n  is_active: z.boolean().optional(),\n  is_default: z.boolean().optional(),\n  sort_order: z.number().min(0).optional(),\n  permissions: z.array(z.number()).optional(),\n  metadata: z.record(z.any()).optional(),\n  reason: z.string().optional(),\n});\n\nconst RoleArchiveSchema = z.object({\n  reason: z.string().min(1).max(500),\n});\n\nconst RolePermissionUpdateSchema = z.object({\n  permission_ids: z.array(z.number()),\n  reason: z.string().optional(),\n});\n\n// ================================\n// HANDLERS\n// ================================\n\n/**\n * GET /api/admin/permissions/roles - Get roles with search, filtering, and pagination\n */\nasync function getHandler(request: NextRequest) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userId = parseInt(session.user.id);\n    const hasPermission = await checkUserPermission(userId, PERMISSIONS.ADMIN.ROLES_VIEW);\n    \n    if (!hasPermission) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const params = RoleSearchSchema.parse(Object.fromEntries(searchParams));\n\n    // Build base query\n    let baseQuery = sql`\n      SELECT \n        ur.*,\n        COALESCE(user_stats.user_count, 0) as user_count,\n        COALESCE(permission_stats.permission_count, 0) as permission_count,\n        archived_by_user.name as archived_by_name,\n        archived_by_user.email as archived_by_email\n      FROM user_roles ur\n      LEFT JOIN (\n        SELECT role_id, COUNT(*) as user_count\n        FROM user_role_assignments\n        WHERE is_active = TRUE\n        GROUP BY role_id\n      ) user_stats ON ur.id = user_stats.role_id\n      LEFT JOIN (\n        SELECT role_id, COUNT(*) as permission_count\n        FROM role_permissions\n        WHERE is_active = TRUE\n        GROUP BY role_id\n      ) permission_stats ON ur.id = permission_stats.role_id\n      LEFT JOIN users archived_by_user ON ur.archived_by = archived_by_user.id\n    `;\n\n    // Add search filtering\n    if (params.search) {\n      baseQuery = sql`\n        ${baseQuery}\n        WHERE (ur.name ILIKE ${'%' + params.search + '%'} \n               OR ur.display_name ILIKE ${'%' + params.search + '%'} \n               OR ur.description ILIKE ${'%' + params.search + '%'})\n      `;\n    }\n\n    // Add status filtering\n    if (params.status !== 'all') {\n      const statusCondition = params.status === 'active' ? \n        sql`ur.is_active = TRUE AND ur.is_archived = FALSE` :\n        params.status === 'disabled' ?\n        sql`ur.is_active = FALSE AND ur.is_archived = FALSE` :\n        sql`ur.is_archived = TRUE`;\n      \n      baseQuery = params.search ? \n        sql`${baseQuery} AND ${statusCondition}` :\n        sql`${baseQuery} WHERE ${statusCondition}`;\n    }\n\n    // Add sorting\n    let sortField;\n    if (params.sort_by === 'user_count') {\n      sortField = 'user_count';\n    } else if (params.sort_by === 'permission_count') {\n      sortField = 'permission_count';\n    } else if (params.sort_by === 'sort_order') {\n      sortField = 'ur.sort_order';\n    } else if (params.sort_by === 'display_name') {\n      sortField = 'ur.display_name';\n    } else if (params.sort_by === 'created_at') {\n      sortField = 'ur.created_at';\n    } else {\n      sortField = `ur.${params.sort_by}`;\n    }\n    const sortOrder = params.sort_order.toUpperCase();\n    \n    // Calculate offset\n    const offset = (params.page - 1) * params.limit;\n\n    // Execute query with pagination\n    const roles = await sql`\n      ${baseQuery}\n      ORDER BY ${sql.unsafe(sortField)} ${sql.unsafe(sortOrder)}\n      LIMIT ${params.limit} OFFSET ${offset}\n    `;\n\n    // Get total count with same filtering as main query\n    let countQuery = sql`SELECT COUNT(*) as total FROM user_roles ur`;\n    \n    // Apply same search filtering to count\n    if (params.search) {\n      countQuery = sql`\n        SELECT COUNT(*) as total FROM user_roles ur\n        WHERE (ur.name ILIKE ${'%' + params.search + '%'} \n               OR ur.display_name ILIKE ${'%' + params.search + '%'} \n               OR ur.description ILIKE ${'%' + params.search + '%'})\n      `;\n    }\n\n    // Apply same status filtering to count\n    if (params.status !== 'all') {\n      const statusCondition = params.status === 'active' ? \n        sql`ur.is_active = TRUE AND ur.is_archived = FALSE` :\n        params.status === 'disabled' ?\n        sql`ur.is_active = FALSE AND ur.is_archived = FALSE` :\n        sql`ur.is_archived = TRUE`;\n      \n      countQuery = params.search ? \n        sql`${countQuery} AND ${statusCondition}` :\n        sql`${countQuery} WHERE ${statusCondition}`;\n    }\n\n    const countResult = await countQuery;\n    const totalCount = parseInt(countResult[0].total);\n\n    // Get permissions for each role\n    const rolesWithPermissions = await Promise.all(\n      roles.map(async (role) => {\n        const permissions = await sql`\n          SELECT \n            p.id, p.name, p.display_name, p.category, p.risk_level,\n            rp.granted_at, granted_by_user.name as granted_by_name\n          FROM role_permissions rp\n          JOIN permissions p ON rp.permission_id = p.id\n          LEFT JOIN users granted_by_user ON rp.granted_by = granted_by_user.id\n          WHERE rp.role_id = ${role.id} AND rp.is_active = TRUE\n          ORDER BY p.category, p.display_name\n        `;\n\n        return {\n          ...role,\n          permissions: permissions\n        };\n      })\n    );\n\n    return NextResponse.json({\n      roles: rolesWithPermissions,\n      pagination: {\n        page: params.page,\n        limit: params.limit,\n        total: totalCount,\n        pages: Math.ceil(totalCount / params.limit),\n        has_more: offset + roles.length < totalCount\n      }\n    });\n\n  } catch (error) {\n    console.error('Error fetching roles:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request parameters', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to fetch roles' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/admin/permissions/roles - Create new role\n */\nasync function postHandler(request: NextRequest) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userId = parseInt(session.user.id);\n    const hasPermission = await checkUserPermission(userId, PERMISSIONS.ADMIN.ROLES_MANAGE);\n    \n    if (!hasPermission) {\n      return NextResponse.json({ error: 'Insufficient permissions' }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const data = RoleCreateSchema.parse(body);\n\n    // Check if role name already exists\n    const existingRole = await sql`\n      SELECT id FROM user_roles WHERE name = ${data.name}\n    `;\n\n    if (existingRole.length > 0) {\n      return NextResponse.json(\n        { error: 'Role name already exists' },\n        { status: 409 }\n      );\n    }\n\n    // If setting as default, unset other defaults\n    if (data.is_default) {\n      await sql`\n        UPDATE user_roles SET is_default = FALSE WHERE is_default = TRUE\n      `;\n    }\n\n    // Create role\n    const newRole = await sql`\n      INSERT INTO user_roles (\n        name, display_name, description, role_color, role_icon, \n        is_default, metadata, is_system, created_at, updated_at\n      ) VALUES (\n        ${data.name}, ${data.display_name}, ${data.description || null},\n        ${data.role_color}, ${data.role_icon}, ${data.is_default},\n        ${JSON.stringify(data.metadata)}, false,\n        CURRENT_TIMESTAMP, CURRENT_TIMESTAMP\n      ) RETURNING *\n    `;\n\n    const roleId = newRole[0].id;\n\n    // Assign permissions to role\n    if (data.permissions.length > 0) {\n      const permissionInserts = data.permissions.map(permissionId => \n        sql`\n          INSERT INTO role_permissions (role_id, permission_id, granted_by, granted_at)\n          VALUES (${roleId}, ${permissionId}, ${userId}, CURRENT_TIMESTAMP)\n        `\n      );\n      \n      await Promise.all(permissionInserts);\n    }\n\n    // Log the action\n    await sql`\n      INSERT INTO roles_audit (\n        action_type, role_id, admin_user_id, new_data, reason\n      ) VALUES (\n        'create', ${roleId}, ${userId}, ${JSON.stringify(newRole[0])}, ${data.reason || 'New role created'}\n      )\n    `;\n\n    return NextResponse.json({\n      message: 'Role created successfully',\n      role: newRole[0]\n    }, { status: 201 });\n\n  } catch (error) {\n    console.error('Error creating role:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to create role' },\n      { status: 500 }\n    );\n  }\n}\n\n// ================================\n// EXPORT HANDLERS\n// ================================\n\nexport const GET = withRateLimit(getHandler);\n\nexport const POST = withRateLimit(postHandler); ",
    "language":"typescript",
    "lines":345,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/users/route.ts":{
    "content":"/**\n * @swagger\n * /api/admin/users:\n *   get:\n *     summary: Get users for admin management\n *     description: Retrieve a paginated list of users with comprehensive information for admin management\n *     tags:\n *       - Admin\n *     security:\n *       - NextAuth: []\n *     parameters:\n *       - in: query\n *         name: page\n *         schema:\n *           type: integer\n *           default: 1\n *         description: Page number for pagination\n *       - in: query\n *         name: limit\n *         schema:\n *           type: integer\n *           default: 20\n *           maximum: 100\n *         description: Number of users per page\n *       - in: query\n *         name: search\n *         schema:\n *           type: string\n *         description: Search term to filter users by name, email, or provider\n *     responses:\n *       200:\n *         description: Successfully retrieved users\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 users:\n *                   type: array\n *                   items:\n *                     $ref: '#/components/schemas/AdminUser'\n *                 currentPage:\n *                   type: integer\n *                 totalPages:\n *                   type: integer\n *                 pagination:\n *                   type: object\n *                   properties:\n *                     page:\n *                       type: integer\n *                     limit:\n *                       type: integer\n *                     total:\n *                       type: integer\n *                     totalPages:\n *                       type: integer\n *                     hasNext:\n *                       type: boolean\n *                     hasPrev:\n *                       type: boolean\n *       400:\n *         description: Invalid query parameters\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 error:\n *                   type: string\n *                 details:\n *                   type: array\n *                   items:\n *                     type: object\n *       401:\n *         description: Authentication required\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Error'\n *       403:\n *         description: Insufficient permissions (admin required)\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Error'\n *       500:\n *         description: Internal server error\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Error'\n */\n\n/**\n * Admin User Management API\n * Handles user listing, searching, and basic management operations\n */\n\nimport { withUserPermissions } from '@/lib/api/wrappers/withUserPermissions';\nimport { withUserRoles } from '@/lib/api/wrappers/withUserRoles';\nimport { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { createLogger } from '@/lib/logging';\nimport { withRateLimit } from '@/lib/middleware/withRateLimit';\nimport { AdminUserSearchParamsSchema } from '@/lib/schemas/admin-users.schema';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\nexport const runtime = 'nodejs';\nexport const dynamic = 'force-dynamic';\n\nconst logger = createLogger({ \n  context: { \n    component: 'admin-users-api',\n    context: 'server' \n  } \n});\n\nexport interface AdminUser {\n  id: number;\n  name: string | null;\n  email: string;\n  image: string | null;\n  created_at: string;\n  profile_public?: boolean;\n  bio?: string;\n  location?: string;\n  last_login?: string | null;\n  login_count?: number;\n  is_active?: boolean;\n  admin_notes?: string | null;\n  // Auth provider info\n  provider_name?: string | null;\n  provider_email?: string | null;\n  provider_verified?: boolean;\n  provider_last_used?: string | null;\n  // Role summary\n  role_count?: number;\n  role_names?: string | null;\n  has_admin?: boolean;\n  has_moderator?: boolean;\n  // Subscription summary\n  subscription_count?: number;\n  active_subscriptions?: number;\n  subscription_names?: string | null;\n  has_active_subscription?: boolean;\n  // Timeout status\n  is_timed_out?: boolean;\n  timeout_count?: number;\n  active_timeout_reason?: string | null;\n  timeout_expires?: string | null;\n  active_timeout_id?: number | null;\n}\n\n// GET /api/admin/users - Get users for admin management\nasync function getHandler(request: NextRequest) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      logger.error('No session or user ID found');\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const userId = parseInt(session.user.id);\n    logger.info('User requesting admin users', { userId });\n\n    // Validate query parameters\n    const { searchParams } = new URL(request.url);\n    const paramsResult = AdminUserSearchParamsSchema.safeParse({\n      page: searchParams.get('page'),\n      limit: searchParams.get('limit'),\n      search: searchParams.get('search'),\n    });\n\n    if (!paramsResult.success) {\n      return NextResponse.json(\n        { \n          error: 'Invalid query parameters',\n          details: paramsResult.error.errors \n        },\n        { status: 400 }\n      );\n    }\n\n    const { page, limit, search } = paramsResult.data;\n    const offset = (page - 1) * limit;\n\n    logger.info('Processing validated query parameters', { page, limit, search, offset });\n\n    // Build search query\n    let whereClause = sql`WHERE 1=1`;\n    if (search) {\n      const searchTerm = `%${search.toLowerCase()}%`;\n      whereClause = sql`${whereClause} AND (\n        LOWER(u.name) LIKE ${searchTerm} OR \n        LOWER(u.email) LIKE ${searchTerm} OR\n        LOWER(pp.provider_name) LIKE ${searchTerm}\n      )`;\n    }\n\n    // Get users with comprehensive information using new helper functions\n    const users = await sql<AdminUser[]>`\n      SELECT \n        u.id, \n        u.name, \n        u.email, \n        u.image, \n        u.created_at,\n        u.profile_public, \n        u.bio, \n        u.location,\n        u.last_login,\n        u.login_count,\n        u.is_active,\n        u.admin_notes,\n        -- Auth provider info\n        pp.provider_name,\n        pp.provider_email,\n        pp.provider_verified,\n        pp.last_used as provider_last_used,\n        -- Role summary\n        rs.role_count,\n        rs.role_names,\n        rs.has_admin,\n        rs.has_moderator,\n        -- Subscription summary\n        ss.subscription_count,\n        ss.active_subscriptions,\n        ss.subscription_names,\n        ss.has_active_subscription,\n        -- Timeout status\n        ts.is_timed_out,\n        ts.timeout_count,\n        ts.active_timeout_reason,\n        ts.timeout_expires,\n        ts.active_timeout_id\n      FROM users u\n      LEFT JOIN LATERAL get_user_primary_provider(u.id) pp ON true\n      LEFT JOIN LATERAL get_user_role_summary(u.id) rs ON true\n      LEFT JOIN LATERAL get_user_subscription_summary(u.id) ss ON true\n      LEFT JOIN LATERAL get_user_timeout_status(u.id) ts ON true\n      ${whereClause}\n      ORDER BY u.created_at DESC\n      LIMIT ${limit} OFFSET ${offset}\n    `;\n\n    logger.info('Users query completed', { foundUsers: users.length });\n\n    // Get total count for pagination\n    const totalResult = await sql<{ count: number }[]>`\n      SELECT COUNT(*) as count \n      FROM users u\n      LEFT JOIN LATERAL get_user_primary_provider(u.id) pp ON true\n      ${whereClause}\n    `;\n    const total = totalResult[0]?.count || 0;\n\n    logger.info('Total users count retrieved', { total });\n\n    const response = {\n      users,\n      currentPage: page,\n      totalPages: Math.ceil(total / limit),\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit),\n        hasNext: offset + limit < total,\n        hasPrev: page > 1\n      }\n    };\n\n    logger.info('API Response prepared', { \n      userCount: users.length, \n      currentPage: response.currentPage, \n      totalPages: response.totalPages \n    });\n\n    return NextResponse.json(response);\n  } catch (error) {\n    logger.error('Error fetching admin users', error instanceof Error ? error : new Error(String(error)));\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to fetch users', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n\n// Apply rate limiting and permission wrappers to handlers\nexport const GET = withUserRoles(withUserPermissions(withRateLimit(getHandler)));",
    "language":"typescript",
    "lines":299,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/users/[id]/quotas/route.ts":{
    "content":"/**\n * Individual User Quota Management API\n * \n * Provides secure endpoints for managing specific user quota settings\n * with integration to the enhanced quota system.\n * \n * @version 1.0.0\n * @author System\n */\n\nimport { withUserPermissions } from '@/lib/api/wrappers/withUserPermissions';\nimport { withUserRoles } from '@/lib/api/wrappers/withUserRoles';\nimport { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { withRateLimit } from '@/lib/middleware/withRateLimit';\nimport { EnhancedQuotaService } from '@/lib/services/EnhancedQuotaService';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\n// ================================\n// TYPES & SCHEMAS\n// ================================\n\ninterface UserQuotaData {\n  service_name: string;\n  feature_name: string;\n  display_name: string;\n  current_usage: number;\n  quota_limit: number;\n  is_unlimited: boolean;\n  is_custom: boolean;\n  reset_date: string;\n  quota_source: string;\n  reset_period: string;\n}\n\ninterface UserQuotaOverride {\n  id: number;\n  user_id: number;\n  service_name: string;\n  feature_name: string;\n  quota_limit: number;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n  reason: string | null;\n  created_by: number;\n  created_at: string;\n  updated_at: string;\n}\n\nconst UpdateUserQuotaSchema = z.object({\n  service_name: z.string().min(1),\n  feature_name: z.string().min(1),\n  quota_limit: z.number().int().min(0).optional(),\n  is_unlimited: z.boolean().default(false),\n  reset_period: z.enum(['hourly', 'daily', 'weekly', 'monthly']).optional(),\n  reset_usage: z.boolean().default(false),\n  reason: z.string().max(500).optional()\n}).transform((data) => {\n  // If quota_limit is 0, treat as unlimited\n  if (data.quota_limit === 0) {\n    return {\n      ...data,\n      is_unlimited: true\n    };\n  }\n  return data;\n});\n\nconst ResetUserQuotaSchema = z.object({\n  service_name: z.string().min(1),\n  feature_name: z.string().min(1),\n  reason: z.string().max(500).optional()\n});\n\ninterface ApiResponse<T> {\n  success: true;\n  data: T;\n  message?: string;\n}\n\ninterface ErrorResponse {\n  success: false;\n  error: string;\n  message?: string;\n  data?: any;\n}\n\n// ================================\n// HELPER FUNCTIONS\n// ================================\n\nasync function validateAdminAccess(userId: string): Promise<boolean> {\n  try {\n    const adminCheck = await sql`\n      SELECT ura.role_id, ur.name as role_name\n      FROM user_role_assignments ura\n      JOIN user_roles ur ON ura.role_id = ur.id\n      WHERE ura.user_id = ${userId}\n      AND ur.name IN ('admin', 'moderator')\n      AND ura.is_active = true\n      AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n      LIMIT 1\n    `;\n    return adminCheck.length > 0;\n  } catch (error) {\n    console.error('Admin validation error:', error);\n    return false;\n  }\n}\n\nasync function validateUserExists(userId: string): Promise<boolean> {\n  try {\n    const userCheck = await sql`\n      SELECT EXISTS(SELECT 1 FROM users WHERE id = ${userId}) as user_exists\n    `;\n    return userCheck[0]?.user_exists || false;\n  } catch (error) {\n    console.error('User validation error:', error);\n    return false;\n  }\n}\n\nasync function logAdminAction(\n  adminUserId: string,\n  action: string,\n  details: any,\n  reason?: string\n): Promise<void> {\n  try {\n    await sql`\n      INSERT INTO admin_actions (\n        admin_user_id, action_type, action_details, reason, created_at\n      ) VALUES (\n        ${adminUserId}, ${action}, ${JSON.stringify(details)}, ${reason || null}, NOW()\n      )\n    `;\n  } catch (error) {\n    console.error('Failed to log admin action:', error);\n  }\n}\n\n// ================================\n// API HANDLERS\n// ================================\n\n/**\n * GET /api/admin/users/[id]/quotas\n * Retrieves comprehensive quota information for a specific user\n */\nasync function getHandler(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n): Promise<NextResponse<ApiResponse<{ quotas: UserQuotaData[] }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Validate user exists\n    const userExists = await validateUserExists(params.id);\n    if (!userExists) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    // Get comprehensive quota info using EnhancedQuotaService\n    const quotaInfo = await EnhancedQuotaService.getUserQuotaInfo(parseInt(params.id));\n    \n    // Get additional display information for proper names\n    const serviceFeatures = await sql`\n      SELECT \n        ss.name as service_name,\n        sf.name as feature_name,\n        ss.display_name as service_display_name,\n        sf.display_name as feature_display_name\n      FROM subscription_services ss\n      JOIN subscription_features sf ON ss.id = sf.service_id\n      WHERE sf.feature_type = 'limit' AND ss.is_active = true\n    `;\n\n    // Transform quota info to admin panel format\n    const quotaData: UserQuotaData[] = quotaInfo.map(info => {\n      const serviceFeature = serviceFeatures.find(\n        sf => sf.service_name === info.service_name && sf.feature_name === info.feature_name\n      );\n\n      return {\n        service_name: info.service_name,\n        feature_name: info.feature_name,\n        display_name: serviceFeature ? \n          `${serviceFeature.service_display_name} - ${serviceFeature.feature_display_name}` : \n          `${info.service_name} - ${info.feature_name}`,\n        current_usage: info.current_usage,\n        quota_limit: info.quota_limit,\n        is_unlimited: info.is_unlimited,\n        is_custom: info.quota_source === 'user_override',\n        reset_date: info.reset_date?.toISOString() || new Date(Date.now() + 86400000).toISOString(),\n        quota_source: info.quota_source,\n        reset_period: info.reset_period\n      };\n    });\n\n    return NextResponse.json({\n      success: true,\n      data: { quotas: quotaData },\n      message: `Retrieved ${quotaData.length} quota entries for user`\n    });\n\n  } catch (error) {\n    console.error('GET /api/admin/users/[id]/quotas error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to retrieve user quotas'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// Apply rate limiting to handler\nexport const GET = withRateLimit(getHandler);\n\n/**\n * PATCH /api/admin/users/[id]/quotas\n * Updates or creates a user quota override\n */\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n): Promise<NextResponse<ApiResponse<{ override: UserQuotaOverride }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Validate user exists\n    const userExists = await validateUserExists(params.id);\n    if (!userExists) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const validationResult = UpdateUserQuotaSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Invalid request data',\n          data: validationResult.error.issues \n        },\n        { status: 400 }\n      );\n    }\n\n    const { service_name, feature_name, quota_limit, is_unlimited, reset_period, reset_usage, reason } = validationResult.data;\n\n    // Verify service and feature exist\n    const serviceFeatureExists = await sql`\n      SELECT ss.display_name as service_display_name, sf.display_name as feature_display_name\n      FROM subscription_services ss\n      JOIN subscription_features sf ON ss.id = sf.service_id\n      WHERE ss.name = ${service_name} AND sf.name = ${feature_name}\n      AND ss.is_active = true\n    `;\n\n    if (serviceFeatureExists.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Service or feature not found or inactive' },\n        { status: 404 }\n      );\n    }\n\n    // Calculate final quota limit - treat 0 as unlimited\n    const finalIsUnlimited = is_unlimited || quota_limit === 0;\n    const finalQuotaLimit = finalIsUnlimited ? -1 : (quota_limit || 1);\n    const finalResetPeriod = reset_period || 'monthly';\n\n    // Check if override already exists\n    const existingOverride = await sql`\n      SELECT id FROM user_quota_overrides\n      WHERE user_id = ${params.id} \n      AND service_name = ${service_name} \n      AND feature_name = ${feature_name}\n    `;\n\n    let override;\n    \n    if (existingOverride.length > 0) {\n      // Update existing override\n      override = await sql`\n        UPDATE user_quota_overrides \n        SET \n          quota_limit = ${finalQuotaLimit},\n          is_unlimited = ${finalIsUnlimited},\n          reset_period = ${finalResetPeriod},\n          reason = ${reason || null},\n          updated_at = NOW()\n        WHERE id = ${existingOverride[0].id}\n        RETURNING *\n      `;\n    } else {\n      // Create new override\n      override = await sql`\n        INSERT INTO user_quota_overrides (\n          user_id, service_name, feature_name, quota_limit, \n          is_unlimited, reset_period, reason, created_by, is_active\n        ) VALUES (\n          ${params.id}, ${service_name}, ${feature_name}, ${finalQuotaLimit},\n          ${finalIsUnlimited}, ${finalResetPeriod}, ${reason || null}, ${session.user.id}, true\n        )\n        RETURNING *\n      `;\n    }\n\n    // Reset usage if requested\n    if (reset_usage) {\n      await sql`\n        DELETE FROM subscription_usage\n        WHERE user_id = ${params.id}\n        AND service_id IN (\n          SELECT ss.id FROM subscription_services ss WHERE ss.name = ${service_name}\n        )\n        AND feature_id IN (\n          SELECT sf.id FROM subscription_features sf \n          JOIN subscription_services ss ON sf.service_id = ss.id\n          WHERE ss.name = ${service_name} AND sf.name = ${feature_name}\n        )\n      `;\n    }\n\n    // Log the admin action\n    await logAdminAction(\n      session.user.id,\n      'user_quota_override',\n      {\n        target_user_id: params.id,\n        service_name,\n        feature_name,\n        quota_limit: finalQuotaLimit,\n        is_unlimited,\n        reset_period: finalResetPeriod,\n        reset_usage,\n        service_display_name: serviceFeatureExists[0].service_display_name,\n        feature_display_name: serviceFeatureExists[0].feature_display_name\n      },\n      reason || `Updated quota override for ${service_name}.${feature_name}${reset_usage ? ' (usage reset)' : ''}`\n    );\n\n    const actionType = existingOverride.length > 0 ? 'updated' : 'created';\n    const serviceName = serviceFeatureExists[0].service_display_name;\n    const featureName = serviceFeatureExists[0].feature_display_name;\n\n    return NextResponse.json({\n      success: true,\n      data: { override: override[0] as unknown as UserQuotaOverride },\n      message: `Quota override ${actionType} for ${serviceName} - ${featureName}`\n    });\n\n  } catch (error) {\n    console.error('PATCH /api/admin/users/[id]/quotas error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to update user quota'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// export default handler;\nexport default withUserRoles(withUserPermissions(handler)); ",
    "language":"typescript",
    "lines":412,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/users/[id]/quotas/reset/route.ts":{
    "content":"/**\n * User Quota Reset API\n * \n * Provides secure endpoint for resetting user quota usage counts\n * while preserving the quota limits themselves.\n * \n * @version 1.0.0\n * @author System\n */\n\nimport { withUserPermissions } from '@/lib/api/wrappers/withUserPermissions';\nimport { withUserRoles } from '@/lib/api/wrappers/withUserRoles';\nimport { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { withRateLimit } from '@/lib/middleware/withRateLimit';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\n// ================================\n// TYPES & SCHEMAS\n// ================================\n\nconst ResetUserQuotaSchema = z.object({\n  service_name: z.string().min(1),\n  feature_name: z.string().min(1),\n  reason: z.string().max(500).optional()\n});\n\ninterface ApiResponse<T> {\n  success: true;\n  data: T;\n  message?: string;\n}\n\ninterface ErrorResponse {\n  success: false;\n  error: string;\n  message?: string;\n  data?: any;\n}\n\n// ================================\n// HELPER FUNCTIONS\n// ================================\n\nasync function validateUserExists(userId: string): Promise<boolean> {\n  try {\n    const userCheck = await sql`\n      SELECT EXISTS(SELECT 1 FROM users WHERE id = ${userId}) as user_exists\n    `;\n    return userCheck[0]?.user_exists || false;\n  } catch (error) {\n    console.error('User validation error:', error);\n    return false;\n  }\n}\n\nasync function logAdminAction(\n  adminUserId: string,\n  action: string,\n  details: any,\n  reason?: string\n): Promise<void> {\n  try {\n    await sql`\n      INSERT INTO admin_actions (\n        admin_user_id, action_type, action_details, reason, created_at\n      ) VALUES (\n        ${adminUserId}, ${action}, ${JSON.stringify(details)}, ${reason || null}, NOW()\n      )\n    `;\n  } catch (error) {\n    console.error('Failed to log admin action:', error);\n  }\n}\n\n// ================================\n// API HANDLERS\n// ================================\n\n/**\n * POST /api/admin/users/[id]/quotas/reset\n * Resets user quota usage counts to zero while preserving limits\n */\nasync function postHandler(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n): Promise<NextResponse<ApiResponse<{ reset: boolean; previous_usage: number }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate user exists\n    const userExists = await validateUserExists(params.id);\n    if (!userExists) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const validationResult = ResetUserQuotaSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Invalid request data',\n          data: validationResult.error.issues \n        },\n        { status: 400 }\n      );\n    }\n\n    const { service_name, feature_name, reason } = validationResult.data;\n\n    // Verify service and feature exist\n    const serviceFeatureExists = await sql`\n      SELECT ss.display_name as service_display_name, sf.display_name as feature_display_name\n      FROM subscription_services ss\n      JOIN subscription_features sf ON ss.id = sf.service_id\n      WHERE ss.name = ${service_name} AND sf.name = ${feature_name}\n      AND ss.is_active = true\n    `;\n\n    if (serviceFeatureExists.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Service or feature not found or inactive' },\n        { status: 404 }\n      );\n    }\n\n    // Get current usage before reset\n    const currentUsage = await sql`\n      SELECT COALESCE(SUM(su.usage_count), 0) as total_usage\n      FROM subscription_usage su\n      JOIN subscription_services ss ON su.service_id = ss.id\n      JOIN subscription_features sf ON su.feature_id = sf.id\n      WHERE su.user_id = ${params.id}\n      AND ss.name = ${service_name}\n      AND sf.name = ${feature_name}\n      AND su.usage_date >= CURRENT_DATE\n    `;\n\n    const previousUsage = parseInt(currentUsage[0]?.total_usage || '0');\n\n    // Reset usage in subscription_usage table (for authenticated users)\n    const resetResult = await sql`\n      DELETE FROM subscription_usage\n      WHERE user_id = ${params.id}\n      AND service_id IN (\n        SELECT ss.id FROM subscription_services ss WHERE ss.name = ${service_name}\n      )\n      AND feature_id IN (\n        SELECT sf.id FROM subscription_features sf \n        JOIN subscription_services ss ON sf.service_id = ss.id\n        WHERE ss.name = ${service_name} AND sf.name = ${feature_name}\n      )\n      AND usage_date >= CURRENT_DATE\n    `;\n\n    // Also reset guest usage if this user has IP-based records\n    // (in case they were using the system before logging in)\n    const userInfo = await sql`\n      SELECT email FROM users WHERE id = ${params.id}\n    `;\n\n    if (userInfo.length > 0) {\n      await sql`\n        DELETE FROM guest_usage\n        WHERE email = ${userInfo[0].email}\n        AND service_name = ${service_name}\n        AND feature_name = ${feature_name}\n        AND usage_date >= CURRENT_DATE\n      `;\n    }\n\n    // Log the admin action\n    await logAdminAction(\n      session.user.id,\n      'user_quota_reset',\n      {\n        target_user_id: params.id,\n        service_name,\n        feature_name,\n        previous_usage: previousUsage,\n        service_display_name: serviceFeatureExists[0].service_display_name,\n        feature_display_name: serviceFeatureExists[0].feature_display_name\n      },\n      reason || `Reset quota usage for ${service_name}.${feature_name}`\n    );\n\n    const serviceName = serviceFeatureExists[0].service_display_name;\n    const featureName = serviceFeatureExists[0].feature_display_name;\n\n    return NextResponse.json({\n      success: true,\n      data: { \n        reset: true, \n        previous_usage: previousUsage \n      },\n      message: `Quota usage reset for ${serviceName} - ${featureName} (was: ${previousUsage})`\n    });\n\n  } catch (error) {\n    console.error('POST /api/admin/users/[id]/quotas/reset error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to reset user quota'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// Apply rate limiting and permission wrappers to handlers\nexport const POST = withUserRoles(withUserPermissions(withRateLimit(postHandler))); ",
    "language":"typescript",
    "lines":227,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/users/[id]/assign-subscription/route.ts":{
    "content":"/**\n * Admin User Subscription Management API\n * Handles assigning and managing user subscriptions\n */\n\nimport sql from '@/lib/db';\nimport { withUserPermissions } from '@lib/api/wrappers/withUserPermissions';\nimport { withUserRoles } from '@lib/api/wrappers/withUserRoles';\nimport { auth } from '@lib/auth';\nimport { AdminSubscriptionAssignmentSchema, AdminSubscriptionCancelParamsSchema, AdminSubscriptionUpdateSchema } from '@lib/schemas/admin-subscriptions.schema';\nimport { NextRequest, NextResponse } from 'next/server';\nimport z from 'zod';\n\nexport interface SubscriptionAssignmentRequest {\n  planId: number;\n  billingCycle?: string;\n  expiresAt?: string;\n  status?: string;\n  reason?: string;\n}\n\n// POST /api/admin/users/[id]/assign-subscription - Assign subscription to user\nasync function postHandler(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const adminUserId = parseInt(session.user.id);\n    const targetUserId = parseInt(params.id);\n\n    if (isNaN(targetUserId)) {\n      return NextResponse.json({ error: 'Invalid user ID' }, { status: 400 });\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const bodyResult = AdminSubscriptionAssignmentSchema.safeParse(body);\n    \n    if (!bodyResult.success) {\n      return NextResponse.json(\n        { \n          error: 'Invalid request data',\n          details: bodyResult.error.errors \n        },\n        { status: 400 }\n      );\n    }\n\n    const { planId, billingCycle, expiresAt, status, reason } = bodyResult.data;\n\n    // Check if subscription system exists\n    let planExists = false;\n    try {\n      const plans = await sql<{ id: number; name: string }[]>`\n        SELECT id, name FROM subscription_plans WHERE id = ${planId}\n      `;\n      planExists = plans.length > 0;\n    } catch (error) {\n      return NextResponse.json({ \n        error: 'Subscription system not available' \n      }, { status: 503 });\n    }\n\n    if (!planExists) {\n      return NextResponse.json({ error: 'Subscription plan not found' }, { status: 404 });\n    }\n\n    // Check for existing active subscription\n    const existingSubscriptions = await sql<{ id: number }[]>`\n      SELECT id FROM user_subscriptions \n      WHERE user_id = ${targetUserId} \n        AND status IN ('active', 'trialing')\n        AND (expires_at IS NULL OR expires_at > NOW())\n    `;\n\n    if (existingSubscriptions.length > 0) {\n      return NextResponse.json({ \n        error: 'User already has an active subscription' \n      }, { status: 409 });\n    }\n\n    // Calculate expiry date if not provided\n    let finalExpiresAt = expiresAt;\n    if (!finalExpiresAt && billingCycle) {\n      const now = new Date();\n      switch (billingCycle) {\n        case 'monthly':\n          now.setMonth(now.getMonth() + 1);\n          break;\n        case 'yearly':\n          now.setFullYear(now.getFullYear() + 1);\n          break;\n        case 'weekly':\n          now.setDate(now.getDate() + 7);\n          break;\n        default:\n          // Default to monthly if unrecognized\n          now.setMonth(now.getMonth() + 1);\n      }\n      finalExpiresAt = now.toISOString();\n    }\n\n    // Assign the subscription\n    await sql`\n      INSERT INTO user_subscriptions (\n        user_id, plan_id, status, billing_cycle, expires_at, \n        assigned_by, created_at, notes\n      ) VALUES (\n        ${targetUserId}, \n        ${planId}, \n        ${status || 'active'}, \n        ${billingCycle || 'monthly'}, \n        ${finalExpiresAt || null}, \n        ${adminUserId}, \n        NOW(), \n        ${reason || null}\n      )\n    `;\n\n    return NextResponse.json({ \n      success: true, \n      message: 'Subscription assigned successfully',\n      expiresAt: finalExpiresAt\n    });\n  } catch (error) {\n    console.error('Error assigning subscription:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to assign subscription' },\n      { status: 500 }\n    );\n  }\n}\n\n// PATCH /api/admin/users/[id]/assign-subscription - Update subscription\nasync function patchHandler(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const adminUserId = parseInt(session.user.id);\n    const targetUserId = parseInt(params.id);\n\n    if (isNaN(targetUserId)) {\n      return NextResponse.json({ error: 'Invalid user ID' }, { status: 400 });\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const bodyResult = AdminSubscriptionUpdateSchema.safeParse(body);\n    \n    if (!bodyResult.success) {\n      return NextResponse.json(\n        { \n          error: 'Invalid request data',\n          details: bodyResult.error.errors \n        },\n        { status: 400 }\n      );\n    }\n\n    const { subscriptionId, status, expiresAt, reason } = bodyResult.data;\n\n    // Update the subscription\n    await sql`\n      UPDATE user_subscriptions \n      SET \n        status = ${status || 'active'},\n        expires_at = ${expiresAt || null},\n        notes = ${reason || null},\n        updated_at = NOW()\n      WHERE id = ${subscriptionId} AND user_id = ${targetUserId}\n    `;\n\n    return NextResponse.json({ \n      success: true, \n      message: 'Subscription updated successfully' \n    });\n  } catch (error) {\n    console.error('Error updating subscription:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to update subscription' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE /api/admin/users/[id]/assign-subscription - Cancel subscription\nasync function deleteHandler(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const adminUserId = parseInt(session.user.id);\n    const targetUserId = parseInt(params.id);\n\n    if (isNaN(targetUserId)) {\n      return NextResponse.json({ error: 'Invalid user ID' }, { status: 400 });\n    }\n\n    // Validate query parameters\n    const { searchParams } = new URL(request.url);\n    const paramsResult = AdminSubscriptionCancelParamsSchema.safeParse({\n      subscriptionId: searchParams.get('subscriptionId'),\n      reason: searchParams.get('reason'),\n    });\n\n    if (!paramsResult.success) {\n      return NextResponse.json(\n        { \n          error: 'Invalid cancellation parameters',\n          details: paramsResult.error.errors \n        },\n        { status: 400 }\n      );\n    }\n\n    const { subscriptionId, reason = 'Cancelled by administrator' } = paramsResult.data;\n\n    // Cancel the subscription\n    await sql`\n      UPDATE user_subscriptions \n      SET \n        status = 'cancelled',\n        notes = ${reason},\n        updated_at = NOW()\n      WHERE id = ${parseInt(subscriptionId.toString())} AND user_id = ${targetUserId}\n    `;\n\n    return NextResponse.json({ \n      success: true, \n      message: 'Subscription cancelled successfully' \n    });\n  } catch (error) {\n    console.error('Error cancelling subscription:', error);\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Invalid request data', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to cancel subscription' },\n      { status: 500 }\n    );\n  }\n}\n\n// Apply permission wrappers to handlers\nexport const POST = withUserRoles(withUserPermissions(postHandler));\nexport const PATCH = withUserRoles(withUserPermissions(patchHandler));\nexport const DELETE = withUserRoles(withUserPermissions(deleteHandler)); ",
    "language":"typescript",
    "lines":284,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/users/[id]/quota-overrides/route.ts":{
    "content":"/**\n * User Quota Overrides API\n * \n * Provides secure endpoints for managing user quota overrides\n * with integration to the enhanced quota system.\n * \n * @version 1.0.0\n * @author System\n */\n\nimport { withUserPermissions } from '@/lib/api/wrappers/withUserPermissions';\nimport { withUserRoles } from '@/lib/api/wrappers/withUserRoles';\nimport { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { withRateLimit } from '@/lib/middleware/withRateLimit';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\n// ================================\n// TYPES & SCHEMAS\n// ================================\n\ninterface UserQuotaOverride {\n  id: number;\n  user_id: number;\n  service_name: string;\n  feature_name: string;\n  quota_limit: number | null;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n  reason: string | null;\n  created_by: number;\n  created_at: string;\n  updated_at: string;\n}\n\nconst UpdateQuotaOverrideSchema = z.object({\n  service_name: z.string().min(1),\n  feature_name: z.string().min(1),\n  quota_limit: z.number().int().min(0).optional(),\n  is_unlimited: z.boolean().default(false),\n  reset_period: z.enum(['hourly', 'daily', 'weekly', 'monthly']).default('daily'),\n  reason: z.string().max(500).optional()\n}).transform((data) => {\n  // If quota_limit is 0, treat as unlimited\n  if (data.quota_limit === 0) {\n    return {\n      ...data,\n      is_unlimited: true\n    };\n  }\n  return data;\n});\n\nconst DeleteQuotaOverrideSchema = z.object({\n  service_name: z.string().min(1),\n  feature_name: z.string().min(1)\n});\n\ninterface ApiResponse<T> {\n  success: true;\n  data: T;\n  message?: string;\n}\n\ninterface ErrorResponse {\n  success: false;\n  error: string;\n  message?: string;\n}\n\n// ================================\n// HELPER FUNCTIONS\n// ================================\n\nasync function validateAdminAccess(userId: number): Promise<boolean> {\n  try {\n    const result = await sql`\n      SELECT 1 FROM user_role_assignments ura\n      JOIN user_roles ur ON ura.role_id = ur.id\n      JOIN role_permissions rp ON ur.id = rp.role_id\n      JOIN permissions p ON rp.permission_id = p.id\n      WHERE ura.user_id = ${userId}\n      AND ur.is_active = true\n      AND p.name = 'admin:manage_users'\n      AND p.is_active = true\n      LIMIT 1\n    `;\n    return result.length > 0;\n  } catch (error) {\n    console.error('Error validating admin access:', error);\n    return false;\n  }\n}\n\nasync function validateUserExists(userId: string): Promise<boolean> {\n  try {\n    const result = await sql`\n      SELECT 1 FROM users WHERE id = ${userId}\n    `;\n    return result.length > 0;\n  } catch (error) {\n    console.error('Error validating user exists:', error);\n    return false;\n  }\n}\n\nasync function logAdminAction(\n  adminUserId: number,\n  actionType: string,\n  actionDetails: any,\n  reason: string\n): Promise<void> {\n  try {\n    await sql`\n      INSERT INTO admin_actions (\n        admin_user_id, action_type, action_details, reason, created_at\n      ) VALUES (\n        ${adminUserId}, ${actionType}, ${JSON.stringify(actionDetails)}, ${reason}, NOW()\n      )\n    `;\n  } catch (error) {\n    console.error('Error logging admin action:', error);\n  }\n}\n\n// ================================\n// API HANDLERS\n// ================================\n\n/**\n * PUT /api/admin/users/[id]/quota-overrides\n * Creates or updates a user quota override\n */\nasync function putHandler(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n): Promise<NextResponse<ApiResponse<{ override: UserQuotaOverride }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Validate user exists\n    const userExists = await validateUserExists(params.id);\n    if (!userExists) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const validationResult = UpdateQuotaOverrideSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Invalid request data',\n          data: validationResult.error.issues \n        },\n        { status: 400 }\n      );\n    }\n\n    const { service_name, feature_name, quota_limit, is_unlimited, reset_period, reason } = validationResult.data;\n\n    // Verify service and feature exist\n    const serviceFeatureExists = await sql`\n      SELECT ss.display_name as service_display_name, sf.display_name as feature_display_name\n      FROM subscription_services ss\n      JOIN subscription_features sf ON ss.id = sf.service_id\n      WHERE ss.name = ${service_name} AND sf.name = ${feature_name}\n      AND ss.is_active = true\n    `;\n\n    if (serviceFeatureExists.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Service or feature not found or inactive' },\n        { status: 404 }\n      );\n    }\n\n    // Calculate final quota limit - treat 0 as unlimited\n    const finalIsUnlimited = is_unlimited || quota_limit === 0;\n    const finalQuotaLimit = finalIsUnlimited ? -1 : (quota_limit || 1);\n    const finalResetPeriod = reset_period || 'daily';\n\n    // Check if override already exists\n    const existingOverride = await sql`\n      SELECT id FROM user_quota_overrides\n      WHERE user_id = ${params.id} \n      AND service_name = ${service_name} \n      AND feature_name = ${feature_name}\n    `;\n\n    let override;\n    \n    if (existingOverride.length > 0) {\n      // Update existing override\n      override = await sql`\n        UPDATE user_quota_overrides \n        SET \n          quota_limit = ${finalQuotaLimit},\n          is_unlimited = ${finalIsUnlimited},\n          reset_period = ${finalResetPeriod},\n          reason = ${reason || null},\n          updated_at = NOW()\n        WHERE id = ${existingOverride[0].id}\n        RETURNING *\n      `;\n    } else {\n      // Create new override\n      override = await sql`\n        INSERT INTO user_quota_overrides (\n          user_id, service_name, feature_name, quota_limit, \n          is_unlimited, reset_period, reason, created_by, is_active\n        ) VALUES (\n          ${params.id}, ${service_name}, ${feature_name}, ${finalQuotaLimit},\n          ${finalIsUnlimited}, ${finalResetPeriod}, ${reason || null}, ${session.user.id}, true\n        )\n        RETURNING *\n      `;\n    }\n\n    // Log the admin action\n    await logAdminAction(\n      session.user.id,\n      'user_quota_override',\n      {\n        target_user_id: params.id,\n        service_name,\n        feature_name,\n        quota_limit: finalQuotaLimit,\n        is_unlimited,\n        reset_period: finalResetPeriod,\n        service_display_name: serviceFeatureExists[0].service_display_name,\n        feature_display_name: serviceFeatureExists[0].feature_display_name\n      },\n      reason || `Updated quota override for ${service_name}.${feature_name}`\n    );\n\n    const actionType = existingOverride.length > 0 ? 'updated' : 'created';\n    const serviceName = serviceFeatureExists[0].service_display_name;\n    const featureName = serviceFeatureExists[0].feature_display_name;\n\n    return NextResponse.json({\n      success: true,\n      data: { override: override[0] as unknown as UserQuotaOverride },\n      message: `Quota override ${actionType} for ${serviceName} - ${featureName}`\n    });\n\n  } catch (error) {\n    console.error('PUT /api/admin/users/[id]/quota-overrides error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to update user quota override'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/admin/users/[id]/quota-overrides\n * Removes a user quota override\n */\nasync function deleteHandler(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n): Promise<NextResponse<ApiResponse<{ deleted: boolean }> | ErrorResponse>> {\n  try {\n    // Validate session\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate admin permissions\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json(\n        { success: false, error: 'Admin access required' },\n        { status: 403 }\n      );\n    }\n\n    // Validate user exists\n    const userExists = await validateUserExists(params.id);\n    if (!userExists) {\n      return NextResponse.json(\n        { success: false, error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    // Validate request body\n    const body = await request.json();\n    const validationResult = DeleteQuotaOverrideSchema.safeParse(body);\n    \n    if (!validationResult.success) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Invalid request data',\n          data: validationResult.error.issues \n        },\n        { status: 400 }\n      );\n    }\n\n    const { service_name, feature_name } = validationResult.data;\n\n    // Get override details for logging\n    const overrideDetails = await sql`\n      SELECT * FROM user_quota_overrides\n      WHERE user_id = ${params.id} \n      AND service_name = ${service_name} \n      AND feature_name = ${feature_name}\n    `;\n\n    if (overrideDetails.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Quota override not found' },\n        { status: 404 }\n      );\n    }\n\n    // Delete the override\n    const deleteResult = await sql`\n      DELETE FROM user_quota_overrides\n      WHERE user_id = ${params.id} \n      AND service_name = ${service_name} \n      AND feature_name = ${feature_name}\n      RETURNING id\n    `;\n\n    if (deleteResult.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Failed to delete quota override' },\n        { status: 500 }\n      );\n    }\n\n    // Log the admin action\n    await logAdminAction(\n      session.user.id,\n      'user_quota_override_remove',\n      {\n        target_user_id: params.id,\n        service_name,\n        feature_name,\n        removed_override: overrideDetails[0]\n      },\n      `Removed quota override for ${service_name}.${feature_name}`\n    );\n\n    return NextResponse.json({\n      success: true,\n      data: { deleted: true },\n      message: `Quota override removed for ${service_name}.${feature_name}`\n    });\n\n  } catch (error) {\n    console.error('DELETE /api/admin/users/[id]/quota-overrides error:', error);\n    return NextResponse.json(\n      { \n        success: false, \n        error: 'Internal server error',\n        message: 'Failed to delete user quota override'\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// Apply rate limiting to handlers\nexport const PUT = withRateLimit(putHandler);\nexport const DELETE = withRateLimit(deleteHandler);\n\n// At the end of the file, wrap the handler:\n\n// export default handler;\nexport default withUserRoles(withUserPermissions(handler)); ",
    "language":"typescript",
    "lines":406,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/admin/alerts/[id]/route.ts":{
    "content":"import { auth } from '@/lib/auth';\nimport sql from '@/lib/db';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\n// ================================\n// VALIDATION SCHEMAS\n// ================================\n\nconst UpdateAlertSchema = z.object({\n  title: z.string().min(1, 'Title is required').max(200, 'Title too long').optional(),\n  message: z.string().optional(),\n  details: z.string().optional(),\n  alert_type: z.enum(['info', 'warning', 'error', 'success', 'maintenance', 'custom']).optional(),\n  priority: z.number().int().min(-100).max(100).optional(),\n  icon: z.string().optional(),\n  dismissible: z.boolean().optional(),\n  persistent: z.boolean().optional(),\n  expires_at: z.string().datetime().optional(),\n  target_audience: z.enum([\n    'all', 'authenticated', 'subscribers', 'admins', 'role_based', 'specific_users'\n  ]).optional(),\n  target_roles: z.array(z.string()).optional(),\n  target_users: z.array(z.number().int()).optional(),\n  start_date: z.string().datetime().optional(),\n  end_date: z.string().datetime().optional(),\n  is_active: z.boolean().optional(),\n  is_published: z.boolean().optional(),\n  actions: z.any().optional(),\n  metadata: z.any().optional()\n});\n\n// ================================\n// UTILITY FUNCTIONS\n// ================================\n\nasync function validateAdminAccess(sessionUserId: string): Promise<boolean> {\n  try {\n    const adminCheck = await sql`\n      SELECT ura.role_id, ur.name as role_name\n      FROM user_role_assignments ura\n      JOIN user_roles ur ON ura.role_id = ur.id\n      WHERE ura.user_id = ${sessionUserId}\n      AND ur.name IN ('admin', 'moderator')\n      AND ura.is_active = true\n      AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n      LIMIT 1\n    `;\n    \n    return adminCheck.length > 0;\n  } catch (error) {\n    console.error('Admin validation error:', error);\n    return false;\n  }\n}\n\n// ================================\n// API HANDLERS\n// ================================\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const alertId = parseInt(params.id);\n    if (isNaN(alertId)) {\n      return NextResponse.json({ error: 'Invalid alert ID' }, { status: 400 });\n    }\n\n    const [alert] = await sql`\n      SELECT * FROM custom_alerts WHERE id = ${alertId}\n    `;\n\n    if (!alert) {\n      return NextResponse.json({ error: 'Alert not found' }, { status: 404 });\n    }\n\n    return NextResponse.json(alert);\n\n  } catch (error) {\n    console.error('Error fetching alert:', error);\n    return NextResponse.json({ error: 'Failed to fetch alert' }, { status: 500 });\n  }\n}\n\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const alertId = parseInt(params.id);\n    if (isNaN(alertId)) {\n      return NextResponse.json({ error: 'Invalid alert ID' }, { status: 400 });\n    }\n\n    const body = await request.json();\n    const validatedData = UpdateAlertSchema.parse(body);\n\n    // Build dynamic update query\n    const updateFields: string[] = [];\n    const updateValues: any[] = [];\n    let paramIndex = 1;\n\n    Object.entries(validatedData).forEach(([key, value]) => {\n      if (value !== undefined) {\n        if (key === 'target_roles' || key === 'target_users' || key === 'actions' || key === 'metadata') {\n          updateFields.push(`${key} = $${paramIndex}`);\n          updateValues.push(JSON.stringify(value));\n        } else {\n          updateFields.push(`${key} = $${paramIndex}`);\n          updateValues.push(value);\n        }\n        paramIndex++;\n      }\n    });\n\n    if (updateFields.length === 0) {\n      return NextResponse.json({ error: 'No fields to update' }, { status: 400 });\n    }\n\n    // Add updated_by and updated_at\n    updateFields.push(`updated_by = $${paramIndex}`, `updated_at = CURRENT_TIMESTAMP`);\n    updateValues.push(session.user.id);\n\n    const query = `\n      UPDATE custom_alerts \n      SET ${updateFields.join(', ')}\n      WHERE id = $${paramIndex + 1}\n      RETURNING *\n    `;\n    updateValues.push(alertId);\n\n    const [updatedAlert] = await sql.unsafe(query, updateValues);\n\n    if (!updatedAlert) {\n      return NextResponse.json({ error: 'Alert not found' }, { status: 404 });\n    }\n\n    // SSE notifications removed - admin panel now uses polling for updates\n\n    return NextResponse.json({ \n      message: 'Alert updated successfully', \n      alert: updatedAlert \n    });\n\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: 'Validation failed', details: error.errors },\n        { status: 400 }\n      );\n    }\n    \n    console.error('Error updating alert:', error);\n    return NextResponse.json({ error: 'Failed to update alert' }, { status: 500 });\n  }\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const session = await auth();\n    if (!session?.user?.id) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const isAdmin = await validateAdminAccess(session.user.id);\n    if (!isAdmin) {\n      return NextResponse.json({ error: 'Admin access required' }, { status: 403 });\n    }\n\n    const alertId = parseInt(params.id);\n    if (isNaN(alertId)) {\n      return NextResponse.json({ error: 'Invalid alert ID' }, { status: 400 });\n    }\n\n    const [deletedAlert] = await sql`\n      DELETE FROM custom_alerts \n      WHERE id = ${alertId}\n      RETURNING *\n    `;\n\n    if (!deletedAlert) {\n      return NextResponse.json({ error: 'Alert not found' }, { status: 404 });\n    }\n\n    // SSE notifications removed - admin panel now uses polling for updates\n\n    return NextResponse.json({ \n      message: 'Alert deleted successfully',\n      alert: deletedAlert \n    });\n\n  } catch (error) {\n    console.error('Error deleting alert:', error);\n    return NextResponse.json({ error: 'Failed to delete alert' }, { status: 500 });\n  }\n} ",
    "language":"typescript",
    "lines":221,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/emojis/route.ts":{
    "content":"/**\n * @swagger\n * /api/emojis:\n *   get:\n *     summary: Get emojis by OS and category\n *     description: Fetches OS-specific emojis with optional filtering by category and search terms\n *     tags:\n *       - Emojis\n *     parameters:\n *       - in: query\n *         name: category\n *         schema:\n *           type: string\n *         description: Filter by emoji category (e.g., 'smileys', 'animals')\n *       - in: query\n *         name: search\n *         schema:\n *           type: string\n *         description: Search term to filter emojis by name\n *       - in: query\n *         name: page\n *         schema:\n *           type: integer\n *           default: 1\n *         description: Page number for pagination\n *       - in: query\n *         name: per_page\n *         schema:\n *           type: integer\n *           default: 50\n *           maximum: 100\n *         description: Number of emojis per page\n *       - in: query\n *         name: include_custom\n *         schema:\n *           type: boolean\n *           default: false\n *         description: Include custom user-uploaded emojis\n *     responses:\n *       200:\n *         description: Successfully retrieved emojis\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/EmojiListResponse'\n *       400:\n *         description: Invalid request parameters\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Error'\n *       500:\n *         description: Internal server error\n *         content:\n *           application/json:\n *             schema:\n *               $ref: '#/components/schemas/Error'\n *   post:\n *     summary: Upload custom emoji\n *     description: Upload a custom emoji image for the authenticated user\n *     tags:\n *       - Emojis\n *     security:\n *       - NextAuth: []\n *     requestBody:\n *       required: true\n *       content:\n *         multipart/form-data:\n *           schema:\n *             type: object\n *             properties:\n *               file:\n *                 type: string\n *                 format: binary\n *                 description: Emoji image file (PNG, JPG, GIF)\n *               name:\n *                 type: string\n *                 description: Name for the custom emoji\n *               category:\n *                 type: string\n *                 description: Category for the emoji\n *             required:\n *               - file\n *               - name\n *     responses:\n *       201:\n *         description: Emoji uploaded successfully\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 success:\n *                   type: boolean\n *                 emoji:\n *                   $ref: '#/components/schemas/EmojiResponse'\n *       400:\n *         description: Invalid file or parameters\n *       401:\n *         description: Authentication required\n *       413:\n *         description: File too large\n *       500:\n *         description: Upload failed\n *   put:\n *     summary: Track emoji usage\n *     description: Track usage statistics for an emoji\n *     tags:\n *       - Emojis\n *     requestBody:\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             type: object\n *             properties:\n *               emoji_id:\n *                 type: string\n *                 description: ID of the emoji being used\n *               emoji_type:\n *                 type: string\n *                 enum: [windows, mac, custom]\n *                 description: Type of emoji being tracked\n *             required:\n *               - emoji_id\n *               - emoji_type\n *     responses:\n *       200:\n *         description: Usage tracked successfully\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 success:\n *                   type: boolean\n *       400:\n *         description: Invalid parameters\n *       500:\n *         description: Tracking failed\n */\n\n/**\n * Emoji API Routes\n * Handles fetching OS-specific emojis using server actions\n */\n\nimport { createLogger } from '@/lib/logging';\nimport { withRateLimit } from '@/lib/middleware/withRateLimit';\nimport { NextRequest, NextResponse } from 'next/server';\nimport {\n    getCategoryMapping,\n    getCustomEmojis,\n    getEmojiCategories,\n    getOSEmojis,\n    trackEmojiUsage,\n    uploadCustomEmoji\n} from '../../../lib/actions/emoji.actions';\nimport { OSDetection } from '../../../lib/utils/os-detection';\n\nconst logger = createLogger({\n  context: {\n    component: 'EmojisAPI',\n    module: 'api'\n  },\n  enabled: false\n});\n\nexport interface EmojiResponse {\n  id: number;\n  emoji_id: string;\n  unicode_codepoint?: string;\n  unicode_char?: string;\n  name: string;\n  description?: string;\n  category: {\n    id: number;\n    name: string;\n    display_name: string;\n  };\n  tags: string[];\n  aliases: string[];\n  keywords?: string[];\n  is_custom?: boolean;\n  custom_image_url?: string;\n  usage_count?: number;\n  version_min?: string;\n  is_approved?: boolean;\n  is_personal?: boolean;\n}\n\nexport interface EmojiListResponse {\n  emojis: EmojiResponse[];\n  categories: Array<{\n    id: number;\n    name: string;\n    display_name: string;\n    description?: string;\n    emoji_count: number;\n  }>;\n  os_info: {\n    os: string;\n    version?: string;\n    is_supported: boolean;\n    emoji_support: {\n      supports_unicode: boolean;\n      supports_custom: boolean;\n      max_emoji_version: string;\n      recommended_format: string;\n    };\n  };\n  total_count: number;\n  page: number;\n  per_page: number;\n}\n\n/**\n * GET /api/emojis\n * Fetch emojis based on user's OS and preferences using server actions\n */\nasync function getHandler(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n\n    // Parse query parameters\n    const category = searchParams.get('category') || undefined;\n    const search = searchParams.get('search') || undefined;\n    const page = parseInt(searchParams.get('page') || '1');\n    const perPage = Math.min(\n      parseInt(searchParams.get('per_page') || '50'),\n      100\n    );\n    const includeCustom = searchParams.get('include_custom') === 'true';\n\n    // Detect user's OS from headers\n    const userAgent = request.headers.get('user-agent') || '';\n    const osInfo = OSDetection.detectFromUserAgent(userAgent);\n    const userOS = osInfo.os === 'mac' ? 'mac' : 'windows';\n\n    const offset = (page - 1) * perPage;\n\n    // Get category mapping from database and convert category name to ID if provided\n    let categoryId: string | undefined;\n    if (category) {\n      const categoryMapping = await getCategoryMapping();\n      const mappedId = categoryMapping[category.toLowerCase()];\n      if (mappedId) {\n        categoryId = mappedId.toString();\n      }\n    }\n\n    // Get categories first to build category lookup\n    const categories = await getEmojiCategories(userOS);\n    const categoryLookup = new Map<\n      number,\n      { name: string; display_name: string }\n    >();\n\n    // Build category lookup from both builtin and custom categories\n    [...categories.builtin, ...categories.custom].forEach((cat) => {\n      categoryLookup.set(cat.category_id, {\n        name: cat.category_name,\n        display_name: cat.display_name\n      });\n    });\n\n    // Fetch OS-specific emojis using server action\n    const osEmojis = await getOSEmojis(\n      userOS,\n      categoryId,\n      search,\n      perPage,\n      offset\n    );\n\n    // Fetch custom emojis if requested\n    let customEmojis: any[] = [];\n    if (includeCustom) {\n      customEmojis = await getCustomEmojis(search, perPage, 0);\n    }\n\n    const response: EmojiListResponse = {\n      emojis: [\n        ...osEmojis.map((emoji) => {\n          const categoryInfo = categoryLookup.get(emoji.category_id) || {\n            name: 'unknown',\n            display_name: 'Unknown'\n          };\n          return {\n            id: emoji.id,\n            emoji_id: emoji.emoji_id,\n            unicode_char: emoji.unicode_char,\n            name: emoji.name,\n            description: emoji.name,\n            category: {\n              id: emoji.category_id,\n              name: categoryInfo.name,\n              display_name: categoryInfo.display_name\n            },\n            tags: [],\n            aliases: emoji.aliases || [],\n            is_custom: false,\n            usage_count: emoji.usage_count\n          };\n        }),\n        ...customEmojis.map((emoji) => {\n          const categoryInfo = categoryLookup.get(emoji.category_id) || {\n            name: 'custom',\n            display_name: 'Custom'\n          };\n          return {\n            id: emoji.id,\n            emoji_id: emoji.emoji_id,\n            name: emoji.name,\n            description: emoji.name,\n            category: {\n              id: emoji.category_id,\n              name: categoryInfo.name,\n              display_name: categoryInfo.display_name\n            },\n            tags: [],\n            aliases: [],\n            is_custom: true,\n            custom_image_url: emoji.image_data\n              ? `data:image/png;base64,${emoji.image_data}`\n              : undefined,\n            usage_count: emoji.usage_count\n          };\n        })\n      ],\n      categories: [\n        ...categories.builtin.map((cat) => ({\n          id: cat.category_id,\n          name: cat.category_name,\n          display_name: cat.display_name,\n          emoji_count: cat.count\n        })),\n        ...categories.custom.map((cat) => ({\n          id: cat.category_id,\n          name: cat.category_name,\n          display_name: cat.display_name,\n          emoji_count: cat.count\n        }))\n      ],\n      os_info: {\n        os: userOS,\n        version: osInfo.version,\n        is_supported: true,\n        emoji_support: {\n          supports_unicode: true,\n          supports_custom: true,\n          max_emoji_version: userOS === 'mac' ? '15.0' : '11.0',\n          recommended_format: userOS === 'mac' ? 'unicode' : 'image'\n        }\n      },\n      total_count: osEmojis.length + customEmojis.length,\n      page,\n      per_page: perPage\n    };\n\n    return NextResponse.json(response);\n  } catch (error) {\n    logger.error('Error fetching emojis:', error as Error);\n    return NextResponse.json(\n      { error: 'Failed to fetch emojis' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/emojis\n * Create a new custom emoji using server actions\n */\nasync function postHandler(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { name, displayName, imageData, category } = body;\n\n    if (!name || !displayName || !imageData) {\n      return NextResponse.json(\n        { error: 'Missing required fields: name, displayName, imageData' },\n        { status: 400 }\n      );\n    }\n\n    // Convert category to category ID (default to 9 for 'custom' category)\n    const categoryId = category ? parseInt(category) || 9 : 9;\n\n    // Upload custom emoji using server action\n    await uploadCustomEmoji(name, displayName, imageData, categoryId);\n\n    return NextResponse.json({\n      success: true,\n      message: 'Custom emoji uploaded successfully and is pending approval'\n    });\n  } catch (error) {\n    logger.error('Error uploading custom emoji:', error as Error);\n    return NextResponse.json(\n      { error: 'Failed to upload emoji' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PUT /api/emojis\n * Track emoji usage using server actions\n */\nasync function putHandler(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { emojiType, emojiId } = body;\n\n    if (!emojiType || !emojiId) {\n      return NextResponse.json(\n        { error: 'Missing required fields: emojiType, emojiId' },\n        { status: 400 }\n      );\n    }\n\n    // Track emoji usage using server action\n    await trackEmojiUsage(emojiType, emojiId);\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    logger.error('Error tracking emoji usage:', error as Error);\n    return NextResponse.json(\n      { error: 'Failed to track usage' },\n      { status: 500 }\n    );\n  }\n}\n\n// Apply rate limiting to all handlers\nexport const GET = withRateLimit(getHandler);\nexport const POST = withRateLimit(postHandler);\nexport const PUT = withRateLimit(putHandler);\n",
    "language":"typescript",
    "lines":439,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/utils.ts":{
    "content":"/**\n * Wrap text for SVG rendering with specified maximum characters per line\n */\nexport function wrapTextForSVG(text: string, maxCharsPerLine: number): string[] {\n  const words = text.split(' ');\n  const lines: string[] = [];\n  let currentLine = '';\n\n  for (const word of words) {\n    const testLine = currentLine + (currentLine ? ' ' : '') + word;\n\n    if (testLine.length > maxCharsPerLine && currentLine) {\n      lines.push(currentLine);\n      currentLine = word;\n    } else {\n      currentLine = testLine;\n    }\n  }\n\n  if (currentLine) {\n    lines.push(currentLine);\n  }\n\n  return lines;\n}\n\n/**\n * Escape XML characters for safe SVG rendering\n */\nexport function escapeXml(text: string): string {\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\\\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\n/**\n * Simple seeded random number generator for consistent results\n */\nexport function seededRandom(seed: string): () => number {\n  let hash = 0;\n  for (let i = 0; i < seed.length; i++) {\n    const char = seed.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n\n  return function () {\n    hash = (hash * 9301 + 49297) % 233280;\n    return hash / 233280;\n  };\n}\n\n/**\n * Generate a stable seed based on current date-time for rotation\n */\nexport function generateDailyAvatarSeed(): string {\n  const now = new Date();\n  const dateString = now.toISOString().split('T')[0]; // YYYY-MM-DD format\n  const hour = now.getHours(); // Changes every hour\n  const minute = Math.floor(now.getMinutes() / 15); // Changes every 15 minutes\n  return `daily-og-${dateString}-${hour}-${minute}`;\n} ",
    "language":"typescript",
    "lines":65,
    "truncated":false,
    "truncate_limit":null
  },
  "src/app/api/og-image/types.ts":{
    "content":"export interface QuoteData {\n  text: string;\n  author: string;\n}\n\nexport interface QuoteAPIConfig {\n  name: string;\n  url: string;\n  weight: number;\n  headers?: Record<string, string>;\n  transform: (data: any) => QuoteData;\n}\n\nexport interface AspectRatioConfig {\n  name: string;\n  width: number;\n  height: number;\n  description: string;\n  textMaxWidth: number;\n  textStartY: number;\n  avatarX: number;\n  avatarY: number;\n  avatarSize: number;\n}\n\nexport interface BackgroundPatternResult {\n  patterns: string;\n  predominantColor: string;\n}\n\nexport interface GenerateImageParams {\n  customSeed?: string | null;\n  avatarSeed?: string | null;\n  customQuote?: string | null;\n  customAuthor?: string | null;\n  aspectRatio?: string;\n  customWidth?: number | null;\n  customHeight?: number | null;\n  shapeCount?: number | null;\n  avatarX?: number | null;\n  avatarY?: number | null;\n  avatarSize?: number | null;\n  textMaxWidth?: number | null;\n  textStartY?: number | null;\n  fontSize?: number | null;\n  borderOpacity?: number | null;\n  textPadding?: number | null;\n  lineHeight?: number | null;\n}\n\nexport interface AvatarPositioning {\n  x: number;\n  y: number;\n  size: number;\n}\n\nexport interface TextPositioning {\n  startY: number;\n  maxWidth: number;\n  fontSize: number;\n  lines: string[];\n}\n\nexport interface RateLimitInfo {\n  ip: string;\n  userAgent: string;\n  timestamp: number;\n  count: number;\n}\n\nexport interface GenerationLimits {\n  perMinute: number;\n  perHour: number;\n  perDay: number;\n}\n\nexport interface GenerationMetadata {\n  id: string;\n  seed: string;\n  quote: QuoteData;\n  aspectRatio: string;\n  dimensions: {\n    width: number;\n    height: number;\n  };\n  shapeCount?: number;\n  customDimensions?: {\n    width?: number;\n    height?: number;\n  };\n  generatedAt: string;\n  clientInfo: {\n    ip: string;\n    userAgent: string;\n  };\n}\n\nexport interface StoredGeneration {\n  id: string;\n  seed: string;\n  quote_text: string;\n  quote_author: string;\n  aspect_ratio: string;\n  width: number;\n  height: number;\n  shape_count?: number;\n  custom_width?: number;\n  custom_height?: number;\n  svg_content: string;\n  client_ip: string;\n  user_agent: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface OGImageResponse {\n  id: string; // Unique generation ID for retrieval\n  svg: string;\n  seed: string;\n  dimensions: {\n    width: number;\n    height: number;\n  };\n  aspectRatio: string;\n  generationOptions: {\n    seed: string;\n    avatarSeed: string;\n    customQuote?: string;\n    customAuthor?: string;\n    aspectRatio: string;\n    customWidth?: number;\n    customHeight?: number;\n    shapeCount?: number;\n    avatarX?: number;\n    avatarY?: number;\n    avatarSize?: number;\n    textMaxWidth?: number;\n    textStartY?: number;\n    fontSize?: number;\n    borderOpacity?: number;\n    textPadding?: number;\n    lineHeight?: number;\n    borderColor?: string;\n    patternSeed?: string;\n  };\n  remainingGenerations: number;\n} ",
    "language":"typescript",
    "lines":147,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/services/EnhancedQuotaService.ts":{
    "content":"/**\n * Enhanced Quota Service\n * \n * Agnostic quota system that can be leveraged by subscriptions and other systems.\n * When both subscription and override quotas exist, uses the higher value.\n * \n * Architecture:\n * - Quota system is the foundation (handles all quota logic)\n * - Subscription system integrates with quota system but doesn't replace it\n * - When both subscription and override exist, use the higher quota\n * - Admin interface manages both systems independently\n * \n * @version 2.0.0\n * @author System\n */\n\nimport sql from '@/lib/db';\n\n// ================================\n// TYPES & INTERFACES\n// ================================\n\nexport interface UserQuotaInfo {\n  service_name: string;\n  feature_name: string;\n  current_usage: number;\n  quota_limit: number;\n  is_unlimited: boolean;\n  reset_date: Date | null;\n  quota_source: 'user_override' | 'subscription_plan' | 'global_guest' | 'system_default';\n  reset_period: string;\n}\n\nexport interface QuotaOverride {\n  id: number;\n  user_id: number;\n  service_name: string;\n  feature_name: string;\n  quota_limit: number;\n  is_unlimited: boolean;\n  reset_period: string;\n  is_active: boolean;\n  reason: string | null;\n  created_by: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ServiceFeature {\n  service_name: string;\n  feature_name: string;\n  service_display_name: string;\n  feature_display_name: string;\n  default_quota_limit: number;\n  feature_type: string;\n}\n\n// ================================\n// ENHANCED QUOTA SERVICE\n// ================================\n\nexport class EnhancedQuotaService {\n  /**\n   * Get comprehensive quota information for a specific user\n   * Returns all available services and features with their current usage and limits\n   * Shows effective quota: override takes precedence over plan quota, falls back to service defaults\n   */\n  static async getUserQuotaInfo(userId: number): Promise<UserQuotaInfo[]> {\n    try {\n      const quotaInfo: UserQuotaInfo[] = [];\n\n      // Get ALL available service/feature combinations that support quotas\n      const availableServices = await sql`\n        SELECT \n          ss.name as service_name,\n          sf.name as feature_name,\n          ss.display_name as service_display_name,\n          sf.display_name as feature_display_name,\n          sf.feature_type,\n          sf.default_value\n        FROM subscription_services ss\n        JOIN subscription_features sf ON ss.id = sf.service_id\n        WHERE ss.is_active = true \n        AND sf.feature_type = 'limit'\n        ORDER BY ss.name, sf.name\n      `;\n\n      // Get user's current subscription plan quotas\n      const userPlanQuotas = await sql`\n        SELECT \n          ss.name as service_name,\n          sf.name as feature_name,\n          COALESCE(pfv.feature_value::text::integer, sf.default_value::text::integer) as plan_quota,\n          sp.name as plan_name\n        FROM user_subscriptions us\n        JOIN subscription_plans sp ON us.plan_id = sp.id\n        JOIN plan_services ps ON sp.id = ps.plan_id\n        JOIN subscription_services ss ON ps.service_id = ss.id\n        JOIN subscription_features sf ON ss.id = sf.service_id\n        LEFT JOIN plan_feature_values pfv ON sp.id = pfv.plan_id AND sf.id = pfv.feature_id\n        WHERE us.user_id = ${userId} \n        AND us.status = 'active'\n        AND sf.feature_type = 'limit'\n      `;\n\n      // Get existing user overrides\n      const userOverrides = await sql`\n        SELECT * FROM user_quota_overrides\n        WHERE user_id = ${userId} \n        AND is_active = true\n      `;\n\n      // Build comprehensive quota data for ALL available services\n      for (const service of availableServices) {\n        const planQuota = userPlanQuotas.find(\n          pq => pq.service_name === service.service_name && pq.feature_name === service.feature_name\n        );\n        \n        const override = userOverrides.find(\n          uo => uo.service_name === service.service_name && uo.feature_name === service.feature_name\n        );\n\n        let effectiveQuota: number, quotaSource: 'user_override' | 'subscription_plan' | 'global_guest' | 'system_default', resetPeriod: string;\n\n        if (override) {\n          // Override exists - use override values (ignores plan completely)\n          effectiveQuota = override.quota_limit;\n          quotaSource = 'user_override';\n          resetPeriod = override.reset_period;\n        } else if (planQuota) {\n          // No override but user has plan - use plan quota\n          effectiveQuota = planQuota.plan_quota;\n          quotaSource = 'subscription_plan';\n          resetPeriod = 'daily'; // Default reset period for plan quotas\n        } else {\n          // No override and no plan - use service default value for admin management\n          effectiveQuota = parseInt(service.default_value) || 0;\n          quotaSource = 'system_default';\n          resetPeriod = 'daily';\n        }\n\n        const usage = effectiveQuota > 0 ? \n          await this.getUserUsage(userId, service.service_name, service.feature_name, resetPeriod) : \n          0;\n\n        quotaInfo.push({\n          service_name: service.service_name,\n          feature_name: service.feature_name,\n          current_usage: usage,\n          quota_limit: effectiveQuota,\n          is_unlimited: effectiveQuota === -1,\n          reset_date: effectiveQuota > 0 ? this.calculateResetDate(resetPeriod) : null,\n          quota_source: quotaSource,\n          reset_period: resetPeriod\n        });\n      }\n\n      return quotaInfo;\n\n    } catch (error) {\n      console.error('Error getting user quota info:', error);\n      throw new Error('Failed to retrieve user quota information');\n    }\n  }\n\n  /**\n   * Get quota from user overrides\n   */\n  private static async getUserOverrideQuota(\n    userId: number,\n    serviceName: string,\n    featureName: string\n  ): Promise<{\n    quota_limit: number;\n    is_unlimited: boolean;\n    reset_period: string;\n  } | null> {\n    try {\n      const result = await sql<{\n        quota_limit: number;\n        is_unlimited: boolean;\n        reset_period: string;\n      }[]>`\n        SELECT quota_limit, is_unlimited, reset_period\n        FROM user_quota_overrides\n        WHERE user_id = ${userId}\n        AND service_name = ${serviceName}\n        AND feature_name = ${featureName}\n        AND is_active = true\n      `;\n\n      return result.length > 0 ? result[0] : null;\n    } catch (error) {\n      console.error('Error getting user override quota:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Get quota from user's subscription plan\n   */\n  private static async getUserSubscriptionQuota(\n    userId: number,\n    serviceName: string,\n    featureName: string\n  ): Promise<{\n    quota_limit: number;\n    is_unlimited: boolean;\n    reset_period: string;\n  } | null> {\n    try {\n      const result = await sql<{\n        quota_limit: number;\n        is_unlimited: boolean;\n        reset_period: string;\n      }[]>`\n        SELECT \n          COALESCE(pfv.feature_value::text::integer, sf.default_value::text::integer) as quota_limit,\n          CASE \n            WHEN COALESCE(pfv.feature_value::text::integer, sf.default_value::text::integer) = -1 THEN true\n            ELSE COALESCE(ps.is_unlimited, false)\n          END as is_unlimited,\n          'daily' as reset_period\n        FROM user_subscriptions us\n        JOIN subscription_plans sp ON us.plan_id = sp.id\n        JOIN plan_services ps ON sp.id = ps.plan_id\n        JOIN subscription_services ss ON ps.service_id = ss.id\n        JOIN subscription_features sf ON ss.id = sf.service_id\n        LEFT JOIN plan_feature_values pfv ON sp.id = pfv.plan_id AND sf.id = pfv.feature_id\n        WHERE us.user_id = ${userId}\n        AND us.status IN ('active', 'trialing')\n        AND (us.expires_at IS NULL OR us.expires_at > NOW())\n        AND ss.name = ${serviceName}\n        AND sf.name = ${featureName}\n        ORDER BY sp.sort_order DESC\n        LIMIT 1\n      `;\n\n      return result.length > 0 ? result[0] : null;\n    } catch (error) {\n      console.error('Error getting user subscription quota:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Get current usage for a user's specific service and feature\n   */\n  private static async getUserUsage(\n    userId: number,\n    serviceName: string,\n    featureName: string,\n    resetPeriod: string\n  ): Promise<number> {\n    try {\n      const { startDate, endDate } = this.getResetPeriodRange(resetPeriod);\n\n      const result = await sql`\n        SELECT COALESCE(SUM(su.usage_count), 0) as total_usage\n        FROM subscription_usage su\n        JOIN subscription_services ss ON su.service_id = ss.id\n        JOIN subscription_features sf ON su.feature_id = sf.id\n        WHERE su.user_id = ${userId}\n        AND ss.name = ${serviceName}\n        AND sf.name = ${featureName}\n        AND su.usage_date >= ${startDate}\n        AND su.usage_date <= ${endDate}\n      `;\n\n      return result[0]?.total_usage || 0;\n\n    } catch (error) {\n      console.error('Error getting user usage:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Calculate the next reset date based on reset period\n   */\n  public static calculateResetDate(resetPeriod: string): Date {\n    const now = new Date();\n    \n    switch (resetPeriod) {\n      case 'hourly':\n        return new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours() + 1, 0, 0, 0);\n      \n      case 'daily':\n        return new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0, 0);\n      \n      case 'weekly': {\n        // Use same logic as getResetPeriodRange - week starts on Sunday (day 0)\n        const dayOfWeek = now.getDay();\n        const daysUntilNextWeek = dayOfWeek === 0 ? 7 : 7 - dayOfWeek;\n        return new Date(now.getFullYear(), now.getMonth(), now.getDate() + daysUntilNextWeek, 0, 0, 0, 0);\n      }\n      \n      case 'monthly':\n        return new Date(now.getFullYear(), now.getMonth() + 1, 1, 0, 0, 0, 0);\n      \n      default:\n        return new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0, 0);\n    }\n  }\n\n  /**\n   * Get the date range for a reset period\n   */\n  private static getResetPeriodRange(resetPeriod: string): { startDate: Date; endDate: Date } {\n    const now = new Date();\n    const endDate = new Date(now);\n    let startDate: Date;\n\n    switch (resetPeriod) {\n      case 'hourly':\n        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours(), 0, 0, 0);\n        break;\n      \n      case 'daily':\n        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\n        break;\n      \n      case 'weekly': {\n        const dayOfWeek = now.getDay();\n        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - dayOfWeek, 0, 0, 0, 0);\n        break;\n      }\n      \n      case 'monthly':\n        startDate = new Date(now.getFullYear(), now.getMonth(), 1, 0, 0, 0, 0);\n        break;\n      \n      default:\n        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\n        break;\n    }\n\n    return { startDate, endDate };\n  }\n\n  /**\n   * Check if a user has exceeded their quota for a specific service/feature\n   * Uses agnostic quota system - checks both overrides and subscriptions, uses higher value\n   */\n  static async checkUserQuota(\n    userId: number,\n    serviceName: string,\n    featureName: string\n  ): Promise<{\n    allowed: boolean;\n    quota_limit: number;\n    current_usage: number;\n    remaining: number;\n    reset_date: Date | null;\n    is_unlimited: boolean;\n    quota_source: string;\n  }> {\n    try {\n      // Get quota from both sources\n      const overrideQuota = await this.getUserOverrideQuota(userId, serviceName, featureName);\n      const subscriptionQuota = await this.getUserSubscriptionQuota(userId, serviceName, featureName);\n\n      // Determine which quota to use (higher value wins)\n      let effectiveQuota: {\n        quota_limit: number;\n        is_unlimited: boolean;\n        reset_period: string;\n      } | null = null;\n      let quotaSource = 'user_override';\n\n      if (subscriptionQuota && overrideQuota) {\n        // Both exist - use the higher quota\n        if (subscriptionQuota.is_unlimited || \n            (!overrideQuota.is_unlimited && subscriptionQuota.quota_limit > overrideQuota.quota_limit)) {\n          effectiveQuota = subscriptionQuota;\n          quotaSource = 'subscription_plan';\n        } else {\n          effectiveQuota = overrideQuota;\n          quotaSource = 'user_override';\n        }\n      } else if (subscriptionQuota && !overrideQuota) {\n        // Only subscription exists\n        effectiveQuota = subscriptionQuota;\n        quotaSource = 'subscription_plan';\n      } else if (!subscriptionQuota && overrideQuota) {\n        // Only override exists\n        effectiveQuota = overrideQuota;\n        quotaSource = 'user_override';\n      } else {\n        // No quota found - return default behavior\n        return {\n          allowed: false,\n          quota_limit: 0,\n          current_usage: 0,\n          remaining: 0,\n          reset_date: null,\n          is_unlimited: false,\n          quota_source: 'none'\n        };\n      }\n\n      // Get current usage for the effective quota period\n      const currentUsage = await this.getUserUsage(\n        userId, \n        serviceName, \n        featureName, \n        effectiveQuota.reset_period\n      );\n\n      const remaining = effectiveQuota.is_unlimited ? \n        Number.MAX_SAFE_INTEGER : \n        Math.max(0, effectiveQuota.quota_limit - currentUsage);\n\n      return {\n        allowed: effectiveQuota.is_unlimited || currentUsage < effectiveQuota.quota_limit,\n        quota_limit: effectiveQuota.quota_limit,\n        current_usage: currentUsage,\n        remaining,\n        reset_date: this.calculateResetDate(effectiveQuota.reset_period),\n        is_unlimited: effectiveQuota.is_unlimited,\n        quota_source: quotaSource\n      };\n\n    } catch (error) {\n      console.error('Error checking user quota:', error);\n      throw new Error('Failed to check user quota');\n    }\n  }\n\n  /**\n   * Record usage for a user's service/feature\n   * Handles both quota overrides and subscription-based quotas\n   */\n  static async recordUserUsage(\n    userId: number,\n    serviceName: string,\n    featureName: string,\n    usageCount: number = 1,\n    metadata?: any\n  ): Promise<{\n    success: boolean;\n    new_usage_count: number;\n    quota_limit: number;\n    remaining: number;\n    message?: string;\n  }> {\n    try {\n      // First check if user has a quota override\n      const userOverride = await sql`\n        SELECT * FROM user_quota_overrides\n        WHERE user_id = ${userId} \n        AND service_name = ${serviceName} \n        AND feature_name = ${featureName}\n        AND is_active = true\n      `;\n\n      if (userOverride.length > 0) {\n        // User has quota override - record usage in a generic usage tracking table\n        // Get service and feature IDs for consistent tracking\n        const serviceInfo = await sql`\n          SELECT ss.id as service_id, sf.id as feature_id\n          FROM subscription_services ss\n          JOIN subscription_features sf ON ss.id = sf.service_id\n          WHERE ss.name = ${serviceName}\n          AND sf.name = ${featureName}\n          LIMIT 1\n        `;\n\n        if (serviceInfo.length === 0) {\n          throw new Error(`Service ${serviceName}.${featureName} not found`);\n        }\n\n        const { service_id, feature_id } = serviceInfo[0];\n\n        // Record usage in subscription_usage table with NULL subscription_id for override users\n        await sql`\n          INSERT INTO subscription_usage (\n            user_id, subscription_id, service_id, feature_id, usage_date, usage_count, metadata\n          ) VALUES (\n            ${userId}, NULL, ${service_id}, ${feature_id}, CURRENT_DATE, ${usageCount}, \n            ${metadata ? JSON.stringify(metadata) : null}\n          )\n          ON CONFLICT (user_id, COALESCE(subscription_id, 0), service_id, feature_id, usage_date)\n          DO UPDATE SET \n            usage_count = subscription_usage.usage_count + ${usageCount},\n            updated_at = NOW(),\n            metadata = COALESCE(${metadata ? JSON.stringify(metadata) : null}, subscription_usage.metadata)\n        `;\n      } else {\n        // User doesn't have override - try subscription-based quota\n        const subscriptionInfo = await sql`\n          SELECT us.id as subscription_id, ss.id as service_id, sf.id as feature_id\n          FROM user_subscriptions us\n          JOIN subscription_plans sp ON us.plan_id = sp.id\n          JOIN plan_services ps ON sp.id = ps.plan_id\n          JOIN subscription_services ss ON ps.service_id = ss.id\n          JOIN subscription_features sf ON ss.id = sf.service_id\n          WHERE us.user_id = ${userId}\n          AND us.status IN ('active', 'trialing')\n          AND (us.expires_at IS NULL OR us.expires_at > NOW())\n          AND ss.name = ${serviceName}\n          AND sf.name = ${featureName}\n          LIMIT 1\n        `;\n\n        if (subscriptionInfo.length === 0) {\n          throw new Error(`No active subscription or quota override found for service ${serviceName}.${featureName}`);\n        }\n\n        const { subscription_id, service_id, feature_id } = subscriptionInfo[0];\n\n        // Record the usage with subscription\n        await sql`\n          INSERT INTO subscription_usage (\n            user_id, subscription_id, service_id, feature_id, usage_date, usage_count, metadata\n          ) VALUES (\n            ${userId}, ${subscription_id}, ${service_id}, ${feature_id}, CURRENT_DATE, ${usageCount}, \n            ${metadata ? JSON.stringify(metadata) : null}\n          )\n          ON CONFLICT (user_id, subscription_id, service_id, feature_id, usage_date)\n          DO UPDATE SET \n            usage_count = subscription_usage.usage_count + ${usageCount},\n            updated_at = NOW(),\n            metadata = COALESCE(${metadata ? JSON.stringify(metadata) : null}, subscription_usage.metadata)\n        `;\n      }\n\n      // Get updated quota info\n      const quotaCheck = await this.checkUserQuota(userId, serviceName, featureName);\n\n      return {\n        success: true,\n        new_usage_count: quotaCheck.current_usage,\n        quota_limit: quotaCheck.quota_limit,\n        remaining: quotaCheck.remaining,\n        message: 'Usage recorded successfully'\n      };\n\n    } catch (error) {\n      console.error('Error recording user usage:', error);\n      return {\n        success: false,\n        new_usage_count: 0,\n        quota_limit: 0,\n        remaining: 0,\n        message: 'Failed to record usage'\n      };\n    }\n  }\n\n  /**\n   * Reset a user's quota for a specific service/feature\n   */\n  static async resetUserQuota(\n    userId: number,\n    serviceName: string,\n    featureName: string,\n    reason?: string\n  ): Promise<{ success: boolean; message: string }> {\n    try {\n      // Get current usage before reset for audit logging\n      const currentUsage = await sql`\n        SELECT COALESCE(SUM(su.usage_count), 0) as total_usage\n        FROM subscription_usage su\n        JOIN subscription_services ss ON su.service_id = ss.id\n        JOIN subscription_features sf ON su.feature_id = sf.id\n        WHERE su.user_id = ${userId}\n        AND ss.name = ${serviceName}\n        AND sf.name = ${featureName}\n        AND su.usage_date >= CURRENT_DATE\n      `;\n\n      const previousUsage = currentUsage[0]?.total_usage || 0;\n\n      // Delete usage records for this user/service/feature\n      const resetResult = await sql`\n        DELETE FROM subscription_usage\n        WHERE user_id = ${userId}\n        AND service_id IN (\n          SELECT ss.id FROM subscription_services ss WHERE ss.name = ${serviceName}\n        )\n        AND feature_id IN (\n          SELECT sf.id FROM subscription_features sf \n          JOIN subscription_services ss ON sf.service_id = ss.id\n          WHERE ss.name = ${serviceName} AND sf.name = ${featureName}\n        )\n      `;\n\n      // Log the reset action for audit trail\n      await sql`\n        INSERT INTO admin_actions (\n          admin_user_id, action_type, action_details, reason, created_at\n        ) VALUES (\n          ${userId}, 'quota_reset', ${JSON.stringify({\n            target_user_id: userId,\n            service_name: serviceName,\n            feature_name: featureName,\n            previous_usage: previousUsage,\n            reset_count: resetResult.count\n          })}, ${reason || `Reset quota for ${serviceName}.${featureName}`}, NOW()\n        )\n      `;\n\n      return {\n        success: true,\n        message: `Quota reset successfully for ${serviceName}.${featureName} (previous usage: ${previousUsage})`\n      };\n\n    } catch (error) {\n      console.error('Error resetting user quota:', error);\n      return {\n        success: false,\n        message: 'Failed to reset quota'\n      };\n    }\n  }\n}\n\nexport default EnhancedQuotaService; ",
    "language":"typescript",
    "lines":619,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/service-worker-cleanup.ts":{
    "content":"/* eslint-disable no-console */\n/**\n * Service Worker Cleanup Utilities\n * Use these functions to manually clean up multiple service workers\n */\n\nimport { createLogger } from '@/lib/logging';\n\n// Create logger for service worker cleanup\nconst logger = createLogger({\n  context: {\n    component: 'ServiceWorkerCleanup',\n    module: 'utils'\n  }\n});\n\n/**\n * Display available console functions in big text\n */\nfunction displayAvailableFunctions(): void {\n  console.log(`\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\n\u2588\u2588                                                                         \u2588\u2588\n\u2588\u2588   \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588    \u2588\u2588 \u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588                   \u2588\u2588\n\u2588\u2588   \u2588\u2588      \u2588\u2588      \u2588\u2588   \u2588\u2588 \u2588\u2588    \u2588\u2588 \u2588\u2588 \u2588\u2588      \u2588\u2588                        \u2588\u2588\n\u2588\u2588   \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588    \u2588\u2588 \u2588\u2588 \u2588\u2588      \u2588\u2588\u2588\u2588\u2588                     \u2588\u2588\n\u2588\u2588        \u2588\u2588 \u2588\u2588      \u2588\u2588   \u2588\u2588  \u2588\u2588  \u2588\u2588  \u2588\u2588 \u2588\u2588      \u2588\u2588                        \u2588\u2588\n\u2588\u2588   \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588   \u2588\u2588   \u2588\u2588\u2588\u2588   \u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588                   \u2588\u2588\n\u2588\u2588                                                                         \u2588\u2588\n\u2588\u2588   \u2588\u2588     \u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588   \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588                     \u2588\u2588\n\u2588\u2588   \u2588\u2588     \u2588\u2588 \u2588\u2588    \u2588\u2588 \u2588\u2588   \u2588\u2588 \u2588\u2588  \u2588\u2588  \u2588\u2588      \u2588\u2588   \u2588\u2588                    \u2588\u2588\n\u2588\u2588   \u2588\u2588  \u2588  \u2588\u2588 \u2588\u2588    \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588\u2588\u2588\u2588                     \u2588\u2588\n\u2588\u2588   \u2588\u2588 \u2588\u2588\u2588 \u2588\u2588 \u2588\u2588    \u2588\u2588 \u2588\u2588   \u2588\u2588 \u2588\u2588  \u2588\u2588  \u2588\u2588      \u2588\u2588   \u2588\u2588                    \u2588\u2588\n\u2588\u2588    \u2588\u2588\u2588 \u2588\u2588\u2588   \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588   \u2588\u2588 \u2588\u2588   \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588   \u2588\u2588                    \u2588\u2588\n\u2588\u2588                                                                         \u2588\u2588\n\u2588\u2588                    \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588      \u2588\u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588    \u2588\u2588             \u2588\u2588\n\u2588\u2588                   \u2588\u2588      \u2588\u2588      \u2588\u2588      \u2588\u2588   \u2588\u2588 \u2588\u2588\u2588\u2588   \u2588\u2588             \u2588\u2588\n\u2588\u2588                   \u2588\u2588      \u2588\u2588      \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588  \u2588\u2588             \u2588\u2588\n\u2588\u2588                   \u2588\u2588      \u2588\u2588      \u2588\u2588      \u2588\u2588   \u2588\u2588 \u2588\u2588  \u2588\u2588 \u2588\u2588             \u2588\u2588\n\u2588\u2588                    \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588   \u2588\u2588 \u2588\u2588   \u2588\u2588\u2588\u2588             \u2588\u2588\n\u2588\u2588                                                                         \u2588\u2588\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\n\n\ud83d\ude80 SERVICE WORKER CLEANUP UTILITIES LOADED!\n\nAvailable functions in your browser console:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            \ud83d\udccb DIAGNOSTIC TOOLS                             \u2502\n\u2502                                                                             \u2502\n\u2502  \ud83d\udd0d diagnoseServiceWorkerIssues()                                           \u2502\n\u2502     \u21b3 Analyze current SW state & get personalized recommendations          \u2502\n\u2502     \u21b3 START HERE: Shows what's wrong and what to run                       \u2502\n\u2502                                                                             \u2502\n\u2502  \ud83d\udcca inspectServiceWorkers()                                                 \u2502\n\u2502     \u21b3 Shows detailed info about all registered service workers             \u2502\n\u2502     \u21b3 Use this to see what's currently registered                          \u2502\n\u2502                                                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                            \ud83e\uddf9 CLEANUP TOOLS                                \u2502\n\u2502                                                                             \u2502\n\u2502  \ud83d\udd27 advancedServiceWorkerCleanup()  \u2b50 RECOMMENDED FOR STUCK SWs            \u2502\n\u2502     \u21b3 Handles stuck/failed registrations visible in DevTools               \u2502\n\u2502     \u21b3 Perfect for \\\"trying to install\\\" and DevTools test messages           \u2502\n\u2502                                                                             \u2502\n\u2502  \ud83c\udfaf enforceOneServiceWorker()                                               \u2502\n\u2502     \u21b3 Keeps only the most recent service worker, removes the rest          \u2502\n\u2502     \u21b3 Use this for gentle cleanup (keeps one working SW)                   \u2502\n\u2502                                                                             \u2502\n\u2502  \ud83e\udde8 nukeAllServiceWorkers()                                                 \u2502\n\u2502     \u21b3 NUCLEAR: Removes ALL service workers + clears all caches             \u2502\n\u2502     \u21b3 Use when you have too many standard registrations                    \u2502\n\u2502                                                                             \u2502\n\u2502  \u2622\ufe0f  nuclearServiceWorkerReset()                                            \u2502\n\u2502     \u21b3 ULTIMATE NUCLEAR: Complete browser state reset                       \u2502\n\u2502     \u21b3 Last resort when everything else fails                               \u2502\n\u2502                                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\ud83d\udea8 FOR YOUR ISSUE (stuck \\\"trying to install\\\" service workers):\n   1. diagnoseServiceWorkerIssues()     (confirm the problem)\n   2. advancedServiceWorkerCleanup()    (fix stuck registrations)\n   3. Close ALL tabs and reopen browser (essential!)\n\n\ud83d\udca1 GENERAL WORKFLOW:\n   1. Run: diagnoseServiceWorkerIssues()  (get personalized advice)\n   2. Follow the recommendation it gives you\n   3. Close all tabs and reopen browser\n\n`);\n}\n\n/**\n * Immediately unregister ALL service workers for the current domain\n * Use this when you have too many service workers accumulating\n */\nexport async function nukeAllServiceWorkers(): Promise<void> {\n  if (!('serviceWorker' in navigator)) {\n    logger.warn('Service workers not supported in this browser');\n    return;\n  }\n\n  try {\n    logger.group('\ud83e\udde8 NUKING ALL SERVICE WORKERS');\n\n    const registrations = await navigator.serviceWorker.getRegistrations();\n    logger.info('Found service worker registrations', {\n      count: registrations.length\n    });\n\n    if (registrations.length === 0) {\n      console.log('\u2705 No service workers to clean up');\n      logger.groupEnd();\n      return;\n    }\n\n    // Unregister ALL service workers\n    const unregisterPromises = registrations.map(\n      async (registration, index) => {\n        try {\n          await registration.unregister();\n          console.log(\n            `\u2705 Unregistered service worker ${index + 1}/${registrations.length}`\n          );\n          return true;\n        } catch (error) {\n          console.error(\n            `\u274c Failed to unregister service worker ${index + 1}:`,\n            error\n          );\n          return false;\n        }\n      }\n    );\n\n    const results = await Promise.all(unregisterPromises);\n    const successCount = results.filter((success) => success).length;\n\n    console.log(\n      `\ud83c\udfaf Cleanup complete: ${successCount}/${registrations.length} service workers removed`\n    );\n\n    // Clear all caches too\n    if ('caches' in window) {\n      const cacheNames = await caches.keys();\n      if (cacheNames.length > 0) {\n        console.log(`\ud83d\uddd1\ufe0f Clearing ${cacheNames.length} caches...`);\n        await Promise.all(\n          cacheNames.map((cacheName) => caches.delete(cacheName))\n        );\n        console.log('\u2705 All caches cleared');\n      }\n    }\n\n    logger.groupEnd();\n    console.log('\ud83d\udd04 Refresh the page to start fresh');\n  } catch (error) {\n    console.error('\u274c Failed to nuke service workers:', error);\n    logger.groupEnd();\n  }\n}\n\n/**\n * Get detailed information about all service workers\n */\nexport async function inspectServiceWorkers(): Promise<void> {\n  if (!('serviceWorker' in navigator)) {\n    console.warn('Service workers not supported in this browser');\n    return;\n  }\n\n  try {\n    const registrations = await navigator.serviceWorker.getRegistrations();\n\n    logger.group(\n      `\ud83d\udd0d SERVICE WORKER INSPECTION (${registrations.length} found)`\n    );\n\n    if (registrations.length === 0) {\n      console.log('\u2705 No service workers registered');\n      logger.groupEnd();\n      return;\n    }\n\n    registrations.forEach((registration, index) => {\n      logger.group(`\ud83d\udccb Service Worker ${index + 1}`);\n      logger.info('Scope', { scope: registration.scope });\n      logger.info('Installing', {\n        scriptURL: registration.installing?.scriptURL || 'None'\n      });\n      logger.info('Waiting', {\n        scriptURL: registration.waiting?.scriptURL || 'None'\n      });\n      logger.info('Active', {\n        scriptURL: registration.active?.scriptURL || 'None'\n      });\n      logger.info('Update via cache', {\n        updateViaCache: registration.updateViaCache\n      });\n\n      if (registration.active) {\n        logger.info('State', { state: registration.active.state });\n        logger.info('Script URL', { scriptURL: registration.active.scriptURL });\n      }\n\n      logger.groupEnd();\n    });\n\n    logger.groupEnd();\n\n    if (registrations.length > 1) {\n      logger.warn(\n        `\u26a0\ufe0f Multiple service workers detected! Run nukeAllServiceWorkers() to clean up.`\n      );\n    }\n  } catch (error) {\n    console.error('\u274c Failed to inspect service workers:', error);\n  }\n}\n\n/**\n * Enforce exactly one service worker (keep the most recent)\n */\nexport async function enforceOneServiceWorker(): Promise<void> {\n  if (!('serviceWorker' in navigator)) {\n    console.warn('Service workers not supported in this browser');\n    return;\n  }\n\n  try {\n    const registrations = await navigator.serviceWorker.getRegistrations();\n\n    if (registrations.length <= 1) {\n      console.log('\u2705 Single service worker enforcement: OK');\n      return;\n    }\n\n    logger.group(\n      `\ud83c\udfaf ENFORCING SINGLE SERVICE WORKER (${registrations.length} found)`\n    );\n\n    // Sort by most recent (by script URL timestamp)\n    const sortedRegistrations = [...registrations].sort((a, b) => {\n      const aTime =\n        a.installing?.scriptURL ||\n        a.waiting?.scriptURL ||\n        a.active?.scriptURL ||\n        '';\n      const bTime =\n        b.installing?.scriptURL ||\n        b.waiting?.scriptURL ||\n        b.active?.scriptURL ||\n        '';\n      return bTime.localeCompare(aTime);\n    });\n\n    logger.info('\ud83c\udfc6 Keeping most recent:', {\n      scope: sortedRegistrations[0].scope\n    });\n\n    // Unregister all but the first (most recent)\n    const cleanupPromises = sortedRegistrations\n      .slice(1)\n      .map(async (registration, index) => {\n        try {\n          await registration.unregister();\n          console.log(`\u2705 Removed old service worker ${index + 1}`);\n          return true;\n        } catch (error) {\n          console.error(\n            `\u274c Failed to remove service worker ${index + 1}:`,\n            error\n          );\n          return false;\n        }\n      });\n\n    const results = await Promise.all(cleanupPromises);\n    const cleanedCount = results.filter((success) => success).length;\n\n    console.log(`\ud83c\udfaf Enforcement complete: kept 1, removed ${cleanedCount}`);\n    logger.groupEnd();\n  } catch (error) {\n    console.error('\u274c Failed to enforce single service worker:', error);\n  }\n}\n\n/**\n * Advanced service worker cleanup that handles stuck/failed registrations\n * These are often not detected by getRegistrations() but visible in DevTools\n */\nexport async function advancedServiceWorkerCleanup(): Promise<void> {\n  if (!('serviceWorker' in navigator)) {\n    console.warn('Service workers not supported in this browser');\n    return;\n  }\n\n  try {\n    logger.group('\ud83d\udd27 ADVANCED SERVICE WORKER CLEANUP');\n\n    // Step 1: Standard cleanup\n    logger.info('\ud83d\udccb Step 1: Standard registration cleanup...');\n    const registrations = await navigator.serviceWorker.getRegistrations();\n    logger.info('Found standard registrations', {\n      count: registrations.length\n    });\n\n    for (const registration of registrations) {\n      try {\n        await registration.unregister();\n        console.log('\u2705 Unregistered standard service worker');\n      } catch (error) {\n        console.warn('\u26a0\ufe0f Failed to unregister standard service worker:', error);\n      }\n    }\n\n    // Step 2: Force unregister all scopes (common PWA scopes)\n    logger.info('\ud83c\udfaf Step 2: Force unregistering common scopes...');\n    const commonScopes = [\n      '/',\n      '/sw.js',\n      '/service-worker.js',\n      '/pwa-sw.js',\n      '/workbox-sw.js',\n      '/firebase-messaging-sw.js',\n      window.location.origin + '/',\n      window.location.origin + '/sw.js',\n      window.location.origin + '/service-worker.js'\n    ];\n\n    for (const scope of commonScopes) {\n      try {\n        const registration =\n          await navigator.serviceWorker.getRegistration(scope);\n        if (registration) {\n          await registration.unregister();\n          console.log(`\u2705 Force unregistered scope: ${scope}`);\n        }\n      } catch (error) {\n        // Silently continue - scope might not exist\n      }\n    }\n\n    // Step 3: Clear service worker controller\n    logger.info('\ud83d\udc51 Step 3: Clearing service worker controller...');\n    if (navigator.serviceWorker.controller) {\n      try {\n        navigator.serviceWorker.controller.postMessage({\n          type: 'SKIP_WAITING'\n        });\n        console.log('\u2705 Sent SKIP_WAITING to controller');\n      } catch (error) {\n        console.warn('\u26a0\ufe0f Failed to message controller:', error);\n      }\n    }\n\n    // Step 4: Clear all caches aggressively\n    logger.info('\ud83d\uddd1\ufe0f Step 4: Aggressive cache clearing...');\n    if ('caches' in window) {\n      const cacheNames = await caches.keys();\n      logger.info('Found caches to clear', { count: cacheNames.length });\n\n      for (const cacheName of cacheNames) {\n        try {\n          await caches.delete(cacheName);\n          console.log(`\u2705 Deleted cache: ${cacheName}`);\n        } catch (error) {\n          console.warn(`\u26a0\ufe0f Failed to delete cache ${cacheName}:`, error);\n        }\n      }\n    }\n\n    // Step 5: Clear storage that might be holding SW references\n    logger.info('\ud83d\udcbe Step 5: Clearing related storage...');\n    try {\n      // Clear localStorage items that might reference service workers\n      const swKeys = Object.keys(localStorage).filter(\n        (key) =>\n          key.includes('sw-') ||\n          key.includes('service-worker') ||\n          key.includes('workbox') ||\n          key.includes('pwa')\n      );\n\n      swKeys.forEach((key) => {\n        localStorage.removeItem(key);\n        console.log(`\u2705 Cleared localStorage: ${key}`);\n      });\n\n      // Clear sessionStorage\n      const sessionSwKeys = Object.keys(sessionStorage).filter(\n        (key) =>\n          key.includes('sw-') ||\n          key.includes('service-worker') ||\n          key.includes('workbox') ||\n          key.includes('pwa')\n      );\n\n      sessionSwKeys.forEach((key) => {\n        sessionStorage.removeItem(key);\n        console.log(`\u2705 Cleared sessionStorage: ${key}`);\n      });\n    } catch (error) {\n      console.warn('\u26a0\ufe0f Failed to clear some storage:', error);\n    }\n\n    // Step 6: Force reload to ensure clean state\n    logger.info('\ud83d\udd04 Step 6: Preparing for clean reload...');\n    console.log('\u2705 Advanced cleanup complete!');\n    logger.groupEnd();\n\n    console.log(`\n\ud83c\udfaf ADVANCED CLEANUP COMPLETE!\n\nWhat was cleaned:\n\u2705 Standard service worker registrations\n\u2705 Common PWA scope registrations  \n\u2705 Service worker controller messages\n\u2705 All browser caches\n\u2705 Service worker related localStorage\n\u2705 Service worker related sessionStorage\n\n\ud83d\udd04 NEXT STEPS:\n1. Close ALL browser tabs for this domain\n2. Reopen the browser completely\n3. Navigate back to the site\n4. Check DevTools \u2192 Application \u2192 Service Workers\n\nThis should remove the stuck \\\"trying to install\\\" registrations.\n    `);\n  } catch (error) {\n    console.error('\u274c Advanced cleanup failed:', error);\n    logger.groupEnd();\n  }\n}\n\n/**\n * Diagnose service worker issues and provide specific guidance\n */\nexport async function diagnoseServiceWorkerIssues(): Promise<void> {\n  logger.group('\ud83d\udd0d SERVICE WORKER DIAGNOSTIC');\n\n  try {\n    // Check standard registrations\n    const registrations = await navigator.serviceWorker.getRegistrations();\n    logger.info('Found standard registrations', {\n      count: registrations.length\n    });\n\n    // Check controller\n    const hasController = !!navigator.serviceWorker.controller;\n    logger.info('Has active controller', { hasController });\n\n    if (hasController) {\n      logger.info('Controller scope', {\n        scriptURL: navigator.serviceWorker.controller?.scriptURL\n      });\n    }\n\n    // Check ready state\n    try {\n      const ready = await navigator.serviceWorker.ready;\n      logger.info('ServiceWorker ready state', {\n        state: ready.active?.state || 'none'\n      });\n    } catch (error) {\n      logger.info('ServiceWorker ready state', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // Check common issues\n    logger.info('\\\\n\ud83d\udea8 COMMON ISSUES DETECTED:');\n\n    if (registrations.length === 0) {\n      logger.info(\n        '\u26a0\ufe0f No standard registrations found, but you see them in DevTools'\n      );\n      logger.info('   \u2192 This indicates STUCK/FAILED registrations');\n      logger.info('   \u2192 Run: advancedServiceWorkerCleanup()');\n    }\n\n    if (registrations.length > 1) {\n      logger.info('\u26a0\ufe0f Multiple registrations detected');\n      logger.info('   \u2192 This can cause conflicts');\n      logger.info('   \u2192 Run: enforceOneServiceWorker()');\n    }\n\n    // Check for DevTools test messages\n    logger.info('\\\\n\ud83e\uddea DEVTOOLS TEST DETECTION:');\n    logger.info(\n      'If you see \\\"Test push message from DevTools\\\" in Application tab:'\n    );\n    logger.info('   \u2192 These are created by DevTools Push Messaging testing');\n    logger.info('   \u2192 They can get stuck in \\\"trying to install\\\" state');\n    logger.info(\n      '   \u2192 Solution: advancedServiceWorkerCleanup() + close all tabs'\n    );\n\n    logger.info('\\\\n\ud83d\udca1 RECOMMENDED ACTION:');\n    if (registrations.length === 0) {\n      logger.info('\ud83c\udfaf Run: advancedServiceWorkerCleanup()');\n    } else if (registrations.length > 1) {\n      logger.info('\ud83c\udfaf Run: enforceOneServiceWorker()');\n    } else {\n      logger.info('\ud83c\udfaf Everything looks normal');\n    }\n  } catch (error) {\n    console.error('\u274c Diagnostic failed:', error);\n  }\n\n  logger.groupEnd();\n}\n\n/**\n * Nuclear option: Complete browser state reset for service workers\n */\nexport async function nuclearServiceWorkerReset(): Promise<void> {\n  logger.group('\u2622\ufe0f NUCLEAR SERVICE WORKER RESET');\n  logger.warn('\u26a0\ufe0f This will clear EVERYTHING related to service workers!');\n\n  try {\n    // Run advanced cleanup first\n    await advancedServiceWorkerCleanup();\n\n    // Additional nuclear options\n    logger.info('\ud83d\udca3 Additional nuclear cleanup...');\n\n    // Try to clear IndexedDB (some PWAs store SW data here)\n    if ('indexedDB' in window) {\n      try {\n        // This is a bit aggressive but necessary for stuck SWs\n        logger.info('\ud83d\uddc3\ufe0f Attempting IndexedDB cleanup...');\n\n        // Get all databases (this is experimental)\n        if ('databases' in indexedDB) {\n          const databases = await (indexedDB as any).databases();\n          for (const db of databases) {\n            try {\n              indexedDB.deleteDatabase(db.name);\n              console.log(`\u2705 Deleted IndexedDB: ${db.name}`);\n            } catch (error) {\n              console.warn(`\u26a0\ufe0f Failed to delete IndexedDB ${db.name}:`, error);\n            }\n          }\n        }\n      } catch (error) {\n        console.warn('\u26a0\ufe0f IndexedDB cleanup failed:', error);\n      }\n    }\n\n    logger.info('\u2622\ufe0f Nuclear reset complete!');\n    console.log(`\n\ud83c\udfaf NUCLEAR RESET COMPLETE!\n\nCRITICAL NEXT STEPS:\n1. \ud83d\udeaa Close ALL browser tabs for this domain\n2. \ud83d\udd04 Close and reopen your entire browser\n3. \ud83e\uddf9 Optional: Clear browser data for this site:\n   - Go to DevTools \u2192 Application \u2192 Storage\n   - Click \\\"Clear site data\\\"\n4. \ud83c\udf10 Navigate back to the site fresh\n\nThis should eliminate ALL stuck service worker registrations.\n    `);\n  } catch (error) {\n    console.error('\u274c Nuclear reset failed:', error);\n  }\n\n  logger.groupEnd();\n}\n\nexport function displayServiceWorkerNukeInstructions() {\n  // Keep console display functions intentionally for debugging tools\n  // eslint-disable-next-line no-console\n  console.log(`\n\ud83e\udde8 NUCLEAR SERVICE WORKER CLEANUP \ud83e\udde8\n=====================================\n\nThis will COMPLETELY destroy all service workers and caches.\nUse this when the normal cleanup isn't working.\n\nTo execute the nuclear option, run:\nnukeAllServiceWorkers()\n\nWARNING: This will:\n- Unregister ALL service workers on this domain\n- Delete ALL caches\n- Force refresh the page\n- May cause temporary loading issues\n\nOnly use if normal cache refresh isn't working!\n`);\n}\n\n// Make functions available globally for console use\nif (typeof window !== 'undefined') {\n  (window as any).nukeAllServiceWorkers = nukeAllServiceWorkers;\n  (window as any).inspectServiceWorkers = inspectServiceWorkers;\n  (window as any).enforceOneServiceWorker = enforceOneServiceWorker;\n  (window as any).advancedServiceWorkerCleanup = advancedServiceWorkerCleanup;\n  (window as any).diagnoseServiceWorkerIssues = diagnoseServiceWorkerIssues;\n  (window as any).nuclearServiceWorkerReset = nuclearServiceWorkerReset;\n  (window as any).showServiceWorkerHelp = displayAvailableFunctions;\n\n  // Automatically display the help when the utilities are loaded\n  setTimeout(() => {\n    displayAvailableFunctions();\n  }, 2000); // Delay to ensure console is ready\n}\n",
    "language":"typescript",
    "lines":611,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/content-parsers.ts":{
    "content":"/**\n * Modular content parsers for different pill types\n * Each parser handles a specific responsibility and can be composed together\n */\n\nimport { detectURLsInText, parseURLPill } from '../config/url-pills';\n\nexport type SegmentType = 'text' | 'hashtag' | 'mention' | 'url';\n\nexport interface ContentSegment {\n  type: SegmentType;\n  value: string;\n  userId?: string; // For mentions, store the resolved user ID\n  displayName?: string; // For mentions, store the display username\n  filterType?: 'author' | 'mentions'; // For enhanced mentions, store filter type\n  behavior?: string; // For URL pills, store the behavior (modal, link, embed)\n  rawFormat?: string; // Store the original format for enhanced mentions or URL pills\n  start?: number; // Position in original text\n  end?: number; // Position in original text\n}\n\nexport interface TokenizedContent {\n  // Character-level tokenization\n  characters: Array<{\n    char: string;\n    index: number;\n    isWhitespace: boolean;\n    isNewline: boolean;\n    isPunctuation: boolean;\n    segmentIndex: number; // Which segment this character belongs to\n    segmentType: SegmentType;\n  }>;\n\n  // Word-level tokenization\n  words: Array<{\n    word: string;\n    start: number;\n    end: number;\n    isWhitespace: boolean;\n    segmentIndex: number; // Which segment this word belongs to\n    segmentType: SegmentType;\n  }>;\n\n  // Pill-level tokenization (hashtags, mentions, URLs)\n  pills: Array<{\n    type: 'hashtag' | 'mention' | 'url';\n    value: string;\n    displayValue: string; // What's shown to user (e.g., @username vs @[username|id])\n    start: number;\n    end: number;\n    data: any; // Type-specific data (userId, behavior, etc.)\n    segmentIndex: number;\n  }>;\n\n  // Original segments for backward compatibility\n  segments: ContentSegment[];\n}\n\nexport interface ParsedMatch {\n  content: string;\n  start: number;\n  end: number;\n  type: SegmentType;\n  data?: any; // Additional parsed data specific to the type\n}\n\n/**\n * Hashtag Parser\n * Handles: #tagname\n */\nexport class HashtagParser {\n  private static readonly REGEX = /#[a-zA-Z0-9_-]+/g;\n\n  static findMatches(text: string): ParsedMatch[] {\n    const matches: ParsedMatch[] = [];\n    let match;\n\n    // Reset regex lastIndex\n    this.REGEX.lastIndex = 0;\n\n    while ((match = this.REGEX.exec(text)) !== null) {\n      matches.push({\n        content: match[0],\n        start: match.index,\n        end: match.index + match[0].length,\n        type: 'hashtag',\n        data: {\n          hashtag: match[0].slice(1) // Remove # prefix\n        }\n      });\n    }\n\n    return matches;\n  }\n\n  static parseMatch(match: ParsedMatch): ContentSegment {\n    return {\n      type: 'hashtag',\n      value: match.data.hashtag, // Just the tag name without #\n      rawFormat: match.content, // Full format with #\n      start: match.start,\n      end: match.end\n    };\n  }\n}\n\n/**\n * Mention Parser\n * Handles: @[username|userId] or @[username|userId|filterType]\n */\nexport class MentionParser {\n  private static readonly REGEX = /@\\\\[[^\\\\]]+\\\\]/g;\n\n  static findMatches(text: string): ParsedMatch[] {\n    const matches: ParsedMatch[] = [];\n    let match;\n\n    // Reset regex lastIndex\n    this.REGEX.lastIndex = 0;\n\n    while ((match = this.REGEX.exec(text)) !== null) {\n      const content = match[0];\n      const parsedData = this.parseMentionContent(content);\n\n      if (parsedData) {\n        matches.push({\n          content,\n          start: match.index,\n          end: match.index + content.length,\n          type: 'mention',\n          data: parsedData\n        });\n      }\n    }\n\n    return matches;\n  }\n\n  private static parseMentionContent(content: string) {\n    // Enhanced format: @[username|userId|filterType]\n    const enhancedMatch = content.match(\n      /^@\\\\[([^|]+)\\\\|([^|]+)(?:\\\\|([^|]+))?\\\\]$/\n    );\n    if (enhancedMatch) {\n      const [, username, userId, filterType] = enhancedMatch;\n      return {\n        username,\n        userId,\n        filterType: (filterType as 'author' | 'mentions') || 'author'\n      };\n    }\n\n    // Legacy format: @[username|userId]\n    const legacyMatch = content.match(/^@\\\\[([^|]+)\\\\|([^\\\\]]+)\\\\]$/);\n    if (legacyMatch) {\n      const [, username, userId] = legacyMatch;\n      return {\n        username,\n        userId,\n        filterType: 'author' as const\n      };\n    }\n\n    return null;\n  }\n\n  static parseMatch(match: ParsedMatch): ContentSegment | null {\n    if (!match.data) return null;\n\n    return {\n      type: 'mention',\n      value: match.data.username,\n      userId: match.data.userId,\n      displayName: match.data.username,\n      filterType: match.data.filterType,\n      rawFormat: match.content,\n      start: match.start,\n      end: match.end\n    };\n  }\n}\n\n/**\n * Structured URL Pill Parser\n * Handles: ![behavior](url)\n */\nexport class StructuredURLPillParser {\n  private static readonly REGEX = /!\\\\[[^\\\\]]+\\\\]\\\\([^)]+\\\\)/g;\n\n  static findMatches(text: string): ParsedMatch[] {\n    const matches: ParsedMatch[] = [];\n    let match;\n\n    // Reset regex lastIndex\n    this.REGEX.lastIndex = 0;\n\n    while ((match = this.REGEX.exec(text)) !== null) {\n      const content = match[0];\n      const parsedData = parseURLPill(content);\n\n      if (parsedData) {\n        matches.push({\n          content,\n          start: match.index,\n          end: match.index + content.length,\n          type: 'url',\n          data: parsedData\n        });\n      }\n    }\n\n    return matches;\n  }\n\n  static parseMatch(match: ParsedMatch): ContentSegment | null {\n    if (!match.data) return null;\n\n    return {\n      type: 'url',\n      value: match.data.url,\n      rawFormat: match.content,\n      behavior: match.data.behavior,\n      start: match.start,\n      end: match.end\n    };\n  }\n}\n\n/**\n * Fallback URL Parser\n * Handles: Raw URLs like https://youtube.com/watch?v=abc\n */\nexport class FallbackURLParser {\n  static findMatches(text: string): ParsedMatch[] {\n    const detectedUrls = detectURLsInText(text);\n\n    return detectedUrls.map((urlData: any) => ({\n      content: text.substring(urlData.start, urlData.end),\n      start: urlData.start,\n      end: urlData.end,\n      type: 'url' as const,\n      data: {\n        url: urlData.url,\n        domain: urlData.domain,\n        behavior: urlData.domain.defaultBehavior\n      }\n    }));\n  }\n\n  static parseMatch(match: ParsedMatch): ContentSegment | null {\n    if (!match.data) return null;\n\n    return {\n      type: 'url',\n      value: match.data.url,\n      behavior: match.data.behavior,\n      rawFormat: match.content, // Add rawFormat so edit controls work\n      start: match.start,\n      end: match.end\n    };\n  }\n}\n\n/**\n * Main ContentParser class that orchestrates all parsers\n */\nexport class ContentParser {\n  /**\n   * Parse content with strict precedence:\n   * 1. Structured URL Pills (highest priority)\n   * 2. Hashtags and Mentions (equal priority)\n   * 3. Fallback URLs (lowest priority, only in remaining text)\n   */\n  static parse(text: string): ContentSegment[] {\n    const segments: ContentSegment[] = [];\n    let processedRanges: Array<{ start: number; end: number }> = [];\n\n    // Step 1: Parse structured URL pills first (highest priority)\n    const structuredMatches = StructuredURLPillParser.findMatches(text);\n    for (const match of structuredMatches) {\n      const segment = StructuredURLPillParser.parseMatch(match);\n      if (segment) {\n        segments.push(segment);\n        processedRanges.push({ start: match.start, end: match.end });\n      }\n    }\n\n    // Step 2: Parse hashtags and mentions in remaining text\n    const remainingText = this.extractUnprocessedText(text, processedRanges);\n    for (const textChunk of remainingText) {\n      // Find hashtags and mentions in this chunk\n      const hashtagMatches = HashtagParser.findMatches(textChunk.text);\n      const mentionMatches = MentionParser.findMatches(textChunk.text);\n\n      // Combine and sort by position\n      const allMatches = [\n        ...hashtagMatches.map((m) => ({\n          ...m,\n          start: m.start + textChunk.offset,\n          end: m.end + textChunk.offset\n        })),\n        ...mentionMatches.map((m) => ({\n          ...m,\n          start: m.start + textChunk.offset,\n          end: m.end + textChunk.offset\n        }))\n      ].sort((a, b) => a.start - b.start);\n\n      // Process matches\n      for (const match of allMatches) {\n        const segment = this.parseStructuredMatch(match);\n        if (segment) {\n          segments.push(segment);\n          processedRanges.push({ start: match.start, end: match.end });\n        }\n      }\n    }\n\n    // Step 3: Add fallback URLs in remaining text\n    this.addTextWithFallbackURLs(text, segments, processedRanges);\n\n    // Step 4: Add remaining text segments\n    this.addTextSegments(text, segments, processedRanges);\n\n    // Sort all segments by position\n    return segments.sort((a, b) => (a.start || 0) - (b.start || 0));\n  }\n\n  /**\n   * Enhanced tokenization that provides character, word, and pill-level tokens\n   */\n  static tokenize(text: string): TokenizedContent {\n    // First get the standard segments\n    const segments = this.parse(text);\n\n    // Initialize tokenized content\n    const tokenizedContent: TokenizedContent = {\n      characters: [],\n      words: [],\n      pills: [],\n      segments\n    };\n\n    // Character-level tokenization\n    for (let i = 0; i < text.length; i++) {\n      const char = text[i];\n      const segmentIndex = this.findSegmentAtIndex(segments, i);\n      const segment = segments[segmentIndex] || { type: 'text' as SegmentType };\n\n      tokenizedContent.characters.push({\n        char,\n        index: i,\n        isWhitespace: /\\\\s/.test(char),\n        isNewline: char === '\\\\n',\n        isPunctuation: /[^\\\\w\\\\s]/.test(char),\n        segmentIndex,\n        segmentType: segment.type\n      });\n    }\n\n    // Word-level tokenization\n    const wordRegex = /\\\\S+|\\\\s+/g;\n    let wordMatch;\n    while ((wordMatch = wordRegex.exec(text)) !== null) {\n      const word = wordMatch[0];\n      const start = wordMatch.index;\n      const end = start + word.length;\n      const segmentIndex = this.findSegmentAtIndex(segments, start);\n      const segment = segments[segmentIndex] || { type: 'text' as SegmentType };\n\n      tokenizedContent.words.push({\n        word,\n        start,\n        end,\n        isWhitespace: /^\\\\s+$/.test(word),\n        segmentIndex,\n        segmentType: segment.type\n      });\n    }\n\n    // Pill-level tokenization\n    segments.forEach((segment, index) => {\n      if (segment.type !== 'text') {\n        let displayValue = segment.value;\n        let data: any = {};\n\n        switch (segment.type) {\n          case 'hashtag':\n            displayValue = `#${segment.value}`;\n            data = { hashtag: segment.value };\n            break;\n          case 'mention':\n            displayValue = `@${segment.value}`;\n            data = {\n              username: segment.value,\n              userId: segment.userId,\n              displayName: segment.displayName,\n              filterType: segment.filterType\n            };\n            break;\n          case 'url':\n            displayValue = segment.value;\n            data = {\n              url: segment.value,\n              behavior: segment.behavior,\n              rawFormat: segment.rawFormat\n            };\n            break;\n        }\n\n        tokenizedContent.pills.push({\n          type: segment.type as 'hashtag' | 'mention' | 'url',\n          value: segment.value,\n          displayValue,\n          start: segment.start || 0,\n          end: segment.end || 0,\n          data,\n          segmentIndex: index\n        });\n      }\n    });\n\n    return tokenizedContent;\n  }\n\n  /**\n   * Find which segment contains the character at the given index\n   */\n  private static findSegmentAtIndex(\n    segments: ContentSegment[],\n    index: number\n  ): number {\n    for (let i = 0; i < segments.length; i++) {\n      const segment = segments[i];\n      if (segment.start !== undefined && segment.end !== undefined) {\n        if (index >= segment.start && index < segment.end) {\n          return i;\n        }\n      }\n    }\n    return -1; // Not found in any segment\n  }\n\n  /**\n   * Get character at specific position with context\n   */\n  static getCharacterAt(tokenizedContent: TokenizedContent, index: number) {\n    return tokenizedContent.characters.find((char) => char.index === index);\n  }\n\n  /**\n   * Get word at specific position\n   */\n  static getWordAt(tokenizedContent: TokenizedContent, index: number) {\n    return tokenizedContent.words.find(\n      (word) => index >= word.start && index < word.end\n    );\n  }\n\n  /**\n   * Get pill at specific position\n   */\n  static getPillAt(tokenizedContent: TokenizedContent, index: number) {\n    return tokenizedContent.pills.find(\n      (pill) => index >= pill.start && index < pill.end\n    );\n  }\n\n  /**\n   * Get all pills of a specific type\n   */\n  static getPillsByType(\n    tokenizedContent: TokenizedContent,\n    type: 'hashtag' | 'mention' | 'url'\n  ) {\n    return tokenizedContent.pills.filter((pill) => pill.type === type);\n  }\n\n  /**\n   * Get word boundaries for cursor positioning\n   */\n  static getWordBoundaries(\n    tokenizedContent: TokenizedContent,\n    index: number\n  ): { start: number; end: number } | null {\n    const word = this.getWordAt(tokenizedContent, index);\n    if (word && !word.isWhitespace) {\n      return { start: word.start, end: word.end };\n    }\n    return null;\n  }\n\n  /**\n   * Get next/previous word position for navigation\n   */\n  static getNextWordPosition(\n    tokenizedContent: TokenizedContent,\n    currentIndex: number\n  ): number {\n    const words = tokenizedContent.words.filter(\n      (w) => !w.isWhitespace && w.start > currentIndex\n    );\n    return words.length > 0\n      ? words[0].start\n      : tokenizedContent.characters.length;\n  }\n\n  static getPreviousWordPosition(\n    tokenizedContent: TokenizedContent,\n    currentIndex: number\n  ): number {\n    const words = tokenizedContent.words.filter(\n      (w) => !w.isWhitespace && w.start < currentIndex\n    );\n    return words.length > 0 ? words[words.length - 1].start : 0;\n  }\n\n  /**\n   * Get line information for multiline content\n   */\n  static getLineInfo(\n    tokenizedContent: TokenizedContent,\n    index: number\n  ): {\n    lineNumber: number;\n    lineStart: number;\n    lineEnd: number;\n    columnIndex: number;\n  } {\n    const newlines = tokenizedContent.characters\n      .filter((char) => char.isNewline)\n      .map((char) => char.index);\n\n    let lineNumber = 0;\n    let lineStart = 0;\n\n    for (const newlineIndex of newlines) {\n      if (index <= newlineIndex) {\n        break;\n      }\n      lineNumber++;\n      lineStart = newlineIndex + 1;\n    }\n\n    const nextNewlineIndex = newlines.find((nl) => nl > index);\n    const lineEnd =\n      nextNewlineIndex !== undefined\n        ? nextNewlineIndex\n        : tokenizedContent.characters.length;\n\n    return {\n      lineNumber,\n      lineStart,\n      lineEnd,\n      columnIndex: index - lineStart\n    };\n  }\n\n  /**\n   * Insert text at a specific position while maintaining tokenization\n   */\n  static insertText(\n    originalText: string,\n    insertPosition: number,\n    textToInsert: string\n  ): { newText: string; newTokenizedContent: TokenizedContent } {\n    const newText =\n      originalText.slice(0, insertPosition) +\n      textToInsert +\n      originalText.slice(insertPosition);\n\n    const newTokenizedContent = this.tokenize(newText);\n\n    return { newText, newTokenizedContent };\n  }\n\n  /**\n   * Delete text range while maintaining tokenization\n   */\n  static deleteTextRange(\n    originalText: string,\n    startIndex: number,\n    endIndex: number\n  ): { newText: string; newTokenizedContent: TokenizedContent } {\n    const newText =\n      originalText.slice(0, startIndex) + originalText.slice(endIndex);\n\n    const newTokenizedContent = this.tokenize(newText);\n\n    return { newText, newTokenizedContent };\n  }\n\n  /**\n   * Replace a pill with new text\n   */\n  static replacePill(\n    originalText: string,\n    pillIndex: number,\n    newText: string\n  ): { newText: string; newTokenizedContent: TokenizedContent } {\n    const tokenizedContent = this.tokenize(originalText);\n    const pill = tokenizedContent.pills[pillIndex];\n\n    if (!pill) {\n      throw new Error(`Pill at index ${pillIndex} not found`);\n    }\n\n    // Delete the pill and insert new text\n    const deletedResult = this.deleteTextRange(\n      originalText,\n      pill.start,\n      pill.end\n    );\n    const finalResult = this.insertText(\n      deletedResult.newText,\n      pill.start,\n      newText\n    );\n\n    return finalResult;\n  }\n\n  /**\n   * Get selection text and metadata\n   */\n  static getSelectionInfo(\n    tokenizedContent: TokenizedContent,\n    startIndex: number,\n    endIndex: number\n  ): {\n    selectedText: string;\n    selectedCharacters: typeof tokenizedContent.characters;\n    selectedWords: typeof tokenizedContent.words;\n    selectedPills: typeof tokenizedContent.pills;\n    hasCompletePills: boolean;\n  } {\n    const selectedCharacters = tokenizedContent.characters.filter(\n      (char) => char.index >= startIndex && char.index < endIndex\n    );\n\n    const selectedWords = tokenizedContent.words.filter(\n      (word) => word.start >= startIndex && word.end <= endIndex\n    );\n\n    const selectedPills = tokenizedContent.pills.filter(\n      (pill) => pill.start >= startIndex && pill.end <= endIndex\n    );\n\n    // Check if selection includes complete pills (not partial)\n    const partialPills = tokenizedContent.pills.filter(\n      (pill) =>\n        (pill.start < startIndex && pill.end > startIndex) ||\n        (pill.start < endIndex && pill.end > endIndex)\n    );\n\n    return {\n      selectedText: selectedCharacters.map((char) => char.char).join(''),\n      selectedCharacters,\n      selectedWords,\n      selectedPills,\n      hasCompletePills: partialPills.length === 0\n    };\n  }\n\n  /**\n   * Smart word selection that respects pill boundaries\n   */\n  static selectWordAt(\n    tokenizedContent: TokenizedContent,\n    index: number\n  ): { start: number; end: number } | null {\n    // First check if we're inside a pill\n    const pill = this.getPillAt(tokenizedContent, index);\n    if (pill) {\n      return { start: pill.start, end: pill.end };\n    }\n\n    // Otherwise select the word\n    const word = this.getWordAt(tokenizedContent, index);\n    if (word && !word.isWhitespace) {\n      return { start: word.start, end: word.end };\n    }\n\n    return null;\n  }\n\n  private static parseStructuredMatch(\n    match: ParsedMatch\n  ): ContentSegment | null {\n    switch (match.type) {\n      case 'hashtag':\n        return HashtagParser.parseMatch(match);\n      case 'mention':\n        return MentionParser.parseMatch(match);\n      default:\n        return null;\n    }\n  }\n\n  private static addTextWithFallbackURLs(\n    text: string,\n    segments: ContentSegment[],\n    processedRanges: Array<{ start: number; end: number }>\n  ) {\n    const remainingText = this.extractUnprocessedText(text, processedRanges);\n\n    for (const textChunk of remainingText) {\n      const urlMatches = FallbackURLParser.findMatches(textChunk.text);\n\n      for (const match of urlMatches) {\n        const segment = FallbackURLParser.parseMatch({\n          ...match,\n          start: match.start + textChunk.offset,\n          end: match.end + textChunk.offset\n        });\n\n        if (segment) {\n          segments.push(segment);\n          processedRanges.push({\n            start: segment.start || 0,\n            end: segment.end || 0\n          });\n        }\n      }\n    }\n  }\n\n  private static addTextSegments(\n    text: string,\n    segments: ContentSegment[],\n    processedRanges: Array<{ start: number; end: number }>\n  ) {\n    const textChunks = this.extractUnprocessedText(text, processedRanges);\n\n    for (const chunk of textChunks) {\n      // Skip empty chunks\n      if (!chunk.text) continue;\n\n      // Create a single text segment for each chunk to preserve spaces and formatting\n      // This ensures that spaces, newlines, and other whitespace are maintained\n      segments.push({\n        type: 'text',\n        value: chunk.text,\n        start: chunk.offset,\n        end: chunk.offset + chunk.text.length\n      });\n    }\n  }\n\n  private static extractUnprocessedText(\n    text: string,\n    processedRanges: Array<{ start: number; end: number }>\n  ): Array<{ text: string; offset: number }> {\n    const chunks: Array<{ text: string; offset: number }> = [];\n    const sortedRanges = [...processedRanges].sort((a, b) => a.start - b.start);\n\n    let currentIndex = 0;\n\n    for (const range of sortedRanges) {\n      if (currentIndex < range.start) {\n        chunks.push({\n          text: text.slice(currentIndex, range.start),\n          offset: currentIndex\n        });\n      }\n      currentIndex = range.end;\n    }\n\n    // Add remaining text\n    if (currentIndex < text.length) {\n      chunks.push({\n        text: text.slice(currentIndex),\n        offset: currentIndex\n      });\n    }\n\n    return chunks;\n  }\n\n  /**\n   * Enhanced parse method with rich text support\n   * Integrates with the new rich text parser system\n   */\n  static parseWithRichText(\n    text: string,\n    options: {\n      enableMarkdown?: boolean;\n      enableEmojis?: boolean;\n      enableImages?: boolean;\n    } = {}\n  ): ContentSegment[] {\n    // Import rich text parser dynamically to avoid circular dependencies\n    const segments = this.parse(text);\n\n    // If rich text features are disabled, return basic segments\n    if (\n      !options.enableMarkdown &&\n      !options.enableEmojis &&\n      !options.enableImages\n    ) {\n      return segments;\n    }\n\n    // Add metadata for rich text processing\n    return segments.map((segment) => ({\n      ...segment,\n      richTextEnabled: true,\n      richTextOptions: options\n    }));\n  }\n}\n\n/**\n * Helper function to render content with pills\n */\nexport function renderContentWithPills(content: string): string {\n  const segments = ContentParser.parse(content);\n\n  return segments\n    .map((segment) => {\n      switch (segment.type) {\n        case 'hashtag':\n          return `<span class=\\\"content-pill content-pill--hashtag\\\">#${segment.value}</span>`;\n        case 'mention':\n          return `<span class=\\\"content-pill content-pill--mention\\\">@${segment.displayName || segment.value}</span>`;\n        case 'url':\n          if (segment.behavior === 'embed') {\n            return `<div class=\\\"url-embed\\\" data-url=\\\"${segment.value}\\\">${segment.value}</div>`;\n          }\n          return `<a href=\\\"${segment.value}\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\">${segment.value}</a>`;\n        case 'text':\n        default:\n          return segment.value;\n      }\n    })\n    .join('');\n}\n\n/**\n * Helper function to render content with rich text support\n */\nexport function renderRichContent(\n  content: string,\n  options: {\n    enableMarkdown?: boolean;\n    enableEmojis?: boolean;\n    enableImages?: boolean;\n    enableHashtags?: boolean;\n    enableMentions?: boolean;\n    enableUrls?: boolean;\n  } = {}\n): string {\n  // Import rich text parser dynamically\n  try {\n    const { richTextParser } = require('./parsers/rich-text-parser');\n    const parser = richTextParser;\n\n    // Update parser config\n    parser.updateConfig({\n      enableMarkdown: options.enableMarkdown,\n      enableEmojis: options.enableEmojis,\n      enableImages: options.enableImages,\n      enableHashtags: options.enableHashtags,\n      enableMentions: options.enableMentions,\n      enableUrls: options.enableUrls\n    });\n\n    return parser.replaceWithHtml(content);\n  } catch (error) {\n    console.warn(\n      'Rich text parser not available, falling back to basic parsing:',\n      error\n    );\n    return renderContentWithPills(content);\n  }\n}\n",
    "language":"typescript",
    "lines":877,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/os-detection.ts":{
    "content":"/**\n * Operating System Detection Utility\n * Detects user's OS to determine appropriate emoji set\n */\n\nexport type SupportedOS = 'windows' | 'mac' | 'unknown';\n\nexport interface OSInfo {\n  os: SupportedOS;\n  version?: string;\n  userAgent: string;\n  isSupported: boolean;\n}\n\nexport class OSDetection {\n  /**\n   * Detect operating system from user agent (client-side)\n   */\n  static detectFromUserAgent(userAgent?: string): OSInfo {\n    const ua =\n      userAgent ||\n      (typeof window !== 'undefined' ? window.navigator.userAgent : '');\n\n    // Windows detection\n    if (/Windows/i.test(ua)) {\n      let version = 'unknown';\n\n      // Windows version detection\n      if (/Windows NT 10\\\\.0/i.test(ua)) {\n        version = '10/11';\n      } else if (/Windows NT 6\\\\.3/i.test(ua)) {\n        version = '8.1';\n      } else if (/Windows NT 6\\\\.2/i.test(ua)) {\n        version = '8';\n      } else if (/Windows NT 6\\\\.1/i.test(ua)) {\n        version = '7';\n      }\n\n      return {\n        os: 'windows',\n        version,\n        userAgent: ua,\n        isSupported: true\n      };\n    }\n\n    // macOS detection\n    if (/Mac OS X|macOS/i.test(ua)) {\n      let version = 'unknown';\n\n      // macOS version detection\n      const macVersionMatch = ua.match(/Mac OS X (\\\\d+)_(\\\\d+)_?(\\\\d+)?/i);\n      if (macVersionMatch) {\n        const major = parseInt(macVersionMatch[1]);\n        const minor = parseInt(macVersionMatch[2]);\n        const patch = macVersionMatch[3] ? parseInt(macVersionMatch[3]) : 0;\n\n        if (major >= 13) {\n          version = 'ventura+';\n        } else if (major >= 12) {\n          version = 'monterey';\n        } else if (major >= 11) {\n          version = 'big_sur';\n        } else if (major >= 10 && minor >= 15) {\n          version = 'catalina';\n        } else if (major >= 10 && minor >= 14) {\n          version = 'mojave';\n        } else {\n          version = 'legacy';\n        }\n      }\n\n      return {\n        os: 'mac',\n        version,\n        userAgent: ua,\n        isSupported: true\n      };\n    }\n\n    // iOS detection (treat as Mac for emoji compatibility)\n    if (/iPhone|iPad|iPod/i.test(ua)) {\n      let version = 'unknown';\n\n      const iosVersionMatch = ua.match(/OS (\\\\d+)_(\\\\d+)_?(\\\\d+)?/i);\n      if (iosVersionMatch) {\n        const major = parseInt(iosVersionMatch[1]);\n        version = major >= 15 ? 'ios15+' : major >= 14 ? 'ios14' : 'legacy';\n      }\n\n      return {\n        os: 'mac', // Use Mac emoji set for iOS\n        version: `ios_${version}`,\n        userAgent: ua,\n        isSupported: true\n      };\n    }\n\n    // Android detection (limited emoji support)\n    if (/Android/i.test(ua)) {\n      return {\n        os: 'unknown',\n        version: 'android',\n        userAgent: ua,\n        isSupported: false // Android has inconsistent emoji support\n      };\n    }\n\n    // Linux and other Unix-like systems\n    if (/Linux|Unix|X11/i.test(ua)) {\n      return {\n        os: 'unknown',\n        version: 'linux',\n        userAgent: ua,\n        isSupported: false // Linux emoji support varies greatly\n      };\n    }\n\n    return {\n      os: 'unknown',\n      version: 'unknown',\n      userAgent: ua,\n      isSupported: false\n    };\n  }\n\n  /**\n   * Detect operating system from request headers (server-side)\n   */\n  static detectFromHeaders(\n    headers: Record<string, string | string[] | undefined>\n  ): OSInfo {\n    const userAgent = Array.isArray(headers['user-agent'])\n      ? headers['user-agent'][0]\n      : headers['user-agent'] || '';\n\n    return this.detectFromUserAgent(userAgent);\n  }\n\n  /**\n   * Get emoji table name based on OS\n   */\n  static getEmojiTableName(\n    osInfo: OSInfo\n  ): 'emojis_windows' | 'emojis_mac' | null {\n    if (!osInfo.isSupported) {\n      return null;\n    }\n\n    switch (osInfo.os) {\n      case 'windows':\n        return 'emojis_windows';\n      case 'mac':\n        return 'emojis_mac';\n      default:\n        return null;\n    }\n  }\n\n  /**\n   * Check if OS supports specific emoji features\n   */\n  static getEmojiSupport(osInfo: OSInfo): {\n    supportsUnicode: boolean;\n    supportsCustom: boolean;\n    maxEmojiVersion: string;\n    recommendedFormat: 'unicode' | 'image';\n  } {\n    switch (osInfo.os) {\n      case 'windows':\n        return {\n          supportsUnicode: true,\n          supportsCustom: true,\n          maxEmojiVersion: this.getWindowsEmojiVersion(osInfo.version),\n          recommendedFormat: 'unicode'\n        };\n\n      case 'mac':\n        return {\n          supportsUnicode: true,\n          supportsCustom: true,\n          maxEmojiVersion: this.getMacEmojiVersion(osInfo.version),\n          recommendedFormat: 'unicode'\n        };\n\n      default:\n        return {\n          supportsUnicode: false,\n          supportsCustom: true,\n          maxEmojiVersion: '1.0',\n          recommendedFormat: 'image'\n        };\n    }\n  }\n\n  /**\n   * Get Windows emoji version support\n   */\n  private static getWindowsEmojiVersion(version?: string): string {\n    switch (version) {\n      case '10/11':\n        return '14.0'; // Latest emoji support\n      case '8.1':\n      case '8':\n        return '1.0'; // Basic emoji support\n      case '7':\n        return '0.6'; // Very limited support\n      default:\n        return '1.0';\n    }\n  }\n\n  /**\n   * Get macOS emoji version support\n   */\n  private static getMacEmojiVersion(version?: string): string {\n    if (version?.startsWith('ios_')) {\n      const iosVersion = version.replace('ios_', '');\n      switch (iosVersion) {\n        case 'ios15+':\n          return '14.0';\n        case 'ios14':\n          return '13.1';\n        default:\n          return '12.0';\n      }\n    }\n\n    switch (version) {\n      case 'ventura+':\n        return '15.0'; // Latest emoji support\n      case 'monterey':\n        return '14.0';\n      case 'big_sur':\n        return '13.1';\n      case 'catalina':\n        return '12.1';\n      case 'mojave':\n        return '11.0';\n      default:\n        return '5.0'; // Legacy support\n    }\n  }\n\n  /**\n   * Client-side hook for React components\n   */\n  static useOSDetection(): OSInfo {\n    if (typeof window === 'undefined') {\n      return {\n        os: 'unknown',\n        userAgent: '',\n        isSupported: false\n      };\n    }\n\n    return this.detectFromUserAgent();\n  }\n\n  /**\n   * Validate if emoji is supported on current OS\n   */\n  static isEmojiSupported(emojiVersion: string, osInfo: OSInfo): boolean {\n    const support = this.getEmojiSupport(osInfo);\n\n    // Simple version comparison (you might want a more sophisticated comparison)\n    const supportedVersion = parseFloat(support.maxEmojiVersion);\n    const requiredVersion = parseFloat(emojiVersion);\n\n    return supportedVersion >= requiredVersion;\n  }\n\n  /**\n   * Get fallback emoji recommendations\n   */\n  static getFallbackEmojis(osInfo: OSInfo): string[] {\n    const support = this.getEmojiSupport(osInfo);\n\n    if (!support.supportsUnicode) {\n      // Return text-based alternatives\n      return [':)', ':(', ':D', ':P', '<3', ':|', ':o'];\n    }\n\n    // Return basic Unicode emojis that work across all platforms\n    return ['\ud83d\ude00', '\ud83d\ude22', '\ud83d\ude0d', '\ud83d\ude02', '\ud83d\udc4d', '\ud83d\udc4e', '\u2764\ufe0f', '\ud83d\udd25'];\n  }\n}\n\n/**\n * Server-side middleware helper\n */\nexport function getOSFromRequest(req: {\n  headers: Record<string, string | string[] | undefined>;\n}): OSInfo {\n  return OSDetection.detectFromHeaders(req.headers);\n}\n\n/**\n * Client-side React hook\n */\nexport function useOSDetection(): OSInfo {\n  return OSDetection.useOSDetection();\n}\n",
    "language":"typescript",
    "lines":304,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/privacy.ts":{
    "content":"import {\n  getUserProfileByDatabaseId,\n  getUserProfileById\n} from '../actions/profile.actions';\nimport { auth } from '../auth';\nimport { UserProfileData } from '../types/profile';\n\nexport interface PrivacyCheckResult {\n  allowed: boolean;\n  profile?: UserProfileData;\n  error?: string;\n  statusCode?: number;\n}\n\n/**\n * Check if a user can access a profile by database ID\n * @param profileId - The database ID of the profile to check\n * @returns Privacy check result with access permission and profile data\n */\nexport async function checkProfilePrivacyById(\n  profileId: string\n): Promise<PrivacyCheckResult> {\n  try {\n    // Get the profile\n    const profile = await getUserProfileByDatabaseId(profileId);\n\n    if (!profile) {\n      return {\n        allowed: false,\n        error: 'User not found',\n        statusCode: 404\n      };\n    }\n\n    // Check if profile is public\n    if (profile.profile_public !== false) {\n      return {\n        allowed: true,\n        profile\n      };\n    }\n\n    // Profile is private - check if user is the owner\n    const session = await auth();\n    const isOwner = session?.user?.id?.toString() === profile.id?.toString();\n\n    if (isOwner) {\n      return {\n        allowed: true,\n        profile\n      };\n    }\n\n    // Private profile and user is not the owner\n    return {\n      allowed: false,\n      error: 'This profile is private',\n      statusCode: 403\n    };\n  } catch (error) {\n    console.error('Error checking profile privacy:', error);\n    return {\n      allowed: false,\n      error: 'Internal server error',\n      statusCode: 500\n    };\n  }\n}\n\n/**\n * Check if a user can access a profile by user ID\n * @param userId - The user ID of the profile to check\n * @returns Privacy check result with access permission and profile data\n */\nexport async function checkProfilePrivacyByUserId(\n  userId: string\n): Promise<PrivacyCheckResult> {\n  try {\n    // Get the profile\n    const profile = await getUserProfileById(userId);\n\n    if (!profile) {\n      return {\n        allowed: false,\n        error: 'User not found',\n        statusCode: 404\n      };\n    }\n\n    // Check if profile is public\n    if (profile.profile_public !== false) {\n      return {\n        allowed: true,\n        profile\n      };\n    }\n\n    // Profile is private - check if user is the owner\n    const session = await auth();\n    const isOwner = session?.user?.id?.toString() === profile.id?.toString();\n\n    if (isOwner) {\n      return {\n        allowed: true,\n        profile\n      };\n    }\n\n    // Private profile and user is not the owner\n    return {\n      allowed: false,\n      error: 'This profile is private',\n      statusCode: 403\n    };\n  } catch (error) {\n    console.error('Error checking profile privacy:', error);\n    return {\n      allowed: false,\n      error: 'Internal server error',\n      statusCode: 500\n    };\n  }\n}\n\n/**\n * Middleware-style function to check profile privacy and return appropriate response\n * Use this in API routes to standardize privacy protection\n */\nexport async function withProfilePrivacy(\n  profileIdentifier: string,\n  isUserId: boolean = false\n): Promise<{ response?: Response; profile?: UserProfileData }> {\n  const result = isUserId\n    ? await checkProfilePrivacyByUserId(profileIdentifier)\n    : await checkProfilePrivacyById(profileIdentifier);\n\n  if (!result.allowed) {\n    return {\n      response: new Response(JSON.stringify({ error: result.error }), {\n        status: result.statusCode || 500,\n        headers: { 'Content-Type': 'application/json' }\n      })\n    };\n  }\n\n  return { profile: result.profile };\n}\n",
    "language":"typescript",
    "lines":148,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/scroll-highlight-demo.ts":{
    "content":"/**\n * Demo utility for scroll restoration highlight animation\n *\n * This file demonstrates how to use the reusable scroll highlight animation system\n * anywhere in the application. The animation can be applied to any element with\n * configurable duration, intensity, colors, and behaviors.\n */\n\nimport { createLogger } from '@/lib/logging';\nimport {\n  applyScrollHighlight,\n  HIGHLIGHT_PRESETS,\n  type ScrollHighlightOptions\n} from './scroll-highlight';\n\n// Create logger for scroll highlight demo\nconst logger = createLogger({\n  context: {\n    component: 'ScrollHighlightDemo',\n    module: 'utils'\n  },\n  enabled: false\n});\n\n/**\n * Example usage functions that can be called from anywhere in the app\n */\n\n// Example 1: Basic highlight with default settings\nexport function highlightElementBasic(element: HTMLElement): void {\n  applyScrollHighlight(element);\n}\n\n// Example 2: Quick feedback highlight (1.5 seconds, subtle)\nexport function highlightElementQuick(element: HTMLElement): void {\n  applyScrollHighlight(element, HIGHLIGHT_PRESETS.quick);\n}\n\n// Example 3: Success feedback (green, 2.5 seconds)\nexport function highlightElementSuccess(element: HTMLElement): void {\n  applyScrollHighlight(element, HIGHLIGHT_PRESETS.success);\n}\n\n// Example 4: Error indication (red, 4 seconds, no scaling)\nexport function highlightElementError(element: HTMLElement): void {\n  applyScrollHighlight(element, HIGHLIGHT_PRESETS.error);\n}\n\n// Example 5: Attention-grabbing highlight (5 seconds, intense, warning color)\nexport function highlightElementAttention(element: HTMLElement): void {\n  applyScrollHighlight(element, HIGHLIGHT_PRESETS.attention);\n}\n\n// Example 6: Custom configuration\nexport function highlightElementCustom(\n  element: HTMLElement,\n  durationMs: number = 3000,\n  color: 'default' | 'success' | 'warning' | 'error' = 'default'\n): void {\n  const options: ScrollHighlightOptions = {\n    duration: durationMs,\n    intensity: 'normal',\n    color: color,\n    enablePulse: true,\n    enableScale: true\n  };\n\n  applyScrollHighlight(element, options);\n}\n\n// Example 7: Highlight by selector\nexport function highlightElementBySelector(\n  selector: string,\n  options: ScrollHighlightOptions = {}\n): boolean {\n  const element = document.querySelector(selector) as HTMLElement;\n  if (!element) {\n    logger.warn('Element not found for selector', { selector });\n    return false;\n  }\n\n  applyScrollHighlight(element, options);\n  return true;\n}\n\n// Example 8: Highlight multiple elements\nexport function highlightMultipleElements(\n  elements: HTMLElement[],\n  options: ScrollHighlightOptions = {},\n  delay: number = 0\n): void {\n  elements.forEach((element, index) => {\n    setTimeout(() => {\n      applyScrollHighlight(element, options);\n    }, delay * index);\n  });\n}\n\n// Example 9: Conditional highlighting based on element type\nexport function highlightElementSmart(element: HTMLElement): void {\n  const tagName = element.tagName.toLowerCase();\n  const hasErrorClass =\n    element.classList.contains('error') ||\n    element.classList.contains('invalid');\n  const hasSuccessClass =\n    element.classList.contains('success') ||\n    element.classList.contains('valid');\n\n  let preset: ScrollHighlightOptions;\n\n  if (hasErrorClass) {\n    preset = HIGHLIGHT_PRESETS.error;\n  } else if (hasSuccessClass) {\n    preset = HIGHLIGHT_PRESETS.success;\n  } else if (['button', 'a'].includes(tagName)) {\n    preset = HIGHLIGHT_PRESETS.quick;\n  } else {\n    preset = HIGHLIGHT_PRESETS.standard;\n  }\n\n  applyScrollHighlight(element, preset);\n}\n\n/**\n * Test function to manually apply scroll highlight to the first submission item on the page\n * This can be called from the browser console for debugging\n */\nexport function testScrollHighlight(): void {\n  const container = document.querySelector(\n    '.submissions-list--virtual'\n  ) as HTMLElement;\n  if (!container) {\n    logger.warn('Test: No submissions container found');\n    return;\n  }\n\n  const submissionItems = container.querySelectorAll(\n    '[data-testid*=\\\"submission-item\\\"], .submission__wrapper, .submissions-list__item'\n  );\n\n  if (submissionItems.length === 0) {\n    logger.warn('Test: No submission items found');\n    return;\n  }\n\n  const firstItem = submissionItems[0] as HTMLElement;\n  logger.debug('Test: Applying highlight to first submission item', {\n    element: firstItem.tagName,\n    className: firstItem.className,\n    testId: firstItem.getAttribute('data-testid')\n  });\n\n  // Apply the highlight directly\n  applyScrollHighlight(firstItem, {\n    duration: 3500,\n    intensity: 'normal',\n    enablePulse: true,\n    enableScale: true\n  });\n}\n\n/**\n * Simple test to apply the CSS animation class directly to any element\n * This bypasses the JavaScript and tests the CSS animation directly\n */\nexport function testCSSAnimation(): void {\n  // Find any element on the page to test with\n  const testElement = document.querySelector(\n    '.submission__wrapper, .submissions-list__item, body > div'\n  ) as HTMLElement;\n\n  if (!testElement) {\n    logger.warn('CSS Test: No suitable element found for testing');\n    return;\n  }\n\n  logger.info('CSS Test: Applying scroll-restore-highlight class to:', {\n    element: testElement.tagName,\n    id: testElement.id,\n    className: testElement.className,\n    text: testElement.textContent?.substring(0, 50)\n  });\n\n  // Add the CSS class directly\n  testElement.classList.add('scroll-restore-highlight');\n\n  // Remove it after the animation duration\n  setTimeout(() => {\n    testElement.classList.remove('scroll-restore-highlight');\n    logger.info('CSS Test: Animation completed, class removed');\n  }, 2000);\n}\n\n/**\n * Diagnostic test with enhanced visibility to ensure the animation is working\n */\nexport function testHighVisibilityAnimation(): void {\n  // Find any element on the page to test with\n  const testElement = document.querySelector(\n    '.submission__wrapper, .submissions-list__item, body > div'\n  ) as HTMLElement;\n\n  if (!testElement) {\n    logger.warn('Visibility Test: No suitable element found for testing');\n    return;\n  }\n\n  logger.info('Visibility Test: Applying enhanced animation to:', {\n    element: testElement.tagName,\n    id: testElement.id,\n    className: testElement.className,\n    text: testElement.textContent?.substring(0, 50)\n  });\n\n  // Apply inline styles for maximum visibility\n  const originalStyles = {\n    position: testElement.style.position,\n    zIndex: testElement.style.zIndex,\n    boxShadow: testElement.style.boxShadow,\n    animation: testElement.style.animation\n  };\n\n  // Force styles to ensure visibility\n  testElement.style.position = 'relative';\n  testElement.style.zIndex = '9999';\n  testElement.style.setProperty('--scroll-highlight-duration', '5000ms');\n  testElement.style.setProperty('--scroll-highlight-primary-color', '#ff0000'); // Red for visibility\n  testElement.style.setProperty('--scroll-highlight-primary-rgb', '255, 0, 0');\n\n  // Add the CSS class\n  testElement.classList.add('scroll-restore-highlight');\n\n  logger.info('Visibility Test: Starting animation with enhanced styles');\n\n  // eslint-disable-next-line no-console\n  console.log(\n    '\ud83c\udfaf Visibility Test: Applied styles and class. Element should now have red expanding border.'\n  );\n\n  // Remove it after the animation duration\n  setTimeout(() => {\n    testElement.classList.remove('scroll-restore-highlight');\n    // Restore original styles\n    testElement.style.position = originalStyles.position;\n    testElement.style.zIndex = originalStyles.zIndex;\n    testElement.style.boxShadow = originalStyles.boxShadow;\n    testElement.style.animation = originalStyles.animation;\n    testElement.style.removeProperty('--scroll-highlight-duration');\n    testElement.style.removeProperty('--scroll-highlight-primary-color');\n    testElement.style.removeProperty('--scroll-highlight-primary-rgb');\n    logger.info('Visibility Test: Animation completed, styles restored');\n  }, 5000);\n}\n\n/**\n * Comprehensive diagnostic test that inspects computed styles and forces maximum visibility\n */\nexport function testAnimationDiagnostics(): void {\n  // Find any element on the page to test with\n  const testElement = document.querySelector(\n    '.submission__wrapper, .submissions-list__item, body > div'\n  ) as HTMLElement;\n\n  if (!testElement) {\n    logger.warn('Diagnostics: No suitable element found for testing');\n    return;\n  }\n\n  logger.info('Diagnostics: Starting comprehensive animation test');\n\n  // Get initial computed styles\n  const initialStyles = getComputedStyle(testElement);\n  logger.info('Diagnostics: Initial styles:', {\n    position: initialStyles.position,\n    zIndex: initialStyles.zIndex,\n    contain: initialStyles.contain,\n    boxShadow: initialStyles.boxShadow,\n    animation: initialStyles.animation,\n    transform: initialStyles.transform\n  });\n\n  // Apply our test styles with maximum visibility\n  testElement.style.position = 'relative';\n  testElement.style.zIndex = '9999';\n  testElement.style.contain = 'none';\n  testElement.style.setProperty('--scroll-highlight-duration', '8000ms');\n  testElement.style.setProperty('--scroll-highlight-primary-color', '#ff0000');\n  testElement.style.setProperty('--scroll-highlight-primary-rgb', '255, 0, 0');\n  testElement.style.setProperty('--scroll-highlight-scale-max', '1.1');\n\n  // Force a very visible box-shadow before adding the class\n  testElement.style.boxShadow = '0 0 0 10px red';\n\n  logger.info('Diagnostics: Applied forced red box-shadow. Can you see it?');\n\n  setTimeout(() => {\n    // Remove forced shadow and add animation class\n    testElement.style.boxShadow = '';\n    testElement.classList.add('scroll-restore-highlight');\n\n    // Check computed styles after adding class\n    const animatedStyles = getComputedStyle(testElement);\n    logger.info('Diagnostics: Styles after adding animation class:', {\n      animation: animatedStyles.animation,\n      animationName: animatedStyles.animationName,\n      animationDuration: animatedStyles.animationDuration,\n      animationTimingFunction: animatedStyles.animationTimingFunction,\n      boxShadow: animatedStyles.boxShadow,\n      transform: animatedStyles.transform,\n      contain: animatedStyles.contain,\n      zIndex: animatedStyles.zIndex\n    });\n\n    // Check if the animation is actually running\n    setTimeout(() => {\n      const runningStyles = getComputedStyle(testElement);\n      logger.info('Diagnostics: Styles 1 second into animation:', {\n        boxShadow: runningStyles.boxShadow,\n        transform: runningStyles.transform\n      });\n    }, 1000);\n\n    // Remove after test duration\n    setTimeout(() => {\n      testElement.classList.remove('scroll-restore-highlight');\n      testElement.style.position = '';\n      testElement.style.zIndex = '';\n      testElement.style.contain = '';\n      testElement.style.removeProperty('--scroll-highlight-duration');\n      testElement.style.removeProperty('--scroll-highlight-primary-color');\n      testElement.style.removeProperty('--scroll-highlight-primary-rgb');\n      testElement.style.removeProperty('--scroll-highlight-scale-max');\n      logger.info('Diagnostics: Test completed, styles restored');\n    }, 8000);\n  }, 2000);\n}\n\n/**\n * Simple hardcoded animation test that bypasses all CSS variables\n */\nexport function testHardcodedAnimation(): void {\n  // Find any element on the page to test with\n  const testElement = document.querySelector(\n    '.submission__wrapper, .submissions-list__item, body > div'\n  ) as HTMLElement;\n\n  if (!testElement) {\n    logger.warn('Hardcoded Test: No suitable element found for testing');\n    return;\n  }\n\n  logger.info('Hardcoded Test: Applying direct CSS animation');\n\n  // Apply hardcoded animation directly via style attribute\n  testElement.style.position = 'relative';\n  testElement.style.zIndex = '9999';\n  testElement.style.contain = 'none';\n  testElement.style.animation = `\n    scroll-restore-highlight 4000ms cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards,\n    scroll-restore-pulse 920ms ease-in-out 2 alternate\n  `;\n  testElement.style.setProperty('--scroll-highlight-primary-color', '#edae49');\n  testElement.style.setProperty(\n    '--scroll-highlight-primary-rgb',\n    '237, 174, 73'\n  );\n\n  // Also add the class for good measure\n  testElement.classList.add('scroll-restore-highlight');\n\n  logger.info('Hardcoded Test: Starting hardcoded animation sequence');\n\n  // eslint-disable-next-line no-console\n  console.log(\n    '\ud83c\udfaf Hardcoded Test: Animation applied. Element should now animate with hardcoded values.'\n  );\n\n  // Remove after animation duration\n  setTimeout(() => {\n    testElement.classList.remove('scroll-restore-highlight');\n    testElement.style.position = '';\n    testElement.style.zIndex = '';\n    testElement.style.contain = '';\n    testElement.style.animation = '';\n    testElement.style.removeProperty('--scroll-highlight-primary-color');\n    testElement.style.removeProperty('--scroll-highlight-primary-rgb');\n    logger.info('Hardcoded Test: Animation completed, styles restored');\n  }, 4000);\n}\n\n/**\n * Manual step-by-step animation test to show exactly what should happen\n */\nexport function testManualAnimation(): void {\n  // Find any element on the page to test with\n  const testElement = document.querySelector(\n    '.submission__wrapper, .submissions-list__item, body > div'\n  ) as HTMLElement;\n\n  if (!testElement) {\n    logger.warn('Manual Test: No suitable element found for testing');\n    return;\n  }\n\n  logger.info('Manual Test: Starting step-by-step animation demonstration');\n\n  // Store original styles\n  const originalStyles = {\n    position: testElement.style.position,\n    zIndex: testElement.style.zIndex,\n    boxShadow: testElement.style.boxShadow,\n    transform: testElement.style.transform,\n    contain: testElement.style.contain\n  };\n\n  // Set up element for animation\n  testElement.style.position = 'relative';\n  testElement.style.zIndex = '9999';\n  testElement.style.contain = 'none';\n\n  // Step 1: Show initial state (0%)\n  testElement.style.boxShadow =\n    '0 0 0 2px #edae49, 0 0 0 4px rgba(237, 174, 73, 0.3), 0 0 0 8px rgba(237, 174, 73, 0.2), 0 0 0 16px rgba(237, 174, 73, 0.1)';\n  testElement.style.transform = 'scale(1)';\n  // eslint-disable-next-line no-console\n  console.log(\n    '\ud83c\udfaf Manual Test: Step 1 - Initial state (small border). Can you see it?'\n  );\n\n  setTimeout(() => {\n    // Step 2: Show middle state (50%)\n    testElement.style.boxShadow =\n      '0 0 0 4px #edae49, 0 0 0 12px rgba(237, 174, 73, 0.4), 0 0 0 24px rgba(237, 174, 73, 0.3), 0 0 0 48px rgba(237, 174, 73, 0.1)';\n    testElement.style.transform = 'scale(1.02)';\n    // eslint-disable-next-line no-console\n    console.log(\n      '\ud83c\udfaf Manual Test: Step 2 - Middle state (expanded border). Can you see the larger border?'\n    );\n  }, 2000);\n\n  setTimeout(() => {\n    // Step 3: Show final state (100%)\n    testElement.style.boxShadow =\n      '0 0 0 0px #edae49, 0 0 0 0px rgba(237, 174, 73, 0), 0 0 0 0px rgba(237, 174, 73, 0), 0 0 0 0px rgba(237, 174, 73, 0)';\n    testElement.style.transform = 'scale(1)';\n    // eslint-disable-next-line no-console\n    console.log(\n      '\ud83c\udfaf Manual Test: Step 3 - Final state (no border). Border should have disappeared.'\n    );\n  }, 4000);\n\n  setTimeout(() => {\n    // Restore original styles\n    testElement.style.position = originalStyles.position;\n    testElement.style.zIndex = originalStyles.zIndex;\n    testElement.style.boxShadow = originalStyles.boxShadow;\n    testElement.style.transform = originalStyles.transform;\n    testElement.style.contain = originalStyles.contain;\n    // eslint-disable-next-line no-console\n    console.log(\n      '\ud83c\udfaf Manual Test: Test completed, styles restored. Did you see the expanding border effect?'\n    );\n  }, 6000);\n\n  logger.info('Manual Test: Step-by-step animation completed');\n}\n\n// Make all test functions available globally\nif (typeof window !== 'undefined') {\n  (window as any).testScrollHighlight = testScrollHighlight;\n  (window as any).testCSSAnimation = testCSSAnimation;\n  (window as any).testHighVisibilityAnimation = testHighVisibilityAnimation;\n  (window as any).testAnimationDiagnostics = testAnimationDiagnostics;\n  (window as any).testHardcodedAnimation = testHardcodedAnimation;\n  (window as any).testManualAnimation = testManualAnimation;\n}\n\n/**\n * Usage examples in React components:\n *\n * ```tsx\n * import { highlightElementSuccess, highlightElementCustom } from 'src/lib/utils/scroll-highlight-demo';\n *\n * function MyComponent() {\n *   const handleSuccess = () => {\n *     const button = document.getElementById('submit-button');\n *     if (button) {\n *       highlightElementSuccess(button);\n *     }\n *   };\n *\n *   const handleCustomHighlight = () => {\n *     const element = document.querySelector('.my-element');\n *     if (element) {\n *       highlightElementCustom(element, 2000, 'warning');\n *     }\n *   };\n *\n *   return (\n *     <div>\n *       <button id=\\\"submit-button\\\" onClick={handleSuccess}>\n *         Click me for success highlight\n *       </button>\n *       <div className=\\\"my-element\\\" onClick={handleCustomHighlight}>\n *         Click me for custom highlight\n *       </div>\n *     </div>\n *   );\n * }\n * ```\n *\n * CSS usage examples:\n *\n * ```css\n * // Apply to any element with custom duration\n * .my-element {\n *   --scroll-highlight-duration: 2000ms;\n * }\n *\n * .my-element.scroll-restore-highlight {\n *   // Animation will use the custom duration\n * }\n * ```\n *\n * Direct CSS class usage:\n *\n * ```tsx\n * // Add classes directly to trigger animation\n * element.classList.add('scroll-restore-highlight', 'scroll-restore-highlight--fast', 'scroll-restore-highlight--success');\n *\n * // Set custom duration\n * element.style.setProperty('--scroll-highlight-duration', '1500ms');\n *\n * // Remove after animation (optional - animation removes itself)\n * setTimeout(() => {\n *   element.classList.remove('scroll-restore-highlight', 'scroll-restore-highlight--fast', 'scroll-restore-highlight--success');\n *   element.style.removeProperty('--scroll-highlight-duration');\n * }, 1500);\n * ```\n */\n",
    "language":"typescript",
    "lines":541,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/social-sharing.ts":{
    "content":"/**\n * Utilities for cleaning up content for social media sharing\n * Removes or converts embed pills to clean, shareable text\n */\n\n/**\n * Clean content for social media sharing by handling embed pills\n * Option 1: Convert embed pills to clean URLs\n * Option 2: Remove embed pills entirely\n */\nexport function cleanContentForSocialSharing(\n  content: string,\n  options: {\n    convertEmbedsToUrls?: boolean; // If true, convert ![embed](url) to just url\n    removeEmbeds?: boolean; // If true, remove embed pills entirely\n    maxLength?: number; // Maximum length for social descriptions\n  } = {}\n): string {\n  const {\n    convertEmbedsToUrls = true,\n    removeEmbeds = false,\n    maxLength = 160\n  } = options;\n\n  if (!content) return '';\n\n  let cleanedContent = content;\n\n  // Handle embed pills: ![behavior](url) or ![behavior|width](url)\n  const embedPillRegex = /!\\\\[([^|\\\\]]+)(?:\\\\|([^|\\\\]]+))?\\\\]\\\\(([^)]+)\\\\)/g;\n\n  if (removeEmbeds) {\n    // Option 2: Remove embed pills entirely\n    cleanedContent = cleanedContent.replace(embedPillRegex, '');\n  } else if (convertEmbedsToUrls) {\n    // Option 1: Convert embed pills to clean URLs\n    cleanedContent = cleanedContent.replace(\n      embedPillRegex,\n      (match, behavior, width, url) => {\n        // Return just the clean URL\n        return url;\n      }\n    );\n  }\n\n  // Clean up hashtags and mentions for social sharing (optional)\n  // Keep them as-is since they're readable in social media\n\n  // Clean up extra whitespace and newlines\n  cleanedContent = cleanedContent\n    .replace(/\\\\n\\\\s*\\\\n/g, '\\\\n') // Remove empty lines\n    .replace(/\\\\s+/g, ' ') // Normalize whitespace\n    .trim();\n\n  // Truncate to max length if specified\n  if (maxLength && cleanedContent.length > maxLength) {\n    cleanedContent = cleanedContent.substring(0, maxLength);\n\n    // Try to break at a word boundary\n    const lastSpace = cleanedContent.lastIndexOf(' ');\n    if (lastSpace > maxLength * 0.8) {\n      cleanedContent = cleanedContent.substring(0, lastSpace);\n    }\n\n    cleanedContent += '...';\n  }\n\n  return cleanedContent;\n}\n\n/**\n * Extract URLs from embed pills for rich social media previews\n * Returns an array of URLs found in embed pills\n */\nexport function extractEmbedUrls(content: string): string[] {\n  if (!content) return [];\n\n  const embedPillRegex = /!\\\\[([^|\\\\]]+)(?:\\\\|([^|\\\\]]+))?\\\\]\\\\(([^)]+)\\\\)/g;\n  const urls: string[] = [];\n  let match;\n\n  while ((match = embedPillRegex.exec(content)) !== null) {\n    const url = match[3];\n    if (url && isValidUrl(url)) {\n      urls.push(url);\n    }\n  }\n\n  return urls;\n}\n\n/**\n * Simple URL validation\n */\nfunction isValidUrl(string: string): boolean {\n  try {\n    new URL(string);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get the first YouTube URL from embed pills for enhanced social sharing\n */\nexport function getFirstYouTubeUrl(content: string): string | null {\n  const urls = extractEmbedUrls(content);\n\n  for (const url of urls) {\n    if (isYouTubeUrl(url)) {\n      return url;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Check if URL is a YouTube URL\n */\nfunction isYouTubeUrl(url: string): boolean {\n  try {\n    const urlObj = new URL(url);\n    const hostname = urlObj.hostname.toLowerCase();\n    return hostname.includes('youtube.com') || hostname.includes('youtu.be');\n  } catch {\n    return false;\n  }\n}\n",
    "language":"typescript",
    "lines":131,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/cache-manager.ts":{
    "content":"/**\n * Comprehensive Cache Management Utility\n *\n * Provides centralized control over service workers, browser caches,\n * and enforces the 12-hour maximum cache policy across the application.\n */\n\nimport { createLogger } from '@/lib/logging';\n\n// Create logger for cache management\nconst logger = createLogger({\n  context: {\n    component: 'CacheManager',\n    module: 'utils'\n  },\n  enabled: false\n});\n\nexport interface CacheInfo {\n  version: string;\n  totalEntries: number;\n  validEntries: number;\n  expiredEntries: number;\n  maxCacheAge: number;\n  ttls: Record<string, number>;\n  timestamp: number;\n  lastDailyRefresh: string | null;\n  nextDailyRefresh: string;\n}\n\nexport interface ServiceWorkerMessage {\n  type: string;\n  url?: string;\n}\n\nexport interface ServiceWorkerResponse {\n  success: boolean;\n  timestamp?: number;\n  version?: string;\n  error?: string;\n  cacheInfo?: CacheInfo;\n}\n\n/**\n * Maximum cache age - NOTHING can be cached longer than 12 hours\n */\nexport const MAX_CACHE_AGE = 12 * 60 * 60 * 1000; // 12 hours in milliseconds\n\n/**\n * Cache TTL configurations (all limited to MAX_CACHE_AGE)\n */\nexport const CACHE_TTLS = {\n  static: Math.min(6 * 60 * 60 * 1000, MAX_CACHE_AGE), // 6 hours for static assets\n  dynamic: Math.min(2 * 60 * 60 * 1000, MAX_CACHE_AGE), // 2 hours for dynamic content\n  api: Math.min(30 * 60 * 1000, MAX_CACHE_AGE), // 30 minutes for API responses\n  images: Math.min(4 * 60 * 60 * 1000, MAX_CACHE_AGE), // 4 hours for images\n  pages: Math.min(1 * 60 * 60 * 1000, MAX_CACHE_AGE) // 1 hour for pages\n};\n\n/**\n * Send message to service worker and wait for response\n */\nexport async function sendServiceWorkerMessage(\n  message: ServiceWorkerMessage\n): Promise<ServiceWorkerResponse> {\n  return new Promise((resolve, reject) => {\n    if (\n      !('serviceWorker' in navigator) ||\n      !navigator.serviceWorker.controller\n    ) {\n      reject(new Error('Service worker not available'));\n      return;\n    }\n\n    const messageChannel = new MessageChannel();\n    const timeout = setTimeout(() => {\n      reject(new Error('Service worker message timeout'));\n    }, 10000); // 10 second timeout\n\n    messageChannel.port1.onmessage = (event) => {\n      clearTimeout(timeout);\n      resolve(event.data);\n    };\n\n    try {\n      navigator.serviceWorker.controller.postMessage(message, [\n        messageChannel.port2\n      ]);\n    } catch (error) {\n      clearTimeout(timeout);\n      reject(error);\n    }\n  });\n}\n\n/**\n * Get comprehensive cache information from service worker\n */\nexport async function getCacheInfo(): Promise<CacheInfo | null> {\n  try {\n    const response = await sendServiceWorkerMessage({ type: 'GET_CACHE_INFO' });\n    return response.success ? response.cacheInfo || null : null;\n  } catch (error) {\n    logger.warn('Failed to get cache info', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n    return null;\n  }\n}\n\n/**\n * Refresh cache for specific URL or all caches\n */\nexport async function refreshCache(url?: string): Promise<boolean> {\n  try {\n    const response = await sendServiceWorkerMessage({\n      type: 'REFRESH_CACHE',\n      url\n    });\n    return response.success;\n  } catch (error) {\n    logger.warn('Failed to refresh cache', {\n      url,\n      error: error instanceof Error ? error.message : String(error)\n    });\n    return false;\n  }\n}\n\n/**\n * Force cleanup of old service workers and caches\n */\nexport async function cleanupOldCaches(): Promise<boolean> {\n  try {\n    const response = await sendServiceWorkerMessage({\n      type: 'CLEANUP_OLD_CACHES'\n    });\n    return response.success;\n  } catch (error) {\n    logger.warn('Failed to cleanup old caches', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n    return false;\n  }\n}\n\n/**\n * Check if service worker is active and healthy\n */\nexport function isServiceWorkerActive(): boolean {\n  return !!('serviceWorker' in navigator && navigator.serviceWorker.controller);\n}\n\n/**\n * Get all service worker registrations\n */\nexport async function getServiceWorkerRegistrations(): Promise<\n  readonly ServiceWorkerRegistration[]\n> {\n  if (!('serviceWorker' in navigator)) {\n    return [];\n  }\n\n  try {\n    return await navigator.serviceWorker.getRegistrations();\n  } catch (error) {\n    logger.warn('Failed to get service worker registrations', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n    return [];\n  }\n}\n\n/**\n * Unregister all service workers except the most recent\n */\nexport async function cleanupServiceWorkers(): Promise<number> {\n  const registrations = await getServiceWorkerRegistrations();\n\n  if (registrations.length <= 1) {\n    return 0; // Nothing to cleanup\n  }\n\n  // Sort by registration time (most recent first)\n  const sortedRegistrations = [...registrations].sort((a, b) => {\n    const aTime =\n      a.installing?.scriptURL ||\n      a.waiting?.scriptURL ||\n      a.active?.scriptURL ||\n      '';\n    const bTime =\n      b.installing?.scriptURL ||\n      b.waiting?.scriptURL ||\n      b.active?.scriptURL ||\n      '';\n    return bTime.localeCompare(aTime);\n  });\n\n  // Unregister all but the first (most recent)\n  let cleanedCount = 0;\n  const cleanupPromises = sortedRegistrations\n    .slice(1)\n    .map(async (registration) => {\n      try {\n        await registration.unregister();\n        cleanedCount++;\n        logger.debug('Cleaned up old service worker');\n      } catch (error) {\n        logger.warn('Failed to cleanup service worker', {\n          error: error instanceof Error ? error.message : String(error)\n        });\n      }\n    });\n\n  await Promise.all(cleanupPromises);\n  return cleanedCount;\n}\n\n/**\n * Clear route-scoped filters from localStorage\n */\nexport function clearRouteFilters(): void {\n  try {\n    // Import clearAllRouteFilters dynamically to avoid circular dependencies\n    import('../state/atoms').then(({ clearAllRouteFilters }) => {\n      clearAllRouteFilters();\n    });\n  } catch (error) {\n    logger.warn('Failed to clear route filters', { error });\n  }\n}\n\n/**\n * Clear all browser storage (localStorage, sessionStorage, IndexedDB, etc.)\n */\nexport async function clearAllBrowserStorage(): Promise<void> {\n  // Clear localStorage\n  try {\n    localStorage.clear();\n  } catch (error) {\n    logger.warn('Failed to clear localStorage', { error });\n  }\n\n  // Clear sessionStorage\n  try {\n    sessionStorage.clear();\n  } catch (error) {\n    logger.warn('Failed to clear sessionStorage', { error });\n  }\n\n  // Clear IndexedDB\n  if ('indexedDB' in window) {\n    try {\n      const databases = await indexedDB.databases();\n      await Promise.all(\n        databases.map((db) => {\n          if (db.name) {\n            return new Promise<void>((resolve, reject) => {\n              const deleteReq = indexedDB.deleteDatabase(db.name!);\n              deleteReq.onsuccess = () => resolve();\n              deleteReq.onerror = () => reject(deleteReq.error);\n            });\n          }\n          return Promise.resolve();\n        })\n      );\n    } catch (error) {\n      logger.warn('Failed to clear IndexedDB', { error });\n    }\n  }\n\n  // Clear WebSQL (deprecated but still present in some browsers)\n  if ('webkitStorageInfo' in window) {\n    try {\n      const webkitStorageInfo = (window as any).webkitStorageInfo;\n      if (webkitStorageInfo && webkitStorageInfo.requestQuota) {\n        webkitStorageInfo.requestQuota(\n          0,\n          0,\n          () => {},\n          () => {}\n        );\n      }\n    } catch (error) {\n      logger.warn('Failed to clear WebSQL', { error });\n    }\n  }\n}\n\n/**\n * Clear all caches using Cache API\n */\nexport async function clearAllCaches(): Promise<number> {\n  if (!('caches' in window)) {\n    return 0;\n  }\n\n  try {\n    const cacheNames = await caches.keys();\n    const deletePromises = cacheNames.map(async (cacheName) => {\n      try {\n        await caches.delete(cacheName);\n        logger.info('Deleted cache', { cacheName });\n        return true;\n      } catch (error) {\n        logger.warn('Failed to delete cache', { cacheName, error });\n        return false;\n      }\n    });\n\n    const results = await Promise.all(deletePromises);\n    return results.filter((success) => success).length;\n  } catch (error) {\n    logger.warn('Failed to clear caches', { error });\n    return 0;\n  }\n}\n\n/**\n * Comprehensive cache and storage cleanup\n */\nexport async function performCompleteCleanup(): Promise<{\n  serviceWorkersCleanedUp: number;\n  cachesCleared: number;\n  storageCleared: boolean;\n}> {\n  logger.group('completeCleanup');\n\n  // 1. Clear route-scoped filters first (before clearing all storage)\n  logger.debug('Clearing route-scoped filters');\n  clearRouteFilters();\n\n  // 2. Clear all browser storage\n  logger.debug('Clearing browser storage');\n  await clearAllBrowserStorage();\n\n  // 3. Clear all caches\n  logger.debug('Clearing all caches');\n  const cachesCleared = await clearAllCaches();\n\n  // 4. Cleanup service workers\n  logger.debug('Cleaning up service workers');\n  const serviceWorkersCleanedUp = await cleanupServiceWorkers();\n\n  // 5. Force service worker cache refresh\n  logger.debug('Refreshing service worker cache');\n  await refreshCache(); // No URL = clear all\n\n  const result = {\n    serviceWorkersCleanedUp,\n    cachesCleared,\n    storageCleared: true\n  };\n\n  logger.info('Complete cleanup finished', { result });\n  logger.groupEnd();\n\n  return result;\n}\n\n/**\n * Check if cache needs daily refresh (older than 24 hours)\n */\nexport function shouldPerformDailyRefresh(): boolean {\n  try {\n    const lastRefresh = localStorage.getItem('sw-daily-refresh');\n    if (!lastRefresh) return true;\n\n    const lastRefreshTime = parseInt(lastRefresh);\n    const now = Date.now();\n    const oneDayMs = 24 * 60 * 60 * 1000;\n\n    return now - lastRefreshTime > oneDayMs;\n  } catch (error) {\n    return true; // Default to refresh if we can't check\n  }\n}\n\n/**\n * Mark daily refresh as completed\n */\nexport function markDailyRefreshCompleted(): void {\n  try {\n    localStorage.setItem('sw-daily-refresh', Date.now().toString());\n  } catch (error) {\n    logger.warn('Failed to mark daily refresh as completed', { error });\n  }\n}\n\n/**\n * Get cache age in human-readable format\n */\nexport function formatCacheAge(timestamp: number): string {\n  const now = Date.now();\n  const age = now - timestamp;\n\n  if (age < 60 * 1000) {\n    return 'Just now';\n  } else if (age < 60 * 60 * 1000) {\n    return `${Math.floor(age / (60 * 1000))} minutes ago`;\n  } else if (age < 24 * 60 * 60 * 1000) {\n    return `${Math.floor(age / (60 * 60 * 1000))} hours ago`;\n  } else {\n    return `${Math.floor(age / (24 * 60 * 60 * 1000))} days ago`;\n  }\n}\n\n/**\n * Check if cache is expired based on 12-hour limit\n */\nexport function isCacheExpired(timestamp: number): boolean {\n  const age = Date.now() - timestamp;\n  return age > MAX_CACHE_AGE;\n}\n\n/**\n * Register service worker with enhanced error handling and cleanup\n */\nexport async function registerServiceWorker(): Promise<ServiceWorkerRegistration | null> {\n  if (!('serviceWorker' in navigator)) {\n    logger.warn('Service workers not supported');\n    return null;\n  }\n\n  try {\n    logger.group('Service Worker Registration');\n\n    // 1. Cleanup existing service workers first\n    logger.info('Cleaning up existing service workers...');\n    await cleanupServiceWorkers();\n\n    // 2. Clear old caches\n    logger.info('Clearing old caches...');\n    await clearAllCaches();\n\n    // 3. Register new service worker\n    logger.info('Registering new service worker...');\n    const registration = await navigator.serviceWorker.register('/sw.js', {\n      scope: '/',\n      updateViaCache: 'none'\n    });\n\n    logger.info('Service worker registered successfully');\n    logger.groupEnd();\n\n    return registration;\n  } catch (error) {\n    logger.error('Service worker registration failed', error as Error);\n    logger.groupEnd();\n    return null;\n  }\n}\n\n/**\n * Clear old avatar cache entries to free up storage space\n */\nexport const clearOldAvatarCache = () => {\n  try {\n    const keys = Object.keys(localStorage);\n    const avatarCacheKeys = keys.filter(key => key.startsWith('avatar-cache-'));\n    \n    // Remove old avatar cache versions\n    avatarCacheKeys.forEach(key => {\n      if (key !== 'avatar-cache-v3-adventurer') {\n        localStorage.removeItem(key);\n        console.log(`Cleared old avatar cache: ${key}`);\n      }\n    });\n  } catch (error) {\n    console.warn('Failed to clear old avatar cache:', error);\n  }\n};\n\n/**\n * Get avatar cache size in bytes\n */\nexport const getAvatarCacheSize = (): number => {\n  try {\n    const cached = localStorage.getItem('avatar-cache-v3-adventurer');\n    if (!cached) return 0;\n    return new Blob([cached]).size;\n  } catch (error) {\n    console.warn('Failed to get avatar cache size:', error);\n    return 0;\n  }\n};\n\n/**\n * Check if avatar cache is approaching quota limit\n */\nexport const isAvatarCacheNearQuota = (): boolean => {\n  try {\n    const size = getAvatarCacheSize();\n    // Assume 5MB limit, warn at 4MB\n    return size > 4 * 1024 * 1024;\n  } catch (error) {\n    return false;\n  }\n};\n",
    "language":"typescript",
    "lines":500,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/scroll-position.ts":{
    "content":"/**\n * Scroll position management utilities for navigation between paginated lists and thread pages\n */\n\nimport { createLogger } from '../logging';\n\n// Create logger for scroll position utilities\nconst logger = createLogger({\n  context: {\n    module: 'scroll-position'\n  }\n});\n\nexport interface ScrollPositionData {\n  scrollY: number;\n  timestamp: number;\n  pathname: string;\n  searchParams?: string;\n  // For paginated lists\n  currentPage?: number;\n  infiniteMode?: boolean;\n  totalPages?: number;\n  // For filtering\n  filters?: Record<string, any>;\n  // For thread navigation - target submission to scroll to\n  targetSubmissionId?: number;\n}\n\nconst SCROLL_STORAGE_KEY = 'app-scroll-positions';\nconst MAX_STORED_POSITIONS = 10;\nconst POSITION_EXPIRY_MS = 30 * 60 * 1000; // 30 minutes\n\n/**\n * Store current scroll position with context data\n */\nexport function storeScrollPosition(\n  referrerKey: string,\n  additionalData?: Partial<ScrollPositionData>,\n  customScrollY?: number\n): void {\n  if (typeof window === 'undefined') return;\n\n  // Use custom scroll position if provided, otherwise use window scroll\n  const scrollY = customScrollY !== undefined ? customScrollY : window.scrollY;\n\n  const scrollData: ScrollPositionData = {\n    scrollY,\n    timestamp: Date.now(),\n    pathname: window.location.pathname,\n    searchParams: window.location.search,\n    ...additionalData\n  };\n\n  try {\n    const stored = localStorage.getItem(SCROLL_STORAGE_KEY);\n    const positions: Record<string, ScrollPositionData> = stored\n      ? JSON.parse(stored)\n      : {};\n\n    // Clean up expired positions\n    const now = Date.now();\n    Object.keys(positions).forEach((key) => {\n      if (now - positions[key].timestamp > POSITION_EXPIRY_MS) {\n        delete positions[key];\n      }\n    });\n\n    // Add new position\n    positions[referrerKey] = scrollData;\n\n    // Keep only the most recent positions\n    const entries = Object.entries(positions);\n    if (entries.length > MAX_STORED_POSITIONS) {\n      entries.sort((a, b) => b[1].timestamp - a[1].timestamp);\n      const trimmed = entries.slice(0, MAX_STORED_POSITIONS);\n      const newPositions: Record<string, ScrollPositionData> = {};\n      trimmed.forEach(([key, data]) => {\n        newPositions[key] = data;\n      });\n      localStorage.setItem(SCROLL_STORAGE_KEY, JSON.stringify(newPositions));\n    } else {\n      localStorage.setItem(SCROLL_STORAGE_KEY, JSON.stringify(positions));\n    }\n  } catch (error) {\n    logger.warn('Failed to store scroll position', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n  }\n}\n\n/**\n * Retrieve stored scroll position data\n */\nexport function getStoredScrollPosition(\n  referrerKey: string\n): ScrollPositionData | null {\n  if (typeof window === 'undefined') return null;\n\n  try {\n    const stored = localStorage.getItem(SCROLL_STORAGE_KEY);\n    if (!stored) return null;\n\n    const positions: Record<string, ScrollPositionData> = JSON.parse(stored);\n    const position = positions[referrerKey];\n\n    if (!position) return null;\n\n    // Check if position is expired\n    if (Date.now() - position.timestamp > POSITION_EXPIRY_MS) {\n      // Clean up expired position\n      delete positions[referrerKey];\n      localStorage.setItem(SCROLL_STORAGE_KEY, JSON.stringify(positions));\n      return null;\n    }\n\n    return position;\n  } catch (error) {\n    logger.warn('Failed to retrieve scroll position', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n    return null;\n  }\n}\n\n/**\n * Restore scroll position with smooth scrolling\n */\nexport function restoreScrollPosition(\n  referrerKey: string,\n  options: { smooth?: boolean; offset?: number } = {}\n): boolean {\n  const position = getStoredScrollPosition(referrerKey);\n  if (!position) return false;\n\n  const { smooth = true, offset = 0 } = options;\n  const targetY = Math.max(0, position.scrollY - offset);\n\n  if (smooth) {\n    window.scrollTo({\n      top: targetY,\n      behavior: 'smooth'\n    });\n  } else {\n    window.scrollTo(0, targetY);\n  }\n\n  return true;\n}\n\n/**\n * Generate a unique key for the current page state\n */\nexport function generateScrollKey(\n  basePath: string,\n  params?: {\n    page?: number;\n    filters?: Record<string, any>;\n    searchParams?: URLSearchParams;\n  }\n): string {\n  const parts = [basePath];\n\n  if (params?.page) {\n    parts.push(`page-${params.page}`);\n  }\n\n  if (params?.filters && Object.keys(params.filters).length > 0) {\n    const filterStr = Object.entries(params.filters)\n      .sort(([a], [b]) => a.localeCompare(b))\n      .map(([key, value]) => `${key}:${value}`)\n      .join(',');\n    parts.push(`filters-${btoa(filterStr)}`);\n  }\n\n  if (params?.searchParams) {\n    const searchStr = params.searchParams.toString();\n    if (searchStr) {\n      parts.push(`search-${btoa(searchStr)}`);\n    }\n  }\n\n  return parts.join('|');\n}\n\n/**\n * Clear all stored scroll positions\n */\nexport function clearScrollPositions(): void {\n  if (typeof window === 'undefined') return;\n\n  try {\n    localStorage.removeItem(SCROLL_STORAGE_KEY);\n  } catch (error) {\n    logger.warn('Failed to clear scroll positions', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n  }\n}\n\n/**\n * Clear specific scroll position\n */\nexport function clearScrollPosition(referrerKey: string): void {\n  if (typeof window === 'undefined') return;\n\n  try {\n    const stored = localStorage.getItem(SCROLL_STORAGE_KEY);\n    if (!stored) return;\n\n    const positions: Record<string, ScrollPositionData> = JSON.parse(stored);\n    delete positions[referrerKey];\n    localStorage.setItem(SCROLL_STORAGE_KEY, JSON.stringify(positions));\n  } catch (error) {\n    logger.warn('Failed to clear scroll position', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n  }\n}\n\n/**\n * Update existing scroll position with new scroll data\n * This is useful when the user scrolls to a new position and we want to update the stored position\n */\nexport function updateScrollPosition(\n  referrerKey: string,\n  newScrollY?: number,\n  additionalData?: Partial<ScrollPositionData>\n): boolean {\n  if (typeof window === 'undefined') return false;\n\n  try {\n    const stored = localStorage.getItem(SCROLL_STORAGE_KEY);\n    if (!stored) return false;\n\n    const positions: Record<string, ScrollPositionData> = JSON.parse(stored);\n    const existingPosition = positions[referrerKey];\n\n    if (!existingPosition) return false;\n\n    // Use provided scroll position or current window scroll\n    const scrollY = newScrollY !== undefined ? newScrollY : window.scrollY;\n\n    // Update the existing position with new data\n    positions[referrerKey] = {\n      ...existingPosition,\n      scrollY,\n      timestamp: Date.now(), // Update timestamp to keep it fresh\n      ...additionalData\n    };\n\n    localStorage.setItem(SCROLL_STORAGE_KEY, JSON.stringify(positions));\n\n    logger.debug('Updated scroll position', {\n      referrerKey,\n      newScrollY: scrollY,\n      previousScrollY: existingPosition.scrollY,\n      additionalData\n    });\n\n    return true;\n  } catch (error) {\n    logger.warn('Failed to update scroll position', {\n      error: error instanceof Error ? error.message : String(error)\n    });\n    return false;\n  }\n}\n\n/**\n * Store or update scroll position based on whether it already exists\n */\nexport function storeOrUpdateScrollPosition(\n  referrerKey: string,\n  additionalData?: Partial<ScrollPositionData>,\n  customScrollY?: number\n): void {\n  // Try to update first, if that fails, store new position\n  const updated = updateScrollPosition(\n    referrerKey,\n    customScrollY,\n    additionalData\n  );\n\n  if (!updated) {\n    storeScrollPosition(referrerKey, additionalData, customScrollY);\n  }\n}\n",
    "language":"typescript",
    "lines":288,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/timeFormatting.ts":{
    "content":"/**\n * Format seconds into human-readable time strings\n * Used for rate limiting and quota error messages\n */\n\nexport function formatRetryAfter(seconds: number): string {\n  if (seconds < 60) {\n    return `${Math.ceil(seconds)} second${Math.ceil(seconds) !== 1 ? 's' : ''}`;\n  }\n  \n  if (seconds < 3600) {\n    const minutes = Math.ceil(seconds / 60);\n    return `${minutes} minute${minutes !== 1 ? 's' : ''}`;\n  }\n  \n  if (seconds < 86400) {\n    const hours = Math.ceil(seconds / 3600);\n    return `${hours} hour${hours !== 1 ? 's' : ''}`;\n  }\n  \n  const days = Math.ceil(seconds / 86400);\n  return `${days} day${days !== 1 ? 's' : ''}`;\n}\n\nexport function formatTimeRemaining(seconds: number): string {\n  if (seconds < 60) {\n    return `${Math.ceil(seconds)}s`;\n  }\n  \n  if (seconds < 3600) {\n    const minutes = Math.ceil(seconds / 60);\n    return `${minutes}m`;\n  }\n  \n  if (seconds < 86400) {\n    const hours = Math.ceil(seconds / 3600);\n    const remainingMinutes = Math.ceil((seconds % 3600) / 60);\n    return remainingMinutes > 0 ? `${hours}h ${remainingMinutes}m` : `${hours}h`;\n  }\n  \n  const days = Math.ceil(seconds / 86400);\n  const remainingHours = Math.ceil((seconds % 86400) / 3600);\n  return remainingHours > 0 ? `${days}d ${remainingHours}h` : `${days}d`;\n}\n\nexport function formatQuotaResetTime(resetTimestamp: number): string {\n  const now = Date.now();\n  const secondsUntilReset = Math.max(0, Math.ceil((resetTimestamp - now) / 1000));\n  \n  if (secondsUntilReset === 0) {\n    return 'now';\n  }\n  \n  return formatRetryAfter(secondsUntilReset);\n} ",
    "language":"typescript",
    "lines":55,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/hard-reset-manager.ts":{
    "content":"/**\n * Hard Reset Manager\n *\n * Provides version-based and manual hard reset functionality to completely\n * clear all application data, making it appear as if the user is visiting\n * for the first time. This is agnostic and reusable for future deployments.\n */\n\nimport { createLogger } from '../logging';\n\n// Create logger for hard reset management\nconst logger = createLogger({\n  context: {\n    module: 'hard-reset-manager'\n  },\n  enabled: false\n});\n\nexport interface HardResetConfig {\n  // Version that triggers the reset\n  resetVersion: string;\n  // Whether to force reset regardless of version\n  forceReset?: boolean;\n  // Custom reset reason for logging\n  resetReason?: string;\n  // Whether to show user notification\n  showNotification?: boolean;\n}\n\nexport interface HardResetResult {\n  wasResetNeeded: boolean;\n  resetPerformed: boolean;\n  previousVersion: string | null;\n  currentVersion: string;\n  itemsCleared: {\n    serviceWorkers: number;\n    caches: number;\n    localStorage: boolean;\n    sessionStorage: boolean;\n    indexedDB: boolean;\n    cookies: number;\n    webSQL: boolean;\n  };\n  errors: string[];\n}\n\n/**\n * Storage keys for tracking reset state\n */\nconst RESET_STORAGE_KEYS = {\n  LAST_RESET_VERSION: 'app-last-reset-version',\n  LAST_RESET_TIMESTAMP: 'app-last-reset-timestamp',\n  RESET_COUNT: 'app-reset-count',\n  FIRST_VISIT: 'app-first-visit'\n} as const;\n\n/**\n * Get current app version from various sources\n */\nfunction getCurrentAppVersion(): string {\n  // Try to get version from meta tag (set during build)\n  const metaVersion = document\n    .querySelector('meta[name=\\\"app-version\\\"]')\n    ?.getAttribute('content');\n  if (metaVersion) return metaVersion;\n\n  // Try to get from global variable (set during build)\n  const globalVersion = (window as any).__APP_VERSION__;\n  if (globalVersion) return globalVersion;\n\n  // Fallback to timestamp-based version\n  return Date.now().toString();\n}\n\n/**\n * Get stored reset version from localStorage\n */\nfunction getStoredResetVersion(): string | null {\n  try {\n    return localStorage.getItem(RESET_STORAGE_KEYS.LAST_RESET_VERSION);\n  } catch (error) {\n    logger.warn('Failed to get stored reset version:', { error });\n    return null;\n  }\n}\n\n/**\n * Store reset version and metadata\n */\nfunction storeResetMetadata(version: string, resetCount: number): void {\n  try {\n    localStorage.setItem(RESET_STORAGE_KEYS.LAST_RESET_VERSION, version);\n    localStorage.setItem(\n      RESET_STORAGE_KEYS.LAST_RESET_TIMESTAMP,\n      Date.now().toString()\n    );\n    localStorage.setItem(RESET_STORAGE_KEYS.RESET_COUNT, resetCount.toString());\n  } catch (error) {\n    logger.warn('Failed to store reset metadata:', { error });\n  }\n}\n\n/**\n * Check if hard reset is needed based on version\n */\nexport function isHardResetNeeded(config: HardResetConfig): boolean {\n  if (config.forceReset) {\n    return true;\n  }\n\n  const currentVersion = getCurrentAppVersion();\n  const storedVersion = getStoredResetVersion();\n\n  // First visit - no reset needed, but mark as visited\n  if (!storedVersion) {\n    try {\n      localStorage.setItem(\n        RESET_STORAGE_KEYS.FIRST_VISIT,\n        Date.now().toString()\n      );\n    } catch (error) {\n      // Silent fail\n    }\n    return false;\n  }\n\n  // Check if reset version is different from stored version\n  return storedVersion !== config.resetVersion;\n}\n\n/**\n * Clear all cookies\n */\nasync function clearAllCookies(): Promise<number> {\n  let cookiesCleared = 0;\n\n  try {\n    // Clear document cookies\n    const cookies = document.cookie.split(';');\n\n    for (const cookie of cookies) {\n      const eqPos = cookie.indexOf('=');\n      const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();\n\n      if (name) {\n        // Clear for current domain and path\n        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;\n        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=${window.location.hostname}`;\n        document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.${window.location.hostname}`;\n        cookiesCleared++;\n      }\n    }\n\n    // Clear using Cookie Store API if available\n    if ('cookieStore' in window) {\n      try {\n        const cookieStore = (window as any).cookieStore;\n        const allCookies = await cookieStore.getAll();\n\n        for (const cookie of allCookies) {\n          await cookieStore.delete(cookie.name);\n          cookiesCleared++;\n        }\n      } catch (error) {\n        logger.warn('Failed to clear cookies via Cookie Store API:', { error });\n      }\n    }\n  } catch (error) {\n    logger.warn('Failed to clear cookies:', { error });\n  }\n\n  return cookiesCleared;\n}\n\n/**\n * Clear all localStorage (except reset tracking)\n */\nasync function clearLocalStorage(): Promise<boolean> {\n  try {\n    // Store reset metadata before clearing\n    const resetVersion = localStorage.getItem(\n      RESET_STORAGE_KEYS.LAST_RESET_VERSION\n    );\n    const resetTimestamp = localStorage.getItem(\n      RESET_STORAGE_KEYS.LAST_RESET_TIMESTAMP\n    );\n    const resetCount = localStorage.getItem(RESET_STORAGE_KEYS.RESET_COUNT);\n    const firstVisit = localStorage.getItem(RESET_STORAGE_KEYS.FIRST_VISIT);\n\n    // Clear all localStorage\n    localStorage.clear();\n\n    // Restore reset tracking data\n    if (resetVersion)\n      localStorage.setItem(RESET_STORAGE_KEYS.LAST_RESET_VERSION, resetVersion);\n    if (resetTimestamp)\n      localStorage.setItem(\n        RESET_STORAGE_KEYS.LAST_RESET_TIMESTAMP,\n        resetTimestamp\n      );\n    if (resetCount)\n      localStorage.setItem(RESET_STORAGE_KEYS.RESET_COUNT, resetCount);\n    if (firstVisit)\n      localStorage.setItem(RESET_STORAGE_KEYS.FIRST_VISIT, firstVisit);\n\n    return true;\n  } catch (error) {\n    logger.warn('Failed to clear localStorage:', { error });\n    return false;\n  }\n}\n\n/**\n * Clear all sessionStorage\n */\nasync function clearSessionStorage(): Promise<boolean> {\n  try {\n    sessionStorage.clear();\n    return true;\n  } catch (error) {\n    logger.warn('Failed to clear sessionStorage:', { error });\n    return false;\n  }\n}\n\n/**\n * Clear all IndexedDB databases\n */\nasync function clearIndexedDB(): Promise<boolean> {\n  if (!('indexedDB' in window)) {\n    return false;\n  }\n\n  try {\n    const databases = await indexedDB.databases();\n\n    await Promise.all(\n      databases.map((db) => {\n        if (db.name) {\n          return new Promise<void>((resolve, reject) => {\n            const deleteReq = indexedDB.deleteDatabase(db.name!);\n            deleteReq.onsuccess = () => resolve();\n            deleteReq.onerror = () => reject(deleteReq.error);\n            deleteReq.onblocked = () => {\n              logger.warn(`IndexedDB deletion blocked for: ${db.name}`);\n              resolve(); // Don't fail the entire process\n            };\n          });\n        }\n        return Promise.resolve();\n      })\n    );\n\n    return true;\n  } catch (error) {\n    logger.warn('Failed to clear IndexedDB:', { error });\n    return false;\n  }\n}\n\n/**\n * Clear WebSQL (deprecated but still present in some browsers)\n */\nasync function clearWebSQL(): Promise<boolean> {\n  try {\n    if ('webkitStorageInfo' in window) {\n      const webkitStorageInfo = (window as any).webkitStorageInfo;\n      if (webkitStorageInfo && webkitStorageInfo.requestQuota) {\n        return new Promise((resolve) => {\n          webkitStorageInfo.requestQuota(\n            0, // TEMPORARY\n            0, // quota\n            () => resolve(true),\n            () => resolve(false)\n          );\n        });\n      }\n    }\n    return false;\n  } catch (error) {\n    logger.warn('Failed to clear WebSQL:', { error });\n    return false;\n  }\n}\n\n/**\n * Clear all browser caches\n */\nasync function clearAllCaches(): Promise<number> {\n  if (!('caches' in window)) {\n    return 0;\n  }\n\n  try {\n    const cacheNames = await caches.keys();\n\n    const deletePromises = cacheNames.map(async (cacheName) => {\n      try {\n        await caches.delete(cacheName);\n        logger.info(`\u2705 Deleted cache: ${cacheName}`);\n        return true;\n      } catch (error) {\n        logger.warn(`\u26a0\ufe0f Failed to delete cache ${cacheName}:`, { error });\n        return false;\n      }\n    });\n\n    const results = await Promise.all(deletePromises);\n    return results.filter((success) => success).length;\n  } catch (error) {\n    logger.warn('Failed to clear caches:', { error });\n    return 0;\n  }\n}\n\n/**\n * Unregister ALL service workers\n */\nasync function unregisterAllServiceWorkers(): Promise<number> {\n  if (!('serviceWorker' in navigator)) {\n    return 0;\n  }\n\n  try {\n    const registrations = await navigator.serviceWorker.getRegistrations();\n\n    const unregisterPromises = registrations.map(async (registration) => {\n      try {\n        await registration.unregister();\n        logger.info('\u2705 Unregistered service worker');\n        return true;\n      } catch (error) {\n        logger.warn('\u26a0\ufe0f Failed to unregister service worker:', { error });\n        return false;\n      }\n    });\n\n    const results = await Promise.all(unregisterPromises);\n    return results.filter((success) => success).length;\n  } catch (error) {\n    logger.warn('Failed to unregister service workers:', { error });\n    return 0;\n  }\n}\n\n/**\n * Perform comprehensive hard reset\n */\nexport async function performHardReset(\n  config: HardResetConfig\n): Promise<HardResetResult> {\n  const currentVersion = getCurrentAppVersion();\n  const previousVersion = getStoredResetVersion();\n  const errors: string[] = [];\n\n  logger.group('hardReset');\n  logger.info('Hard reset initiated', {\n    resetVersion: config.resetVersion,\n    currentVersion,\n    previousVersion,\n    forceReset: config.forceReset || false,\n    reason: config.resetReason || 'Version change'\n  });\n\n  const result: HardResetResult = {\n    wasResetNeeded: isHardResetNeeded(config),\n    resetPerformed: false,\n    previousVersion,\n    currentVersion,\n    itemsCleared: {\n      serviceWorkers: 0,\n      caches: 0,\n      localStorage: false,\n      sessionStorage: false,\n      indexedDB: false,\n      cookies: 0,\n      webSQL: false\n    },\n    errors\n  };\n\n  if (!result.wasResetNeeded && !config.forceReset) {\n    logger.debug('No reset needed');\n    logger.groupEnd();\n    return result;\n  }\n\n  logger.debug('Starting comprehensive cleanup');\n\n  try {\n    // 1. Unregister all service workers\n    logger.debug('Step 1: Unregistering service workers');\n    try {\n      result.itemsCleared.serviceWorkers = await unregisterAllServiceWorkers();\n    } catch (error) {\n      const errorMsg = `Service workers: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to unregister service workers', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // 2. Clear all caches\n    logger.debug('Step 2: Clearing caches');\n    try {\n      result.itemsCleared.caches = await clearAllCaches();\n    } catch (error) {\n      const errorMsg = `Caches: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to clear caches', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // 3. Clear localStorage (preserving reset tracking)\n    logger.debug('Step 3: Clearing localStorage');\n    try {\n      result.itemsCleared.localStorage = await clearLocalStorage();\n    } catch (error) {\n      const errorMsg = `localStorage: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to clear localStorage', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // 4. Clear sessionStorage\n    logger.debug('Step 4: Clearing sessionStorage');\n    try {\n      result.itemsCleared.sessionStorage = await clearSessionStorage();\n    } catch (error) {\n      const errorMsg = `sessionStorage: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to clear sessionStorage', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // 5. Clear IndexedDB\n    logger.debug('Step 5: Clearing IndexedDB');\n    try {\n      result.itemsCleared.indexedDB = await clearIndexedDB();\n    } catch (error) {\n      const errorMsg = `IndexedDB: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to clear IndexedDB', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // 6. Clear cookies\n    logger.debug('Step 6: Clearing cookies');\n    try {\n      result.itemsCleared.cookies = await clearAllCookies();\n    } catch (error) {\n      const errorMsg = `Cookies: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to clear cookies', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // 7. Clear WebSQL\n    logger.debug('Step 7: Clearing WebSQL');\n    try {\n      result.itemsCleared.webSQL = await clearWebSQL();\n    } catch (error) {\n      const errorMsg = `WebSQL: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to clear WebSQL', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    // 8. Update reset tracking\n    logger.debug('Step 8: Updating reset tracking');\n    try {\n      const currentResetCount = parseInt(\n        localStorage.getItem(RESET_STORAGE_KEYS.RESET_COUNT) || '0'\n      );\n      storeResetMetadata(config.resetVersion, currentResetCount + 1);\n    } catch (error) {\n      const errorMsg = `Reset tracking: ${error}`;\n      errors.push(errorMsg);\n      logger.warn('Failed to update reset tracking', {\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n\n    result.resetPerformed = true;\n\n    logger.info('Hard reset completed successfully', {\n      itemsCleared: result.itemsCleared\n    });\n\n    if (errors.length > 0) {\n      logger.warn('Some errors occurred during reset', { errors });\n    }\n  } catch (error) {\n    logger.error('Hard reset failed', error as Error);\n    errors.push(`General: ${error}`);\n  }\n\n  logger.groupEnd();\n\n  return result;\n}\n\n/**\n * Check and perform hard reset if needed (main entry point)\n */\nexport async function checkAndPerformHardReset(\n  config: HardResetConfig\n): Promise<HardResetResult> {\n  const result = await performHardReset(config);\n\n  // If reset was performed, show notification if requested\n  if (result.resetPerformed && config.showNotification) {\n    try {\n      // Create a simple notification\n      const notification = document.createElement('div');\n      notification.style.cssText = `\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #4CAF50;\n        color: white;\n        padding: 16px 24px;\n        border-radius: 8px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        z-index: 10000;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        max-width: 300px;\n      `;\n      notification.innerHTML = `\n        <strong>App Updated!</strong><br>\n        ${config.resetReason || 'Your app has been refreshed with the latest version.'}\n      `;\n\n      document.body.appendChild(notification);\n\n      // Remove notification after 5 seconds\n      setTimeout(() => {\n        if (notification.parentNode) {\n          notification.parentNode.removeChild(notification);\n        }\n      }, 5000);\n    } catch (error) {\n      logger.warn('Failed to show reset notification:', { error });\n    }\n  }\n\n  return result;\n}\n\n/**\n * Get reset statistics\n */\nexport function getResetStats(): {\n  lastResetVersion: string | null;\n  lastResetTimestamp: number | null;\n  resetCount: number;\n  firstVisit: number | null;\n} {\n  try {\n    return {\n      lastResetVersion: localStorage.getItem(\n        RESET_STORAGE_KEYS.LAST_RESET_VERSION\n      ),\n      lastResetTimestamp:\n        parseInt(\n          localStorage.getItem(RESET_STORAGE_KEYS.LAST_RESET_TIMESTAMP) || '0'\n        ) || null,\n      resetCount: parseInt(\n        localStorage.getItem(RESET_STORAGE_KEYS.RESET_COUNT) || '0'\n      ),\n      firstVisit:\n        parseInt(localStorage.getItem(RESET_STORAGE_KEYS.FIRST_VISIT) || '0') ||\n        null\n    };\n  } catch (error) {\n    return {\n      lastResetVersion: null,\n      lastResetTimestamp: null,\n      resetCount: 0,\n      firstVisit: null\n    };\n  }\n}\n\n/**\n * Manual hard reset trigger (for admin/debug purposes)\n */\nexport async function triggerManualHardReset(\n  reason: string = 'Manual reset'\n): Promise<HardResetResult> {\n  return await performHardReset({\n    resetVersion: Date.now().toString(),\n    forceReset: true,\n    resetReason: reason,\n    showNotification: true\n  });\n}\n",
    "language":"typescript",
    "lines":605,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/requestIdentifier.ts":{
    "content":"import { NextRequest } from 'next/server';\n\n/**\n * Extract client IP address from request headers\n * Handles various proxy configurations and load balancers\n */\nexport function getClientIP(request: NextRequest): string {\n  // Check for forwarded IP from proxies/load balancers\n  const forwardedFor = request.headers.get('x-forwarded-for');\n  if (forwardedFor) {\n    // Take the first IP if multiple are present\n    return forwardedFor.split(',')[0].trim();\n  }\n\n  // Check for real IP (some proxies use this)\n  const realIP = request.headers.get('x-real-ip');\n  if (realIP) {\n    return realIP.trim();\n  }\n\n  // Check for Cloudflare connecting IP\n  const cfConnectingIP = request.headers.get('cf-connecting-ip');\n  if (cfConnectingIP) {\n    return cfConnectingIP.trim();\n  }\n\n  // Check for other common headers\n  const clientIP = request.headers.get('x-client-ip');\n  if (clientIP) {\n    return clientIP.trim();\n  }\n\n  // Fallback to connection remote address\n  const remoteAddr = request.headers.get('x-forwarded-host') || 'unknown';\n  return remoteAddr;\n}\n\n/**\n * Extract user identifier from session\n */\nexport function getUserIdentifier(session: any): string | null {\n  if (!session?.user?.id) {\n    return null;\n  }\n  return `user:${session.user.id}`;\n}\n\n/**\n * Generate a device fingerprint based on request headers\n * This helps distinguish different devices on the same network\n * Uses a simple hash instead of crypto for edge runtime compatibility\n */\nexport function generateDeviceFingerprint(request: NextRequest): string {\n  const userAgent = request.headers.get('user-agent') || 'unknown';\n  const acceptLanguage = request.headers.get('accept-language') || 'unknown';\n  const acceptEncoding = request.headers.get('accept-encoding') || 'unknown';\n  const accept = request.headers.get('accept') || 'unknown';\n  \n  // Create a stable but unique fingerprint\n  const fingerprintData = [\n    userAgent.substring(0, 200), // Limit length but keep core info\n    acceptLanguage.split(',')[0], // Primary language\n    acceptEncoding.split(',').slice(0, 3).join(','), // First few encoding types\n    accept.split(',')[0] // Primary accept type\n  ].join('|');\n  \n  // Use a simple hash for edge runtime compatibility\n  return simpleHash(fingerprintData).substring(0, 8);\n}\n\n/**\n * Simple hash function that works in edge runtime\n * This is a basic djb2 hash implementation\n */\nfunction simpleHash(str: string): string {\n  let hash = 5381;\n  for (let i = 0; i < str.length; i++) {\n    hash = ((hash << 5) + hash) + str.charCodeAt(i);\n  }\n  return Math.abs(hash).toString(16);\n}\n\n/**\n * Generate network identifier (subnet-based) for household grouping\n * This allows some shared limits while maintaining device separation\n */\nexport function getNetworkIdentifier(ip: string): string {\n  if (ip === 'unknown') return 'unknown';\n  \n  const parts = ip.split('.');\n  if (parts.length !== 4) return ip;\n  \n  // For most home networks, use /24 subnet (first 3 octets)\n  // This groups household devices while separating different networks\n  return `${parts[0]}.${parts[1]}.${parts[2]}.x`;\n}\n\nexport interface RequestIdentifiers {\n  ip: string;\n  user: string | null;\n  deviceFingerprint: string;\n  networkId: string;\n  composite: string;\n  // Different identifiers for different rate limiting strategies\n  perDevice: string;      // Most granular - per device\n  perUser: string;        // Per authenticated user\n  perNetwork: string;     // Per household/network\n  perIP: string;          // Per exact IP (most restrictive)\n}\n\n/**\n * Generate comprehensive request identifiers for flexible rate limiting\n * This allows different rate limiting strategies based on the threat level\n */\nexport function getRequestIdentifier(request: NextRequest, session: any): RequestIdentifiers {\n  const ip = getClientIP(request);\n  const user = getUserIdentifier(session);\n  const deviceFingerprint = generateDeviceFingerprint(request);\n  const networkId = getNetworkIdentifier(ip);\n  \n  // Create different identifier strategies\n  const perDevice = `device:${networkId}:${deviceFingerprint}`;\n  const perUser = user || perDevice; // Fall back to device if no user\n  const perNetwork = `network:${networkId}`;\n  const perIP = `ip:${ip}`;\n  \n  // Default composite uses device-level identification for unauthenticated users\n  // This allows multiple devices per household while blocking device-specific abuse\n  const composite = user ? `${perDevice}:${user}` : perDevice;\n  \n  return {\n    ip,\n    user,\n    deviceFingerprint,\n    networkId,\n    composite,\n    perDevice,\n    perUser,\n    perNetwork,\n    perIP\n  };\n}\n\n/**\n * Determine rate limit configuration type based on endpoint\n */\nexport function getRateLimitType(pathname: string): 'api' | 'auth' | 'upload' | 'search' | 'admin' | 'og-image' | 'sse' {\n  if (pathname.startsWith('/api/auth')) {\n    return 'auth';\n  }\n  \n  if (pathname.startsWith('/api/upload')) {\n    return 'upload';\n  }\n  \n  if (pathname.startsWith('/api/admin')) {\n    return 'admin';\n  }\n  \n  // SSE endpoints need very lenient rate limiting due to persistent connections\n  if (pathname.includes('/stream') || \n      pathname.startsWith('/api/sse') || \n      pathname.startsWith('/api/alerts/stream')) {\n    return 'sse';\n  }\n  \n  // OG Image generation endpoints - more generous limits\n  if (pathname.startsWith('/api/og-image')) {\n    return 'og-image';\n  }\n  \n  // Search and filter endpoints\n  if (pathname.includes('search') || \n      pathname.includes('filter') || \n      pathname.includes('submissions') ||\n      pathname.includes('posts')) {\n    return 'search';\n  }\n  \n  return 'api';\n} ",
    "language":"typescript",
    "lines":181,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/string/tag-regex.ts":{
    "content":"/**\n * @example console.log(tagRegex.test('this is a message with an #epic tag')) => true\n * @example console.log('this is a message with an #epic tag'.match(tagRegex)) => '#epic'\n */\nexport const tagRegex = /#([^\\\\s#]\\\\w+)/gim;\n\n/**\n * Validates that a tag is properly formatted with # prefix and valid characters\n * @param tag - The tag to validate\n * @returns boolean - true if valid, false otherwise\n */\nexport function isValidTag(tag: string): boolean {\n  if (!tag || typeof tag !== 'string') return false;\n\n  // Must start with # and have at least one character after\n  if (!tag.startsWith('#')) return false;\n\n  // Remove # and check the rest\n  const tagContent = tag.slice(1);\n  if (tagContent.length === 0) return false;\n\n  // Only allow alphanumeric, hyphens, and underscores (no spaces)\n  return /^[a-zA-Z0-9_-]+$/.test(tagContent);\n}\n\n/**\n * Normalizes a tag by ensuring it has # prefix and is lowercase\n * @param tag - The tag to normalize\n * @returns string - normalized tag or empty string if invalid\n */\nexport function normalizeTag(tag: string): string {\n  if (!tag || typeof tag !== 'string') return '';\n\n  const trimmed = tag.trim();\n  if (!trimmed) return '';\n\n  // Add # if missing\n  const withHash = trimmed.startsWith('#') ? trimmed : `#${trimmed}`;\n\n  // Validate and return lowercase\n  if (isValidTag(withHash)) {\n    return withHash.toLowerCase();\n  }\n\n  return '';\n}\n\n/**\n * Extracts tags from text content (title or description)\n * @param text - The text to extract tags from\n * @returns string[] - array of normalized tags\n */\nexport function extractTagsFromText(text: string): string[] {\n  if (!text || typeof text !== 'string') return [];\n\n  const matches = text.match(tagRegex);\n  if (!matches) return [];\n\n  return matches\n    .map((tag) => normalizeTag(tag))\n    .filter((tag) => tag.length > 0);\n}\n\n/**\n * Parses a comma-separated or space-separated string of tags and normalizes them\n * @param tagsString - Tags like \\\"tag1, #tag2, tag3\\\" or \\\"#tag1 #tag2 #tag3\\\"\n * @returns string[] - array of normalized tags with # prefix\n */\nexport function parseTagsInput(tagsString: string): string[] {\n  if (!tagsString || typeof tagsString !== 'string') return [];\n\n  // First try to split by commas (preferred format)\n  let rawTags = tagsString\n    .split(',')\n    .map((tag) => tag.trim())\n    .filter(Boolean);\n\n  // If no commas found, try space-separated hashtags\n  if (rawTags.length === 1 && rawTags[0].includes(' ')) {\n    // Split by spaces and filter for hashtag-like strings\n    const spaceSplit = rawTags[0].split(/\\\\s+/).filter(Boolean);\n    // Only use space-split if all parts look like hashtags\n    if (spaceSplit.every((part) => part.startsWith('#'))) {\n      rawTags = spaceSplit;\n    }\n  }\n\n  return rawTags\n    .map((tag) => normalizeTag(tag.trim()))\n    .filter((tag) => tag.length > 0);\n}\n\n/**\n * Validates a tags input string and returns errors if any\n * @param tagsString - The tags input to validate (supports both comma and space separation)\n * @returns string[] - array of error messages, empty if valid\n */\nexport function validateTagsInput(tagsString: string): string[] {\n  const errors: string[] = [];\n\n  if (!tagsString || typeof tagsString !== 'string') {\n    return errors; // Empty is valid\n  }\n\n  // Use the same parsing logic as parseTagsInput\n  let rawTags = tagsString\n    .split(',')\n    .map((tag) => tag.trim())\n    .filter(Boolean);\n\n  // If no commas found, try space-separated hashtags\n  if (rawTags.length === 1 && rawTags[0].includes(' ')) {\n    const spaceSplit = rawTags[0].split(/\\\\s+/).filter(Boolean);\n    // Only use space-split if all parts look like hashtags\n    if (spaceSplit.every((part) => part.startsWith('#'))) {\n      rawTags = spaceSplit;\n    }\n  }\n\n  if (rawTags.length === 0) return errors;\n\n  for (const rawTag of rawTags) {\n    if (!rawTag.startsWith('#')) {\n      errors.push(`Tag \\\"${rawTag}\\\" must start with # (e.g., #${rawTag})`);\n    } else if (!isValidTag(rawTag)) {\n      errors.push(\n        `Tag \\\"${rawTag}\\\" contains invalid characters. Use only letters, numbers, hyphens, and underscores.`\n      );\n    }\n  }\n\n  return errors;\n}\n",
    "language":"typescript",
    "lines":134,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/string/tag-utils.ts":{
    "content":"/**\n * Universal tag handling utilities - single source of truth\n * Fixes tag normalization inconsistencies throughout the application\n */\n\n/**\n * Normalizes a tag for database storage (lowercase, no # prefix)\n * @param tag - Raw tag input (with or without #)\n * @returns string - normalized tag for database operations (e.g., \\\"my_posts\\\")\n */\nexport function normalizeTagForDatabase(tag: string): string {\n  if (!tag || typeof tag !== 'string') return '';\n\n  const trimmed = tag.trim().toLowerCase();\n  if (!trimmed) return '';\n\n  // Remove # prefix if present, keep lowercase\n  const withoutHash = trimmed.startsWith('#') ? trimmed.substring(1) : trimmed;\n\n  // Validate format: only letters, numbers, underscores, hyphens\n  if (\n    /^[a-z0-9_-]+$/.test(withoutHash) &&\n    withoutHash.length > 0 &&\n    withoutHash.length <= 50\n  ) {\n    return withoutHash;\n  }\n\n  return '';\n}\n\n/**\n * Formats a tag for display (with # prefix)\n * @param tag - Database tag or any tag format\n * @returns string - display-ready tag (e.g., \\\"#my_posts\\\")\n */\nexport function formatTagForDisplay(tag: string): string {\n  const normalized = normalizeTagForDatabase(tag);\n  return normalized ? `#${normalized}` : '';\n}\n\n/**\n * Formats multiple tags for URL parameters (no # prefix, comma-separated)\n * @param tags - Array of tags in any format\n * @returns string - URL-ready tags (e.g., \\\"my_posts,react,typescript\\\")\n */\nexport function formatTagsForUrl(tags: string[]): string {\n  return tags.map(normalizeTagForDatabase).filter(Boolean).join(',');\n}\n\n/**\n * Parses tags from URL parameter back to display format\n * @param urlTags - Comma-separated tags from URL (e.g., \\\"my_posts,react\\\")\n * @returns string[] - Display-ready tags (e.g., [\\\"#my_posts\\\", \\\"#react\\\"])\n */\nexport function parseTagsFromUrl(urlTags: string): string[] {\n  if (!urlTags) return [];\n\n  return urlTags\n    .split(',')\n    .map(normalizeTagForDatabase)\n    .filter(Boolean)\n    .map(formatTagForDisplay);\n}\n\n/**\n * Normalizes an array of tags for database queries\n * @param tags - Array of tags in any format\n * @returns string[] - Database-ready tags (e.g., [\\\"my_posts\\\", \\\"react\\\"])\n */\nexport function normalizeTagsForDatabase(tags: string[]): string[] {\n  return tags.map(normalizeTagForDatabase).filter(Boolean);\n}\n\n/**\n * Validates a tag input\n * @param tag - Tag to validate\n * @returns boolean - true if valid\n */\nexport function isValidTag(tag: string): boolean {\n  const normalized = normalizeTagForDatabase(tag);\n  return normalized.length > 0;\n}\n",
    "language":"typescript",
    "lines":84,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/parsers/emoji-parser.ts":{
    "content":"/**\n * Zero-dependency Emoji Parser with Custom Emoji Support\n * Scalable and secure solution for parsing standard and custom emojis\n */\n\nimport { createLogger } from '@/lib/logging';\n\nconst logger = createLogger({\n  context: {\n    component: 'EmojiParser',\n    module: 'parsers'\n  },\n  enabled: false\n});\n\nexport interface EmojiDefinition {\n  id: string;\n  name: string;\n  unicode?: string; // For standard emojis\n  imageUrl?: string; // For custom emojis\n  category: string;\n  tags: string[];\n  aliases: string[]; // Alternative names like :smile: vs :grinning:\n}\n\nexport interface EmojiToken {\n  type: 'emoji';\n  id: string;\n  name: string;\n  unicode?: string;\n  imageUrl?: string;\n  start: number;\n  end: number;\n  rawText: string; // Original :emoji_name: text\n}\n\nexport class EmojiRegistry {\n  private static instance: EmojiRegistry;\n  private emojis: Map<string, EmojiDefinition> = new Map();\n  private aliases: Map<string, string> = new Map(); // alias -> id mapping\n\n  private constructor() {\n    this.loadStandardEmojis();\n  }\n\n  static getInstance(): EmojiRegistry {\n    if (!EmojiRegistry.instance) {\n      EmojiRegistry.instance = new EmojiRegistry();\n    }\n    return EmojiRegistry.instance;\n  }\n\n  /**\n   * Load standard Unicode emojis\n   */\n  private loadStandardEmojis(): void {\n    const standardEmojis: EmojiDefinition[] = [\n      // Faces\n      {\n        id: 'grinning',\n        name: 'grinning',\n        unicode: '\ud83d\ude00',\n        category: 'faces',\n        tags: ['happy', 'smile'],\n        aliases: ['grinning']\n      },\n      {\n        id: 'smile',\n        name: 'smile',\n        unicode: '\ud83d\ude04',\n        category: 'faces',\n        tags: ['happy', 'joy'],\n        aliases: ['smile', 'happy']\n      },\n      {\n        id: 'joy',\n        name: 'joy',\n        unicode: '\ud83d\ude02',\n        category: 'faces',\n        tags: ['laugh', 'tears'],\n        aliases: ['joy', 'laugh']\n      },\n      {\n        id: 'heart_eyes',\n        name: 'heart_eyes',\n        unicode: '\ud83d\ude0d',\n        category: 'faces',\n        tags: ['love', 'heart'],\n        aliases: ['heart_eyes', 'love']\n      },\n      {\n        id: 'wink',\n        name: 'wink',\n        unicode: '\ud83d\ude09',\n        category: 'faces',\n        tags: ['flirt', 'wink'],\n        aliases: ['wink']\n      },\n      {\n        id: 'thinking',\n        name: 'thinking',\n        unicode: '\ud83e\udd14',\n        category: 'faces',\n        tags: ['think', 'hmm'],\n        aliases: ['thinking', 'hmm']\n      },\n      {\n        id: 'thumbsup',\n        name: 'thumbsup',\n        unicode: '\ud83d\udc4d',\n        category: 'gestures',\n        tags: ['like', 'good'],\n        aliases: ['thumbsup', 'like', 'good']\n      },\n      {\n        id: 'thumbsdown',\n        name: 'thumbsdown',\n        unicode: '\ud83d\udc4e',\n        category: 'gestures',\n        tags: ['dislike', 'bad'],\n        aliases: ['thumbsdown', 'dislike', 'bad']\n      },\n      {\n        id: 'clap',\n        name: 'clap',\n        unicode: '\ud83d\udc4f',\n        category: 'gestures',\n        tags: ['applause', 'good'],\n        aliases: ['clap', 'applause']\n      },\n      {\n        id: 'wave',\n        name: 'wave',\n        unicode: '\ud83d\udc4b',\n        category: 'gestures',\n        tags: ['hello', 'goodbye'],\n        aliases: ['wave', 'hello']\n      },\n\n      // Hearts\n      {\n        id: 'heart',\n        name: 'heart',\n        unicode: '\u2764\ufe0f',\n        category: 'hearts',\n        tags: ['love', 'red'],\n        aliases: ['heart', 'love']\n      },\n      {\n        id: 'blue_heart',\n        name: 'blue_heart',\n        unicode: '\ud83d\udc99',\n        category: 'hearts',\n        tags: ['love', 'blue'],\n        aliases: ['blue_heart']\n      },\n      {\n        id: 'green_heart',\n        name: 'green_heart',\n        unicode: '\ud83d\udc9a',\n        category: 'hearts',\n        tags: ['love', 'green'],\n        aliases: ['green_heart']\n      },\n      {\n        id: 'yellow_heart',\n        name: 'yellow_heart',\n        unicode: '\ud83d\udc9b',\n        category: 'hearts',\n        tags: ['love', 'yellow'],\n        aliases: ['yellow_heart']\n      },\n      {\n        id: 'purple_heart',\n        name: 'purple_heart',\n        unicode: '\ud83d\udc9c',\n        category: 'hearts',\n        tags: ['love', 'purple'],\n        aliases: ['purple_heart']\n      },\n\n      // Objects\n      {\n        id: 'fire',\n        name: 'fire',\n        unicode: '\ud83d\udd25',\n        category: 'objects',\n        tags: ['hot', 'flame'],\n        aliases: ['fire', 'flame']\n      },\n      {\n        id: 'rocket',\n        name: 'rocket',\n        unicode: '\ud83d\ude80',\n        category: 'objects',\n        tags: ['space', 'launch'],\n        aliases: ['rocket', 'launch']\n      },\n      {\n        id: 'star',\n        name: 'star',\n        unicode: '\u2b50',\n        category: 'objects',\n        tags: ['favorite', 'good'],\n        aliases: ['star', 'favorite']\n      },\n      {\n        id: 'trophy',\n        name: 'trophy',\n        unicode: '\ud83c\udfc6',\n        category: 'objects',\n        tags: ['win', 'award'],\n        aliases: ['trophy', 'win']\n      },\n      {\n        id: 'computer',\n        name: 'computer',\n        unicode: '\ud83d\udcbb',\n        category: 'objects',\n        tags: ['tech', 'work'],\n        aliases: ['computer', 'laptop']\n      },\n\n      // Nature\n      {\n        id: 'sun',\n        name: 'sun',\n        unicode: '\u2600\ufe0f',\n        category: 'nature',\n        tags: ['weather', 'bright'],\n        aliases: ['sun', 'sunny']\n      },\n      {\n        id: 'moon',\n        name: 'moon',\n        unicode: '\ud83c\udf19',\n        category: 'nature',\n        tags: ['night', 'crescent'],\n        aliases: ['moon', 'night']\n      },\n      {\n        id: 'tree',\n        name: 'tree',\n        unicode: '\ud83c\udf33',\n        category: 'nature',\n        tags: ['nature', 'green'],\n        aliases: ['tree']\n      },\n      {\n        id: 'flower',\n        name: 'flower',\n        unicode: '\ud83c\udf38',\n        category: 'nature',\n        tags: ['nature', 'pink'],\n        aliases: ['flower', 'blossom']\n      }\n    ];\n\n    for (const emoji of standardEmojis) {\n      this.registerEmoji(emoji);\n    }\n  }\n\n  /**\n   * Register a single emoji with validation\n   */\n  registerEmoji(emoji: EmojiDefinition): void {\n    // Validate emoji name structure\n    if (!this.isValidEmojiName(emoji.name)) {\n      logger.warn(\n        `Invalid emoji name \\\"${emoji.name}\\\" - skipping registration. ` +\n          `Emoji names must start with a letter, contain only letters/numbers/underscores, and be 1-32 characters long.`\n      );\n      return;\n    }\n\n    // Validate emoji ID structure\n    if (!this.isValidEmojiName(emoji.id)) {\n      logger.warn(\n        `Invalid emoji ID \\\"${emoji.id}\\\" - skipping registration. Emoji IDs must follow the same naming rules as names.`\n      );\n      return;\n    }\n\n    // Sanitize image URL if present\n    if (emoji.imageUrl) {\n      emoji.imageUrl = this.sanitizeImageUrl(emoji.imageUrl);\n      if (!emoji.imageUrl) {\n        logger.warn(\n          `Invalid image URL for emoji \\\"${emoji.name}\\\" - skipping registration.`\n        );\n        return;\n      }\n    }\n\n    this.emojis.set(emoji.id, emoji);\n\n    // Register aliases with validation\n    emoji.aliases.forEach((alias) => {\n      if (this.isValidEmojiName(alias)) {\n        this.aliases.set(alias, emoji.id);\n      } else {\n        logger.warn(\n          `Invalid emoji alias \\\"${alias}\\\" for emoji \\\"${emoji.name}\\\" - skipping alias.`\n        );\n      }\n    });\n  }\n\n  /**\n   * Register multiple emojis with validation\n   */\n  registerEmojis(emojis: EmojiDefinition[]): void {\n    emojis.forEach((emoji) => this.registerEmoji(emoji));\n  }\n\n  /**\n   * Validate emoji name structure (same rules as parser)\n   */\n  private isValidEmojiName(name: string): boolean {\n    if (!name || name.length === 0 || name.length > 32) {\n      return false;\n    }\n\n    // Must start with a letter\n    if (!/^[a-zA-Z]/.test(name)) {\n      return false;\n    }\n\n    // Can only contain letters, numbers, and underscores\n    if (!/^[a-zA-Z0-9_]+$/.test(name)) {\n      return false;\n    }\n\n    // Cannot be pure numbers\n    if (/^\\\\d+$/.test(name)) {\n      return false;\n    }\n\n    // Blacklist common URL components\n    const urlComponentBlacklist = [\n      'http',\n      'https',\n      'ftp',\n      'www',\n      'com',\n      'org',\n      'net',\n      'edu',\n      'gov',\n      'localhost',\n      'port',\n      'ssl',\n      'tls',\n      'api',\n      'cdn',\n      'static',\n      '80',\n      '443',\n      '8080',\n      '3000',\n      '5000',\n      '8000',\n      '9000'\n    ];\n\n    if (urlComponentBlacklist.includes(name.toLowerCase())) {\n      return false;\n    }\n\n    // Avoid single character names\n    if (name.length === 1) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Get emoji by ID or alias\n   */\n  getEmoji(idOrAlias: string): EmojiDefinition | undefined {\n    const normalizedName = idOrAlias.toLowerCase();\n\n    // Try direct ID lookup first\n    if (this.emojis.has(normalizedName)) {\n      return this.emojis.get(normalizedName);\n    }\n\n    // Try alias lookup\n    const id = this.aliases.get(normalizedName);\n    if (id) {\n      return this.emojis.get(id);\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Get all registered emojis\n   */\n  getAllEmojis(): EmojiDefinition[] {\n    return Array.from(this.emojis.values());\n  }\n\n  /**\n   * Get emojis by category\n   */\n  getEmojisByCategory(category: string): EmojiDefinition[] {\n    return Array.from(this.emojis.values()).filter(\n      (emoji) => emoji.category === category\n    );\n  }\n\n  /**\n   * Search emojis by tags or name\n   */\n  searchEmojis(query: string): EmojiDefinition[] {\n    const normalizedQuery = query.toLowerCase();\n    return Array.from(this.emojis.values()).filter(\n      (emoji) =>\n        emoji.name.toLowerCase().includes(normalizedQuery) ||\n        emoji.tags.some((tag) => tag.toLowerCase().includes(normalizedQuery)) ||\n        emoji.aliases.some((alias) =>\n          alias.toLowerCase().includes(normalizedQuery)\n        )\n    );\n  }\n\n  /**\n   * Sanitize image URLs for custom emojis\n   */\n  private sanitizeImageUrl(url: string): string {\n    try {\n      const urlObj = new URL(url);\n\n      // Only allow https URLs\n      if (urlObj.protocol !== 'https:') {\n        throw new Error('Only HTTPS URLs are allowed for custom emojis');\n      }\n\n      // Block suspicious domains (you can extend this list)\n      const blockedDomains = ['localhost', '127.0.0.1', '0.0.0.0'];\n      if (blockedDomains.includes(urlObj.hostname)) {\n        throw new Error('Blocked domain for custom emoji');\n      }\n\n      return url;\n    } catch (error) {\n      logger.warn('Invalid custom emoji URL', { url, error });\n      return ''; // Return empty string for invalid URLs\n    }\n  }\n}\n\nexport class EmojiParser {\n  // More structured emoji pattern with stricter rules\n  private static readonly EMOJI_PATTERN =\n    /(?:^|[\\\\s\\\\n\\\\r]|[^\\\\w:])(:[a-zA-Z][a-zA-Z0-9_]{0,31}:)(?=[\\\\s\\\\n\\\\r]|[^\\\\w:]|$)/g;\n  private static readonly SIMPLE_EMOJI_PATTERN =\n    /:([a-zA-Z][a-zA-Z0-9_]{0,31}):/g;\n  private registry: EmojiRegistry;\n\n  constructor() {\n    this.registry = EmojiRegistry.getInstance();\n  }\n\n  /**\n   * Parse text and find emoji tokens with structured validation\n   */\n  parse(text: string): EmojiToken[] {\n    const tokens: EmojiToken[] = [];\n\n    // Use the stricter pattern for better detection\n    const pattern = new RegExp(EmojiParser.EMOJI_PATTERN);\n\n    let match;\n    while ((match = pattern.exec(text)) !== null) {\n      // Extract the emoji name from the capture group\n      const fullMatch = match[1]; // :emoji_name:\n      const emojiName = fullMatch.slice(1, -1); // Remove colons\n\n      // Calculate actual positions accounting for the prefix\n      const prefixLength = match[0].length - fullMatch.length;\n      const matchStart = match.index + prefixLength;\n      const matchEnd = matchStart + fullMatch.length;\n\n      // Validate emoji name structure\n      if (!this.isValidEmojiName(emojiName)) {\n        continue;\n      }\n\n      // Skip if this appears to be part of a URL (additional safety check)\n      if (this.isPartOfURL(text, matchStart, matchEnd)) {\n        continue;\n      }\n\n      // Check if emoji exists in registry\n      const emoji = this.registry.getEmoji(emojiName);\n      if (emoji) {\n        tokens.push({\n          type: 'emoji',\n          id: emoji.id,\n          name: emoji.name,\n          unicode: emoji.unicode,\n          imageUrl: emoji.imageUrl,\n          start: matchStart,\n          end: matchEnd,\n          rawText: fullMatch\n        });\n      }\n    }\n\n    return tokens;\n  }\n\n  /**\n   * Validate emoji name against structured rules\n   */\n  private isValidEmojiName(name: string): boolean {\n    // Emoji name validation rules:\n    // 1. Must start with a letter (not number or special char)\n    // 2. Can contain letters, numbers, and underscores only\n    // 3. Must be 1-32 characters long\n    // 4. Cannot be pure numbers (like port numbers)\n    // 5. Cannot match common URL components\n\n    if (!name || name.length === 0 || name.length > 32) {\n      return false;\n    }\n\n    // Must start with a letter\n    if (!/^[a-zA-Z]/.test(name)) {\n      return false;\n    }\n\n    // Can only contain letters, numbers, and underscores\n    if (!/^[a-zA-Z0-9_]+$/.test(name)) {\n      return false;\n    }\n\n    // Cannot be pure numbers (port numbers, etc.)\n    if (/^\\\\d+$/.test(name)) {\n      return false;\n    }\n\n    // Blacklist common URL components that might appear in colons\n    const urlComponentBlacklist = [\n      'http',\n      'https',\n      'ftp',\n      'www',\n      'com',\n      'org',\n      'net',\n      'edu',\n      'gov',\n      'localhost',\n      'port',\n      'ssl',\n      'tls',\n      'api',\n      'cdn',\n      'static',\n      '80',\n      '443',\n      '8080',\n      '3000',\n      '5000',\n      '8000',\n      '9000'\n    ];\n\n    if (urlComponentBlacklist.includes(name.toLowerCase())) {\n      return false;\n    }\n\n    // Additional check: avoid single character names that could be URL components\n    if (name.length === 1) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Enhanced URL detection with more precise context analysis\n   */\n  private isPartOfURL(text: string, start: number, end: number): boolean {\n    // Expand context for better URL detection\n    const contextRadius = 100;\n    const beforeContext = text.substring(\n      Math.max(0, start - contextRadius),\n      start\n    );\n    const afterContext = text.substring(\n      end,\n      Math.min(text.length, end + contextRadius)\n    );\n\n    // More comprehensive URL patterns\n    const urlPatterns = [\n      /https?:\\\\/\\\\/[^\\\\s]*$/i, // URL prefix\n      /ftp:\\\\/\\\\/[^\\\\s]*$/i, // FTP prefix\n      /www\\\\.[^\\\\s]*$/i, // www prefix\n      /[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}[^\\\\s]*$/i, // Domain pattern\n      /\\\\/\\\\/[^\\\\s]*$/, // Protocol-relative URLs\n      /:\\\\/\\\\/[^\\\\s]*$/ // Any protocol\n    ];\n\n    // Check if we're inside a URL\n    for (const pattern of urlPatterns) {\n      if (pattern.test(beforeContext)) {\n        return true;\n      }\n    }\n\n    // Check for URL continuation patterns after the match\n    const urlContinuationPatterns = [\n      /^[a-zA-Z0-9._~:/?#[\\\\]@!$&'()*+,;=%-]/, // URL characters\n      /^\\\\/[^\\\\s]*/, // Path continuation\n      /^\\\\?[^\\\\s]*/, // Query parameters\n      /^#[^\\\\s]*/ // Fragment\n    ];\n\n    for (const pattern of urlContinuationPatterns) {\n      if (pattern.test(afterContext)) {\n        // Double-check we're actually in a URL context\n        if (this.hasUrlContext(beforeContext)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if the context suggests we're in a URL\n   */\n  private hasUrlContext(context: string): boolean {\n    const urlIndicators = [\n      /https?:\\\\/\\\\//i,\n      /ftp:\\\\/\\\\//i,\n      /www\\\\./i,\n      /[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}/i,\n      /\\\\/\\\\//\n    ];\n\n    return urlIndicators.some((pattern) => pattern.test(context));\n  }\n\n  /**\n   * Fallback method for simple emoji parsing (for backward compatibility)\n   */\n  parseSimple(text: string): EmojiToken[] {\n    const tokens: EmojiToken[] = [];\n    const pattern = new RegExp(EmojiParser.SIMPLE_EMOJI_PATTERN);\n\n    let match;\n    while ((match = pattern.exec(text)) !== null) {\n      const emojiName = match[1];\n\n      if (!this.isValidEmojiName(emojiName)) {\n        continue;\n      }\n\n      const emoji = this.registry.getEmoji(emojiName);\n      if (emoji) {\n        tokens.push({\n          type: 'emoji',\n          id: emoji.id,\n          name: emoji.name,\n          unicode: emoji.unicode,\n          imageUrl: emoji.imageUrl,\n          start: match.index,\n          end: match.index + match[0].length,\n          rawText: match[0]\n        });\n      }\n    }\n\n    return tokens;\n  }\n\n  /**\n   * Replace emoji tokens in text with HTML\n   */\n  replaceEmojisWithHtml(text: string): string {\n    const tokens = this.parse(text);\n    let result = text;\n\n    // Process tokens in reverse order to maintain correct indices\n    for (let i = tokens.length - 1; i >= 0; i--) {\n      const token = tokens[i];\n      let replacement: string;\n\n      if (token.unicode) {\n        // Standard Unicode emoji\n        replacement = `<span class=\\\"emoji emoji--unicode\\\" title=\\\":${token.name}:\\\" data-emoji=\\\"${token.id}\\\">${token.unicode}</span>`;\n      } else if (token.imageUrl) {\n        // Custom emoji with image\n        replacement =\n          `<img class=\\\"emoji emoji--custom\\\" src=\\\"${this.escapeHtml(token.imageUrl)}\\\" ` +\n          `alt=\\\":${token.name}:\\\" title=\\\":${token.name}:\\\" data-emoji=\\\"${token.id}\\\" loading=\\\"lazy\\\" />`;\n      } else {\n        // Fallback - keep original text\n        replacement = token.rawText;\n      }\n\n      result =\n        result.slice(0, token.start) + replacement + result.slice(token.end);\n    }\n\n    return result;\n  }\n\n  /**\n   * Get suggestions for emoji autocomplete\n   */\n  getSuggestions(query: string, limit: number = 10): EmojiDefinition[] {\n    if (!query || query.length < 1) {\n      return [];\n    }\n\n    const results = this.registry.searchEmojis(query);\n    return results.slice(0, limit);\n  }\n\n  /**\n   * Register custom emojis at runtime\n   */\n  addCustomEmoji(emoji: EmojiDefinition): void {\n    this.registry.registerEmoji(emoji);\n  }\n\n  /**\n   * Register multiple custom emojis\n   */\n  addCustomEmojis(emojis: EmojiDefinition[]): void {\n    this.registry.registerEmojis(emojis);\n  }\n\n  /**\n   * Load emojis from database API\n   */\n  async loadEmojisFromAPI(\n    options: {\n      includeCustom?: boolean;\n      category?: string;\n    } = {}\n  ): Promise<void> {\n    try {\n      const params = new URLSearchParams({\n        per_page: '1000', // Load all emojis for parsing\n        ...(options.includeCustom && { include_custom: 'true' }),\n        ...(options.category && { category: options.category })\n      });\n\n      const response = await fetch(`/api/emojis?${params}`);\n      if (!response.ok) {\n        throw new Error('Failed to load emojis from API');\n      }\n\n      const data = await response.json();\n      const apiEmojis: EmojiDefinition[] = data.emojis.map((emoji: any) => ({\n        id: emoji.emoji_id,\n        name: emoji.name,\n        unicode: emoji.unicode_char,\n        imageUrl: emoji.custom_image_url,\n        category: emoji.category.name,\n        tags: emoji.tags || [],\n        aliases: emoji.aliases || []\n      }));\n\n      this.registry.registerEmojis(apiEmojis);\n    } catch (error) {\n      logger.error('Failed to load emojis from API', error as Error);\n      // Continue with built-in emojis if API fails\n    }\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// Export singleton instance for easy use\nexport const emojiParser = new EmojiParser();\nexport const emojiRegistry = EmojiRegistry.getInstance();\n",
    "language":"typescript",
    "lines":796,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/parsers/image-parser.ts":{
    "content":"/**\n * Zero-dependency Image Parser for Secure Image Embeds\n * Supports various image formats with security and performance in mind\n */\n\nexport interface ImageToken {\n  type: 'image';\n  src: string;\n  alt: string;\n  title?: string;\n  width?: number;\n  height?: number;\n  start: number;\n  end: number;\n  rawText: string;\n  format: 'markdown' | 'html' | 'custom';\n}\n\nexport interface ImageConfig {\n  maxWidth?: number;\n  maxHeight?: number;\n  allowedDomains?: string[];\n  allowedExtensions?: string[];\n  lazyLoading?: boolean;\n  placeholder?: string;\n}\n\nexport class ImageParser {\n  private config: Required<ImageConfig>;\n\n  // Supported image formats\n  private static readonly DEFAULT_EXTENSIONS = [\n    'jpg',\n    'jpeg',\n    'png',\n    'gif',\n    'webp',\n    'svg',\n    'bmp',\n    'ico'\n  ];\n\n  // Common CDN domains that are generally safe\n  private static readonly DEFAULT_ALLOWED_DOMAINS = [\n    'imgur.com',\n    'i.imgur.com',\n    'github.com',\n    'raw.githubusercontent.com',\n    'cdn.jsdelivr.net',\n    'unpkg.com',\n    'picsum.photos',\n    'via.placeholder.com',\n    'placehold.co',\n    'images.unsplash.com',\n    'source.unsplash.com'\n  ];\n\n  // Patterns for different image embed formats\n  private static readonly PATTERNS = {\n    // Markdown: ![alt text](url \\\"optional title\\\")\n    markdown: /!\\\\[([^\\\\]]*)\\\\]\\\\(([^)]+?)(?:\\\\s+\\\"([^\\\"]*)\\\")?\\\\)/g,\n    // HTML: <img src=\\\"url\\\" alt=\\\"alt\\\" title=\\\"title\\\" />\n    html: /<img\\\\s+[^>]*src\\\\s*=\\\\s*[\\\"']([^\\\"']+)[\\\"'][^>]*>/gi,\n    // Custom format: {img:url|alt|title|width|height}\n    custom: /\\\\{img:([^|]+)(?:\\\\|([^|]*))(?:\\\\|([^|]*))(?:\\\\|(\\\\d+))(?:\\\\|(\\\\d+))?\\\\}/g\n  };\n\n  constructor(config: ImageConfig = {}) {\n    this.config = {\n      maxWidth: config.maxWidth || 800,\n      maxHeight: config.maxHeight || 600,\n      allowedDomains:\n        config.allowedDomains || ImageParser.DEFAULT_ALLOWED_DOMAINS,\n      allowedExtensions:\n        config.allowedExtensions || ImageParser.DEFAULT_EXTENSIONS,\n      lazyLoading: config.lazyLoading !== false, // Default to true\n      placeholder: config.placeholder || ''\n    };\n  }\n\n  /**\n   * Parse text and find image tokens\n   */\n  parse(text: string): ImageToken[] {\n    const tokens: ImageToken[] = [];\n\n    // Parse markdown images\n    tokens.push(...this.parseMarkdownImages(text));\n\n    // Parse HTML images (if not overlapping with markdown)\n    tokens.push(...this.parseHtmlImages(text, tokens));\n\n    // Parse custom format images (if not overlapping)\n    tokens.push(...this.parseCustomImages(text, tokens));\n\n    // Sort by position and remove overlaps\n    return this.removeDuplicates(tokens.sort((a, b) => a.start - b.start));\n  }\n\n  /**\n   * Parse markdown format images: ![alt](url \\\"title\\\")\n   */\n  private parseMarkdownImages(text: string): ImageToken[] {\n    const tokens: ImageToken[] = [];\n    const pattern = new RegExp(ImageParser.PATTERNS.markdown);\n\n    let match;\n    while ((match = pattern.exec(text)) !== null) {\n      const [fullMatch, alt, url, title] = match;\n\n      if (this.isValidImageUrl(url)) {\n        tokens.push({\n          type: 'image',\n          src: this.sanitizeUrl(url),\n          alt: alt || 'Image',\n          title: title || undefined,\n          start: match.index,\n          end: match.index + fullMatch.length,\n          rawText: fullMatch,\n          format: 'markdown'\n        });\n      }\n    }\n\n    return tokens;\n  }\n\n  /**\n   * Parse HTML img tags\n   */\n  private parseHtmlImages(\n    text: string,\n    existingTokens: ImageToken[]\n  ): ImageToken[] {\n    const tokens: ImageToken[] = [];\n    const pattern = new RegExp(ImageParser.PATTERNS.html);\n\n    let match;\n    while ((match = pattern.exec(text)) !== null) {\n      const fullMatch = match[0];\n      const src = match[1];\n\n      // Skip if overlaps with existing tokens\n      if (\n        this.hasOverlap(\n          match.index,\n          match.index + fullMatch.length,\n          existingTokens\n        )\n      ) {\n        continue;\n      }\n\n      if (this.isValidImageUrl(src)) {\n        // Extract other attributes\n        const alt = this.extractAttribute(fullMatch, 'alt') || 'Image';\n        const title = this.extractAttribute(fullMatch, 'title');\n        const width = this.extractAttribute(fullMatch, 'width');\n        const height = this.extractAttribute(fullMatch, 'height');\n\n        tokens.push({\n          type: 'image',\n          src: this.sanitizeUrl(src),\n          alt,\n          title: title || undefined,\n          width: width ? parseInt(width, 10) : undefined,\n          height: height ? parseInt(height, 10) : undefined,\n          start: match.index,\n          end: match.index + fullMatch.length,\n          rawText: fullMatch,\n          format: 'html'\n        });\n      }\n    }\n\n    return tokens;\n  }\n\n  /**\n   * Parse custom format: {img:url|alt|title|width|height}\n   */\n  private parseCustomImages(\n    text: string,\n    existingTokens: ImageToken[]\n  ): ImageToken[] {\n    const tokens: ImageToken[] = [];\n    const pattern = new RegExp(ImageParser.PATTERNS.custom);\n\n    let match;\n    while ((match = pattern.exec(text)) !== null) {\n      const [fullMatch, url, alt, title, width, height] = match;\n\n      // Skip if overlaps with existing tokens\n      if (\n        this.hasOverlap(\n          match.index,\n          match.index + fullMatch.length,\n          existingTokens\n        )\n      ) {\n        continue;\n      }\n\n      if (this.isValidImageUrl(url)) {\n        tokens.push({\n          type: 'image',\n          src: this.sanitizeUrl(url),\n          alt: alt || 'Image',\n          title: title || undefined,\n          width: width ? parseInt(width, 10) : undefined,\n          height: height ? parseInt(height, 10) : undefined,\n          start: match.index,\n          end: match.index + fullMatch.length,\n          rawText: fullMatch,\n          format: 'custom'\n        });\n      }\n    }\n\n    return tokens;\n  }\n\n  /**\n   * Check if URL is a valid image\n   */\n  private isValidImageUrl(url: string): boolean {\n    try {\n      const urlObj = new URL(url, window.location.href);\n\n      // Check if domain is allowed\n      if (this.config.allowedDomains.length > 0) {\n        const isAllowedDomain = this.config.allowedDomains.some(\n          (domain) =>\n            urlObj.hostname === domain || urlObj.hostname.endsWith(`.${domain}`)\n        );\n\n        if (!isAllowedDomain) {\n          console.warn('Image domain not allowed:', urlObj.hostname);\n          return false;\n        }\n      }\n\n      // Check file extension\n      const pathname = urlObj.pathname.toLowerCase();\n      const hasValidExtension = this.config.allowedExtensions.some((ext) =>\n        pathname.endsWith(`.${ext}`)\n      );\n\n      if (!hasValidExtension) {\n        console.warn('Image extension not allowed:', pathname);\n        return false;\n      }\n\n      return true;\n    } catch (error) {\n      console.warn('Invalid image URL:', url, error);\n      return false;\n    }\n  }\n\n  /**\n   * Sanitize and normalize URL\n   */\n  private sanitizeUrl(url: string): string {\n    try {\n      const urlObj = new URL(url, window.location.href);\n\n      // Ensure HTTPS for external URLs\n      if (\n        urlObj.hostname !== window.location.hostname &&\n        urlObj.protocol === 'http:'\n      ) {\n        urlObj.protocol = 'https:';\n      }\n\n      return urlObj.toString();\n    } catch (error) {\n      console.warn('Failed to sanitize URL:', url, error);\n      return '';\n    }\n  }\n\n  /**\n   * Extract attribute from HTML string\n   */\n  private extractAttribute(html: string, attrName: string): string | null {\n    const regex = new RegExp(`${attrName}\\\\\\\\s*=\\\\\\\\s*[\\\"']([^\\\"']*)[\\\"']`, 'i');\n    const match = html.match(regex);\n    return match ? match[1] : null;\n  }\n\n  /**\n   * Check if ranges overlap\n   */\n  private hasOverlap(\n    start: number,\n    end: number,\n    tokens: ImageToken[]\n  ): boolean {\n    return tokens.some(\n      (token) =>\n        (start >= token.start && start < token.end) ||\n        (end > token.start && end <= token.end) ||\n        (start <= token.start && end >= token.end)\n    );\n  }\n\n  /**\n   * Remove duplicate/overlapping tokens\n   */\n  private removeDuplicates(tokens: ImageToken[]): ImageToken[] {\n    const result: ImageToken[] = [];\n\n    for (const token of tokens) {\n      const hasOverlap = result.some((existing) =>\n        this.hasOverlap(token.start, token.end, [existing])\n      );\n\n      if (!hasOverlap) {\n        result.push(token);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Convert image tokens to HTML\n   */\n  tokensToHtml(tokens: ImageToken[]): string {\n    return tokens.map((token) => this.tokenToHtml(token)).join('');\n  }\n\n  /**\n   * Convert single image token to HTML\n   */\n  tokenToHtml(token: ImageToken): string {\n    const attributes: string[] = [\n      `src=\\\"${this.escapeHtml(token.src)}\\\"`,\n      `alt=\\\"${this.escapeHtml(token.alt)}\\\"`,\n      'class=\\\"embedded-image\\\"'\n    ];\n\n    if (token.title) {\n      attributes.push(`title=\\\"${this.escapeHtml(token.title)}\\\"`);\n    }\n\n    // Apply size constraints\n    const width = token.width\n      ? Math.min(token.width, this.config.maxWidth)\n      : this.config.maxWidth;\n    const height = token.height\n      ? Math.min(token.height, this.config.maxHeight)\n      : undefined;\n\n    attributes.push(`style=\\\"max-width: ${width}px; height: auto;\\\"`);\n\n    if (height) {\n      attributes.push(`style=\\\"max-height: ${height}px;\\\"`);\n    }\n\n    if (this.config.lazyLoading) {\n      attributes.push('loading=\\\"lazy\\\"');\n    }\n\n    return `<img ${attributes.join(' ')} />`;\n  }\n\n  /**\n   * Replace image tokens in text with HTML\n   */\n  replaceImagesWithHtml(text: string): string {\n    const tokens = this.parse(text);\n    let result = text;\n\n    // Process tokens in reverse order to maintain correct indices\n    for (let i = tokens.length - 1; i >= 0; i--) {\n      const token = tokens[i];\n      const replacement = this.tokenToHtml(token);\n      result =\n        result.slice(0, token.start) + replacement + result.slice(token.end);\n    }\n\n    return result;\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(newConfig: Partial<ImageConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// Export singleton instance with default config\nexport const imageParser = new ImageParser();\n",
    "language":"typescript",
    "lines":406,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/parsers/markdown-parser.ts":{
    "content":"/**\n * Zero-dependency Markdown Parser\n * Handles common markdown syntax with security in mind\n */\n\nexport interface MarkdownToken {\n  type:\n    | 'text'\n    | 'bold'\n    | 'italic'\n    | 'code'\n    | 'link'\n    | 'strikethrough'\n    | 'underline'\n    | 'blockquote'\n    | 'list-item';\n  content: string;\n  href?: string; // For links\n  start: number;\n  end: number;\n}\n\nexport class MarkdownParser {\n  private static readonly PATTERNS = {\n    // Bold: **text** or __text__\n    bold: /(\\\\*\\\\*|__)((?:(?!\\\\1)[^*_])+)\\\\1/g,\n    // Italic: *text* or _text_ (but not if surrounded by word chars to avoid conflicts)\n    italic: /(?<!\\\\w)(\\\\*|_)((?:(?!\\\\1)[^*_])+)\\\\1(?!\\\\w)/g,\n    // Code: `code`\n    code: /`([^`]+)`/g,\n    // Strikethrough: ~~text~~\n    strikethrough: /~~([^~]+)~~/g,\n    // Underline: __text__ (alternative interpretation)\n    underline: /<u>(.*?)<\\\\/u>/g,\n    // Links: [text](url) or [text](url \\\"title\\\")\n    link: /\\\\[([^\\\\]]+)\\\\]\\\\(([^)]+)(?:\\\\s+\\\"([^\\\"]*)\\\")?\\\\)/g,\n    // Blockquote: > text\n    blockquote: /^>\\\\s*(.+)$/gm,\n    // List items: - item or * item or + item\n    listItem: /^[\\\\s]*[-*+]\\\\s+(.+)$/gm\n  };\n\n  /**\n   * Parse markdown text into tokens with precedence handling\n   */\n  static parse(text: string): MarkdownToken[] {\n    const tokens: MarkdownToken[] = [];\n    const processedRanges: Array<{ start: number; end: number }> = [];\n\n    // Process in order of precedence (code first to avoid conflicts)\n    const parseOrder = [\n      'code',\n      'link',\n      'bold',\n      'italic',\n      'strikethrough',\n      'underline',\n      'blockquote',\n      'listItem'\n    ] as const;\n\n    for (const patternName of parseOrder) {\n      const pattern = this.PATTERNS[patternName];\n      pattern.lastIndex = 0; // Reset regex\n\n      let match;\n      while ((match = pattern.exec(text)) !== null) {\n        const start = match.index;\n        const end = match.index + match[0].length;\n\n        // Skip if this range overlaps with already processed content\n        if (this.hasOverlap(start, end, processedRanges)) {\n          continue;\n        }\n\n        let token: MarkdownToken;\n\n        switch (patternName) {\n          case 'code':\n            token = {\n              type: 'code',\n              content: match[1],\n              start,\n              end\n            };\n            break;\n          case 'link':\n            token = {\n              type: 'link',\n              content: match[1], // Link text\n              href: this.sanitizeUrl(match[2]), // URL\n              start,\n              end\n            };\n            break;\n          case 'bold':\n            token = {\n              type: 'bold',\n              content: match[2],\n              start,\n              end\n            };\n            break;\n          case 'italic':\n            token = {\n              type: 'italic',\n              content: match[2],\n              start,\n              end\n            };\n            break;\n          case 'strikethrough':\n            token = {\n              type: 'strikethrough',\n              content: match[1],\n              start,\n              end\n            };\n            break;\n          case 'underline':\n            token = {\n              type: 'underline',\n              content: match[1],\n              start,\n              end\n            };\n            break;\n          case 'blockquote':\n            token = {\n              type: 'blockquote',\n              content: match[1],\n              start,\n              end\n            };\n            break;\n          case 'listItem':\n            token = {\n              type: 'list-item',\n              content: match[1],\n              start,\n              end\n            };\n            break;\n          default:\n            continue;\n        }\n\n        tokens.push(token);\n        processedRanges.push({ start, end });\n      }\n    }\n\n    // Add text tokens for unprocessed content\n    this.addTextTokens(text, tokens, processedRanges);\n\n    // Sort tokens by position\n    return tokens.sort((a, b) => a.start - b.start);\n  }\n\n  /**\n   * Check if two ranges overlap\n   */\n  private static hasOverlap(\n    start: number,\n    end: number,\n    ranges: Array<{ start: number; end: number }>\n  ): boolean {\n    return ranges.some(\n      (range) =>\n        (start >= range.start && start < range.end) ||\n        (end > range.start && end <= range.end) ||\n        (start <= range.start && end >= range.end)\n    );\n  }\n\n  /**\n   * Add text tokens for content that wasn't processed by other patterns\n   */\n  private static addTextTokens(\n    text: string,\n    tokens: MarkdownToken[],\n    processedRanges: Array<{ start: number; end: number }>\n  ): void {\n    // Sort processed ranges by start position\n    const sortedRanges = [...processedRanges].sort((a, b) => a.start - b.start);\n\n    let currentIndex = 0;\n\n    for (const range of sortedRanges) {\n      // Add text before this range\n      if (currentIndex < range.start) {\n        const textContent = text.slice(currentIndex, range.start);\n        if (textContent.trim()) {\n          tokens.push({\n            type: 'text',\n            content: textContent,\n            start: currentIndex,\n            end: range.start\n          });\n        }\n      }\n      currentIndex = range.end;\n    }\n\n    // Add remaining text\n    if (currentIndex < text.length) {\n      const textContent = text.slice(currentIndex);\n      if (textContent.trim()) {\n        tokens.push({\n          type: 'text',\n          content: textContent,\n          start: currentIndex,\n          end: text.length\n        });\n      }\n    }\n  }\n\n  /**\n   * Sanitize URLs to prevent XSS\n   */\n  private static sanitizeUrl(url: string): string {\n    // Remove any potential javascript: or data: schemes\n    const trimmed = url.trim();\n\n    // Allow only http, https, mailto, and relative URLs\n    const allowedProtocols = /^(https?:\\\\/\\\\/|mailto:|\\\\/|\\\\.\\\\/|\\\\.\\\\.\\\\/)/i;\n\n    if (!allowedProtocols.test(trimmed)) {\n      // If no protocol, assume https\n      return `https://${trimmed}`;\n    }\n\n    // Block dangerous protocols\n    const dangerousProtocols = /^(javascript:|data:|vbscript:|file:)/i;\n    if (dangerousProtocols.test(trimmed)) {\n      return '#'; // Safe fallback\n    }\n\n    return trimmed;\n  }\n\n  /**\n   * Convert tokens back to HTML (for rendering)\n   */\n  static tokensToHtml(tokens: MarkdownToken[]): string {\n    return tokens\n      .map((token) => {\n        switch (token.type) {\n          case 'bold':\n            return `<strong>${this.escapeHtml(token.content)}</strong>`;\n          case 'italic':\n            return `<em>${this.escapeHtml(token.content)}</em>`;\n          case 'code':\n            return `<code>${this.escapeHtml(token.content)}</code>`;\n          case 'link':\n            return `<a href=\\\"${this.escapeHtml(token.href || '#')}\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\">${this.escapeHtml(token.content)}</a>`;\n          case 'strikethrough':\n            return `<del>${this.escapeHtml(token.content)}</del>`;\n          case 'underline':\n            return `<u>${this.escapeHtml(token.content)}</u>`;\n          case 'blockquote':\n            return `<blockquote>${this.escapeHtml(token.content)}</blockquote>`;\n          case 'list-item':\n            return `<li>${this.escapeHtml(token.content)}</li>`;\n          case 'text':\n          default:\n            return this.escapeHtml(token.content);\n        }\n      })\n      .join('');\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   */\n  private static escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n",
    "language":"typescript",
    "lines":283,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/utils/parsers/rich-text-parser.ts":{
    "content":"/**\n * Zero-dependency Rich Text Parser\n * Combines markdown, emoji, and image parsing with existing content parsers\n */\n\nimport { ContentParser } from '../content-parsers';\nimport { EmojiParser } from './emoji-parser';\nimport { ImageParser } from './image-parser';\nimport { MarkdownParser, MarkdownToken } from './markdown-parser';\n\nexport type RichTextTokenType =\n  | 'text'\n  | 'hashtag'\n  | 'mention'\n  | 'url'\n  | 'markdown'\n  | 'emoji'\n  | 'image';\n\nexport interface RichTextToken {\n  type: RichTextTokenType;\n  content: string;\n  start: number;\n  end: number;\n  rawText: string;\n\n  // Type-specific data\n  markdownType?: MarkdownToken['type'];\n  href?: string; // For links\n  emojiId?: string;\n  emojiUnicode?: string;\n  emojiImageUrl?: string;\n  imageAlt?: string;\n  imageTitle?: string;\n  imageSrc?: string;\n  userId?: string; // For mentions\n  displayName?: string; // For mentions\n  filterType?: 'author' | 'mentions'; // For mentions\n  behavior?: string; // For URL pills\n}\n\nexport interface RichTextConfig {\n  enableMarkdown?: boolean;\n  enableEmojis?: boolean;\n  enableImages?: boolean;\n  enableHashtags?: boolean;\n  enableMentions?: boolean;\n  enableUrls?: boolean;\n  imageConfig?: {\n    maxWidth?: number;\n    maxHeight?: number;\n    allowedDomains?: string[];\n  };\n}\n\nexport class RichTextParser {\n  private emojiParser: EmojiParser;\n  private imageParser: ImageParser;\n  private config: Required<RichTextConfig>;\n\n  constructor(config: RichTextConfig = {}) {\n    this.config = {\n      enableMarkdown: config.enableMarkdown !== false,\n      enableEmojis: config.enableEmojis !== false,\n      enableImages: config.enableImages !== false,\n      enableHashtags: config.enableHashtags !== false,\n      enableMentions: config.enableMentions !== false,\n      enableUrls: config.enableUrls !== false,\n      imageConfig: config.imageConfig || {}\n    };\n\n    // MarkdownParser is a static class\n    this.emojiParser = new EmojiParser();\n    this.imageParser = new ImageParser(this.config.imageConfig);\n  }\n\n  /**\n   * Parse text with all enabled parsers\n   */\n  parse(text: string): RichTextToken[] {\n    const tokens: RichTextToken[] = [];\n    const processedRanges: Array<{ start: number; end: number }> = [];\n\n    // Parse in order of precedence:\n    // 1. Images (highest priority - avoid conflicts with markdown links)\n    // 2. Existing content parsers (hashtags, mentions, URLs)\n    // 3. Markdown (after URLs to avoid conflicts)\n    // 4. Emojis (lowest priority - fill remaining text)\n\n    // 1. Parse images first\n    if (this.config.enableImages) {\n      const imageTokens = this.imageParser.parse(text);\n      for (const imageToken of imageTokens) {\n        tokens.push({\n          type: 'image',\n          content: imageToken.alt,\n          start: imageToken.start,\n          end: imageToken.end,\n          rawText: imageToken.rawText,\n          imageSrc: imageToken.src,\n          imageAlt: imageToken.alt,\n          imageTitle: imageToken.title\n        });\n        processedRanges.push({ start: imageToken.start, end: imageToken.end });\n      }\n    }\n\n    // 2. Parse existing content types (hashtags, mentions, URLs)\n    if (\n      this.config.enableHashtags ||\n      this.config.enableMentions ||\n      this.config.enableUrls\n    ) {\n      const contentSegments = ContentParser.parse(text);\n      for (const segment of contentSegments) {\n        if (segment.type === 'text') continue;\n\n        // Skip if overlaps with already processed content\n        if (\n          this.hasOverlap(segment.start || 0, segment.end || 0, processedRanges)\n        ) {\n          continue;\n        }\n\n        let shouldInclude = false;\n        if (segment.type === 'hashtag' && this.config.enableHashtags)\n          shouldInclude = true;\n        if (segment.type === 'mention' && this.config.enableMentions)\n          shouldInclude = true;\n        if (segment.type === 'url' && this.config.enableUrls)\n          shouldInclude = true;\n\n        if (shouldInclude) {\n          tokens.push({\n            type: segment.type as RichTextTokenType,\n            content: segment.value,\n            start: segment.start || 0,\n            end: segment.end || 0,\n            rawText: segment.rawFormat || segment.value,\n            userId: segment.userId,\n            displayName: segment.displayName,\n            filterType: segment.filterType,\n            behavior: segment.behavior,\n            href: segment.type === 'url' ? segment.value : undefined\n          });\n          processedRanges.push({\n            start: segment.start || 0,\n            end: segment.end || 0\n          });\n        }\n      }\n    }\n\n    // 3. Parse markdown in remaining text\n    if (this.config.enableMarkdown) {\n      const remainingText = this.extractUnprocessedText(text, processedRanges);\n      for (const textSegment of remainingText) {\n        const markdownTokens = MarkdownParser.parse(textSegment.text);\n        for (const mdToken of markdownTokens) {\n          if (mdToken.type === 'text') continue;\n\n          const absoluteStart = textSegment.offset + mdToken.start;\n          const absoluteEnd = textSegment.offset + mdToken.end;\n\n          tokens.push({\n            type: 'markdown',\n            content: mdToken.content,\n            start: absoluteStart,\n            end: absoluteEnd,\n            rawText: text.slice(absoluteStart, absoluteEnd),\n            markdownType: mdToken.type,\n            href: mdToken.href\n          });\n          processedRanges.push({ start: absoluteStart, end: absoluteEnd });\n        }\n      }\n    }\n\n    // 4. Parse emojis in remaining text\n    if (this.config.enableEmojis) {\n      const remainingText = this.extractUnprocessedText(text, processedRanges);\n      for (const textSegment of remainingText) {\n        const emojiTokens = this.emojiParser.parse(textSegment.text);\n        for (const emojiToken of emojiTokens) {\n          const absoluteStart = textSegment.offset + emojiToken.start;\n          const absoluteEnd = textSegment.offset + emojiToken.end;\n\n          tokens.push({\n            type: 'emoji',\n            content: emojiToken.name,\n            start: absoluteStart,\n            end: absoluteEnd,\n            rawText: emojiToken.rawText,\n            emojiId: emojiToken.id,\n            emojiUnicode: emojiToken.unicode,\n            emojiImageUrl: emojiToken.imageUrl\n          });\n          processedRanges.push({ start: absoluteStart, end: absoluteEnd });\n        }\n      }\n    }\n\n    // 5. Add text tokens for unprocessed content\n    this.addTextTokens(text, tokens, processedRanges);\n\n    // Sort tokens by position\n    return tokens.sort((a, b) => a.start - b.start);\n  }\n\n  /**\n   * Convert rich text tokens to HTML\n   */\n  tokensToHtml(tokens: RichTextToken[]): string {\n    return tokens.map((token) => this.tokenToHtml(token)).join('');\n  }\n\n  /**\n   * Convert single token to HTML\n   */\n  private tokenToHtml(token: RichTextToken): string {\n    switch (token.type) {\n      case 'text': {\n        // Handle newlines in text content by converting them to <br /> tags\n        const escapedContent = this.escapeHtml(token.content);\n        return escapedContent.replace(/\\\\n/g, '<br />');\n      }\n\n      case 'hashtag':\n        return `<span class=\\\"content-pill content-pill--hashtag\\\">#${this.escapeHtml(token.content)}</span>`;\n\n      case 'mention':\n        return `<span class=\\\"content-pill content-pill--mention\\\">@${this.escapeHtml(token.content)}</span>`;\n\n      case 'url':\n        if (token.behavior === 'embed') {\n          return `<div class=\\\"url-embed\\\" data-url=\\\"${this.escapeHtml(token.href || '')}\\\">${this.escapeHtml(token.content)}</div>`;\n        }\n        return `<a href=\\\"${this.escapeHtml(token.href || '#')}\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\">${this.escapeHtml(token.content)}</a>`;\n\n      case 'markdown':\n        return this.markdownTokenToHtml(token);\n\n      case 'emoji':\n        if (token.emojiUnicode) {\n          return `<span class=\\\"emoji emoji--unicode\\\" title=\\\":${token.content}:\\\">${token.emojiUnicode}</span>`;\n        } else if (token.emojiImageUrl) {\n          return (\n            `<img class=\\\"emoji emoji--custom\\\" src=\\\"${this.escapeHtml(token.emojiImageUrl)}\\\" ` +\n            `alt=\\\":${token.content}:\\\" title=\\\":${token.content}:\\\" loading=\\\"lazy\\\" />`\n          );\n        }\n        return this.escapeHtml(token.rawText);\n\n      case 'image':\n        return (\n          `<img class=\\\"embedded-image\\\" src=\\\"${this.escapeHtml(token.imageSrc || '')}\\\" ` +\n          `alt=\\\"${this.escapeHtml(token.imageAlt || 'Image')}\\\" ` +\n          `${token.imageTitle ? `title=\\\"${this.escapeHtml(token.imageTitle)}\\\"` : ''} loading=\\\"lazy\\\" />`\n        );\n\n      default:\n        return this.escapeHtml(token.content);\n    }\n  }\n\n  /**\n   * Convert markdown token to HTML\n   */\n  private markdownTokenToHtml(token: RichTextToken): string {\n    switch (token.markdownType) {\n      case 'bold':\n        return `<strong>${this.escapeHtml(token.content)}</strong>`;\n      case 'italic':\n        return `<em>${this.escapeHtml(token.content)}</em>`;\n      case 'code':\n        return `<code>${this.escapeHtml(token.content)}</code>`;\n      case 'link':\n        return `<a href=\\\"${this.escapeHtml(token.href || '#')}\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\">${this.escapeHtml(token.content)}</a>`;\n      case 'strikethrough':\n        return `<del>${this.escapeHtml(token.content)}</del>`;\n      case 'underline':\n        return `<u>${this.escapeHtml(token.content)}</u>`;\n      case 'blockquote':\n        return `<blockquote>${this.escapeHtml(token.content)}</blockquote>`;\n      case 'list-item':\n        return `<li>${this.escapeHtml(token.content)}</li>`;\n      default:\n        return this.escapeHtml(token.content);\n    }\n  }\n\n  /**\n   * Replace rich text in string with HTML\n   */\n  replaceWithHtml(text: string): string {\n    const tokens = this.parse(text);\n    let result = text;\n\n    // Process tokens in reverse order to maintain correct indices\n    for (let i = tokens.length - 1; i >= 0; i--) {\n      const token = tokens[i];\n      const replacement = this.tokenToHtml(token);\n      result =\n        result.slice(0, token.start) + replacement + result.slice(token.end);\n    }\n\n    return result;\n  }\n\n  /**\n   * Extract unprocessed text segments\n   */\n  private extractUnprocessedText(\n    text: string,\n    processedRanges: Array<{ start: number; end: number }>\n  ): Array<{ text: string; offset: number }> {\n    const segments: Array<{ text: string; offset: number }> = [];\n    const sortedRanges = [...processedRanges].sort((a, b) => a.start - b.start);\n\n    let currentIndex = 0;\n\n    for (const range of sortedRanges) {\n      if (currentIndex < range.start) {\n        const segmentText = text.slice(currentIndex, range.start);\n        if (segmentText.trim()) {\n          segments.push({ text: segmentText, offset: currentIndex });\n        }\n      }\n      currentIndex = range.end;\n    }\n\n    // Add remaining text\n    if (currentIndex < text.length) {\n      const segmentText = text.slice(currentIndex);\n      if (segmentText.trim()) {\n        segments.push({ text: segmentText, offset: currentIndex });\n      }\n    }\n\n    return segments;\n  }\n\n  /**\n   * Check if ranges overlap\n   */\n  private hasOverlap(\n    start: number,\n    end: number,\n    ranges: Array<{ start: number; end: number }>\n  ): boolean {\n    return ranges.some(\n      (range) =>\n        (start >= range.start && start < range.end) ||\n        (end > range.start && end <= range.end) ||\n        (start <= range.start && end >= range.end)\n    );\n  }\n\n  /**\n   * Add text tokens for unprocessed content\n   */\n  private addTextTokens(\n    text: string,\n    tokens: RichTextToken[],\n    processedRanges: Array<{ start: number; end: number }>\n  ): void {\n    const textSegments = this.extractUnprocessedText(text, processedRanges);\n\n    for (const segment of textSegments) {\n      tokens.push({\n        type: 'text',\n        content: segment.text,\n        start: segment.offset,\n        end: segment.offset + segment.text.length,\n        rawText: segment.text\n      });\n    }\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(newConfig: Partial<RichTextConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n\n    if (newConfig.imageConfig) {\n      this.imageParser.updateConfig(newConfig.imageConfig);\n    }\n  }\n\n  /**\n   * Add custom emoji\n   */\n  addCustomEmoji(emoji: {\n    id: string;\n    name: string;\n    imageUrl: string;\n    category: string;\n    tags: string[];\n    aliases: string[];\n  }): void {\n    this.emojiParser.addCustomEmoji(emoji);\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n}\n\n// Export singleton instance with default config\nexport const richTextParser = new RichTextParser();\n",
    "language":"typescript",
    "lines":417,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/hooks/useNavigationLoader.ts":{
    "content":"'use client';\n\nimport { useNavigationLoading } from '../context/NavigationLoadingContext';\n\nexport function useNavigationLoader() {\n  return useNavigationLoading();\n}\n",
    "language":"typescript",
    "lines":8,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/logging/factories.ts":{
    "content":"/**\n * Factory functions for creating different types of loggers\n */\n\nimport { ClientLogger } from './adapters/ClientLogger';\nimport { DebugLogger } from './adapters/DebugLogger';\nimport { ServerLogger } from './adapters/ServerLogger';\nimport { Logger } from './core/Logger';\nimport type { LoggerConfig, LoggerInstance } from './types';\n\n/**\n * Create a generic logger instance\n */\nexport function createLogger(config?: Partial<LoggerConfig>): LoggerInstance {\n  return new Logger(config);\n}\n\n/**\n * Create a server-specific logger instance\n */\nexport function createServerLogger(\n  config?: Partial<LoggerConfig>\n): ServerLogger {\n  return new ServerLogger(config);\n}\n\n/**\n * Create a client-specific logger instance\n */\nexport function createClientLogger(\n  config?: Partial<LoggerConfig>\n): ClientLogger {\n  return new ClientLogger(config);\n}\n\n/**\n * Create a debug logger instance for development\n */\nexport function createDebugLogger(config?: Partial<LoggerConfig>): DebugLogger {\n  return new DebugLogger(config);\n}\n\n/**\n * Create a logger instance with component context\n */\nexport function createComponentLogger(\n  component: string,\n  config?: Partial<LoggerConfig>\n): LoggerInstance {\n  return createLogger({\n    ...config,\n    context: {\n      ...config?.context,\n      component\n    }\n  });\n}\n\n/**\n * Create a logger instance with module context\n */\nexport function createModuleLogger(\n  module: string,\n  config?: Partial<LoggerConfig>\n): LoggerInstance {\n  return createLogger({\n    ...config,\n    context: {\n      module,\n      ...config?.context\n    }\n  });\n}\n\n/**\n * Create a logger instance with function context\n */\nexport function createFunctionLogger(\n  functionName: string,\n  config?: Partial<LoggerConfig>\n): LoggerInstance {\n  return createLogger({\n    ...config,\n    context: {\n      function: functionName,\n      ...config?.context\n    }\n  });\n}\n\n/**\n * Create a logger instance with category context\n */\nexport function createCategoryLogger(\n  category: string,\n  config?: Partial<LoggerConfig>\n): LoggerInstance {\n  return createLogger({\n    ...config,\n    context: {\n      category,\n      ...config?.context\n    }\n  });\n}\n",
    "language":"typescript",
    "lines":106,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/logging/types.ts":{
    "content":"/**\n * Type definitions for the consolidated logging system\n */\n\nexport type LogLevel = 'DEBUG' | 'INFO' | 'WARN' | 'ERROR' | 'TRACE' | 'PERF';\n\nexport type Environment = 'development' | 'production' | 'test';\n\nexport type Context = 'client' | 'server' | 'universal';\n\nexport interface LogEntry {\n  level: LogLevel;\n  message: string;\n  data?: StructuredData;\n  timestamp: string;\n  context: LogContext;\n  error?: Error | ErrorLike;\n  duration?: number;\n  metadata?: Record<string, any>;\n}\n\nexport interface LogContext {\n  environment?: Environment;\n  context?: Context;\n  component?: string;\n  module?: string;\n  function?: string;\n  userId?: string;\n  sessionId?: string;\n  requestId?: string;\n  category?: string;\n}\n\nexport interface StructuredData {\n  [key: string]: any;\n}\n\nexport interface ErrorLike {\n  name: string;\n  message: string;\n  stack?: string;\n  cause?: any;\n}\n\nexport interface PerformanceMetrics {\n  operation: string;\n  duration: number;\n  threshold?: number;\n  metadata?: StructuredData;\n}\n\nexport interface LoggerConfig {\n  enabled: boolean;\n  level: LogLevel;\n  context: LogContext;\n  formatters: LogFormatter[];\n  transports: LogTransport[];\n  grouping: GroupingConfig;\n  performance: PerformanceConfig;\n}\n\nexport interface GroupingConfig {\n  enabled: boolean;\n  autoGroup: boolean;\n  groupThreshold: number; // Number of logs before auto-grouping\n  collapseGroups: boolean;\n}\n\nexport interface PerformanceConfig {\n  enabled: boolean;\n  slowThreshold: number; // ms\n  trackOperations: boolean;\n  trackQueries: boolean;\n}\n\nexport interface LogFormatter {\n  name: string;\n  format: (entry: LogEntry) => string | FormattedOutput;\n}\n\nexport interface LogTransport {\n  name: string;\n  transport: (entry: LogEntry, formatted: string | FormattedOutput) => void;\n}\n\nexport interface FormattedOutput {\n  message: string;\n  data?: any;\n  style?: string;\n  emoji?: string;\n}\n\nexport interface LoggerMethods {\n  debug: (message: string, data?: StructuredData) => void;\n  info: (message: string, data?: StructuredData) => void;\n  warn: (message: string, data?: StructuredData) => void;\n  error: (\n    message: string,\n    error?: Error | ErrorLike,\n    data?: StructuredData\n  ) => void;\n  trace: (message: string, data?: StructuredData) => void;\n  perf: (operation: string, duration: number, data?: StructuredData) => void;\n  group: (title: string) => void;\n  groupEnd: () => void;\n  table: (data: any[]) => void;\n  time: (label: string) => void;\n  timeEnd: (label: string) => void;\n}\n\nexport interface LoggerInstance extends LoggerMethods {\n  setContext: (context: Partial<LogContext>) => void;\n  setLevel: (level: LogLevel) => void;\n  enable: () => void;\n  disable: () => void;\n  isEnabled: () => boolean;\n  child: (context: Partial<LogContext>) => LoggerInstance;\n}\n\n// Utility types for specific logging patterns\nexport interface ClickDebugInfo {\n  clickX: number;\n  clickY: number;\n  textIndex: number;\n  word?: {\n    text: string;\n    start: number;\n    end: number;\n    cursorPositionInWord: number;\n    isWhitespace: boolean;\n  };\n  line?: {\n    lineNumber: number;\n    lineStart: number;\n    lineEnd: number;\n    columnIndex: number;\n    lineText: string;\n  };\n  pill?: {\n    type: 'hashtag' | 'mention' | 'url';\n    variant?: string;\n    rawText: string;\n    displayText: string;\n    start: number;\n    end: number;\n    data: any;\n  };\n  character?: {\n    char: string;\n    isWhitespace: boolean;\n    isNewline: boolean;\n    isPunctuation: boolean;\n  };\n  fullText: string;\n  textLength: number;\n}\n\nexport interface CursorDebugInfo {\n  position: number;\n  coordinates: { x: number; y: number };\n  character?: {\n    char: string;\n    isWhitespace: boolean;\n    isNewline: boolean;\n  };\n  nearbyPills: any[];\n}\n\nexport interface SelectionDebugInfo {\n  start: number;\n  end: number;\n  selectedLength: number;\n  selectedText: string;\n  hasCompletePills: boolean;\n  affectedPills: Array<{\n    type: string;\n    text: string;\n    fullySelected: boolean;\n  }>;\n}\n",
    "language":"typescript",
    "lines":181,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/logging/core/Logger.ts":{
    "content":"/* eslint-disable no-console */\n/**\n * Core Logger class - Base implementation for all logging operations\n */\n\nimport type {\n  ErrorLike,\n  FormattedOutput,\n  LogContext,\n  LogEntry,\n  LoggerConfig,\n  LoggerInstance,\n  LogLevel,\n  StructuredData\n} from '../types';\n\nimport {\n  CONSOLE_METHODS,\n  ContextEmojis,\n  getEnvironmentConfig,\n  LogEmojis,\n  shouldLog\n} from '../config';\n\nexport class Logger implements LoggerInstance {\n  private config: LoggerConfig;\n  private activeGroups: string[] = [];\n  private logCounts: Map<string, number> = new Map();\n  private timers: Map<string, number> = new Map();\n\n  constructor(config?: Partial<LoggerConfig>) {\n    this.config = {\n      ...getEnvironmentConfig(),\n      ...config,\n      context: {\n        ...getEnvironmentConfig().context,\n        ...config?.context\n      }\n    };\n  }\n\n  private formatTimestamp(): string {\n    return new Date().toISOString();\n  }\n\n  private getContextPrefix(): string {\n    const { component, module, function: fn, category } = this.config.context;\n    const parts = [component, module, fn, category].filter(Boolean);\n\n    if (parts.length === 0) return '';\n\n    const contextKey = parts[0] || '';\n    const emoji = ContextEmojis[contextKey] || ContextEmojis['debug'];\n\n    return `${emoji} ${parts.join('.')} `;\n  }\n\n  private shouldLogLevel(level: LogLevel): boolean {\n    return this.config.enabled && shouldLog(this.config.level, level);\n  }\n\n  private formatError(error: Error | ErrorLike): any {\n    if (error instanceof Error) {\n      return {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n        cause: error.cause\n      };\n    }\n    return error;\n  }\n\n  private createLogEntry(\n    level: LogLevel,\n    message: string,\n    data?: StructuredData,\n    error?: Error | ErrorLike,\n    duration?: number\n  ): LogEntry {\n    return {\n      level,\n      message,\n      data,\n      timestamp: this.formatTimestamp(),\n      context: { ...this.config.context },\n      error: error ? this.formatError(error) : undefined,\n      duration,\n      metadata: {\n        activeGroups: [...this.activeGroups],\n        logCount: this.logCounts.get(level) || 0\n      }\n    };\n  }\n\n  private formatOutput(entry: LogEntry): FormattedOutput {\n    const emoji = LogEmojis[entry.level];\n    const prefix = this.getContextPrefix();\n    const levelTag = `[${entry.level}]`;\n\n    return {\n      message: `${emoji} ${prefix}${levelTag} ${entry.message}`,\n      data: entry.data,\n      emoji,\n      style: this.getLogStyle(entry.level)\n    };\n  }\n\n  private getLogStyle(level: LogLevel): string {\n    const styles = {\n      DEBUG: 'color: #6b7280;',\n      TRACE: 'color: #8b5cf6;',\n      INFO: 'color: #3b82f6;',\n      WARN: 'color: #f59e0b; font-weight: bold;',\n      ERROR:\n        'color: #ef4444; font-weight: bold; font-size: 16px; background: #fef2f2; padding: 2px 6px; border-radius: 4px;',\n      PERF: 'color: #10b981;'\n    };\n    return styles[level] || '';\n  }\n\n  private executeLog(entry: LogEntry): void {\n    if (!this.shouldLogLevel(entry.level)) return;\n\n    // Update log counts\n    const currentCount = this.logCounts.get(entry.level) || 0;\n    this.logCounts.set(entry.level, currentCount + 1);\n\n    const formatted = this.formatOutput(entry);\n    const consoleMethod = CONSOLE_METHODS[entry.level];\n\n    // Auto-grouping disabled to prevent nesting issues\n\n    // Execute the actual console log\n    const consoleFn = console[consoleMethod];\n\n    if (entry.data || entry.error) {\n      // For ERROR level, use styled console output\n      if (entry.level === 'ERROR') {\n        console.error(`%c${formatted.message}`, formatted.style, {\n          ...(entry.data || {}),\n          ...(entry.error ? { error: entry.error } : {}),\n          ...(entry.duration ? { duration: `${entry.duration}ms` } : {})\n        });\n      } else {\n        consoleFn(formatted.message, {\n          ...(entry.data || {}),\n          ...(entry.error ? { error: entry.error } : {}),\n          ...(entry.duration ? { duration: `${entry.duration}ms` } : {})\n        });\n      }\n    } else {\n      // For ERROR level, use styled console output\n      if (entry.level === 'ERROR') {\n        console.error(`%c${formatted.message}`, formatted.style);\n      } else {\n        consoleFn(formatted.message);\n      }\n    }\n  }\n\n  // Public API methods\n  debug(message: string, data?: StructuredData): void {\n    const entry = this.createLogEntry('DEBUG', message, data);\n    this.executeLog(entry);\n  }\n\n  info(message: string, data?: StructuredData): void {\n    const entry = this.createLogEntry('INFO', message, data);\n    this.executeLog(entry);\n  }\n\n  warn(message: string, data?: StructuredData): void {\n    const entry = this.createLogEntry('WARN', message, data);\n    this.executeLog(entry);\n  }\n\n  error(\n    message: string,\n    error?: Error | ErrorLike,\n    data?: StructuredData\n  ): void {\n    const entry = this.createLogEntry('ERROR', message, data, error);\n    this.executeLog(entry);\n  }\n\n  trace(message: string, data?: StructuredData): void {\n    const entry = this.createLogEntry('TRACE', message, data);\n    this.executeLog(entry);\n  }\n\n  perf(operation: string, duration: number, data?: StructuredData): void {\n    if (!this.config.performance.enabled) return;\n\n    const message = `${operation}: ${duration.toFixed(2)}ms`;\n    const entry = this.createLogEntry(\n      'PERF',\n      message,\n      data,\n      undefined,\n      duration\n    );\n\n    // Check if it's a slow operation\n    if (duration > this.config.performance.slowThreshold) {\n      const slowEntry = this.createLogEntry(\n        'WARN',\n        `SLOW OPERATION: ${message}`,\n        {\n          ...data,\n          threshold: this.config.performance.slowThreshold\n        },\n        undefined,\n        duration\n      );\n      this.executeLog(slowEntry);\n    } else {\n      this.executeLog(entry);\n    }\n  }\n\n  group(title: string): void {\n    if (!this.config.grouping.enabled || !this.config.enabled) return;\n\n    this.activeGroups.push(title);\n    const prefix = this.getContextPrefix();\n\n    // Always use collapsed groups by default for cleaner output\n    if (console.groupCollapsed) {\n      console.groupCollapsed(`${prefix}${title}`);\n    } else {\n      console.group(`${prefix}${title}`);\n    }\n  }\n\n  groupEnd(): void {\n    if (!this.config.grouping.enabled || this.activeGroups.length === 0) return;\n\n    this.activeGroups.pop();\n\n    // Always call groupEnd to properly close groups and prevent nesting\n    if (console.groupEnd) {\n      console.groupEnd();\n    }\n  }\n\n  table(data: any[]): void {\n    if (!this.shouldLogLevel('INFO')) return;\n\n    console.table(data);\n  }\n\n  time(label: string): void {\n    this.timers.set(label, Date.now());\n  }\n\n  timeEnd(label: string): void {\n    const startTime = this.timers.get(label);\n    if (startTime) {\n      const duration = Date.now() - startTime;\n      this.timers.delete(label);\n      this.perf(label, duration);\n    }\n  }\n\n  // Configuration methods\n  setContext(context: Partial<LogContext>): void {\n    this.config.context = {\n      ...this.config.context,\n      ...context\n    };\n  }\n\n  setLevel(level: LogLevel): void {\n    this.config.level = level;\n  }\n\n  enable(): void {\n    this.config.enabled = true;\n  }\n\n  disable(): void {\n    this.config.enabled = false;\n  }\n\n  isEnabled(): boolean {\n    return this.config.enabled;\n  }\n\n  child(context: Partial<LogContext>): LoggerInstance {\n    return new Logger({\n      ...this.config,\n      context: {\n        ...this.config.context,\n        ...context\n      }\n    });\n  }\n\n  // Utility methods for specific logging patterns\n  logClick(info: any): void {\n    this.debug('Click event', info);\n  }\n\n  logCursor(info: any): void {\n    this.debug('Cursor position', info);\n  }\n\n  logSelection(info: any): void {\n    this.debug('Selection event', info);\n  }\n\n  logParsing(text: string, segments: any[], tokens: any[]): void {\n    this.debug('Content parsing', {\n      textLength: text.length,\n      segmentCount: segments.length,\n      tokenCount: tokens.length,\n      segments,\n      tokens\n    });\n  }\n\n  logCursorPositioning(data: any): void {\n    this.debug('Cursor positioning', data);\n  }\n\n  // Legacy compatibility methods\n  slowQuery(operation: string, duration: number, threshold = 1000): void {\n    if (duration > threshold) {\n      this.warn(`SLOW QUERY: ${operation}`, {\n        duration: `${duration.toFixed(2)}ms`,\n        threshold: `${threshold}ms`\n      });\n    }\n  }\n}\n",
    "language":"typescript",
    "lines":337,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/logging/adapters/ServiceWorkerLogger.ts":{
    "content":"/* eslint-disable no-console */\n/**\n * Service Worker Logger Adapter\n * Specialized logger for service worker context where imports may be limited\n */\n\nexport interface ServiceWorkerLoggerConfig {\n  enabled: boolean;\n  level: 'DEBUG' | 'INFO' | 'WARN' | 'ERROR';\n  context: string;\n  version: string;\n}\n\nexport class ServiceWorkerLogger {\n  private config: ServiceWorkerLoggerConfig;\n  private activeGroups: string[] = [];\n\n  constructor(config: Partial<ServiceWorkerLoggerConfig> = {}) {\n    this.config = {\n      enabled: true,\n      level: 'INFO',\n      context: 'ServiceWorker',\n      version: '0.157.0',\n      ...config\n    };\n  }\n\n  private shouldLog(level: string): boolean {\n    if (!this.config.enabled) return false;\n\n    const levels = ['DEBUG', 'INFO', 'WARN', 'ERROR'];\n    const currentLevelIndex = levels.indexOf(this.config.level);\n    const logLevelIndex = levels.indexOf(level);\n\n    return logLevelIndex >= currentLevelIndex;\n  }\n\n  private getPrefix(): string {\n    return `\ud83d\udd27 ${this.config.context} v${this.config.version}`;\n  }\n\n  private formatMessage(level: string, message: string): string {\n    const timestamp = new Date().toISOString().slice(11, 23);\n    const emoji =\n      {\n        DEBUG: '\ud83d\udd0d',\n        INFO: '\u2139\ufe0f',\n        WARN: '\u26a0\ufe0f',\n        ERROR: '\u274c'\n      }[level] || '\u2139\ufe0f';\n\n    return `${emoji} [${timestamp}] ${this.getPrefix()} ${message}`;\n  }\n\n  debug(message: string, data?: any): void {\n    if (!this.shouldLog('DEBUG')) return;\n\n    const formatted = this.formatMessage('DEBUG', message);\n    if (data) {\n      console.info(formatted, data);\n    } else {\n      console.info(formatted);\n    }\n  }\n\n  info(message: string, data?: any): void {\n    if (!this.shouldLog('INFO')) return;\n\n    const formatted = this.formatMessage('INFO', message);\n    if (data) {\n      console.info(formatted, data);\n    } else {\n      console.info(formatted);\n    }\n  }\n\n  warn(message: string, data?: any): void {\n    if (!this.shouldLog('WARN')) return;\n\n    const formatted = this.formatMessage('WARN', message);\n    if (data) {\n      console.warn(formatted, data);\n    } else {\n      console.warn(formatted);\n    }\n  }\n\n  error(message: string, error?: any, data?: any): void {\n    if (!this.shouldLog('ERROR')) return;\n\n    const formatted = this.formatMessage('ERROR', message);\n    const logData = {\n      ...(data || {}),\n      ...(error ? { error: this.serializeError(error) } : {})\n    };\n\n    if (Object.keys(logData).length > 0) {\n      console.error(formatted, logData);\n    } else {\n      console.error(formatted);\n    }\n  }\n\n  group(title: string): void {\n    if (!this.config.enabled) return;\n\n    this.activeGroups.push(title);\n    const formatted = `${this.getPrefix()} ${title}`;\n\n    // Always use collapsed groups by default for cleaner output\n    if (console.groupCollapsed) {\n      console.groupCollapsed(formatted);\n    } else if (console.group) {\n      console.group(formatted);\n    }\n  }\n\n  groupEnd(): void {\n    if (!this.config.enabled || this.activeGroups.length === 0) return;\n\n    this.activeGroups.pop();\n\n    // Always call groupEnd to properly close groups and prevent nesting\n    if (console.groupEnd) {\n      console.groupEnd();\n    }\n  }\n\n  table(data: any[]): void {\n    if (!this.shouldLog('INFO')) return;\n\n    if (console.table) {\n      console.table(data);\n    } else {\n      console.info('Table data:', data);\n    }\n  }\n\n  private serializeError(error: any): any {\n    if (error instanceof Error) {\n      return {\n        name: error.name,\n        message: error.message,\n        stack: error.stack\n      };\n    }\n    return error;\n  }\n\n  // Performance logging\n  perf(operation: string, duration: number, data?: any): void {\n    const message = `${operation}: ${duration.toFixed(2)}ms`;\n\n    if (duration > 1000) {\n      this.warn(`SLOW OPERATION: ${message}`, data);\n    } else {\n      this.debug(message, data);\n    }\n  }\n\n  // Cache-specific logging methods\n  cacheHit(url: string, age: number): void {\n    this.debug('Cache hit', { url, age: `${age}ms` });\n  }\n\n  cacheMiss(url: string, reason: string): void {\n    this.info('Cache miss', { url, reason });\n  }\n\n  cacheExpired(url: string, age: number, maxAge: number): void {\n    this.info('Cache expired', {\n      url,\n      age: `${age}ms`,\n      maxAge: `${maxAge}ms`,\n      expired: age > maxAge\n    });\n  }\n\n  cacheStored(url: string, ttl: number): void {\n    this.debug('Cache stored', {\n      url,\n      ttl: `${Math.round(ttl / 1000 / 60)}min`\n    });\n  }\n\n  cleanup(operation: string, count: number): void {\n    this.info(`Cleanup: ${operation}`, { count });\n  }\n\n  registration(event: string, details?: any): void {\n    this.info(`Registration: ${event}`, details);\n  }\n}\n\n// Create default instance for service worker\nexport const swLogger = new ServiceWorkerLogger();\n",
    "language":"typescript",
    "lines":197,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/logging/adapters/DebugLogger.ts":{
    "content":"/**\n * Debug Logger Adapter\n * Specialized logger for debug operations, particularly rich text editing\n * and development-specific logging with enhanced formatting\n */\n\nimport { Logger } from '../core/Logger';\nimport type {\n  ClickDebugInfo,\n  CursorDebugInfo,\n  LoggerConfig,\n  SelectionDebugInfo\n} from '../types';\n\nexport class DebugLogger extends Logger {\n  private plaintextMode: boolean = false;\n\n  constructor(config?: Partial<LoggerConfig>) {\n    super({\n      ...config,\n      context: {\n        context: 'universal',\n        environment: 'development',\n        category: 'debug',\n        ...config?.context\n      },\n      level: 'DEBUG',\n      grouping: {\n        enabled: true,\n        autoGroup: false,\n        groupThreshold: 1,\n        collapseGroups: false\n      }\n    });\n\n    // Check if plaintext mode is enabled\n    this.plaintextMode = this.isPlaintextModeEnabled();\n  }\n\n  private isPlaintextModeEnabled(): boolean {\n    if (typeof window === 'undefined') return false;\n\n    return (\n      window.localStorage?.getItem('debug-plaintext') === 'true' ||\n      window.location?.search.includes('debug=plaintext')\n    );\n  }\n\n  private toPlaintext(obj: any, indent: number = 0): string {\n    const spaces = '  '.repeat(indent);\n\n    if (obj === null) return 'null';\n    if (obj === undefined) return 'undefined';\n    if (typeof obj === 'string') return `\\\"${obj}\\\"`;\n    if (typeof obj === 'number' || typeof obj === 'boolean') return String(obj);\n\n    if (Array.isArray(obj)) {\n      if (obj.length === 0) return '[]';\n      const items = obj\n        .map((item) => `${spaces}  ${this.toPlaintext(item, indent + 1)}`)\n        .join(',\\\\n');\n      return `[\\\\n${items}\\\\n${spaces}]`;\n    }\n\n    if (typeof obj === 'object') {\n      const keys = Object.keys(obj);\n      if (keys.length === 0) return '{}';\n      const items = keys\n        .map((key) => {\n          const value = this.toPlaintext(obj[key], indent + 1);\n          return `${spaces}  ${key}: ${value}`;\n        })\n        .join(',\\\\n');\n      return `{\\\\n${items}\\\\n${spaces}}`;\n    }\n\n    return String(obj);\n  }\n\n  private logPlaintext(title: string, data: any): void {\n    if (this.plaintextMode) {\n      // eslint-disable-next-line no-console\n      console.info(`\\\\n=== ${title} ===`);\n      // eslint-disable-next-line no-console\n      console.info(this.toPlaintext(data));\n      // eslint-disable-next-line no-console\n      console.info('='.repeat(title.length + 8));\n    }\n  }\n\n  /**\n   * Enable plaintext logging mode\n   */\n  enablePlaintextMode(): void {\n    this.plaintextMode = true;\n    if (typeof window !== 'undefined') {\n      window.localStorage?.setItem('debug-plaintext', 'true');\n    }\n  }\n\n  /**\n   * Disable plaintext logging mode\n   */\n  disablePlaintextMode(): void {\n    this.plaintextMode = false;\n    if (typeof window !== 'undefined') {\n      window.localStorage?.removeItem('debug-plaintext');\n    }\n  }\n\n  /**\n   * Log rich text click events with detailed analysis\n   */\n  logClick(info: ClickDebugInfo): void {\n    if (!this.isEnabled()) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext('Rich Text Click Debug', info);\n      return;\n    }\n\n    this.group('\ud83d\uddb1\ufe0f Rich Text Click Debug');\n\n    // Basic click info\n    this.info('\ud83d\udccd Click Position', {\n      coordinates: `(${info.clickX}, ${info.clickY})`,\n      textIndex: info.textIndex,\n      textLength: info.textLength\n    });\n\n    // Character info\n    if (info.character) {\n      this.info('\ud83d\udd24 Character Info', {\n        character:\n          info.character.char === ' '\n            ? '\u00b7'\n            : info.character.char === '\\\\n'\n              ? '\\\\\\\\n'\n              : info.character.char,\n        isWhitespace: info.character.isWhitespace,\n        isNewline: info.character.isNewline,\n        isPunctuation: info.character.isPunctuation\n      });\n    }\n\n    // Word info\n    if (info.word) {\n      this.info('\ud83d\udcdd Word Info', {\n        word: `\\\"${info.word.text}\\\"`,\n        wordBounds: `${info.word.start}-${info.word.end}`,\n        cursorPositionInWord: info.word.cursorPositionInWord,\n        isWhitespace: info.word.isWhitespace\n      });\n    }\n\n    // Line info\n    if (info.line) {\n      this.info('\ud83d\udccf Line Info', {\n        lineNumber: info.line.lineNumber,\n        lineBounds: `${info.line.lineStart}-${info.line.lineEnd}`,\n        columnIndex: info.line.columnIndex,\n        lineText: `\\\"${info.line.lineText}\\\"`\n      });\n    }\n\n    // Pill info (most important)\n    if (info.pill) {\n      this.warn('\ud83d\udc8a Pill Click Detected', {\n        type: info.pill.type,\n        variant: info.pill.variant || 'default',\n        rawText: `\\\"${info.pill.rawText}\\\"`,\n        displayText: `\\\"${info.pill.displayText}\\\"`,\n        pillBounds: `${info.pill.start}-${info.pill.end}`,\n        pillData: info.pill.data\n      });\n\n      // Create detailed table for pill analysis\n      this.table([\n        {\n          'Pill Type': info.pill.type,\n          'Raw Format': info.pill.rawText,\n          'Display Format': info.pill.displayText,\n          'Start Position': info.pill.start,\n          'End Position': info.pill.end,\n          'Click Position': info.textIndex,\n          'Click Inside Pill':\n            info.textIndex >= info.pill.start && info.textIndex < info.pill.end\n              ? '\u2705'\n              : '\u274c'\n        }\n      ]);\n    }\n\n    this.groupEnd();\n  }\n\n  /**\n   * Log cursor positioning information\n   */\n  logCursor(info: CursorDebugInfo): void {\n    if (!this.isEnabled()) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext('Cursor Position Debug', info);\n      return;\n    }\n\n    this.group('\ud83d\udccd Cursor Position Debug');\n\n    this.info('Cursor Details', {\n      position: info.position,\n      coordinates: `(${info.coordinates.x}, ${info.coordinates.y})`\n    });\n\n    if (info.character) {\n      this.info('Character at Cursor', {\n        char:\n          info.character.char === ' '\n            ? '\u00b7'\n            : info.character.char === '\\\\n'\n              ? '\\\\\\\\n'\n              : info.character.char,\n        isWhitespace: info.character.isWhitespace,\n        isNewline: info.character.isNewline\n      });\n    }\n\n    if (info.nearbyPills.length > 0) {\n      this.info('Nearby Pills', info.nearbyPills);\n    }\n\n    this.groupEnd();\n  }\n\n  /**\n   * Log selection information\n   */\n  logSelection(info: SelectionDebugInfo): void {\n    if (!this.isEnabled()) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext('Selection Debug', info);\n      return;\n    }\n\n    this.group('\ud83c\udfaf Selection Debug');\n\n    this.info('Selection Details', {\n      range: `${info.start}-${info.end}`,\n      length: info.selectedLength,\n      text: `\\\"${info.selectedText}\\\"`,\n      hasCompletePills: info.hasCompletePills\n    });\n\n    if (info.affectedPills.length > 0) {\n      this.warn('Affected Pills', info.affectedPills);\n\n      this.table(\n        info.affectedPills.map((pill) => ({\n          'Pill Type': pill.type,\n          'Pill Text': pill.text,\n          'Fully Selected': pill.fullySelected ? '\u2705' : '\u26a0\ufe0f'\n        }))\n      );\n    }\n\n    this.groupEnd();\n  }\n\n  /**\n   * Log parsing results with detailed analysis\n   */\n  logParsing(text: string, segments: any[], tokens: any[]): void {\n    if (!this.isEnabled()) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext('Content Parsing Debug', {\n        textAnalysis: {\n          originalText: text,\n          textLength: text.length,\n          segmentCount: segments.length,\n          tokenCount: tokens.length\n        },\n        parsedSegments: segments.map((segment, index) => ({\n          index,\n          type: segment.type,\n          value: segment.value,\n          start: segment.start,\n          end: segment.end,\n          rawFormat: segment.raw || segment.value\n        })),\n        generatedTokens: tokens.map((token, index) => ({\n          index,\n          type: token.type,\n          content: token.content,\n          rawText: token.rawText,\n          start: token.start,\n          end: token.end\n        }))\n      });\n      return;\n    }\n\n    this.group('\ud83d\udd0d Content Parsing Debug');\n\n    this.info('Text Analysis', {\n      originalText: text,\n      textLength: text.length,\n      segmentCount: segments.length,\n      tokenCount: tokens.length\n    });\n\n    if (segments.length > 0) {\n      this.info('Parsed Segments:');\n      this.table(\n        segments.map((segment, index) => ({\n          Index: index,\n          Type: segment.type,\n          Value: segment.value,\n          Start: segment.start,\n          End: segment.end,\n          'Raw Format': segment.raw || segment.value\n        }))\n      );\n    }\n\n    if (tokens.length > 0) {\n      this.info('Generated Tokens:');\n      this.table(\n        tokens.map((token, index) => ({\n          Index: index,\n          Type: token.type,\n          Content: token.content,\n          'Raw Text': token.rawText,\n          Start: token.start,\n          End: token.end\n        }))\n      );\n    }\n\n    this.groupEnd();\n  }\n\n  /**\n   * Log cursor positioning calculations\n   */\n  logCursorPositioning(data: any): void {\n    if (!this.isEnabled()) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext('Cursor Positioning Debug', data);\n      return;\n    }\n\n    this.group('\ud83c\udfaf Cursor Positioning Debug');\n\n    if (data.clickCoordinates) {\n      this.info('\ud83d\udccd Click Info', {\n        coordinates: `(${data.clickCoordinates.x}, ${data.clickCoordinates.y})`,\n        textIndex: data.textIndex\n      });\n    }\n\n    if (data.foundToken) {\n      this.warn('\ud83c\udfaf Found Token', {\n        tokenIndex: data.foundToken.tokenIndex,\n        tokenType: data.foundToken.type,\n        tokenContent: data.foundToken.content || data.foundToken.rawText,\n        tokenBounds: `${data.foundToken.start}-${data.foundToken.end}`,\n        isNewline: data.foundToken.metadata?.isNewline || false\n      });\n    }\n\n    if (data.calculatedPosition) {\n      this.info('\ud83d\udcd0 Calculated Position', data.calculatedPosition);\n    }\n\n    this.groupEnd();\n  }\n}\n",
    "language":"typescript",
    "lines":381,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/logging/adapters/ClientLogger.ts":{
    "content":"/**\n * Client Logger Adapter\n * Specialized logger for client-side operations with browser-specific features\n * and user interaction tracking\n */\n\nimport { Logger } from '../core/Logger';\nimport type { ErrorLike, LoggerConfig, StructuredData } from '../types';\n\nexport class ClientLogger extends Logger {\n  private userAgent: string;\n  private sessionId: string;\n\n  constructor(config?: Partial<LoggerConfig>) {\n    super({\n      ...config,\n      context: {\n        context: 'client',\n        environment: (process.env.NODE_ENV as any) || 'development',\n        ...config?.context\n      }\n    });\n\n    this.userAgent =\n      typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown';\n    this.sessionId = this.generateSessionId();\n  }\n\n  private generateSessionId(): string {\n    return `client_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private getBrowserInfo(): any {\n    if (typeof window === 'undefined') return {};\n\n    return {\n      userAgent: this.userAgent,\n      sessionId: this.sessionId,\n      url: window.location.href,\n      referrer: document.referrer,\n      viewport: {\n        width: window.innerWidth,\n        height: window.innerHeight\n      },\n      screen: {\n        width: window.screen.width,\n        height: window.screen.height\n      },\n      timestamp: new Date().toISOString()\n    };\n  }\n\n  /**\n   * Enhanced error logging with client context\n   */\n  error(\n    message: string,\n    error?: Error | ErrorLike,\n    data?: StructuredData\n  ): void {\n    const enhancedData = {\n      ...data,\n      clientContext: this.getBrowserInfo(),\n      ...(error instanceof Error\n        ? {\n            errorInfo: {\n              name: error.name,\n              message: error.message,\n              stack: error.stack,\n              filename: (error as any).filename,\n              lineno: (error as any).lineno,\n              colno: (error as any).colno\n            }\n          }\n        : {})\n    };\n\n    super.error(message, error, enhancedData);\n  }\n\n  /**\n   * Log user interactions\n   */\n  interaction(event: string, element?: string, data?: StructuredData): void {\n    const interactionData = {\n      ...data,\n      event,\n      element,\n      ...this.getBrowserInfo()\n    };\n\n    this.debug(`User interaction: ${event}`, interactionData);\n  }\n\n  /**\n   * Log navigation events\n   */\n  navigation(from: string, to: string, data?: StructuredData): void {\n    const navigationData = {\n      ...data,\n      from,\n      to,\n      ...this.getBrowserInfo()\n    };\n\n    this.info(`Navigation: ${from} \u2192 ${to}`, navigationData);\n  }\n\n  /**\n   * Log API calls from client\n   */\n  api(\n    method: string,\n    url: string,\n    status: number,\n    duration?: number,\n    data?: StructuredData\n  ): void {\n    const apiData = {\n      ...data,\n      method,\n      url,\n      status,\n      ...(duration ? { duration: `${duration.toFixed(2)}ms` } : {}),\n      ...this.getBrowserInfo()\n    };\n\n    if (status >= 400) {\n      this.error(`API ${method} ${url} - ${status}`, undefined, apiData);\n    } else if (status >= 300) {\n      this.warn(`API ${method} ${url} - ${status}`, apiData);\n    } else {\n      this.debug(`API ${method} ${url} - ${status}`, apiData);\n    }\n  }\n\n  /**\n   * Log performance metrics for client operations\n   */\n  performance(metric: string, value: number, data?: StructuredData): void {\n    const perfData = {\n      ...data,\n      metric,\n      value,\n      unit: 'ms',\n      ...this.getBrowserInfo()\n    };\n\n    this.info(`Performance: ${metric} = ${value}ms`, perfData);\n  }\n\n  /**\n   * Log component lifecycle events\n   */\n  component(\n    name: string,\n    event: 'mount' | 'unmount' | 'render' | 'error',\n    data?: StructuredData\n  ): void {\n    const componentData = {\n      ...data,\n      component: name,\n      event,\n      ...this.getBrowserInfo()\n    };\n\n    switch (event) {\n      case 'error':\n        this.error(`Component error: ${name}`, undefined, componentData);\n        break;\n      case 'mount':\n      case 'unmount':\n        this.debug(`Component ${event}: ${name}`, componentData);\n        break;\n      case 'render':\n        this.trace(`Component render: ${name}`, componentData);\n        break;\n    }\n  }\n\n  /**\n   * Log cache operations\n   */\n  cache(\n    operation: 'hit' | 'miss' | 'set' | 'clear',\n    key: string,\n    data?: StructuredData\n  ): void {\n    const cacheData = {\n      ...data,\n      operation,\n      key,\n      ...this.getBrowserInfo()\n    };\n\n    this.debug(`Cache ${operation}: ${key}`, cacheData);\n  }\n\n  /**\n   * Log form interactions\n   */\n  form(\n    action: 'submit' | 'validate' | 'error',\n    formName: string,\n    data?: StructuredData\n  ): void {\n    const formData = {\n      ...data,\n      action,\n      formName,\n      ...this.getBrowserInfo()\n    };\n\n    switch (action) {\n      case 'error':\n        this.warn(`Form error: ${formName}`, formData);\n        break;\n      case 'submit':\n        this.info(`Form submit: ${formName}`, formData);\n        break;\n      case 'validate':\n        this.debug(`Form validate: ${formName}`, formData);\n        break;\n    }\n  }\n\n  /**\n   * Log authentication events on client\n   */\n  auth(event: string, data?: StructuredData): void {\n    const authData = {\n      ...data,\n      event,\n      ...this.getBrowserInfo()\n    };\n\n    this.info(`Auth: ${event}`, authData);\n  }\n}\n",
    "language":"typescript",
    "lines":240,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/logging/adapters/ServerLogger.ts":{
    "content":"/**\n * Server Logger Adapter\n * Specialized logger for server-side operations with enhanced error handling\n * and performance monitoring\n */\n\nimport { Logger } from '../core/Logger';\nimport type { ErrorLike, LoggerConfig, StructuredData } from '../types';\n\nexport class ServerLogger extends Logger {\n  constructor(config?: Partial<LoggerConfig>) {\n    super({\n      ...config,\n      context: {\n        context: 'server',\n        environment: (process.env.NODE_ENV as any) || 'development',\n        ...config?.context\n      }\n    });\n  }\n\n  /**\n   * Log performance metrics for server operations\n   */\n  perf(operation: string, duration: number, data?: StructuredData): void {\n    super.perf(operation, duration, data);\n  }\n\n  /**\n   * Log slow database queries or operations\n   */\n  slowQuery(operation: string, duration: number, threshold = 1000): void {\n    if (duration > threshold) {\n      this.warn(\n        `SLOW QUERY: ${operation} took ${duration.toFixed(2)}ms (threshold: ${threshold}ms)`,\n        {\n          duration,\n          threshold,\n          operation\n        }\n      );\n    }\n  }\n\n  /**\n   * Enhanced error logging with server context\n   */\n  error(\n    message: string,\n    error?: Error | ErrorLike,\n    data?: StructuredData\n  ): void {\n    const enhancedData = {\n      ...data,\n      serverContext: {\n        nodeVersion: process.version,\n        platform: process.platform,\n        arch: process.arch,\n        uptime: process.uptime(),\n        memoryUsage: process.memoryUsage()\n      }\n    };\n\n    super.error(message, error, enhancedData);\n  }\n\n  /**\n   * Log database operations\n   */\n  database(operation: string, duration?: number, data?: StructuredData): void {\n    const dbData = {\n      ...data,\n      operation,\n      ...(duration ? { duration: `${duration.toFixed(2)}ms` } : {})\n    };\n\n    if (duration && duration > 500) {\n      this.warn(`Database operation: ${operation}`, dbData);\n    } else {\n      this.debug(`Database operation: ${operation}`, dbData);\n    }\n  }\n\n  /**\n   * Log API request/response\n   */\n  api(\n    method: string,\n    path: string,\n    status: number,\n    duration?: number,\n    data?: StructuredData\n  ): void {\n    const apiData = {\n      ...data,\n      method,\n      path,\n      status,\n      ...(duration ? { duration: `${duration.toFixed(2)}ms` } : {})\n    };\n\n    if (status >= 400) {\n      this.error(`API ${method} ${path} - ${status}`, undefined, apiData);\n    } else if (status >= 300) {\n      this.warn(`API ${method} ${path} - ${status}`, apiData);\n    } else {\n      this.info(`API ${method} ${path} - ${status}`, apiData);\n    }\n  }\n\n  /**\n   * Log authentication events\n   */\n  auth(event: string, userId?: string, data?: StructuredData): void {\n    const authData = {\n      ...data,\n      event,\n      userId,\n      timestamp: new Date().toISOString()\n    };\n\n    this.info(`Auth: ${event}`, authData);\n  }\n\n  /**\n   * Log security events (always logged regardless of level)\n   */\n  security(event: string, data?: StructuredData): void {\n    const securityData = {\n      ...data,\n      event,\n      timestamp: new Date().toISOString(),\n      severity: 'SECURITY'\n    };\n\n    // Security events are always logged as errors for visibility\n    super.error(`SECURITY: ${event}`, undefined, securityData);\n  }\n\n  /**\n   * Log cron job operations\n   */\n  cron(\n    jobName: string,\n    status: 'start' | 'complete' | 'error',\n    duration?: number,\n    data?: StructuredData\n  ): void {\n    const cronData = {\n      ...data,\n      jobName,\n      status,\n      ...(duration ? { duration: `${duration.toFixed(2)}ms` } : {})\n    };\n\n    switch (status) {\n      case 'start':\n        this.debug(`Cron job started: ${jobName}`, cronData);\n        break;\n      case 'complete':\n        if (duration && duration > 30000) {\n          // 30 seconds\n          this.warn(`Cron job completed (slow): ${jobName}`, cronData);\n        } else {\n          this.debug(`Cron job completed: ${jobName}`, cronData);\n        }\n        break;\n      case 'error':\n        this.error(`Cron job failed: ${jobName}`, undefined, cronData);\n        break;\n    }\n  }\n}\n",
    "language":"typescript",
    "lines":174,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/encryption/emoji-encryption.ts":{
    "content":"/**\n * Emoji Encryption Service\n * Specialized encryption service for emoji data using the base encryption system\n */\n\nimport {\n  BaseEncryptionService,\n  DecryptionOptions,\n  EncryptedPayload,\n  EncryptionOptions,\n  EncryptionUtils\n} from './base-encryption';\n\nexport type EncryptionType = 'personal' | 'global';\n\nexport interface EmojiEncryptedData extends EncryptedPayload {\n  context: 'emoji';\n}\n\n/**\n * Emoji-specific encryption service that extends the base encryption system\n */\nexport class EmojiEncryptionService extends BaseEncryptionService {\n  private static readonly EMOJI_CONTEXT = 'emoji';\n  private static readonly MAX_IMAGE_SIZE = 1048576; // 1MB\n  private static readonly MAX_EMOJI_DIMENSIONS = 512;\n\n  /**\n   * Encrypt emoji image data\n   */\n  static async encryptImageData(\n    imageBuffer: Buffer,\n    encryptionType: EncryptionType,\n    userId?: number\n  ): Promise<EmojiEncryptedData> {\n    const options: EncryptionOptions = {\n      scope: encryptionType,\n      context: this.EMOJI_CONTEXT,\n      userId: encryptionType === 'personal' ? userId : undefined\n    };\n\n    const result = await this.encryptBinary(imageBuffer, options);\n    return result as EmojiEncryptedData;\n  }\n\n  /**\n   * Decrypt emoji image data\n   */\n  static async decryptImageData(\n    encryptedPayload: EmojiEncryptedData,\n    userId?: number\n  ): Promise<Buffer> {\n    const options: DecryptionOptions = {\n      userId: encryptedPayload.scope === 'personal' ? userId : undefined\n    };\n\n    return await this.decryptBinary(encryptedPayload, options);\n  }\n\n  /**\n   * Re-encrypt personal emoji data for global access (when approved)\n   */\n  static async reencryptForGlobalAccess(\n    personalEncryptedData: EmojiEncryptedData,\n    originalUserId: number\n  ): Promise<EmojiEncryptedData> {\n    const result = await this.reencryptPersonalToGlobal(\n      personalEncryptedData,\n      originalUserId\n    );\n    return result as EmojiEncryptedData;\n  }\n\n  /**\n   * Validate image constraints for custom emojis\n   */\n  static validateImageConstraints(\n    imageBuffer: Buffer,\n    format: string\n  ): {\n    isValid: boolean;\n    errors: string[];\n    metadata?: {\n      size: number;\n      width?: number;\n      height?: number;\n    };\n  } {\n    const errors: string[] = [];\n    const size = imageBuffer.length;\n\n    // Size validation (max 1MB)\n    if (size > this.MAX_IMAGE_SIZE) {\n      errors.push(\n        `Image size must be less than ${this.MAX_IMAGE_SIZE / 1024 / 1024}MB`\n      );\n    }\n\n    // Format validation\n    const allowedFormats = ['png', 'jpg', 'jpeg', 'gif', 'webp'];\n    if (!allowedFormats.includes(format.toLowerCase())) {\n      errors.push(`Image format must be one of: ${allowedFormats.join(', ')}`);\n    }\n\n    // Basic image header validation\n    const isValidImage = this.validateImageHeader(imageBuffer, format);\n    if (!isValidImage) {\n      errors.push('Invalid image file or corrupted data');\n    }\n\n    // Additional emoji-specific validations could go here\n    // (e.g., checking dimensions, color depth, etc.)\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n      metadata: {\n        size,\n        // In production, you'd extract actual width/height from image headers\n        width: undefined,\n        height: undefined\n      }\n    };\n  }\n\n  /**\n   * Basic image header validation\n   */\n  private static validateImageHeader(buffer: Buffer, format: string): boolean {\n    if (buffer.length < 8) return false;\n\n    const header = buffer.subarray(0, 8);\n\n    switch (format.toLowerCase()) {\n      case 'png':\n        return header.equals(\n          Buffer.from([0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a])\n        );\n      case 'jpg':\n      case 'jpeg':\n        return header[0] === 0xff && header[1] === 0xd8 && header[2] === 0xff;\n      case 'gif':\n        return (\n          header.subarray(0, 6).equals(Buffer.from('GIF87a')) ||\n          header.subarray(0, 6).equals(Buffer.from('GIF89a'))\n        );\n      case 'webp':\n        return (\n          header.subarray(0, 4).equals(Buffer.from('RIFF')) &&\n          buffer.subarray(8, 12).equals(Buffer.from('WEBP'))\n        );\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Rotate emoji encryption key for a user\n   */\n  static async rotateEmojiKey(userId: number): Promise<void> {\n    await this.rotatePersonalKey(userId, this.EMOJI_CONTEXT);\n  }\n}\n\n/**\n * Utility functions for emoji encryption\n */\nexport class EmojiEncryptionUtils extends EncryptionUtils {\n  /**\n   * Create a serialized encrypted payload for emoji data\n   */\n  static createEncryptedPayload(encryptedData: EmojiEncryptedData): string {\n    return this.serializePayload(encryptedData);\n  }\n\n  /**\n   * Parse a serialized encrypted payload for emoji data\n   */\n  static parseEncryptedPayload(payload: string): EmojiEncryptedData {\n    const parsed = this.parsePayload(payload);\n\n    if (parsed.context !== 'emoji') {\n      throw new Error('Invalid emoji encrypted payload - wrong context');\n    }\n\n    return parsed as EmojiEncryptedData;\n  }\n\n  /**\n   * Generate a unique emoji ID\n   */\n  static generateEmojiId(name: string, userId?: number): string {\n    const sanitizedName = name.toLowerCase().replace(/[^a-z0-9_]/g, '_');\n    return this.generateSecureId(\n      `emoji_${sanitizedName}${userId ? `_u${userId}` : ''}`\n    );\n  }\n\n  /**\n   * Validate emoji metadata\n   */\n  static validateEmojiMetadata(metadata: {\n    name: string;\n    aliases: string[];\n    tags: string[];\n    category?: string;\n  }): { isValid: boolean; errors: string[] } {\n    const errors: string[] = [];\n\n    // Name validation\n    if (!metadata.name || metadata.name.length < 2) {\n      errors.push('Emoji name must be at least 2 characters long');\n    }\n    if (metadata.name.length > 50) {\n      errors.push('Emoji name must be less than 50 characters');\n    }\n    if (!/^[a-zA-Z0-9_\\\\-\\\\s]+$/.test(metadata.name)) {\n      errors.push(\n        'Emoji name can only contain letters, numbers, spaces, hyphens, and underscores'\n      );\n    }\n\n    // Aliases validation\n    if (metadata.aliases.length > 10) {\n      errors.push('Maximum 10 aliases allowed');\n    }\n    for (const alias of metadata.aliases) {\n      if (alias.length > 30) {\n        errors.push('Alias length must be less than 30 characters');\n      }\n    }\n\n    // Tags validation\n    if (metadata.tags.length > 15) {\n      errors.push('Maximum 15 tags allowed');\n    }\n    for (const tag of metadata.tags) {\n      if (tag.length > 20) {\n        errors.push('Tag length must be less than 20 characters');\n      }\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors\n    };\n  }\n\n  /**\n   * Sanitize emoji data for XSS prevention\n   */\n  static sanitizeEmojiData(data: {\n    name: string;\n    description?: string;\n    aliases: string[];\n    tags: string[];\n  }): typeof data {\n    return {\n      name: this.sanitizeData(data.name.trim()),\n      description: data.description\n        ? this.sanitizeData(data.description.trim())\n        : undefined,\n      aliases: data.aliases.map((alias) => this.sanitizeData(alias.trim())),\n      tags: data.tags.map((tag) => this.sanitizeData(tag.trim()))\n    };\n  }\n\n  /**\n   * Validate emoji image constraints\n   */\n  static validateEmojiImageConstraints(\n    imageBuffer: Buffer,\n    format: string\n  ): { isValid: boolean; errors: string[] } {\n    return this.validateDataConstraints(imageBuffer, {\n      maxSize: 1048576, // 1MB\n      allowedTypes: ['png', 'jpg', 'jpeg', 'gif', 'webp']\n    });\n  }\n}\n",
    "language":"typescript",
    "lines":281,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/encryption/base-encryption.ts":{
    "content":"/**\n * Base Encryption Service\n * Generic encryption system that can be used for any type of data\n * Supports both personal (per-user) and global (application-level) encryption\n */\n\nimport { createLogger } from '@/lib/logging';\nimport crypto from 'crypto';\nimport sql from '../db';\n\nconst logger = createLogger({\n  context: {\n    component: 'BaseEncryption',\n    module: 'encryption'\n  },\n  enabled: false\n});\n\nexport type EncryptionScope = 'personal' | 'global';\nexport type EncryptionContext = string; // e.g., 'emoji', 'message', 'file', etc.\n\nexport interface EncryptionKey {\n  keyId: string;\n  encryptionKey: Buffer;\n  keyHash: string;\n  salt: string;\n  scope: EncryptionScope;\n  context: EncryptionContext;\n}\n\nexport interface EncryptedPayload {\n  encryptedData: string;\n  iv: string;\n  authTag: string;\n  scope: EncryptionScope;\n  context: EncryptionContext;\n  keyId: string;\n}\n\nexport interface EncryptionOptions {\n  scope: EncryptionScope;\n  context: EncryptionContext;\n  userId?: number; // Required for personal scope\n  additionalData?: string; // Additional authenticated data\n}\n\nexport interface DecryptionOptions {\n  userId?: number; // Required for personal scope decryption\n  additionalData?: string; // Must match encryption AAD\n}\n\n/**\n * Base encryption service that provides generic encryption/decryption capabilities\n */\nexport class BaseEncryptionService {\n  private static readonly ALGORITHM = 'aes-256-gcm';\n  private static readonly KEY_LENGTH = 32; // 256 bits\n  private static readonly IV_LENGTH = 16; // 128 bits\n  private static readonly SALT_LENGTH = 32; // 256 bits\n  private static readonly TAG_LENGTH = 16; // 128 bits\n  private static readonly PBKDF2_ITERATIONS = 100000;\n\n  // Cache for keys to avoid repeated database calls\n  private static keyCache: Map<string, EncryptionKey> = new Map();\n\n  /**\n   * Generate a new personal encryption key for a user and context\n   */\n  static async generatePersonalKey(\n    userId: number,\n    context: EncryptionContext\n  ): Promise<EncryptionKey> {\n    const keyId = `personal:${context}:${userId}`;\n    const encryptionKey = crypto.randomBytes(this.KEY_LENGTH);\n    const salt = crypto.randomBytes(this.SALT_LENGTH);\n\n    const keyHash = crypto\n      .createHash('sha256')\n      .update(encryptionKey)\n      .update(salt)\n      .digest('hex');\n\n    // Store in database\n    await sql`\n      INSERT INTO user_encryption_keys (user_id, encryption_key_hash, key_salt)\n      VALUES (${userId}, ${keyHash}, ${salt.toString('base64')})\n      ON CONFLICT (user_id) \n      DO UPDATE SET \n        encryption_key_hash = EXCLUDED.encryption_key_hash,\n        key_salt = EXCLUDED.key_salt,\n        updated_at = CURRENT_TIMESTAMP\n    `;\n\n    const key: EncryptionKey = {\n      keyId,\n      encryptionKey,\n      keyHash,\n      salt: salt.toString('base64'),\n      scope: 'personal',\n      context\n    };\n\n    // Cache the key\n    this.keyCache.set(keyId, key);\n    return key;\n  }\n\n  /**\n   * Generate or retrieve global encryption key for a context\n   */\n  static async getGlobalKey(\n    context: EncryptionContext\n  ): Promise<EncryptionKey> {\n    const keyId = `global:${context}`;\n\n    // Check cache first\n    if (this.keyCache.has(keyId)) {\n      return this.keyCache.get(keyId)!;\n    }\n\n    try {\n      const keyName = `global_${context}_key`;\n\n      // Check if global key exists\n      const result = await sql`\n        SELECT encryption_key_hash, key_salt \n        FROM application_encryption_keys \n        WHERE key_name = ${keyName} AND is_active = true\n      `;\n\n      let keyHash: string;\n      let salt: string;\n\n      if (\n        result.length === 0 ||\n        result[0].encryption_key_hash ===\n          'placeholder_hash_will_be_replaced_by_app'\n      ) {\n        // Generate new global key\n        const encryptionKey = crypto.randomBytes(this.KEY_LENGTH);\n        const saltBuffer = crypto.randomBytes(this.SALT_LENGTH);\n\n        keyHash = crypto\n          .createHash('sha256')\n          .update(encryptionKey)\n          .update(saltBuffer)\n          .digest('hex');\n\n        salt = saltBuffer.toString('base64');\n\n        // Store the new key\n        await sql`\n          INSERT INTO application_encryption_keys (key_name, key_purpose, encryption_key_hash, key_salt)\n          VALUES (\n            ${keyName}, \n            ${`Encryption key for globally accessible ${context} data`},\n            ${keyHash}, \n            ${salt}\n          )\n          ON CONFLICT (key_name) \n          DO UPDATE SET \n            encryption_key_hash = EXCLUDED.encryption_key_hash,\n            key_salt = EXCLUDED.key_salt,\n            updated_at = CURRENT_TIMESTAMP\n        `;\n      } else {\n        keyHash = result[0].encryption_key_hash;\n        salt = result[0].key_salt;\n      }\n\n      // Derive the key from master key + context + salt\n      const masterKey =\n        process.env.GLOBAL_ENCRYPTION_MASTER_KEY ||\n        'default-global-master-key-change-in-production';\n      const encryptionKey = crypto.pbkdf2Sync(\n        masterKey + context,\n        Buffer.from(salt, 'base64'),\n        this.PBKDF2_ITERATIONS,\n        this.KEY_LENGTH,\n        'sha256'\n      );\n\n      const key: EncryptionKey = {\n        keyId,\n        encryptionKey,\n        keyHash,\n        salt,\n        scope: 'global',\n        context\n      };\n\n      // Cache the key\n      this.keyCache.set(keyId, key);\n      return key;\n    } catch (error) {\n      logger.error('Error retrieving global encryption key', error as Error, {\n        context,\n        operation: 'getGlobalKey'\n      });\n      throw new Error(\n        `Failed to retrieve global encryption key for ${context}`\n      );\n    }\n  }\n\n  /**\n   * Get or generate personal encryption key for a user and context\n   */\n  static async getPersonalKey(\n    userId: number,\n    context: EncryptionContext\n  ): Promise<EncryptionKey> {\n    const keyId = `personal:${context}:${userId}`;\n\n    // Check cache first\n    if (this.keyCache.has(keyId)) {\n      return this.keyCache.get(keyId)!;\n    }\n\n    try {\n      // Check if user already has an encryption key\n      const result = await sql`\n        SELECT encryption_key_hash, key_salt \n        FROM user_encryption_keys \n        WHERE user_id = ${userId}\n      `;\n\n      if (result.length === 0) {\n        // Generate new key if none exists\n        return await this.generatePersonalKey(userId, context);\n      }\n\n      const { encryption_key_hash, key_salt } = result[0];\n\n      // Derive the key from master key + user ID + context + salt\n      const masterKey =\n        process.env.PERSONAL_ENCRYPTION_MASTER_KEY ||\n        'default-personal-master-key-change-in-production';\n      const encryptionKey = crypto.pbkdf2Sync(\n        masterKey + userId.toString() + context,\n        Buffer.from(key_salt, 'base64'),\n        this.PBKDF2_ITERATIONS,\n        this.KEY_LENGTH,\n        'sha256'\n      );\n\n      const key: EncryptionKey = {\n        keyId,\n        encryptionKey,\n        keyHash: encryption_key_hash,\n        salt: key_salt,\n        scope: 'personal',\n        context\n      };\n\n      // Cache the key\n      this.keyCache.set(keyId, key);\n      return key;\n    } catch (error) {\n      logger.error('Error retrieving personal encryption key', error as Error, {\n        userId,\n        context,\n        operation: 'getPersonalKey'\n      });\n      throw new Error(\n        `Failed to retrieve personal encryption key for ${context}`\n      );\n    }\n  }\n\n  /**\n   * Encrypt data with specified options\n   */\n  static async encrypt(\n    data: string,\n    options: EncryptionOptions\n  ): Promise<EncryptedPayload> {\n    let encryptionKey: EncryptionKey;\n\n    if (options.scope === 'personal') {\n      if (!options.userId) {\n        throw new Error('User ID required for personal encryption');\n      }\n      encryptionKey = await this.getPersonalKey(\n        options.userId,\n        options.context\n      );\n    } else {\n      encryptionKey = await this.getGlobalKey(options.context);\n    }\n\n    const iv = crypto.randomBytes(this.IV_LENGTH);\n    const cipher = crypto.createCipheriv(\n      this.ALGORITHM,\n      encryptionKey.encryptionKey,\n      iv\n    );\n\n    // Create additional authenticated data\n    const aadData = `${options.scope}:${options.context}${options.userId ? `:${options.userId}` : ''}${options.additionalData ? `:${options.additionalData}` : ''}`;\n    cipher.setAAD(Buffer.from(aadData));\n\n    let encryptedData = cipher.update(data, 'utf8', 'base64');\n    encryptedData += cipher.final('base64');\n\n    const authTag = cipher.getAuthTag();\n\n    return {\n      encryptedData,\n      iv: iv.toString('base64'),\n      authTag: authTag.toString('base64'),\n      scope: options.scope,\n      context: options.context,\n      keyId: encryptionKey.keyId\n    };\n  }\n\n  /**\n   * Decrypt data with specified options\n   */\n  static async decrypt(\n    payload: EncryptedPayload,\n    options: DecryptionOptions = {}\n  ): Promise<string> {\n    let encryptionKey: EncryptionKey;\n\n    if (payload.scope === 'personal') {\n      if (!options.userId) {\n        throw new Error('User ID required for personal decryption');\n      }\n      encryptionKey = await this.getPersonalKey(\n        options.userId,\n        payload.context\n      );\n    } else {\n      encryptionKey = await this.getGlobalKey(payload.context);\n    }\n\n    const iv = Buffer.from(payload.iv, 'base64');\n    const authTag = Buffer.from(payload.authTag, 'base64');\n\n    const decipher = crypto.createDecipheriv(\n      this.ALGORITHM,\n      encryptionKey.encryptionKey,\n      iv\n    );\n\n    // Recreate the same AAD used during encryption\n    const aadData = `${payload.scope}:${payload.context}${options.userId ? `:${options.userId}` : ''}${options.additionalData ? `:${options.additionalData}` : ''}`;\n    decipher.setAAD(Buffer.from(aadData));\n    decipher.setAuthTag(authTag);\n\n    let decryptedData = decipher.update(\n      payload.encryptedData,\n      'base64',\n      'utf8'\n    );\n    decryptedData += decipher.final('utf8');\n\n    return decryptedData;\n  }\n\n  /**\n   * Re-encrypt data from personal to global scope\n   */\n  static async reencryptPersonalToGlobal(\n    personalPayload: EncryptedPayload,\n    originalUserId: number,\n    additionalData?: string\n  ): Promise<EncryptedPayload> {\n    if (personalPayload.scope !== 'personal') {\n      throw new Error('Can only re-encrypt personal data to global');\n    }\n\n    // First decrypt with personal key\n    const decryptedData = await this.decrypt(personalPayload, {\n      userId: originalUserId,\n      additionalData\n    });\n\n    // Then encrypt with global key\n    return await this.encrypt(decryptedData, {\n      scope: 'global',\n      context: personalPayload.context,\n      additionalData\n    });\n  }\n\n  /**\n   * Encrypt binary data (e.g., images, files)\n   */\n  static async encryptBinary(\n    buffer: Buffer,\n    options: EncryptionOptions\n  ): Promise<EncryptedPayload> {\n    const base64Data = buffer.toString('base64');\n    return await this.encrypt(base64Data, options);\n  }\n\n  /**\n   * Decrypt binary data\n   */\n  static async decryptBinary(\n    payload: EncryptedPayload,\n    options: DecryptionOptions = {}\n  ): Promise<Buffer> {\n    const decryptedBase64 = await this.decrypt(payload, options);\n    return Buffer.from(decryptedBase64, 'base64');\n  }\n\n  /**\n   * Clear key cache (useful for key rotation)\n   */\n  static clearKeyCache(): void {\n    this.keyCache.clear();\n  }\n\n  /**\n   * Rotate personal key for user and context\n   */\n  static async rotatePersonalKey(\n    userId: number,\n    context: EncryptionContext\n  ): Promise<EncryptionKey> {\n    const keyId = `personal:${context}:${userId}`;\n    this.keyCache.delete(keyId);\n\n    // Generate new key (this will replace the old one)\n    return await this.generatePersonalKey(userId, context);\n  }\n\n  /**\n   * Validate encryption payload structure\n   */\n  static validatePayload(payload: any): payload is EncryptedPayload {\n    return (\n      typeof payload === 'object' &&\n      typeof payload.encryptedData === 'string' &&\n      typeof payload.iv === 'string' &&\n      typeof payload.authTag === 'string' &&\n      typeof payload.scope === 'string' &&\n      typeof payload.context === 'string' &&\n      typeof payload.keyId === 'string' &&\n      ['personal', 'global'].includes(payload.scope)\n    );\n  }\n}\n\n/**\n * Utility functions for encryption\n */\nexport class EncryptionUtils {\n  /**\n   * Create a serialized encrypted payload\n   */\n  static serializePayload(payload: EncryptedPayload): string {\n    return JSON.stringify({\n      data: payload.encryptedData,\n      iv: payload.iv,\n      tag: payload.authTag,\n      scope: payload.scope,\n      context: payload.context,\n      keyId: payload.keyId\n    });\n  }\n\n  /**\n   * Parse a serialized encrypted payload\n   */\n  static parsePayload(serialized: string): EncryptedPayload {\n    try {\n      const parsed = JSON.parse(serialized);\n\n      if (\n        !BaseEncryptionService.validatePayload({\n          encryptedData: parsed.data,\n          iv: parsed.iv,\n          authTag: parsed.tag,\n          scope: parsed.scope,\n          context: parsed.context,\n          keyId: parsed.keyId\n        })\n      ) {\n        throw new Error('Invalid payload structure');\n      }\n\n      return {\n        encryptedData: parsed.data,\n        iv: parsed.iv,\n        authTag: parsed.tag,\n        scope: parsed.scope || 'personal',\n        context: parsed.context,\n        keyId: parsed.keyId\n      };\n    } catch (error) {\n      throw new Error('Invalid encrypted payload format');\n    }\n  }\n\n  /**\n   * Generate a secure random ID\n   */\n  static generateSecureId(prefix?: string): string {\n    const randomBytes = crypto.randomBytes(16).toString('hex');\n    const timestamp = Date.now().toString(36);\n    return prefix\n      ? `${prefix}_${timestamp}_${randomBytes}`\n      : `${timestamp}_${randomBytes}`;\n  }\n\n  /**\n   * Sanitize data for XSS prevention\n   */\n  static sanitizeData(data: string): string {\n    return data\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\\\"/g, '&quot;')\n      .replace(/'/g, '&#x27;');\n  }\n\n  /**\n   * Validate data constraints\n   */\n  static validateDataConstraints(\n    data: Buffer | string,\n    constraints: {\n      maxSize?: number;\n      allowedTypes?: string[];\n      minLength?: number;\n      maxLength?: number;\n    }\n  ): { isValid: boolean; errors: string[] } {\n    const errors: string[] = [];\n    const size = Buffer.isBuffer(data)\n      ? data.length\n      : Buffer.byteLength(data, 'utf8');\n\n    if (constraints.maxSize && size > constraints.maxSize) {\n      errors.push(\n        `Data size ${size} bytes exceeds maximum of ${constraints.maxSize} bytes`\n      );\n    }\n\n    if (typeof data === 'string') {\n      if (constraints.minLength && data.length < constraints.minLength) {\n        errors.push(\n          `Data length ${data.length} is below minimum of ${constraints.minLength}`\n        );\n      }\n      if (constraints.maxLength && data.length > constraints.maxLength) {\n        errors.push(\n          `Data length ${data.length} exceeds maximum of ${constraints.maxLength}`\n        );\n      }\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors\n    };\n  }\n}\n",
    "language":"typescript",
    "lines":565,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/middleware/withRateLimit.ts":{
    "content":"import { auth } from '@/lib/auth';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { rateLimitService } from '../services/RateLimitService';\nimport { getRateLimitType, getRequestIdentifier } from '../utils/requestIdentifier';\nimport { formatRetryAfter } from '../utils/timeFormatting';\n\ntype ApiHandler = (req: NextRequest, context?: any) => Promise<Response | NextResponse> | Response | NextResponse;\n\n/**\n * Create rate limit response with appropriate headers\n */\nfunction createRateLimitResponse(result: any, isAttack: boolean = false) {\n  const status = isAttack ? 429 : 429; // Too Many Requests\n  \n  // Create human-readable error message\n  let message = 'Too many requests. Please slow down.';\n  if (result.retryAfter) {\n    const humanTime = formatRetryAfter(result.retryAfter);\n    message = isAttack \n      ? `Suspicious activity detected. Access temporarily restricted. Try again in ${humanTime}.`\n      : `Rate limit exceeded. Please try again in ${humanTime}.`;\n  }\n\n  const response = NextResponse.json(\n    { \n      error: message,\n      retryAfter: result.retryAfter,\n      retryAfterHuman: result.retryAfter ? formatRetryAfter(result.retryAfter) : undefined,\n      penaltyLevel: result.penaltyLevel,\n      quotaType: result.quotaType\n    },\n    { status }\n  );\n\n  // Add standard rate limit headers\n  response.headers.set('X-RateLimit-Limit', '100'); // Will be dynamic in production\n  response.headers.set('X-RateLimit-Remaining', result.remaining.toString());\n  response.headers.set('X-RateLimit-Reset', new Date(result.resetTime).toISOString());\n  \n  if (result.retryAfter) {\n    response.headers.set('Retry-After', result.retryAfter.toString());\n  }\n\n  // Add security headers for attacks\n  if (isAttack) {\n    response.headers.set('X-Security-Warning', 'Rate limit violation detected');\n  }\n\n  return response;\n}\n\n/**\n * Higher-order function that wraps API route handlers with rate limiting\n * Maintains identical behavior to the middleware rate limiting\n */\nexport function withRateLimit(handler: ApiHandler, options: { skipRateLimit?: boolean } = {}) {\n  return async (req: NextRequest, context?: any) => {\n    const url = new URL(req.url);\n    \n    // Skip rate limiting for certain endpoints\n    enum RateLimitExemptPaths {\n      AUTH_SESSION = '/api/auth/session',\n      ALERTS_ACTIVE = '/api/alerts/active',\n      USER_TIMEOUT = '/api/user/timeout',\n      ADMIN_ALERTS = '/api/admin/alerts',\n      NEXT_INTERNAL = '/_next/',\n      VERSION = '/api/version',\n      LINK_PREVIEW = '/api/link-preview',\n      TEST_HEALTH = '/api/test/health',\n      NOTIFICATIONS_POLL = '/api/notifications/poll',\n      BUDDHA_API = 'https://buddha-api.com/api/random'\n    }\n\n    const exemptPaths = Object.values(RateLimitExemptPaths);\n    const isDryRun = url.searchParams.get('dry-run') === 'true';\n    \n    const skipRateLimit = exemptPaths.some(path => url.pathname.includes(path)) || isDryRun || options.skipRateLimit;\n\n    if (skipRateLimit) {\n      const response = await handler(req, context);\n      return response;\n    }\n\n    // Get session for rate limiting\n    const session = await auth();\n\n    // Get comprehensive request identifiers for flexible rate limiting\n    const identifiers = getRequestIdentifier(req, session);\n    const rateLimitType = getRateLimitType(url.pathname);\n    const userId = session?.user?.id ? parseInt(session.user.id) : null;\n    \n    // Multi-layered rate limiting approach:\n    // 1. Primary device-level rate limiting (allows multiple devices per household)\n    const deviceRateLimitResult = await rateLimitService.checkRateLimit({\n      identifier: identifiers.perDevice,\n      configType: rateLimitType,\n    });\n\n    // Check if device-level request should be blocked\n    if (!deviceRateLimitResult.allowed) {\n      console.warn(`Device rate limit exceeded for ${identifiers.perDevice} on ${url.pathname}`, {\n        penaltyLevel: deviceRateLimitResult.penaltyLevel,\n        isAttack: deviceRateLimitResult.isAttack,\n        retryAfter: deviceRateLimitResult.retryAfter,\n        quotaType: deviceRateLimitResult.quotaType\n      });\n\n      return createRateLimitResponse(deviceRateLimitResult, deviceRateLimitResult.isAttack);\n    }\n\n    // 2. Network-level rate limiting (household-wide protection against severe abuse)\n    // Only apply network-level limits if device shows suspicious behavior\n    if (deviceRateLimitResult.penaltyLevel >= 2) {\n      const networkRateLimitResult = await rateLimitService.checkRateLimit({\n        identifier: identifiers.perNetwork,\n        configType: rateLimitType,\n        customConfig: {\n          windowMs: 60 * 1000, // 1 minute\n          maxRequests: 500,    // Much higher limit for network-wide\n          storage: 'memory' as const,\n          keyPrefix: 'network'\n        },\n      });\n\n      if (!networkRateLimitResult.allowed) {\n        console.warn(`Network rate limit exceeded for ${identifiers.perNetwork} due to suspicious device activity`, {\n          devicePenalty: deviceRateLimitResult.penaltyLevel,\n          networkPenalty: networkRateLimitResult.penaltyLevel,\n          endpoint: url.pathname\n        });\n        \n        // Rate limit info will be handled by fetch interceptor\n        \n        return createRateLimitResponse(networkRateLimitResult, true); // Mark as attack\n      }\n    }\n\n    // 3. User-specific rate limiting for authenticated requests\n    if (session?.user?.id) {\n      const userRateLimitResult = await rateLimitService.checkRateLimit({\n        identifier: identifiers.perUser,\n        configType: rateLimitType,\n      });\n      \n      if (!userRateLimitResult.allowed) {\n        console.warn(`User rate limit exceeded for ${identifiers.perUser} on ${url.pathname}`, {\n          penaltyLevel: userRateLimitResult.penaltyLevel,\n          isAttack: userRateLimitResult.isAttack,\n          quotaType: userRateLimitResult.quotaType\n        });\n        \n        // Rate limit info will be handled by fetch interceptor\n        \n        return createRateLimitResponse(userRateLimitResult, userRateLimitResult.isAttack);\n      }\n    }\n\n    // Log suspicious activity\n    if (deviceRateLimitResult.penaltyLevel >= 2) {\n      console.warn(`Elevated penalty level detected`, {\n        deviceIdentifier: identifiers.perDevice,\n        networkIdentifier: identifiers.perNetwork,\n        penaltyLevel: deviceRateLimitResult.penaltyLevel,\n        endpoint: url.pathname,\n        userAgent: req.headers.get('user-agent')\n      });\n    }\n\n    // Call the original handler\n    const response = await handler(req, context);\n    \n    // Add rate limit headers to successful responses\n    response.headers.set('X-RateLimit-Remaining', deviceRateLimitResult.remaining.toString());\n    response.headers.set('X-RateLimit-Reset', new Date(deviceRateLimitResult.resetTime).toISOString());\n    \n    return response;\n  };\n} ",
    "language":"typescript",
    "lines":178,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/cron/refresh-materialized-views.ts":{
    "content":"/**\n * Materialized View Refresh System\n * Automatically refreshes user_submission_stats every hour for optimal performance\n */\n\nimport {\n  refreshDailyStats,\n  refreshTagStats,\n  refreshTrendingPosts,\n  refreshUserStats\n} from '../actions/search.actions';\nimport { serverLogger } from '../utils/server-logger';\n\ninterface RefreshJob {\n  name: string;\n  intervalMs: number;\n  lastRun?: Date;\n  nextRun?: Date;\n  isRunning: boolean;\n}\n\nclass MaterializedViewRefresher {\n  private jobs: Map<string, RefreshJob> = new Map();\n  private timers: Map<string, ReturnType<typeof setInterval>> = new Map();\n\n  constructor() {\n    this.setupJobs();\n  }\n\n  private setupJobs(): void {\n    // Refresh user stats nightly (86400000ms = 24 hours)\n    this.jobs.set('user_stats', {\n      name: 'user_submission_stats',\n      intervalMs: 24 * 60 * 60 * 1000, // 24 hours (nightly)\n      isRunning: false\n    });\n\n    // Refresh tag statistics nightly\n    this.jobs.set('tag_stats', {\n      name: 'tag_statistics',\n      intervalMs: 24 * 60 * 60 * 1000, // 24 hours (nightly)\n      isRunning: false\n    });\n\n    // Refresh trending posts every 6 hours (more frequent for trending data)\n    this.jobs.set('trending_posts', {\n      name: 'trending_posts',\n      intervalMs: 6 * 60 * 60 * 1000, // 6 hours\n      isRunning: false\n    });\n\n    // Refresh daily stats nightly\n    this.jobs.set('daily_stats', {\n      name: 'daily_submission_stats',\n      intervalMs: 24 * 60 * 60 * 1000, // 24 hours (nightly)\n      isRunning: false\n    });\n\n    serverLogger.info('Materialized view refresh jobs configured', {\n      jobs: Array.from(this.jobs.keys()),\n      intervals: Array.from(this.jobs.values()).map(\n        (j) => `${j.name}: ${j.intervalMs / 1000 / 60 / 60}h`\n      )\n    });\n  }\n\n  async start(): Promise<void> {\n    // Starting scheduler silently\n\n    for (const [jobId, job] of this.jobs) {\n      // Run immediately on startup\n      await this.runJob(jobId);\n\n      // Schedule recurring runs\n      const timer = setInterval(async () => {\n        await this.runJob(jobId);\n      }, job.intervalMs);\n\n      this.timers.set(jobId, timer);\n\n      // Calculate next run time\n      job.nextRun = new Date(Date.now() + job.intervalMs);\n\n      serverLogger.info(`Scheduled refresh job: ${job.name}`, {\n        interval: `${job.intervalMs / 1000 / 60} minutes`,\n        nextRun: job.nextRun.toISOString()\n      });\n    }\n  }\n\n  async stop(): Promise<void> {\n    // Stopping scheduler silently\n\n    for (const [jobId, timer] of this.timers) {\n      clearInterval(timer);\n      this.timers.delete(jobId);\n    }\n\n    // Wait for any running jobs to complete\n    for (const job of this.jobs.values()) {\n      while (job.isRunning) {\n        await new Promise((resolve) => setTimeout(resolve, 100));\n      }\n    }\n\n    serverLogger.info('All refresh jobs stopped');\n  }\n\n  private async runJob(jobId: string): Promise<void> {\n    const job = this.jobs.get(jobId);\n    if (!job) {\n      serverLogger.error('Unknown refresh job', null, { jobId });\n      return;\n    }\n\n    if (job.isRunning) {\n      // Skip silently to reduce log noise\n      return;\n    }\n\n    job.isRunning = true;\n    job.lastRun = new Date();\n\n    try {\n      // Starting refresh silently\n\n      switch (jobId) {\n        case 'user_stats':\n          await refreshUserStats();\n          break;\n        case 'tag_stats':\n          await refreshTagStats();\n          break;\n        case 'trending_posts':\n          await refreshTrendingPosts();\n          break;\n        case 'daily_stats':\n          await refreshDailyStats();\n          break;\n        default:\n          throw new Error(`Unknown job type: ${jobId}`);\n      }\n\n      // Update next run time\n      job.nextRun = new Date(Date.now() + job.intervalMs);\n\n      // Only log if refresh took a long time\n      const duration = Date.now() - job.lastRun.getTime();\n      if (duration > 30000) {\n        // 30 seconds\n        serverLogger.slowQuery(`${job.name} refresh`, duration, 30000);\n      }\n    } catch (error) {\n      serverLogger.error(\n        `Failed to refresh materialized view: ${job.name}`,\n        error,\n        {\n          jobId,\n          lastRun: job.lastRun?.toISOString()\n        }\n      );\n    } finally {\n      job.isRunning = false;\n    }\n  }\n\n  getStatus(): Record<string, any> {\n    const status: Record<string, any> = {};\n\n    for (const [jobId, job] of this.jobs) {\n      status[jobId] = {\n        name: job.name,\n        intervalMinutes: job.intervalMs / 1000 / 60,\n        isRunning: job.isRunning,\n        lastRun: job.lastRun?.toISOString() || 'never',\n        nextRun: job.nextRun?.toISOString() || 'unknown'\n      };\n    }\n\n    return status;\n  }\n\n  async forceRefresh(jobId?: string): Promise<void> {\n    if (jobId) {\n      await this.runJob(jobId);\n    } else {\n      // Refresh all jobs\n      for (const jobId of this.jobs.keys()) {\n        await this.runJob(jobId);\n      }\n    }\n  }\n}\n\n// Singleton instance\nexport const materializedViewRefresher = new MaterializedViewRefresher();\n\n// Auto-start in production and development (but not during build)\nif (\n  typeof window === 'undefined' &&\n  !process.env.NEXT_PHASE &&\n  process.env.NODE_ENV !== 'test'\n) {\n  // Server-side only, and not during Next.js build phase\n  // Start the refresher when the module loads\n  materializedViewRefresher.start().catch((error) => {\n    serverLogger.error('Failed to start materialized view refresher', error);\n  });\n\n  // Graceful shutdown handling\n  process.on('SIGTERM', async () => {\n    serverLogger.info('Received SIGTERM, stopping materialized view refresher');\n    await materializedViewRefresher.stop();\n  });\n\n  process.on('SIGINT', async () => {\n    serverLogger.info('Received SIGINT, stopping materialized view refresher');\n    await materializedViewRefresher.stop();\n  });\n}\n",
    "language":"typescript",
    "lines":221,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/permissions/permissions.ts":{
    "content":"/**\n * Permissions System Utility\n * Handles role-based access control and permission checking\n */\n\nimport { createLogger } from '@lib/logging';\nimport { unstable_noStore as noStore } from 'next/cache';\nimport { auth } from '../auth';\nimport sql from '../db';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'PermissionsService',\n    module: 'permissions'\n  },\n  enabled: false\n});\n\nexport interface Permission {\n  id: number;\n  name: string;\n  display_name: string;\n  description?: string;\n  category: string;\n  is_inheritable: boolean;\n  is_system: boolean;\n}\n\nexport interface UserRole {\n  id: number;\n  name: string;\n  display_name: string;\n  description?: string;\n  is_default: boolean;\n  is_system: boolean;\n}\n\nexport interface UserTimeout {\n  id: number;\n  user_id: number;\n  timeout_type: string;\n  reason: string;\n  issued_by: number;\n  issued_at: Date;\n  expires_at: Date;\n  is_active: boolean;\n}\n\nexport interface TimeoutCheck {\n  is_timed_out: boolean;\n  expires_at?: Date;\n  reason?: string;\n}\n\n// Database query result types\nexport interface PermissionQueryResult {\n  has_permission: boolean;\n}\n\nexport interface PermissionIdResult {\n  id: number;\n}\n\nexport interface RoleQueryResult {\n  id: number;\n  name: string;\n}\n\nexport interface TimeoutQueryResult {\n  is_timed_out: boolean;\n  expires_at?: string;\n  reason?: string;\n}\n\nexport class PermissionsService {\n  /**\n   * Check if current user has a specific permission\n   */\n  static async hasPermission(permissionName: string): Promise<boolean> {\n    // Prevent caching of auth checks\n    noStore();\n\n    const session = await auth();\n\n    if (!session?.user?.id) {\n      return false;\n    }\n\n    const result = await this.userHasPermission(\n      parseInt(session.user.id),\n      permissionName\n    );\n    return result;\n  }\n\n  /**\n   * Check if a specific user has a permission\n   */\n  static async userHasPermission(\n    userId: number,\n    permissionName: string\n  ): Promise<boolean> {\n    try {\n      const result = await sql<PermissionQueryResult[]>`\n        SELECT user_has_permission(${userId}, ${permissionName}) as has_permission\n      `;\n\n      return result[0]?.has_permission || false;\n    } catch (error) {\n      logger.group('userHasPermission');\n      // If database function doesn't exist, fallback to basic check\n      if (\n        error &&\n        typeof error === 'object' &&\n        'code' in error &&\n        error.code === '42883'\n      ) {\n        logger.warn('Permission function not found, using fallback logic', {\n          permissionName,\n          userId,\n          errorCode: error.code\n        });\n        const result = this.fallbackPermissionCheck(userId, permissionName);\n        logger.groupEnd();\n        return result;\n      }\n      logger.error('Error checking user permission', error as Error, {\n        userId,\n        permissionName\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Fallback permission check when database functions are not available\n   */\n  private static async fallbackPermissionCheck(\n    userId: number,\n    permissionName: string\n  ): Promise<boolean> {\n    try {\n      // Basic content permissions for logged-in users\n      const basicPermissions = [\n        'content.create.post',\n        'content.edit.own',\n        'content.delete.own',\n        'content.comment',\n        'emoji.use.standard',\n        'emoji.use.custom',\n        'emoji.create.custom',\n        'emoji.use.own'\n      ];\n\n      if (basicPermissions.includes(permissionName)) {\n        return true;\n      }\n\n      // Admin permissions - only for user ID 1 (first user)\n      const adminPermissions = [\n        'admin.access',\n        'admin.emoji.approve',\n        'admin.users.view',\n        'admin.users.timeout',\n        'admin.posts.moderate'\n      ];\n\n      if (adminPermissions.includes(permissionName) && userId === 1) {\n        return true;\n      }\n\n      return false;\n    } catch (error) {\n      logger.group('fallbackPermissionCheck');\n      logger.error('Error in fallback permission check', error as Error, {\n        userId,\n        permissionName\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Get all permissions for a user\n   */\n  static async getUserPermissions(userId: number): Promise<Permission[]> {\n    try {\n      const result = await sql<Permission[]>`\n        SELECT DISTINCT p.id, p.name, p.display_name, p.description, p.category, p.is_inheritable, p.is_system\n        FROM permissions p\n        WHERE EXISTS (\n          -- Check role-based permissions\n          SELECT 1 FROM user_role_assignments ura\n          JOIN role_permissions rp ON ura.role_id = rp.role_id\n          WHERE ura.user_id = ${userId}\n          AND rp.permission_id = p.id\n          AND ura.is_active = true\n          AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n        ) OR EXISTS (\n          -- Check direct user permissions (granted)\n          SELECT 1 FROM user_permissions up\n          WHERE up.user_id = ${userId}\n          AND up.permission_id = p.id\n          AND up.granted = true\n          AND (up.expires_at IS NULL OR up.expires_at > CURRENT_TIMESTAMP)\n        )\n        AND NOT EXISTS (\n          -- Exclude explicitly denied permissions\n          SELECT 1 FROM user_permissions up\n          WHERE up.user_id = ${userId}\n          AND up.permission_id = p.id\n          AND up.granted = false\n          AND (up.expires_at IS NULL OR up.expires_at > CURRENT_TIMESTAMP)\n        )\n        ORDER BY p.category, p.name\n      `;\n\n      return result;\n    } catch (error) {\n      logger.group('getUserPermissions');\n      logger.error('Error getting user permissions', error as Error, {\n        userId\n      });\n      logger.groupEnd();\n      return [];\n    }\n  }\n\n  /**\n   * Get user's roles\n   */\n  static async getUserRoles(userId: number): Promise<UserRole[]> {\n    try {\n      const result = await sql<UserRole[]>`\n        SELECT ur.id, ur.name, ur.display_name, ur.description, ur.is_default, ur.is_system\n        FROM user_roles ur\n        JOIN user_role_assignments ura ON ur.id = ura.role_id\n        WHERE ura.user_id = ${userId}\n        AND ura.is_active = true\n        AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n        ORDER BY ur.name\n      `;\n\n      return result;\n    } catch (error) {\n      logger.group('getUserRoles');\n      logger.error('Error getting user roles', error as Error, { userId });\n      logger.groupEnd();\n      return [];\n    }\n  }\n\n  /**\n   * Check if user is timed out for a specific action\n   */\n  static async checkUserTimeout(\n    userId: number,\n    timeoutType: string = 'post_creation'\n  ): Promise<TimeoutCheck> {\n    try {\n      const result = await sql<TimeoutQueryResult[]>`\n        SELECT * FROM user_is_timed_out(${userId}, ${timeoutType})\n      `;\n\n      const row = result[0];\n      if (!row) {\n        return { is_timed_out: false };\n      }\n\n      return {\n        is_timed_out: row.is_timed_out,\n        expires_at: row.expires_at ? new Date(row.expires_at) : undefined,\n        reason: row.reason\n      };\n    } catch (error) {\n      logger.group('checkUserTimeout');\n      // If database function doesn't exist, fallback to no timeout\n      if (\n        error &&\n        typeof error === 'object' &&\n        'code' in error &&\n        error.code === '42883'\n      ) {\n        logger.warn('Timeout function not found, assuming no timeout', {\n          userId,\n          timeoutType,\n          errorCode: error.code\n        });\n        logger.groupEnd();\n        return { is_timed_out: false };\n      }\n      logger.error('Error checking user timeout', error as Error, {\n        userId,\n        timeoutType\n      });\n      logger.groupEnd();\n      return { is_timed_out: false };\n    }\n  }\n\n  /**\n   * Issue a timeout to a user\n   */\n  static async issueTimeout(\n    userId: number,\n    timeoutType: string,\n    reason: string,\n    durationHours: number,\n    issuedBy: number\n  ): Promise<boolean> {\n    try {\n      const expiresAt = new Date();\n      expiresAt.setHours(expiresAt.getHours() + durationHours);\n\n      await sql`\n        INSERT INTO user_timeouts (user_id, timeout_type, reason, issued_by, expires_at)\n        VALUES (${userId}, ${timeoutType}, ${reason}, ${issuedBy}, ${expiresAt})\n      `;\n\n      return true;\n    } catch (error) {\n      logger.group('issueTimeout');\n      logger.error('Error issuing timeout', error as Error, {\n        userId,\n        timeoutType,\n        reason,\n        durationHours,\n        issuedBy\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Revoke a user timeout\n   */\n  static async revokeTimeout(\n    timeoutId: number,\n    revokedBy: number,\n    reason?: string\n  ): Promise<boolean> {\n    try {\n      await sql`\n        UPDATE user_timeouts \n        SET is_active = false, revoked_by = ${revokedBy}, revoked_at = CURRENT_TIMESTAMP, revoke_reason = ${reason || null}\n        WHERE id = ${timeoutId}\n      `;\n\n      return true;\n    } catch (error) {\n      logger.group('revokeTimeout');\n      logger.error('Error revoking timeout', error as Error, {\n        timeoutId,\n        revokedBy,\n        reason\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Grant a permission to a user\n   */\n  static async grantPermission(\n    userId: number,\n    permissionName: string,\n    grantedBy: number,\n    reason?: string,\n    expiresAt?: Date\n  ): Promise<boolean> {\n    try {\n      // Get permission ID\n      const permissionResult = await sql<PermissionIdResult[]>`\n        SELECT id FROM permissions WHERE name = ${permissionName}\n      `;\n\n      if (permissionResult.length === 0) {\n        logger.warn('Permission not found', {\n          permissionName,\n          userId,\n          grantedBy\n        });\n        return false;\n      }\n\n      const permissionId = permissionResult[0].id;\n\n      // Insert or update permission\n      await sql`\n        INSERT INTO user_permissions (user_id, permission_id, granted, granted_by, reason, expires_at)\n        VALUES (${userId}, ${permissionId}, true, ${grantedBy}, ${reason || null}, ${expiresAt || null})\n        ON CONFLICT (user_id, permission_id) \n        DO UPDATE SET \n          granted = true,\n          granted_by = ${grantedBy},\n          granted_at = CURRENT_TIMESTAMP,\n          reason = ${reason || null},\n          expires_at = ${expiresAt || null}\n      `;\n\n      return true;\n    } catch (error) {\n      logger.group('grantPermission');\n      logger.error('Error granting permission', error as Error, {\n        userId,\n        permissionName,\n        grantedBy,\n        reason\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Revoke a permission from a user\n   */\n  static async revokePermission(\n    userId: number,\n    permissionName: string,\n    revokedBy: number,\n    reason?: string\n  ): Promise<boolean> {\n    try {\n      // Get permission ID\n      const permissionResult = await sql<PermissionIdResult[]>`\n        SELECT id FROM permissions WHERE name = ${permissionName}\n      `;\n\n      if (permissionResult.length === 0) {\n        logger.warn('Permission not found', {\n          permissionName,\n          userId,\n          revokedBy\n        });\n        return false;\n      }\n\n      const permissionId = permissionResult[0].id;\n\n      // Insert or update permission (denied)\n      await sql`\n        INSERT INTO user_permissions (user_id, permission_id, granted, granted_by, reason)\n        VALUES (${userId}, ${permissionId}, false, ${revokedBy}, ${reason || null})\n        ON CONFLICT (user_id, permission_id) \n        DO UPDATE SET \n          granted = false,\n          granted_by = ${revokedBy},\n          granted_at = CURRENT_TIMESTAMP,\n          reason = ${reason || null}\n      `;\n\n      return true;\n    } catch (error) {\n      logger.group('revokePermission');\n      logger.error('Error revoking permission', error as Error, {\n        userId,\n        permissionName,\n        revokedBy,\n        reason\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Assign a role to a user\n   */\n  static async assignRole(\n    userId: number,\n    roleName: string,\n    assignedBy: number,\n    expiresAt?: Date\n  ): Promise<boolean> {\n    try {\n      // Get role ID first\n      const roleResult = await sql<RoleQueryResult[]>`\n        SELECT id FROM user_roles WHERE name = ${roleName}\n      `;\n\n      if (roleResult.length === 0) {\n        logger.error('Role not found', undefined, {\n          roleName,\n          userId,\n          assignedBy\n        });\n        return false;\n      }\n\n      const roleId = roleResult[0].id;\n\n      // Check if role assignment already exists\n      const existingAssignment = await sql`\n        SELECT id FROM user_role_assignments \n        WHERE user_id = ${userId} AND role_id = ${roleId} AND is_active = true\n      `;\n\n      if (existingAssignment.length > 0) {\n        logger.error('Role already assigned to user', undefined, {\n          userId,\n          roleName,\n          assignedBy\n        });\n        return false;\n      }\n\n      // Insert role assignment\n      await sql`\n        INSERT INTO user_role_assignments (user_id, role_id, assigned_by, expires_at)\n        VALUES (${userId}, ${roleId}, ${assignedBy}, ${expiresAt || null})\n        ON CONFLICT (user_id, role_id) \n        DO UPDATE SET \n          is_active = true,\n          assigned_by = ${assignedBy},\n          assigned_at = CURRENT_TIMESTAMP,\n          expires_at = ${expiresAt || null}\n      `;\n\n      // Log successful role assignment (using error for visibility in production logs)\n      logger.group('assignRole');\n      logger.error(\n        `AUDIT: Role ${roleName} assigned to user ${userId} by user ${assignedBy}`,\n        undefined,\n        {\n          userId,\n          roleName,\n          roleId,\n          assignedBy,\n          action: 'ROLE_ASSIGNED',\n          audit: true\n        }\n      );\n      logger.groupEnd();\n\n      return true;\n    } catch (error) {\n      logger.group('assignRole');\n      logger.error('Error assigning role', error as Error, {\n        userId,\n        roleName,\n        assignedBy\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Remove a role from a user\n   */\n  static async removeRole(\n    userId: number,\n    roleName: string,\n    removedBy: number\n  ): Promise<boolean> {\n    try {\n      // Get role ID first\n      const roleResult = await sql<RoleQueryResult[]>`\n        SELECT id FROM user_roles WHERE name = ${roleName}\n      `;\n\n      if (roleResult.length === 0) {\n        logger.error('Role not found', undefined, {\n          roleName,\n          userId,\n          removedBy\n        });\n        return false;\n      }\n\n      const roleId = roleResult[0].id;\n\n      // Check if user has this role\n      const existingAssignment = await sql`\n        SELECT id FROM user_role_assignments \n        WHERE user_id = ${userId} AND role_id = ${roleId} AND is_active = true\n      `;\n\n      if (existingAssignment.length === 0) {\n        logger.error('User does not have this role', undefined, {\n          userId,\n          roleName,\n          removedBy\n        });\n        return false;\n      }\n\n      // Deactivate role assignment\n      await sql`\n        UPDATE user_role_assignments \n        SET is_active = false, removed_by = ${removedBy}, removed_at = CURRENT_TIMESTAMP\n        WHERE user_id = ${userId} AND role_id = ${roleId}\n      `;\n\n      // Log successful role removal\n      logger.group('removeRole');\n      logger.error(\n        `AUDIT: Role ${roleName} removed from user ${userId} by user ${removedBy}`,\n        undefined,\n        {\n          userId,\n          roleName,\n          roleId,\n          removedBy,\n          action: 'ROLE_REMOVED',\n          audit: true\n        }\n      );\n      logger.groupEnd();\n\n      return true;\n    } catch (error) {\n      logger.group('removeRole');\n      logger.error('Error removing role', error as Error, {\n        userId,\n        roleName,\n        removedBy\n      });\n      logger.groupEnd();\n      return false;\n    }\n  }\n\n  /**\n   * Get all available permissions\n   */\n  static async getAllPermissions(): Promise<Permission[]> {\n    try {\n      const result = await sql<Permission[]>`\n        SELECT id, name, display_name, description, category, is_inheritable, is_system\n        FROM permissions\n        ORDER BY category, name\n      `;\n\n      return result;\n    } catch (error) {\n      logger.group('getAllPermissions');\n      logger.error('Error getting all permissions', error as Error);\n      logger.groupEnd();\n      return [];\n    }\n  }\n\n  /**\n   * Get all available roles\n   */\n  static async getAllRoles(): Promise<UserRole[]> {\n    try {\n      const result = await sql<UserRole[]>`\n        SELECT id, name, display_name, description, is_default, is_system\n        FROM user_roles\n        ORDER BY name\n      `;\n\n      return result;\n    } catch (error) {\n      logger.group('getAllRoles');\n      logger.error('Error getting all roles', error as Error);\n      logger.groupEnd();\n      return [];\n    }\n  }\n\n  /**\n   * Get permissions by category\n   */\n  static async getPermissionsByCategory(\n    category: string\n  ): Promise<Permission[]> {\n    try {\n      const result = await sql<Permission[]>`\n        SELECT id, name, display_name, description, category, is_inheritable, is_system\n        FROM permissions\n        WHERE category = ${category}\n        ORDER BY name\n      `;\n\n      return result;\n    } catch (error) {\n      logger.group('getPermissionsByCategory');\n      logger.error('Error getting permissions by category', error as Error, {\n        category\n      });\n      logger.groupEnd();\n      return [];\n    }\n  }\n}\n\n/**\n * Permission middleware for API routes\n */\nexport async function requirePermission(\n  permissionName: string\n): Promise<boolean> {\n  return await PermissionsService.hasPermission(permissionName);\n}\n\n/**\n * Multiple permissions check (user must have ALL permissions)\n */\nexport async function requireAllPermissions(\n  permissionNames: string[]\n): Promise<boolean> {\n  for (const permission of permissionNames) {\n    if (!(await PermissionsService.hasPermission(permission))) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Multiple permissions check (user must have ANY permission)\n */\nexport async function requireAnyPermission(\n  permissionNames: string[]\n): Promise<boolean> {\n  for (const permission of permissionNames) {\n    if (await PermissionsService.hasPermission(permission)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Admin access check\n */\nexport async function requireAdmin(): Promise<boolean> {\n  // Prevent caching of admin checks\n  noStore();\n\n  const result = await PermissionsService.hasPermission('admin.access');\n\n  return result;\n}\n\n/**\n * Check if user can moderate content\n */\nexport async function canModerate(): Promise<boolean> {\n  return await requireAnyPermission(['admin.posts.moderate', 'admin.access']);\n}\n\n/**\n * Common permission constants\n */\nexport const PERMISSIONS = {\n  ADMIN: {\n    ACCESS: 'admin.access',\n    EMOJI_APPROVE: 'admin.emoji.approve',\n    EMOJI_MANAGE: 'admin.emoji.manage',\n    USERS_VIEW: 'admin.users.view',\n    USERS_TIMEOUT: 'admin.users.timeout',\n    USERS_MANAGE: 'admin.users.manage',\n    PERMISSIONS_VIEW: 'admin.permissions.view',\n    PERMISSIONS_MANAGE: 'admin.permissions.manage',\n    ROLES_VIEW: 'admin.roles.view',\n    ROLES_MANAGE: 'admin.roles.manage',\n    POSTS_MODERATE: 'admin.posts.moderate'\n  },\n  CONTENT: {\n    CREATE_POST: 'content.create.post',\n    EDIT_OWN: 'content.edit.own',\n    DELETE_OWN: 'content.delete.own',\n    COMMENT: 'content.comment'\n  },\n  EMOJI: {\n    USE_STANDARD: 'emoji.use.standard',\n    USE_CUSTOM: 'emoji.use.custom',\n    CREATE_CUSTOM: 'emoji.create.custom',\n    USE_OWN: 'emoji.use.own'\n  }\n} as const;\n\n/**\n * Timeout types\n */\nexport const TIMEOUT_TYPES = {\n  POST_CREATION: 'post_creation',\n  COMMENT_CREATION: 'comment_creation',\n  FULL_ACCESS: 'full_access'\n} as const;\n",
    "language":"typescript",
    "lines":791,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/actions/quota.actions.ts":{
    "content":"'use server';\n\nimport sql from '@/lib/db';\nimport { EnhancedQuotaService } from '@/lib/services/EnhancedQuotaService';\n\n// ================================\n// TYPES\n// ================================\n\nexport interface QuotaCheck {\n  allowed: boolean;\n  quota_limit: number;\n  current_usage: number;\n  remaining: number;\n  reset_date: Date | null;\n  reset_period: string;\n  is_unlimited: boolean;\n  quota_source: 'user_override' | 'subscription_plan' | 'global_guest' | 'system_default';\n  message?: string;\n}\n\nexport interface UsageRecord {\n  success: boolean;\n  new_usage_count: number;\n  quota_limit: number;\n  remaining: number;\n  message?: string;\n}\n\ninterface GuestIdentity {\n  client_ip: string;\n  machine_fingerprint?: string;\n  user_agent_hash?: string;\n}\n\n// ================================\n// SERVER ACTIONS\n// ================================\n\n/**\n * Check quota for guest users\n */\nexport async function checkGuestQuota(\n  guestIdentity: GuestIdentity,\n  serviceName: string,\n  featureName: string\n): Promise<QuotaCheck> {\n  try {\n    // 1. Check for global guest quota\n    const globalQuota = await sql`\n      SELECT * FROM global_guest_quotas\n      WHERE service_name = ${serviceName}\n      AND feature_name = ${featureName}\n      AND is_active = true\n    `;\n\n    if (globalQuota.length > 0) {\n      const quota = globalQuota[0];\n      const usage = await getGuestUsage(guestIdentity, serviceName, featureName, quota.reset_period);\n      return buildQuotaCheck(quota.quota_limit, usage, quota.reset_period, quota.is_unlimited, 'global_guest');\n    }\n\n    // 2. No quota found - return error state instead of fallback\n    return buildQuotaCheck(0, 0, 'daily', false, 'system_default', 'No guest quota configured for this service');\n\n  } catch (error) {\n    console.error('Error checking guest quota:', error);\n    return buildQuotaCheck(0, 0, 'daily', false, 'system_default', 'Error checking quota');\n  }\n}\n\n/**\n * Record usage for guest users\n */\nexport async function recordGuestUsage(\n  guestIdentity: GuestIdentity,\n  serviceName: string,\n  featureName: string,\n  usageCount: number = 1,\n  metadata?: any\n): Promise<UsageRecord> {\n  try {\n    // Record in guest_usage_tracking table\n    const result = await sql`\n      INSERT INTO guest_usage_tracking (\n        client_ip, service_name, feature_name, machine_fingerprint, user_agent_hash,\n        usage_date, usage_count, metadata\n      ) VALUES (\n        ${guestIdentity.client_ip}, \n        ${serviceName}, \n        ${featureName}, \n        ${guestIdentity.machine_fingerprint || null},\n        ${guestIdentity.user_agent_hash || null},\n        CURRENT_DATE, \n        ${usageCount}, \n        ${metadata ? JSON.stringify(metadata) : null}\n      )\n      ON CONFLICT (client_ip, machine_fingerprint, service_name, feature_name, usage_date)\n      DO UPDATE SET \n        usage_count = guest_usage_tracking.usage_count + ${usageCount},\n        updated_at = NOW(),\n        metadata = COALESCE(${metadata ? JSON.stringify(metadata) : null}, guest_usage_tracking.metadata)\n      RETURNING usage_count\n    `;\n\n    if (result.length > 0) {\n      // Get updated quota info\n      const quotaCheck = await checkGuestQuota(guestIdentity, serviceName, featureName);\n      return {\n        success: true,\n        new_usage_count: quotaCheck.current_usage,\n        quota_limit: quotaCheck.quota_limit,\n        remaining: quotaCheck.remaining,\n        message: 'Guest usage recorded successfully'\n      };\n    }\n\n    return {\n      success: false,\n      new_usage_count: 0,\n      quota_limit: 0,\n      remaining: 0,\n      message: 'Failed to record guest usage'\n    };\n\n  } catch (error) {\n    console.error('Error recording guest usage:', error);\n    return {\n      success: false,\n      new_usage_count: 0,\n      quota_limit: 0,\n      remaining: 0,\n      message: 'Error recording guest usage'\n    };\n  }\n}\n\n/**\n * Check quota for authenticated users\n */\nexport async function checkUserQuota(\n  userId: number,\n  serviceName: string,\n  featureName: string\n): Promise<QuotaCheck> {\n  try {\n    // 1. Check for user-specific override\n    const userOverride = await sql`\n      SELECT * FROM user_quota_overrides\n      WHERE user_id = ${userId} \n      AND service_name = ${serviceName} \n      AND feature_name = ${featureName}\n      AND is_active = true\n    `;\n\n    if (userOverride.length > 0) {\n      const override = userOverride[0];\n      const usage = await getUserUsage(userId, serviceName, featureName, override.reset_period);\n      return buildQuotaCheck(override.quota_limit, usage, override.reset_period, override.is_unlimited, 'user_override');\n    }\n\n    // 2. Check subscription plan quota - FIXED QUERY\n    const subscriptionQuota = await sql`\n      SELECT \n        COALESCE(pfv.feature_value::text::integer, sf.default_value::text::integer) as quota_limit,\n        CASE \n          WHEN COALESCE(pfv.feature_value::text::integer, sf.default_value::text::integer) = -1 THEN true\n          ELSE COALESCE(ps.is_unlimited, false)\n        END as is_unlimited,\n        'daily' as reset_period,\n        us.user_id,\n        sp.name as plan_name\n      FROM user_subscriptions us\n      JOIN subscription_plans sp ON us.plan_id = sp.id\n      JOIN plan_services ps ON sp.id = ps.plan_id\n      JOIN subscription_services ss ON ps.service_id = ss.id\n      JOIN subscription_features sf ON ss.id = sf.service_id\n      LEFT JOIN plan_feature_values pfv ON sp.id = pfv.plan_id AND sf.id = pfv.feature_id\n      WHERE us.user_id = ${userId}\n      AND us.status IN ('active', 'trialing')\n      AND (us.expires_at IS NULL OR us.expires_at > NOW())\n      AND ss.name = ${serviceName}\n      AND sf.name = ${featureName}\n      ORDER BY sp.sort_order DESC\n      LIMIT 1\n    `;\n\n    if (subscriptionQuota.length > 0) {\n      const quota = subscriptionQuota[0];\n      const usage = await getUserUsage(userId, serviceName, featureName, quota.reset_period);\n      return buildQuotaCheck(quota.quota_limit, usage, quota.reset_period, quota.is_unlimited, 'subscription_plan');\n    }\n\n    // 3. No subscription found - return error state instead of fallback\n    return buildQuotaCheck(0, 0, 'daily', false, 'system_default', `User ${userId} has no active subscription for ${serviceName}`);\n\n  } catch (error) {\n    console.error('Error checking user quota:', error);\n    return buildQuotaCheck(0, 0, 'daily', false, 'system_default', 'Error checking quota');\n  }\n}\n\n/**\n * Record usage for authenticated users\n */\nexport async function recordUserUsage(\n  userId: number,\n  serviceName: string,\n  featureName: string,\n  usageCount: number = 1,\n  metadata?: any\n): Promise<UsageRecord> {\n  try {\n    // Record in subscription_usage table\n    const result = await sql`\n      SELECT record_feature_usage(\n        ${userId}, \n        ${serviceName}, \n        ${featureName}, \n        ${usageCount},\n        ${metadata ? JSON.stringify(metadata) : null}\n      ) as success\n    `;\n\n    if (result[0]?.success) {\n      // Get updated usage info\n      const quotaCheck = await checkUserQuota(userId, serviceName, featureName);\n      return {\n        success: true,\n        new_usage_count: quotaCheck.current_usage,\n        quota_limit: quotaCheck.quota_limit,\n        remaining: quotaCheck.remaining,\n        message: 'Usage recorded successfully'\n      };\n    }\n\n    return {\n      success: false,\n      new_usage_count: 0,\n      quota_limit: 0,\n      remaining: 0,\n      message: 'Failed to record usage'\n    };\n\n  } catch (error) {\n    console.error('Error recording user usage:', error);\n    return {\n      success: false,\n      new_usage_count: 0,\n      quota_limit: 0,\n      remaining: 0,\n      message: 'Error recording usage'\n    };\n  }\n}\n\n// ================================\n// HELPER FUNCTIONS\n// ================================\n\nasync function getGuestUsage(\n  guestIdentity: GuestIdentity,\n  serviceName: string,\n  featureName: string,\n  resetPeriod: string\n): Promise<number> {\n  try {\n    let result;\n    \n    // Handle machine fingerprint properly to avoid PostgreSQL parameter type issues\n    const machineFingerprint = guestIdentity.machine_fingerprint || null;\n    \n    switch (resetPeriod) {\n      case 'daily':\n        if (machineFingerprint) {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint = ${machineFingerprint}\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date = CURRENT_DATE\n          `;\n        } else {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint IS NULL\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date = CURRENT_DATE\n          `;\n        }\n        break;\n      case 'weekly':\n        if (machineFingerprint) {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint = ${machineFingerprint}\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date >= DATE_TRUNC('week', CURRENT_DATE)\n          `;\n        } else {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint IS NULL\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date >= DATE_TRUNC('week', CURRENT_DATE)\n          `;\n        }\n        break;\n      case 'monthly':\n        if (machineFingerprint) {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint = ${machineFingerprint}\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date >= DATE_TRUNC('month', CURRENT_DATE)\n          `;\n        } else {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint IS NULL\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date >= DATE_TRUNC('month', CURRENT_DATE)\n          `;\n        }\n        break;\n      default:\n        if (machineFingerprint) {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint = ${machineFingerprint}\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date = CURRENT_DATE\n          `;\n        } else {\n          result = await sql`\n            SELECT COALESCE(SUM(usage_count), 0) as usage_count\n            FROM guest_usage_tracking\n            WHERE client_ip = ${guestIdentity.client_ip}\n            AND machine_fingerprint IS NULL\n            AND service_name = ${serviceName}\n            AND feature_name = ${featureName}\n            AND usage_date = CURRENT_DATE\n          `;\n        }\n    }\n    \n    return result[0]?.usage_count || 0;\n  } catch (error) {\n    console.error('Error getting guest usage:', error);\n    return 0;\n  }\n}\n\nasync function getUserUsage(\n  userId: number,\n  serviceName: string,\n  featureName: string,\n  resetPeriod: string\n): Promise<number> {\n  try {\n    // Use the same date range logic as EnhancedQuotaService for consistency\n    const { startDate, endDate } = getResetPeriodRange(resetPeriod);\n\n    const result = await sql`\n      SELECT COALESCE(SUM(su.usage_count), 0) as total_usage\n      FROM subscription_usage su\n      JOIN subscription_services ss ON su.service_id = ss.id\n      JOIN subscription_features sf ON su.feature_id = sf.id\n      WHERE su.user_id = ${userId}\n      AND ss.name = ${serviceName}\n      AND sf.name = ${featureName}\n      AND su.usage_date >= ${startDate}\n      AND su.usage_date <= ${endDate}\n    `;\n\n    return result[0]?.total_usage || 0;\n  } catch (error) {\n    console.error('Error getting user usage:', error);\n    return 0;\n  }\n}\n\n/**\n * Get the date range for a reset period (matching EnhancedQuotaService logic)\n */\nfunction getResetPeriodRange(resetPeriod: string): { startDate: Date; endDate: Date } {\n  const now = new Date();\n  const endDate = new Date(now);\n  let startDate: Date;\n\n  switch (resetPeriod) {\n    case 'hourly':\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours(), 0, 0, 0);\n      break;\n    \n    case 'daily':\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\n      break;\n    \n    case 'weekly': {\n      const dayOfWeek = now.getDay();\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - dayOfWeek, 0, 0, 0, 0);\n      break;\n    }\n    \n    case 'monthly':\n      startDate = new Date(now.getFullYear(), now.getMonth(), 1, 0, 0, 0, 0);\n      break;\n    \n    default:\n      startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0, 0);\n      break;\n  }\n\n  return { startDate, endDate };\n}\n\nfunction buildQuotaCheck(\n  quotaLimit: number,\n  currentUsage: number,\n  resetPeriod: string,\n  isUnlimited: boolean,\n  quotaSource: QuotaCheck['quota_source'],\n  message?: string\n): QuotaCheck {\n  const remaining = isUnlimited ? Infinity : Math.max(0, quotaLimit - currentUsage);\n  const allowed = isUnlimited || currentUsage < quotaLimit;\n  \n  // Calculate reset date based on period using the shared function\n  const resetDate = EnhancedQuotaService.calculateResetDate(resetPeriod);\n\n  return {\n    allowed,\n    quota_limit: isUnlimited ? -1 : quotaLimit,\n    current_usage: currentUsage,\n    remaining: isUnlimited ? -1 : remaining,\n    reset_date: resetDate,\n    reset_period: resetPeriod,\n    is_unlimited: isUnlimited,\n    quota_source: quotaSource,\n    message\n  };\n} ",
    "language":"typescript",
    "lines":463,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/actions/permissions.actions.ts":{
    "content":"'use server';\n\nimport { createLogger } from '@/lib/logging';\nimport { revalidatePath } from 'next/cache';\nimport { auth } from '../auth';\nimport sql from '../db';\nimport { PERMISSIONS } from '../permissions/permissions';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'PermissionActions',\n    module: 'actions'\n  },\n  enabled: false\n});\n\n/**\n * Server action to assign a role to a user\n * SECURITY: Admin and moderator roles can ONLY be assigned through direct database access\n */\nexport async function assignUserRole(\n  userId: number,\n  roleName: string,\n  expiresAt?: Date\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to assign roles');\n  }\n\n  const assignedBy = parseInt(session.user.id);\n\n  // CRITICAL SECURITY: Prevent admin and moderator role assignment through API/UI\n  const protectedRoles = ['admin', 'moderator'];\n  if (protectedRoles.includes(roleName)) {\n    logger.error(\n      'SECURITY VIOLATION: Attempt to assign protected role',\n      undefined,\n      {\n        roleName,\n        userId,\n        assignedBy,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    throw new Error(\n      `${roleName} roles can only be assigned through direct database access`\n    );\n  }\n\n  // Check if the person assigning has permission to manage roles\n  const hasPermission = await checkUserPermission(\n    assignedBy,\n    PERMISSIONS.ADMIN.ROLES_MANAGE\n  );\n  if (!hasPermission) {\n    logger.error(\n      'SECURITY VIOLATION: User attempted to assign role without permission',\n      undefined,\n      {\n        assignedBy,\n        roleName,\n        userId,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    throw new Error('Insufficient permissions to assign roles');\n  }\n\n  const roleResult = await sql<{ id: number; name: string }[]>`\n    SELECT id, name FROM user_roles WHERE name = ${roleName}\n  `;\n\n  if (roleResult.length === 0) {\n    throw new Error(`Role '${roleName}' not found`);\n  }\n\n  const roleId = roleResult[0].id;\n\n  // Double-check: Ensure we're not somehow assigning protected roles\n  if (protectedRoles.includes(roleResult[0].name)) {\n    logger.error(\n      'SECURITY VIOLATION: Double-check failed - protected role assignment blocked',\n      undefined,\n      {\n        roleName: roleResult[0].name,\n        userId,\n        assignedBy,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    throw new Error(\n      `${roleResult[0].name} roles can only be assigned through direct database access`\n    );\n  }\n\n  await sql`\n    INSERT INTO user_role_assignments (user_id, role_id, assigned_by, expires_at)\n    VALUES (${userId}, ${roleId}, ${assignedBy}, ${expiresAt ? expiresAt.toISOString() : null})\n    ON CONFLICT (user_id, role_id) \n    DO UPDATE SET \n      assigned_by = ${assignedBy},\n      assigned_at = CURRENT_TIMESTAMP,\n      expires_at = ${expiresAt ? expiresAt.toISOString() : null},\n      is_active = true\n  `;\n\n  logger.error('AUDIT: Role assigned to user', undefined, {\n    roleName,\n    userId,\n    assignedBy,\n    action: 'ROLE_ASSIGNED',\n    audit: true\n  });\n\n  revalidatePath('/admin');\n  return true;\n}\n\n/**\n * Server action to remove a role from a user\n * SECURITY: Admin and moderator roles can ONLY be removed through direct database access\n */\nexport async function removeUserRole(userId: number, roleName: string) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to remove roles');\n  }\n\n  const removedBy = parseInt(session.user.id);\n\n  // CRITICAL SECURITY: Prevent admin and moderator role removal through API/UI\n  const protectedRoles = ['admin', 'moderator'];\n  if (protectedRoles.includes(roleName)) {\n    logger.error(\n      'SECURITY VIOLATION: Attempt to remove protected role',\n      undefined,\n      {\n        roleName,\n        userId,\n        removedBy,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    throw new Error(\n      `${roleName} roles can only be removed through direct database access`\n    );\n  }\n\n  // Check if the person removing has permission to manage roles\n  const hasPermission = await checkUserPermission(\n    removedBy,\n    PERMISSIONS.ADMIN.ROLES_MANAGE\n  );\n  if (!hasPermission) {\n    logger.error(\n      'SECURITY VIOLATION: User attempted to remove role without permission',\n      undefined,\n      {\n        removedBy,\n        roleName,\n        userId,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    throw new Error('Insufficient permissions to remove roles');\n  }\n\n  await sql`\n    UPDATE user_role_assignments \n    SET is_active = false\n    WHERE user_id = ${userId}\n    AND role_id = (SELECT id FROM user_roles WHERE name = ${roleName})\n  `;\n\n  logger.error('AUDIT: Role removed from user', undefined, {\n    roleName,\n    userId,\n    removedBy,\n    action: 'ROLE_REMOVED',\n    audit: true\n  });\n\n  revalidatePath('/admin');\n  return true;\n}\n\n/**\n * Server action to check if a user has a specific permission\n */\nexport async function checkUserPermission(\n  userId: number,\n  permissionName: string\n): Promise<boolean> {\n  try {\n    // Check direct user permissions first (these override role permissions)\n    const directPermissionResult = await sql<{ granted: boolean }[]>`\n      SELECT granted \n      FROM user_permissions up\n      JOIN permissions p ON up.permission_id = p.id\n      WHERE up.user_id = ${userId} \n      AND p.name = ${permissionName}\n      AND (up.expires_at IS NULL OR up.expires_at > CURRENT_TIMESTAMP)\n    `;\n\n    // If found direct permission, return it\n    if (directPermissionResult.length > 0) {\n      return directPermissionResult[0].granted;\n    }\n\n    // Check role-based permissions\n    const rolePermissionResult = await sql<{ id: number }[]>`\n      SELECT p.id\n      FROM user_role_assignments ura\n      JOIN role_permissions rp ON ura.role_id = rp.role_id\n      JOIN permissions p ON rp.permission_id = p.id\n      WHERE ura.user_id = ${userId}\n      AND p.name = ${permissionName}\n      AND ura.is_active = true\n      AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n      LIMIT 1\n    `;\n\n    return rolePermissionResult.length > 0;\n  } catch (error) {\n    logger.error('Error checking user permission', error as Error, {\n      userId,\n      permissionName\n    });\n    return false;\n  }\n}\n\n/**\n * Server action to get current user's permissions\n */\nexport async function getCurrentUserPermissions() {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return [];\n  }\n\n  const userId = parseInt(session.user.id);\n\n  const result = await sql<\n    {\n      name: string;\n      display_name: string;\n      category: string;\n      granted?: boolean;\n    }[]\n  >`\n    SELECT DISTINCT \n      p.name,\n      p.display_name,\n      p.category,\n      COALESCE(up.granted, true) as granted\n    FROM permissions p\n    LEFT JOIN role_permissions rp ON p.id = rp.permission_id\n    LEFT JOIN user_role_assignments ura ON rp.role_id = ura.role_id \n      AND ura.user_id = ${userId} \n      AND ura.is_active = true\n      AND (ura.expires_at IS NULL OR ura.expires_at > CURRENT_TIMESTAMP)\n    LEFT JOIN user_permissions up ON p.id = up.permission_id \n      AND up.user_id = ${userId}\n      AND (up.expires_at IS NULL OR up.expires_at > CURRENT_TIMESTAMP)\n    WHERE (ura.user_id IS NOT NULL OR up.user_id IS NOT NULL)\n    AND COALESCE(up.granted, true) = true\n    ORDER BY p.category, p.name\n  `;\n\n  return result;\n}\n\n/**\n * Server action to issue a timeout to a user\n */\nexport async function issueUserTimeout(\n  userId: number,\n  timeoutType: string,\n  reason: string,\n  durationHours: number\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to issue timeouts');\n  }\n\n  const issuedBy = parseInt(session.user.id);\n\n  // Check if the person issuing has permission to timeout users\n  const hasPermission = await checkUserPermission(\n    issuedBy,\n    PERMISSIONS.ADMIN.USERS_TIMEOUT\n  );\n  if (!hasPermission) {\n    logger.error(\n      'SECURITY VIOLATION: User attempted to issue timeout without permission',\n      undefined,\n      {\n        issuedBy,\n        userId,\n        timeoutType,\n        reason,\n        durationHours,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    throw new Error('Insufficient permissions to issue timeouts');\n  }\n\n  const expiresAt = new Date();\n  expiresAt.setHours(expiresAt.getHours() + durationHours);\n\n  await sql`\n    INSERT INTO user_timeouts (\n      user_id, timeout_type, reason, issued_by, expires_at\n    ) VALUES (\n      ${userId}, ${timeoutType}, ${reason}, ${issuedBy}, ${expiresAt.toISOString()}\n    )\n  `;\n\n  logger.error('AUDIT: Timeout issued to user', undefined, {\n    userId,\n    issuedBy,\n    timeoutType,\n    reason,\n    durationHours,\n    expiresAt: expiresAt.toISOString(),\n    action: 'TIMEOUT_ISSUED',\n    audit: true\n  });\n\n  revalidatePath('/admin');\n  return true;\n}\n\n/**\n * Server action to check if current user is timed out\n */\nexport async function checkCurrentUserTimeout(\n  timeoutType: string = 'post_creation'\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return { is_timed_out: false, expires_at: null, reason: null };\n  }\n\n  const userId = parseInt(session.user.id);\n\n  const result = await sql<\n    {\n      expires_at: string;\n      reason: string;\n    }[]\n  >`\n    SELECT expires_at, reason\n    FROM user_timeouts\n    WHERE user_id = ${userId}\n    AND timeout_type = ${timeoutType}\n    AND is_active = true\n    AND expires_at > CURRENT_TIMESTAMP\n    ORDER BY expires_at DESC\n    LIMIT 1\n  `;\n\n  if (result.length === 0) {\n    return { is_timed_out: false, expires_at: null, reason: null };\n  }\n\n  return {\n    is_timed_out: true,\n    expires_at: new Date(result[0].expires_at),\n    reason: result[0].reason\n  };\n}\n",
    "language":"typescript",
    "lines":384,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/actions/emoji.actions.ts":{
    "content":"'use server';\n\nimport { createLogger } from '@/lib/logging';\nimport { revalidatePath } from 'next/cache';\nimport { auth } from '../auth';\nimport sql from '../db';\nimport { EmojiEncryptionService } from '../encryption/emoji-encryption';\nimport { PERMISSIONS } from '../permissions/permissions';\nimport { checkUserPermission } from './permissions.actions';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'EmojiActions',\n    module: 'actions'\n  },\n  enabled: false\n});\n\n/**\n * Server action to get OS-specific emojis for the current user\n */\nexport async function getOSEmojis(\n  userOS: 'windows' | 'mac' = 'windows',\n  category?: string,\n  search?: string,\n  limit: number = 50,\n  offset: number = 0\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to access emojis');\n  }\n\n  const userId = parseInt(session.user.id);\n\n  // Build the query based on OS\n  const tableName = userOS === 'mac' ? 'emojis_mac' : 'emojis_windows';\n\n  let whereClause = sql`WHERE 1=1`;\n\n  if (category) {\n    whereClause = sql`${whereClause} AND category_id = ${category}`;\n  }\n\n  if (search) {\n    const searchTerm = `%${search.toLowerCase()}%`;\n    whereClause = sql`${whereClause} AND (\n      LOWER(name) LIKE ${searchTerm} OR \n      LOWER(aliases::text) LIKE ${searchTerm} OR\n      LOWER(keywords::text) LIKE ${searchTerm}\n    )`;\n  }\n\n  // Get usage counts from emoji_usage table\n  const result = await sql<\n    {\n      id: number;\n      emoji_id: string;\n      name: string;\n      unicode_char: string;\n      category_id: number;\n      aliases: string[];\n      usage_count: number;\n    }[]\n  >`\n    SELECT \n      e.id, \n      e.emoji_id,\n      e.name, \n      e.unicode_char, \n      e.category_id, \n      e.aliases,\n      COALESCE(u.usage_count, 0) as usage_count\n    FROM ${sql(tableName)} e\n    LEFT JOIN emoji_usage u ON u.emoji_id = e.emoji_id::text \n      AND u.emoji_type = ${userOS} \n      AND u.user_id = ${userId}\n    ${whereClause}\n    ORDER BY usage_count DESC, e.name ASC\n    LIMIT ${limit} OFFSET ${offset}\n  `;\n\n  return result;\n}\n\n/**\n * Server action to get approved custom emojis\n */\nexport async function getCustomEmojis(\n  search?: string,\n  limit: number = 50,\n  offset: number = 0\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to access custom emojis');\n  }\n\n  const userId = parseInt(session.user.id);\n\n  let whereClause = sql`WHERE is_approved = true`;\n\n  if (search) {\n    const searchTerm = `%${search.toLowerCase()}%`;\n    whereClause = sql`${whereClause} AND (\n      LOWER(name) LIKE ${searchTerm} OR \n      LOWER(tags::text) LIKE ${searchTerm}\n    )`;\n  }\n\n  const result = await sql<\n    {\n      id: number;\n      emoji_id: string;\n      name: string;\n      encrypted_image_data: string;\n      category_id: number;\n      usage_count: number;\n      user_id: number;\n    }[]\n  >`\n    SELECT \n      c.id, \n      c.emoji_id,\n      c.name, \n      c.encrypted_image_data, \n      c.category_id, \n      COALESCE(u.usage_count, 0) as usage_count,\n      c.user_id\n    FROM custom_emojis c\n    LEFT JOIN emoji_usage u ON u.emoji_id = c.emoji_id::text \n      AND u.emoji_type = 'custom' \n      AND u.user_id = ${userId}\n    ${whereClause}\n    ORDER BY usage_count DESC, c.name ASC\n    LIMIT ${limit} OFFSET ${offset}\n  `;\n\n  // Decrypt image data for each emoji\n  const decryptedEmojis = await Promise.all(\n    result.map(async (emoji) => {\n      try {\n        const decryptedImageData =\n          await EmojiEncryptionService.decryptImageData(\n            {\n              ...JSON.parse(emoji.encrypted_image_data),\n              context: 'emoji' as const\n            },\n            emoji.user_id\n          );\n        return {\n          ...emoji,\n          image_data: decryptedImageData.toString('base64')\n        };\n      } catch (error) {\n        logger.group('getCustomEmojis');\n        logger.error('Failed to decrypt emoji', error as Error, {\n          emojiName: emoji.name,\n          emojiId: emoji.id,\n          userId: emoji.user_id\n        });\n        logger.groupEnd();\n        return {\n          ...emoji,\n          image_data: null\n        };\n      }\n    })\n  );\n\n  return decryptedEmojis;\n}\n\n/**\n * Server action to upload a custom emoji\n */\nexport async function uploadCustomEmoji(\n  name: string,\n  displayName: string,\n  imageData: string,\n  categoryId: number = 9 // Default to 'custom' category ID\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to upload custom emojis');\n  }\n\n  const userId = parseInt(session.user.id);\n\n  // Convert base64 to buffer and validate\n  const imageBuffer = Buffer.from(imageData, 'base64');\n  const format = 'png'; // Assume PNG for now, in production you'd detect format\n\n  const validation = EmojiEncryptionService.validateImageConstraints(\n    imageBuffer,\n    format\n  );\n  if (!validation.isValid) {\n    throw new Error(`Invalid image: ${validation.errors.join(', ')}`);\n  }\n\n  // Encrypt the image data\n  const encryptedData = await EmojiEncryptionService.encryptImageData(\n    imageBuffer,\n    'personal',\n    userId\n  );\n\n  // Generate a unique emoji_id\n  const emojiId = `custom_${name.toLowerCase().replace(/[^a-z0-9]/g, '_')}_${Date.now()}`;\n\n  // Insert the custom emoji (pending approval)\n  await sql`\n    INSERT INTO custom_emojis (\n      emoji_id, name, description, encrypted_image_data, category_id, user_id,\n      image_format, image_size_bytes, encryption_type\n    ) VALUES (\n      ${emojiId}, ${name}, ${displayName}, ${JSON.stringify(encryptedData)}, \n      ${categoryId}, ${userId}, ${format}, ${imageBuffer.length}, 'personal'\n    )\n  `;\n\n  logger.group('uploadCustomEmoji');\n  logger.error(\n    `AUDIT: Custom emoji '${name}' uploaded by user ${userId} - pending approval`,\n    undefined,\n    {\n      emojiName: name,\n      userId,\n      categoryId,\n      action: 'EMOJI_UPLOADED',\n      audit: true\n    }\n  );\n  logger.groupEnd();\n\n  return true;\n}\n\n/**\n * Server action to approve a custom emoji (admin only)\n */\nexport async function approveCustomEmoji(emojiId: number, reason?: string) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to approve emojis');\n  }\n\n  const userId = parseInt(session.user.id);\n\n  // Check if user has permission to approve emojis\n  const hasPermission = await checkUserPermission(\n    userId,\n    PERMISSIONS.ADMIN.EMOJI_APPROVE\n  );\n  if (!hasPermission) {\n    logger.group('approveEmoji');\n    logger.error(\n      'SECURITY VIOLATION: User attempted to approve emoji without permission',\n      undefined,\n      {\n        userId,\n        emojiId,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    logger.groupEnd();\n    throw new Error('Insufficient permissions to approve emojis');\n  }\n\n  try {\n    await sql`\n    UPDATE custom_emojis \n    SET \n      is_approved = true,\n      approved_by = ${userId},\n      approved_at = CURRENT_TIMESTAMP,\n      approval_reason = ${reason || null}\n    WHERE id = ${emojiId}\n  `;\n\n    revalidatePath('/admin');\n    logger.group('approveEmoji');\n    logger.error(\n      `AUDIT: Custom emoji ${emojiId} approved by user ${userId}`,\n      undefined,\n      {\n        emojiId,\n        userId,\n        reason,\n        action: 'EMOJI_APPROVED',\n        audit: true\n      }\n    );\n    logger.groupEnd();\n    return true;\n  } catch (error) {\n    logger.group('approveEmoji');\n    logger.error('Error approving emoji', error as Error, {\n      emojiId,\n      userId\n    });\n    logger.groupEnd();\n    throw new Error('Failed to approve emoji');\n  }\n}\n\n/**\n * Server action to reject a custom emoji (admin only)\n */\nexport async function rejectCustomEmoji(emojiId: number, reason: string) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to reject emojis');\n  }\n\n  const userId = parseInt(session.user.id);\n\n  // Check if user has permission to reject emojis\n  const hasPermission = await checkUserPermission(\n    userId,\n    PERMISSIONS.ADMIN.EMOJI_APPROVE\n  );\n  if (!hasPermission) {\n    logger.group('rejectEmoji');\n    logger.error(\n      'SECURITY VIOLATION: User attempted to reject emoji without permission',\n      undefined,\n      {\n        userId,\n        emojiId,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    logger.groupEnd();\n    throw new Error('Insufficient permissions to reject emojis');\n  }\n\n  try {\n    await sql`\n    UPDATE custom_emojis \n    SET \n      is_approved = false,\n      approved_by = ${userId},\n      approved_at = CURRENT_TIMESTAMP,\n      approval_reason = ${reason}\n    WHERE id = ${emojiId}\n  `;\n\n    revalidatePath('/admin');\n    logger.group('rejectEmoji');\n    logger.error(\n      `AUDIT: Custom emoji ${emojiId} rejected by user ${userId}`,\n      undefined,\n      {\n        emojiId,\n        userId,\n        reason,\n        action: 'EMOJI_REJECTED',\n        audit: true\n      }\n    );\n    logger.groupEnd();\n    return true;\n  } catch (error) {\n    logger.group('rejectEmoji');\n    logger.error('Error rejecting emoji', error as Error, {\n      emojiId,\n      userId,\n      reason\n    });\n    logger.groupEnd();\n    throw new Error('Failed to reject emoji');\n  }\n}\n\n/**\n * Server action to delete a custom emoji (admin only)\n */\nexport async function deleteCustomEmoji(emojiId: number, reason: string) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to delete emojis');\n  }\n\n  const userId = parseInt(session.user.id);\n\n  // Check if user has permission to delete emojis\n  const hasPermission = await checkUserPermission(\n    userId,\n    PERMISSIONS.ADMIN.EMOJI_MANAGE\n  );\n  if (!hasPermission) {\n    logger.group('deleteEmoji');\n    logger.error(\n      'SECURITY VIOLATION: User attempted to delete emoji without permission',\n      undefined,\n      {\n        userId,\n        emojiId,\n        action: 'SECURITY_VIOLATION',\n        audit: true\n      }\n    );\n    logger.groupEnd();\n    throw new Error('Insufficient permissions to delete emojis');\n  }\n\n  // Get emoji info for audit log\n  const emojiResult = await sql<{ name: string; user_id: number }[]>`\n    SELECT name, user_id FROM custom_emojis WHERE id = ${emojiId}\n  `;\n\n  if (emojiResult.length === 0) {\n    throw new Error('Emoji not found');\n  }\n\n  try {\n    await sql`\n    DELETE FROM custom_emojis WHERE id = ${emojiId}\n  `;\n\n    logger.group('deleteEmoji');\n    logger.error(\n      `AUDIT: Custom emoji '${emojiResult[0].name}' deleted by user ${userId}`,\n      undefined,\n      {\n        emojiId,\n        emojiName: emojiResult[0].name,\n        emojiOwnerId: emojiResult[0].user_id,\n        userId,\n        reason,\n        action: 'EMOJI_DELETED',\n        audit: true\n      }\n    );\n    logger.groupEnd();\n    revalidatePath('/admin');\n    return true;\n  } catch (error) {\n    logger.group('deleteEmoji');\n    logger.error('Error deleting emoji', error as Error, {\n      emojiId,\n      userId,\n      reason\n    });\n    logger.groupEnd();\n    throw new Error('Failed to delete emoji');\n  }\n}\n\n/**\n * Server action to get pending custom emojis for admin review\n */\nexport async function getPendingCustomEmojis(\n  limit: number = 50,\n  offset: number = 0\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    throw new Error('You must be logged in to view pending emojis');\n  }\n\n  const userId = parseInt(session.user.id);\n\n  // Check if user has permission to view pending emojis\n  const hasPermission = await checkUserPermission(\n    userId,\n    PERMISSIONS.ADMIN.EMOJI_APPROVE\n  );\n  if (!hasPermission) {\n    throw new Error('Insufficient permissions to view pending emojis');\n  }\n\n  const result = await sql<\n    {\n      id: number;\n      name: string;\n      description: string;\n      encrypted_image_data: string;\n      category: string;\n      user_id: number;\n      created_at: string;\n      creator_email: string;\n    }[]\n  >`\n    SELECT \n      ce.id, ce.name, ce.description, ce.encrypted_image_data, \n      ce.category_id::text as category, ce.user_id, ce.created_at,\n      u.email as creator_email\n    FROM custom_emojis ce\n    JOIN users u ON ce.user_id = u.id\n    WHERE ce.is_approved IS NULL\n    ORDER BY ce.created_at ASC\n    LIMIT ${limit} OFFSET ${offset}\n  `;\n\n  // Decrypt image data for each emoji\n  const decryptedEmojis = await Promise.all(\n    result.map(async (emoji) => {\n      try {\n        const decryptedImageData =\n          await EmojiEncryptionService.decryptImageData(\n            {\n              ...JSON.parse(emoji.encrypted_image_data),\n              context: 'emoji' as const\n            },\n            emoji.user_id\n          );\n        return {\n          ...emoji,\n          image_data: decryptedImageData.toString('base64')\n        };\n      } catch (error) {\n        logger.group('getPendingEmojis');\n        logger.error('Failed to decrypt pending emoji', error as Error, {\n          emojiName: emoji.name,\n          emojiId: emoji.id,\n          createdBy: emoji.user_id\n        });\n        logger.groupEnd();\n        return {\n          ...emoji,\n          image_data: null\n        };\n      }\n    })\n  );\n\n  return decryptedEmojis;\n}\n\n/**\n * Server action to track emoji usage\n */\nexport async function trackEmojiUsage(\n  emojiType: 'windows' | 'mac' | 'custom',\n  emojiId: number\n) {\n  const session = await auth();\n  if (!session?.user?.id) {\n    return; // Don't throw error for usage tracking\n  }\n\n  const userId = parseInt(session.user.id);\n\n  try {\n    // Update usage count in the appropriate table\n    if (emojiType === 'custom') {\n      await sql`\n        UPDATE custom_emojis \n        SET usage_count = usage_count + 1 \n        WHERE id = ${emojiId}\n      `;\n    } else {\n      const tableName = emojiType === 'mac' ? 'emojis_mac' : 'emojis_windows';\n      await sql`\n        UPDATE ${sql(tableName)} \n        SET usage_count = usage_count + 1 \n        WHERE id = ${emojiId}\n      `;\n    }\n\n    // Insert usage analytics record\n    await sql`\n      INSERT INTO emoji_usage_analytics (\n        user_id, emoji_type, emoji_id, used_at\n      ) VALUES (\n        ${userId}, ${emojiType}, ${emojiId}, CURRENT_TIMESTAMP\n      )\n    `;\n  } catch (error) {\n    logger.group('trackEmojiUsage');\n    logger.error('Failed to track emoji usage', error as Error, {\n      emojiType,\n      emojiId,\n      userId\n    });\n    logger.groupEnd();\n  }\n}\n\n/**\n * Server action to get emoji categories\n */\nexport async function getEmojiCategories(\n  userOS: 'windows' | 'mac' = 'windows'\n) {\n  const tableName = userOS === 'mac' ? 'emojis_mac' : 'emojis_windows';\n\n  const result = await sql<\n    {\n      category_id: number;\n      category_name: string;\n      display_name: string;\n      count: number;\n    }[]\n  >`\n    SELECT \n      ec.id as category_id,\n      ec.name as category_name, \n      ec.display_name,\n      COUNT(e.*) as count\n    FROM ${sql(tableName)} e\n    JOIN emoji_categories ec ON e.category_id = ec.id\n    WHERE e.is_active = true\n    GROUP BY ec.id, ec.name, ec.display_name, ec.sort_order\n    ORDER BY ec.sort_order, ec.name\n  `;\n\n  // Also get custom emoji categories\n  const customResult = await sql<\n    {\n      category_id: number;\n      category_name: string;\n      display_name: string;\n      count: number;\n    }[]\n  >`\n    SELECT \n      ec.id as category_id,\n      ec.name as category_name, \n      ec.display_name,\n      COUNT(c.*) as count\n    FROM custom_emojis c\n    JOIN emoji_categories ec ON c.category_id = ec.id\n    WHERE c.is_approved = true AND c.is_active = true\n    GROUP BY ec.id, ec.name, ec.display_name, ec.sort_order\n    ORDER BY ec.sort_order, ec.name\n  `;\n\n  return {\n    builtin: result,\n    custom: customResult\n  };\n}\n\n/**\n * Server action to get category name to ID mapping\n */\nexport async function getCategoryMapping(): Promise<Record<string, number>> {\n  const result = await sql<{ id: number; name: string }[]>`\n    SELECT id, name FROM emoji_categories\n    ORDER BY id\n  `;\n\n  const mapping: Record<string, number> = {};\n  result.forEach((category) => {\n    mapping[category.name.toLowerCase()] = category.id;\n  });\n\n  return mapping;\n}\n",
    "language":"typescript",
    "lines":657,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/actions/profile.actions.ts":{
    "content":"'use server';\n\nimport { createLogger } from '@/lib/logging';\nimport { revalidatePath } from 'next/cache';\nimport { auth } from '../auth';\nimport sql from '../db';\nimport { UserProfileData } from '../types/profile';\nimport { getEffectiveCharacterCount } from '../utils/string';\n\nconst logger = createLogger({\n  context: {\n    component: 'ProfileActions',\n    module: 'actions'\n  },\n  enabled: false\n});\n\nexport interface ProfileFilters {\n  username?: string;\n  userId?: string;\n  email?: string;\n}\n\n/**\n * @deprecated After migration 0011, use getUserProfileByDatabaseId() instead\n * This function is kept for backward compatibility but should not be used in new code\n */\nexport async function getUserProfile(\n  identifier: string\n): Promise<UserProfileData | null> {\n  logger.warn(\n    'getUserProfile() is deprecated. Use getUserProfileByDatabaseId() instead.'\n  );\n\n  // If it's a numeric ID, use the proper function\n  if (/^\\\\d+$/.test(identifier)) {\n    return getUserProfileByDatabaseId(identifier);\n  }\n\n  // For non-numeric identifiers, return null (no longer supported)\n  return null;\n}\n\n/**\n * Get user profile by database ID (internal ID)\n */\nexport async function getUserProfileByDatabaseId(\n  databaseId: string | number\n): Promise<UserProfileData | null> {\n  try {\n    const userResult = await sql`\n      SELECT \n        u.id,\n        u.name,\n        u.email,\n        u.bio,\n        u.location,\n        u.image,\n        u.created_at,\n        u.profile_public,\n        u.spacing_theme,\n        u.pagination_mode,\n        u.emoji_panel_behavior,\n        u.font_preference,\n        a.\\\"providerAccountId\\\"\n      FROM users u \n      LEFT JOIN accounts a ON u.id = a.\\\"userId\\\"\n      WHERE u.id = ${parseInt(databaseId.toString())}\n      LIMIT 1\n    `;\n\n    if (userResult.length === 0) {\n      return null;\n    }\n\n    const user = userResult[0];\n\n    // Get submission statistics\n    let stats = null;\n    try {\n      const submissionStats = await sql`\n        SELECT \n          COUNT(*) as total_submissions,\n          COUNT(CASE WHEN thread_parent_id IS NULL THEN 1 END) as posts_count,\n          COUNT(CASE WHEN thread_parent_id IS NOT NULL THEN 1 END) as replies_count,\n          MAX(submission_datetime) as last_activity\n        FROM submissions \n        WHERE user_id = ${user.id}\n      `;\n\n      if (submissionStats.length > 0) {\n        stats = submissionStats[0];\n      }\n    } catch (statsError) {\n      // Stats not available, continue without them\n    }\n\n    return {\n      id: user.id.toString(), // Use database internal ID for consistency\n      providerAccountId: user.providerAccountId, // Keep OAuth provider ID separate\n      username: user.name, // Use name as username for display\n      name: user.name,\n      email: user.email,\n      bio: user.bio,\n      location: user.location,\n      image: user.image,\n      created_at: user.created_at,\n      profile_public: user.profile_public,\n      spacing_theme: user.spacing_theme || 'cozy',\n      pagination_mode: user.pagination_mode || 'traditional',\n      emoji_panel_behavior: user.emoji_panel_behavior || 'close_after_select',\n      font_preference: user.font_preference || 'default',\n      total_submissions: stats ? parseInt(stats.total_submissions) : 0,\n      posts_count: stats ? parseInt(stats.posts_count) : 0,\n      replies_count: stats ? parseInt(stats.replies_count) : 0,\n      last_activity: stats?.last_activity || null\n    };\n  } catch (error) {\n    logger.error('Error fetching user profile by database ID', error as Error, {\n      id: databaseId\n    });\n    return null;\n  }\n}\n\n/**\n * Get user profile by user ID (for authenticated user's own profile)\n * This function handles both provider account IDs and database IDs\n */\nexport async function getUserProfileById(\n  userId: string\n): Promise<UserProfileData | null> {\n  try {\n    // First try as database ID (numeric)\n    if (/^\\\\d+$/.test(userId)) {\n      const result = await getUserProfileByDatabaseId(userId);\n      if (result) {\n        return result;\n      }\n    }\n\n    // Fallback to provider account ID lookup\n    const result = await sql`\n      SELECT \n        u.id,\n        u.name,\n        u.email,\n        u.bio,\n        u.location,\n        u.image,\n        u.created_at,\n        u.profile_public,\n        u.spacing_theme,\n        u.pagination_mode,\n        u.emoji_panel_behavior,\n        u.font_preference,\n        a.\\\"providerAccountId\\\"\n      FROM users u \n      LEFT JOIN accounts a ON u.id = a.\\\"userId\\\"\n      WHERE a.\\\"providerAccountId\\\" = ${userId}\n      LIMIT 1\n    `;\n\n    if (result.length === 0) {\n      return null;\n    }\n\n    const user = result[0];\n\n    // Get submission statistics\n    let stats = null;\n    try {\n      const submissionStats = await sql`\n        SELECT \n          COUNT(*) as total_submissions,\n          COUNT(CASE WHEN thread_parent_id IS NULL THEN 1 END) as posts_count,\n          COUNT(CASE WHEN thread_parent_id IS NOT NULL THEN 1 END) as replies_count,\n          MAX(submission_datetime) as last_activity\n        FROM submissions \n        WHERE user_id = ${user.id}\n      `;\n\n      if (submissionStats.length > 0) {\n        stats = submissionStats[0];\n      }\n    } catch (statsError) {\n      // Stats not available, continue without them\n    }\n\n    return {\n      id: user.id.toString(), // Use database internal ID for consistency with submissions\n      providerAccountId: user.providerAccountId, // Keep OAuth provider ID separate\n      username: user.name, // Use name as username for display\n      name: user.name,\n      email: user.email,\n      bio: user.bio,\n      location: user.location,\n      image: user.image,\n      created_at: user.created_at,\n      profile_public: user.profile_public,\n      spacing_theme: user.spacing_theme || 'cozy',\n      pagination_mode: user.pagination_mode || 'traditional',\n      emoji_panel_behavior: user.emoji_panel_behavior || 'close_after_select',\n      font_preference: user.font_preference || 'default',\n      total_submissions: stats ? parseInt(stats.total_submissions) : 0,\n      posts_count: stats ? parseInt(stats.posts_count) : 0,\n      replies_count: stats ? parseInt(stats.replies_count) : 0,\n      last_activity: stats?.last_activity || null\n    };\n  } catch (error) {\n    logger.error('Error fetching user profile by ID', error as Error, {\n      id: userId\n    });\n    return null;\n  }\n}\n\n/**\n * Update user profile\n */\nexport async function updateUserProfile(\n  userId: string,\n  updates: Partial<{\n    bio: string;\n    location: string;\n    profile_public: boolean;\n    spacing_theme: 'cozy' | 'compact';\n    pagination_mode: 'traditional' | 'infinite';\n    emoji_panel_behavior: 'close_after_select' | 'stay_open';\n    font_preference: 'monospace' | 'default';\n  }>\n): Promise<UserProfileData | null> {\n  try {\n    if (Object.keys(updates).length === 0) {\n      return getUserProfileById(userId);\n    }\n\n    // Build dynamic update query\n    const setClauses = [];\n    const values = [];\n    let paramIndex = 1;\n\n    if (updates.bio !== undefined) {\n      setClauses.push(`bio = $${paramIndex++}`);\n      values.push(updates.bio);\n    }\n    if (updates.location !== undefined) {\n      setClauses.push(`location = $${paramIndex++}`);\n      values.push(updates.location);\n    }\n    if (updates.profile_public !== undefined) {\n      setClauses.push(`profile_public = $${paramIndex++}`);\n      values.push(updates.profile_public);\n    }\n    if (updates.spacing_theme !== undefined) {\n      setClauses.push(`spacing_theme = $${paramIndex++}`);\n      values.push(updates.spacing_theme);\n    }\n    if (updates.pagination_mode !== undefined) {\n      setClauses.push(`pagination_mode = $${paramIndex++}`);\n      values.push(updates.pagination_mode);\n    }\n    if (updates.emoji_panel_behavior !== undefined) {\n      setClauses.push(`emoji_panel_behavior = $${paramIndex++}`);\n      values.push(updates.emoji_panel_behavior);\n    }\n    if (updates.font_preference !== undefined) {\n      setClauses.push(`font_preference = $${paramIndex++}`);\n      values.push(updates.font_preference);\n    }\n\n    if (setClauses.length === 0) {\n      return getUserProfileById(userId);\n    }\n\n    // Update user by providerAccountId or database ID\n    const queryText = `\n      UPDATE users \n      SET ${setClauses.join(', ')}\n      WHERE id IN (\n        SELECT u.id FROM users u \n        LEFT JOIN accounts a ON u.id = a.\\\"userId\\\"\n        WHERE a.\\\"providerAccountId\\\" = $${paramIndex} OR u.id::text = $${paramIndex}\n      )\n      RETURNING \n        id,\n        name,\n        email,\n        bio,\n        location,\n        image,\n        created_at,\n        profile_public,\n        spacing_theme,\n        pagination_mode,\n        emoji_panel_behavior,\n        font_preference\n    `;\n\n    const result = await sql.unsafe(queryText, [...values, userId]);\n\n    if (!result || result.length === 0) {\n      return null;\n    }\n\n    const updatedUser = result[0];\n\n    // Get the providerAccountId for the return value\n    const userWithAccount = await sql`\n      SELECT u.*, a.\\\"providerAccountId\\\"\n      FROM users u \n      LEFT JOIN accounts a ON u.id = a.\\\"userId\\\"\n      WHERE u.id = ${updatedUser.id}\n      LIMIT 1\n    `;\n\n    const userRow = userWithAccount[0] || updatedUser;\n\n    return {\n      id: userRow.id.toString(), // Use database internal ID for consistency with submissions\n      providerAccountId: userRow.providerAccountId, // Keep OAuth provider ID separate\n      username: userRow.name, // Use name as username for display\n      name: userRow.name,\n      email: userRow.email,\n      bio: userRow.bio,\n      location: userRow.location,\n      image: userRow.image,\n      created_at: userRow.created_at,\n      profile_public: userRow.profile_public,\n      spacing_theme: userRow.spacing_theme || 'cozy',\n      pagination_mode: userRow.pagination_mode || 'traditional',\n      emoji_panel_behavior:\n        userRow.emoji_panel_behavior || 'close_after_select',\n      font_preference: userRow.font_preference || 'default'\n    };\n  } catch (error) {\n    logger.error('Error updating user profile', error as Error, {\n      userId,\n      updates\n    });\n    return null;\n  }\n}\n\n/**\n * Search for users by username or name\n */\nexport async function searchUsers(\n  query: string,\n  limit: number = 10\n): Promise<UserProfileData[]> {\n  try {\n    const searchTerm = `%${query}%`;\n\n    const result = await sql`\n      SELECT \n        id,\n        username,\n        name,\n        email,\n        bio,\n        location,\n        image,\n        created_at,\n        profile_public\n      FROM users \n      WHERE profile_public = true\n      AND (\n        username ILIKE ${searchTerm}\n        OR name ILIKE ${searchTerm}\n      )\n      ORDER BY \n        CASE \n          WHEN username = ${query} THEN 1\n          WHEN name = ${query} THEN 2\n          WHEN username ILIKE ${query + '%'} THEN 3\n          WHEN name ILIKE ${query + '%'} THEN 4\n          ELSE 5\n        END,\n        username\n      LIMIT ${limit}\n    `;\n\n    return result.map((row) => ({\n      id: row.id.toString(),\n      username: row.username,\n      name: row.name,\n      email: row.email,\n      bio: row.bio,\n      location: row.location,\n      image: row.image,\n      created_at: row.created_at,\n      profile_public: row.profile_public\n    }));\n  } catch (error) {\n    logger.error('Error searching users', error as Error, { query, limit });\n    return [];\n  }\n}\n\n/**\n * Server action to update user bio (database ID only after migration 0010)\n */\nexport async function updateUserPreferencesAction(\n  userId: string,\n  preferences: {\n    spacing_theme?: 'cozy' | 'compact';\n    pagination_mode?: 'traditional' | 'infinite';\n    emoji_panel_behavior?: 'close_after_select' | 'stay_open';\n    font_preference?: 'monospace' | 'default';\n    profile_public?: boolean;\n  }\n): Promise<{\n  success: boolean;\n  error?: string;\n  profile?: UserProfileData;\n}> {\n  try {\n    const updatedProfile = await updateUserProfile(userId, preferences);\n\n    if (!updatedProfile) {\n      return {\n        success: false,\n        error: 'Failed to update user preferences'\n      };\n    }\n\n    return {\n      success: true,\n      profile: updatedProfile\n    };\n  } catch (error) {\n    logger.error('Error updating user preferences', error as Error, {\n      userId,\n      preferences\n    });\n    return {\n      success: false,\n      error: 'An error occurred while updating preferences'\n    };\n  }\n}\n\nexport async function updateBioAction(\n  bio: string,\n  identifier: string\n): Promise<{\n  success: boolean;\n  error?: string;\n  profile?: UserProfileData;\n}> {\n  try {\n    const session = await auth();\n\n    if (!session?.user?.id) {\n      return {\n        success: false,\n        error: 'Authentication required'\n      };\n    }\n\n    // Validate bio length\n    if (bio && getEffectiveCharacterCount(bio) > 500) {\n      return {\n        success: false,\n        error: 'Bio must be 500 characters or less'\n      };\n    }\n\n    // \u2705 CRITICAL: Only database ID supported after migration 0010\n    // Username-based lookups are no longer supported for maximum reliability\n    if (!/^\\\\d+$/.test(identifier)) {\n      return {\n        success: false,\n        error: 'Invalid profile identifier. Only database IDs are supported.'\n      };\n    }\n\n    // Direct database ID lookup - only supported method\n    const userProfile = await getUserProfileByDatabaseId(identifier);\n\n    if (!userProfile) {\n      return {\n        success: false,\n        error: 'User not found'\n      };\n    }\n\n    // Simple and secure: only check authenticated user ID\n    const canEdit = userProfile.id.toString() === session.user.id.toString();\n\n    if (!canEdit) {\n      return {\n        success: false,\n        error: 'You can only edit your own profile'\n      };\n    }\n\n    // Update the profile using database ID\n    const updatedProfile = await updateUserProfile(session.user.id, {\n      bio: bio || undefined\n    });\n\n    if (!updatedProfile) {\n      return {\n        success: false,\n        error: 'Failed to update profile'\n      };\n    }\n\n    // Get the complete profile with stats\n    const completeProfile = await getUserProfileById(session.user.id);\n\n    // Invalidate cache for database ID path only\n    revalidatePath(`/profile/${userProfile.id}`); // Database ID path (only supported)\n    revalidatePath('/profile'); // Profile listing pages\n    revalidatePath('/', 'layout'); // Revalidate layout cache for any user data in headers/nav\n\n    return {\n      success: true,\n      profile: completeProfile || updatedProfile\n    };\n  } catch (error) {\n    logger.error('Error updating user bio', error as Error, {\n      bioLength: bio?.length\n    });\n    return {\n      success: false,\n      error: 'Internal server error'\n    };\n  }\n}\n",
    "language":"typescript",
    "lines":533,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/actions/search.actions.ts":{
    "content":"'use server';\n\nimport sql from '../db';\nimport { serverLogger } from '../utils/server-logger';\n\n// Initialize materialized view refresher\nimport '../cron/refresh-materialized-views';\n\nexport interface HashtagResult {\n  id: string;\n  value: string;\n  label: string;\n  count: number;\n  type: 'hashtag';\n}\n\nexport interface UserResult {\n  id: string;\n  value: string; // This is the author_id for filtering\n  label: string;\n  displayName?: string; // This is the author name for display\n  avatar?: string;\n  type: 'user';\n}\n\nexport interface PaginatedHashtagResult {\n  items: HashtagResult[];\n  hasMore: boolean;\n  total: number;\n  page: number;\n  pageSize: number;\n}\n\nexport interface PaginatedUserResult {\n  items: UserResult[];\n  hasMore: boolean;\n  total: number;\n  page: number;\n  pageSize: number;\n}\n\n// Enhanced searchHashtags with pagination support\nexport async function searchHashtags(\n  query: string,\n  page: number = 1,\n  pageSize: number = 10\n): Promise<PaginatedHashtagResult> {\n  const startTime = performance.now();\n\n  // eslint-disable-next-line no-console\n  // console.log('searchHashtags called:', { query, page, pageSize });\n\n  if (!query || query.length < 2) {\n    // eslint-disable-next-line no-console\n    // console.log('searchHashtags: query too short or empty');\n    return { items: [], hasMore: false, total: 0, page, pageSize };\n  }\n\n  try {\n    const offset = (page - 1) * pageSize;\n\n    // Get total count for pagination - fixed to avoid duplicates\n    const totalResult = await sql<Array<{ total: string }>>`\n      SELECT COUNT(DISTINCT tag) as total \n      FROM (\n        SELECT unnest(tags) as tag\n        FROM submissions \n        WHERE tags IS NOT NULL \n      ) hashtag_search\n      WHERE tag ILIKE ${`%${query}%`}\n    `;\n\n    const total = parseInt(totalResult[0]?.total || '0');\n\n    // Get paginated results - fixed to avoid duplicates\n    const results = await sql<\n      Array<{\n        tag: string;\n        tag_count: number;\n      }>\n    >`\n      SELECT \n        tag,\n        COUNT(*) as tag_count\n      FROM (\n        SELECT unnest(tags) as tag\n        FROM submissions \n        WHERE tags IS NOT NULL \n      ) hashtag_search\n      WHERE tag ILIKE ${`%${query}%`}\n      GROUP BY tag\n      ORDER BY tag_count DESC, tag ASC\n      LIMIT ${pageSize}\n      OFFSET ${offset}\n    `;\n\n    const endTime = performance.now();\n    serverLogger.perf('searchHashtags', endTime - startTime, {\n      query,\n      page,\n      pageSize,\n      resultCount: results.length,\n      total\n    });\n\n    const items = results.map((result, index) => ({\n      id: `hashtag-${page}-${index}-${result.tag}`,\n      value: result.tag,\n      label: `${result.tag} (${result.tag_count} posts)`,\n      count: result.tag_count,\n      type: 'hashtag' as const\n    }));\n\n    // eslint-disable-next-line no-console\n    // console.log('searchHashtags results:', { items, hasMore: offset + results.length < total, total });\n\n    return {\n      items,\n      hasMore: offset + results.length < total,\n      total,\n      page,\n      pageSize\n    };\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('searchHashtags error:', error);\n    serverLogger.error('searchHashtags failed', error, {\n      query,\n      page,\n      pageSize\n    });\n    return { items: [], hasMore: false, total: 0, page, pageSize };\n  }\n}\n\n// Enhanced searchUsers with pagination support\nexport async function searchUsers(\n  query: string,\n  page: number = 1,\n  pageSize: number = 10\n): Promise<PaginatedUserResult> {\n  const startTime = performance.now();\n\n  if (!query || query.length < 2) {\n    return { items: [], hasMore: false, total: 0, page, pageSize };\n  }\n\n  try {\n    const offset = (page - 1) * pageSize;\n\n    // Get total count for pagination\n    let totalResult = await sql<Array<{ total: string }>>`\n      SELECT COUNT(*) as total\n      FROM user_stats\n      WHERE name ILIKE ${`%${query}%`}\n    `;\n\n    // Fall back to live query if materialized view is empty\n    if (parseInt(totalResult[0]?.total || '0') === 0) {\n      totalResult = await sql<Array<{ total: string }>>`\n        SELECT COUNT(DISTINCT u.id) as total\n        FROM users u\n        JOIN submissions s ON u.id = s.user_id\n        WHERE u.name ILIKE ${`%${query}%`}\n        AND s.user_id IS NOT NULL \n        AND u.name IS NOT NULL\n      `;\n    }\n\n    const total = parseInt(totalResult[0]?.total || '0');\n\n    // ULTRA-OPTIMIZED QUERY FOR MILLIONS OF RECORDS with pagination\n    // First try materialized view for better performance\n    let results = await sql<\n      Array<{\n        user_id: string;\n        name: string;\n        submission_count: number;\n      }>\n    >`\n      SELECT \n        user_id::text,\n        name,\n        submission_count\n      FROM user_stats\n      WHERE \n        name ILIKE ${`%${query}%`}\n      ORDER BY submission_count DESC, name ASC\n      LIMIT ${pageSize}\n      OFFSET ${offset}\n    `;\n\n    // If materialized view doesn't exist or is empty, fall back to live query\n    if (results.length === 0 && page === 1) {\n      results = await sql<\n        Array<{\n          user_id: string;\n          name: string;\n          submission_count: number;\n        }>\n      >`\n        WITH user_search AS (\n          -- Use optimized indexes for fast search\n          SELECT DISTINCT u.id, u.name\n          FROM users u\n          JOIN submissions s ON u.id = s.user_id\n          WHERE \n            u.name ILIKE ${`%${query}%`}\n            AND s.user_id IS NOT NULL \n            AND u.name IS NOT NULL  \n          LIMIT ${pageSize * 3} -- Get more for better accuracy\n          OFFSET ${offset}\n        )\n        SELECT \n          us.id::text as user_id,\n          us.name,\n          COUNT(s.submission_id)::integer as submission_count\n        FROM user_search us\n        LEFT JOIN submissions s ON s.user_id = us.id\n        GROUP BY us.id, us.name\n        ORDER BY submission_count DESC, name ASC\n        LIMIT ${pageSize}\n      `;\n    }\n\n    // Only log truly slow queries (>1000ms) in production\n    const endTime = performance.now();\n    const queryTime = endTime - startTime;\n\n    if (queryTime > 1000) {\n      serverLogger.slowQuery('searchUsers', queryTime, 1000);\n    }\n\n    const items = results.map((result, index) => ({\n      id: `user-${page}-${index}-${result.user_id}`,\n      value: result.user_id,\n      label: `${result.name} (${result.submission_count} posts)`,\n      displayName: result.name,\n      avatar: undefined,\n      type: 'user' as const\n    }));\n\n    return {\n      items,\n      hasMore: offset + results.length < total,\n      total,\n      page,\n      pageSize\n    };\n  } catch (error) {\n    serverLogger.error('searchUsers failed', error, { query, page, pageSize });\n    return { items: [], hasMore: false, total: 0, page, pageSize };\n  }\n}\n\n/**\n * Removed expensive debugging function that was running extra queries on every search\n * This was causing significant performance overhead\n */\n\n/**\n * OPTIMIZED: Get user information by username for millions of records\n */\nexport async function getUserInfo(\n  username: string\n): Promise<{ userId: string; username: string } | null> {\n  const startTime = performance.now();\n\n  if (!username) {\n    return null;\n  }\n\n  try {\n    const cleanUsername = username.startsWith('@')\n      ? username.slice(1)\n      : username;\n\n    // Try materialized view first for better performance\n    let result = await sql<Array<{ user_id: string; name: string }>>`\n      SELECT user_id::text as user_id, name\n      FROM user_stats \n      WHERE name = ${cleanUsername}\n      LIMIT 1\n    `;\n\n    // Fall back to live query if needed\n    if (result.length === 0) {\n      result = await sql<Array<{ user_id: string; name: string }>>`\n        SELECT u.id::text as user_id, u.name\n        FROM users u\n        JOIN submissions s ON u.id = s.user_id\n        WHERE u.name = ${cleanUsername}\n        LIMIT 1\n      `;\n    }\n\n    // Removed performance logging for frequently called function\n\n    if (result.length > 0) {\n      return {\n        userId: result[0].user_id,\n        username: result[0].name\n      };\n    }\n\n    // If no exact match, try case-insensitive search\n    const fallbackResult = await sql<Array<{ user_id: string; name: string }>>`\n      SELECT u.id::text as user_id, u.name\n      FROM users u\n      JOIN submissions s ON u.id = s.user_id\n      WHERE LOWER(u.name) = LOWER(${cleanUsername})\n      LIMIT 1\n    `;\n\n    return fallbackResult.length > 0\n      ? {\n          userId: fallbackResult[0].user_id,\n          username: fallbackResult[0].name\n        }\n      : null;\n  } catch (error) {\n    serverLogger.error('getUserInfo failed', error, { username });\n    return null;\n  }\n}\n\n/**\n * OPTIMIZED: Resolve user ID to username with caching consideration\n */\nexport async function resolveUserIdToUsername(\n  userId: string\n): Promise<string | null> {\n  const startTime = performance.now();\n\n  if (!userId) {\n    return null;\n  }\n\n  try {\n    // Try materialized view first\n    let result = await sql<Array<{ name: string }>>`\n      SELECT name\n      FROM user_stats \n      WHERE user_id = ${userId}\n      LIMIT 1\n    `;\n\n    // Fall back to live query if needed\n    if (result.length === 0) {\n      result = await sql<Array<{ name: string }>>`\n        SELECT u.name\n        FROM users u\n        WHERE u.id = ${userId}\n        LIMIT 1\n      `;\n    }\n\n    // Removed performance logging for frequently called function\n\n    return result.length > 0 ? result[0].name : null;\n  } catch (error) {\n    serverLogger.error('resolveUserIdToUsername failed', error, { userId });\n    return null;\n  }\n}\n\n/**\n * Refresh user statistics materialized view\n * Call this periodically (e.g., nightly) for optimal performance\n */\nexport async function refreshUserStats(): Promise<void> {\n  const startTime = performance.now();\n\n  try {\n    await sql`SELECT refresh_user_stats()`;\n\n    // Only log if refresh takes longer than expected\n    const endTime = performance.now();\n    const duration = endTime - startTime;\n    if (duration > 5000) {\n      // 5 seconds\n      serverLogger.slowQuery('refreshUserStats', duration, 5000);\n    }\n  } catch (error) {\n    serverLogger.error('refreshUserStats failed', error);\n  }\n}\n\n/**\n * Refresh tag statistics materialized view\n * Call this periodically (e.g., nightly) for optimal performance\n */\nexport async function refreshTagStats(): Promise<void> {\n  const startTime = performance.now();\n\n  try {\n    await sql`SELECT refresh_tag_statistics()`;\n\n    const endTime = performance.now();\n    serverLogger.perf('refreshTagStats', endTime - startTime);\n  } catch (error) {\n    serverLogger.error('refreshTagStats failed', error);\n  }\n}\n\n/**\n * Refresh trending posts materialized view\n * Call this periodically (e.g., every 6 hours) for optimal performance\n */\nexport async function refreshTrendingPosts(): Promise<void> {\n  const startTime = performance.now();\n\n  try {\n    await sql`SELECT refresh_trending_posts()`;\n\n    const endTime = performance.now();\n    serverLogger.perf('refreshTrendingPosts', endTime - startTime);\n  } catch (error) {\n    serverLogger.error('refreshTrendingPosts failed', error);\n  }\n}\n\n/**\n * Refresh daily statistics materialized view\n * Call this periodically (e.g., nightly) for optimal performance\n */\nexport async function refreshDailyStats(): Promise<void> {\n  const startTime = performance.now();\n\n  try {\n    await sql`SELECT refresh_daily_stats()`;\n\n    const endTime = performance.now();\n    serverLogger.perf('refreshDailyStats', endTime - startTime);\n  } catch (error) {\n    serverLogger.error('refreshDailyStats failed', error);\n  }\n}\n",
    "language":"typescript",
    "lines":439,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/actions/post.actions.ts":{
    "content":"'use server';\n\nimport { createLogger } from '@/lib/logging';\nimport { revalidatePath } from 'next/cache';\nimport { CustomSession } from 'src/auth.config';\nimport { auth } from '../auth';\nimport sql from '../db';\nimport { CreatePost, Post, PostSchema } from '../schemas/post.schemas';\n\n// Create component-specific logger\nconst logger = createLogger({\n  context: {\n    component: 'PostActions',\n    module: 'actions'\n  },\n  enabled: false\n});\n\nexport async function createPost(data: Omit<CreatePost, 'authorId'>) {\n  const session = (await auth()) as CustomSession;\n  if (!session || !session?.user) {\n    throw new Error('You must be logged in to create a post');\n  }\n\n  const { title, content, subthread } = data;\n\n  logger.group('createPost');\n  logger.info('Creating post', {\n    title,\n    subthread,\n    userEmail: session.user.email,\n    contentLength: content.length\n  });\n\n  // First, get the user's id from the users table\n  const userResult = await sql<{ id: string }[]>`\n    SELECT id FROM users WHERE email = ${session.user.email!}\n  `;\n\n  if (userResult.length === 0) {\n    logger.error('User not found', undefined, { email: session.user.email });\n    logger.groupEnd();\n    throw new Error('User not found'); // logout and login again to resolve\n  }\n\n  const userId = userResult[0].id;\n\n  const result = await sql<[Post]>`\n    INSERT INTO posts (title, content, author_id, subthread)\n    VALUES (${title}, ${content}, ${userId}, ${subthread})\n    RETURNING *\n  `;\n\n  logger.info('Post created successfully', {\n    postId: result[0].id,\n    userId,\n    title,\n    subthread\n  });\n  logger.groupEnd();\n\n  const post = PostSchema.parse(result[0]);\n\n  revalidatePath(`/t/${subthread}`);\n  return post;\n}\n\nexport async function getPosts(subthread?: string, limit = 20, offset = 0) {\n  const result = await sql<any[]>`\n    SELECT \n      submission_id,\n      submission_name,\n      submission_title,\n      submission_datetime,\n      author_id,\n      author,\n      COALESCE(tags, ARRAY[]::text[]) as tags,\n      thread_parent_id\n    FROM submissions\n    ${subthread ? sql`WHERE subthread = ${subthread}` : sql``}\n    ORDER BY submission_datetime DESC\n    LIMIT ${limit} OFFSET ${offset}\n  `;\n\n  return result.map((post) => PostSchema.parse(post));\n}\n\nexport async function getPost(id: string) {\n  const result = await sql<Post[]>`\n    SELECT * FROM posts WHERE id = ${id}\n  `;\n\n  if (result.length === 0) {\n    return null;\n  }\n\n  return PostSchema.parse(result[0]);\n}\n\nexport async function votePost(postId: string, voteType: 1 | -1) {\n  const session = await auth();\n  if (!session?.user) {\n    throw new Error('You must be logged in to vote');\n  }\n\n  await sql`\n    INSERT INTO votes (user_id, post_id, vote_type)\n    VALUES (${session.user.id!}, ${postId}, ${voteType})\n    ON CONFLICT (user_id, post_id)\n    DO UPDATE SET vote_type = ${voteType}\n  `;\n\n  await sql`\n    UPDATE posts\n    SET score = (\n      SELECT COALESCE(SUM(vote_type), 0)\n      FROM votes\n      WHERE post_id = ${postId}\n    )\n    WHERE id = ${postId}\n  `;\n\n  revalidatePath(`/t/[subthread]/comments/${postId}`);\n}\n",
    "language":"typescript",
    "lines":125,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/state/atoms.ts":{
    "content":"// Import batched updater from separate file\nimport { atom } from 'jotai';\nimport { atomWithStorage } from 'jotai/utils';\nimport { CONTEXT_IDS } from '../context-ids';\nimport { createLogger } from '../logging';\nimport { PostFilters } from '../types/filters';\n\n// Create logger for atoms state management\nconst logger = createLogger({\n  context: {\n    module: 'atoms'\n  }\n});\n\n// ============================================================================\n// CORE TYPES - Following existing patterns exactly\n// ============================================================================\n\nexport enum PageSize {\n  TEN = 10,\n  TWENTY = 20,\n  FIFTY = 50,\n  HUNDRED = 100\n}\n\n// Exact match to PaginationContext types\ntype TPaginationContext = PaginationPageActionPayload &\n  PaginationTotalPagesActionPayload &\n  PaginationPageSizeActionPayload;\n\ntype PaginationState = {\n  [x: string]: TPaginationContext | undefined;\n};\n\ntype PaginationPageActionPayload = {\n  id: string;\n  currentPage?: number;\n};\n\ntype PaginationTotalPagesActionPayload = {\n  id: string;\n  totalPages?: number;\n};\n\ntype PaginationPageSizeActionPayload = {\n  id: string;\n  pageSize?: PageSize;\n};\n\nexport type PaginationAction =\n  | { type: 'RESET_STATE' }\n  | { type: 'SET_CURRENT_PAGE'; payload: PaginationPageActionPayload }\n  | { type: 'SET_TOTAL_PAGES'; payload: PaginationTotalPagesActionPayload }\n  | { type: 'SET_PAGE_SIZE'; payload: PaginationPageSizeActionPayload };\n\nexport interface SubmissionsState {\n  loading: boolean;\n  data?: {\n    submissions: any[];\n    pagination: {\n      currentPage: number;\n      pageSize: number;\n      totalRecords: number;\n    };\n  };\n  error?: string;\n}\n\nexport interface Filter<T extends string = string> {\n  name: T;\n  value: string;\n}\n\nexport interface SubmissionsFilters {\n  onlyMine: boolean;\n  userId: string;\n  filters: Filter[];\n  page: number;\n  pageSize: number;\n  initialized: boolean;\n}\n\n// ShouldUpdate types\nexport type ShouldUpdateAction = {\n  type: 'SET_SHOULD_UPDATE';\n  payload: boolean;\n};\n\n// ============================================================================\n// GLOBAL ATOMS - Application-wide state\n// ============================================================================\n\n/**\n * Global pagination state atom - replaces PaginationContext\n * Maintains exact same structure as original context\n */\nconst initialPaginationState: PaginationState = {\n  default: {\n    id: 'default',\n    currentPage: 1,\n    totalPages: 1,\n    pageSize: PageSize.TEN\n  }\n};\n\nexport const paginationStateAtom = atom<PaginationState>(\n  initialPaginationState\n);\n\n/**\n * Global update trigger atom - replaces ShouldUpdateContext\n */\nexport const shouldUpdateAtom = atom<boolean>(false);\n\n/**\n * Global session state atom (optional, for caching)\n */\nexport const sessionCacheAtom = atomWithStorage<any>('session-cache', null);\n\n// Custom storage for avatar cache with size limits and error handling\nconst createAvatarCacheStorage = () => {\n  const STORAGE_KEY = 'avatar-cache-v3-adventurer';\n  const MAX_CACHE_SIZE = 100;\n\n  return {\n    getItem: (key: string): Record<string, string> => {\n      try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (!stored) return {};\n        \n        const parsed = JSON.parse(stored);\n        return typeof parsed === 'object' && parsed !== null ? parsed : {};\n      } catch (error) {\n        console.warn('Failed to load avatar cache, clearing:', error);\n        localStorage.removeItem(STORAGE_KEY);\n        return {};\n      }\n    },\n    setItem: (key: string, value: Record<string, string>): void => {\n      try {\n        // Limit cache size to prevent quota exceeded errors\n        const entries = Object.entries(value);\n        if (entries.length > MAX_CACHE_SIZE) {\n          // Keep only the most recent entries\n          const limitedEntries = entries.slice(-MAX_CACHE_SIZE);\n          value = Object.fromEntries(limitedEntries);\n        }\n        \n        localStorage.setItem(STORAGE_KEY, JSON.stringify(value));\n      } catch (error) {\n        if (error instanceof Error && error.name === 'QuotaExceededError') {\n          console.warn('Avatar cache quota exceeded, clearing old entries');\n          // Clear the cache and try to store just the current value\n          try {\n            localStorage.removeItem(STORAGE_KEY);\n            const entries = Object.entries(value);\n            if (entries.length > 10) {\n              // If still too large, keep only 10 most recent\n              const limitedEntries = entries.slice(-10);\n              value = Object.fromEntries(limitedEntries);\n            }\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(value));\n          } catch (retryError) {\n            console.error('Failed to store avatar cache even after cleanup:', retryError);\n          }\n        } else {\n          console.error('Failed to store avatar cache:', error);\n        }\n      }\n    },\n    removeItem: (key: string): void => {\n      localStorage.removeItem(STORAGE_KEY);\n    }\n  };\n};\n\n/**\n * Avatar cache atom - stores generated avatar SVGs to prevent regeneration\n * v3: Added size limits and cleanup to prevent quota exceeded errors\n */\nexport const avatarCacheAtom = atomWithStorage<Record<string, string>>(\n  'avatar-cache-v3-adventurer',\n  {},\n  createAvatarCacheStorage()\n);\n\n// ============================================================================\n// PAGINATION ACTIONS - Exact match to PaginationContext reducer\n// ============================================================================\n\n/**\n * Pagination reducer logic as atom actions\n * Maintains exact same behavior as original context\n */\nconst getCurrentPage = (currentPage?: number) => Math.max(currentPage ?? 1, 1);\nconst getTotalPages = (totalPages?: number) => Math.max(totalPages ?? 1, 1);\n\nexport const paginationActionAtom = atom(\n  null,\n  (get, set, action: PaginationAction) => {\n    const state = get(paginationStateAtom);\n\n    switch (action.type) {\n      case 'SET_CURRENT_PAGE':\n        set(paginationStateAtom, {\n          ...state,\n          [action.payload.id]: {\n            ...state[action.payload.id],\n            id: action.payload.id,\n            currentPage: getCurrentPage(action.payload.currentPage)\n          }\n        });\n        break;\n      case 'SET_TOTAL_PAGES':\n        set(paginationStateAtom, {\n          ...state,\n          [action.payload.id]: {\n            ...state[action.payload.id],\n            id: action.payload.id,\n            totalPages: getTotalPages(action.payload.totalPages)\n          }\n        });\n        break;\n      case 'SET_PAGE_SIZE':\n        set(paginationStateAtom, {\n          ...state,\n          [action.payload.id]: {\n            ...state[action.payload.id],\n            id: action.payload.id,\n            pageSize:\n              action.payload.pageSize ||\n              state[action.payload.id]?.pageSize ||\n              PageSize.TEN\n          }\n        });\n        break;\n      case 'RESET_STATE':\n        set(paginationStateAtom, initialPaginationState);\n        break;\n    }\n  }\n);\n\n/**\n * Should update action atom - replaces ShouldUpdateContext dispatch\n */\nexport const shouldUpdateActionAtom = atom(\n  null,\n  (get, set, action: ShouldUpdateAction) => {\n    switch (action.type) {\n      case 'SET_SHOULD_UPDATE':\n        set(shouldUpdateAtom, action.payload);\n        break;\n    }\n  }\n);\n\n// ============================================================================\n// ATOM REGISTRIES - Per-context state management\n// ============================================================================\n\n/**\n * Registry for submissions state atoms by context\n */\nclass SubmissionsStateAtomRegistry {\n  private static instance: SubmissionsStateAtomRegistry;\n  private atoms = new Map<string, ReturnType<typeof atom<SubmissionsState>>>();\n\n  static getInstance(): SubmissionsStateAtomRegistry {\n    if (!SubmissionsStateAtomRegistry.instance) {\n      SubmissionsStateAtomRegistry.instance =\n        new SubmissionsStateAtomRegistry();\n    }\n    return SubmissionsStateAtomRegistry.instance;\n  }\n\n  getAtom(contextId: string) {\n    if (!this.atoms.has(contextId)) {\n      this.atoms.set(\n        contextId,\n        atom<SubmissionsState>({\n          loading: false,\n          data: undefined,\n          error: undefined\n        })\n      );\n    }\n    return this.atoms.get(contextId)!;\n  }\n\n  clearAtom(contextId: string) {\n    this.atoms.delete(contextId);\n  }\n}\n\n/**\n * Registry for submissions filters atoms by context\n */\nclass SubmissionsFiltersAtomRegistry {\n  private static instance: SubmissionsFiltersAtomRegistry;\n  private atoms = new Map<\n    string,\n    ReturnType<typeof atomWithStorage<SubmissionsFilters>>\n  >();\n\n  static getInstance(): SubmissionsFiltersAtomRegistry {\n    if (!SubmissionsFiltersAtomRegistry.instance) {\n      SubmissionsFiltersAtomRegistry.instance =\n        new SubmissionsFiltersAtomRegistry();\n    }\n    return SubmissionsFiltersAtomRegistry.instance;\n  }\n\n  private getStorageKey(contextId: string): string {\n    // Create route-scoped storage key based on context ID\n    // This ensures consistent storage keys regardless of when the atom is created\n    const routeMap: Record<string, string> = {\n      [CONTEXT_IDS.POSTS.toString()]: '/posts',\n      [CONTEXT_IDS.MY_POSTS.toString()]: '/my-posts',\n      [CONTEXT_IDS.THREAD.toString()]: '/thread',\n      [CONTEXT_IDS.ADMIN_POSTS.toString()]: '/admin'\n    };\n\n    const route = routeMap[contextId] || '/posts'; // Default to /posts if no mapping\n    const storageKey = `filters-${route}-${contextId}`;\n\n    // Debug logging to help verify the fix\n    if (typeof window !== 'undefined') {\n      logger.debug('Filter storage key generated', {\n        contextId,\n        route,\n        storageKey,\n        currentPath: window.location.pathname,\n        localStorage: localStorage.getItem(storageKey)\n      });\n    }\n\n    return storageKey;\n  }\n\n  getAtom(contextId: string) {\n    if (!this.atoms.has(contextId)) {\n      const storageKey = this.getStorageKey(contextId);\n      const defaultValue: SubmissionsFilters = {\n        onlyMine: false,\n        userId: '',\n        filters: [],\n        page: 1,\n        pageSize: 10,\n        initialized: false\n      };\n\n      // Create the atom with storage\n      const atom = atomWithStorage<SubmissionsFilters>(\n        storageKey,\n        defaultValue\n      );\n\n      // Debug logging for atom creation\n      if (typeof window !== 'undefined') {\n        logger.debug('Creating filter atom', {\n          contextId,\n          storageKey,\n          defaultValue,\n          existingValue: localStorage.getItem(storageKey)\n        });\n      }\n\n      this.atoms.set(contextId, atom);\n    }\n    return this.atoms.get(contextId)!;\n  }\n\n  clearAtom(contextId: string) {\n    // Clear from memory\n    this.atoms.delete(contextId);\n\n    // Clear from localStorage\n    if (typeof window !== 'undefined') {\n      const storageKey = this.getStorageKey(contextId);\n      localStorage.removeItem(storageKey);\n    }\n  }\n\n  // Clear all route-scoped filters (for logout/cache clearing)\n  clearAllRouteFilters() {\n    if (typeof window !== 'undefined') {\n      const keysToRemove: string[] = [];\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key && key.startsWith('filters-')) {\n          keysToRemove.push(key);\n        }\n      }\n      keysToRemove.forEach((key) => localStorage.removeItem(key));\n    }\n\n    // Clear memory atoms\n    this.atoms.clear();\n  }\n}\n\n/**\n * Registry for display filters atoms by context\n */\nclass DisplayFiltersAtomRegistry {\n  private static instance: DisplayFiltersAtomRegistry;\n  private atoms = new Map<string, any>();\n\n  static getInstance(): DisplayFiltersAtomRegistry {\n    if (!DisplayFiltersAtomRegistry.instance) {\n      DisplayFiltersAtomRegistry.instance = new DisplayFiltersAtomRegistry();\n    }\n    return DisplayFiltersAtomRegistry.instance;\n  }\n\n  getAtom(contextId: string) {\n    if (!this.atoms.has(contextId)) {\n      const filtersAtom = getSubmissionsFiltersAtom(contextId);\n      this.atoms.set(\n        contextId,\n        atom(\n          (get) => get(filtersAtom).filters,\n          (get, set, newFilters: Filter[]) => {\n            const current = get(filtersAtom);\n            set(filtersAtom, {\n              ...current,\n              filters: newFilters,\n              page: 1 // Reset to page 1 when filters change\n            });\n          }\n        )\n      );\n    }\n    return this.atoms.get(contextId)!;\n  }\n\n  clearAtom(contextId: string) {\n    this.atoms.delete(contextId);\n  }\n}\n\n// ============================================================================\n// PUBLIC API - Interface Segregation Principle\n// ============================================================================\n\n/**\n * Get submissions state atom for a specific context\n */\nexport const getSubmissionsStateAtom = (contextId: string) => {\n  return SubmissionsStateAtomRegistry.getInstance().getAtom(contextId);\n};\n\n/**\n * Get submissions filters atom for a specific context\n */\nexport const getSubmissionsFiltersAtom = (contextId: string) => {\n  return SubmissionsFiltersAtomRegistry.getInstance().getAtom(contextId);\n};\n\n/**\n * Get display filters atom for a specific context\n */\nexport const getDisplayFiltersAtom = (contextId: string) => {\n  return DisplayFiltersAtomRegistry.getInstance().getAtom(contextId);\n};\n\n// ============================================================================\n// COMPUTED ATOMS - Derived state\n// ============================================================================\n\n/**\n * Computed pagination state with derived values\n */\nexport const createPaginationComputedAtom = (contextId: string) => {\n  return atom((get) => {\n    const state = get(paginationStateAtom);\n    const pagination = state[contextId];\n\n    if (!pagination) {\n      return {\n        id: contextId,\n        currentPage: 1,\n        totalPages: 1,\n        pageSize: PageSize.TEN,\n        hasNextPage: false,\n        hasPreviousPage: false,\n        isFirstPage: true,\n        isLastPage: true\n      };\n    }\n\n    return {\n      ...pagination,\n      hasNextPage: (pagination.currentPage ?? 1) < (pagination.totalPages ?? 1),\n      hasPreviousPage: (pagination.currentPage ?? 1) > 1,\n      isFirstPage: (pagination.currentPage ?? 1) === 1,\n      isLastPage: (pagination.currentPage ?? 1) === (pagination.totalPages ?? 1)\n    };\n  });\n};\n\n/**\n * Computed submissions state with derived values\n */\nexport const createSubmissionsComputedAtom = (contextId: string) => {\n  const stateAtom = getSubmissionsStateAtom(contextId);\n  const filtersAtom = getSubmissionsFiltersAtom(contextId);\n\n  return atom((get) => {\n    const state = get(stateAtom);\n    const filters = get(filtersAtom);\n\n    return {\n      ...state,\n      totalPages: state.data?.pagination.totalRecords\n        ? Math.ceil(\n            state.data.pagination.totalRecords / state.data.pagination.pageSize\n          )\n        : 0,\n      currentPage: filters.page,\n      pageSize: filters.pageSize,\n      hasData: !!state.data?.submissions.length,\n      isEmpty: !state.loading && !state.data?.submissions.length\n    };\n  });\n};\n\n// ============================================================================\n// UTILITY FUNCTIONS - Dependency Inversion Principle\n// ============================================================================\n\n/**\n * Initialize pagination state from URL parameters\n * Respects server-side rendering and maintains exact PaginationProvider behavior\n */\nexport const initializePaginationFromUrl = (\n  contextId: string,\n  searchParams: URLSearchParams\n): PaginationState => {\n  const pageParam = searchParams.get('page');\n  const pageSizeParam = searchParams.get('pageSize');\n\n  // Parse and validate pageSize\n  let pageSize = PageSize.TEN;\n  if (pageSizeParam) {\n    const parsed = parseInt(pageSizeParam);\n    if (\n      !isNaN(parsed) &&\n      Object.values(PageSize).includes(parsed as PageSize)\n    ) {\n      pageSize = parsed as PageSize;\n    }\n  }\n\n  return {\n    [contextId]: {\n      id: contextId,\n      currentPage: pageParam ? Math.max(1, parseInt(pageParam)) : 1,\n      totalPages: 1, // Will be updated when data loads\n      pageSize\n    }\n  };\n};\n\n/**\n * Initialize filters state from URL parameters and props\n * Maintains security through input validation\n */\nexport const initializeFiltersFromUrl = (\n  contextId: string,\n  searchParams: URLSearchParams,\n  onlyMine: boolean,\n  userId: string,\n  initialFilters: Filter[] = []\n) => {\n  const pageParam = searchParams.get('page');\n  const tagsParam = searchParams.get('tags');\n  const authorParam = searchParams.get('author');\n  const searchParam = searchParams.get('search');\n  const pageSizeParam = searchParams.get('pageSize');\n\n  // Validate and sanitize tags parameter using unified utilities\n  const sanitizedTags = tagsParam\n    ? (() => {\n        const {\n          normalizeTagForDatabase,\n          formatTagForDisplay\n        } = require('../utils/string/tag-utils');\n        return tagsParam\n          .split(',')\n          .map((tag) => normalizeTagForDatabase(tag))\n          .filter(Boolean)\n          .map(formatTagForDisplay)\n          .join(',');\n      })()\n    : '';\n\n  // Validate and sanitize author parameter\n  const sanitizedAuthor = authorParam\n    ? authorParam.trim().slice(0, 100) // Limit length and trim\n    : '';\n\n  // Validate and sanitize search parameter\n  const sanitizedSearch = searchParam\n    ? searchParam.trim().slice(0, 200) // Limit length and trim\n    : '';\n\n  // Build filters array - create individual filter entries, not comma-separated\n  const filters: Filter[] = [];\n\n  if (sanitizedTags) {\n    // Split comma-separated tags into individual filter entries\n    const tags = sanitizedTags.split(',').map(tag => tag.trim()).filter(Boolean);\n    tags.forEach(tag => {\n      filters.push({ name: 'tags', value: tag });\n    });\n  }\n\n  if (sanitizedAuthor) {\n    // Split comma-separated authors into individual filter entries\n    const authors = sanitizedAuthor.split(',').map(author => author.trim()).filter(Boolean);\n    authors.forEach(author => {\n      filters.push({ name: 'author', value: author });\n    });\n  }\n\n  if (sanitizedSearch) {\n    filters.push({ name: 'search', value: sanitizedSearch });\n  }\n\n  // If no filters from URL, use initial filters\n  const finalFilters = filters.length > 0 ? filters : initialFilters;\n\n  return {\n    onlyMine,\n    userId,\n    filters: finalFilters,\n    page: pageParam ? Math.max(1, parseInt(pageParam)) : 1,\n    pageSize: pageSizeParam ? Math.max(10, parseInt(pageSizeParam)) : 10,\n    initialized: true\n  };\n};\n\n/**\n * Add a new submission to the beginning of the submissions list\n * for optimistic updates\n */\nexport const addSubmissionToList = (contextId: string, submission: any) => {\n  const stateAtom = getSubmissionsStateAtom(contextId);\n\n  return atom(null, (get, set) => {\n    const currentState = get(stateAtom);\n\n    if (currentState.data) {\n      const updatedSubmissions = [submission, ...currentState.data.submissions];\n      const updatedPagination = {\n        ...currentState.data.pagination,\n        totalRecords: currentState.data.pagination.totalRecords + 1\n      };\n\n      set(stateAtom, {\n        ...currentState,\n        data: {\n          submissions: updatedSubmissions,\n          pagination: updatedPagination\n        }\n      });\n    }\n  });\n};\n\n/**\n * Update a specific submission in the submissions list\n * for optimistic updates after edit operations\n */\nexport const updateSubmissionInList = (\n  contextId: string,\n  submissionId: number,\n  updatedSubmission: any\n) => {\n  const stateAtom = getSubmissionsStateAtom(contextId);\n\n  return atom(null, (get, set) => {\n    const currentState = get(stateAtom);\n\n    if (currentState.data) {\n      const updatedSubmissions = currentState.data.submissions.map(\n        (submission) =>\n          submission.submission_id === submissionId\n            ? { ...submission, ...updatedSubmission }\n            : submission\n      );\n\n      set(stateAtom, {\n        ...currentState,\n        data: {\n          submissions: updatedSubmissions,\n          pagination: currentState.data.pagination\n        }\n      });\n    }\n  });\n};\n\n/**\n * Remove a submission from the submissions list\n * for optimistic updates after delete operations\n */\nexport const removeSubmissionFromList = (\n  contextId: string,\n  submissionId: number\n) => {\n  const stateAtom = getSubmissionsStateAtom(contextId);\n\n  return atom(null, (get, set) => {\n    const currentState = get(stateAtom);\n\n    if (currentState.data) {\n      const updatedSubmissions = currentState.data.submissions.filter(\n        (submission) => submission.submission_id !== submissionId\n      );\n      const updatedPagination = {\n        ...currentState.data.pagination,\n        totalRecords: Math.max(0, currentState.data.pagination.totalRecords - 1)\n      };\n\n      set(stateAtom, {\n        ...currentState,\n        data: {\n          submissions: updatedSubmissions,\n          pagination: updatedPagination\n        }\n      });\n    }\n  });\n};\n\n/**\n * Clear all atoms for a specific context\n * Useful for cleanup and testing\n */\nexport const clearContextAtoms = (contextId: string) => {\n  SubmissionsStateAtomRegistry.getInstance().clearAtom(contextId);\n  SubmissionsFiltersAtomRegistry.getInstance().clearAtom(contextId);\n  DisplayFiltersAtomRegistry.getInstance().clearAtom(contextId);\n};\n\n/**\n * Clear all route-scoped filters (for logout/cache clearing)\n */\nexport const clearAllRouteFilters = () => {\n  SubmissionsFiltersAtomRegistry.getInstance().clearAllRouteFilters();\n};\n\n// ============================================================================\n// SUBMISSIONS MANAGEMENT ATOMS - Enhanced for better coordination\n// ============================================================================\n\n/**\n * Fetch status atom to prevent race conditions\n */\nexport const fetchStatusAtom = atom<'idle' | 'pending' | 'fetching'>('idle');\n\n/**\n * Derived atom that triggers fetches when filters/page change\n * This eliminates the need for complex useEffect coordination\n */\nexport const fetchTriggerAtom = atom((get) => {\n  const filters = get(getSubmissionsFiltersAtom('default'));\n  const status = get(fetchStatusAtom);\n\n  // Only return trigger data if not already fetching\n  if (status === 'fetching') return null;\n\n  return {\n    filters: filters.filters,\n    page: filters.page,\n    pageSize: filters.pageSize,\n    timestamp: Date.now() // Force re-evaluation\n  };\n});\n\n/**\n * Write-only atom for triggering fetches\n * This replaces the complex fetchSubmissions coordination\n */\nexport const triggerFetchAtom = atom(\n  null,\n  async (\n    get,\n    set,\n    params: {\n      contextId: string;\n      fetchFn: (\n        filters: Filter<PostFilters>[],\n        page: number,\n        pageSize: number\n      ) => Promise<any>;\n      onlyMine?: boolean;\n      userId?: string;\n      includeThreadReplies?: boolean;\n    }\n  ) => {\n    const currentStatus = get(fetchStatusAtom);\n    if (currentStatus === 'fetching') return; // Prevent double fetch\n\n    set(fetchStatusAtom, 'fetching');\n\n    try {\n      const filtersState = get(getSubmissionsFiltersAtom(params.contextId));\n      const submissionsState = get(getSubmissionsStateAtom(params.contextId));\n\n      // Set loading state\n      set(getSubmissionsStateAtom(params.contextId), {\n        ...submissionsState,\n        loading: true,\n        error: undefined\n      });\n\n      // Execute the fetch\n      const result = await params.fetchFn(\n        filtersState.filters as Filter<PostFilters>[],\n        filtersState.page,\n        filtersState.pageSize\n      );\n\n      // Update with results\n      if (result.data) {\n        set(getSubmissionsStateAtom(params.contextId), {\n          loading: false,\n          data: {\n            submissions: result.data.data || [],\n            pagination: result.data.pagination || {\n              currentPage: filtersState.page,\n              pageSize: filtersState.pageSize,\n              totalRecords: 0\n            }\n          },\n          error: undefined\n        });\n      } else {\n        set(getSubmissionsStateAtom(params.contextId), {\n          loading: false,\n          data: undefined,\n          error: result.error || 'Failed to fetch submissions'\n        });\n      }\n    } catch (error: any) {\n      logger.error('Fetch error in triggerFetchAtom', error as Error, {\n        contextId: params.contextId\n      });\n      set(getSubmissionsStateAtom(params.contextId), {\n        loading: false,\n        data: undefined,\n        error: error.message || 'Failed to fetch submissions'\n      });\n    } finally {\n      set(fetchStatusAtom, 'idle');\n    }\n  }\n);\n\n/**\n * URL synchronization atom - handles URL updates when filters change\n */\nexport const urlSyncAtom = atom(\n  null,\n  (\n    get,\n    set,\n    params: {\n      contextId: string;\n      router: any;\n      pathname: string;\n      infiniteScroll?: boolean;\n    }\n  ) => {\n    const filtersState = get(getSubmissionsFiltersAtom(params.contextId));\n    const urlParams = new URLSearchParams();\n\n    // Add filters to URL - combine multiple values for same filter type\n    const filterGroups = filtersState.filters.reduce(\n      (acc, filter) => {\n        if (!acc[filter.name]) acc[filter.name] = [];\n        acc[filter.name].push(filter.value);\n        return acc;\n      },\n      {} as Record<string, string[]>\n    );\n\n    Object.entries(filterGroups).forEach(([name, values]) => {\n      if (name === 'tags' || name === 'author' || name === 'mentions' || name === 'search') {\n        if (name === 'tags') {\n          const { formatTagsForUrl } = require('../utils/string/tag-utils');\n          const allTags = values.flatMap((value) =>\n            value.split(',').map((tag) => tag.trim())\n          );\n          urlParams.set(name, formatTagsForUrl(allTags));\n        } else {\n          urlParams.set(name, values.join(','));\n        }\n      } else if (name === 'onlyReplies') {\n        // Handle onlyReplies filter\n        if (values[0] === 'true') {\n          urlParams.set('onlyReplies', 'true');\n        }\n      } else if (name === 'tagLogic' && filterGroups.tags) {\n        urlParams.set('tagLogic', values[0]);\n      } else if (name === 'authorLogic' && filterGroups.author) {\n        urlParams.set('authorLogic', values[0]);\n      } else if (name === 'mentionsLogic' && filterGroups.mentions) {\n        urlParams.set('mentionsLogic', values[0]);\n      } else if (name === 'searchLogic' && filterGroups.search) {\n        urlParams.set('searchLogic', values[0]);\n      } else if (name === 'globalLogic') {\n        urlParams.set('globalLogic', values[0]);\n      }\n    });\n\n    // Add pagination only if not in infinite scroll mode\n    if (!params.infiniteScroll) {\n      if (filtersState.page > 1) {\n        urlParams.set('page', filtersState.page.toString());\n      }\n      if (filtersState.pageSize !== 10) {\n        urlParams.set('pageSize', filtersState.pageSize.toString());\n      }\n    }\n\n    const newUrl = `${params.pathname}${urlParams.toString() ? `?${urlParams.toString()}` : ''}`;\n    params.router.push(newUrl, { scroll: false });\n  }\n);\n\n/**\n * Batched filter update atom - replaces manual batching\n */\nexport const batchedFilterUpdateAtom = atom(\n  null,\n  (get, set, update: { contextId: string; filters: Filter<PostFilters>[] }) => {\n    const current = get(getSubmissionsFiltersAtom(update.contextId));\n\n    // Jotai automatically batches these updates\n    set(getSubmissionsFiltersAtom(update.contextId), {\n      ...current,\n      filters: update.filters,\n      page: 1 // Reset to first page\n    });\n\n    // Note: Fetch will be triggered by the derived atom when needed\n  }\n);\n\n// ============================================================================\n// ENHANCED ATOMIC SOLUTION - Full Jotai Integration\n// ============================================================================\n\n/**\n * Configuration atom for each submissions context\n */\nexport interface SubmissionsConfig {\n  contextId: string;\n  onlyMine: boolean;\n  userId: string;\n  includeThreadReplies: boolean;\n  infiniteScroll: boolean;\n  fetchFn: (\n    filters: Filter<PostFilters>[],\n    page: number,\n    pageSize: number\n  ) => Promise<any>;\n}\n\nclass SubmissionsConfigAtomRegistry {\n  private static instance: SubmissionsConfigAtomRegistry;\n  private atoms = new Map<\n    string,\n    ReturnType<typeof atom<SubmissionsConfig | null>>\n  >();\n\n  static getInstance(): SubmissionsConfigAtomRegistry {\n    if (!SubmissionsConfigAtomRegistry.instance) {\n      SubmissionsConfigAtomRegistry.instance =\n        new SubmissionsConfigAtomRegistry();\n    }\n    return SubmissionsConfigAtomRegistry.instance;\n  }\n\n  getAtom(contextId: string) {\n    if (!this.atoms.has(contextId)) {\n      this.atoms.set(contextId, atom<SubmissionsConfig | null>(null));\n    }\n    return this.atoms.get(contextId)!;\n  }\n\n  clearAtom(contextId: string) {\n    this.atoms.delete(contextId);\n  }\n}\n\nexport const getSubmissionsConfigAtom = (contextId: string) => {\n  return SubmissionsConfigAtomRegistry.getInstance().getAtom(contextId);\n};\n\n/**\n * URL parameters atom - derived from current URL\n */\nexport const urlParamsAtom = atom<URLSearchParams>(new URLSearchParams());\n\n/**\n * Derived atom that extracts filters from URL parameters\n */\nexport const filtersFromUrlAtom = atom((get) => {\n  const urlParams = get(urlParamsAtom);\n  const filters: Filter<PostFilters>[] = [];\n\n  const tagsParam = urlParams.get('tags');\n  const authorParam = urlParams.get('author');\n  const mentionsParam = urlParams.get('mentions');\n  const searchParam = urlParams.get('search');\n  const onlyRepliesParam = urlParams.get('onlyReplies');\n  const tagLogicParam = urlParams.get('tagLogic');\n  const authorLogicParam = urlParams.get('authorLogic');\n  const mentionsLogicParam = urlParams.get('mentionsLogic');\n  const searchLogicParam = urlParams.get('searchLogic');\n  const globalLogicParam = urlParams.get('globalLogic');\n\n  if (tagsParam) {\n    const cleanTags = tagsParam\n      .split(',')\n      .map((tag) => tag.trim())\n      .map((tag) => {\n        const {\n          formatTagForDisplay,\n          normalizeTagForDatabase\n        } = require('../utils/string/tag-utils');\n        return formatTagForDisplay(normalizeTagForDatabase(tag));\n      })\n      .filter(Boolean);\n    if (cleanTags.length > 0) {\n      // Create separate filter entries for each tag instead of comma-separated value\n      cleanTags.forEach((tagValue) => {\n        filters.push({\n          name: 'tags' as PostFilters,\n          value: tagValue\n        });\n      });\n\n      if (cleanTags.length > 1 && !tagLogicParam) {\n        filters.push({\n          name: 'tagLogic' as PostFilters,\n          value: 'OR'\n        });\n      }\n    }\n  }\n\n  if (authorParam) {\n    const cleanAuthors = authorParam\n      .split(',')\n      .map((value) => value.trim())\n      .filter(Boolean);\n    // Create separate filter entries for each author instead of comma-separated value\n    cleanAuthors.forEach((authorValue) => {\n      filters.push({\n        name: 'author' as PostFilters,\n        value: authorValue\n      });\n    });\n  }\n\n  if (mentionsParam) {\n    const cleanMentions = mentionsParam\n      .split(',')\n      .map((value) => value.trim())\n      .filter(Boolean);\n    // Create separate filter entries for each mention instead of comma-separated value\n    cleanMentions.forEach((mentionValue) => {\n      // Handle different mention formats from URL:\n      // 1. Plain username: \\\"shaun_beatty\\\"\n      // 2. Combined format: \\\"shaun_beatty|122\\\"\n      // 3. User ID only: \\\"122\\\"\n      \n      let filterValue = mentionValue;\n      \n      // If it's already in combined format (username|userId), use as-is\n      if (mentionValue.includes('|')) {\n        filterValue = mentionValue;\n      } else if (/^\\\\d+$/.test(mentionValue)) {\n        // If it's a pure user ID, we need to resolve it to username|userId format\n        // For now, store as-is and let the display layer handle resolution\n        filterValue = mentionValue;\n      } else {\n        // If it's a plain username, we need to resolve it to username|userId format\n        // For now, store as username|username and let the system resolve the user ID later\n        filterValue = `${mentionValue}|${mentionValue}`;\n      }\n      \n      filters.push({\n        name: 'mentions' as PostFilters,\n        value: filterValue\n      });\n    });\n  }\n\n  if (searchParam) {\n    const cleanSearch = searchParam.trim();\n    if (cleanSearch) {\n      filters.push({\n        name: 'search' as PostFilters,\n        value: cleanSearch\n      });\n    }\n  }\n\n  if (onlyRepliesParam) {\n    const onlyReplies = onlyRepliesParam.trim().toLowerCase();\n    if (onlyReplies === 'true' || onlyReplies === '1') {\n      filters.push({\n        name: 'onlyReplies' as PostFilters,\n        value: 'true'\n      });\n    }\n  }\n\n  if (tagLogicParam) {\n    filters.push({\n      name: 'tagLogic' as PostFilters,\n      value: tagLogicParam\n    });\n  }\n\n  if (authorLogicParam) {\n    filters.push({\n      name: 'authorLogic' as PostFilters,\n      value: authorLogicParam\n    });\n  }\n\n  if (mentionsLogicParam) {\n    filters.push({\n      name: 'mentionsLogic' as PostFilters,\n      value: mentionsLogicParam\n    });\n  }\n\n  if (searchLogicParam) {\n    filters.push({\n      name: 'searchLogic' as PostFilters,\n      value: searchLogicParam\n    });\n  }\n\n  if (globalLogicParam) {\n    filters.push({\n      name: 'globalLogic' as PostFilters,\n      value: globalLogicParam\n    });\n  }\n\n  return filters;\n});\n\n/**\n * Derived atom that extracts pagination from URL parameters\n */\nexport const paginationFromUrlAtom = atom((get) => {\n  const urlParams = get(urlParamsAtom);\n  const pageParam = urlParams.get('page');\n  const pageSizeParam = urlParams.get('pageSize');\n\n  return {\n    page: pageParam ? Math.max(1, parseInt(pageParam)) : 1,\n    pageSize: pageSizeParam ? Math.max(10, parseInt(pageSizeParam)) : 10\n  };\n});\n\n/**\n * Auto-syncing URL atom that updates URL when filters change\n */\nexport const createAutoUrlSyncAtom = (contextId: string) => {\n  return atom(null, (get, set, params: { router: any; pathname: string }) => {\n    const config = get(getSubmissionsConfigAtom(contextId));\n    const filters = get(createCombinedFiltersAtom(contextId)); // Use combined atom\n\n    if (!config || !filters.initialized || config.infiniteScroll) {\n      return;\n    }\n\n    const urlParams = new URLSearchParams();\n\n    // Add filters to URL\n    const filterGroups = filters.filters.reduce(\n      (acc, filter) => {\n        if (!acc[filter.name]) acc[filter.name] = [];\n        acc[filter.name].push(filter.value);\n        return acc;\n      },\n      {} as Record<string, string[]>\n    );\n\n    Object.entries(filterGroups).forEach(([name, values]) => {\n      if (name === 'tags' || name === 'author' || name === 'mentions' || name === 'search') {\n        if (name === 'tags') {\n          const { formatTagsForUrl } = require('../utils/string/tag-utils');\n          const allTags = values.flatMap((value) =>\n            value.split(',').map((tag) => tag.trim())\n          );\n          urlParams.set(name, formatTagsForUrl(allTags));\n        } else {\n          urlParams.set(name, values.join(','));\n        }\n      } else if (name === 'onlyReplies') {\n        // Handle onlyReplies filter\n        if (values[0] === 'true') {\n          urlParams.set('onlyReplies', 'true');\n        }\n      } else if (name === 'tagLogic' && filterGroups.tags) {\n        urlParams.set('tagLogic', values[0]);\n      } else if (name === 'authorLogic' && filterGroups.author) {\n        urlParams.set('authorLogic', values[0]);\n      } else if (name === 'mentionsLogic' && filterGroups.mentions) {\n        urlParams.set('mentionsLogic', values[0]);\n      } else if (name === 'searchLogic' && filterGroups.search) {\n        urlParams.set('searchLogic', values[0]);\n      } else if (name === 'globalLogic') {\n        urlParams.set('globalLogic', values[0]);\n      }\n    });\n\n    // Add pagination\n    if (filters.page > 1) {\n      urlParams.set('page', filters.page.toString());\n    }\n    if (filters.pageSize !== 10) {\n      urlParams.set('pageSize', filters.pageSize.toString());\n    }\n\n    const newUrl = `${params.pathname}${urlParams.toString() ? `?${urlParams.toString()}` : ''}`;\n    params.router.push(newUrl, { scroll: false });\n  });\n};\n\n/**\n * Infinite scroll state atom\n */\nexport const createInfiniteScrollAtom = (contextId: string) => {\n  return atom({\n    data: [] as any[],\n    page: 1,\n    isLoadingMore: false,\n    hasMore: true\n  });\n};\n\n/**\n * Comprehensive action atoms for filter management\n */\nexport const createFilterActionsAtom = (contextId: string) => {\n  return atom(\n    null,\n    (\n      get,\n      set,\n      action:\n        | { type: 'ADD_FILTER'; filter: Filter<PostFilters> }\n        | { type: 'ADD_FILTERS'; filters: Filter<PostFilters>[] }\n        | { type: 'REMOVE_FILTER'; name: PostFilters; value?: string }\n        | { type: 'REMOVE_TAG'; tag: string }\n        | { type: 'CLEAR_FILTERS' }\n        | { type: 'SET_PAGE'; page: number }\n        | { type: 'SET_PAGE_SIZE'; pageSize: number }\n    ) => {\n      const current = get(createCombinedFiltersAtom(contextId)); // Use combined atom\n      const config = get(getSubmissionsConfigAtom(contextId));\n\n      switch (action.type) {\n        case 'ADD_FILTER': {\n          const newFilters = [...current.filters, action.filter];\n          set(createCombinedFiltersAtom(contextId), {\n            ...current,\n            filters: newFilters as Filter[],\n            page: 1\n          });\n          break;\n        }\n\n        case 'ADD_FILTERS': {\n          const newFilters = [...current.filters, ...action.filters];\n          set(createCombinedFiltersAtom(contextId), {\n            ...current,\n            filters: newFilters as Filter[],\n            page: 1\n          });\n          break;\n        }\n\n        case 'REMOVE_FILTER': {\n          const newFilters = action.value\n            ? current.filters.filter(\n                (f) => !(f.name === action.name && f.value === action.value)\n              )\n            : current.filters.filter((f) => f.name !== action.name);\n\n          set(createCombinedFiltersAtom(contextId), {\n            ...current,\n            filters: newFilters,\n            page: 1\n          });\n          break;\n        }\n\n        case 'REMOVE_TAG': {\n          const tagsFilter = current.filters.find((f) => f.name === 'tags');\n          if (!tagsFilter) return;\n\n          const currentTags = tagsFilter.value\n            .split(',')\n            .map((tag) => tag.trim())\n            .filter(Boolean);\n\n          const newTags = currentTags.filter((tag) => tag !== action.tag);\n\n          let newFilters = [...current.filters];\n\n          if (newTags.length === 0) {\n            newFilters = newFilters.filter(\n              (f) => f.name !== 'tags' && f.name !== 'tagLogic'\n            );\n          } else {\n            newFilters = newFilters.map((f) =>\n              f.name === 'tags' ? { ...f, value: newTags.join(',') } : f\n            );\n\n            if (newTags.length === 1) {\n              newFilters = newFilters.filter((f) => f.name !== 'tagLogic');\n            }\n          }\n\n          set(createCombinedFiltersAtom(contextId), {\n            ...current,\n            filters: newFilters,\n            page: 1\n          });\n          break;\n        }\n\n        case 'CLEAR_FILTERS': {\n          set(createCombinedFiltersAtom(contextId), {\n            ...current,\n            filters: [],\n            page: 1\n          });\n\n          // Reset infinite scroll if enabled\n          if (config?.infiniteScroll) {\n            const infiniteScrollAtom = createInfiniteScrollAtom(contextId);\n            set(infiniteScrollAtom, {\n              data: [],\n              page: 1,\n              isLoadingMore: false,\n              hasMore: true\n            });\n          }\n          break;\n        }\n\n        case 'SET_PAGE': {\n          set(createCombinedFiltersAtom(contextId), {\n            ...current,\n            page: action.page\n          });\n          break;\n        }\n\n        case 'SET_PAGE_SIZE': {\n          set(createCombinedFiltersAtom(contextId), {\n            ...current,\n            pageSize: action.pageSize,\n            page: 1\n          });\n          break;\n        }\n      }\n\n      // Auto-trigger fetch\n      const autoFetch = createAutoFetchAtom(contextId);\n      set(autoFetch);\n    }\n  );\n};\n\n/**\n * Writable filter state atom for dynamic updates\n */\nexport const createWritableFiltersAtom = (contextId: string) => {\n  return atom<SubmissionsFilters>({\n    onlyMine: false,\n    userId: '',\n    filters: [],\n    page: 1,\n    pageSize: 10,\n    initialized: false\n  });\n};\n\n/**\n * Combined filters atom that merges URL initialization with dynamic updates\n */\nexport const createCombinedFiltersAtom = (contextId: string) => {\n  const writableAtom = createWritableFiltersAtom(contextId);\n\n  return atom(\n    (get) => {\n      const config = get(getSubmissionsConfigAtom(contextId));\n      const writable = get(writableAtom);\n\n      // If writable is initialized, use it (for dynamic updates)\n      if (writable.initialized) {\n        return writable;\n      }\n\n      // Otherwise, initialize from URL\n      const urlFilters = get(filtersFromUrlAtom);\n      const urlPagination = get(paginationFromUrlAtom);\n\n      if (!config) {\n        return {\n          onlyMine: false,\n          userId: '',\n          filters: [],\n          page: 1,\n          pageSize: 100,\n          initialized: false\n        };\n      }\n\n      return {\n        onlyMine: config.onlyMine,\n        userId: config.userId,\n        filters: urlFilters as Filter[],\n        page: urlPagination.page,\n        pageSize: urlPagination.pageSize,\n        initialized: true\n      };\n    },\n    (get, set, update: Partial<SubmissionsFilters>) => {\n      set(writableAtom, (prev) => ({ ...prev, ...update, initialized: true }));\n    }\n  );\n};\n\n/**\n * Auto-fetching atom that triggers when filters change\n */\nexport const createAutoFetchAtom = (contextId: string) => {\n  return atom(null, async (get, set) => {\n    const config = get(getSubmissionsConfigAtom(contextId));\n    const filters = get(createCombinedFiltersAtom(contextId)); // Read from combined atom\n    const currentStatus = get(fetchStatusAtom);\n\n    if (!config || !filters.initialized || currentStatus === 'fetching') {\n      return;\n    }\n\n    set(fetchStatusAtom, 'fetching');\n\n    try {\n      const submissionsState = get(getSubmissionsStateAtom(contextId));\n\n      // Set loading state\n      set(getSubmissionsStateAtom(contextId), {\n        ...submissionsState,\n        loading: true,\n        error: undefined\n      });\n\n      // Execute fetch\n      const result = await config.fetchFn(\n        filters.filters as Filter<PostFilters>[],\n        filters.page,\n        filters.pageSize\n      );\n\n      // Update with results\n      if (result.data) {\n        set(getSubmissionsStateAtom(contextId), {\n          loading: false,\n          data: {\n            submissions: result.data.data || [],\n            pagination: result.data.pagination || {\n              currentPage: filters.page,\n              pageSize: filters.pageSize,\n              totalRecords: 0\n            }\n          },\n          error: undefined\n        });\n      } else {\n        set(getSubmissionsStateAtom(contextId), {\n          loading: false,\n          data: undefined,\n          error: result.error || 'Failed to fetch submissions'\n        });\n      }\n    } catch (error: any) {\n      logger.error('Fetch error in autoFetchAtom', error as Error, {\n        contextId\n      });\n      set(getSubmissionsStateAtom(contextId), {\n        loading: false,\n        data: undefined,\n        error: error.message || 'Failed to fetch submissions'\n      });\n    } finally {\n      set(fetchStatusAtom, 'idle');\n    }\n  });\n};\n\n// ============================================================================\n// DEBUG FUNCTIONS - For testing and debugging\n// ============================================================================\n\n/**\n * Debug function to inspect filter storage state\n * Can be called from browser console: window.debugFilters()\n */\nexport const debugFilters = () => {\n  if (typeof window === 'undefined') {\n    logger.warn('Debug filters called in non-browser environment');\n    return;\n  }\n\n  logger.group('filterStorageDebug');\n  logger.debug('Filter Storage Debug Information');\n\n  // Show all filter-related localStorage keys\n  const filterKeys: string[] = [];\n  for (let i = 0; i < localStorage.length; i++) {\n    const key = localStorage.key(i);\n    if (key && key.startsWith('filters-')) {\n      filterKeys.push(key);\n    }\n  }\n\n  logger.debug('Filter keys in localStorage', { filterKeys });\n\n  // Show the content of each filter key\n  filterKeys.forEach((key) => {\n    try {\n      const value = localStorage.getItem(key);\n      const parsed = value ? JSON.parse(value) : null;\n      logger.debug('Filter key content', { key, parsed });\n    } catch (error) {\n      logger.warn('Error parsing filter key', {\n        key,\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n  });\n\n  // Show current page context\n  logger.debug('Current context', {\n    pathname: window.location.pathname,\n    search: window.location.search,\n    contextIds: CONTEXT_IDS\n  });\n\n  // Show registry state\n  const filtersRegistry = SubmissionsFiltersAtomRegistry.getInstance();\n  logger.debug('Registry state', {\n    atomsCount: (filtersRegistry as any).atoms.size,\n    atomKeys: Array.from((filtersRegistry as any).atoms.keys())\n  });\n\n  logger.groupEnd();\n};\n\n// Make debug function available globally\nif (typeof window !== 'undefined') {\n  (window as any).debugFilters = debugFilters;\n  (window as any).clearAllRouteFilters = clearAllRouteFilters;\n\n  // Test function to add sample filters\n  (window as any).testFilterPersistence = (\n    contextId = CONTEXT_IDS.POSTS.toString()\n  ) => {\n    logger.debug('Testing filter persistence for context', { contextId });\n\n    const filtersAtom = getSubmissionsFiltersAtom(contextId);\n    const registry = SubmissionsFiltersAtomRegistry.getInstance();\n\n    // Get current storage key\n    const storageKey = (registry as any).getStorageKey(contextId);\n    logger.debug('Using storage key', { storageKey });\n\n    // Create test filters\n    const testFilters = [\n      { name: 'tags', value: '#test,#persistence' },\n      { name: 'author', value: 'testuser' }\n    ];\n\n    const testData = {\n      onlyMine: false,\n      userId: '',\n      filters: testFilters,\n      page: 2,\n      pageSize: 20,\n      initialized: true\n    };\n\n    // Store directly in localStorage to test\n    localStorage.setItem(storageKey, JSON.stringify(testData));\n    logger.debug('Stored test data', { testData });\n\n    // Try to read it back\n    const retrieved = localStorage.getItem(storageKey);\n    logger.debug('Retrieved data', {\n      retrieved: retrieved ? JSON.parse(retrieved) : null\n    });\n\n    return { storageKey, testData, retrieved };\n  };\n}\n",
    "language":"typescript",
    "lines":1627,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/state/batchedUpdater.ts":{
    "content":"/**\n * Batched Atom Update System\n *\n * Provides atomic state management by batching multiple updates together\n * instead of relying on unreliable debouncing with timers.\n *\n * This system ensures that multiple rapid state changes are consolidated\n * into a single atomic update, preventing intermediate states and\n * unnecessary re-renders or side effects.\n */\n\ninterface BatchedUpdate<T = any> {\n  id: string;\n  updater: (currentState: T) => T;\n  timestamp: number;\n}\n\nclass BatchedAtomUpdater {\n  private static instance: BatchedAtomUpdater;\n  private updateQueues = new Map<string, BatchedUpdate[]>();\n  private processingTimeouts = new Map<string, ReturnType<typeof setTimeout>>();\n  private atomSetters = new Map<\n    string,\n    (updater: (state: any) => any) => void\n  >();\n\n  static getInstance(): BatchedAtomUpdater {\n    if (!BatchedAtomUpdater.instance) {\n      BatchedAtomUpdater.instance = new BatchedAtomUpdater();\n    }\n    return BatchedAtomUpdater.instance;\n  }\n\n  /**\n   * Register an atom setter for batched updates\n   */\n  registerAtom<T>(\n    atomKey: string,\n    setAtom: (updater: (currentState: T) => T) => void\n  ): void {\n    this.atomSetters.set(atomKey, setAtom);\n  }\n\n  /**\n   * Queue a batched update for an atom\n   * Multiple updates to the same atom will be batched together\n   */\n  queueUpdate<T>(\n    atomKey: string,\n    updater: (currentState: T) => T,\n    batchDelay: number = 0\n  ): void {\n    const updateId = `${atomKey}-${Date.now()}-${Math.random()}`;\n    const update: BatchedUpdate<T> = {\n      id: updateId,\n      updater,\n      timestamp: Date.now()\n    };\n\n    // Add to queue\n    if (!this.updateQueues.has(atomKey)) {\n      this.updateQueues.set(atomKey, []);\n    }\n    this.updateQueues.get(atomKey)!.push(update);\n\n    // Clear existing timeout\n    if (this.processingTimeouts.has(atomKey)) {\n      clearTimeout(this.processingTimeouts.get(atomKey)!);\n    }\n\n    // Set new timeout for batch processing\n    const timeout = setTimeout(() => {\n      this.processBatch(atomKey);\n    }, batchDelay);\n\n    this.processingTimeouts.set(atomKey, timeout);\n  }\n\n  /**\n   * Process all queued updates for an atom atomically\n   */\n  private processBatch(atomKey: string): void {\n    const updates = this.updateQueues.get(atomKey);\n    const setAtom = this.atomSetters.get(atomKey);\n\n    if (!updates || updates.length === 0 || !setAtom) return;\n\n    // Clear the queue and timeout\n    this.updateQueues.delete(atomKey);\n    this.processingTimeouts.delete(atomKey);\n\n    // Create batched updater function\n    const batchedUpdater = (currentState: any) => {\n      return updates.reduce((state, update) => {\n        try {\n          return update.updater(state);\n        } catch (error) {\n          // Silently handle errors to avoid console spam\n          return state;\n        }\n      }, currentState);\n    };\n\n    // Apply the batched update atomically\n    setAtom(batchedUpdater);\n  }\n\n  /**\n   * Force immediate processing of all queued updates for an atom\n   */\n  flushUpdates(atomKey: string): void {\n    if (this.processingTimeouts.has(atomKey)) {\n      clearTimeout(this.processingTimeouts.get(atomKey)!);\n      this.processBatch(atomKey);\n    }\n  }\n\n  /**\n   * Clear all queued updates for an atom without applying them\n   */\n  clearUpdates(atomKey: string): void {\n    this.updateQueues.delete(atomKey);\n    if (this.processingTimeouts.has(atomKey)) {\n      clearTimeout(this.processingTimeouts.get(atomKey)!);\n      this.processingTimeouts.delete(atomKey);\n    }\n  }\n\n  /**\n   * Get pending update count for debugging\n   */\n  getPendingCount(atomKey: string): number {\n    return this.updateQueues.get(atomKey)?.length || 0;\n  }\n\n  /**\n   * Check if there are pending updates for an atom\n   */\n  hasPendingUpdates(atomKey: string): boolean {\n    return this.getPendingCount(atomKey) > 0;\n  }\n\n  /**\n   * Get all atom keys with pending updates\n   */\n  getPendingAtomKeys(): string[] {\n    return Array.from(this.updateQueues.keys()).filter(\n      (key) => this.updateQueues.get(key)!.length > 0\n    );\n  }\n\n  /**\n   * Clear all pending updates for all atoms\n   */\n  clearAllUpdates(): void {\n    this.updateQueues.clear();\n    this.processingTimeouts.forEach((timeout) => clearTimeout(timeout));\n    this.processingTimeouts.clear();\n  }\n}\n\n/**\n * Export singleton instance for reuse across the application\n */\nexport const batchedUpdater = BatchedAtomUpdater.getInstance();\n\n/**\n * Create a batched updater for a specific atom\n * This provides a clean interface for components to use batched updates\n */\nexport function createBatchedAtomUpdater<T>(\n  atomKey: string,\n  setAtom: (updater: (currentState: T) => T) => void,\n  options: {\n    batchDelay?: number;\n    maxBatchSize?: number;\n    autoFlush?: boolean;\n  } = {}\n) {\n  const { batchDelay = 0, maxBatchSize = 10, autoFlush = true } = options;\n\n  // Register the atom setter\n  batchedUpdater.registerAtom(atomKey, setAtom);\n\n  return {\n    /**\n     * Queue an update to be batched\n     */\n    queueUpdate: (updater: (currentState: T) => T) => {\n      batchedUpdater.queueUpdate(atomKey, updater, batchDelay);\n\n      // Auto-flush if we've hit the max batch size\n      if (\n        autoFlush &&\n        batchedUpdater.getPendingCount(atomKey) >= maxBatchSize\n      ) {\n        batchedUpdater.flushUpdates(atomKey);\n      }\n    },\n\n    /**\n     * Force immediate processing of queued updates\n     */\n    flush: () => {\n      batchedUpdater.flushUpdates(atomKey);\n    },\n\n    /**\n     * Clear all queued updates without applying them\n     */\n    clear: () => {\n      batchedUpdater.clearUpdates(atomKey);\n    },\n\n    /**\n     * Get number of pending updates\n     */\n    getPendingCount: () => {\n      return batchedUpdater.getPendingCount(atomKey);\n    },\n\n    /**\n     * Check if there are pending updates\n     */\n    hasPendingUpdates: () => {\n      return batchedUpdater.hasPendingUpdates(atomKey);\n    }\n  };\n}\n\n/**\n * Utility function to create a batched version of any atom setter\n */\nexport function createBatchedSetter<T>(\n  atomKey: string,\n  originalSetter: (updater: (currentState: T) => T) => void,\n  batchDelay: number = 0\n) {\n  const batchedAtomUpdater = createBatchedAtomUpdater(atomKey, originalSetter, {\n    batchDelay,\n    autoFlush: true\n  });\n\n  return {\n    /**\n     * Batched version of the setter - queues updates instead of applying immediately\n     */\n    setBatched: (updater: (currentState: T) => T) => {\n      batchedAtomUpdater.queueUpdate(updater);\n    },\n\n    /**\n     * Original setter for immediate updates when needed\n     */\n    setImmediate: originalSetter,\n\n    /**\n     * Flush any pending batched updates\n     */\n    flush: batchedAtomUpdater.flush,\n\n    /**\n     * Clear pending updates\n     */\n    clear: batchedAtomUpdater.clear,\n\n    /**\n     * Get batched updater instance for advanced usage\n     */\n    batchedUpdater: batchedAtomUpdater\n  };\n}\n",
    "language":"typescript",
    "lines":273,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/state/submissions/useUrlSync.ts":{
    "content":"import { usePathname, useRouter, useSearchParams } from 'next/navigation';\nimport { useEffect, useMemo } from 'react';\nimport { PostFilters } from '../../types/filters';\nimport { Filter, SubmissionsFilters } from '../atoms';\n\ninterface UseUrlSyncProps {\n  filtersState: SubmissionsFilters;\n  setFiltersState: (updater: (prevState: SubmissionsFilters) => SubmissionsFilters) => void;\n  initialFilters: Filter<PostFilters>[];\n  infiniteScroll: boolean;\n}\n\nexport function useUrlSync({\n  filtersState,\n  setFiltersState,\n  initialFilters,\n  infiniteScroll\n}: UseUrlSyncProps) {\n  const router = useRouter();\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n  \n  // Initialize filters from URL ONCE on mount only\n  useEffect(() => {\n    if (filtersState.initialized) {\n      return;\n    }\n\n    // Parse URL parameters into filters (one-time only)\n    const urlFilters: Filter<PostFilters>[] = [];\n\n    // Parse tags - create separate filters for each tag\n    const tagsParam = searchParams.get('tags');\n    if (tagsParam) {\n      const tags = tagsParam.split(',').filter(Boolean);\n      tags.forEach(tag => {\n        urlFilters.push({ name: 'tags', value: tag.trim() });\n      });\n    }\n\n    // Parse other filters\n    const authorParam = searchParams.get('author');\n    if (authorParam) urlFilters.push({ name: 'author', value: authorParam });\n\n    const mentionsParam = searchParams.get('mentions');\n    if (mentionsParam) urlFilters.push({ name: 'mentions', value: mentionsParam });\n\n    const searchParam = searchParams.get('search');\n    if (searchParam) urlFilters.push({ name: 'search', value: searchParam });\n\n    const onlyRepliesParam = searchParams.get('onlyReplies');\n    if (onlyRepliesParam === 'true') urlFilters.push({ name: 'onlyReplies', value: 'true' });\n\n    const globalLogicParam = searchParams.get('globalLogic');\n    if (globalLogicParam) urlFilters.push({ name: 'globalLogic', value: globalLogicParam });\n\n    const tagLogicParam = searchParams.get('tagLogic');\n    if (tagLogicParam) urlFilters.push({ name: 'tagLogic', value: tagLogicParam });\n\n    const authorLogicParam = searchParams.get('authorLogic');\n    if (authorLogicParam) urlFilters.push({ name: 'authorLogic', value: authorLogicParam });\n\n    const mentionsLogicParam = searchParams.get('mentionsLogic');\n    if (mentionsLogicParam) urlFilters.push({ name: 'mentionsLogic', value: mentionsLogicParam });\n\n    // Use URL filters if available, otherwise use initial filters\n    const finalFilters = urlFilters.length > 0 ? urlFilters : initialFilters;\n    const pageParam = searchParams.get('page');\n    const page = pageParam ? parseInt(pageParam, 10) : 1;\n\n    setFiltersState((prevState) => ({\n      ...prevState,\n      filters: finalFilters as Filter[], // Cast to match atom type\n      page,\n      initialized: true\n    }));\n  }, [filtersState.initialized, initialFilters, searchParams, setFiltersState]);\n\n  // Memoize URL params to prevent unnecessary URL updates\n  const urlParams = useMemo(() => {\n    if (!filtersState.initialized || infiniteScroll) return null;\n\n    const params = new URLSearchParams();\n\n    // Group filters by type\n    const filterGroups: Record<string, string[]> = {};\n    filtersState.filters.forEach((filter) => {\n      if (!filterGroups[filter.name]) {\n        filterGroups[filter.name] = [];\n      }\n      filterGroups[filter.name].push(filter.value);\n    });\n\n    // Add tags (combine multiple tag filters, remove # prefix)\n    if (filterGroups.tags && filterGroups.tags.length > 0) {\n      const tagsForUrl = filterGroups.tags.map(tag => \n        tag.startsWith('#') ? tag.slice(1) : tag\n      );\n      params.set('tags', tagsForUrl.join(','));\n    }\n\n    // Add other filters\n    Object.entries(filterGroups).forEach(([name, values]) => {\n      if (name === 'tags') return; // Already handled\n      if (values.length > 0) {\n        if (name === 'onlyReplies' && values[0] === 'true') {\n          params.set('onlyReplies', 'true');\n        } else if (name === 'author') {\n          params.set('author', values.join(','));\n        } else if (name === 'mentions') {\n          params.set('mentions', values.join(','));\n        } else if (name === 'search') {\n          params.set('search', values[0]);\n        } else if (name === 'globalLogic' || name === 'tagLogic' || name === 'authorLogic' || name === 'mentionsLogic') {\n          params.set(name, values[0]);\n        }\n      }\n    });\n\n    // Add page if not 1\n    if (filtersState.page > 1) {\n      params.set('page', filtersState.page.toString());\n    }\n\n    return params.toString();\n  }, [\n    filtersState.filters,\n    filtersState.page,\n    filtersState.initialized,\n    infiniteScroll\n  ]);\n\n  // One-way URL sync: filters \u2192 URL (never URL \u2192 filters after init)\n  useEffect(() => {\n    if (urlParams === null) return;\n\n    // Build new URL\n    const newUrl = `${pathname}${urlParams ? `?${urlParams}` : ''}`;\n    const currentUrl = `${pathname}${searchParams.toString() ? `?${searchParams.toString()}` : ''}`;\n\n    // Only update URL if it changed\n    if (newUrl !== currentUrl) {\n      router.replace(newUrl); // Use replace to avoid history pollution\n    }\n  }, [urlParams, pathname, router, searchParams]);\n\n  return {\n    urlParams\n  };\n} ",
    "language":"typescript",
    "lines":150,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/state/submissions/useSubmissionsFetch.ts":{
    "content":"import { createLogger } from '@/lib/logging';\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { getSubmissionsWithReplies } from '../../../app/components/submissions-list/actions';\nimport { PostFilters } from '../../types/filters';\nimport { Filter, SubmissionsFilters, SubmissionsState } from '../atoms';\n\nconst logger = createLogger({\n  context: {\n    component: 'useSubmissionsFetch',\n    module: 'state'\n  },\n  enabled: true\n});\n\ninterface UseSubmissionsFetchProps {\n  filtersState: SubmissionsFilters;\n  setSubmissionsState: (stateOrUpdater: SubmissionsState | ((prevState: SubmissionsState) => SubmissionsState)) => void;\n  onlyMine: boolean;\n  userId: string;\n  includeThreadReplies: boolean;\n  infiniteScroll: boolean;\n  setInfiniteData: (data: any[]) => void;\n  setInfinitePage: (page: number) => void;\n  setHasMore: (hasMore: boolean) => void;\n}\n\nexport function useSubmissionsFetch({\n  filtersState,\n  setSubmissionsState,\n  onlyMine,\n  userId,\n  includeThreadReplies,\n  infiniteScroll,\n  setInfiniteData,\n  setInfinitePage,\n  setHasMore\n}: UseSubmissionsFetchProps) {\n  const isFetching = useRef(false);\n  const lastFetchKey = useRef<string>('');\n  const currentFiltersStateRef = useRef(filtersState);\n\n  // Update ref when filtersState changes\n  useEffect(() => {\n    currentFiltersStateRef.current = filtersState;\n  }, [filtersState]);\n\n  // Create a stable fetch key to prevent unnecessary re-renders\n  const fetchKey = useMemo(() => {\n    return JSON.stringify({\n      filters: filtersState.filters,\n      page: filtersState.page,\n      pageSize: filtersState.pageSize,\n      onlyMine,\n      userId,\n      includeThreadReplies,\n      initialized: filtersState.initialized\n    });\n  }, [\n    filtersState.filters,\n    filtersState.page,\n    filtersState.pageSize,\n    filtersState.initialized,\n    onlyMine,\n    userId,\n    includeThreadReplies\n  ]);\n\n  // Simple fetch function with stable dependencies\n  const fetchSubmissions = useCallback(async () => {\n    const currentFilters = currentFiltersStateRef.current;\n    if (!currentFilters.initialized) {\n      return;\n    }\n\n    // Create fetch key at execution time to avoid dependency issues\n    const executionFetchKey = JSON.stringify({\n      filters: currentFilters.filters,\n      page: currentFilters.page,\n      pageSize: currentFilters.pageSize,\n      onlyMine,\n      userId,\n      includeThreadReplies,\n      initialized: currentFilters.initialized\n    });\n\n    logger.group('fetchSubmissions');\n    logger.debug('fetchSubmissions called', {\n      fetchKey: executionFetchKey.substring(0, 100) + '...',\n      lastFetchKey: lastFetchKey.current.substring(0, 100) + '...',\n      isSameFetch: lastFetchKey.current === executionFetchKey,\n      filtersCount: currentFilters.filters.length,\n      page: currentFilters.page\n    });\n\n    // Skip if this exact same fetch was already done\n    if (lastFetchKey.current === executionFetchKey) {\n      logger.debug('Skipping duplicate fetch');\n      logger.groupEnd();\n      return;\n    }\n\n    // If already fetching a different request, wait for it to complete\n    if (isFetching.current) {\n      logger.debug('Already fetching different request, will retry');\n      logger.groupEnd();\n      // Schedule retry after current fetch completes\n      setTimeout(() => fetchSubmissions(), 100);\n      return;\n    }\n\n    lastFetchKey.current = executionFetchKey;\n    isFetching.current = true;\n\n    logger.debug('Starting fetch with filters', {\n      filters: currentFilters.filters,\n      page: currentFilters.page,\n      pageSize: currentFilters.pageSize\n    });\n\n    // Set loading state at the start of fetch\n    setSubmissionsState((prevState: SubmissionsState) => ({\n      ...prevState,\n      loading: true\n    }));\n\n    // Safety timeout to prevent stuck loading state\n    const loadingTimeout = setTimeout(() => {\n      if (isFetching.current) {\n        logger.warn('Fetch timeout - resetting loading state', {\n          fetchKey: executionFetchKey.substring(0, 100) + '...',\n          filters: currentFilters.filters\n        });\n        setSubmissionsState((prevState: SubmissionsState) => ({\n          ...prevState,\n          loading: false,\n          error: 'Request timed out. Please try again.'\n        }));\n        isFetching.current = false;\n      }\n    }, 30000); // 30 second timeout\n\n    try {\n      const result = await getSubmissionsWithReplies({\n        filters: currentFilters.filters as Filter<PostFilters>[],\n        page: currentFilters.page,\n        pageSize: currentFilters.pageSize,\n        onlyMine,\n        userId,\n        includeThreadReplies\n      });\n\n      if (result.data) {\n        const submissionsData = result.data.data || [];\n        \n        // Debug logging for search results issue\n        if (process.env.NODE_ENV === 'development') {\n          // eslint-disable-next-line no-console\n          console.log('\ud83d\udd0d useSubmissionsFetch - Fetch Result:', {\n            submissionsCount: submissionsData.length,\n            totalRecords: result.data.pagination?.totalRecords || 0,\n            filters: currentFilters.filters,\n            page: currentFilters.page,\n            firstSubmission: submissionsData[0] ? {\n              id: submissionsData[0].submission_id,\n              title: submissionsData[0].submission_title,\n              author: submissionsData[0].author\n            } : null\n          });\n        }\n        \n        setSubmissionsState({\n          loading: false,\n          data: {\n            submissions: submissionsData,\n            pagination: result.data.pagination || {\n              currentPage: currentFilters.page,\n              pageSize: currentFilters.pageSize,\n              totalRecords: 0\n            }\n          },\n          error: undefined\n        });\n\n        // Initialize infinite scroll data on first load\n        if (infiniteScroll && currentFilters.page === 1) {\n          setInfiniteData(result.data.data || []);\n          setInfinitePage(1);\n          setHasMore((result.data.data?.length || 0) === currentFilters.pageSize);\n        }\n      } else {\n        setSubmissionsState({\n          loading: false,\n          data: undefined,\n          error: result.error || 'Failed to fetch submissions'\n        });\n      }\n      logger.groupEnd();\n    } catch (error: unknown) {\n      logger.error('Error in useSubmissionsFetch', error as Error, {\n        filters: currentFilters.filters,\n        page: currentFilters.page,\n        onlyMine,\n        userId\n      });\n      setSubmissionsState((prevState: SubmissionsState) => ({\n        ...prevState,\n        loading: false,\n        error:\n          error instanceof Error ? error.message : 'Failed to fetch submissions'\n      }));\n      logger.groupEnd();\n    } finally {\n      clearTimeout(loadingTimeout);\n      isFetching.current = false;\n    }\n  }, [\n    // Remove fetchKey from dependencies - calculate it at execution time instead\n    onlyMine,\n    userId,\n    includeThreadReplies,\n    infiniteScroll,\n    setSubmissionsState,\n    setInfiniteData,\n    setInfinitePage,\n    setHasMore\n  ]);\n\n  // Simple fetch when filters change - use stable fetchKey\n  useEffect(() => {\n    if (!filtersState.initialized) {\n      // Debug logging for skipped fetch\n      if (process.env.NODE_ENV === 'development') {\n        // eslint-disable-next-line no-console\n        console.log('\ud83d\udd0d Fetch Skipped - Not Initialized:', {\n          initialized: filtersState.initialized,\n          fetchKey: fetchKey.substring(0, 100) + '...'\n        });\n      }\n      return;\n    }\n\n    // Debug logging for triggered fetch\n    if (process.env.NODE_ENV === 'development') {\n      // eslint-disable-next-line no-console\n      console.log('\ud83d\udd0d Triggering Fetch:', {\n        fetchKey: fetchKey.substring(0, 100) + '...',\n        filters: filtersState.filters,\n        page: filtersState.page,\n        isFetching: isFetching.current\n      });\n    }\n\n    // Always try to fetch - fetchSubmissions handles race conditions internally\n    fetchSubmissions();\n  }, [fetchKey, fetchSubmissions]);\n\n  const forceRefresh = useCallback(() => {\n    // Force a refresh by clearing the lastFetchKey to bypass duplicate fetch check\n    lastFetchKey.current = '';\n    fetchSubmissions();\n  }, [fetchSubmissions]);\n\n  return {\n    fetchSubmissions,\n    forceRefresh\n  };\n} ",
    "language":"typescript",
    "lines":267,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/types.ts":{
    "content":"/**\n * Core types for the composable rich input system\n * Implementation-agnostic interfaces that can be used anywhere\n */\n\nexport interface RichInputPosition {\n  index: number;\n  line?: number;\n  column?: number;\n}\n\nexport interface RichInputSelection {\n  start: RichInputPosition;\n  end: RichInputPosition;\n  direction?: 'forward' | 'backward' | 'none';\n}\n\nexport interface RichInputRange {\n  start: number;\n  end: number;\n}\n\nexport type RichContentTokenType =\n  | 'text'\n  | 'hashtag'\n  | 'mention'\n  | 'url'\n  | 'emoji'\n  | 'image'\n  | 'markdown'\n  | 'custom';\n\nexport interface RichContentToken {\n  type: RichContentTokenType;\n  content: string;\n  rawText: string;\n  start: number;\n  end: number;\n\n  // Type-specific metadata\n  metadata?: {\n    // Hashtag\n    hashtag?: string;\n\n    // Mention\n    userId?: string;\n    username?: string;\n    displayName?: string;\n    filterType?: 'author' | 'mentions';\n\n    // URL\n    href?: string;\n    behavior?: 'link' | 'embed' | 'modal';\n\n    // Emoji\n    emojiId?: string;\n    emojiUnicode?: string;\n    emojiImageUrl?: string;\n\n    // Image\n    imageSrc?: string;\n    imageAlt?: string;\n    imageTitle?: string;\n\n    // Markdown\n    markdownType?: string;\n\n    // Custom\n    customType?: string;\n    customData?: Record<string, any>;\n\n    // Storage format (for editing/persistence)\n    originalFormat?: string;\n\n    // Whitespace and text properties\n    isWhitespace?: boolean;\n    isNewline?: boolean;\n    hasNewlines?: boolean;\n    isDummy?: boolean; // Mark as dummy token for empty state cursor positioning\n  };\n\n  // Width measurement for accurate cursor positioning\n  measuredWidth?: {\n    normal: number; // Width in normal mode\n    editMode?: number; // Width in edit mode (with controls)\n    lastMeasured?: number; // Timestamp of last measurement\n    containerSelector?: string; // CSS selector for the outer container to measure\n  };\n}\n\nexport interface RichInputState {\n  rawText: string;\n  tokens: RichContentToken[];\n  selection: RichInputSelection;\n  cursorPosition: RichInputPosition;\n  isMultiline: boolean;\n  isFocused: boolean;\n  history: RichInputHistoryEntry[];\n  historyIndex: number;\n\n  // Callback for content changes from interactive elements like URL pill controls\n  onContentChange?: (newText: string) => void;\n}\n\nexport interface RichInputHistoryEntry {\n  rawText: string;\n  selection: RichInputSelection;\n  timestamp: number;\n}\n\nexport interface RichInputConfig {\n  multiline?: boolean;\n  placeholder?: string;\n  maxLength?: number;\n  disabled?: boolean;\n\n  // Parser configuration\n  parsers?: {\n    hashtags?: boolean;\n    mentions?: boolean;\n    urls?: boolean;\n    emojis?: boolean;\n    images?: boolean;\n    markdown?: boolean;\n    custom?: RichContentParser[];\n  };\n\n  // Behavior configuration\n  behavior?: {\n    smartSelection?: boolean;\n    autoComplete?: boolean;\n    spellCheck?: boolean;\n    tabSize?: number;\n  };\n\n  // Styling configuration\n  styling?: {\n    className?: string;\n    style?: React.CSSProperties;\n    tokenStyles?: Record<RichContentTokenType, React.CSSProperties>;\n  };\n}\n\nexport interface RichContentParser {\n  name: string;\n  priority: number;\n  parse: (text: string) => RichContentToken[];\n  render?: (token: RichContentToken) => React.ReactNode;\n\n  // Width measurement capabilities\n  measureWidth?: (\n    token: RichContentToken,\n    context: {\n      isEditMode?: boolean;\n      containerElement?: HTMLElement;\n      measurementContainer?: HTMLElement;\n    }\n  ) => number;\n\n  // Pre-render for accurate measurements\n  preRender?: (\n    token: RichContentToken,\n    context: {\n      isEditMode?: boolean;\n      className?: string;\n    }\n  ) => HTMLElement;\n}\n\nexport interface RichInputEventHandlers {\n  onChange?: (state: RichInputState) => void;\n  onFocus?: (state: RichInputState) => void;\n  onBlur?: (state: RichInputState) => void;\n  onSelectionChange?: (\n    selection: RichInputSelection,\n    state: RichInputState\n  ) => void;\n  onKeyDown?: (event: KeyboardEvent, state: RichInputState) => boolean | void;\n  onKeyUp?: (event: KeyboardEvent, state: RichInputState) => boolean | void;\n  onPaste?: (event: ClipboardEvent, state: RichInputState) => boolean | void;\n  onCopy?: (event: ClipboardEvent, state: RichInputState) => boolean | void;\n  onCut?: (event: ClipboardEvent, state: RichInputState) => boolean | void;\n  onTokenClick?: (token: RichContentToken, state: RichInputState) => void;\n  onTokenHover?: (token: RichContentToken, state: RichInputState) => void;\n}\n\nexport interface RichInputAPI {\n  // State management\n  getState: () => RichInputState;\n  setState: (state: Partial<RichInputState>) => void;\n\n  // Text operations\n  insertText: (text: string, position?: RichInputPosition) => void;\n  deleteText: (range: RichInputRange) => void;\n  replaceText: (range: RichInputRange, newText: string) => void;\n\n  // Selection operations\n  setSelection: (selection: RichInputSelection) => void;\n  selectAll: () => void;\n  selectToken: (token: RichContentToken) => void;\n  getSelectedText: () => string;\n\n  // Cursor operations\n  setCursor: (position: RichInputPosition) => void;\n  moveCursor: (\n    direction: 'left' | 'right' | 'up' | 'down',\n    extend?: boolean\n  ) => void;\n\n  // History operations\n  undo: () => void;\n  redo: () => void;\n  saveHistoryEntry: () => void;\n\n  // Parser operations\n  reparse: () => void;\n  addParser: (parser: RichContentParser) => void;\n  removeParser: (name: string) => void;\n\n  // Utility operations\n  focus: () => void;\n  blur: () => void;\n  clear: () => void;\n  isEmpty: () => boolean;\n}\n\nexport interface RichInputRenderer {\n  renderToken: (\n    token: RichContentToken,\n    index: number,\n    state: RichInputState\n  ) => React.ReactNode;\n  renderCursor: (\n    position: RichInputPosition,\n    state: RichInputState\n  ) => React.ReactNode;\n  renderSelection: (\n    selection: RichInputSelection,\n    state: RichInputState\n  ) => React.ReactNode;\n  renderPlaceholder: (\n    placeholder: string,\n    state: RichInputState\n  ) => React.ReactNode;\n\n  // Line-based content rendering for multiline support\n  renderContent?: (\n    tokens: RichContentToken[],\n    state: RichInputState\n  ) => React.ReactNode;\n\n  // Width measurement support\n  measureTokenWidth?: (\n    token: RichContentToken,\n    context: {\n      isEditMode?: boolean;\n      containerElement?: HTMLElement;\n      measurementContainer?: HTMLElement;\n    }\n  ) => number;\n\n  // Pre-render token for measurements\n  preRenderToken?: (\n    token: RichContentToken,\n    context: {\n      isEditMode?: boolean;\n      className?: string;\n    }\n  ) => HTMLElement;\n}\n\nexport interface RichInputComponent {\n  config: RichInputConfig;\n  handlers: RichInputEventHandlers;\n  renderer: RichInputRenderer;\n  api: RichInputAPI;\n}\n",
    "language":"typescript",
    "lines":278,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/clickPositioning.ts":{
    "content":"/**\n * Click positioning utilities for rich input components\n * Handles converting mouse clicks to cursor positions with token awareness\n */\n\nimport { createLogger } from '@lib/logging';\nimport type { RichInputPosition } from '../types';\nimport { getFirstTextNode } from './cursorCalculations';\nimport { richTextLogger } from './logger';\nimport { findLastTextPosition } from './navigationUtils';\n\nconst logger = createLogger({\n  context: {\n    component: 'ClickPositioning',\n    module: 'rich-input/utils'\n  }\n});\n\n/**\n * Calculate click position with character-level precision\n * Uses a simpler coordinate-based approach that matches the working token click detection\n * Updated to work with line-based rendering structure\n */\nexport function calculateEnhancedClickPosition(\n  e: React.MouseEvent,\n  rawText: string,\n  contentElement: HTMLElement | null\n): RichInputPosition | null {\n  if (!contentElement) return null;\n\n  try {\n    const rect = contentElement.getBoundingClientRect();\n    const clickX = e.clientX - rect.left;\n    const clickY = e.clientY - rect.top;\n\n    richTextLogger.logInfo('\ud83d\udd0d Line-Based Click Position Debug', {\n      clickCoordinates: {\n        globalX: e.clientX,\n        globalY: e.clientY,\n        relativeX: clickX,\n        relativeY: clickY,\n        contentRect: { width: rect.width, height: rect.height }\n      }\n    });\n\n    // Check if we have line-based structure (multiline mode)\n    const lineElements = contentElement.querySelectorAll('.rich-input-line');\n\n    if (lineElements.length > 0) {\n      // Line-based rendering - find the clicked line first\n      for (const lineElement of lineElements) {\n        const lineRect = lineElement.getBoundingClientRect();\n        const lineRelativeRect = {\n          left: lineRect.left - rect.left,\n          top: lineRect.top - rect.top,\n          right: lineRect.right - rect.left,\n          bottom: lineRect.bottom - rect.top,\n          width: lineRect.width,\n          height: lineRect.height\n        };\n\n        // Check if click is within this line's vertical bounds\n        if (\n          clickY >= lineRelativeRect.top &&\n          clickY <= lineRelativeRect.bottom\n        ) {\n          // Now find tokens within this line\n          const lineTokenElements =\n            lineElement.querySelectorAll('[data-token-start]');\n\n          for (const tokenElement of lineTokenElements) {\n            const tokenRect = tokenElement.getBoundingClientRect();\n            const tokenRelativeRect = {\n              left: tokenRect.left - rect.left,\n              top: tokenRect.top - rect.top,\n              right: tokenRect.right - rect.left,\n              bottom: tokenRect.bottom - rect.top,\n              width: tokenRect.width,\n              height: tokenRect.height\n            };\n\n            // Check if click is within this token's bounds\n            if (\n              clickX >= tokenRelativeRect.left &&\n              clickX <= tokenRelativeRect.right &&\n              clickY >= tokenRelativeRect.top &&\n              clickY <= tokenRelativeRect.bottom\n            ) {\n              // Get token boundaries from data attributes\n              const tokenStart = parseInt(\n                tokenElement.getAttribute('data-token-start') || '0'\n              );\n              const tokenEnd = parseInt(\n                tokenElement.getAttribute('data-token-end') || '0'\n              );\n\n              // Calculate character position within token\n              const clickXInToken = clickX - tokenRelativeRect.left;\n              const avgCharWidth = 8; // Approximate character width\n              const charOffsetInToken = Math.floor(\n                clickXInToken / avgCharWidth\n              );\n              const clickedCharIndex = Math.min(\n                tokenStart + charOffsetInToken,\n                tokenEnd - 1\n              );\n\n              richTextLogger.logInfo('\ud83c\udfaf Found matching token in line', {\n                lineIndex: Array.from(lineElements).indexOf(lineElement),\n                tokenBounds: tokenRelativeRect,\n                tokenStart,\n                tokenEnd,\n                clickXInToken,\n                charOffsetInToken,\n                clickedCharIndex,\n                character: rawText.charAt(clickedCharIndex)\n              });\n\n              return {\n                index: Math.max(0, Math.min(clickedCharIndex, rawText.length))\n              };\n            }\n          }\n\n          // Click is within line but not within any token - position at end of line\n          const lineIndex = Array.from(lineElements).indexOf(lineElement);\n          const lineStart = parseInt(\n            lineElement.getAttribute('data-line-start') || '0'\n          );\n          const lineEnd = parseInt(\n            lineElement.getAttribute('data-line-end') ||\n              rawText.length.toString()\n          );\n\n          // Position at end of line content (excluding trailing whitespace)\n          const lineText = rawText.substring(lineStart, lineEnd);\n          const trimmedLineText = lineText.trimEnd();\n          const lineEndPosition = lineStart + trimmedLineText.length;\n\n          richTextLogger.logInfo('\ud83c\udfaf Click within line but outside tokens', {\n            lineIndex,\n            lineStart,\n            lineEnd,\n            lineText: JSON.stringify(lineText),\n            trimmedLineText: JSON.stringify(trimmedLineText),\n            lineEndPosition,\n            clickXPosition: clickX,\n            lineWidth: lineRelativeRect.width\n          });\n\n          return {\n            index: Math.max(0, Math.min(lineEndPosition, rawText.length))\n          };\n        }\n      }\n\n      // Click is outside all lines - determine if above first line or below last line\n      const firstLineElement = lineElements[0];\n      const lastLineElement = lineElements[lineElements.length - 1];\n\n      if (firstLineElement && lastLineElement) {\n        const firstLineRect = firstLineElement.getBoundingClientRect();\n        const lastLineRect = lastLineElement.getBoundingClientRect();\n        const firstLineTop = firstLineRect.top - rect.top;\n        const lastLineBottom = lastLineRect.bottom - rect.top;\n\n        if (clickY < firstLineTop) {\n          // Click above first line - position at beginning of document\n          richTextLogger.logInfo(\n            '\ud83c\udfaf Click above first line - positioning at start',\n            {\n              clickY,\n              firstLineTop\n            }\n          );\n          return { index: 0 };\n        } else if (clickY > lastLineBottom) {\n          // Click below last line - position at end of document\n          const lastTextPosition = findLastTextPosition(rawText);\n          richTextLogger.logInfo(\n            '\ud83c\udfaf Click below last line - positioning at end',\n            {\n              clickY,\n              lastLineBottom,\n              lastTextPosition\n            }\n          );\n          return { index: lastTextPosition };\n        }\n      }\n    } else {\n      // Fallback to original token-based approach for single-line mode\n      const tokenElements =\n        contentElement.querySelectorAll('[data-token-start]');\n\n      // Check each token element to see if the click is within it\n      for (const tokenElement of tokenElements) {\n        const tokenRect = tokenElement.getBoundingClientRect();\n        const tokenRelativeRect = {\n          left: tokenRect.left - rect.left,\n          top: tokenRect.top - rect.top,\n          right: tokenRect.right - rect.left,\n          bottom: tokenRect.bottom - rect.top,\n          width: tokenRect.width,\n          height: tokenRect.height\n        };\n\n        // Check if click is within this token's bounds\n        if (\n          clickX >= tokenRelativeRect.left &&\n          clickX <= tokenRelativeRect.right &&\n          clickY >= tokenRelativeRect.top &&\n          clickY <= tokenRelativeRect.bottom\n        ) {\n          // Get token boundaries from data attributes\n          const tokenStart = parseInt(\n            tokenElement.getAttribute('data-token-start') || '0'\n          );\n          const tokenEnd = parseInt(\n            tokenElement.getAttribute('data-token-end') || '0'\n          );\n\n          // Calculate character position within token\n          const clickXInToken = clickX - tokenRelativeRect.left;\n          const avgCharWidth = 8; // Approximate character width\n          const charOffsetInToken = Math.floor(clickXInToken / avgCharWidth);\n          const clickedCharIndex = Math.min(\n            tokenStart + charOffsetInToken,\n            tokenEnd - 1\n          );\n\n          richTextLogger.logInfo('\ud83c\udfaf Found matching token for click', {\n            tokenBounds: tokenRelativeRect,\n            tokenStart,\n            tokenEnd,\n            clickXInToken,\n            charOffsetInToken,\n            clickedCharIndex,\n            character: rawText.charAt(clickedCharIndex)\n          });\n\n          return {\n            index: Math.max(0, Math.min(clickedCharIndex, rawText.length))\n          };\n        }\n      }\n    }\n\n    // If no token was clicked, fall back to simple coordinate estimation\n    // This handles clicks in empty areas or between tokens\n    const totalWidth = rect.width;\n    const relativeX = Math.max(0, Math.min(clickX, totalWidth));\n    const estimatedIndex = Math.round(\n      (relativeX / totalWidth) * rawText.length\n    );\n\n    richTextLogger.logInfo('\ud83d\udd04 Using fallback coordinate estimation', {\n      totalWidth,\n      relativeX,\n      estimatedIndex,\n      rawTextLength: rawText.length\n    });\n\n    return { index: Math.max(0, Math.min(estimatedIndex, rawText.length)) };\n  } catch (error) {\n    richTextLogger.logInfo('\u274c Error in line-based click positioning', {\n      error\n    });\n    return { index: 0 };\n  }\n}\n\n/**\n * Calculate cursor position from mouse click using token-aware system\n */\nexport function calculateTokenAwareClickPosition(\n  e: React.MouseEvent,\n  rawText: string,\n  contentElement: HTMLElement\n): RichInputPosition | null {\n  if (!contentElement) return null;\n\n  try {\n    const rect = contentElement.getBoundingClientRect();\n    const clickX = e.clientX - rect.left;\n    const clickY = e.clientY - rect.top;\n\n    // Analyze text for newlines\n    const newlinePositions = [];\n    for (let i = 0; i < rawText.length; i++) {\n      if (rawText[i] === '\\\\n') {\n        newlinePositions.push(i);\n      }\n    }\n    const hasNewlines = newlinePositions.length > 0;\n    const lineCount = hasNewlines ? newlinePositions.length + 1 : 1;\n\n    // Get all tokens for analysis\n    const tokenElements = contentElement.querySelectorAll('[data-token-index]');\n    const tokens = Array.from(tokenElements).map((el, index) => {\n      const element = el as HTMLElement;\n      return {\n        index,\n        type: element.dataset.tokenType || 'text',\n        content: element.dataset.tokenContent || '',\n        rawText: element.textContent || '',\n        start: parseInt(element.dataset.tokenStart || '0'),\n        end: parseInt(element.dataset.tokenEnd || '0'),\n        metadata: {\n          isNewline: element.dataset.isNewline === 'true',\n          isWhitespace: element.dataset.isWhitespace === 'true'\n        }\n      };\n    });\n\n    richTextLogger.logCursorPositioning({\n      clickCoordinates: { x: clickX, y: clickY },\n      rawText,\n      tokens,\n      newlineInfo: {\n        hasNewlines,\n        newlinePositions,\n        lineCount\n      },\n      domElements: {\n        contentElement: contentElement.tagName,\n        tokenElements: tokenElements.length\n      }\n    });\n\n    richTextLogger.logInfo('Processing token-aware click', {\n      clickCoordinates: `(${clickX}, ${clickY})`,\n      contentElementBounds: {\n        width: rect.width,\n        height: rect.height\n      }\n    });\n\n    // Special handling for empty input with dummy token\n    if (rawText.length === 0 && tokenElements.length === 1) {\n      const dummyElement = tokenElements[0] as HTMLElement;\n      if (dummyElement.getAttribute('data-is-dummy') === 'true') {\n        richTextLogger.logInfo('Click on dummy token in empty input', {\n          clickCoordinates: { x: clickX, y: clickY }\n        });\n        return { index: 0 };\n      }\n    }\n\n    // Find the token element that was clicked\n    for (let i = 0; i < tokenElements.length; i++) {\n      const tokenElement = tokenElements[i] as HTMLElement;\n      const tokenRect = tokenElement.getBoundingClientRect();\n\n      // Calculate token bounds relative to content element\n      const tokenRelativeLeft = tokenRect.left - rect.left;\n      const tokenRelativeRight = tokenRect.right - rect.left;\n      const tokenRelativeTop = tokenRect.top - rect.top;\n      const tokenRelativeBottom = tokenRect.bottom - rect.top;\n\n      // Check if click is within this token's bounds\n      if (\n        clickX >= tokenRelativeLeft &&\n        clickX <= tokenRelativeRight &&\n        clickY >= tokenRelativeTop &&\n        clickY <= tokenRelativeBottom\n      ) {\n        // Click is within this token\n        const tokenStart = parseInt(tokenElement.dataset.tokenStart || '0');\n        const tokenEnd = parseInt(tokenElement.dataset.tokenEnd || '0');\n        const isWhitespace = tokenElement.dataset.isWhitespace === 'true';\n        const isNewline = tokenElement.dataset.isNewline === 'true';\n\n        const foundToken = {\n          tokenIndex: i,\n          type: tokenElement.dataset.tokenType || 'text',\n          content: tokenElement.dataset.tokenContent || '',\n          rawText: tokenElement.textContent || '',\n          start: tokenStart,\n          end: tokenEnd,\n          metadata: { isWhitespace, isNewline }\n        };\n\n        richTextLogger.logInfo('Found clicked token', {\n          tokenIndex: i,\n          tokenBounds: `${tokenStart}-${tokenEnd}`,\n          isWhitespace,\n          isNewline,\n          tokenType: tokenElement.dataset.tokenType,\n          clickXInToken: clickX - tokenRelativeLeft\n        });\n\n        // For newline tokens, allow positioning before or after the newline\n        if (isNewline) {\n          // For newline tokens, check if click is closer to start or end\n          const tokenCenterX =\n            tokenRelativeLeft + (tokenRelativeRight - tokenRelativeLeft) / 2;\n\n          // If click is before center, position before newline, otherwise after\n          const positionAfterNewline = clickX > tokenCenterX;\n          const cursorIndex = positionAfterNewline ? tokenEnd : tokenStart;\n          const charOffsetInToken = positionAfterNewline ? 1 : 0; // 0 = before newline, 1 = after newline\n\n          const calculatedPosition = {\n            index: cursorIndex,\n            tokenIndex: i,\n            charOffsetInToken\n          };\n\n          richTextLogger.logCursorPositioning({\n            clickCoordinates: { x: clickX, y: clickY },\n            textIndex: cursorIndex,\n            foundToken,\n            calculatedPosition,\n            newlineInfo: {\n              hasNewlines,\n              newlinePositions,\n              lineCount\n            }\n          });\n\n          return { index: cursorIndex };\n        }\n\n        // For other whitespace tokens, position cursor at the beginning\n        if (isWhitespace) {\n          const calculatedPosition = {\n            index: tokenStart,\n            tokenIndex: i,\n            charOffsetInToken: 0\n          };\n\n          richTextLogger.logCursorPositioning({\n            clickCoordinates: { x: clickX, y: clickY },\n            textIndex: tokenStart,\n            foundToken,\n            calculatedPosition,\n            newlineInfo: {\n              hasNewlines,\n              newlinePositions,\n              lineCount\n            }\n          });\n\n          return { index: tokenStart };\n        }\n\n        // For non-whitespace tokens, calculate precise character position\n        const charPosition = calculateCharacterPositionInToken(\n          clickX - tokenRelativeLeft,\n          tokenElement,\n          tokenStart,\n          tokenEnd\n        );\n\n        const calculatedPosition = {\n          index: charPosition,\n          tokenIndex: i,\n          charOffsetInToken: charPosition - tokenStart\n        };\n\n        richTextLogger.logCursorPositioning({\n          clickCoordinates: { x: clickX, y: clickY },\n          textIndex: charPosition,\n          foundToken,\n          calculatedPosition,\n          newlineInfo: {\n            hasNewlines,\n            newlinePositions,\n            lineCount\n          }\n        });\n\n        return { index: charPosition };\n      }\n    }\n\n    // Click is outside all tokens - check if we're clicking on a blank line\n    richTextLogger.logInfo(\n      'Click outside all tokens, checking for blank line positioning'\n    );\n\n    // Check if we're clicking near a newline position\n    if (hasNewlines && newlinePositions.length > 0) {\n      // Estimate line height from content element\n      const computedStyle = window.getComputedStyle(contentElement);\n      const lineHeight =\n        parseFloat(computedStyle.lineHeight) ||\n        parseFloat(computedStyle.fontSize) * 1.4 ||\n        20; // fallback\n\n      // Calculate which line the click is on based on Y coordinate\n      const clickedLineIndex = Math.floor(clickY / lineHeight);\n\n      richTextLogger.logInfo('Blank line click analysis', {\n        clickY,\n        lineHeight,\n        clickedLineIndex,\n        totalLines: lineCount,\n        newlinePositions\n      });\n\n      // If clicking on a line that exists and is near the left edge (suggesting blank line)\n      if (\n        clickedLineIndex >= 0 &&\n        clickedLineIndex < lineCount &&\n        clickX < 50\n      ) {\n        // For line 0, position at start\n        if (clickedLineIndex === 0) {\n          const calculatedPosition = {\n            index: 0,\n            tokenIndex: -1,\n            charOffsetInToken: 0\n          };\n\n          richTextLogger.logCursorPositioning({\n            clickCoordinates: { x: clickX, y: clickY },\n            textIndex: 0,\n            calculatedPosition,\n            blankLineInfo: {\n              clickedLineIndex,\n              positionedAtStart: true\n            }\n          });\n\n          return { index: 0 };\n        }\n\n        // For other lines, check if we have a newline at the expected position\n        if (clickedLineIndex <= newlinePositions.length) {\n          // Position after the previous newline\n          const targetNewlineIndex = clickedLineIndex - 1;\n          if (\n            targetNewlineIndex >= 0 &&\n            targetNewlineIndex < newlinePositions.length\n          ) {\n            const newlinePosition = newlinePositions[targetNewlineIndex];\n            const cursorPosition = newlinePosition + 1; // Position after the newline\n\n            const calculatedPosition = {\n              index: cursorPosition,\n              tokenIndex: -1,\n              charOffsetInToken: 0\n            };\n\n            richTextLogger.logCursorPositioning({\n              clickCoordinates: { x: clickX, y: clickY },\n              textIndex: cursorPosition,\n              calculatedPosition,\n              blankLineInfo: {\n                clickedLineIndex,\n                targetNewlineIndex,\n                newlinePosition,\n                positionedAfterNewline: true\n              }\n            });\n\n            return { index: cursorPosition };\n          }\n        }\n      }\n    }\n\n    // Default fallback - position at end\n    const calculatedPosition = {\n      index: rawText.length,\n      tokenIndex: -1,\n      charOffsetInToken: 0\n    };\n\n    richTextLogger.logCursorPositioning({\n      clickCoordinates: { x: clickX, y: clickY },\n      textIndex: rawText.length,\n      calculatedPosition,\n      newlineInfo: {\n        hasNewlines,\n        newlinePositions,\n        lineCount\n      }\n    });\n\n    return { index: rawText.length };\n  } catch (error) {\n    logger.warn('Error in token-aware click positioning', { error });\n    return { index: 0 };\n  }\n}\n\n/**\n * Calculate the character position within a token based on click X coordinate\n */\nexport function calculateCharacterPositionInToken(\n  clickXInToken: number,\n  tokenElement: HTMLElement,\n  tokenStart: number,\n  tokenEnd: number\n): number {\n  try {\n    // Check if this token has newlines (multiline content)\n    const hasNewlines =\n      tokenElement.getAttribute('data-has-newlines') === 'true';\n\n    if (hasNewlines) {\n      // For multiline tokens, use the full token content from data attributes\n      const fullTokenText =\n        tokenElement.getAttribute('data-token-content') ||\n        tokenElement.textContent ||\n        '';\n      return calculateCharacterPositionInMultilineToken(\n        clickXInToken,\n        tokenElement,\n        tokenStart,\n        tokenEnd,\n        fullTokenText\n      );\n    }\n\n    // For single-line tokens, use the existing logic\n    const textNode = getFirstTextNode(tokenElement);\n    if (!textNode || !textNode.textContent) {\n      return tokenStart;\n    }\n\n    const tokenText = textNode.textContent;\n    const tokenLength = tokenText.length;\n\n    // Use browser's caretPositionFromPoint for precise positioning (if available)\n    const documentWithCaret = document as any;\n    if (documentWithCaret.caretPositionFromPoint) {\n      try {\n        const tokenRect = tokenElement.getBoundingClientRect();\n        const absoluteX = tokenRect.left + clickXInToken;\n        const absoluteY = tokenRect.top + tokenRect.height / 2;\n\n        const caretPosition = documentWithCaret.caretPositionFromPoint(\n          absoluteX,\n          absoluteY\n        );\n        if (caretPosition && tokenElement.contains(caretPosition.offsetNode)) {\n          const offset = caretPosition.offset;\n          const charIndex = tokenStart + Math.min(offset, tokenLength);\n\n          richTextLogger.logInfo('Calculated character position in token', {\n            clickXInToken,\n            caretOffset: offset,\n            calculatedIndex: charIndex,\n            tokenText:\n              tokenText.substring(0, 20) + (tokenText.length > 20 ? '...' : '')\n          });\n\n          return charIndex;\n        }\n      } catch (error) {\n        logger.warn('Error using caretPositionFromPoint', { error });\n        // Fall through to proportional positioning\n      }\n    }\n\n    // Fallback: proportional positioning with improved accuracy\n    const tokenRect = tokenElement.getBoundingClientRect();\n    const tokenWidth = tokenRect.width;\n\n    if (tokenWidth <= 0) {\n      return tokenStart;\n    }\n\n    // Calculate proportion, ensuring it's within bounds\n    const proportion = Math.max(0, Math.min(1, clickXInToken / tokenWidth));\n\n    // Use more accurate character width estimation\n    const avgCharWidth = tokenWidth / tokenLength;\n    const charOffset = Math.round(clickXInToken / avgCharWidth);\n\n    // Ensure we don't exceed token bounds\n    const clampedCharOffset = Math.max(\n      0,\n      Math.min(charOffset, tokenLength - 1)\n    );\n    const charIndex = tokenStart + clampedCharOffset;\n\n    richTextLogger.logInfo('Used proportional positioning fallback', {\n      clickXInToken,\n      tokenWidth,\n      proportion,\n      avgCharWidth,\n      charOffset,\n      clampedCharOffset,\n      calculatedIndex: charIndex,\n      tokenLength\n    });\n\n    return charIndex;\n  } catch (error) {\n    logger.warn('Error calculating character position in token', { error });\n    return tokenStart;\n  }\n}\n\n/**\n * Calculate character position within a multiline token based on click coordinates\n */\nfunction calculateCharacterPositionInMultilineToken(\n  clickXInToken: number,\n  tokenElement: HTMLElement,\n  tokenStart: number,\n  tokenEnd: number,\n  fullTokenText: string\n): number {\n  try {\n    // Use browser's caretPositionFromPoint for precise positioning in multiline content\n    const documentWithCaret = document as any;\n    if (documentWithCaret.caretPositionFromPoint) {\n      try {\n        const tokenRect = tokenElement.getBoundingClientRect();\n        const absoluteX = tokenRect.left + clickXInToken;\n        const absoluteY = tokenRect.top + tokenRect.height / 2;\n\n        const caretPosition = documentWithCaret.caretPositionFromPoint(\n          absoluteX,\n          absoluteY\n        );\n\n        if (caretPosition && tokenElement.contains(caretPosition.offsetNode)) {\n          // For multiline tokens, we need to map the DOM position back to the raw text position\n          const domOffset = caretPosition.offset;\n          const targetNode = caretPosition.offsetNode;\n\n          // Calculate the position in the full raw text\n          const rawTextPosition = mapDOMPositionToRawText(\n            tokenElement,\n            targetNode,\n            domOffset,\n            fullTokenText\n          );\n\n          const charIndex =\n            tokenStart + Math.min(rawTextPosition, fullTokenText.length);\n\n          richTextLogger.logInfo(\n            'Calculated character position in multiline token',\n            {\n              clickXInToken,\n              domOffset,\n              rawTextPosition,\n              calculatedIndex: charIndex,\n              fullTokenText:\n                fullTokenText.substring(0, 30) +\n                (fullTokenText.length > 30 ? '...' : '')\n            }\n          );\n\n          return charIndex;\n        }\n      } catch (error) {\n        logger.warn('Error using caretPositionFromPoint for multiline:', {\n          error\n        });\n      }\n    }\n\n    // Fallback: use line-based positioning for multiline content\n    const lines = fullTokenText.split('\\\\n');\n    const tokenRect = tokenElement.getBoundingClientRect();\n\n    // Estimate line height\n    const estimatedLineHeight = tokenRect.height / lines.length;\n    const clickY = estimatedLineHeight / 2; // We don't have the actual clickY, so estimate middle of token\n    const clickedLineIndex = Math.floor(clickY / estimatedLineHeight);\n\n    if (clickedLineIndex >= 0 && clickedLineIndex < lines.length) {\n      // Calculate offset to the start of this line\n      let lineStartOffset = 0;\n      for (let i = 0; i < clickedLineIndex; i++) {\n        lineStartOffset += lines[i].length + 1; // +1 for the newline character\n      }\n\n      // Estimate character position within the line\n      const lineText = lines[clickedLineIndex];\n      const lineWidth = tokenRect.width; // Assume full width for now\n      const avgCharWidth = lineWidth / Math.max(lineText.length, 1);\n      const charOffsetInLine = Math.round(clickXInToken / avgCharWidth);\n      const clampedCharOffsetInLine = Math.max(\n        0,\n        Math.min(charOffsetInLine, lineText.length)\n      );\n\n      const finalPosition = lineStartOffset + clampedCharOffsetInLine;\n      const charIndex =\n        tokenStart + Math.min(finalPosition, fullTokenText.length);\n\n      richTextLogger.logInfo(\n        'Used line-based positioning fallback for multiline',\n        {\n          clickXInToken,\n          clickedLineIndex,\n          lineStartOffset,\n          charOffsetInLine: clampedCharOffsetInLine,\n          finalPosition,\n          calculatedIndex: charIndex,\n          lineText:\n            lineText.substring(0, 20) + (lineText.length > 20 ? '...' : '')\n        }\n      );\n\n      return charIndex;\n    }\n\n    // Final fallback: return start of token\n    return tokenStart;\n  } catch (error) {\n    logger.warn('Error calculating character position in multiline token:', {\n      error\n    });\n    return tokenStart;\n  }\n}\n\n/**\n * Map a DOM position (node + offset) back to the raw text position within a multiline token\n */\nfunction mapDOMPositionToRawText(\n  tokenElement: HTMLElement,\n  targetNode: Node,\n  domOffset: number,\n  fullTokenText: string\n): number {\n  try {\n    // Walk through the DOM structure to find where this position maps to in the raw text\n    const childNodes = Array.from(tokenElement.childNodes);\n    let rawTextOffset = 0;\n\n    for (const node of childNodes) {\n      if (node === targetNode) {\n        // Found the target node, add the offset within this node\n        return rawTextOffset + domOffset;\n      }\n\n      if (node.nodeType === Node.TEXT_NODE) {\n        // Text node - add its length to the raw text offset\n        const textContent = node.textContent || '';\n        if (node === targetNode) {\n          return rawTextOffset + domOffset;\n        }\n        rawTextOffset += textContent.length;\n      } else if (node.nodeName === 'BR') {\n        // BR element represents a newline in the raw text\n        rawTextOffset += 1; // Add 1 for the \\\\n character\n      }\n    }\n\n    // If we didn't find the target node, return the current offset\n    return rawTextOffset;\n  } catch (error) {\n    logger.warn('Error mapping DOM position to raw text', { error });\n    return 0;\n  }\n}\n",
    "language":"typescript",
    "lines":859,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/navigationUtils.ts":{
    "content":"/**\n * Navigation utilities for rich input components\n * Handles word boundaries, cursor snapping, and smart navigation\n */\n\nimport { createLogger } from '@/lib/logging';\nimport { ContentParser } from '../../utils/content-parsers';\nimport type { RichInputPosition } from '../types';\n\nconst logger = createLogger({\n  context: {\n    component: 'NavigationUtils',\n    module: 'rich-input/utils'\n  },\n  enabled: false\n});\n\n/**\n * Smart cursor snapping that respects pill boundaries while allowing character-level precision\n */\nexport function smartCursorSnap(\n  position: RichInputPosition,\n  rawText: string,\n  enablePillSnapping: boolean = true\n): RichInputPosition {\n  if (!enablePillSnapping) return position;\n\n  try {\n    const tokenizedContent = ContentParser.tokenize(rawText);\n\n    // Check if cursor is inside a pill\n    const pill = ContentParser.getPillAt(tokenizedContent, position.index);\n    if (pill) {\n      // Snap to nearest pill boundary\n      const distanceToStart = position.index - pill.start;\n      const distanceToEnd = pill.end - position.index;\n\n      // Snap to the closer boundary\n      return {\n        index: distanceToStart <= distanceToEnd ? pill.start : pill.end\n      };\n    }\n\n    return position;\n  } catch (error) {\n    logger.warn('Error in smart cursor snapping', { error });\n    return position;\n  }\n}\n\n/**\n * Get word boundaries for enhanced navigation\n */\nexport function getWordBoundaries(\n  position: RichInputPosition,\n  rawText: string\n): {\n  previousWord: number;\n  nextWord: number;\n  currentWordStart: number;\n  currentWordEnd: number;\n} {\n  try {\n    const tokenizedContent = ContentParser.tokenize(rawText);\n\n    const previousWord = ContentParser.getPreviousWordPosition(\n      tokenizedContent,\n      position.index\n    );\n    const nextWord = ContentParser.getNextWordPosition(\n      tokenizedContent,\n      position.index\n    );\n\n    const currentWord = ContentParser.getWordAt(\n      tokenizedContent,\n      position.index\n    );\n    const currentWordStart = currentWord?.start ?? position.index;\n    const currentWordEnd = currentWord?.end ?? position.index;\n\n    return {\n      previousWord,\n      nextWord,\n      currentWordStart,\n      currentWordEnd\n    };\n  } catch (error) {\n    logger.warn('Error getting word boundaries', { error });\n    return {\n      previousWord: 0,\n      nextWord: rawText.length,\n      currentWordStart: position.index,\n      currentWordEnd: position.index\n    };\n  }\n}\n\n/**\n * Find the next newline position from a given index\n */\nexport function findNextNewline(rawText: string, fromIndex: number): number {\n  const newlineIndex = rawText.indexOf('\\\\n', fromIndex);\n  return newlineIndex === -1 ? rawText.length : newlineIndex;\n}\n\n/**\n * Find the previous newline position from a given index\n */\nexport function findPreviousNewline(\n  rawText: string,\n  fromIndex: number\n): number {\n  const newlineIndex = rawText.lastIndexOf('\\\\n', fromIndex - 1);\n  return newlineIndex === -1 ? 0 : newlineIndex + 1;\n}\n\n/**\n * Get line boundaries for a given position\n */\nexport function getLineBoundaries(\n  position: RichInputPosition,\n  rawText: string\n): {\n  lineStart: number;\n  lineEnd: number;\n  lineNumber: number;\n  totalLines: number;\n} {\n  const lineStart = findPreviousNewline(rawText, position.index);\n  const lineEnd = findNextNewline(rawText, position.index);\n\n  // Count lines up to current position\n  const textBeforePosition = rawText.substring(0, position.index);\n  const lineNumber = (textBeforePosition.match(/\\\\n/g) || []).length;\n\n  // Count total lines\n  const totalLines = (rawText.match(/\\\\n/g) || []).length + 1;\n\n  return {\n    lineStart,\n    lineEnd,\n    lineNumber,\n    totalLines\n  };\n}\n\n/**\n * Navigate to start of line\n */\nexport function navigateToLineStart(\n  position: RichInputPosition,\n  rawText: string\n): RichInputPosition {\n  const lineStart = findPreviousNewline(rawText, position.index);\n  return { index: lineStart };\n}\n\n/**\n * Navigate to end of line\n */\nexport function navigateToLineEnd(\n  position: RichInputPosition,\n  rawText: string\n): RichInputPosition {\n  const lineEnd = findNextNewline(rawText, position.index);\n  return { index: lineEnd };\n}\n\n/**\n * Navigate up one line while preserving column position\n * Enhanced to handle first line edge case\n */\nexport function navigateUpLine(\n  position: RichInputPosition,\n  rawText: string\n): RichInputPosition {\n  const currentLineStart = findPreviousNewline(rawText, position.index);\n  const columnPosition = position.index - currentLineStart;\n\n  if (currentLineStart === 0) {\n    // Already at first line, move to very beginning (position 0)\n    return { index: 0 };\n  }\n\n  const previousLineStart = findPreviousNewline(rawText, currentLineStart - 1);\n  const previousLineEnd = currentLineStart - 1; // -1 to exclude the newline\n  const previousLineLength = previousLineEnd - previousLineStart;\n\n  // Position cursor at same column or end of line if shorter\n  const targetColumn = Math.min(columnPosition, previousLineLength);\n  return { index: previousLineStart + targetColumn };\n}\n\n/**\n * Navigate down one line while preserving column position\n * Enhanced to handle last line edge case\n */\nexport function navigateDownLine(\n  position: RichInputPosition,\n  rawText: string\n): RichInputPosition {\n  const currentLineStart = findPreviousNewline(rawText, position.index);\n  const columnPosition = position.index - currentLineStart;\n\n  const nextLineStart = findNextNewline(rawText, position.index);\n  if (nextLineStart >= rawText.length) {\n    // Already at last line, move to end of content (after last text or atomic group)\n    return { index: findLastTextPosition(rawText) };\n  }\n\n  const nextLineEnd = findNextNewline(rawText, nextLineStart + 1);\n  const nextLineLength = nextLineEnd - (nextLineStart + 1);\n\n  // Position cursor at same column or end of line if shorter\n  const targetColumn = Math.min(columnPosition, nextLineLength);\n  return { index: nextLineStart + 1 + targetColumn };\n}\n\n/**\n * Find the last meaningful text position in the content\n * This includes text and atomic units (pills, images, etc.) but skips trailing whitespace\n */\nexport function findLastTextPosition(rawText: string): number {\n  // Trim trailing whitespace to find the last meaningful content\n  const trimmedText = rawText.trimEnd();\n  return trimmedText.length;\n}\n\n/**\n * Find the end position of a specific line\n * Enhanced to handle atomic units properly\n */\nexport function findLineEndPosition(\n  lineIndex: number,\n  rawText: string\n): number {\n  const lines = rawText.split('\\\\n');\n\n  if (lineIndex >= lines.length) {\n    return rawText.length;\n  }\n\n  // Calculate the start position of the target line\n  let lineStartPosition = 0;\n  for (let i = 0; i < lineIndex; i++) {\n    lineStartPosition += lines[i].length + 1; // +1 for newline\n  }\n\n  // Find the end of the line (excluding trailing whitespace on that line)\n  const lineText = lines[lineIndex];\n  const trimmedLineText = lineText.trimEnd();\n\n  return lineStartPosition + trimmedLineText.length;\n}\n",
    "language":"typescript",
    "lines":256,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/measurementHelpers.ts":{
    "content":"import type { RichContentToken } from '../types';\n\n// Get accurate character width for monospace font calculations\nexport function getAccurateCharWidth(contentElement: HTMLElement): number {\n  // Create a temporary span with the same styling as the content element\n  const tempSpan = document.createElement('span');\n  tempSpan.style.position = 'absolute';\n  tempSpan.style.visibility = 'hidden';\n  tempSpan.style.whiteSpace = 'pre';\n\n  // Copy computed styles from the content element for accuracy\n  const computedStyle = window.getComputedStyle(contentElement);\n  tempSpan.style.fontSize = computedStyle.fontSize;\n  tempSpan.style.fontFamily = computedStyle.fontFamily;\n  tempSpan.style.fontWeight = computedStyle.fontWeight;\n  tempSpan.style.letterSpacing = computedStyle.letterSpacing;\n\n  // Use 'M' as reference character for monospace measurement\n  tempSpan.textContent = 'M';\n\n  document.body.appendChild(tempSpan);\n  const width = tempSpan.getBoundingClientRect().width;\n  document.body.removeChild(tempSpan);\n\n  return width;\n}\n\nexport function measureTokenWidthAccurate(\n  token: RichContentToken,\n  contentElement: HTMLElement\n): number {\n  // Try to find existing rendered token first\n  const existingToken = contentElement.querySelector(\n    `[data-token-start=\\\"${token.start}\\\"][data-token-end=\\\"${token.end}\\\"]`\n  ) as HTMLElement;\n\n  if (existingToken) {\n    // Use actual rendered width\n    return existingToken.offsetWidth;\n  }\n\n  // For monospace font calculations\n  const getMonospaceCharWidth = (): number => {\n    return getAccurateCharWidth(contentElement);\n  };\n\n  // For pills (hashtags, mentions, URLs), we still need to measure actual rendered width\n  // because they have padding, borders, and other styling\n  if (\n    token.type === 'hashtag' ||\n    token.type === 'mention' ||\n    token.type === 'url'\n  ) {\n    // Create a temporary span with the same styling as the content element\n    const tempSpan = document.createElement('span');\n    tempSpan.style.position = 'absolute';\n    tempSpan.style.visibility = 'hidden';\n    tempSpan.style.whiteSpace = 'pre';\n\n    // Copy computed styles from the content element for accuracy\n    const computedStyle = window.getComputedStyle(contentElement);\n    tempSpan.style.fontSize = computedStyle.fontSize;\n    tempSpan.style.fontFamily = computedStyle.fontFamily;\n    tempSpan.style.fontWeight = computedStyle.fontWeight;\n    tempSpan.style.letterSpacing = computedStyle.letterSpacing;\n\n    // Apply appropriate styling based on token type\n    if (token.type === 'hashtag') {\n      tempSpan.className = 'rich-input-hashtag';\n      tempSpan.textContent = token.rawText; // Should include the #\n    } else if (token.type === 'mention') {\n      tempSpan.className = 'rich-input-mention';\n      tempSpan.textContent = token.rawText; // Should include the @\n    } else if (token.type === 'url') {\n      tempSpan.className = 'rich-input-url';\n      tempSpan.textContent = token.rawText;\n    }\n\n    document.body.appendChild(tempSpan);\n    const width = tempSpan.getBoundingClientRect().width;\n    document.body.removeChild(tempSpan);\n\n    return width;\n  } else {\n    // For text tokens, use monospace character width calculation\n    const charWidth = getMonospaceCharWidth();\n    return token.rawText.length * charWidth;\n  }\n}\n\n// Helper function to get visual text for a token\nexport function getVisualTextForToken(token: RichContentToken): string {\n  switch (token.type) {\n    case 'hashtag':\n      return token.rawText; // #hashtag shows as #hashtag\n    case 'mention': {\n      // @[username|id|author] shows as @username\n      const mentionMatch = token.rawText.match(/^@\\\\[([^|]+)\\\\|/);\n      return mentionMatch ? `@${mentionMatch[1]}` : token.rawText;\n    }\n    case 'url':\n      // For URLs, show the full URL text as it appears\n      return token.rawText;\n    case 'emoji':\n      // Emojis show as their unicode representation\n      return token.rawText;\n    case 'text':\n    default:\n      return token.rawText;\n  }\n}\n",
    "language":"typescript",
    "lines":112,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/tokenPositioning.ts":{
    "content":"/**\n * Token positioning utilities for rich input components\n * Handles finding tokens at positions and creating token objects from DOM elements\n */\n\nimport type { RichContentToken } from '../types';\nimport { richTextLogger } from './logger';\n\nexport interface TokenPosition {\n  tokenIndex: number;\n  charOffsetInToken: number;\n  token: RichContentToken;\n}\n\n/**\n * Helper function to get token raw text, handling br elements properly\n */\nexport function getTokenRawText(tokenElement: HTMLElement): string {\n  // For br elements and other elements without textContent, use data-token-content\n  return tokenElement.dataset.tokenContent || tokenElement.textContent || '';\n}\n\n/**\n * Find which token contains the given text position\n */\nexport function findTokenAtPosition(\n  textIndex: number,\n  contentElement: HTMLElement\n): TokenPosition | null {\n  const tokenElements = contentElement.querySelectorAll('[data-token-index]');\n\n  richTextLogger.logInfo('Finding token for text index', {\n    textIndex,\n    totalTokens: tokenElements.length\n  });\n\n  for (let i = 0; i < tokenElements.length; i++) {\n    const tokenElement = tokenElements[i] as HTMLElement;\n    const tokenStart = parseInt(tokenElement.dataset.tokenStart || '0');\n    const tokenEnd = parseInt(tokenElement.dataset.tokenEnd || '0');\n    const isNewline = tokenElement.getAttribute('data-is-newline') === 'true';\n\n    // Check if the text index falls within this token's bounds\n    // For newline tokens, include the end position since we position cursor after newlines\n    const includesPosition = isNewline\n      ? textIndex >= tokenStart && textIndex <= tokenEnd\n      : textIndex >= tokenStart && textIndex < tokenEnd;\n\n    if (includesPosition) {\n      // Found the token containing this position\n      const charOffsetInToken =\n        isNewline && textIndex === tokenEnd\n          ? 1 // Position after newline\n          : textIndex - tokenStart; // Position before newline or within regular token\n\n      // Create token object from DOM data with metadata\n      const token: RichContentToken = {\n        type: tokenElement.dataset.tokenType as any,\n        content: tokenElement.dataset.tokenContent || '',\n        rawText: getTokenRawText(tokenElement),\n        start: tokenStart,\n        end: tokenEnd,\n        metadata: {\n          isWhitespace:\n            tokenElement.getAttribute('data-is-whitespace') === 'true',\n          isNewline: tokenElement.getAttribute('data-is-newline') === 'true',\n          hasNewlines: tokenElement.getAttribute('data-has-newlines') === 'true'\n        }\n      };\n\n      richTextLogger.logInfo('Found token for position', {\n        textIndex,\n        tokenIndex: i,\n        charOffsetInToken,\n        tokenBounds: `${tokenStart}-${tokenEnd}`,\n        tokenContent: token.content,\n        isNewline: token.metadata?.isNewline,\n        isWhitespace: token.metadata?.isWhitespace\n      });\n\n      return {\n        tokenIndex: i,\n        charOffsetInToken,\n        token\n      };\n    }\n  }\n\n  // If no exact match found, find the closest token\n  let closestToken = null;\n  let closestDistance = Infinity;\n\n  for (let i = 0; i < tokenElements.length; i++) {\n    const tokenElement = tokenElements[i] as HTMLElement;\n    const tokenStart = parseInt(tokenElement.dataset.tokenStart || '0');\n    const tokenEnd = parseInt(tokenElement.dataset.tokenEnd || '0');\n\n    const distanceToStart = Math.abs(textIndex - tokenStart);\n    const distanceToEnd = Math.abs(textIndex - tokenEnd);\n    const distance = Math.min(distanceToStart, distanceToEnd);\n\n    if (distance < closestDistance) {\n      closestDistance = distance;\n\n      // Create token object from DOM data with metadata\n      const token: RichContentToken = {\n        type: tokenElement.dataset.tokenType as any,\n        content: tokenElement.dataset.tokenContent || '',\n        rawText: getTokenRawText(tokenElement),\n        start: tokenStart,\n        end: tokenEnd,\n        metadata: {\n          isWhitespace:\n            tokenElement.getAttribute('data-is-whitespace') === 'true',\n          isNewline: tokenElement.getAttribute('data-is-newline') === 'true',\n          hasNewlines: tokenElement.getAttribute('data-has-newlines') === 'true'\n        }\n      };\n\n      closestToken = {\n        tokenIndex: i,\n        charOffsetInToken: textIndex <= tokenStart ? 0 : tokenEnd - tokenStart,\n        token\n      };\n    }\n  }\n\n  if (closestToken) {\n    richTextLogger.logInfo('Using closest token for position', {\n      textIndex,\n      tokenIndex: closestToken.tokenIndex,\n      charOffsetInToken: closestToken.charOffsetInToken,\n      tokenBounds: `${closestToken.token.start}-${closestToken.token.end}`,\n      distance: closestDistance,\n      isNewline: closestToken.token.metadata?.isNewline,\n      isWhitespace: closestToken.token.metadata?.isWhitespace\n    });\n  }\n\n  return closestToken;\n}\n\n/**\n * Create token object from DOM element with proper metadata handling\n */\nexport function createTokenFromElement(\n  tokenElement: HTMLElement,\n  tokenIndex: number\n): RichContentToken {\n  const tokenStart = parseInt(tokenElement.dataset.tokenStart || '0');\n  const tokenEnd = parseInt(tokenElement.dataset.tokenEnd || '0');\n\n  return {\n    type: tokenElement.dataset.tokenType as any,\n    content: tokenElement.dataset.tokenContent || '',\n    rawText: getTokenRawText(tokenElement),\n    start: tokenStart,\n    end: tokenEnd,\n    metadata: {\n      isWhitespace: tokenElement.getAttribute('data-is-whitespace') === 'true',\n      isNewline: tokenElement.getAttribute('data-is-newline') === 'true',\n      hasNewlines: tokenElement.getAttribute('data-has-newlines') === 'true'\n    }\n  };\n}\n",
    "language":"typescript",
    "lines":166,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/selectionCalculations.ts":{
    "content":"/**\n * Selection calculation utilities for rich input components\n * Handles multi-token selections and selection rendering coordinates\n */\n\nimport { createLogger } from '@/lib/logging';\nimport type { RichInputSelection } from '../types';\nimport { getFirstTextNode } from './cursorCalculations';\nimport { findTokenAtPosition, type TokenPosition } from './tokenPositioning';\n\nconst logger = createLogger({\n  context: {\n    component: 'SelectionCalculations',\n    module: 'rich-input/utils'\n  }\n});\n\n/**\n * Calculate selection coordinates with token-aware multi-line support\n */\nexport function calculateEnhancedSelectionCoordinates(\n  selection: RichInputSelection,\n  rawText: string,\n  contentElement: HTMLElement | null\n): Array<{ x: number; y: number; width: number; height: number }> {\n  if (!contentElement || selection.start.index === selection.end.index) {\n    return [];\n  }\n\n  try {\n    const startIndex = Math.min(selection.start.index, selection.end.index);\n    const endIndex = Math.max(selection.start.index, selection.end.index);\n\n    // Find start and end token positions\n    const startTokenPos = findTokenAtPosition(startIndex, contentElement);\n    const endTokenPos = findTokenAtPosition(endIndex, contentElement);\n\n    if (!startTokenPos || !endTokenPos) return [];\n\n    // Create selection rectangles across tokens\n    const selectionRects: Array<{\n      x: number;\n      y: number;\n      width: number;\n      height: number;\n    }> = [];\n    const containerRect = contentElement.getBoundingClientRect();\n\n    // If selection is within a single token\n    if (startTokenPos.tokenIndex === endTokenPos.tokenIndex) {\n      const tokenElement = contentElement.querySelector(\n        `[data-token-index=\\\"${startTokenPos.tokenIndex}\\\"]`\n      ) as HTMLElement;\n      if (tokenElement) {\n        const rect = calculateSelectionWithinToken(\n          startTokenPos,\n          endTokenPos,\n          tokenElement\n        );\n        if (rect) {\n          selectionRects.push({\n            x: rect.left - containerRect.left,\n            y: rect.top - containerRect.top,\n            width: rect.width,\n            height: rect.height\n          });\n        }\n      }\n    } else {\n      // Selection spans multiple tokens\n      const tokenElements =\n        contentElement.querySelectorAll('[data-token-index]');\n\n      for (let i = startTokenPos.tokenIndex; i <= endTokenPos.tokenIndex; i++) {\n        const tokenElement = tokenElements[i] as HTMLElement;\n        if (!tokenElement) continue;\n\n        const tokenRect = tokenElement.getBoundingClientRect();\n\n        if (i === startTokenPos.tokenIndex) {\n          // First token - partial selection from start position\n          const rect = calculatePartialSelectionInToken(\n            startTokenPos,\n            tokenElement,\n            'start'\n          );\n          if (rect) {\n            selectionRects.push({\n              x: rect.left - containerRect.left,\n              y: rect.top - containerRect.top,\n              width: rect.width,\n              height: rect.height\n            });\n          }\n        } else if (i === endTokenPos.tokenIndex) {\n          // Last token - partial selection to end position\n          const rect = calculatePartialSelectionInToken(\n            endTokenPos,\n            tokenElement,\n            'end'\n          );\n          if (rect) {\n            selectionRects.push({\n              x: rect.left - containerRect.left,\n              y: rect.top - containerRect.top,\n              width: rect.width,\n              height: rect.height\n            });\n          }\n        } else {\n          // Middle tokens - full selection\n          selectionRects.push({\n            x: tokenRect.left - containerRect.left,\n            y: tokenRect.top - containerRect.top,\n            width: tokenRect.width,\n            height: tokenRect.height\n          });\n        }\n      }\n    }\n\n    return selectionRects;\n  } catch (error) {\n    logger.warn('Error calculating enhanced selection coordinates', { error });\n    return [];\n  }\n}\n\n/**\n * Calculate selection rectangle within a single token\n */\nexport function calculateSelectionWithinToken(\n  startPos: TokenPosition,\n  endPos: TokenPosition,\n  tokenElement: HTMLElement\n): DOMRect | null {\n  try {\n    const range = document.createRange();\n    const textNode = getFirstTextNode(tokenElement);\n\n    if (!textNode) return null;\n\n    const startOffset = Math.min(\n      startPos.charOffsetInToken,\n      textNode.textContent?.length || 0\n    );\n    const endOffset = Math.min(\n      endPos.charOffsetInToken,\n      textNode.textContent?.length || 0\n    );\n\n    range.setStart(textNode, startOffset);\n    range.setEnd(textNode, endOffset);\n\n    return range.getBoundingClientRect();\n  } catch (error) {\n    logger.warn('Error calculating selection within token', {\n      error,\n      tokenIndex: startPos.tokenIndex\n    });\n    return null;\n  }\n}\n\n/**\n * Calculate partial selection in a token (from start or to end)\n */\nexport function calculatePartialSelectionInToken(\n  tokenPos: TokenPosition,\n  tokenElement: HTMLElement,\n  type: 'start' | 'end'\n): DOMRect | null {\n  try {\n    const range = document.createRange();\n    const textNode = getFirstTextNode(tokenElement);\n\n    if (!textNode) return null;\n\n    const textLength = textNode.textContent?.length || 0;\n\n    if (type === 'start') {\n      // Select from character offset to end of token\n      range.setStart(\n        textNode,\n        Math.min(tokenPos.charOffsetInToken, textLength)\n      );\n      range.setEnd(textNode, textLength);\n    } else {\n      // Select from start of token to character offset\n      range.setStart(textNode, 0);\n      range.setEnd(textNode, Math.min(tokenPos.charOffsetInToken, textLength));\n    }\n\n    return range.getBoundingClientRect();\n  } catch (error) {\n    logger.warn('Error calculating partial selection in token', { error });\n    return null;\n  }\n}\n",
    "language":"typescript",
    "lines":200,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/enhancedCursorPositioning.ts":{
    "content":"/**\n * Enhanced cursor positioning system with token-aware character-level precision\n * Maps cursor positions to specific rendered tokens for accurate positioning\n */\n\nimport { createLogger } from '@/lib/logging';\nimport type { RichInputPosition } from '../types';\nimport {\n  calculateEnhancedClickPosition,\n  calculateTokenAwareClickPosition\n} from './clickPositioning';\nimport {\n  calculateCursorWithinToken,\n  calculateEndOfContentPosition,\n  calculateLineAwareCursorPosition,\n  fallbackCursorPosition\n} from './cursorCalculations';\nimport { RichTextLogger } from './logger';\nimport { getWordBoundaries, smartCursorSnap } from './navigationUtils';\nimport { calculateEnhancedSelectionCoordinates } from './selectionCalculations';\nimport { findTokenAtPosition } from './tokenPositioning';\n\nconst logger = createLogger({\n  context: {\n    component: 'EnhancedCursorPositioning',\n    module: 'rich-input/utils'\n  }\n});\n\n/**\n * Calculate cursor coordinates with line-aware token precision\n * This combines line-based structure with token-level accuracy\n */\nexport function calculateEnhancedCursorCoordinates(\n  position: RichInputPosition,\n  rawText: string,\n  contentElement: HTMLElement | null\n): { x: number; y: number } | null {\n  if (!contentElement || !rawText) return { x: 0, y: 0 };\n\n  try {\n    // Use the new line-aware cursor positioning system\n    const cursorCoordinates = calculateLineAwareCursorPosition(\n      position,\n      contentElement,\n      rawText\n    );\n\n    if (cursorCoordinates) {\n      return cursorCoordinates;\n    }\n\n    // Fallback to token-based system for backward compatibility\n    const tokenPosition = findTokenAtPosition(position.index, contentElement);\n\n    if (!tokenPosition) {\n      // Position is beyond all tokens - place cursor at end\n      return calculateEndOfContentPosition(contentElement);\n    }\n\n    // Calculate cursor position within the specific token\n    return calculateCursorWithinToken(tokenPosition, contentElement, rawText);\n  } catch (error) {\n    logger.warn('Error in enhanced cursor positioning', { error });\n    return fallbackCursorPosition(position, contentElement);\n  }\n}\n\nexport interface EnhancedCursorPosition {\n  x: number;\n  y: number;\n  height: number;\n  atomicContext?: {\n    isNearAtomic: boolean;\n    isOverAtomic: boolean;\n    isAtomicBoundary: boolean;\n    type: string;\n    proximity?: 'immediate' | 'close' | 'near';\n    distance?: number;\n  };\n}\n\n/**\n * Enhanced cursor positioning with atomic unit awareness\n */\nexport function calculateEnhancedCursorPosition(\n  contentElement: HTMLElement,\n  rawText: string,\n  cursorIndex: number,\n  logger?: RichTextLogger\n): EnhancedCursorPosition {\n  const position = { index: cursorIndex, line: 0, column: 0 };\n  const lineAwarePosition = calculateLineAwareCursorPosition(\n    position,\n    contentElement,\n    rawText\n  );\n\n  // Detect atomic context from DOM elements\n  const atomicContext = detectAtomicContextFromDOM(\n    contentElement,\n    cursorIndex,\n    logger\n  );\n\n  // Log atomic context if available\n  if (logger && atomicContext.isNearAtomic && lineAwarePosition) {\n    logger.logCursor({\n      position: cursorIndex,\n      coordinates: { x: lineAwarePosition.x, y: lineAwarePosition.y },\n      character: {\n        char: rawText[cursorIndex] || '',\n        isWhitespace: /\\\\s/.test(rawText[cursorIndex] || ''),\n        isNewline: rawText[cursorIndex] === '\\\\n'\n      },\n      nearbyPills: atomicContext.type\n        ? [\n            {\n              type: atomicContext.type,\n              text: atomicContext.type,\n              distance: 0\n            }\n          ]\n        : []\n    });\n  }\n\n  return {\n    x: lineAwarePosition?.x || 0,\n    y: lineAwarePosition?.y || 0,\n    height: 20, // Default height\n    atomicContext\n  };\n}\n\n/**\n * Detects atomic context (pills, images) from DOM elements\n */\nfunction detectAtomicContextFromDOM(\n  contentElement: HTMLElement,\n  cursorIndex: number,\n  logger?: RichTextLogger\n): {\n  isNearAtomic: boolean;\n  isOverAtomic: boolean;\n  isAtomicBoundary: boolean;\n  type: string;\n  proximity?: 'immediate' | 'close' | 'near';\n  distance?: number;\n} {\n  const proximityRange = 3;\n\n  // Find all atomic elements (pills, images, etc.)\n  const atomicElements = contentElement.querySelectorAll(\n    '.content-pill, .rich-input-image, .emoji--custom, .rich-input-newline'\n  );\n\n  let isNearAtomic = false;\n  let isOverAtomic = false;\n  let isAtomicBoundary = false;\n  let type = 'text';\n  let proximity: 'immediate' | 'close' | 'near' | undefined;\n  let minDistance = Infinity;\n\n  for (const element of atomicElements) {\n    const tokenStart = parseInt(\n      element.getAttribute('data-token-start') || '0'\n    );\n    const tokenEnd = parseInt(element.getAttribute('data-token-end') || '0');\n    const tokenType = element.getAttribute('data-token-type') || 'unknown';\n\n    // Calculate distance to this atomic element\n    const distanceToStart = Math.abs(cursorIndex - tokenStart);\n    const distanceToEnd = Math.abs(cursorIndex - tokenEnd);\n    const distance = Math.min(distanceToStart, distanceToEnd);\n\n    // Check if cursor is over the atomic element\n    if (cursorIndex >= tokenStart && cursorIndex <= tokenEnd) {\n      isOverAtomic = true;\n      type = tokenType;\n      proximity = 'immediate';\n      minDistance = 0;\n\n      // Check if at exact boundary\n      if (cursorIndex === tokenStart || cursorIndex === tokenEnd) {\n        isAtomicBoundary = true;\n      }\n    }\n\n    // Check if cursor is near the atomic element\n    if (distance <= proximityRange) {\n      isNearAtomic = true;\n      if (type === 'text') {\n        type = tokenType;\n      }\n\n      // Determine proximity level\n      if (distance === 0) {\n        proximity = 'immediate';\n      } else if (distance === 1) {\n        proximity = 'close';\n      } else {\n        proximity = 'near';\n      }\n\n      minDistance = Math.min(minDistance, distance);\n    }\n  }\n\n  if (logger && (isNearAtomic || isOverAtomic)) {\n    logger.logInfo('Atomic context detected', {\n      cursorIndex,\n      isNearAtomic,\n      isOverAtomic,\n      isAtomicBoundary,\n      type,\n      proximity,\n      distance: minDistance,\n      atomicElementsCount: atomicElements.length\n    });\n  }\n\n  return {\n    isNearAtomic,\n    isOverAtomic,\n    isAtomicBoundary,\n    type,\n    proximity,\n    distance: minDistance === Infinity ? undefined : minDistance\n  };\n}\n\n// Re-export all the utility functions from the modular files\nexport {\n  // Cursor calculations\n  calculateCursorWithinToken,\n  calculateEndOfContentPosition,\n  // Click positioning\n  calculateEnhancedClickPosition,\n  // Selection calculations\n  calculateEnhancedSelectionCoordinates,\n  calculateLineAwareCursorPosition,\n  calculateTokenAwareClickPosition,\n  fallbackCursorPosition,\n  // Token positioning\n  findTokenAtPosition,\n  getWordBoundaries,\n  // Navigation utilities\n  smartCursorSnap\n};\n\n// Re-export types\nexport type { TokenPosition } from './tokenPositioning';\n",
    "language":"typescript",
    "lines":254,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/enhancedTokenization.ts":{
    "content":"/**\n * Enhanced Tokenization Integration for RichInput\n * Bridges the enhanced ContentParser with the RichInput system\n */\n\nimport { ContentParser, TokenizedContent } from '../../utils/content-parsers';\nimport type { RichContentToken, RichContentTokenType } from '../types';\n\n/**\n * Convert TokenizedContent to RichContentTokens for RichInput compatibility\n */\nexport function tokenizedContentToRichTokens(\n  tokenizedContent: TokenizedContent\n): RichContentToken[] {\n  const tokens: RichContentToken[] = [];\n\n  // Convert segments to rich tokens\n  tokenizedContent.segments.forEach((segment, index) => {\n    const token: RichContentToken = {\n      type: segment.type as RichContentTokenType, // Cast to the expected type\n      content: segment.value,\n      rawText: segment.rawFormat || segment.value,\n      start: segment.start || 0,\n      end: segment.end || 0,\n      metadata: {\n        ...(segment.type === 'hashtag' && { hashtag: segment.value }),\n        ...(segment.type === 'mention' && {\n          username: segment.value,\n          userId: segment.userId,\n          displayName: segment.displayName,\n          filterType: segment.filterType\n        }),\n        ...(segment.type === 'url' && {\n          href: segment.value,\n          behavior: segment.behavior as 'link' | 'embed' | 'modal',\n          originalFormat: segment.rawFormat\n        })\n      }\n    };\n\n    tokens.push(token);\n  });\n\n  return tokens;\n}\n\n/**\n * Enhanced cursor positioning using tokenized content\n */\nexport function getEnhancedCursorPosition(\n  tokenizedContent: TokenizedContent,\n  clickX: number,\n  clickY: number,\n  containerElement: HTMLElement\n): number {\n  // Use character-level tokenization for precise positioning\n  const characters = tokenizedContent.characters;\n\n  // Find the closest character to the click position\n  let closestIndex = 0;\n  let minDistance = Infinity;\n\n  characters.forEach((char, index) => {\n    // Create a temporary range to measure character position\n    const range = document.createRange();\n    const textNode = findTextNodeAtIndex(containerElement, char.index);\n\n    if (textNode) {\n      range.setStart(textNode, char.index - getTextNodeStartIndex(textNode));\n      range.setEnd(textNode, char.index - getTextNodeStartIndex(textNode) + 1);\n\n      const rect = range.getBoundingClientRect();\n      const distance = Math.sqrt(\n        Math.pow(clickX - rect.left, 2) + Math.pow(clickY - rect.top, 2)\n      );\n\n      if (distance < minDistance) {\n        minDistance = distance;\n        closestIndex = index;\n      }\n    }\n  });\n\n  return closestIndex;\n}\n\n/**\n * Smart word navigation using enhanced tokenization\n */\nexport function getNextWordPosition(\n  tokenizedContent: TokenizedContent,\n  currentPosition: number,\n  direction: 'forward' | 'backward' = 'forward'\n): number {\n  if (direction === 'forward') {\n    return ContentParser.getNextWordPosition(tokenizedContent, currentPosition);\n  } else {\n    return ContentParser.getPreviousWordPosition(\n      tokenizedContent,\n      currentPosition\n    );\n  }\n}\n\n/**\n * Smart selection using pill boundaries\n */\nexport function getSmartSelection(\n  tokenizedContent: TokenizedContent,\n  startPosition: number,\n  endPosition: number\n): { start: number; end: number; type: 'character' | 'word' | 'pill' } {\n  // Check if selection spans across pills\n  const selectionInfo = ContentParser.getSelectionInfo(\n    tokenizedContent,\n    startPosition,\n    endPosition\n  );\n\n  if (selectionInfo.selectedPills.length > 0) {\n    // If we have complete pills, expand to include all pills\n    const firstPill = selectionInfo.selectedPills[0];\n    const lastPill =\n      selectionInfo.selectedPills[selectionInfo.selectedPills.length - 1];\n\n    return {\n      start: firstPill.start,\n      end: lastPill.end,\n      type: 'pill'\n    };\n  }\n\n  // Check if it's a word selection\n  if (\n    selectionInfo.selectedWords.length === 1 &&\n    !selectionInfo.selectedWords[0].isWhitespace\n  ) {\n    const word = selectionInfo.selectedWords[0];\n    return {\n      start: word.start,\n      end: word.end,\n      type: 'word'\n    };\n  }\n\n  // Default to character selection\n  return {\n    start: startPosition,\n    end: endPosition,\n    type: 'character'\n  };\n}\n\n/**\n * Get context information at cursor position\n */\nexport function getCursorContext(\n  tokenizedContent: TokenizedContent,\n  position: number\n): {\n  character: (typeof tokenizedContent.characters)[0] | null;\n  word: (typeof tokenizedContent.words)[0] | null;\n  pill: (typeof tokenizedContent.pills)[0] | null;\n  lineInfo: ReturnType<typeof ContentParser.getLineInfo>;\n  isAtWordBoundary: boolean;\n  isAtPillBoundary: boolean;\n} {\n  const character =\n    ContentParser.getCharacterAt(tokenizedContent, position) || null;\n  const word = ContentParser.getWordAt(tokenizedContent, position) || null;\n  const pill = ContentParser.getPillAt(tokenizedContent, position) || null;\n  const lineInfo = ContentParser.getLineInfo(tokenizedContent, position);\n\n  // Check boundaries\n  const isAtWordBoundary = word\n    ? position === word.start || position === word.end\n    : false;\n  const isAtPillBoundary = pill\n    ? position === pill.start || position === pill.end\n    : false;\n\n  return {\n    character,\n    word,\n    pill,\n    lineInfo,\n    isAtWordBoundary,\n    isAtPillBoundary\n  };\n}\n\n/**\n * Enhanced text insertion that respects pill boundaries\n */\nexport function insertTextSmart(\n  originalText: string,\n  position: number,\n  textToInsert: string\n): { newText: string; newCursorPosition: number } {\n  const tokenizedContent = ContentParser.tokenize(originalText);\n  const context = getCursorContext(tokenizedContent, position);\n\n  // If inserting inside a pill, we might want to replace the entire pill\n  if (\n    context.pill &&\n    position > context.pill.start &&\n    position < context.pill.end\n  ) {\n    // For now, just insert normally, but this could be enhanced\n    // to provide smart pill editing behavior\n  }\n\n  const result = ContentParser.insertText(originalText, position, textToInsert);\n\n  return {\n    newText: result.newText,\n    newCursorPosition: position + textToInsert.length\n  };\n}\n\n/**\n * Helper functions for DOM traversal\n */\nfunction findTextNodeAtIndex(\n  container: HTMLElement,\n  index: number\n): Text | null {\n  const walker = document.createTreeWalker(\n    container,\n    NodeFilter.SHOW_TEXT,\n    null\n  );\n\n  let currentIndex = 0;\n  let node = walker.nextNode() as Text;\n\n  while (node) {\n    const nodeLength = node.textContent?.length || 0;\n    if (index >= currentIndex && index < currentIndex + nodeLength) {\n      return node;\n    }\n    currentIndex += nodeLength;\n    node = walker.nextNode() as Text;\n  }\n\n  return null;\n}\n\nfunction getTextNodeStartIndex(textNode: Text): number {\n  let index = 0;\n  let current = textNode.parentNode?.firstChild;\n\n  while (current && current !== textNode) {\n    if (current.nodeType === Node.TEXT_NODE) {\n      index += current.textContent?.length || 0;\n    }\n    current = current.nextSibling;\n  }\n\n  return index;\n}\n\n/**\n * Export enhanced tokenization for use in RichInput components\n */\nexport { ContentParser, type TokenizedContent };\n",
    "language":"typescript",
    "lines":267,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/coordinateCalculations.ts":{
    "content":"import { createLogger } from '@/lib/logging';\nimport type {\n  RichContentToken,\n  RichInputPosition,\n  RichInputSelection\n} from '../types';\n\nconst logger = createLogger({\n  context: {\n    component: 'CoordinateCalculations',\n    module: 'rich-input/utils'\n  }\n});\n\n// Helper functions for coordinate calculations\nexport function calculateCursorCoordinates(\n  position: RichInputPosition,\n  tokens: RichContentToken[],\n  contentElement: HTMLElement | null,\n  measureElement: HTMLElement | null\n): { x: number; y: number } | null {\n  if (!contentElement) return null;\n\n  try {\n    // Use the new rendered-content-based measurement system\n    return calculateCursorFromRenderedContent(position, contentElement);\n  } catch (error) {\n    logger.warn('Error calculating cursor coordinates', { error });\n    return null;\n  }\n}\n\n// New function that measures actual rendered content for accurate cursor positioning\nexport function calculateCursorFromRenderedContent(\n  position: RichInputPosition,\n  contentElement: HTMLElement\n): { x: number; y: number } | null {\n  try {\n    // Create a range to find the exact position in the rendered DOM\n    const range = document.createRange();\n    const walker = document.createTreeWalker(\n      contentElement,\n      NodeFilter.SHOW_TEXT\n    );\n\n    let currentTextIndex = 0;\n    let targetNode: Text | null = null;\n    let targetOffset = 0;\n\n    // Walk through all text nodes to find where our position falls\n    let node: Text | null = walker.nextNode() as Text;\n    while (node) {\n      const nodeText = node.textContent || '';\n      const nodeLength = nodeText.length;\n\n      if (currentTextIndex + nodeLength >= position.index) {\n        // Our target position is within this text node\n        targetNode = node;\n        targetOffset = position.index - currentTextIndex;\n        break;\n      }\n\n      currentTextIndex += nodeLength;\n      node = walker.nextNode() as Text;\n    }\n\n    if (!targetNode) {\n      // Position is beyond all text content - place cursor at the end\n      const lastChild = contentElement.lastChild;\n      if (lastChild) {\n        if (lastChild.nodeType === Node.TEXT_NODE) {\n          targetNode = lastChild as Text;\n          targetOffset = (lastChild.textContent || '').length;\n        } else {\n          // Last child is an element (like a pill) - place cursor after it\n          range.setStartAfter(lastChild);\n          range.collapse(true);\n          const rect = range.getBoundingClientRect();\n          const containerRect = contentElement.getBoundingClientRect();\n\n          return {\n            x: rect.left - containerRect.left,\n            y: rect.top - containerRect.top\n          };\n        }\n      } else {\n        // No content at all\n        return { x: 0, y: 0 };\n      }\n    }\n\n    if (targetNode) {\n      // Set range to the exact position within the text node\n      range.setStart(\n        targetNode,\n        Math.min(targetOffset, targetNode.textContent?.length || 0)\n      );\n      range.collapse(true);\n\n      // Get the visual position of this range\n      const rect = range.getBoundingClientRect();\n      const containerRect = contentElement.getBoundingClientRect();\n\n      return {\n        x: rect.left - containerRect.left,\n        y: rect.top - containerRect.top\n      };\n    }\n\n    return { x: 0, y: 0 };\n  } catch (error) {\n    logger.warn('Error in rendered content cursor calculation', { error });\n    return null;\n  }\n}\n\nexport function calculateSelectionCoordinates(\n  selection: RichInputSelection,\n  tokens: RichContentToken[],\n  contentElement: HTMLElement | null,\n  measureElement: HTMLElement | null\n): Array<{ x: number; y: number; width: number; height: number }> {\n  if (\n    !contentElement ||\n    !measureElement ||\n    selection.start.index === selection.end.index\n  )\n    return [];\n\n  try {\n    const range = document.createRange();\n    const startPos = Math.min(selection.start.index, selection.end.index);\n    const endPos = Math.max(selection.start.index, selection.end.index);\n\n    // Find start and end positions\n    const startResult = findTextNodeAndOffset(contentElement, startPos);\n    const endResult = findTextNodeAndOffset(contentElement, endPos);\n\n    if (!startResult || !endResult) return [];\n\n    // Set range for selection\n    range.setStart(startResult.node, startResult.offset);\n    range.setEnd(endResult.node, endResult.offset);\n\n    // Get selection rectangles (handles multi-line selections)\n    const rects = range.getClientRects();\n    const containerRect = contentElement.getBoundingClientRect();\n\n    const selectionRects = Array.from(rects).map((rect) => ({\n      x: rect.left - containerRect.left,\n      y: rect.top - containerRect.top,\n      width: rect.width,\n      height: rect.height\n    }));\n\n    range.detach();\n\n    return selectionRects;\n  } catch (error) {\n    logger.warn('Error calculating selection coordinates', { error });\n    return [];\n  }\n}\n\nexport function calculateClickPosition(\n  e: React.MouseEvent,\n  tokens: RichContentToken[],\n  contentElement: HTMLElement | null,\n  measureElement: HTMLElement | null\n): RichInputPosition | null {\n  if (!contentElement) return null;\n\n  // Use the new rendered-content-based click positioning\n  return calculateClickPositionFromRenderedContent(e, contentElement, tokens);\n}\n\n// New function that calculates click position based on actual rendered content\nexport function calculateClickPositionFromRenderedContent(\n  e: React.MouseEvent,\n  contentElement: HTMLElement,\n  tokens: RichContentToken[]\n): RichInputPosition | null {\n  try {\n    const rect = contentElement.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    // First, check if we clicked directly on a pill element\n    const clickedElement = e.target as HTMLElement;\n    const tokenElement = clickedElement.closest('[data-token-start]');\n\n    if (tokenElement) {\n      // Click is on a pill - determine whether to position cursor at start or end\n      const tokenStart = parseInt(\n        tokenElement.getAttribute('data-token-start') || '0'\n      );\n      const tokenEnd = parseInt(\n        tokenElement.getAttribute('data-token-end') || '0'\n      );\n\n      // Find the corresponding token\n      const token = tokens.find(\n        (t) => t.start === tokenStart && t.end === tokenEnd\n      );\n      if (\n        token &&\n        (token.type === 'hashtag' ||\n          token.type === 'mention' ||\n          token.type === 'url')\n      ) {\n        // For pills, determine position based on click location within the pill\n        const tokenRect = tokenElement.getBoundingClientRect();\n        const clickRelativeX = x - (tokenRect.left - rect.left);\n        const tokenCenter = tokenRect.width / 2;\n\n        // Position cursor at start or end of the entire token (including all raw text)\n        const index = clickRelativeX < tokenCenter ? token.start : token.end;\n\n        return createPositionFromIndex(index, contentElement.textContent || '');\n      }\n    }\n\n    // For clicks not on pills, use caretPositionFromPoint or caretRangeFromPoint\n    let targetNode: Node | null = null;\n    let targetOffset = 0;\n\n    if ((document as any).caretPositionFromPoint) {\n      // Firefox\n      const caretPos = (document as any).caretPositionFromPoint(\n        e.clientX,\n        e.clientY\n      );\n      if (caretPos) {\n        targetNode = caretPos.offsetNode;\n        targetOffset = caretPos.offset;\n      }\n    } else if ((document as any).caretRangeFromPoint) {\n      // Chrome/Safari\n      const range = (document as any).caretRangeFromPoint(e.clientX, e.clientY);\n      if (range) {\n        targetNode = range.startContainer;\n        targetOffset = range.startOffset;\n      }\n    }\n\n    if (targetNode) {\n      // Convert DOM position to text index\n      const textIndex = getTextIndexFromDOMPosition(\n        contentElement,\n        targetNode,\n        targetOffset\n      );\n      if (textIndex !== null) {\n        return createPositionFromIndex(\n          textIndex,\n          contentElement.textContent || ''\n        );\n      }\n    }\n\n    // Fallback: position at end of content\n    const allText = contentElement.textContent || '';\n    return createPositionFromIndex(allText.length, allText);\n  } catch (error) {\n    logger.warn('Error in rendered content click calculation', { error });\n    return null;\n  }\n}\n\n// Helper function to create a RichInputPosition from a text index\nexport function createPositionFromIndex(\n  index: number,\n  allText: string\n): RichInputPosition {\n  const textBeforeIndex = allText.substring(0, index);\n  const lines = textBeforeIndex.split('\\\\n');\n  const line = lines.length - 1;\n  const column = lines[line]?.length || 0;\n\n  return {\n    index,\n    line,\n    column\n  };\n}\n\n// Helper function to snap text index to pill boundaries\nexport function snapToPillBoundary(\n  textIndex: number,\n  tokens: RichContentToken[]\n): number {\n  // Find if the text index is inside a pill token\n  const pillToken = tokens.find(\n    (token) =>\n      token.type !== 'text' && textIndex > token.start && textIndex < token.end\n  );\n\n  if (pillToken) {\n    // Text index is inside a pill - snap to closest boundary\n    const distanceToStart = textIndex - pillToken.start;\n    const distanceToEnd = pillToken.end - textIndex;\n\n    // Snap to the closest boundary\n    return distanceToStart <= distanceToEnd ? pillToken.start : pillToken.end;\n  }\n\n  // Text index is not inside a pill, return as-is\n  return textIndex;\n}\n\n// Helper function to find text node and offset for a given text index (pill-aware)\nexport function findTextNodeAndOffset(\n  element: HTMLElement,\n  textIndex: number\n): { node: Node; offset: number } | null {\n  const walker = document.createTreeWalker(element, NodeFilter.SHOW_ALL, null);\n\n  let currentRawIndex = 0;\n  let node = walker.nextNode();\n\n  while (node) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      const textContent = node.textContent || '';\n      const parent = node.parentElement;\n\n      // Check if this text node is inside a pill\n      if (\n        parent &&\n        parent.hasAttribute('data-token-start') &&\n        parent.hasAttribute('data-token-end')\n      ) {\n        // This is a pill - get its raw text length from the token data\n        const tokenStart = parseInt(\n          parent.getAttribute('data-token-start') || '0'\n        );\n        const tokenEnd = parseInt(parent.getAttribute('data-token-end') || '0');\n        const rawLength = tokenEnd - tokenStart;\n\n        // Check if our target index falls within this pill's raw range\n        if (\n          textIndex >= currentRawIndex &&\n          textIndex <= currentRawIndex + rawLength\n        ) {\n          // The target is within this pill\n          // For pills, we position at the start or end of the visual text\n          const distanceFromStart = textIndex - currentRawIndex;\n          const distanceFromEnd = currentRawIndex + rawLength - textIndex;\n\n          if (distanceFromStart <= distanceFromEnd) {\n            // Closer to start - position at beginning of visual text\n            return {\n              node,\n              offset: 0\n            };\n          } else {\n            // Closer to end - position at end of visual text\n            return {\n              node,\n              offset: textContent.length\n            };\n          }\n        }\n\n        // Move past this pill's raw text\n        currentRawIndex += rawLength;\n      } else {\n        // Regular text node - use normal character mapping\n        if (\n          textIndex >= currentRawIndex &&\n          textIndex <= currentRawIndex + textContent.length\n        ) {\n          // Target is within this text node\n          return {\n            node,\n            offset: textIndex - currentRawIndex\n          };\n        }\n\n        currentRawIndex += textContent.length;\n      }\n    }\n\n    node = walker.nextNode();\n  }\n\n  // If we didn't find the exact position, try to find the last text node\n  const lastWalker = document.createTreeWalker(\n    element,\n    NodeFilter.SHOW_TEXT,\n    null\n  );\n  let lastNode = null;\n  let current = lastWalker.nextNode();\n  while (current) {\n    lastNode = current;\n    current = lastWalker.nextNode();\n  }\n\n  if (lastNode) {\n    return {\n      node: lastNode,\n      offset: (lastNode as Text).textContent?.length || 0\n    };\n  }\n\n  return null;\n}\n\n// Helper function to convert DOM position to text index (pill-aware)\nexport function getTextIndexFromDOMPosition(\n  container: HTMLElement,\n  node: Node,\n  offset: number\n): number | null {\n  const walker = document.createTreeWalker(\n    container,\n    NodeFilter.SHOW_ALL,\n    null\n  );\n\n  let currentRawIndex = 0;\n  let currentNode = walker.nextNode();\n\n  while (currentNode) {\n    if (currentNode.nodeType === Node.TEXT_NODE) {\n      const textContent = currentNode.textContent || '';\n      const parent = currentNode.parentElement;\n\n      // Check if we found our target node\n      if (currentNode === node) {\n        // Check if this text node is inside a pill\n        if (\n          parent &&\n          parent.hasAttribute('data-token-start') &&\n          parent.hasAttribute('data-token-end')\n        ) {\n          // This is a pill - map visual offset to raw position\n          const tokenStart = parseInt(\n            parent.getAttribute('data-token-start') || '0'\n          );\n          const tokenEnd = parseInt(\n            parent.getAttribute('data-token-end') || '0'\n          );\n          const rawLength = tokenEnd - tokenStart;\n\n          // For pills, if offset is closer to start, return start of raw text\n          // If closer to end, return end of raw text\n          const visualLength = textContent.length;\n          if (offset <= visualLength / 2) {\n            return currentRawIndex; // Start of pill\n          } else {\n            return currentRawIndex + rawLength; // End of pill\n          }\n        } else {\n          // Regular text node - direct mapping\n          return currentRawIndex + offset;\n        }\n      }\n\n      // Move past this node in raw text space\n      if (\n        parent &&\n        parent.hasAttribute('data-token-start') &&\n        parent.hasAttribute('data-token-end')\n      ) {\n        // This is a pill - use its raw length\n        const tokenStart = parseInt(\n          parent.getAttribute('data-token-start') || '0'\n        );\n        const tokenEnd = parseInt(parent.getAttribute('data-token-end') || '0');\n        const rawLength = tokenEnd - tokenStart;\n        currentRawIndex += rawLength;\n      } else {\n        // Regular text - use visual length\n        currentRawIndex += textContent.length;\n      }\n    }\n\n    currentNode = walker.nextNode();\n  }\n\n  return null;\n}\n",
    "language":"typescript",
    "lines":484,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/logger.ts":{
    "content":"/* eslint-disable no-console */\n/**\n * Rich Text Editor Debug Logger\n * Provides structured logging for debugging rich text editor interactions\n */\n\nexport interface ClickDebugInfo {\n  // Click position info\n  clickX: number;\n  clickY: number;\n  textIndex: number;\n\n  // Word info (if clicked in a word)\n  word?: {\n    text: string;\n    start: number;\n    end: number;\n    cursorPositionInWord: number;\n    isWhitespace: boolean;\n  };\n\n  // Line info (for multiline support)\n  line?: {\n    lineNumber: number;\n    lineStart: number;\n    lineEnd: number;\n    columnIndex: number;\n    lineText: string;\n  };\n\n  // Pill info (if clicked on a pill)\n  pill?: {\n    type: 'hashtag' | 'mention' | 'url';\n    variant?: string;\n    rawText: string;\n    displayText: string;\n    start: number;\n    end: number;\n    data: any;\n  };\n\n  // Character info\n  character?: {\n    char: string;\n    isWhitespace: boolean;\n    isNewline: boolean;\n    isPunctuation: boolean;\n  };\n\n  // Full text context\n  fullText: string;\n  textLength: number;\n}\n\nexport interface CursorDebugInfo {\n  position: number;\n  coordinates: { x: number; y: number };\n  character?: {\n    char: string;\n    isWhitespace: boolean;\n    isNewline: boolean;\n  };\n  nearbyPills: Array<{\n    type: string;\n    text: string;\n    distance: number;\n  }>;\n}\n\nexport interface SelectionDebugInfo {\n  start: number;\n  end: number;\n  selectedText: string;\n  selectedLength: number;\n  hasCompletePills: boolean;\n  affectedPills: Array<{\n    type: string;\n    text: string;\n    fullySelected: boolean;\n  }>;\n}\n\nexport class RichTextLogger {\n  private static instance: RichTextLogger | null = null;\n  private isEnabled: boolean = false;\n  private contextId: string = '';\n  private plaintextMode: boolean = false;\n\n  private constructor() {\n    // Check if debug mode is enabled\n    this.isEnabled =\n      typeof window !== 'undefined' &&\n      (window.localStorage?.getItem('richtext-debug') === 'true' ||\n        window.location?.search.includes('debug=richtext') ||\n        process.env.NODE_ENV === 'development');\n\n    // Check if plaintext mode is enabled\n    this.plaintextMode =\n      typeof window !== 'undefined' &&\n      (window.localStorage?.getItem('richtext-debug-plaintext') === 'true' ||\n        window.location?.search.includes('debug=plaintext'));\n  }\n\n  static getInstance(): RichTextLogger {\n    if (!RichTextLogger.instance) {\n      RichTextLogger.instance = new RichTextLogger();\n    }\n    return RichTextLogger.instance;\n  }\n\n  setContext(contextId: string): void {\n    this.contextId = contextId;\n  }\n\n  enable(): void {\n    this.isEnabled = true;\n    if (typeof window !== 'undefined') {\n      window.localStorage?.setItem('richtext-debug', 'true');\n    }\n  }\n\n  disable(): void {\n    this.isEnabled = false;\n    if (typeof window !== 'undefined') {\n      window.localStorage?.removeItem('richtext-debug');\n    }\n  }\n\n  enablePlaintextMode(): void {\n    this.plaintextMode = true;\n    if (typeof window !== 'undefined') {\n      window.localStorage?.setItem('richtext-debug-plaintext', 'true');\n    }\n  }\n\n  disablePlaintextMode(): void {\n    this.plaintextMode = false;\n    if (typeof window !== 'undefined') {\n      window.localStorage?.removeItem('richtext-debug-plaintext');\n    }\n  }\n\n  isPlaintextMode(): boolean {\n    return this.plaintextMode;\n  }\n\n  private getContextPrefix(): string {\n    return this.contextId ? `[${this.contextId}] ` : '';\n  }\n\n  /**\n   * Convert object to plaintext format for easy copy-paste debugging\n   */\n  private toPlaintext(obj: any, indent: number = 0): string {\n    const spaces = '  '.repeat(indent);\n\n    if (obj === null) return 'null';\n    if (obj === undefined) return 'undefined';\n    if (typeof obj === 'string') return `\\\"${obj}\\\"`;\n    if (typeof obj === 'number' || typeof obj === 'boolean') return String(obj);\n\n    if (Array.isArray(obj)) {\n      if (obj.length === 0) return '[]';\n      const items = obj\n        .map((item) => `${spaces}  ${this.toPlaintext(item, indent + 1)}`)\n        .join(',\\\\n');\n      return `[\\\\n${items}\\\\n${spaces}]`;\n    }\n\n    if (typeof obj === 'object') {\n      const keys = Object.keys(obj);\n      if (keys.length === 0) return '{}';\n      const items = keys\n        .map((key) => {\n          const value = this.toPlaintext(obj[key], indent + 1);\n          return `${spaces}  ${key}: ${value}`;\n        })\n        .join(',\\\\n');\n      return `{\\\\n${items}\\\\n${spaces}}`;\n    }\n\n    return String(obj);\n  }\n\n  /**\n   * Log in plaintext format if enabled, otherwise use regular formatting\n   */\n  private logPlaintext(title: string, data: any): void {\n    if (this.plaintextMode) {\n      console.log(`\\\\n=== ${this.getContextPrefix()}${title} ===`);\n      console.log(this.toPlaintext(data));\n      console.log(\n        '='.repeat(title.length + this.getContextPrefix().length + 8)\n      );\n    }\n  }\n\n  /**\n   * Log detailed click information\n   */\n  logClick(info: ClickDebugInfo): void {\n    if (!this.isEnabled) return;\n\n    // If plaintext mode is enabled, output copy-pasteable format\n    if (this.plaintextMode) {\n      this.logPlaintext('Rich Text Click Debug', {\n        clickPosition: {\n          coordinates: `(${info.clickX}, ${info.clickY})`,\n          textIndex: info.textIndex,\n          textLength: info.textLength\n        },\n        character: info.character\n          ? {\n              char:\n                info.character.char === ' '\n                  ? '\u00b7'\n                  : info.character.char === '\\\\n'\n                    ? '\\\\\\\\n'\n                    : info.character.char,\n              isWhitespace: info.character.isWhitespace,\n              isNewline: info.character.isNewline,\n              isPunctuation: info.character.isPunctuation\n            }\n          : null,\n        word: info.word\n          ? {\n              text: info.word.text,\n              bounds: `${info.word.start}-${info.word.end}`,\n              cursorPositionInWord: info.word.cursorPositionInWord,\n              isWhitespace: info.word.isWhitespace\n            }\n          : null,\n        line: info.line\n          ? {\n              lineNumber: info.line.lineNumber,\n              bounds: `${info.line.lineStart}-${info.line.lineEnd}`,\n              columnIndex: info.line.columnIndex,\n              lineText: info.line.lineText\n            }\n          : null,\n        pill: info.pill\n          ? {\n              type: info.pill.type,\n              variant: info.pill.variant || 'default',\n              rawText: info.pill.rawText,\n              displayText: info.pill.displayText,\n              bounds: `${info.pill.start}-${info.pill.end}`,\n              clickInsidePill:\n                info.textIndex >= info.pill.start &&\n                info.textIndex < info.pill.end,\n              data: info.pill.data\n            }\n          : null,\n        fullText: info.fullText\n      });\n      return;\n    }\n\n    // Original console formatting\n    console.groupCollapsed(\n      `\ud83d\uddb1\ufe0f ${this.getContextPrefix()}Rich Text Click Debug`\n    );\n\n    // Basic click info\n    console.info('\ud83d\udccd Click Position:', {\n      coordinates: `(${info.clickX}, ${info.clickY})`,\n      textIndex: info.textIndex,\n      textLength: info.textLength\n    });\n\n    // Character info\n    if (info.character) {\n      console.info('\ud83d\udd24 Character Info:', {\n        character:\n          info.character.char === ' '\n            ? '\u00b7'\n            : info.character.char === '\\\\n'\n              ? '\\\\\\\\n'\n              : info.character.char,\n        isWhitespace: info.character.isWhitespace,\n        isNewline: info.character.isNewline,\n        isPunctuation: info.character.isPunctuation\n      });\n    }\n\n    // Word info\n    if (info.word) {\n      console.info('\ud83d\udcdd Word Info:', {\n        word: `\\\"${info.word.text}\\\"`,\n        wordBounds: `${info.word.start}-${info.word.end}`,\n        cursorPositionInWord: info.word.cursorPositionInWord,\n        isWhitespace: info.word.isWhitespace\n      });\n    }\n\n    // Line info (for multiline)\n    if (info.line) {\n      console.info('\ud83d\udccf Line Info:', {\n        lineNumber: info.line.lineNumber,\n        lineBounds: `${info.line.lineStart}-${info.line.lineEnd}`,\n        columnIndex: info.line.columnIndex,\n        lineText: `\\\"${info.line.lineText}\\\"`\n      });\n    }\n\n    // Pill info (most important for debugging)\n    if (info.pill) {\n      console.warn('\ud83d\udc8a Pill Click Detected:', {\n        type: info.pill.type,\n        variant: info.pill.variant || 'default',\n        rawText: `\\\"${info.pill.rawText}\\\"`,\n        displayText: `\\\"${info.pill.displayText}\\\"`,\n        pillBounds: `${info.pill.start}-${info.pill.end}`,\n        pillData: info.pill.data\n      });\n\n      // Create a detailed table for pill analysis\n      console.table([\n        {\n          'Pill Type': info.pill.type,\n          'Raw Format': info.pill.rawText,\n          'Display Format': info.pill.displayText,\n          'Start Position': info.pill.start,\n          'End Position': info.pill.end,\n          'Click Position': info.textIndex,\n          'Click Inside Pill':\n            info.textIndex >= info.pill.start && info.textIndex < info.pill.end\n              ? '\u2705'\n              : '\u274c'\n        }\n      ]);\n    }\n\n    // Text context (show surrounding characters)\n    this.logTextContext(info.fullText, info.textIndex);\n\n    // Always properly close the group\n    console.groupEnd();\n  }\n\n  /**\n   * Log cursor positioning information\n   */\n  logCursor(info: CursorDebugInfo): void {\n    if (!this.isEnabled) return;\n\n    console.groupCollapsed(\n      `\ud83d\udccd ${this.getContextPrefix()}Cursor Position Debug`\n    );\n\n    console.info('Cursor Details:', {\n      position: info.position,\n      coordinates: `(${info.coordinates.x}, ${info.coordinates.y})`\n    });\n\n    if (info.character) {\n      console.info('Character at Cursor:', {\n        char:\n          info.character.char === ' '\n            ? '\u00b7'\n            : info.character.char === '\\\\n'\n              ? '\\\\\\\\n'\n              : info.character.char,\n        isWhitespace: info.character.isWhitespace,\n        isNewline: info.character.isNewline\n      });\n    }\n\n    if (info.nearbyPills.length > 0) {\n      console.info('Nearby Pills:', info.nearbyPills);\n    }\n\n    // Always properly close the group\n    console.groupEnd();\n  }\n\n  /**\n   * Log selection information\n   */\n  logSelection(info: SelectionDebugInfo): void {\n    if (!this.isEnabled) return;\n\n    console.groupCollapsed(`\ud83c\udfaf ${this.getContextPrefix()}Selection Debug`);\n\n    console.info('Selection Details:', {\n      range: `${info.start}-${info.end}`,\n      length: info.selectedLength,\n      text: `\\\"${info.selectedText}\\\"`,\n      hasCompletePills: info.hasCompletePills\n    });\n\n    if (info.affectedPills.length > 0) {\n      console.warn('Affected Pills:', info.affectedPills);\n\n      // Create table for pill selection analysis\n      console.table(\n        info.affectedPills.map((pill) => ({\n          'Pill Type': pill.type,\n          'Pill Text': pill.text,\n          'Fully Selected': pill.fullySelected ? '\u2705' : '\u26a0\ufe0f'\n        }))\n      );\n    }\n\n    // Always properly close the group\n    console.groupEnd();\n  }\n\n  /**\n   * Log parsing results\n   */\n  logParsing(text: string, segments: any[], tokens: any[]): void {\n    if (!this.isEnabled) return;\n\n    // If plaintext mode is enabled, output copy-pasteable format\n    if (this.plaintextMode) {\n      this.logPlaintext('Content Parsing Debug', {\n        textAnalysis: {\n          originalText: text,\n          textLength: text.length,\n          segmentCount: segments.length,\n          tokenCount: tokens.length\n        },\n        parsedSegments: segments.map((segment, index) => ({\n          index,\n          type: segment.type,\n          value: segment.value,\n          start: segment.start,\n          end: segment.end,\n          rawFormat: segment.raw || segment.value\n        })),\n        generatedTokens: tokens.map((token, index) => ({\n          index,\n          type: token.type,\n          content: token.content,\n          rawText: token.rawText,\n          start: token.start,\n          end: token.end\n        }))\n      });\n      return;\n    }\n\n    // Original console formatting\n    console.groupCollapsed(\n      `\ud83d\udd0d ${this.getContextPrefix()}Content Parsing Debug`\n    );\n\n    console.info('Text Analysis:', {\n      originalText: text,\n      textLength: text.length,\n      segmentCount: segments.length,\n      tokenCount: tokens.length\n    });\n\n    console.info('Parsed Segments:');\n    console.table(\n      segments.map((segment, index) => ({\n        Index: index,\n        Type: segment.type,\n        Value: segment.value,\n        Start: segment.start,\n        End: segment.end,\n        'Raw Format': segment.raw || segment.value\n      }))\n    );\n\n    console.info('Generated Tokens:');\n    console.table(\n      tokens.map((token, index) => ({\n        Index: index,\n        Type: token.type,\n        Content: token.content,\n        'Raw Text': token.rawText,\n        Start: token.start,\n        End: token.end\n      }))\n    );\n\n    // Always properly close the group\n    console.groupEnd();\n  }\n\n  /**\n   * Log text context around a position\n   */\n  private logTextContext(\n    text: string,\n    position: number,\n    contextSize: number = 20\n  ): void {\n    const start = Math.max(0, position - contextSize);\n    const end = Math.min(text.length, position + contextSize);\n    const before = text.slice(start, position);\n    const after = text.slice(position, end);\n\n    console.info('\ud83d\udcdd Text Context:', {\n      before: `\\\"${before}\\\"`,\n      cursor: '|',\n      after: `\\\"${after}\\\"`,\n      position: position,\n      contextRange: `${start}-${end}`\n    });\n  }\n\n  /**\n   * Log errors and warnings\n   */\n  logError(message: string, error?: any): void {\n    if (!this.isEnabled) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext(`ERROR: ${message}`, error || {});\n      return;\n    }\n\n    console.error(`\u274c ${this.getContextPrefix()}${message}`, error);\n  }\n\n  logWarning(message: string, data?: any): void {\n    if (!this.isEnabled) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext(`WARNING: ${message}`, data || {});\n      return;\n    }\n\n    console.warn(`\u26a0\ufe0f ${this.getContextPrefix()}${message}`, data);\n  }\n\n  /**\n   * Log general info\n   */\n  logInfo(message: string, data?: any): void {\n    if (!this.isEnabled) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext(`INFO: ${message}`, data || {});\n      return;\n    }\n\n    console.info(`\u2139\ufe0f ${this.getContextPrefix()}${message}`, data);\n  }\n\n  /**\n   * Log comprehensive cursor positioning debug information\n   */\n  logCursorPositioning(data: {\n    clickCoordinates?: { x: number; y: number };\n    textIndex?: number;\n    tokens?: any[];\n    rawText?: string;\n    foundToken?: any;\n    calculatedPosition?: any;\n    domElements?: any;\n    newlineInfo?: {\n      hasNewlines: boolean;\n      newlinePositions: number[];\n      lineCount: number;\n      clickedLine?: number;\n    };\n    blankLineInfo?: {\n      clickedLineIndex: number;\n      targetNewlineIndex?: number;\n      newlinePosition?: number;\n      positionedAtStart?: boolean;\n      positionedAfterNewline?: boolean;\n    };\n  }): void {\n    if (!this.isEnabled) return;\n\n    if (this.plaintextMode) {\n      this.logPlaintext('Cursor Positioning Debug', {\n        clickInfo: data.clickCoordinates\n          ? {\n              coordinates: `(${data.clickCoordinates.x}, ${data.clickCoordinates.y})`,\n              textIndex: data.textIndex\n            }\n          : null,\n        textAnalysis: data.rawText\n          ? {\n              fullText: data.rawText,\n              textLength: data.rawText.length,\n              hasNewlines: data.newlineInfo?.hasNewlines || false,\n              newlinePositions: data.newlineInfo?.newlinePositions || [],\n              lineCount: data.newlineInfo?.lineCount || 1,\n              clickedLine: data.newlineInfo?.clickedLine\n            }\n          : null,\n        tokenAnalysis: data.tokens\n          ? {\n              totalTokens: data.tokens.length,\n              tokens: data.tokens.map((token, index) => ({\n                index,\n                type: token.type,\n                content: token.content || token.rawText,\n                bounds: `${token.start}-${token.end}`,\n                isNewline: token.metadata?.isNewline || false,\n                hasNewlines: token.metadata?.hasNewlines || false\n              }))\n            }\n          : null,\n        foundToken: data.foundToken\n          ? {\n              tokenIndex: data.foundToken.tokenIndex,\n              tokenType: data.foundToken.type,\n              tokenContent: data.foundToken.content || data.foundToken.rawText,\n              tokenBounds: `${data.foundToken.start}-${data.foundToken.end}`,\n              isNewline: data.foundToken.metadata?.isNewline || false,\n              characterOffset: data.calculatedPosition?.charOffsetInToken\n            }\n          : null,\n        calculatedPosition: data.calculatedPosition\n          ? {\n              textIndex: data.calculatedPosition.index,\n              tokenIndex: data.calculatedPosition.tokenIndex,\n              charOffsetInToken: data.calculatedPosition.charOffsetInToken,\n              line: data.calculatedPosition.line,\n              column: data.calculatedPosition.column\n            }\n          : null,\n        domElements: data.domElements\n          ? {\n              clickedElement: data.domElements.clickedElement?.tagName,\n              contentElement: data.domElements.contentElement?.tagName,\n              tokenElements: data.domElements.tokenElements?.length || 0\n            }\n          : null\n      });\n      return;\n    }\n\n    // Original console formatting\n    console.groupCollapsed(\n      `\ud83c\udfaf ${this.getContextPrefix()}Cursor Positioning Debug`\n    );\n\n    if (data.clickCoordinates) {\n      console.info('\ud83d\udccd Click Info:', {\n        coordinates: `(${data.clickCoordinates.x}, ${data.clickCoordinates.y})`,\n        textIndex: data.textIndex\n      });\n    }\n\n    if (data.rawText && data.newlineInfo) {\n      console.info('\ud83d\udcdd Text Analysis:', {\n        textLength: data.rawText.length,\n        hasNewlines: data.newlineInfo.hasNewlines,\n        newlineCount: data.newlineInfo.newlinePositions.length,\n        lineCount: data.newlineInfo.lineCount,\n        clickedLine: data.newlineInfo.clickedLine,\n        newlinePositions: data.newlineInfo.newlinePositions\n      });\n    }\n\n    if (data.tokens) {\n      console.info('\ud83d\udd24 Token Analysis:');\n      console.table(\n        data.tokens.map((token, index) => ({\n          Index: index,\n          Type: token.type,\n          Content: (token.content || token.rawText || '').substring(0, 20),\n          Bounds: `${token.start}-${token.end}`,\n          IsNewline: token.metadata?.isNewline || false,\n          HasNewlines: token.metadata?.hasNewlines || false\n        }))\n      );\n    }\n\n    if (data.foundToken) {\n      console.warn('\ud83c\udfaf Found Token:', {\n        tokenIndex: data.foundToken.tokenIndex || data.foundToken.index,\n        type: data.foundToken.type,\n        content: data.foundToken.content || data.foundToken.rawText,\n        bounds: `${data.foundToken.start}-${data.foundToken.end}`,\n        isNewline: data.foundToken.metadata?.isNewline || false,\n        characterOffset: data.calculatedPosition?.charOffsetInToken\n      });\n    }\n\n    if (data.calculatedPosition) {\n      console.info('\ud83d\udcd0 Calculated Position:', data.calculatedPosition);\n    }\n\n    // Always properly close the group\n    console.groupEnd();\n  }\n}\n\n// Export singleton instance\nexport const richTextLogger = RichTextLogger.getInstance();\n\n// Utility functions for easy logging\nexport function logClick(info: ClickDebugInfo): void {\n  richTextLogger.logClick(info);\n}\n\nexport function logCursor(info: CursorDebugInfo): void {\n  richTextLogger.logCursor(info);\n}\n\nexport function logSelection(info: SelectionDebugInfo): void {\n  richTextLogger.logSelection(info);\n}\n\nexport function logParsing(text: string, segments: any[], tokens: any[]): void {\n  richTextLogger.logParsing(text, segments, tokens);\n}\n\nexport function logCursorPositioning(data: {\n  clickCoordinates?: { x: number; y: number };\n  textIndex?: number;\n  tokens?: any[];\n  rawText?: string;\n  foundToken?: any;\n  calculatedPosition?: any;\n  domElements?: any;\n  newlineInfo?: {\n    hasNewlines: boolean;\n    newlinePositions: number[];\n    lineCount: number;\n    clickedLine?: number;\n  };\n  blankLineInfo?: {\n    clickedLineIndex: number;\n    targetNewlineIndex?: number;\n    newlinePosition?: number;\n    positionedAtStart?: boolean;\n    positionedAfterNewline?: boolean;\n  };\n}): void {\n  richTextLogger.logCursorPositioning(data);\n}\n\n// Helper functions for easy console access\nexport function enablePlaintextLogging(): void {\n  richTextLogger.enablePlaintextMode();\n  console.log('\u2705 Rich Text Plaintext Logging Enabled');\n  console.log(\n    '\ud83d\udccb Objects will now be logged in copy-pasteable plaintext format'\n  );\n  console.log(\n    '\ud83d\udd27 To disable: richTextLogger.disablePlaintextMode() or call disablePlaintextLogging()'\n  );\n}\n\nexport function disablePlaintextLogging(): void {\n  richTextLogger.disablePlaintextMode();\n  console.log('\u274c Rich Text Plaintext Logging Disabled');\n  console.log('\ud83c\udfa8 Logging will now use formatted console output');\n}\n\nexport function isPlaintextLogging(): boolean {\n  return richTextLogger.isPlaintextMode();\n}\n\n// Make helper functions available globally for easy console access\nif (typeof window !== 'undefined') {\n  (window as any).enablePlaintextLogging = enablePlaintextLogging;\n  (window as any).disablePlaintextLogging = disablePlaintextLogging;\n  (window as any).isPlaintextLogging = isPlaintextLogging;\n  (window as any).richTextLogger = richTextLogger;\n}\n",
    "language":"typescript",
    "lines":764,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/utils/cursorCalculations.ts":{
    "content":"/**\n * Cursor calculation utilities for rich input components\n * Handles cursor positioning within tokens and coordinate calculations\n */\n\nimport { createLogger } from '@/lib/logging';\nimport type { RichInputPosition } from '../types';\nimport { richTextLogger } from './logger';\nimport type { TokenPosition } from './tokenPositioning';\n\nconst logger = createLogger({\n  context: {\n    component: 'CursorCalculations',\n    module: 'rich-input/utils'\n  }\n});\n\n// Use Element[] instead of NodeListOf to avoid type issues\n\n/**\n * Calculate cursor position with line-aware system support\n * This combines line-based structure with token-level precision\n */\nexport function calculateLineAwareCursorPosition(\n  position: RichInputPosition,\n  contentElement: HTMLElement,\n  rawText: string\n): { x: number; y: number } | null {\n  // Check if we have line-based structure (multiline mode)\n  const lineElements = contentElement.querySelectorAll('.rich-input-line');\n\n  if (lineElements.length > 0) {\n    // Line-based rendering - find the correct line first, then position within tokens\n    return calculateCursorInLineBasedStructure(\n      position,\n      contentElement,\n      rawText,\n      Array.from(lineElements)\n    );\n  } else {\n    // Fallback to token-based positioning for single-line mode\n    return calculateCursorInTokenBasedStructure(\n      position,\n      contentElement,\n      rawText\n    );\n  }\n}\n\n/**\n * Calculate cursor position within line-based structure\n */\nfunction calculateCursorInLineBasedStructure(\n  position: RichInputPosition,\n  contentElement: HTMLElement,\n  rawText: string,\n  lineElements: Element[]\n): { x: number; y: number } | null {\n  const containerRect = contentElement.getBoundingClientRect();\n  const textIndex = position.index;\n\n  richTextLogger.logInfo('\ud83c\udfaf Line-based cursor positioning', {\n    textIndex,\n    lineElementsCount: lineElements.length,\n    containerRect: {\n      width: containerRect.width,\n      height: containerRect.height\n    }\n  });\n\n  // Find which line contains this text index\n  for (const lineElement of lineElements) {\n    const lineStart = parseInt(\n      lineElement.getAttribute('data-line-start') || '0'\n    );\n    const lineEnd = parseInt(lineElement.getAttribute('data-line-end') || '0');\n    const lineIndex = parseInt(\n      lineElement.getAttribute('data-line-index') || '0'\n    );\n\n    richTextLogger.logInfo('\ud83d\udd0d Checking line for cursor position', {\n      lineIndex,\n      lineStart,\n      lineEnd,\n      textIndex,\n      isWithinLine: textIndex >= lineStart && textIndex <= lineEnd\n    });\n\n    // Check if cursor position is within this line's range\n    if (textIndex >= lineStart && textIndex <= lineEnd) {\n      const lineRect = lineElement.getBoundingClientRect();\n\n      // If this is an empty line, position cursor at the beginning of the line\n      const isEmptyLine =\n        lineStart === lineEnd ||\n        lineElement.querySelector('.rich-input-empty-line');\n\n      if (isEmptyLine) {\n        const cursorPosition = {\n          x: lineRect.left - containerRect.left,\n          y: lineRect.top - containerRect.top\n        };\n\n        richTextLogger.logInfo('\ud83d\udccd Positioning cursor on empty line', {\n          lineIndex,\n          lineStart,\n          lineEnd,\n          lineRect: {\n            left: lineRect.left,\n            top: lineRect.top,\n            width: lineRect.width,\n            height: lineRect.height\n          },\n          cursorPosition\n        });\n\n        return cursorPosition;\n      }\n\n      // Find tokens within this line\n      const lineTokenElements =\n        lineElement.querySelectorAll('[data-token-start]');\n\n      // Check if this line contains only empty content tokens\n      const hasOnlyEmptyTokens = Array.from(lineTokenElements).every(\n        (tokenEl) => {\n          const tokenStart = parseInt(\n            tokenEl.getAttribute('data-token-start') || '0'\n          );\n          const tokenEnd = parseInt(\n            tokenEl.getAttribute('data-token-end') || '0'\n          );\n          const tokenContent = rawText.substring(tokenStart, tokenEnd);\n          return tokenContent.trim() === '';\n        }\n      );\n\n      if (hasOnlyEmptyTokens && lineTokenElements.length > 0) {\n        const cursorPosition = {\n          x: lineRect.left - containerRect.left,\n          y: lineRect.top - containerRect.top\n        };\n\n        richTextLogger.logInfo(\n          '\ud83d\udccd Positioning cursor on line with only empty tokens',\n          {\n            lineIndex,\n            lineStart,\n            lineEnd,\n            tokenCount: lineTokenElements.length,\n            cursorPosition\n          }\n        );\n\n        return cursorPosition;\n      }\n\n      richTextLogger.logInfo('\ud83d\udd0d Searching tokens within line', {\n        lineIndex,\n        tokenCount: lineTokenElements.length\n      });\n\n      for (const tokenElement of lineTokenElements) {\n        const tokenStart = parseInt(\n          tokenElement.getAttribute('data-token-start') || '0'\n        );\n        const tokenEnd = parseInt(\n          tokenElement.getAttribute('data-token-end') || '0'\n        );\n\n        // Check if cursor is within this token\n        if (textIndex >= tokenStart && textIndex <= tokenEnd) {\n          const tokenRect = tokenElement.getBoundingClientRect();\n          const charOffsetInToken = textIndex - tokenStart;\n\n          // Calculate precise position within the token\n          const tokenPosition = calculatePreciseCursorInToken(\n            tokenElement as HTMLElement,\n            charOffsetInToken,\n            rawText.substring(tokenStart, tokenEnd)\n          );\n\n          if (tokenPosition) {\n            const cursorPosition = {\n              x: tokenPosition.x - containerRect.left,\n              y: tokenPosition.y - containerRect.top\n            };\n\n            richTextLogger.logInfo('\ud83d\udccd Positioning cursor within token', {\n              lineIndex,\n              tokenStart,\n              tokenEnd,\n              charOffsetInToken,\n              cursorPosition\n            });\n\n            return cursorPosition;\n          }\n\n          // Fallback to token start\n          return {\n            x: tokenRect.left - containerRect.left,\n            y: tokenRect.top - containerRect.top\n          };\n        }\n      }\n\n      // If cursor is at the end of the line but not within any token\n      const cursorPosition = {\n        x: lineRect.right - containerRect.left,\n        y: lineRect.top - containerRect.top\n      };\n\n      richTextLogger.logInfo('\ud83d\udccd Positioning cursor at end of line', {\n        lineIndex,\n        cursorPosition\n      });\n\n      return cursorPosition;\n    }\n  }\n\n  // Fallback: position at the end of the last line\n  if (lineElements.length > 0) {\n    const lastLine = lineElements[lineElements.length - 1];\n    const lastLineRect = lastLine.getBoundingClientRect();\n\n    const fallbackPosition = {\n      x: lastLineRect.right - containerRect.left,\n      y: lastLineRect.top - containerRect.top\n    };\n\n    richTextLogger.logInfo(\n      '\ud83d\udccd Fallback: positioning cursor at end of last line',\n      {\n        textIndex,\n        lastLineIndex: lineElements.length - 1,\n        fallbackPosition\n      }\n    );\n\n    return fallbackPosition;\n  }\n\n  richTextLogger.logInfo('\u274c No suitable line found for cursor position', {\n    textIndex,\n    lineElementsCount: lineElements.length\n  });\n\n  return { x: 0, y: 0 };\n}\n\n/**\n * Calculate cursor position within token-based structure (single-line fallback)\n */\nfunction calculateCursorInTokenBasedStructure(\n  position: RichInputPosition,\n  contentElement: HTMLElement,\n  rawText: string\n): { x: number; y: number } | null {\n  const tokenElements = contentElement.querySelectorAll('[data-token-start]');\n  const containerRect = contentElement.getBoundingClientRect();\n  const textIndex = position.index;\n\n  // Special handling for empty input with dummy token\n  if (rawText.length === 0 && tokenElements.length === 1) {\n    const dummyElement = tokenElements[0];\n    if (dummyElement.getAttribute('data-is-dummy') === 'true') {\n      const tokenRect = dummyElement.getBoundingClientRect();\n      return {\n        x: tokenRect.left - containerRect.left,\n        y: tokenRect.top - containerRect.top\n      };\n    }\n  }\n\n  for (const tokenElement of tokenElements) {\n    const tokenStart = parseInt(\n      tokenElement.getAttribute('data-token-start') || '0'\n    );\n    const tokenEnd = parseInt(\n      tokenElement.getAttribute('data-token-end') || '0'\n    );\n\n    if (textIndex >= tokenStart && textIndex <= tokenEnd) {\n      const charOffsetInToken = textIndex - tokenStart;\n\n      const tokenPosition = calculatePreciseCursorInToken(\n        tokenElement as HTMLElement,\n        charOffsetInToken,\n        rawText.substring(tokenStart, tokenEnd)\n      );\n\n      if (tokenPosition) {\n        return {\n          x: tokenPosition.x - containerRect.left,\n          y: tokenPosition.y - containerRect.top\n        };\n      }\n    }\n  }\n\n  return { x: 0, y: 0 };\n}\n\n/**\n * Calculate precise cursor position within a token element\n */\nfunction calculatePreciseCursorInToken(\n  tokenElement: HTMLElement,\n  charOffset: number,\n  tokenText: string\n): { x: number; y: number } | null {\n  try {\n    // For empty tokens or zero offset, position at the start\n    if (tokenText.length === 0 || charOffset === 0) {\n      const tokenRect = tokenElement.getBoundingClientRect();\n      return {\n        x: tokenRect.left,\n        y: tokenRect.top\n      };\n    }\n\n    // Use DOM range for precise positioning\n    const textNodes = getTextNodesInElement(tokenElement);\n    if (textNodes.length === 0) {\n      const tokenRect = tokenElement.getBoundingClientRect();\n      return {\n        x: tokenRect.left,\n        y: tokenRect.top\n      };\n    }\n\n    // Find the correct text node and offset\n    let remainingOffset = charOffset;\n    let targetTextNode: Text | null = null;\n    let targetOffset = 0;\n\n    for (const textNode of textNodes) {\n      const nodeText = textNode.textContent || '';\n      if (remainingOffset <= nodeText.length) {\n        targetTextNode = textNode;\n        targetOffset = remainingOffset;\n        break;\n      }\n      remainingOffset -= nodeText.length;\n    }\n\n    if (!targetTextNode) {\n      // Position at the end of the last text node\n      targetTextNode = textNodes[textNodes.length - 1];\n      targetOffset = (targetTextNode.textContent || '').length;\n    }\n\n    const range = document.createRange();\n    range.setStart(\n      targetTextNode,\n      Math.min(targetOffset, (targetTextNode.textContent || '').length)\n    );\n    range.collapse(true);\n\n    const rangeRect = range.getBoundingClientRect();\n    return {\n      x: rangeRect.left,\n      y: rangeRect.top\n    };\n  } catch (error) {\n    logger.warn('Error calculating precise cursor position', { error });\n    // Fallback to proportional positioning\n    const tokenRect = tokenElement.getBoundingClientRect();\n    const proportionalX =\n      tokenText.length > 0\n        ? (charOffset / tokenText.length) * tokenRect.width\n        : 0;\n\n    return {\n      x: tokenRect.left + proportionalX,\n      y: tokenRect.top\n    };\n  }\n}\n\n/**\n * Calculate cursor position within a specific token with enhanced line break support\n */\nexport function calculateCursorWithinToken(\n  tokenPosition: TokenPosition,\n  contentElement: HTMLElement,\n  rawText: string\n): { x: number; y: number } | null {\n  const tokenElements = contentElement.querySelectorAll('[data-token-index]');\n  const tokenElement = tokenElements[tokenPosition.tokenIndex] as HTMLElement;\n\n  if (!tokenElement) return null;\n\n  const tokenRect = tokenElement.getBoundingClientRect();\n  const containerRect = contentElement.getBoundingClientRect();\n\n  // Special handling for text tokens with newlines\n  if (tokenPosition.token.metadata?.hasNewlines) {\n    // For text tokens containing newlines, use range-based positioning\n    // This handles multi-line text content properly\n    const cursorPosition = calculateCursorPositionWithRange(\n      tokenPosition,\n      tokenElement,\n      rawText\n    );\n\n    if (cursorPosition) {\n      return {\n        x: cursorPosition.x - containerRect.left,\n        y: cursorPosition.y - containerRect.top\n      };\n    }\n\n    // Fallback to token boundaries\n    return {\n      x: tokenRect.left - containerRect.left,\n      y: tokenRect.top - containerRect.top\n    };\n  }\n\n  // For whitespace tokens (non-newline), position cursor at the beginning\n  if (tokenPosition.token.metadata?.isWhitespace) {\n    return {\n      x: tokenRect.left - containerRect.left,\n      y: tokenRect.top - containerRect.top\n    };\n  }\n\n  // For non-whitespace tokens, calculate precise character position\n  try {\n    // Use enhanced range positioning for multi-line content\n    const cursorPosition = calculateCursorPositionWithRange(\n      tokenPosition,\n      tokenElement,\n      rawText\n    );\n\n    if (cursorPosition) {\n      richTextLogger.logInfo('Calculated cursor position within token', {\n        tokenIndex: tokenPosition.tokenIndex,\n        charOffset: tokenPosition.charOffsetInToken,\n        tokenBounds: {\n          left: tokenRect.left - containerRect.left,\n          right: tokenRect.right - containerRect.left,\n          width: tokenRect.width\n        },\n        cursorPosition: {\n          x: cursorPosition.x - containerRect.left,\n          y: cursorPosition.y - containerRect.top\n        }\n      });\n\n      return {\n        x: cursorPosition.x - containerRect.left,\n        y: cursorPosition.y - containerRect.top\n      };\n    }\n\n    // Fallback to token boundaries\n    return {\n      x: tokenRect.left - containerRect.left,\n      y: tokenRect.top - containerRect.top\n    };\n  } catch (error) {\n    logger.warn('Error calculating cursor within token', {\n      error,\n      tokenIndex: tokenPosition.tokenIndex\n    });\n    // Fallback to proportional positioning within token\n    const tokenWidth = tokenRect.width;\n    const tokenLength = tokenPosition.token.rawText.length;\n    const proportionalX =\n      tokenLength > 0\n        ? (tokenPosition.charOffsetInToken / tokenLength) * tokenWidth\n        : 0;\n\n    return {\n      x: tokenRect.left - containerRect.left + proportionalX,\n      y: tokenRect.top - containerRect.top\n    };\n  }\n}\n\n/**\n * Enhanced cursor position calculation using DOM ranges with line break support\n */\nexport function calculateCursorPositionWithRange(\n  tokenPosition: TokenPosition,\n  tokenElement: HTMLElement,\n  rawText: string\n): { x: number; y: number } | null {\n  try {\n    const range = document.createRange();\n    const tokenRawText = tokenPosition.token.rawText;\n    const charOffset = tokenPosition.charOffsetInToken;\n\n    // Special handling for tokens with newlines rendered as <br /> elements\n    if (tokenPosition.token.metadata?.hasNewlines) {\n      return calculateCursorPositionInMultilineToken(\n        tokenElement,\n        tokenRawText,\n        charOffset\n      );\n    }\n\n    // For regular text tokens, use standard range positioning\n    const textNodes = getTextNodesInElement(tokenElement);\n    if (textNodes.length === 0) {\n      return null;\n    }\n\n    // Find the correct text node and offset\n    let remainingOffset = charOffset;\n    let targetTextNode: Text | null = null;\n    let targetOffset = 0;\n\n    for (const textNode of textNodes) {\n      const nodeText = textNode.textContent || '';\n      if (remainingOffset <= nodeText.length) {\n        targetTextNode = textNode;\n        targetOffset = remainingOffset;\n        break;\n      }\n      remainingOffset -= nodeText.length;\n    }\n\n    if (!targetTextNode && textNodes.length > 0) {\n      targetTextNode = textNodes[textNodes.length - 1];\n      targetOffset = (targetTextNode.textContent || '').length;\n    }\n\n    if (!targetTextNode) {\n      return null;\n    }\n\n    range.setStart(\n      targetTextNode,\n      Math.min(targetOffset, (targetTextNode.textContent || '').length)\n    );\n    range.collapse(true);\n\n    const rangeRect = range.getBoundingClientRect();\n    return {\n      x: rangeRect.left,\n      y: rangeRect.top\n    };\n  } catch (error) {\n    logger.warn('Error in calculateCursorPositionWithRange', { error });\n    return null;\n  }\n}\n\n/**\n * Calculate cursor position within a token that contains newlines rendered as <br /> elements\n */\nfunction calculateCursorPositionInMultilineToken(\n  tokenElement: HTMLElement,\n  tokenRawText: string,\n  charOffset: number\n): { x: number; y: number } | null {\n  try {\n    // Split the raw text by newlines to understand the line structure\n    const lines = tokenRawText.split('\\\\n');\n\n    // Find which line the cursor should be on\n    let currentOffset = 0;\n    let targetLineIndex = 0;\n    let offsetInLine = 0;\n\n    for (let i = 0; i < lines.length; i++) {\n      const lineLength = lines[i].length;\n\n      if (charOffset <= currentOffset + lineLength) {\n        // Cursor is on this line\n        targetLineIndex = i;\n        offsetInLine = charOffset - currentOffset;\n        break;\n      }\n\n      // Move to next line (add 1 for the newline character)\n      currentOffset += lineLength + 1;\n    }\n\n    // Now find the corresponding DOM elements\n    const childNodes = Array.from(tokenElement.childNodes);\n    let currentLineInDOM = 0;\n    let targetTextNode: Text | null = null;\n\n    for (const node of childNodes) {\n      if (node.nodeType === Node.TEXT_NODE) {\n        if (currentLineInDOM === targetLineIndex) {\n          targetTextNode = node as Text;\n          break;\n        }\n      } else if (node.nodeName === 'BR') {\n        currentLineInDOM++;\n      }\n    }\n\n    if (!targetTextNode) {\n      // If we can't find the exact text node, position at the end of the token\n      const tokenRect = tokenElement.getBoundingClientRect();\n      return {\n        x: tokenRect.right,\n        y: tokenRect.bottom\n      };\n    }\n\n    // Create a range to measure the exact position within the text node\n    const range = document.createRange();\n    const nodeText = targetTextNode.textContent || '';\n    const clampedOffset = Math.min(offsetInLine, nodeText.length);\n\n    range.setStart(targetTextNode, clampedOffset);\n    range.collapse(true);\n\n    const rangeRect = range.getBoundingClientRect();\n    return {\n      x: rangeRect.left,\n      y: rangeRect.top\n    };\n  } catch (error) {\n    logger.warn('Error in calculateCursorPositionInMultilineToken', { error });\n    return null;\n  }\n}\n\n/**\n * Get all text nodes within an element\n */\nexport function getTextNodesInElement(element: HTMLElement): Text[] {\n  const textNodes: Text[] = [];\n  const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null);\n\n  let node: Text | null = walker.nextNode() as Text;\n  while (node) {\n    textNodes.push(node);\n    node = walker.nextNode() as Text;\n  }\n\n  return textNodes;\n}\n\n/**\n * Get the first text node within an element\n */\nexport function getFirstTextNode(element: HTMLElement): Text | null {\n  const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null);\n  return walker.nextNode() as Text | null;\n}\n\n/**\n * Calculate position at the end of all content\n */\nexport function calculateEndOfContentPosition(contentElement: HTMLElement): {\n  x: number;\n  y: number;\n} {\n  const lastChild = contentElement.lastElementChild;\n\n  if (lastChild) {\n    const rect = lastChild.getBoundingClientRect();\n    const containerRect = contentElement.getBoundingClientRect();\n\n    return {\n      x: rect.right - containerRect.left,\n      y: rect.top - containerRect.top\n    };\n  }\n\n  return { x: 0, y: 0 };\n}\n\n/**\n * Fallback cursor positioning for error cases\n */\nexport function fallbackCursorPosition(\n  position: RichInputPosition,\n  contentElement: HTMLElement\n): { x: number; y: number } {\n  // Simple fallback: estimate position based on font metrics\n  const computedStyle = window.getComputedStyle(contentElement);\n  const fontSize = parseFloat(computedStyle.fontSize) || 14;\n  const charWidth = fontSize * 0.6; // Rough estimate for monospace\n\n  return {\n    x: position.index * charWidth,\n    y: 0\n  };\n}\n",
    "language":"typescript",
    "lines":693,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/core/WidthMeasurement.ts":{
    "content":"/**\n * Width Measurement Utility for Rich Input Tokens\n * Provides DOM-accurate measurements for pills in different states\n */\n\nimport type { RichContentToken } from '../types';\n\nexport interface MeasurementContext {\n  isEditMode?: boolean;\n  containerElement?: HTMLElement;\n  measurementContainer?: HTMLElement;\n  className?: string;\n}\n\nexport interface TokenWidthData {\n  normal: number;\n  editMode?: number;\n  lastMeasured: number;\n  containerSelector?: string;\n}\n\nexport class WidthMeasurementUtility {\n  private measurementContainer: HTMLElement | null = null;\n  private cachedMeasurements = new Map<string, TokenWidthData>();\n\n  constructor() {\n    this.ensureMeasurementContainer();\n  }\n\n  /**\n   * Measure the width of a token in its current state\n   */\n  measureToken(\n    token: RichContentToken,\n    context: MeasurementContext = {}\n  ): number {\n    const cacheKey = this.getCacheKey(token, context);\n    const cached = this.cachedMeasurements.get(cacheKey);\n\n    // Return cached measurement if recent (within 5 seconds)\n    if (cached && Date.now() - cached.lastMeasured < 5000) {\n      return context.isEditMode\n        ? cached.editMode || cached.normal\n        : cached.normal;\n    }\n\n    const measuredWidth = this.performMeasurement(token, context);\n\n    // Update cache\n    const existing = this.cachedMeasurements.get(\n      this.getCacheKey(token, { isEditMode: false })\n    ) || {\n      normal: 0,\n      lastMeasured: Date.now()\n    };\n\n    if (context.isEditMode) {\n      existing.editMode = measuredWidth;\n    } else {\n      existing.normal = measuredWidth;\n    }\n    existing.lastMeasured = Date.now();\n\n    this.cachedMeasurements.set(cacheKey, existing);\n    return measuredWidth;\n  }\n\n  /**\n   * Perform the actual DOM measurement\n   */\n  private performMeasurement(\n    token: RichContentToken,\n    context: MeasurementContext\n  ): number {\n    // Return fallback width on server side\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      return token.rawText.length * 8; // Fallback: ~8px per character\n    }\n\n    if (!this.measurementContainer) {\n      this.ensureMeasurementContainer();\n    }\n\n    if (!this.measurementContainer) {\n      return token.rawText.length * 8; // Fallback if container creation failed\n    }\n\n    const element = this.createTokenElement(token, context);\n    this.measurementContainer.appendChild(element);\n\n    // Force layout calculation\n    element.offsetHeight;\n\n    const width = element.offsetWidth;\n\n    // Clean up\n    this.measurementContainer!.removeChild(element);\n\n    return width;\n  }\n\n  /**\n   * Create a token element for measurement\n   */\n  private createTokenElement(\n    token: RichContentToken,\n    context: MeasurementContext\n  ): HTMLElement {\n    // This should only be called on client side, but add safety check\n    if (typeof document === 'undefined') {\n      throw new Error('createTokenElement called on server side');\n    }\n\n    const element = document.createElement('span');\n\n    // Apply base styles\n    element.style.position = 'absolute';\n    element.style.visibility = 'hidden';\n    element.style.whiteSpace = 'nowrap';\n\n    // Apply token-specific classes and content\n    switch (token.type) {\n      case 'hashtag':\n        element.className = 'content-pill content-pill--hashtag';\n        element.textContent = token.rawText;\n        break;\n\n      case 'mention':\n        element.className = 'content-pill content-pill--mention';\n        if (context.isEditMode) {\n          // In edit mode, mentions might have additional controls\n          element.innerHTML = `\n            <span class=\\\"mention-content\\\">${token.content}</span>\n            <button class=\\\"mention-remove-btn\\\" style=\\\"margin-left: 4px; width: 16px; height: 16px;\\\">\u00d7</button>\n          `;\n        } else {\n          element.textContent = token.content;\n        }\n        break;\n\n      case 'url':\n        element.className = `content-pill content-pill--url content-pill--${token.metadata?.behavior || 'link'}`;\n        if (context.isEditMode) {\n          // URL pills in edit mode might have behavior controls\n          element.innerHTML = `\n            <span class=\\\"url-content\\\">${token.content}</span>\n            <select class=\\\"url-behavior-select\\\" style=\\\"margin-left: 4px; font-size: 0.75em;\\\">\n              <option>link</option>\n              <option>embed</option>\n              <option>modal</option>\n            </select>\n          `;\n        } else {\n          element.textContent = token.content;\n        }\n        break;\n\n      case 'emoji':\n        if (token.metadata?.emojiUnicode) {\n          // Detect ASCII emojis and apply appropriate class\n          const isAsciiEmoji =\n            token.metadata?.customData?.unicode_codepoint === 'ASCII' ||\n            token.content.includes('ascii') ||\n            /^[()\\\\\\\\|\\\\-_:;><3PDO*yn]/.test(token.metadata.emojiUnicode);\n\n          element.className = isAsciiEmoji\n            ? 'rich-input-token rich-input-token--emoji emoji emoji--ascii'\n            : 'rich-input-token rich-input-token--emoji emoji emoji--unicode';\n          element.textContent = token.metadata.emojiUnicode;\n        } else if (token.metadata?.emojiImageUrl) {\n          element.className =\n            'rich-input-token rich-input-token--emoji emoji emoji--custom';\n          const img = document.createElement('img');\n          img.src = token.metadata.emojiImageUrl;\n          img.alt = `:${token.content}:`;\n          img.style.width = '1.2em';\n          img.style.height = '1.2em';\n          element.appendChild(img);\n        } else {\n          element.className = 'rich-input-token rich-input-token--emoji emoji';\n          element.textContent = token.rawText;\n        }\n        break;\n\n      default:\n        element.className = 'rich-input-token rich-input-token--text';\n        element.textContent = token.rawText;\n        break;\n    }\n\n    // Apply any additional context classes\n    if (context.className) {\n      element.className += ` ${context.className}`;\n    }\n\n    // Copy styles from existing similar elements if available\n    if (context.containerElement) {\n      this.copyRelevantStyles(element, context.containerElement, token.type);\n    }\n\n    return element;\n  }\n\n  /**\n   * Copy relevant styles from the container to ensure accurate measurement\n   */\n  private copyRelevantStyles(\n    element: HTMLElement,\n    containerElement: HTMLElement,\n    tokenType: string\n  ): void {\n    const containerStyles = window.getComputedStyle(containerElement);\n\n    // Copy font-related styles\n    element.style.fontSize = containerStyles.fontSize;\n    element.style.fontFamily = containerStyles.fontFamily;\n    element.style.fontWeight = containerStyles.fontWeight;\n    element.style.lineHeight = containerStyles.lineHeight;\n\n    // Look for existing pill in the container to copy pill-specific styles\n    const existingPill = containerElement.querySelector(\n      `.content-pill--${tokenType}`\n    ) as HTMLElement;\n    if (existingPill) {\n      const pillStyles = window.getComputedStyle(existingPill);\n      element.style.padding = pillStyles.padding;\n      element.style.margin = pillStyles.margin;\n      element.style.border = pillStyles.border;\n      element.style.borderRadius = pillStyles.borderRadius;\n      element.style.backgroundColor = pillStyles.backgroundColor;\n      element.style.color = pillStyles.color;\n      element.style.display = pillStyles.display;\n      element.style.alignItems = pillStyles.alignItems;\n      element.style.boxSizing = pillStyles.boxSizing;\n    }\n  }\n\n  /**\n   * Generate cache key for measurements\n   */\n  private getCacheKey(\n    token: RichContentToken,\n    context: MeasurementContext\n  ): string {\n    const baseKey = `${token.type}-${token.start}-${token.end}-${token.rawText.length}`;\n    const modeKey = context.isEditMode ? 'edit' : 'normal';\n    return `${baseKey}-${modeKey}`;\n  }\n\n  /**\n   * Ensure measurement container exists\n   */\n  private ensureMeasurementContainer(): void {\n    // Only create measurement container on client side\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      return;\n    }\n\n    if (!this.measurementContainer) {\n      this.measurementContainer = document.createElement('div');\n      this.measurementContainer.style.position = 'absolute';\n      this.measurementContainer.style.top = '-9999px';\n      this.measurementContainer.style.left = '-9999px';\n      this.measurementContainer.style.visibility = 'hidden';\n      this.measurementContainer.style.pointerEvents = 'none';\n      this.measurementContainer.style.zIndex = '-1';\n      document.body.appendChild(this.measurementContainer);\n    }\n  }\n\n  /**\n   * Clear measurement cache\n   */\n  clearCache(): void {\n    this.cachedMeasurements.clear();\n  }\n\n  /**\n   * Clean up measurement container\n   */\n  destroy(): void {\n    if (this.measurementContainer && this.measurementContainer.parentNode) {\n      this.measurementContainer.parentNode.removeChild(\n        this.measurementContainer\n      );\n    }\n    this.measurementContainer = null;\n    this.clearCache();\n  }\n}\n\n// Singleton instance\nexport const widthMeasurement = new WidthMeasurementUtility();\n",
    "language":"typescript",
    "lines":294,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/core/RichInputEngine.ts":{
    "content":"/**\n * Core engine for the rich input system\n * Handles state management, text operations, and parsing\n */\n\nimport { ContentParser } from '../../utils/content-parsers';\nimport { RichTextParser } from '../../utils/parsers/rich-text-parser';\nimport type {\n  RichContentParser,\n  RichContentToken,\n  RichInputAPI,\n  RichInputConfig,\n  RichInputHistoryEntry,\n  RichInputPosition,\n  RichInputRange,\n  RichInputSelection,\n  RichInputState\n} from '../types';\nimport { logParsing, richTextLogger } from '../utils/logger';\nimport { navigateDownLine, navigateUpLine } from '../utils/navigationUtils';\n\nexport class RichInputEngine implements RichInputAPI {\n  private state: RichInputState;\n  private config: RichInputConfig;\n  private parsers: Map<string, RichContentParser>;\n  private richTextParser: RichTextParser;\n  private stateChangeCallbacks: Set<(state: RichInputState) => void>;\n\n  constructor(config: RichInputConfig = {}) {\n    this.config = config;\n    this.parsers = new Map();\n    this.stateChangeCallbacks = new Set();\n\n    // Set up logger context\n    if (config.styling?.className) {\n      richTextLogger.setContext(config.styling.className);\n    }\n\n    // Initialize rich text parser\n    this.richTextParser = new RichTextParser({\n      enableHashtags: config.parsers?.hashtags !== false,\n      enableMentions: config.parsers?.mentions !== false,\n      enableUrls: config.parsers?.urls !== false,\n      enableEmojis: config.parsers?.emojis !== false,\n      enableImages: config.parsers?.images !== false,\n      enableMarkdown: config.parsers?.markdown !== false\n    });\n\n    // Load emojis from API if emoji parsing is enabled\n    if (config.parsers?.emojis !== false) {\n      // Load emojis asynchronously to avoid blocking initialization\n      this.loadEmojisFromAPI().catch((error) => {\n        richTextLogger.logWarning('Failed to initialize emoji loading:', error);\n      });\n    }\n\n    // Initialize state\n    this.state = {\n      rawText: '',\n      tokens: [],\n      selection: {\n        start: { index: 0 },\n        end: { index: 0 },\n        direction: 'none'\n      },\n      cursorPosition: { index: 0 },\n      isMultiline: config.multiline || false,\n      isFocused: false,\n      history: [],\n      historyIndex: -1\n    };\n\n    // Register built-in parsers\n    this.registerBuiltInParsers();\n\n    // Register custom parsers\n    if (config.parsers?.custom) {\n      config.parsers.custom.forEach((parser) => this.addParser(parser));\n    }\n  }\n\n  // State management\n  getState(): RichInputState {\n    return { ...this.state };\n  }\n\n  setState(newState: Partial<RichInputState>): void {\n    const oldState = { ...this.state };\n    this.state = { ...this.state, ...newState };\n\n    // Reparse if text changed\n    if (\n      newState.rawText !== undefined &&\n      newState.rawText !== oldState.rawText\n    ) {\n      this.reparse();\n    }\n\n    this.notifyStateChange();\n  }\n\n  // Text operations\n  insertText(text: string, position?: RichInputPosition): void {\n    const insertPos = position || this.state.cursorPosition;\n    const { rawText } = this.state;\n\n    // If we're inserting into an empty input (with dummy token), replace entirely\n    if (\n      rawText.length === 0 &&\n      this.state.tokens.length === 1 &&\n      this.state.tokens[0].metadata?.isDummy\n    ) {\n      const newCursorPos = { index: text.length };\n\n      this.saveHistoryEntry();\n      this.setState({\n        rawText: text,\n        cursorPosition: newCursorPos,\n        selection: {\n          start: newCursorPos,\n          end: newCursorPos,\n          direction: 'none'\n        }\n      });\n      return;\n    }\n\n    const newText =\n      rawText.slice(0, insertPos.index) + text + rawText.slice(insertPos.index);\n    const newCursorPos = { index: insertPos.index + text.length };\n\n    this.saveHistoryEntry();\n    this.setState({\n      rawText: newText,\n      cursorPosition: newCursorPos,\n      selection: {\n        start: newCursorPos,\n        end: newCursorPos,\n        direction: 'none'\n      }\n    });\n  }\n\n  deleteText(range: RichInputRange): void {\n    const { rawText } = this.state;\n    const newText = rawText.slice(0, range.start) + rawText.slice(range.end);\n    const newCursorPos = { index: range.start };\n\n    this.saveHistoryEntry();\n    this.setState({\n      rawText: newText,\n      cursorPosition: newCursorPos,\n      selection: {\n        start: newCursorPos,\n        end: newCursorPos,\n        direction: 'none'\n      }\n    });\n  }\n\n  replaceText(range: RichInputRange, newText: string): void {\n    const { rawText } = this.state;\n    const updatedText =\n      rawText.slice(0, range.start) + newText + rawText.slice(range.end);\n    const newCursorPos = { index: range.start + newText.length };\n\n    this.saveHistoryEntry();\n    this.setState({\n      rawText: updatedText,\n      cursorPosition: newCursorPos,\n      selection: {\n        start: newCursorPos,\n        end: newCursorPos,\n        direction: 'none'\n      }\n    });\n  }\n\n  // Selection operations\n  setSelection(selection: RichInputSelection): void {\n    // Apply pill-aware snapping to both start and end positions\n    const snappedStart = this.snapCursorToPillBoundary(selection.start);\n    const snappedEnd = this.snapCursorToPillBoundary(selection.end);\n\n    let finalSelection: RichInputSelection = {\n      start: snappedStart,\n      end: snappedEnd,\n      direction: selection.direction\n    };\n\n    // Smart selection: expand to token boundaries if enabled\n    if (this.config.behavior?.smartSelection) {\n      finalSelection = this.expandSelectionToTokens(finalSelection);\n    }\n\n    this.setState({\n      selection: finalSelection,\n      cursorPosition: finalSelection.end\n    });\n  }\n\n  selectAll(): void {\n    this.setSelection({\n      start: { index: 0 },\n      end: { index: this.state.rawText.length },\n      direction: 'forward'\n    });\n  }\n\n  selectToken(token: RichContentToken): void {\n    this.setSelection({\n      start: { index: token.start },\n      end: { index: token.end },\n      direction: 'forward'\n    });\n  }\n\n  getSelectedText(): string {\n    const { selection, rawText } = this.state;\n    return rawText.slice(selection.start.index, selection.end.index);\n  }\n\n  // Cursor operations\n  setCursor(position: RichInputPosition): void {\n    // Snap cursor to pill boundaries\n    const snappedPosition = this.snapCursorToPillBoundary(position);\n\n    // Set cursor directly without triggering smart selection\n    this.setState({\n      cursorPosition: snappedPosition,\n      selection: {\n        start: snappedPosition,\n        end: snappedPosition,\n        direction: 'none'\n      }\n    });\n  }\n\n  moveCursor(\n    direction: 'left' | 'right' | 'up' | 'down',\n    extend: boolean = false\n  ): void {\n    const { cursorPosition, selection, rawText, isMultiline } = this.state;\n    let newPosition = { ...cursorPosition };\n\n    switch (direction) {\n      case 'left':\n        newPosition = this.moveCursorLeftWithPillAwareness(cursorPosition);\n        break;\n      case 'right':\n        newPosition = this.moveCursorRightWithPillAwareness(cursorPosition);\n        break;\n      case 'up':\n        if (isMultiline) {\n          newPosition = this.moveCursorVertically(cursorPosition, -1);\n          newPosition = this.snapCursorToPillBoundary(newPosition);\n        }\n        break;\n      case 'down':\n        if (isMultiline) {\n          newPosition = this.moveCursorVertically(cursorPosition, 1);\n          newPosition = this.snapCursorToPillBoundary(newPosition);\n        }\n        break;\n    }\n\n    if (extend) {\n      this.setSelection({\n        start: selection.start,\n        end: newPosition,\n        direction:\n          newPosition.index > selection.start.index ? 'forward' : 'backward'\n      });\n    } else {\n      this.setCursor(newPosition);\n    }\n  }\n\n  // History operations\n  undo(): void {\n    if (this.state.historyIndex > 0) {\n      const historyEntry = this.state.history[this.state.historyIndex - 1];\n      this.setState({\n        rawText: historyEntry.rawText,\n        selection: historyEntry.selection,\n        cursorPosition: historyEntry.selection.end,\n        historyIndex: this.state.historyIndex - 1\n      });\n    }\n  }\n\n  redo(): void {\n    if (this.state.historyIndex < this.state.history.length - 1) {\n      const historyEntry = this.state.history[this.state.historyIndex + 1];\n      this.setState({\n        rawText: historyEntry.rawText,\n        selection: historyEntry.selection,\n        cursorPosition: historyEntry.selection.end,\n        historyIndex: this.state.historyIndex + 1\n      });\n    }\n  }\n\n  saveHistoryEntry(): void {\n    const entry: RichInputHistoryEntry = {\n      rawText: this.state.rawText,\n      selection: this.state.selection,\n      timestamp: Date.now()\n    };\n\n    // Don't save duplicate entries\n    const lastEntry = this.state.history[this.state.history.length - 1];\n    if (lastEntry && lastEntry.rawText === entry.rawText) {\n      return;\n    }\n\n    // Remove any future history if we're not at the end\n    const newHistory = this.state.history.slice(0, this.state.historyIndex + 1);\n    newHistory.push(entry);\n\n    // Limit history size\n    if (newHistory.length > 100) {\n      newHistory.shift();\n    }\n\n    this.setState({\n      history: newHistory,\n      historyIndex: newHistory.length - 1\n    });\n  }\n\n  // Parser operations\n  reparse(): void {\n    const tokens = this.parseText(this.state.rawText);\n\n    // Log parsing results for debugging\n    const segments = ContentParser.parse(this.state.rawText);\n    logParsing(this.state.rawText, segments, tokens);\n\n    this.setState({ tokens });\n  }\n\n  addParser(parser: RichContentParser): void {\n    this.parsers.set(parser.name, parser);\n    this.reparse();\n  }\n\n  removeParser(name: string): void {\n    this.parsers.delete(name);\n    this.reparse();\n  }\n\n  // Utility operations\n  focus(): void {\n    this.setState({ isFocused: true });\n  }\n\n  blur(): void {\n    this.setState({ isFocused: false });\n  }\n\n  clear(): void {\n    this.saveHistoryEntry();\n    this.setState({\n      rawText: '',\n      tokens: [],\n      cursorPosition: { index: 0 },\n      selection: {\n        start: { index: 0 },\n        end: { index: 0 },\n        direction: 'none'\n      }\n    });\n  }\n\n  isEmpty(): boolean {\n    return this.state.rawText.length === 0;\n  }\n\n  // Event subscription\n  onStateChange(callback: (state: RichInputState) => void): () => void {\n    this.stateChangeCallbacks.add(callback);\n    return () => this.stateChangeCallbacks.delete(callback);\n  }\n\n  // Private methods\n  private parseText(text: string): RichContentToken[] {\n    const tokens: RichContentToken[] = [];\n\n    // If text is empty, create a dummy token for cursor positioning\n    if (text.length === 0) {\n      tokens.push({\n        type: 'text',\n        content: '',\n        rawText: '',\n        start: 0,\n        end: 0,\n        metadata: {\n          isWhitespace: false,\n          isNewline: false,\n          hasNewlines: false,\n          isDummy: true // Mark as dummy token for special handling\n        }\n      });\n      return tokens;\n    }\n\n    // Use the rich text parser to get all tokens including emojis\n    const richTextTokens = this.richTextParser.parse(text);\n\n    // Convert RichTextTokens to RichContentTokens\n    for (const richToken of richTextTokens) {\n      if (richToken.type === 'text') {\n        // For text tokens, split on newlines to create separate tokens\n        const textValue = richToken.content;\n        const segmentStart = richToken.start;\n\n        if (textValue.includes('\\\\n')) {\n          // For text with newlines, create line-aware tokens for better cursor positioning\n          this.createLineAwareTokens(textValue, segmentStart, tokens);\n        } else {\n          // For text segments without newlines, create single tokens that preserve whitespace\n          tokens.push({\n            type: 'text',\n            content: textValue,\n            rawText: textValue,\n            start: segmentStart,\n            end: richToken.end,\n            metadata: {\n              isWhitespace: /^\\\\s+$/.test(textValue),\n              isNewline: false,\n              hasNewlines: false\n            }\n          });\n        }\n      } else {\n        // Convert rich text token to rich content token\n        const richContentToken: RichContentToken = {\n          type: richToken.type as any,\n          content: richToken.content,\n          rawText: richToken.rawText,\n          start: richToken.start,\n          end: richToken.end,\n          metadata: {}\n        };\n\n        // Add type-specific metadata\n        switch (richToken.type) {\n          case 'hashtag':\n            richContentToken.metadata!.hashtag = richToken.content;\n            break;\n          case 'mention':\n            richContentToken.metadata!.userId = richToken.userId;\n            richContentToken.metadata!.username = richToken.displayName;\n            richContentToken.metadata!.displayName = richToken.displayName;\n            richContentToken.metadata!.filterType = richToken.filterType as any;\n            break;\n          case 'url':\n            richContentToken.metadata!.href = richToken.href;\n            richContentToken.metadata!.behavior = richToken.behavior as any;\n            richContentToken.metadata!.originalFormat = richToken.rawText;\n            break;\n          case 'emoji':\n            richContentToken.metadata!.emojiId = richToken.emojiId;\n            richContentToken.metadata!.emojiUnicode = richToken.emojiUnicode;\n            richContentToken.metadata!.emojiImageUrl = richToken.emojiImageUrl;\n            break;\n          case 'markdown':\n            richContentToken.metadata!.markdownType = richToken.markdownType;\n            richContentToken.metadata!.href = richToken.href;\n            break;\n          case 'image':\n            richContentToken.metadata!.imageSrc = richToken.imageSrc;\n            richContentToken.metadata!.imageAlt = richToken.imageAlt;\n            richContentToken.metadata!.imageTitle = richToken.imageTitle;\n            break;\n        }\n\n        // Set common metadata\n        richContentToken.metadata!.isWhitespace = false;\n        richContentToken.metadata!.isNewline = false;\n        richContentToken.metadata!.hasNewlines = false;\n\n        tokens.push(richContentToken);\n      }\n    }\n\n    // Apply custom parsers (if any)\n    const customTokens: RichContentToken[] = [];\n    const sortedParsers = Array.from(this.parsers.values()).sort(\n      (a, b) => b.priority - a.priority\n    );\n\n    for (const parser of sortedParsers) {\n      const parserTokens = parser.parse(text);\n      customTokens.push(...parserTokens);\n    }\n\n    // Merge and sort all tokens by start position\n    const allTokens = [...tokens, ...customTokens];\n    return allTokens.sort((a, b) => a.start - b.start);\n  }\n\n  private expandSelectionToTokens(\n    selection: RichInputSelection\n  ): RichInputSelection {\n    const { tokens } = this.state;\n    let expandedStart = selection.start;\n    let expandedEnd = selection.end;\n\n    // Get selection bounds\n    const selectionStart = Math.min(selection.start.index, selection.end.index);\n    const selectionEnd = Math.max(selection.start.index, selection.end.index);\n\n    // If this is a zero-length selection (cursor position), don't expand\n    if (selectionStart === selectionEnd) {\n      return selection;\n    }\n\n    // Find all tokens that are COMPLETELY intersected by the selection\n    for (const token of tokens) {\n      if (token.type === 'text') continue;\n\n      // Only expand if the selection significantly overlaps with the pill\n      // This prevents accidental expansion when clicking near pills\n      const overlapStart = Math.max(selectionStart, token.start);\n      const overlapEnd = Math.min(selectionEnd, token.end);\n      const overlapLength = Math.max(0, overlapEnd - overlapStart);\n      const tokenLength = token.end - token.start;\n      const overlapPercentage = overlapLength / tokenLength;\n\n      // Only expand if more than 50% of the pill is selected\n      if (overlapPercentage > 0.5) {\n        // Expand selection to include entire token\n        if (token.start < expandedStart.index) {\n          expandedStart = {\n            index: token.start,\n            line: expandedStart.line,\n            column: expandedStart.column\n          };\n        }\n        if (token.end > expandedEnd.index) {\n          expandedEnd = {\n            index: token.end,\n            line: expandedEnd.line,\n            column: expandedEnd.column\n          };\n        }\n      }\n    }\n\n    return {\n      start: expandedStart,\n      end: expandedEnd,\n      direction: selection.direction\n    };\n  }\n\n  private moveCursorVertically(\n    position: RichInputPosition,\n    direction: number\n  ): RichInputPosition {\n    const { rawText } = this.state;\n\n    // Use the enhanced navigation utilities that handle edge cases\n    if (direction < 0) {\n      // Moving up - use navigateUpLine which handles first line edge case\n      return navigateUpLine(position, rawText);\n    } else {\n      // Moving down - use navigateDownLine which handles last line edge case\n      return navigateDownLine(position, rawText);\n    }\n  }\n\n  private registerBuiltInParsers(): void {\n    // Parsers are handled by the ContentParser and RichTextParser\n    // Custom parsers can be added via the config\n  }\n\n  private notifyStateChange(): void {\n    this.stateChangeCallbacks.forEach((callback) => callback(this.state));\n  }\n\n  /**\n   * Snaps cursor position to pill and newline boundaries\n   * If cursor is inside a pill or newline, moves it to the closest boundary\n   */\n  private snapCursorToPillBoundary(\n    position: RichInputPosition\n  ): RichInputPosition {\n    const { tokens } = this.state;\n\n    // Find if cursor is inside a pill or newline token (not at boundaries)\n    const atomicToken = tokens.find(\n      (token) =>\n        (token.type !== 'text' || token.metadata?.isNewline) &&\n        position.index > token.start &&\n        position.index < token.end\n    );\n\n    if (atomicToken) {\n      // Cursor is inside a pill or newline - snap to closest boundary\n      const distanceToStart = position.index - atomicToken.start;\n      const distanceToEnd = atomicToken.end - position.index;\n\n      // Snap to the closest boundary\n      const snapToStart = distanceToStart <= distanceToEnd;\n      return {\n        index: snapToStart ? atomicToken.start : atomicToken.end,\n        line: position.line,\n        column: position.column\n      };\n    }\n\n    // Check if cursor is exactly at a pill or newline boundary - don't snap\n    const atAtomicBoundary = tokens.some(\n      (token) =>\n        (token.type !== 'text' || token.metadata?.isNewline) &&\n        (position.index === token.start || position.index === token.end)\n    );\n\n    if (atAtomicBoundary) {\n      // Cursor is exactly at a pill or newline boundary, keep it there\n      return position;\n    }\n\n    // Cursor is not inside or at a pill/newline boundary, return as-is\n    return position;\n  }\n\n  /**\n   * Moves cursor left with pill and newline awareness\n   * Skips over entire pills and newlines instead of moving character by character\n   */\n  private moveCursorLeftWithPillAwareness(\n    position: RichInputPosition\n  ): RichInputPosition {\n    const { tokens } = this.state;\n\n    // Find the token that ends at current position (pill or newline)\n    const tokenAtCursor = tokens.find(\n      (token) =>\n        (token.type !== 'text' || token.metadata?.isNewline) &&\n        token.end === position.index\n    );\n\n    if (tokenAtCursor) {\n      // If we're at the end of a pill or newline, jump to its start\n      return {\n        index: tokenAtCursor.start,\n        line: position.line,\n        column: position.column\n      };\n    }\n\n    // Find the token that would be to the left (pill or newline)\n    const newIndex = Math.max(0, position.index - 1);\n    const tokenToLeft = tokens.find(\n      (token) =>\n        (token.type !== 'text' || token.metadata?.isNewline) &&\n        newIndex > token.start &&\n        newIndex <= token.end\n    );\n\n    if (tokenToLeft) {\n      // If moving left would put us inside a pill or newline, jump to its start\n      return {\n        index: tokenToLeft.start,\n        line: position.line,\n        column: position.column\n      };\n    }\n\n    // Normal left movement\n    return {\n      index: newIndex,\n      line: position.line,\n      column: position.column\n    };\n  }\n\n  /**\n   * Moves cursor right with pill and newline awareness\n   * Skips over entire pills and newlines instead of moving character by character\n   */\n  private moveCursorRightWithPillAwareness(\n    position: RichInputPosition\n  ): RichInputPosition {\n    const { tokens, rawText } = this.state;\n\n    // Find the token that starts at current position (pill or newline)\n    const tokenAtCursor = tokens.find(\n      (token) =>\n        (token.type !== 'text' || token.metadata?.isNewline) &&\n        token.start === position.index\n    );\n\n    if (tokenAtCursor) {\n      // If we're at the start of a pill or newline, jump to its end\n      return {\n        index: tokenAtCursor.end,\n        line: position.line,\n        column: position.column\n      };\n    }\n\n    // Find the token that would be to the right (pill or newline)\n    const newIndex = Math.min(rawText.length, position.index + 1);\n    const tokenToRight = tokens.find(\n      (token) =>\n        (token.type !== 'text' || token.metadata?.isNewline) &&\n        newIndex >= token.start &&\n        newIndex < token.end\n    );\n\n    if (tokenToRight) {\n      // If moving right would put us inside a pill or newline, jump to its end\n      return {\n        index: tokenToRight.end,\n        line: position.line,\n        column: position.column\n      };\n    }\n\n    // Normal right movement\n    return {\n      index: newIndex,\n      line: position.line,\n      column: position.column\n    };\n  }\n\n  /**\n   * Create line-aware tokens for multiline text content\n   * This improves cursor positioning accuracy by creating separate tokens for each line\n   */\n  private createLineAwareTokens(\n    textValue: string,\n    segmentStart: number,\n    tokens: RichContentToken[]\n  ): void {\n    const lines = textValue.split('\\\\n');\n    let currentOffset = segmentStart;\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      const isLastLine = i === lines.length - 1;\n\n      // Create a token for the line content (if not empty)\n      if (line.length > 0) {\n        tokens.push({\n          type: 'text',\n          content: line,\n          rawText: line,\n          start: currentOffset,\n          end: currentOffset + line.length,\n          metadata: {\n            isWhitespace: /^\\\\s+$/.test(line),\n            isNewline: false,\n            hasNewlines: false,\n            customData: {\n              lineIndex: i,\n              isLineStart: true,\n              isLineEnd: !isLastLine // Not line end if there's a newline after\n            }\n          }\n        });\n      }\n\n      currentOffset += line.length;\n\n      // Create a newline token (except after the last line)\n      if (!isLastLine) {\n        tokens.push({\n          type: 'text',\n          content: '\\\\n',\n          rawText: '\\\\n',\n          start: currentOffset,\n          end: currentOffset + 1,\n          metadata: {\n            isWhitespace: true,\n            isNewline: true,\n            hasNewlines: false,\n            customData: {\n              lineIndex: i,\n              isLineStart: false,\n              isLineEnd: true\n            }\n          }\n        });\n        currentOffset += 1; // Move past the newline character\n      }\n    }\n  }\n\n  private async loadEmojisFromAPI(): Promise<void> {\n    // Only load emojis in browser environment\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    try {\n      // Fetch emojis from the API\n      const response = await fetch(\n        '/api/emojis?per_page=1000&include_custom=true'\n      );\n      if (!response.ok) {\n        throw new Error('Failed to load emojis from API');\n      }\n\n      const data = await response.json();\n\n      // Convert API emoji data to EmojiDefinition format and add to parser\n      const apiEmojis = data.emojis.map((emoji: any) => ({\n        id: emoji.emoji_id, // Use emoji_id as the primary ID (e.g., \\\"beaming_face_with_smiling_eyes\\\")\n        name: emoji.emoji_id, // Use emoji_id as name for consistency\n        imageUrl: emoji.custom_image_url,\n        unicode: emoji.unicode_char,\n        category: emoji.category.name,\n        tags: emoji.tags || [],\n        aliases: [\n          emoji.emoji_id, // Primary alias: \\\"beaming_face_with_smiling_eyes\\\"\n          ...(emoji.aliases || []), // Existing aliases from API\n          ...(emoji.name ? [emoji.name.toLowerCase().replace(/\\\\s+/g, '_')] : []) // Convert human name to underscore format\n        ]\n      }));\n\n      // Add emojis to the rich text parser using the public API\n      for (const emoji of apiEmojis) {\n        this.richTextParser.addCustomEmoji(emoji);\n      }\n\n      richTextLogger.logInfo(`Loaded ${apiEmojis.length} emojis from API`);\n    } catch (error) {\n      richTextLogger.logWarning('Failed to load emojis from API:', error);\n      // Continue with built-in emojis if API fails\n    }\n  }\n}\n",
    "language":"typescript",
    "lines":840,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/hooks/useRichInput.ts":{
    "content":"/**\n * React hook for easier rich input usage\n * Provides a simple API for working with rich inputs\n */\n\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport type { RichInputRef } from '../components/RichInput';\nimport type { RichInputConfig, RichInputState } from '../types';\n\nexport interface UseRichInputOptions extends RichInputConfig {\n  initialValue?: string;\n  onChange?: (value: string) => void;\n  onStateChange?: (state: RichInputState) => void;\n}\n\nexport interface UseRichInputReturn {\n  value: string;\n  state: RichInputState | null;\n  ref: React.RefObject<RichInputRef>;\n\n  // Convenience methods\n  setValue: (value: string) => void;\n  insertText: (text: string) => void;\n  clear: () => void;\n  focus: () => void;\n  blur: () => void;\n  undo: () => void;\n  redo: () => void;\n  selectAll: () => void;\n\n  // State queries\n  isEmpty: boolean;\n  isFocused: boolean;\n  hasSelection: boolean;\n  selectedText: string;\n}\n\nexport function useRichInput(\n  options: UseRichInputOptions = {}\n): UseRichInputReturn {\n  const ref = useRef<RichInputRef>(null);\n  const [value, setValue] = useState(options.initialValue || '');\n  const [state, setState] = useState<RichInputState | null>(null);\n\n  // Ensure initial value is set\n  useEffect(() => {\n    if (options.initialValue && ref.current) {\n      ref.current.setState({ rawText: options.initialValue });\n    }\n  }, [options.initialValue]);\n\n  // Handle value changes\n  const handleChange = useCallback(\n    (newValue: string) => {\n      setValue(newValue);\n      options.onChange?.(newValue);\n    },\n    [options]\n  );\n\n  // Handle state changes\n  const handleStateChange = useCallback(\n    (newState: RichInputState) => {\n      setState(newState);\n      options.onStateChange?.(newState);\n    },\n    [options]\n  );\n\n  // Convenience methods\n  const setValueMethod = useCallback((newValue: string) => {\n    ref.current?.setState({ rawText: newValue });\n  }, []);\n\n  const insertText = useCallback((text: string) => {\n    ref.current?.insertText(text);\n  }, []);\n\n  const clear = useCallback(() => {\n    ref.current?.clear();\n  }, []);\n\n  const focus = useCallback(() => {\n    ref.current?.focus();\n  }, []);\n\n  const blur = useCallback(() => {\n    ref.current?.blur();\n  }, []);\n\n  const undo = useCallback(() => {\n    ref.current?.undo();\n  }, []);\n\n  const redo = useCallback(() => {\n    ref.current?.redo();\n  }, []);\n\n  const selectAll = useCallback(() => {\n    ref.current?.selectAll();\n  }, []);\n\n  // Computed properties\n  const isEmpty = state ? state.rawText.length === 0 : true;\n  const isFocused = state?.isFocused ?? false;\n  const hasSelection = state\n    ? state.selection.start.index !== state.selection.end.index\n    : false;\n  const selectedText = state\n    ? state.rawText.slice(\n        Math.min(state.selection.start.index, state.selection.end.index),\n        Math.max(state.selection.start.index, state.selection.end.index)\n      )\n    : '';\n\n  return {\n    value,\n    state,\n    ref,\n    setValue: setValueMethod,\n    insertText,\n    clear,\n    focus,\n    blur,\n    undo,\n    redo,\n    selectAll,\n    isEmpty,\n    isFocused,\n    hasSelection,\n    selectedText\n  };\n}\n",
    "language":"typescript",
    "lines":134,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/hooks/useKeyboardHandlers.ts":{
    "content":"import { useCallback } from 'react';\nimport type { RichInputEngine } from '../core/RichInputEngine';\nimport type {\n  RichInputConfig,\n  RichInputEventHandlers,\n  RichInputState\n} from '../types';\nimport {\n  findLastTextPosition,\n  getWordBoundaries\n} from '../utils/navigationUtils';\n\nexport function useKeyboardHandlers(\n  engine: RichInputEngine,\n  state: RichInputState,\n  config: RichInputConfig,\n  handlers: RichInputEventHandlers,\n  containerRef: React.RefObject<HTMLDivElement>\n) {\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      // Allow custom handlers to override default behavior\n      const customResult = handlers.onKeyDown?.(e.nativeEvent, state);\n      if (customResult === false) {\n        e.preventDefault();\n        return;\n      }\n\n      const { key, ctrlKey, metaKey, shiftKey, altKey } = e;\n      const cmdKey = ctrlKey || metaKey;\n\n      switch (key) {\n        case 'ArrowLeft':\n          e.preventDefault();\n          if (cmdKey || altKey) {\n            // Move to previous word using enhanced word boundaries\n            const { previousWord } = getWordBoundaries(\n              state.cursorPosition,\n              state.rawText\n            );\n            engine.setCursor({ index: previousWord });\n          } else {\n            engine.moveCursor('left', shiftKey);\n          }\n          break;\n\n        case 'ArrowRight':\n          e.preventDefault();\n          if (cmdKey || altKey) {\n            // Move to next word using enhanced word boundaries\n            const { nextWord } = getWordBoundaries(\n              state.cursorPosition,\n              state.rawText\n            );\n            engine.setCursor({ index: nextWord });\n          } else {\n            engine.moveCursor('right', shiftKey);\n          }\n          break;\n\n        case 'ArrowUp':\n          e.preventDefault();\n          engine.moveCursor('up', shiftKey);\n          break;\n\n        case 'ArrowDown':\n          e.preventDefault();\n          engine.moveCursor('down', shiftKey);\n          break;\n\n        case 'Home':\n          e.preventDefault();\n          if (cmdKey) {\n            // Move to beginning of document\n            engine.setCursor({ index: 0 });\n          } else {\n            // Move to beginning of line\n            const lineStart = getLineStart(state.cursorPosition, state.rawText);\n            engine.setCursor({ index: lineStart });\n          }\n          break;\n\n        case 'End':\n          e.preventDefault();\n          if (cmdKey) {\n            // Move to end of document (after last text or atomic group)\n            const lastTextPosition = findLastTextPosition(state.rawText);\n            engine.setCursor({ index: lastTextPosition });\n          } else {\n            // Move to end of line\n            const lineEnd = getLineEnd(state.cursorPosition, state.rawText);\n            engine.setCursor({ index: lineEnd });\n          }\n          break;\n\n        case 'Backspace':\n          e.preventDefault();\n          if (cmdKey || altKey) {\n            // Delete previous word\n            const { currentWordStart } = getWordBoundaries(\n              state.cursorPosition,\n              state.rawText\n            );\n            engine.deleteText({\n              start: currentWordStart,\n              end: state.cursorPosition.index\n            });\n          } else if (\n            state.selection.start.index !== state.selection.end.index\n          ) {\n            // Delete selection\n            engine.deleteText({\n              start: Math.min(\n                state.selection.start.index,\n                state.selection.end.index\n              ),\n              end: Math.max(\n                state.selection.start.index,\n                state.selection.end.index\n              )\n            });\n          } else if (state.cursorPosition.index > 0) {\n            // Check if we're at the end of an atomic token (pill or newline)\n            const atomicTokenBeforeCursor = findAtomicTokenAt(\n              state.tokens,\n              state.cursorPosition.index - 1\n            );\n\n            if (\n              atomicTokenBeforeCursor &&\n              atomicTokenBeforeCursor.end === state.cursorPosition.index\n            ) {\n              // Delete entire atomic token\n              engine.deleteText({\n                start: atomicTokenBeforeCursor.start,\n                end: atomicTokenBeforeCursor.end\n              });\n            } else {\n              // Delete single character\n              engine.deleteText({\n                start: state.cursorPosition.index - 1,\n                end: state.cursorPosition.index\n              });\n            }\n          }\n          break;\n\n        case 'Delete':\n          e.preventDefault();\n          if (cmdKey || altKey) {\n            // Delete next word\n            const { currentWordEnd } = getWordBoundaries(\n              state.cursorPosition,\n              state.rawText\n            );\n            engine.deleteText({\n              start: state.cursorPosition.index,\n              end: currentWordEnd\n            });\n          } else if (\n            state.selection.start.index !== state.selection.end.index\n          ) {\n            // Delete selection\n            engine.deleteText({\n              start: Math.min(\n                state.selection.start.index,\n                state.selection.end.index\n              ),\n              end: Math.max(\n                state.selection.start.index,\n                state.selection.end.index\n              )\n            });\n          } else if (state.cursorPosition.index < state.rawText.length) {\n            // Check if we're at the start of an atomic token (pill or newline)\n            const atomicTokenAtCursor = findAtomicTokenAt(\n              state.tokens,\n              state.cursorPosition.index\n            );\n\n            if (\n              atomicTokenAtCursor &&\n              atomicTokenAtCursor.start === state.cursorPosition.index\n            ) {\n              // Delete entire atomic token\n              engine.deleteText({\n                start: atomicTokenAtCursor.start,\n                end: atomicTokenAtCursor.end\n              });\n            } else {\n              // Delete single character\n              engine.deleteText({\n                start: state.cursorPosition.index,\n                end: state.cursorPosition.index + 1\n              });\n            }\n          }\n          break;\n\n        case 'Enter':\n          if (!config.multiline) {\n            // Single-line mode - prevent default and don't insert\n            e.preventDefault();\n            return;\n          }\n          e.preventDefault();\n          engine.insertText('\\\\n');\n          break;\n\n        case 'Tab': {\n          e.preventDefault();\n          // Insert tab or spaces based on config\n          const tabString = config.behavior?.tabSize\n            ? ' '.repeat(config.behavior.tabSize)\n            : '\\\\t';\n          engine.insertText(tabString);\n          break;\n        }\n\n        default:\n          // Handle keyboard shortcuts first\n          if (cmdKey) {\n            switch (key) {\n              case 'a':\n                e.preventDefault();\n                engine.selectAll();\n                break;\n              case 'z':\n                if (!shiftKey) {\n                  e.preventDefault();\n                  engine.undo();\n                } else {\n                  e.preventDefault();\n                  engine.redo();\n                }\n                break;\n              case 'y':\n                e.preventDefault();\n                engine.redo();\n                break;\n            }\n          } else if (!altKey && key.length === 1) {\n            // Handle regular character input (including a, z, y when not Cmd+key)\n            e.preventDefault();\n\n            // If there's a selection, replace it\n            if (state.selection.start.index !== state.selection.end.index) {\n              engine.replaceText(\n                {\n                  start: Math.min(\n                    state.selection.start.index,\n                    state.selection.end.index\n                  ),\n                  end: Math.max(\n                    state.selection.start.index,\n                    state.selection.end.index\n                  )\n                },\n                key\n              );\n            } else {\n              engine.insertText(key);\n            }\n          }\n          break;\n      }\n    },\n    [engine, state, config, handlers]\n  );\n\n  const handlePaste = useCallback(\n    (e: React.ClipboardEvent) => {\n      const customResult = handlers.onPaste?.(e.nativeEvent, state);\n      if (customResult === false) {\n        e.preventDefault();\n        return;\n      }\n\n      e.preventDefault();\n      const pastedText = e.clipboardData.getData('text/plain');\n\n      if (pastedText) {\n        // If there's a selection, replace it\n        if (state.selection.start.index !== state.selection.end.index) {\n          engine.replaceText(\n            {\n              start: Math.min(\n                state.selection.start.index,\n                state.selection.end.index\n              ),\n              end: Math.max(\n                state.selection.start.index,\n                state.selection.end.index\n              )\n            },\n            pastedText\n          );\n        } else {\n          engine.insertText(pastedText);\n        }\n      }\n    },\n    [engine, state, handlers]\n  );\n\n  return {\n    handleKeyDown,\n    handlePaste\n  };\n}\n\n// Helper functions for line navigation\nfunction getLineStart(position: { index: number }, text: string): number {\n  const beforeCursor = text.slice(0, position.index);\n  const lastNewlineIndex = beforeCursor.lastIndexOf('\\\\n');\n  return lastNewlineIndex === -1 ? 0 : lastNewlineIndex + 1;\n}\n\nfunction getLineEnd(position: { index: number }, text: string): number {\n  const afterCursor = text.slice(position.index);\n  const nextNewlineIndex = afterCursor.indexOf('\\\\n');\n  return nextNewlineIndex === -1\n    ? text.length\n    : position.index + nextNewlineIndex;\n}\n\n// Helper function to find atomic tokens (pills and newlines) at a position\nfunction findAtomicTokenAt(tokens: any[], position: number): any | null {\n  return (\n    tokens.find(\n      (token) =>\n        (token.type !== 'text' || token.metadata?.isNewline) &&\n        position >= token.start &&\n        position < token.end\n    ) || null\n  );\n}\n",
    "language":"typescript",
    "lines":338,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/rich-input/hooks/useMouseHandlers.ts":{
    "content":"import { useCallback } from 'react';\nimport { ContentParser } from '../../utils/content-parsers';\nimport type { RichInputEngine } from '../core/RichInputEngine';\nimport type {\n  RichInputConfig,\n  RichInputEventHandlers,\n  RichInputState\n} from '../types';\nimport { calculateTokenAwareClickPosition } from '../utils/enhancedCursorPositioning';\nimport { richTextLogger, type ClickDebugInfo } from '../utils/logger';\n\nexport function useMouseHandlers(\n  engine: RichInputEngine,\n  state: RichInputState,\n  config: RichInputConfig,\n  handlers: RichInputEventHandlers,\n  containerRef: React.RefObject<HTMLDivElement>\n) {\n  const handleClick = useCallback(\n    (e: React.MouseEvent) => {\n      const contentElement = containerRef.current?.querySelector(\n        '[data-rich-content]'\n      ) as HTMLElement;\n      if (!contentElement) return;\n\n      const position = calculateTokenAwareClickPosition(\n        e,\n        state.rawText,\n        contentElement\n      );\n\n      if (position) {\n        // Collect debug information\n        const debugInfo = collectClickDebugInfo(\n          e,\n          position.index,\n          state.rawText,\n          contentElement\n        );\n\n        // Log the click for debugging\n        richTextLogger.logClick(debugInfo);\n\n        // Set cursor position\n        engine.setCursor(position);\n      }\n    },\n    [engine, state, containerRef]\n  );\n\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    // Start selection if needed\n    // This will be handled by the click handler for now\n  }, []);\n\n  const handleMouseUp = useCallback((e: React.MouseEvent) => {\n    // End selection if needed\n    // This will be handled by the selection system\n  }, []);\n\n  const handleFocus = useCallback(\n    (e: React.FocusEvent) => {\n      engine.focus();\n      handlers.onFocus?.(state);\n    },\n    [engine, handlers, state]\n  );\n\n  const handleBlur = useCallback(\n    (e: React.FocusEvent) => {\n      engine.blur();\n      handlers.onBlur?.(state);\n    },\n    [engine, handlers, state]\n  );\n\n  return {\n    handleClick,\n    handleMouseDown,\n    handleMouseUp,\n    handleFocus,\n    handleBlur\n  };\n}\n\n/**\n * Collect comprehensive debug information about a click event\n */\nfunction collectClickDebugInfo(\n  e: React.MouseEvent,\n  textIndex: number,\n  rawText: string,\n  contentElement: HTMLElement\n): ClickDebugInfo {\n  const rect = contentElement.getBoundingClientRect();\n  const clickX = e.clientX - rect.left;\n  const clickY = e.clientY - rect.top;\n\n  // Get tokenized content for detailed analysis\n  const tokenizedContent = ContentParser.tokenize(rawText);\n\n  // Get character at click position\n  const character = ContentParser.getCharacterAt(tokenizedContent, textIndex);\n\n  // Get word at click position\n  const word = ContentParser.getWordAt(tokenizedContent, textIndex);\n  let wordInfo: ClickDebugInfo['word'] | undefined;\n  if (word) {\n    wordInfo = {\n      text: word.word,\n      start: word.start,\n      end: word.end,\n      cursorPositionInWord: textIndex - word.start,\n      isWhitespace: word.isWhitespace\n    };\n  }\n\n  // Get line info (for multiline support)\n  const lineInfo = ContentParser.getLineInfo(tokenizedContent, textIndex);\n  const lines = rawText.split('\\\\n');\n  const lineText = lines[lineInfo.lineNumber] || '';\n\n  const line: ClickDebugInfo['line'] = {\n    lineNumber: lineInfo.lineNumber + 1, // 1-based for display\n    lineStart: lineInfo.lineStart,\n    lineEnd: lineInfo.lineEnd,\n    columnIndex: lineInfo.columnIndex,\n    lineText\n  };\n\n  // Get pill at click position\n  const pill = ContentParser.getPillAt(tokenizedContent, textIndex);\n  let pillInfo: ClickDebugInfo['pill'] | undefined;\n  if (pill) {\n    // Determine pill variant based on data\n    let variant = 'default';\n    if (pill.type === 'mention' && pill.data.filterType) {\n      variant = pill.data.filterType;\n    } else if (pill.type === 'url' && pill.data.behavior) {\n      variant = pill.data.behavior;\n    }\n\n    pillInfo = {\n      type: pill.type,\n      variant,\n      rawText: rawText.slice(pill.start, pill.end),\n      displayText: pill.displayValue,\n      start: pill.start,\n      end: pill.end,\n      data: pill.data\n    };\n  }\n\n  return {\n    clickX,\n    clickY,\n    textIndex,\n    word: wordInfo,\n    line,\n    pill: pillInfo,\n    character: character\n      ? {\n          char: character.char,\n          isWhitespace: character.isWhitespace,\n          isNewline: character.isNewline,\n          isPunctuation: character.isPunctuation\n        }\n      : undefined,\n    fullText: rawText,\n    textLength: rawText.length\n  };\n}\n",
    "language":"typescript",
    "lines":173,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/security/validation.ts":{
    "content":"/**\n * Comprehensive Security Validation Utilities\n * \n * Provides real-time validation for user existence, account status, and permissions\n * Used by middleware and individual API routes for consistent security\n */\n\nimport { NextResponse } from 'next/server';\n\nexport interface UserValidationResult {\n  isValid: boolean;\n  user?: {\n    id: number;\n    name: string;\n    email: string;\n    is_active: boolean;\n    created_at: Date;\n  };\n  error?: string;\n  code?: string;\n  requiresReauth?: boolean;\n}\n\nexport interface PermissionValidationResult {\n  hasPermission: boolean;\n  error?: string;\n  code?: string;\n}\n\n/**\n * Validates user existence and account status in real-time\n * This should be called on every authenticated request\n */\nexport async function validateUserExistence(userId: number): Promise<UserValidationResult> {\n  try {\n    if (!userId || isNaN(userId)) {\n      return {\n        isValid: false,\n        error: 'Invalid user ID',\n        code: 'INVALID_USER_ID',\n        requiresReauth: true\n      };\n    }\n\n    const { default: sql } = await import('../db');\n    const userValidation = await sql`\n      SELECT \n        id, \n        name, \n        email,\n        is_active,\n        created_at\n      FROM users \n      WHERE id = ${userId}\n    `;\n\n    if (userValidation.length === 0) {\n      console.error('\u274c SECURITY: User not found in database:', userId);\n      return {\n        isValid: false,\n        error: 'User account not found',\n        code: 'USER_NOT_FOUND',\n        requiresReauth: true\n      };\n    }\n\n    const user = userValidation[0];\n\n    // Check if user account is deactivated\n    if (user.is_active === false) {\n      console.warn('\u274c SECURITY: Deactivated user attempting access:', userId);\n      return {\n        isValid: false,\n        error: 'Account deactivated',\n        code: 'ACCOUNT_DEACTIVATED',\n        requiresReauth: true\n      };\n    }\n\n    // Update last activity timestamp (lightweight tracking)\n    await sql`\n      UPDATE users \n      SET last_login = CURRENT_TIMESTAMP \n      WHERE id = ${userId}\n    `;\n\n    return {\n      isValid: true,\n      user: {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        is_active: user.is_active !== false,\n        created_at: user.created_at\n      }\n    };\n\n  } catch (error) {\n    console.error('\u274c Error validating user existence:', error);\n    return {\n      isValid: false,\n      error: 'User validation failed',\n      code: 'VALIDATION_ERROR',\n      requiresReauth: true\n    };\n  }\n}\n\n/**\n * Validates user permissions in real-time\n * This should be called for permission-protected routes\n */\nexport async function validateUserPermission(\n  userId: number, \n  permission: string\n): Promise<PermissionValidationResult> {\n  try {\n    const { checkUserPermission } = await import('../actions/permissions.actions');\n    \n    const hasPermission = await checkUserPermission(userId, permission);\n    \n    if (!hasPermission) {\n      console.warn('\u274c User lacks required permission:', { userId, permission });\n      return {\n        hasPermission: false,\n        error: 'Insufficient permissions',\n        code: 'INSUFFICIENT_PERMISSIONS'\n      };\n    }\n\n    return {\n      hasPermission: true\n    };\n\n  } catch (error) {\n    console.error('\u274c Error validating user permission:', error);\n    return {\n      hasPermission: false,\n      error: 'Permission check failed',\n      code: 'PERMISSION_CHECK_ERROR'\n    };\n  }\n}\n\n/**\n * Validates admin permissions specifically\n * Convenience wrapper for admin permission checking\n */\nexport async function validateAdminPermission(userId: number): Promise<PermissionValidationResult> {\n  const { PERMISSIONS } = await import('../permissions/permissions');\n  return validateUserPermission(userId, PERMISSIONS.ADMIN.PERMISSIONS_VIEW);\n}\n\n/**\n * Creates appropriate NextResponse for validation failures\n * Handles both API and page route responses\n */\nexport function createValidationFailureResponse(\n  validation: UserValidationResult | PermissionValidationResult,\n  isApiRoute: boolean,\n  redirectUrl?: string\n): NextResponse {\n  if (isApiRoute) {\n    const status = validation.code === 'USER_NOT_FOUND' ? 404 : \n                  validation.code === 'ACCOUNT_DEACTIVATED' ? 403 :\n                  validation.code === 'INSUFFICIENT_PERMISSIONS' ? 403 : 401;\n    \n    const response = NextResponse.json({\n      error: validation.error,\n      code: validation.code,\n      requiresReauth: 'requiresReauth' in validation ? validation.requiresReauth : false,\n      clearSession: 'requiresReauth' in validation ? validation.requiresReauth : false\n    }, { status });\n\n    // Clear session cookies if reauth is required\n    if ('requiresReauth' in validation && validation.requiresReauth) {\n      response.cookies.delete('next-auth.session-token');\n      response.cookies.delete('__Secure-next-auth.session-token');\n      response.cookies.delete('next-auth.csrf-token');\n      response.cookies.delete('__Host-next-auth.csrf-token');\n      response.cookies.delete('next-auth.callback-url');\n      response.cookies.delete('__Secure-next-auth.callback-url');\n      \n      // Add header to trigger client-side session clearing\n      response.headers.set('X-Clear-Session', 'true');\n    }\n    \n    return response;\n  } else {\n    // Page route - redirect appropriately\n    const url = redirectUrl || '/auth/signin';\n    const response = NextResponse.redirect(new URL(url, 'http://localhost:3000'));\n    \n    // Clear session if reauth is required\n    if ('requiresReauth' in validation && validation.requiresReauth) {\n      response.cookies.delete('next-auth.session-token');\n      response.cookies.delete('__Secure-next-auth.session-token');\n      response.cookies.delete('next-auth.csrf-token');\n      response.cookies.delete('__Host-next-auth.csrf-token');\n      response.cookies.delete('next-auth.callback-url');\n      response.cookies.delete('__Secure-next-auth.callback-url');\n    }\n    \n    return response;\n  }\n}\n\n/**\n * Comprehensive validation for authenticated requests\n * Combines user existence and permission checking\n */\nexport async function validateAuthenticatedRequest(\n  userId: number,\n  requiredPermission?: string\n): Promise<{\n  isValid: boolean;\n  user?: UserValidationResult['user'];\n  error?: string;\n  code?: string;\n  requiresReauth?: boolean;\n}> {\n  // First validate user existence\n  const userValidation = await validateUserExistence(userId);\n  if (!userValidation.isValid) {\n    return {\n      isValid: false,\n      error: userValidation.error,\n      code: userValidation.code,\n      requiresReauth: userValidation.requiresReauth\n    };\n  }\n\n  // If permission is required, validate it\n  if (requiredPermission) {\n    const permissionValidation = await validateUserPermission(userId, requiredPermission);\n    if (!permissionValidation.hasPermission) {\n      return {\n        isValid: false,\n        user: userValidation.user,\n        error: permissionValidation.error,\n        code: permissionValidation.code,\n        requiresReauth: false\n      };\n    }\n  }\n\n  return {\n    isValid: true,\n    user: userValidation.user\n  };\n} ",
    "language":"typescript",
    "lines":251,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/coin.selectors.ts":{
    "content":"export const COIN_SELECTORS = {\n  FRONT: 'coin-front',\n  HEADER: 'coin-header',\n  BODY: 'coin-body',\n  FOOTER: 'coin-footer',\n  BACK: 'coin-back'\n};\n",
    "language":"typescript",
    "lines":8,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/pagination.selectors.ts":{
    "content":"export const PAGINATION_SELECTORS = {\n  PREVIOUS: 'pagination__button--previous',\n  NEXT: 'pagination__button--next',\n  STATE: 'pagination__state',\n  PAGE_SELECTOR: 'pagination__page-selector',\n  PAGE_SIZE_SELECTOR: 'pagination__page-size-selector',\n  PAGE_SIZE_STATE: 'pagination__page-size-state'\n};\n",
    "language":"typescript",
    "lines":9,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/submissions-list.selectors.ts":{
    "content":"export const SUBMISSIONS_LIST_SELECTORS = {\n  CONTAINER: 'submissions-list__container'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/discord-link.selectors.ts":{
    "content":"export const DISCORD_LINK_SELECTORS = {\n  LINK: 'discord-link'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/docs-link.selectors.ts":{
    "content":"export const DOCS_LINK_SELECTORS = {\n  LINK: 'docs-link'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/add-submission-form.selectors.ts":{
    "content":"export const ADD_SUBMISSION_FORM_SELECTORS = {\n  FORM: 'add-submission-form',\n  NAME_INPUT: 'add-submission-name-input',\n  SUBMIT_BUTTON: 'add-submission-submit-button',\n  CHARACTER_COUNT: 'add-submission-character-count',\n  STATUS_MESSAGE: 'add-submission-status-message'\n};\n",
    "language":"typescript",
    "lines":8,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/auth-buttons.selectors.ts":{
    "content":"export const AUTH_BUTTON_SELECTORS = {\n  SIGN_IN: 'auth-buttons__sign-in',\n  SIGN_OUT: 'auth-buttons__sign-out'\n};\n",
    "language":"typescript",
    "lines":5,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/nav.selectors.ts":{
    "content":"export const NAV_SELECTORS = {\n  HOME_LINK: 'nav__home-link',\n  NAV_PATHS: 'nav__paths',\n  SIGN_IN_LINK: 'nav__sign-in-link',\n  USER_NAME: 'nav__user-name',\n  SIGN_OUT_BUTTON: 'nav__sign-out-button',\n  ADMIN_LINK: 'nav__admin-link',\n  PROFILE_LINK: 'nav__profile-link'\n};\n",
    "language":"typescript",
    "lines":10,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/loader.selectors.ts":{
    "content":"export const LOADER_SELECTORS = {\n  LOADER: 'loader__scale-loader'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/recent-tags.selectors.ts":{
    "content":"export const RECENT_TAGS_SELECTORS = {\n  TITLE: 'recent-tags__title'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/card.selectors.ts":{
    "content":"export const CARD_SELECTORS = {\n  CONTAINER: 'card'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/discord-embed.selectors.ts":{
    "content":"export const DISCORD_EMBED_SELECTORS = {\n  IFRAME: 'discord-embed-iframe'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/page-aside.selectors.ts":{
    "content":"export const PAGE_ASIDE_SELECTORS = {\n  CONTAINER: 'page-aside-container',\n  ASIDE: 'page-aside'\n}; ",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/fade-in.selectors.ts":{
    "content":"export const FADE_IN_SELECTORS = {\n  DIV: 'fade-in-div',\n  SPAN: 'fade-in-span',\n  P: 'fade-in-p',\n  CODE: 'fade-in-code',\n  LI: 'fade-in-li'\n};\n",
    "language":"typescript",
    "lines":8,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/empty.selectors.ts":{
    "content":"export const EMPTY_SELECTORS = {\n  CONTAINER: 'empty__container',\n  LABEL: 'empty__label'\n};\n",
    "language":"typescript",
    "lines":5,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/nav-paths.selectors.ts":{
    "content":"export const NAV_PATHS_SELECTORS = {\n  ITEM: 'nav-paths__item'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/badge.ts":{
    "content":"export const BADGE_SELECTORS = {\n  CONTAINER: 'badge__container',\n  CONTENT: 'badge__content'\n};\n",
    "language":"typescript",
    "lines":5,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/app-version.selectors.ts":{
    "content":"export const APP_VERSION_SELECTORS = {\n  ANCHOR: 'app-version-selectors__anchor'\n};\n",
    "language":"typescript",
    "lines":4,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/game-wrapper.selectors.ts":{
    "content":"export const GAME_WRAPPER_SELECTORS = {\n  CANVAS: 'game_wrapper__canvas',\n  SCRIPT: 'game_wrapper__script'\n};\n",
    "language":"typescript",
    "lines":5,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/test-selectors/components/avatar.selectors.ts":{
    "content":"export const AVATAR_SELECTORS = {\n  CONTAINER: 'avatar__container',\n  LOADER: 'avatar__loader',\n  IMAGE: 'avatar__image'\n};\n",
    "language":"typescript",
    "lines":6,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/api/withValidation.ts":{
    "content":"/**\n * API Route Validation Wrapper System\n * \n * Provides scalable, reusable validation for API routes without duplication\n * Handles user existence, permissions, and other security checks consistently\n */\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { auth } from '../auth';\nimport { createValidationFailureResponse, validateUserExistence, validateUserPermission } from '../security/validation';\n\nexport interface ValidationConfig {\n  requireAuth?: boolean;\n  requirePermission?: string;\n  allowedMethods?: string[];\n  requireUserExists?: boolean;\n}\n\nexport interface ValidatedRequest extends NextRequest {\n  user?: {\n    id: number;\n    name: string;\n    email: string;\n    is_active: boolean;\n    created_at: Date;\n  };\n  session?: any;\n}\n\nexport interface ApiRouteHandler {\n  (req: ValidatedRequest, context?: any): Promise<NextResponse>;\n}\n\n/**\n * Higher-order function that wraps API routes with validation\n * \n * @param handler - The API route handler function\n * @param config - Validation configuration\n * @returns Wrapped handler with validation\n */\nexport function withValidation(\n  handler: ApiRouteHandler,\n  config: ValidationConfig = {}\n) {\n  return async (req: NextRequest, context?: any): Promise<NextResponse> => {\n    const {\n      requireAuth = true,\n      requirePermission,\n      allowedMethods,\n      requireUserExists = true\n    } = config;\n\n    try {\n      // Method validation\n      if (allowedMethods && !allowedMethods.includes(req.method || 'GET')) {\n        return NextResponse.json(\n          { error: 'Method not allowed' },\n          { status: 405 }\n        );\n      }\n\n      // Authentication check\n      if (requireAuth) {\n        const session = await auth();\n        if (!session?.user?.id) {\n          return NextResponse.json(\n            { error: 'Authentication required' },\n            { status: 401 }\n          );\n        }\n\n        const userId = parseInt(session.user.id);\n        if (!userId || isNaN(userId)) {\n          return NextResponse.json(\n            { error: 'Invalid session' },\n            { status: 401 }\n          );\n        }\n\n        // User existence validation\n        if (requireUserExists) {\n          const userValidation = await validateUserExistence(userId);\n          if (!userValidation.isValid) {\n            return createValidationFailureResponse(userValidation, true);\n          }\n\n          // Add validated user to request\n          (req as ValidatedRequest).user = userValidation.user;\n        }\n\n        // Permission validation\n        if (requirePermission) {\n          const permissionValidation = await validateUserPermission(userId, requirePermission);\n          if (!permissionValidation.hasPermission) {\n            return createValidationFailureResponse(permissionValidation, true);\n          }\n        }\n\n        // Add session to request\n        (req as ValidatedRequest).session = session;\n      }\n\n      // Call the original handler with validated request\n      return await handler(req as ValidatedRequest, context);\n\n    } catch (error) {\n      console.error('\u274c API validation wrapper error:', error);\n      return NextResponse.json(\n        { error: 'Internal server error' },\n        { status: 500 }\n      );\n    }\n  };\n}\n\n/**\n * Convenience wrapper for admin-only routes\n */\nexport function withAdminValidation(handler: ApiRouteHandler) {\n  return withValidation(handler, {\n    requireAuth: true,\n    requireUserExists: true,\n    requirePermission: 'admin.permissions.view' // This should match your admin permission\n  });\n}\n\n/**\n * Convenience wrapper for authenticated routes (no specific permissions)\n */\nexport function withAuthValidation(handler: ApiRouteHandler) {\n  return withValidation(handler, {\n    requireAuth: true,\n    requireUserExists: true\n  });\n}\n\n/**\n * Convenience wrapper for public routes with optional auth\n */\nexport function withOptionalAuth(handler: ApiRouteHandler) {\n  return withValidation(handler, {\n    requireAuth: false,\n    requireUserExists: false\n  });\n}\n\n/**\n * Method-specific validation helpers\n */\nexport function withMethodValidation(\n  handler: ApiRouteHandler, \n  methods: string[], \n  config: ValidationConfig = {}\n) {\n  return withValidation(handler, {\n    ...config,\n    allowedMethods: methods\n  });\n}\n\n/**\n * Convenience wrappers for common method patterns\n */\nexport const withGET = (handler: ApiRouteHandler, config?: ValidationConfig) =>\n  withMethodValidation(handler, ['GET'], config);\n\nexport const withPOST = (handler: ApiRouteHandler, config?: ValidationConfig) =>\n  withMethodValidation(handler, ['POST'], config);\n\nexport const withPUT = (handler: ApiRouteHandler, config?: ValidationConfig) =>\n  withMethodValidation(handler, ['PUT'], config);\n\nexport const withDELETE = (handler: ApiRouteHandler, config?: ValidationConfig) =>\n  withMethodValidation(handler, ['DELETE'], config);\n\nexport const withPATCH = (handler: ApiRouteHandler, config?: ValidationConfig) =>\n  withMethodValidation(handler, ['PATCH'], config);\n\n/**\n * Multi-method wrapper\n */\nexport function withMethods(methods: string[]) {\n  return {\n    auth: (handler: ApiRouteHandler) => \n      withMethodValidation(handler, methods, { requireAuth: true }),\n    admin: (handler: ApiRouteHandler) => \n      withMethodValidation(handler, methods, { \n        requireAuth: true, \n        requirePermission: 'admin.permissions.view' \n      }),\n    public: (handler: ApiRouteHandler) => \n      withMethodValidation(handler, methods, { requireAuth: false })\n  };\n}\n\n/**\n * Example usage patterns:\n * \n * // Basic authenticated route\n * export const GET = withAuthValidation(async (req) => {\n *   // req.user is guaranteed to exist and be validated\n *   return NextResponse.json({ user: req.user });\n * });\n * \n * // Admin-only route\n * export const POST = withAdminValidation(async (req) => {\n *   // User is guaranteed to have admin permissions\n *   return NextResponse.json({ success: true });\n * });\n * \n * // Method-specific with custom validation\n * export const PUT = withPUT(async (req) => {\n *   // Only PUT requests allowed\n *   return NextResponse.json({ updated: true });\n * }, { requirePermission: 'posts.edit' });\n * \n * // Multiple methods with different permissions\n * export const GET = withMethods(['GET', 'POST']).auth(async (req) => {\n *   // Both GET and POST allowed for authenticated users\n *   return NextResponse.json({ method: req.method });\n * });\n */ ",
    "language":"typescript",
    "lines":222,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/config/media-domains.ts":{
    "content":"/**\n * Centralized configuration for supported media domains and file types\n */\n\n// YouTube domains that support embed functionality\nexport const YOUTUBE_DOMAINS = [\n  'youtube.com',\n  'www.youtube.com',\n  'youtu.be',\n  'm.youtube.com'\n] as const;\n\n// Multi-media hosting domains (support both images and videos)\nexport const MULTI_MEDIA_DOMAINS = [\n  'imgur.com',\n  'i.imgur.com',\n  'giphy.com',\n  'media.giphy.com',\n  'media0.giphy.com',\n  'media1.giphy.com',\n  'media2.giphy.com',\n  'media3.giphy.com',\n  'media4.giphy.com',\n  'github.com',\n  'raw.githubusercontent.com',\n  'user-images.githubusercontent.com'\n] as const;\n\n// Image-only hosting domains\nexport const IMAGE_ONLY_DOMAINS = [\n  'images.unsplash.com',\n  'unsplash.com'\n] as const;\n\n// All image hosting domains (for backward compatibility)\nexport const IMAGE_DOMAINS = [\n  ...MULTI_MEDIA_DOMAINS,\n  ...IMAGE_ONLY_DOMAINS\n] as const;\n\n// Generic image file extensions\nexport const IMAGE_EXTENSIONS = [\n  'jpg',\n  'jpeg',\n  'png',\n  'gif',\n  'webp',\n  'svg',\n  'bmp',\n  'ico',\n  'avif',\n  'tiff',\n  'tif'\n] as const;\n\n// Video file extensions for direct video embedding\nexport const VIDEO_EXTENSIONS = [\n  'mp4',\n  'webm',\n  'ogg',\n  'avi',\n  'mov',\n  'wmv',\n  'flv',\n  'm4v',\n  'mkv',\n  '3gp',\n  'ogv'\n] as const;\n\n// Audio file extensions for direct audio embedding\nexport const AUDIO_EXTENSIONS = [\n  'mp3',\n  'wav',\n  'ogg',\n  'aac',\n  'flac',\n  'm4a',\n  'wma',\n  'opus'\n] as const;\n\n// All supported media extensions\nexport const ALL_MEDIA_EXTENSIONS = [\n  ...IMAGE_EXTENSIONS,\n  ...VIDEO_EXTENSIONS,\n  ...AUDIO_EXTENSIONS\n] as const;\n\n// Media type configuration for upload limits and processing\nexport interface MediaTypeConfig {\n  maxSize: number; // in bytes\n  quality?: number; // for compression (0-1)\n  maxWidth?: number; // for image resizing\n  maxHeight?: number; // for image resizing\n  allowedMimeTypes: string[];\n}\n\nexport const MEDIA_TYPE_CONFIGS: Record<string, MediaTypeConfig> = {\n  // Image configurations\n  image: {\n    maxSize: 5 * 1024 * 1024, // 5MB\n    quality: 0.85,\n    maxWidth: 1920,\n    maxHeight: 1080,\n    allowedMimeTypes: [\n      'image/jpeg',\n      'image/png',\n      'image/gif',\n      'image/webp',\n      'image/svg+xml',\n      'image/bmp',\n      'image/avif',\n      'image/tiff'\n    ]\n  },\n\n  // Video configurations\n  video: {\n    maxSize: 50 * 1024 * 1024, // 50MB\n    allowedMimeTypes: [\n      'video/mp4',\n      'video/webm',\n      'video/ogg',\n      'video/avi',\n      'video/quicktime',\n      'video/x-msvideo',\n      'video/x-flv',\n      'video/3gpp'\n    ]\n  },\n\n  // Audio configurations\n  audio: {\n    maxSize: 10 * 1024 * 1024, // 10MB\n    allowedMimeTypes: [\n      'audio/mpeg',\n      'audio/wav',\n      'audio/ogg',\n      'audio/aac',\n      'audio/flac',\n      'audio/x-m4a',\n      'audio/opus'\n    ]\n  }\n};\n\n// Helper functions\nexport function isYouTubeDomain(hostname: string): boolean {\n  return YOUTUBE_DOMAINS.includes(hostname as any);\n}\n\nexport function isImageDomain(hostname: string): boolean {\n  return IMAGE_DOMAINS.includes(hostname as any);\n}\n\nexport function isMultiMediaDomain(hostname: string): boolean {\n  return MULTI_MEDIA_DOMAINS.includes(hostname as any);\n}\n\n/**\n * Extract file extension from URL, handling query parameters and fragments\n */\nexport function getFileExtension(url: string): string | null {\n  try {\n    const urlObj = new URL(url);\n    const pathname = urlObj.pathname;\n    const lastDot = pathname.lastIndexOf('.');\n    if (lastDot === -1) return null;\n\n    const extension = pathname.slice(lastDot + 1).toLowerCase();\n    // Validate it's actually an extension (not too long, contains only alphanumeric)\n    if (extension.length > 10 || !/^[a-z0-9]+$/.test(extension)) {\n      return null;\n    }\n\n    return extension;\n  } catch {\n    // Fallback for non-URL strings\n    const lastDot = url.lastIndexOf('.');\n    if (lastDot === -1) return null;\n\n    const extension = url.slice(lastDot + 1).toLowerCase();\n    // Remove query params and fragments\n    const cleanExtension = extension.split(/[?#]/)[0];\n\n    if (cleanExtension.length > 10 || !/^[a-z0-9]+$/.test(cleanExtension)) {\n      return null;\n    }\n\n    return cleanExtension;\n  }\n}\n\nexport function hasImageExtension(url: string): boolean {\n  const extension = getFileExtension(url);\n  return extension ? IMAGE_EXTENSIONS.includes(extension as any) : false;\n}\n\nexport function hasVideoExtension(url: string): boolean {\n  const extension = getFileExtension(url);\n  return extension ? VIDEO_EXTENSIONS.includes(extension as any) : false;\n}\n\nexport function hasAudioExtension(url: string): boolean {\n  const extension = getFileExtension(url);\n  return extension ? AUDIO_EXTENSIONS.includes(extension as any) : false;\n}\n\n/**\n * Smart media type detection that prioritizes file extensions over domains\n * This handles cases like imgur.com/video.mp4 correctly\n */\nexport function getMediaType(\n  url: string\n): 'youtube' | 'image' | 'video' | 'audio' | 'unknown' {\n  try {\n    const urlObj = new URL(url);\n    const hostname = urlObj.hostname.toLowerCase();\n\n    // Check YouTube first (special case)\n    if (isYouTubeDomain(hostname)) {\n      return 'youtube';\n    }\n\n    // Priority 1: File extension (most reliable)\n    if (hasVideoExtension(url)) {\n      return 'video';\n    }\n\n    if (hasImageExtension(url)) {\n      return 'image';\n    }\n\n    if (hasAudioExtension(url)) {\n      return 'audio';\n    }\n\n    // Priority 2: Domain-based detection (for URLs without clear extensions)\n    // This handles cases like imgur.com/gallery/abc123\n    if (isMultiMediaDomain(hostname)) {\n      // For multi-media domains without extension, default to image\n      // (most common case, and ImageEmbed can handle videos too)\n      return 'image';\n    }\n\n    if (IMAGE_ONLY_DOMAINS.includes(hostname as any)) {\n      return 'image';\n    }\n\n    // Priority 3: Special domain patterns\n    // Giphy URLs often don't have clear extensions\n    if (hostname.includes('giphy.com')) {\n      return 'image'; // GIFs are handled as images in our system\n    }\n\n    return 'unknown';\n  } catch {\n    return 'unknown';\n  }\n}\n\nexport function getMediaConfig(\n  mediaType: 'image' | 'video' | 'audio'\n): MediaTypeConfig {\n  return MEDIA_TYPE_CONFIGS[mediaType];\n}\n\nexport function validateFileSize(\n  file: File,\n  mediaType: 'image' | 'video' | 'audio'\n): boolean {\n  const config = getMediaConfig(mediaType);\n  return file.size <= config.maxSize;\n}\n\nexport function validateMimeType(\n  file: File,\n  mediaType: 'image' | 'video' | 'audio'\n): boolean {\n  const config = getMediaConfig(mediaType);\n  return config.allowedMimeTypes.includes(file.type);\n}\n\n// Legacy function names for backward compatibility\nexport const GENERIC_IMAGE_EXTENSIONS = IMAGE_EXTENSIONS;\n",
    "language":"typescript",
    "lines":287,
    "truncated":false,
    "truncate_limit":null
  },
  "src/lib/config/url-pills.ts":{
    "content":"// URL Pills Configuration\n// This file defines supported domains and their behaviors for URL pills\n\nimport {\n  hasImageExtension,\n  IMAGE_DOMAINS,\n  isImageDomain,\n  isYouTubeDomain,\n  YOUTUBE_DOMAINS\n} from './media-domains';\n\nexport interface URLPillDomain {\n  domain: string;\n  name: string;\n  shortName?: string; // Short name for compact display (2-3 chars)\n  icon?: string;\n  enabled: boolean;\n  behaviors: URLPillBehavior[];\n  defaultBehavior: string;\n  regex: RegExp;\n  extractId?: (url: string) => string | null;\n}\n\nexport interface URLPillBehavior {\n  id: string;\n  name: string;\n  description: string;\n  icon?: string;\n  requiresModal?: boolean;\n  enabled: boolean;\n}\n\n// YouTube behaviors\nconst youtubeBehaviors: URLPillBehavior[] = [\n  {\n    id: 'embed',\n    name: 'Embed',\n    description: 'Show video player inline',\n    icon: '\u25b6\ufe0f',\n    enabled: true\n  },\n  {\n    id: 'link',\n    name: 'Link',\n    description: 'Show as clickable link',\n    icon: '\ud83d\udd17',\n    enabled: true\n  }\n];\n\n// Image behaviors\nconst imageBehaviors: URLPillBehavior[] = [\n  {\n    id: 'embed',\n    name: 'Embed',\n    description: 'Show image inline',\n    icon: '\ud83d\uddbc\ufe0f',\n    enabled: true\n  },\n  {\n    id: 'link',\n    name: 'Link',\n    description: 'Show as clickable link',\n    icon: '\ud83d\udd17',\n    enabled: true\n  }\n];\n\n// Helper functions for extracting IDs\nconst extractYouTubeId = (url: string): string | null => {\n  const patterns = [\n    /(?:youtube\\\\.com\\\\/watch\\\\?v=|youtu\\\\.be\\\\/)([^&\\\\n?#]+)/,\n    /youtube\\\\.com\\\\/embed\\\\/([^&\\\\n?#]+)/,\n    /youtube\\\\.com\\\\/v\\\\/([^&\\\\n?#]+)/\n  ];\n\n  for (const pattern of patterns) {\n    const match = url.match(pattern);\n    if (match) return match[1];\n  }\n  return null;\n};\n\nconst extractImageInfo = (url: string): string | null => {\n  // For images, we'll use the filename as the ID\n  const urlParts = url.split('/');\n  const filename = urlParts[urlParts.length - 1];\n  return filename || null;\n};\n\n// Build YouTube domains configuration\nconst youtubeDomainsConfig: URLPillDomain[] = YOUTUBE_DOMAINS.map((domain) => ({\n  domain,\n  name: 'YouTube',\n  shortName: 'YT',\n  icon: '\ud83d\udcfa',\n  enabled: true,\n  behaviors: youtubeBehaviors,\n  defaultBehavior: 'embed',\n  regex: new RegExp(\n    '(?:https?:\\\\\\\\/\\\\\\\\/)?(?:www\\\\\\\\.)?(youtube\\\\\\\\.com|youtu\\\\\\\\.be)\\\\\\\\/' +\n      \\\"[\\\\\\\\w\\\\\\\\-._~:/?#[\\\\\\\\]@!$&'()*+,;=%]*\\\",\n    'i'\n  ),\n  extractId: extractYouTubeId\n}));\n\n// Build image domains configuration\nconst imageDomainsConfig: URLPillDomain[] = [\n  // Imgur - direct media URLs with extensions (images and videos)\n  {\n    domain: 'i.imgur.com',\n    name: 'Imgur',\n    shortName: 'IMG',\n    icon: '\ud83d\uddbc\ufe0f',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex: new RegExp(\n      \\\"(?:https?:\\\\\\\\/\\\\\\\\/)?i\\\\\\\\.imgur\\\\\\\\.com\\\\\\\\/[\\\\\\\\w\\\\\\\\-._~:/?#[\\\\\\\\]@!$&'()*+,;=%]*\\\\\\\\.\\\" +\n        '(jpg|jpeg|png|gif|webp|svg|bmp|ico|mp4|webm|ogg|avi|mov)',\n      'i'\n    ),\n    extractId: extractImageInfo\n  },\n\n  // Imgur - gallery and direct links without extensions\n  {\n    domain: 'imgur.com',\n    name: 'Imgur',\n    shortName: 'IMG',\n    icon: '\ud83d\uddbc\ufe0f',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex:\n      /(?:https?:\\\\/\\\\/)?(?:www\\\\.)?imgur\\\\.com\\\\/(?:a\\\\/|gallery\\\\/)?[\\\\w\\\\-._~]+/i,\n    extractId: (url: string) => {\n      const match = url.match(/imgur\\\\.com\\\\/(?:a\\\\/|gallery\\\\/)?([\\\\w\\\\-._~]+)/);\n      return match ? match[1] : null;\n    }\n  },\n\n  // Giphy - GIFs and videos\n  {\n    domain: 'giphy.com',\n    name: 'Giphy',\n    shortName: 'GIF',\n    icon: '\ud83c\udfac',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex: new RegExp(\n      '(?:https?:\\\\\\\\/\\\\\\\\/)?(?:media\\\\\\\\d*\\\\\\\\.)?giphy\\\\\\\\.com\\\\\\\\/' +\n        \\\"[\\\\\\\\w\\\\\\\\-._~:/?#[\\\\\\\\]@!$&'()*+,;=%]*\\\",\n      'i'\n    ),\n    extractId: (url: string) => {\n      const match = url.match(\n        /giphy\\\\.com\\\\/(?:media\\\\/)?(?:v1\\\\.Y2lkPTc5MGI3NjEx[\\\\w\\\\-._~]*\\\\/)?(?:gifs\\\\/)?([^/?#]+)/\n      );\n      return match ? match[1] : null;\n    }\n  },\n\n  // GitHub - raw content and user images (images and videos)\n  {\n    domain: 'github.com',\n    name: 'GitHub',\n    shortName: 'GH',\n    icon: '\ud83d\uddbc\ufe0f',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex: new RegExp(\n      '(?:https?:\\\\\\\\/\\\\\\\\/)?(?:raw\\\\\\\\.githubusercontent\\\\\\\\.com|' +\n        'user-images\\\\\\\\.githubusercontent\\\\\\\\.com|github\\\\\\\\.com)\\\\\\\\/' +\n        \\\"[\\\\\\\\w\\\\\\\\-._~:/?#[\\\\\\\\]@!$&'()*+,;=%]*\\\\\\\\.\\\" +\n        '(jpg|jpeg|png|gif|webp|svg|bmp|ico|mp4|webm|ogg|avi|mov)',\n      'i'\n    ),\n    extractId: extractImageInfo\n  },\n\n  // Unsplash - images only\n  {\n    domain: 'unsplash.com',\n    name: 'Unsplash',\n    shortName: 'UN',\n    icon: '\ud83d\uddbc\ufe0f',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex: new RegExp(\n      '(?:https?:\\\\\\\\/\\\\\\\\/)?(?:images\\\\\\\\.)?unsplash\\\\\\\\.com\\\\\\\\/' +\n        \\\"[\\\\\\\\w\\\\\\\\-._~:/?#[\\\\\\\\]@!$&'()*+,;=%]*\\\",\n      'i'\n    ),\n    extractId: (url: string) => {\n      const match = url.match(/unsplash\\\\.com\\\\/(?:photo-)?([^/?#]+)/);\n      return match ? match[1] : null;\n    }\n  },\n\n  // Temporary data URL images (pasted but not yet uploaded)\n  {\n    domain: 'temp-image',\n    name: 'Temp Image',\n    shortName: 'TMP',\n    icon: '\ud83d\uddbc\ufe0f',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex: new RegExp(\n      'data:temp-image;name=[^;]*;data:image\\\\\\\\/[^;]*;base64,[A-Za-z0-9+/=]+',\n      'i'\n    ),\n    extractId: (url: string) => {\n      const match = url.match(/name=([^;]*)/);\n      return match ? decodeURIComponent(match[1]) : 'temp-image';\n    }\n  },\n\n  // Local uploaded images\n  {\n    domain: 'local-upload',\n    name: 'Uploaded',\n    shortName: 'UP',\n    icon: '\ud83d\uddbc\ufe0f',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex: new RegExp(\n      '^\\\\\\\\/uploads\\\\\\\\/images\\\\\\\\/[\\\\\\\\w\\\\\\\\-._]+\\\\\\\\.' +\n        '(jpg|jpeg|png|gif|webp|svg|bmp|ico|mp4|webm|ogg|avi|mov)$',\n      'i'\n    ),\n    extractId: extractImageInfo\n  },\n\n  // Generic media URL pattern - matches any URL ending with common media extensions\n  {\n    domain: 'generic-media',\n    name: 'Media',\n    shortName: 'MED',\n    icon: '\ud83c\udfac',\n    enabled: true,\n    behaviors: imageBehaviors,\n    defaultBehavior: 'embed',\n    regex: new RegExp(\n      \\\"(?:https?:\\\\\\\\/\\\\\\\\/)?[\\\\\\\\w\\\\\\\\-._~:/?#[\\\\\\\\]@!$&'()*+,;=%]*\\\\\\\\.\\\" +\n        '(jpg|jpeg|png|gif|webp|svg|bmp|ico|avif|tiff|tif|' +\n        'mp4|webm|ogg|avi|mov|wmv|flv|m4v|mkv|3gp|ogv)$',\n      'i'\n    ),\n    extractId: extractImageInfo\n  }\n];\n\n// All supported domains\nexport const ALL_DOMAINS: URLPillDomain[] = [\n  ...youtubeDomainsConfig,\n  ...imageDomainsConfig\n];\n\n// Find domain configuration for a URL\nexport const findDomainConfig = (url: string): URLPillDomain | null => {\n  return ALL_DOMAINS.find((domain) => domain.regex.test(url)) || null;\n};\n\n// Check if URL is whitelisted\nexport const isWhitelistedURL = (url: string): boolean => {\n  return findDomainConfig(url) !== null;\n};\n\n// Parse URLs in text and return matches with domain info\nexport const parseURLs = (\n  text: string\n): Array<{\n  url: string;\n  domain: URLPillDomain;\n  start: number;\n  end: number;\n}> => {\n  const results: Array<{\n    url: string;\n    domain: URLPillDomain;\n    start: number;\n    end: number;\n  }> = [];\n\n  // Basic URL regex - matches http/https URLs\n  const urlRegex = /(https?:\\\\/\\\\/[^\\\\s<>\\\"{}|\\\\\\\\^`[\\\\]]+)/gi;\n  let match;\n\n  while ((match = urlRegex.exec(text)) !== null) {\n    const url = match[1];\n    const domain = findDomainConfig(url);\n\n    if (domain) {\n      results.push({\n        url,\n        domain,\n        start: match.index,\n        end: match.index + url.length\n      });\n    }\n  }\n\n  return results;\n};\n\n// Parse URL pill format: ![behavior](url) or ![behavior|width](url)\nexport const parseURLPill = (\n  pillText: string\n): { behavior: string; url: string; customId?: string } | null => {\n  const match = pillText.match(/^!\\\\[([^|\\\\]]+)(?:\\\\|([^|\\\\]]+))?\\\\]\\\\(([^)]+)\\\\)$/);\n  if (!match) return null;\n\n  return {\n    behavior: match[1],\n    url: match[3],\n    customId: match[2] // Width or other custom ID\n  };\n};\n\n// Create URL pill format\nexport const createURLPill = (\n  url: string,\n  behavior: string,\n  customId?: string\n): string => {\n  return customId\n    ? `![${behavior}|${customId}](${url})`\n    : `![${behavior}](${url})`;\n};\n\n// Detect URLs in text and suggest pill replacements\nexport const detectURLsInText = (\n  text: string\n): Array<{\n  url: string;\n  domain: URLPillDomain;\n  start: number;\n  end: number;\n  replacementPill: string;\n}> => {\n  const urlMatches = parseURLs(text);\n\n  return urlMatches.map((match) => ({\n    ...match,\n    replacementPill: createURLPill(match.url, match.domain.defaultBehavior)\n  }));\n};\n\n// Convert URLs to pills automatically\nexport const convertURLsToPills = (text: string): string => {\n  const matches = detectURLsInText(text);\n\n  // Sort by start position in reverse order to replace from end to beginning\n  matches.sort((a, b) => b.start - a.start);\n\n  let result = text;\n  for (const match of matches) {\n    result =\n      result.substring(0, match.start) +\n      match.replacementPill +\n      result.substring(match.end);\n  }\n\n  return result;\n};\n\n// Check if text has convertible URLs\nexport const hasConvertibleURLs = (text: string): boolean => {\n  return detectURLsInText(text).length > 0;\n};\n\n/**\n * Configuration for URL pills - determines which URLs get special treatment\n */\nexport interface URLPillConfig {\n  domains: readonly string[];\n  behavior: 'embed' | 'link';\n  className?: string;\n}\n\nexport const URL_PILL_CONFIGS: Record<string, URLPillConfig> = {\n  youtube: {\n    domains: YOUTUBE_DOMAINS,\n    behavior: 'embed',\n    className: 'youtube-pill'\n  },\n  image: {\n    domains: IMAGE_DOMAINS,\n    behavior: 'embed',\n    className: 'image-pill'\n  }\n};\n\n/**\n * Determines if a URL should be rendered as a pill\n * @param url The URL to check\n * @returns The pill type or null if no pill should be rendered\n */\nexport function getURLPillType(url: string): string | null {\n  try {\n    const urlObj = new URL(url);\n    const hostname = urlObj.hostname.toLowerCase();\n\n    // Check YouTube domains\n    if (isYouTubeDomain(hostname)) {\n      return 'youtube';\n    }\n\n    // Check image domains or image extensions\n    if (isImageDomain(hostname) || hasImageExtension(url)) {\n      return 'image';\n    }\n\n    // No pill type found\n    return null;\n  } catch {\n    // Invalid URL\n    return null;\n  }\n}\n\n/**\n * Gets the configuration for a specific pill type\n */\nexport function getPillConfig(pillType: string): URLPillConfig | null {\n  return URL_PILL_CONFIGS[pillType] || null;\n}\n\n/**\n * Determines if a URL should be embedded vs linked\n */\nexport function shouldEmbedURL(url: string): boolean {\n  const pillType = getURLPillType(url);\n  if (!pillType) return false;\n\n  const config = getPillConfig(pillType);\n  return config?.behavior === 'embed';\n}\n\n/**\n * Legacy function for backward compatibility\n * @deprecated Use getURLPillType instead\n */\nexport function isEmbeddableURL(url: string): boolean {\n  return getURLPillType(url) !== null;\n}\n",
    "language":"typescript",
    "lines":454,
    "truncated":false,
    "truncate_limit":null
  },
  "src/auth.config.ts":{
    "content":"import type { NextAuthConfig, Session } from 'next-auth';\nimport { User } from 'next-auth';\nimport { JWT } from 'next-auth/jwt';\nimport google from 'next-auth/providers/google';\nimport twitch from 'next-auth/providers/twitch';\n\ndeclare module 'next-auth' {\n  interface Session {\n    accessToken?: string;\n    user: {\n      id?: string;\n      name?: string | null;\n      email?: string | null;\n      image?: string | null;\n      providerAccountId?: string;\n      spacing_theme?: 'cozy' | 'compact';\n      pagination_mode?: 'traditional' | 'infinite';\n    };\n  }\n\n  interface User {\n    providerAccountId?: string;\n    spacing_theme?: 'cozy' | 'compact';\n    pagination_mode?: 'traditional' | 'infinite';\n  }\n\n  interface JWT {\n    providerAccountId?: string;\n    spacing_theme?: 'cozy' | 'compact';\n    pagination_mode?: 'traditional' | 'infinite';\n  }\n}\n\nexport type CustomSession = Session;\n\nexport interface UserWithProviderAccountId extends User {\n  providerAccountId?: string;\n}\n\nexport interface JWTWithProviderAccountId extends JWT {\n  databaseId?: string;\n  providerAccountId?: string;\n  spacing_theme?: 'cozy' | 'compact';\n  pagination_mode?: 'traditional' | 'infinite';\n}\n\n// Notice this is only an object, not a full Auth.js instance\nexport const authConfig: NextAuthConfig = {\n  providers: [\n    twitch({\n      clientId: process.env.AUTH_TWITCH_ID!,\n      clientSecret: process.env.AUTH_TWITCH_SECRET!\n    }),\n    google({\n      clientId: process.env.GOOGLE_CLIENT_ID,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET\n    })\n  ],\n  pages: {\n    error: '/auth/callback',\n    signIn: '/auth/signin',\n    signOut: '/'\n  },\n  callbacks: {\n    authorized({ auth }) {\n      const isAuthenticated = !!auth?.user;\n\n      return isAuthenticated;\n    },\n    async redirect({ url, baseUrl }) {\n      // Handle custom redirects\n      if (url.startsWith('/')) {\n        return `${baseUrl}${url}`;\n      }\n      // Handle callback URLs with redirect parameter\n      if (url.startsWith(baseUrl)) {\n        const urlObj = new URL(url);\n        const redirectParam = urlObj.searchParams.get('redirect');\n        if (redirectParam && redirectParam.startsWith('/')) {\n          return `${baseUrl}${redirectParam}`;\n        }\n        return url;\n      }\n      return baseUrl;\n    },\n    async signIn({ account, user }) {\n      if (account?.providerAccountId) {\n        (user as UserWithProviderAccountId).providerAccountId =\n          account.providerAccountId;\n      }\n      return true;\n    },\n    async jwt({ token, account, user }) {\n      // Store both database ID and providerAccountId from user/account\n      if (user) {\n        // Store database internal ID as primary identifier\n        token.databaseId = user.id;\n        token.providerAccountId =\n          (user as any).providerAccountId || account?.providerAccountId;\n      }\n\n      // Update providerAccountId from account during sign-in\n      if (account?.providerAccountId) {\n        (token as JWTWithProviderAccountId).providerAccountId =\n          account.providerAccountId;\n      }\n\n      return token;\n    },\n    async session({ session, token }) {\n      // Use database internal ID as the primary ID for all app operations\n      if (token.databaseId) {\n        session.user.id = token.databaseId as string;\n        session.user.providerAccountId = token.providerAccountId as string;\n      }\n\n      return session;\n    }\n  },\n  session: {\n    strategy: 'jwt',\n    maxAge:\n      process.env.NODE_ENV === 'development' ? 30 * 24 * 60 * 60 : 24 * 60 * 60 // 30 days in dev, 1 day in prod\n  },\n  secret: process.env.NEXTAUTH_SECRET\n} satisfies NextAuthConfig;\n",
    "language":"typescript",
    "lines":127,
    "truncated":false,
    "truncate_limit":null
  }
}
    </script>
        

    <!-- Highlight.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
    <script>

    // Documentation Coverage Report - Main JavaScript Application
    // FIXED VERSION - No conflicts, proper syntax highlighting
    
    
    // Utility Functions
    class UtilityManager {
        constructor() {
            this.setupUtilityFunctions();
        }
        
        setupUtilityFunctions() {
            // Add utility methods to window for global access
            window.docsCoverageUtils = {
                formatBytes: this.formatBytes,
                formatNumber: this.formatNumber,
                debounce: this.debounce,
                throttle: this.throttle,
                sanitizeHtml: this.sanitizeHtml,
                copyToClipboard: this.copyToClipboard,
                downloadText: this.downloadText,
                showNotification: this.showNotification
            };
            
            console.log('🔧 Utility functions initialized');
        }
        
        formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        formatNumber(num, decimals = 0) {
            if (num === null || num === undefined) return '0';
            
            return num.toLocaleString(undefined, {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }
        
        debounce(func, wait, immediate) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    timeout = null;
                    if (!immediate) func(...args);
                };
                const callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func(...args);
            };
        }
        
        throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }
        
        sanitizeHtml(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }
        
        async copyToClipboard(text) {
            try {
                if (navigator.clipboard) {
                    await navigator.clipboard.writeText(text);
                    return true;
                } else {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    return successful;
                }
            } catch (err) {
                console.error('Failed to copy text:', err);
                return false;
            }
        }
        
        downloadText(text, filename) {
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
        }
        
        showNotification(message, type = 'info', duration = 3000) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            // Style the notification
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 24px;
                background: var(--bg-primary);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                z-index: 9999;
                transition: all 0.3s ease;
                max-width: 300px;
                word-wrap: break-word;
            `;
            
            // Add type-specific styling
            if (type === 'success') {
                notification.style.borderColor = 'var(--color-success)';
                notification.style.backgroundColor = 'var(--color-success)';
                notification.style.color = 'white';
            } else if (type === 'error') {
                notification.style.borderColor = 'var(--color-error)';
                notification.style.backgroundColor = 'var(--color-error)';
                notification.style.color = 'white';
            } else if (type === 'warning') {
                notification.style.borderColor = 'var(--color-warning)';
                notification.style.backgroundColor = 'var(--color-warning)';
                notification.style.color = 'white';
            }
            
            // Add to document
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateY(0)';
            }, 10);
            
            // Remove after duration
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }
    }
    
    
    
    // Theme Manager for dark/light mode switching
    class ThemeManager {
        constructor() {
            this.currentTheme = this.getStoredTheme() || this.getPreferredTheme();
            this.init();
        }
        
        init() {
            this.applyTheme(this.currentTheme);
            this.setupThemeToggle();
            this.setupMediaQuery();
            
            console.log(`🎨 Theme initialized: ${this.currentTheme}`);
        }
        
        getStoredTheme() {
            return localStorage.getItem('docs-coverage-theme');
        }
        
        getPreferredTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('docs-coverage-theme', theme);
            this.currentTheme = theme;
            this.updateThemeToggle();
            
            console.log(`🎨 Theme applied: ${theme}`);
        }
        
        setupThemeToggle() {
            const toggle = document.getElementById('theme-toggle-btn');
            if (toggle) {
                toggle.addEventListener('click', () => {
                    const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
                    this.applyTheme(newTheme);
                });
            }
        }
        
        setupMediaQuery() {
            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            mediaQuery.addEventListener('change', (e) => {
                if (!this.getStoredTheme()) {
                    this.applyTheme(e.matches ? 'dark' : 'light');
                }
            });
        }
        
        updateThemeToggle() {
            const toggle = document.getElementById('theme-toggle-btn');
            if (toggle) {
                toggle.setAttribute('aria-label', `Switch to ${this.currentTheme === 'light' ? 'dark' : 'light'} theme`);
            }
        }
    }
    
    
    
    // Timestamp Tooltip Manager
    class TimestampManager {
        constructor() {
            this.tooltip = null;
            this.setupTimestampTooltips();
        }
        
        setupTimestampTooltips() {
            // Create tooltip element if it doesn't exist
            this.tooltip = document.getElementById('timestamp-tooltip');
            if (!this.tooltip) {
                console.warn('⚠️ Timestamp tooltip element not found');
                return;
            }
            
            // Setup timestamp hover handlers
            document.querySelectorAll('.timestamp-with-tooltip').forEach(element => {
                element.addEventListener('mouseenter', (e) => {
                    this.showTooltip(e.target);
                });
                
                element.addEventListener('mouseleave', () => {
                    this.hideTooltip();
                });
                
                element.addEventListener('mousemove', (e) => {
                    this.updateTooltipPosition(e);
                });
            });
            
            // Update relative times periodically
            this.updateRelativeTimes();
            setInterval(() => {
                this.updateRelativeTimes();
            }, 60000); // Update every minute
            
            console.log('🕒 Timestamp tooltips initialized');
        }
        
        showTooltip(element) {
            const timestamp = element.dataset.timestamp;
            if (!timestamp) return;
            
            const date = new Date(timestamp);
            const now = new Date();
            
            // Update tooltip content
            const relativeTimeElement = this.tooltip.querySelector('.tooltip-relative-time');
            const utcTimeElement = this.tooltip.querySelector('.tooltip-utc-time');
            const localTimeElement = this.tooltip.querySelector('.tooltip-local-time');
            
            if (relativeTimeElement) {
                relativeTimeElement.textContent = this.getRelativeTime(date, now);
            }
            
            if (utcTimeElement) {
                utcTimeElement.textContent = date.toISOString();
            }
            
            if (localTimeElement) {
                localTimeElement.textContent = date.toLocaleString();
            }
            
            // Show tooltip
            this.tooltip.style.display = 'block';
            this.tooltip.style.opacity = '1';
        }
        
        hideTooltip() {
            this.tooltip.style.opacity = '0';
            setTimeout(() => {
                this.tooltip.style.display = 'none';
            }, 200);
        }
        
        updateTooltipPosition(e) {
            const tooltipRect = this.tooltip.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            let left = e.clientX + 10;
            let top = e.clientY + 10;
            
            // Adjust position if tooltip would go off-screen
            if (left + tooltipRect.width > viewportWidth) {
                left = e.clientX - tooltipRect.width - 10;
            }
            
            if (top + tooltipRect.height > viewportHeight) {
                top = e.clientY - tooltipRect.height - 10;
            }
            
            this.tooltip.style.left = left + 'px';
            this.tooltip.style.top = top + 'px';
        }
        
        updateRelativeTimes() {
            const now = new Date();
            
            document.querySelectorAll('.timestamp-with-tooltip').forEach(element => {
                const timestamp = element.dataset.timestamp;
                if (!timestamp) return;
                
                const date = new Date(timestamp);
                const relativeTimeElement = element.querySelector('.relative-time');
                
                if (relativeTimeElement) {
                    relativeTimeElement.textContent = this.getRelativeTime(date, now);
                }
            });
        }
        
        getRelativeTime(date, now) {
            const diffMs = now - date;
            const diffSeconds = Math.floor(diffMs / 1000);
            const diffMinutes = Math.floor(diffSeconds / 60);
            const diffHours = Math.floor(diffMinutes / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffSeconds < 60) {
                return 'Just now';
            } else if (diffMinutes < 60) {
                return `${diffMinutes} minute${diffMinutes !== 1 ? 's' : ''} ago`;
            } else if (diffHours < 24) {
                return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
            } else if (diffDays < 30) {
                return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
            } else {
                return date.toLocaleDateString();
            }
        }
    }
    
    
    
    // Keyboard Shortcuts Manager
    class KeyboardManager {
        constructor() {
            this.setupKeyboardShortcuts();
        }
        
        setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                this.handleKeyboardShortcut(e);
            });
            
            console.log('⌨️ Keyboard shortcuts initialized');
        }
        
        handleKeyboardShortcut(e) {
            // Theme toggle: Ctrl+Shift+D
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                const themeToggle = document.getElementById('theme-toggle-btn');
                if (themeToggle) {
                    themeToggle.click();
                }
                return;
            }
            
            // Search focus: Ctrl+F
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                const searchInput = document.getElementById('gap-search');
                if (searchInput) {
                    e.preventDefault();
                    searchInput.focus();
                    searchInput.select();
                }
                return;
            }
            
            // Column picker: Ctrl+K
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const columnPickerBtn = document.getElementById('column-picker-btn');
                if (columnPickerBtn) {
                    columnPickerBtn.click();
                }
                return;
            }
            
            // Help modal: F1 or Ctrl+?
            if (e.key === 'F1' || ((e.ctrlKey || e.metaKey) && e.key === '?')) {
                e.preventDefault();
                const helpBtn = document.getElementById('help-btn');
                if (helpBtn) {
                    helpBtn.click();
                }
                return;
            }
            
            // Escape key handling is done in ModalManager
        }
    }
    
    
    
    // Modal Manager - FIXED VERSION that doesn't break other JavaScript
    class ModalManager {
        constructor() {
            this.activeModal = null;
            this.sourceCodeData = {};
            this.currentFilePath = null;
            this.isDestroyed = false;
            this.originalBodyOverflow = '';
            this.initializeModalSystem();
        }
        
        initializeModalSystem() {
            if (this.isDestroyed) return;
            
            // Store original body overflow
            this.originalBodyOverflow = document.body.style.overflow || '';
            
            // Load source code data from embedded scripts
            this.loadEmbeddedSourceCode();
            
            // Setup event handlers with proper cleanup
            this.setupModalEventHandlers();
            
            console.log('🎭 Modal system initialized successfully');
        }
        
        loadEmbeddedSourceCode() {
            try {
                const sourceScripts = document.querySelectorAll('script[data-source-code="true"]');
                
                sourceScripts.forEach(script => {
                    try {
                        const data = JSON.parse(script.textContent);
                        this.sourceCodeData = { ...this.sourceCodeData, ...data };
                    } catch (e) {
                        console.warn('Failed to parse source code data:', e);
                    }
                });
                
                console.log(`📄 Loaded source code for ${Object.keys(this.sourceCodeData).length} files`);
            } catch (e) {
                console.warn('Failed to load source code data:', e);
            }
        }
        
        setupModalEventHandlers() {
            // CRITICAL: Use event delegation to prevent handler conflicts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && this.activeModal && !this.isDestroyed) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.closeModal();
                }
            });
            
            // Modal backdrop clicks - use event delegation
            document.addEventListener('click', (e) => {
                if (this.isDestroyed) return;
                
                // Close modal if clicking backdrop
                if (e.target.classList.contains('modal') && this.activeModal) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.closeModal();
                }
                
                // Close modal if clicking close button
                if (e.target.classList.contains('modal-close') && this.activeModal) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.closeModal();
                }
                
                // Handle GitHub button clicks
                if (e.target.id === 'open-github-btn' || e.target.closest('#open-github-btn')) {
                    e.preventDefault();
                    e.stopPropagation();
                    const githubBtn = e.target.id === 'open-github-btn' ? e.target : e.target.closest('#open-github-btn');
                    const githubUrl = githubBtn.dataset.githubUrl;
                    if (githubUrl) {
                        window.open(githubUrl, '_blank');
                    }
                }
            });
        }
        
        showSourceCodeModal(row) {
            if (this.isDestroyed) return;
            
            const filePath = row.dataset.filePath || row.dataset.fileName;
            const fileName = row.dataset.fileName || filePath?.split('/').pop() || 'Unknown File';
            const githubUrl = row.dataset.githubUrl;
            
            if (!filePath) {
                console.warn('No file path found for row');
                return;
            }
            
            this.currentFilePath = filePath;
            console.log(`📄 Opening source code modal for: ${fileName}`);
            
            // Get modal elements
            const modal = document.getElementById('source-code-modal');
            const title = document.getElementById('source-modal-title');
            const loading = document.getElementById('source-loading');
            const error = document.getElementById('source-error');
            const content = document.getElementById('source-code-content');
            const codeText = document.getElementById('source-code-text');
            const githubBtn = document.getElementById('open-github-btn');
            
            if (!modal) {
                console.error('Source code modal not found');
                return;
            }
            
            // Update modal title
            if (title) {
                title.textContent = `📄 ${fileName}`;
            }
            
            // Setup GitHub button
            if (githubBtn && githubUrl) {
                githubBtn.dataset.githubUrl = githubUrl;
                githubBtn.style.display = 'inline-flex';
            } else if (githubBtn) {
                githubBtn.style.display = 'none';
            }
            
            // Show modal properly
            this.showModal(modal);
            
            // Show loading state
            this.showLoadingState(loading, error, content);
            
            // Load source code after a brief delay
            setTimeout(() => {
                this.loadAndDisplaySourceCode(filePath, loading, error, content, codeText);
            }, 100);
        }
        
        showModal(modal) {
            if (this.isDestroyed) return;
            
            // Close any existing modal first
            if (this.activeModal && this.activeModal !== modal) {
                this.closeModal();
            }
            
            // Store original body overflow if not already stored
            if (!this.originalBodyOverflow) {
                this.originalBodyOverflow = document.body.style.overflow || '';
            }
            
            // Show the modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Trigger animation
            requestAnimationFrame(() => {
                if (!this.isDestroyed) {
                    modal.classList.add('show');
                }
            });
            
            this.activeModal = modal;
            console.log('🎭 Modal opened successfully');
        }
        
        closeModal() {
            if (!this.activeModal || this.isDestroyed) return;
            
            console.log('🎭 Closing modal...');
            
            const modalToClose = this.activeModal;
            
            // Remove show class to trigger animation
            modalToClose.classList.remove('show');
            
            // CRITICAL: Reset the activeModal immediately to prevent conflicts
            this.activeModal = null;
            
            // CRITICAL: Restore body overflow immediately to prevent lockup
            document.body.style.overflow = this.originalBodyOverflow;
            
            // Hide modal after animation completes
            setTimeout(() => {
                if (!this.isDestroyed && modalToClose) {
                    modalToClose.style.display = 'none';
                }
            }, 300);
            
            console.log('🎭 Modal closed successfully');
        }
        
        showLoadingState(loading, error, content) {
            if (loading) {
                loading.style.display = 'flex';
            }
            if (error) {
                error.style.display = 'none';
            }
            if (content) {
                content.style.display = 'none';
            }
        }
        
        loadAndDisplaySourceCode(filePath, loading, error, content, codeText) {
            const sourceData = this.sourceCodeData[filePath];
            
            if (sourceData && sourceData.content) {
                this.displaySourceCode(sourceData.content, sourceData.language, loading, error, content, codeText);
            } else {
                this.displaySourceCodeError('Source code not available', loading, error, content);
            }
        }
        
        displaySourceCode(sourceContent, language, loading, error, content, codeText) {
            if (!content || !codeText) return;
            
            // Hide loading, show content
            if (loading) loading.style.display = 'none';
            if (error) error.style.display = 'none';
            content.style.display = 'block';
            
            // Clear any existing content and classes
            codeText.innerHTML = '';
            codeText.className = '';
            
            // Set the source code content
            codeText.textContent = sourceContent;
            
            // Apply syntax highlighting with multiple strategies
            this.applySyntaxHighlighting(codeText, language);
            
            console.log('📄 Source code displayed successfully');
        }
        
        applySyntaxHighlighting(element, language) {
            if (!element) return;
            
            // Strategy 1: Use hljs if available
            if (window.hljs && typeof window.hljs.highlightElement === 'function') {
                try {
                    // Clear existing classes
                    element.className = '';
                    
                    // Set language class
                    if (language) {
                        element.classList.add(`language-${language}`);
                    }
                    
                    // Apply highlighting
                    window.hljs.highlightElement(element);
                    console.log('✨ Syntax highlighting applied with hljs');
                    return;
                } catch (e) {
                    console.warn('Failed to apply hljs highlighting:', e);
                }
            }
            
            // Strategy 2: Use hljs.highlightBlock (older API)
            if (window.hljs && typeof window.hljs.highlightBlock === 'function') {
                try {
                    element.className = language ? `language-${language}` : '';
                    window.hljs.highlightBlock(element);
                    console.log('✨ Syntax highlighting applied with hljs (legacy)');
                    return;
                } catch (e) {
                    console.warn('Failed to apply hljs legacy highlighting:', e);
                }
            }
            
            // Strategy 3: Manual highlighting with classes
            try {
                this.applyManualSyntaxHighlighting(element, language);
                console.log('✨ Manual syntax highlighting applied');
            } catch (e) {
                console.warn('Failed to apply manual highlighting:', e);
            }
        }
        
        applyManualSyntaxHighlighting(element, language) {
            const content = element.textContent;
            element.className = `hljs language-${language || 'javascript'}`;
            
            // Apply basic regex-based highlighting
            let html = content;
            
            // Keywords
            const keywords = [
                'import', 'export', 'from', 'const', 'let', 'var', 'function', 'return',
                'if', 'else', 'for', 'while', 'class', 'interface', 'type', 'enum',
                'async', 'await', 'try', 'catch', 'finally', 'throw', 'new', 'this',
                'super', 'extends', 'implements', 'public', 'private', 'protected',
                'static', 'readonly', 'default', 'true', 'false', 'null', 'undefined'
            ];
            
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\\\b${keyword}\\\\b`, 'g');
                html = html.replace(regex, `<span class="hljs-keyword">${keyword}</span>`);
            });
            
                            // Strings
                html = html.replace(/(["'`])((?:\\\\.|(?!\\1)[^\\\\])*?)\\1/g, '<span class="hljs-string">$1$2$1</span>');
            
                            // Comments
                html = html.replace(/(\/\/.*$)/gm, '<span class="hljs-comment">$1</span>');
                html = html.replace(/(\/\\*[\\s\\S]*?\\*\/)/g, '<span class="hljs-comment">$1</span>');
            
            // Numbers
            html = html.replace(/\b(\d+(?:\.\d+)?)\b/g, '<span class="hljs-number">$1</span>');
            
            // Function names
            html = html.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g, '<span class="hljs-function">$1</span>');
            
            // Types (capitalized words)
            html = html.replace(/\b([A-Z][a-zA-Z0-9_]*)\b/g, '<span class="hljs-title class_">$1</span>');
            
            element.innerHTML = html;
        }
        
        displaySourceCodeError(message, loading, error, content) {
            if (loading) loading.style.display = 'none';
            if (content) content.style.display = 'none';
            
            if (error) {
                error.style.display = 'flex';
                error.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">📂</div>
                        <h3 style="margin: 0 0 1rem 0;">Source Code Preview</h3>
                        <p style="margin-bottom: 1.5rem; color: #888;">
                            ${message}
                        </p>
                        <div style="background: #1e1e1e; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <p style="margin: 0; font-weight: 600;">To view this file:</p>
                            <ul style="text-align: left; margin: 0.5rem 0; padding-left: 1.5rem;">
                                <li>Click the <strong>GitHub</strong> button above</li>
                                <li>Open the file in your code editor</li>
                                <li>File path: <code style="background: #333; padding: 2px 4px; border-radius: 3px;">${this.currentFilePath || 'Not available'}</code></li>
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            console.log('📄 Source code error displayed');
        }
        
        showColumnPicker() {
            const modal = document.getElementById('column-picker-modal');
            if (modal) {
                this.showModal(modal);
            }
        }
        
        showHelpModal() {
            const modal = document.getElementById('help-modal');
            if (modal) {
                this.showModal(modal);
            }
        }
        
        // Cleanup method
        destroy() {
            if (this.activeModal) {
                this.closeModal();
            }
            this.isDestroyed = true;
            this.activeModal = null;
            this.sourceCodeData = {};
            this.currentFilePath = null;
            // Restore original body overflow
            document.body.style.overflow = this.originalBodyOverflow;
        }
    }
    
    // Initialize the modal manager
    window.modalManager = null;
    
    function initializeModalManager() {
        if (window.modalManager) {
            window.modalManager.destroy();
        }
        
        window.modalManager = new ModalManager();
        console.log('✅ Modal manager initialized');
    }
    
    // Auto-initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeModalManager);
    } else {
        initializeModalManager();
    }
    
    
    
    // Enhanced Table Manager - ULTRA DEFENSIVE VERSION
    class EnhancedTableManager {
        constructor() {
            this.table = null;
            this.allRows = [];
            this.filteredRows = [];
            this.currentPage = 1;
            this.pageSize = 50;
            this.totalPages = 1;
            this.currentFilter = 'all';
            this.searchTerm = '';
            this.sortState = this.createSafeSortState();
            this.columnWidths = {};
            this.hiddenColumns = new Set();
            this.storageKey = 'docs-coverage-table-state';
            this.isDestroyed = false;
            this.isInitialized = false;
            
            this.init();
        }
        
        createSafeSortState() {
            return {
                primary: { column: null, direction: 'asc' },
                secondary: { column: null, direction: 'asc' }
            };
        }
        
        validateSortState() {
            // Ultra defensive sort state validation
            if (!this.sortState || typeof this.sortState !== 'object') {
                console.warn('⚠️ Sort state is invalid, creating new one');
                this.sortState = this.createSafeSortState();
                return false;
            }
            
            // Validate primary sort
            if (!this.sortState.primary || typeof this.sortState.primary !== 'object') {
                console.warn('⚠️ Primary sort state is invalid, fixing');
                this.sortState.primary = { column: null, direction: 'asc' };
            }
            
            // Validate secondary sort
            if (!this.sortState.secondary || typeof this.sortState.secondary !== 'object') {
                console.warn('⚠️ Secondary sort state is invalid, fixing');
                this.sortState.secondary = { column: null, direction: 'asc' };
            }
            
            // Validate direction values
            if (!['asc', 'desc'].includes(this.sortState.primary.direction)) {
                this.sortState.primary.direction = 'asc';
            }
            if (!['asc', 'desc'].includes(this.sortState.secondary.direction)) {
                this.sortState.secondary.direction = 'asc';
            }
            
            return true;
        }
        
        init() {
            if (this.isDestroyed) return;
            
            // Wait for DOM to be ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => this.initializeComponents());
            } else {
                this.initializeComponents();
            }
        }
        
        initializeComponents() {
            if (this.isDestroyed || this.isInitialized) return;
            
            console.log('🔧 Initializing Enhanced Table Manager...');
            
            // Validate sort state before doing anything
            this.validateSortState();
            
            try {
                this.setupTable();
                this.setupPagination();
                this.setupFilters();
                this.setupColumnManagement();
                this.setupCardFilters();
                this.loadPersistedState();
                this.updateDisplay();
                
                this.isInitialized = true;
                console.log('✅ Enhanced Table Manager initialized successfully!');
            } catch (error) {
                console.error('❌ Failed to initialize table manager:', error);
                // Reset to safe state
                this.sortState = this.createSafeSortState();
                this.currentFilter = 'all';
                this.currentPage = 1;
                this.searchTerm = '';
                
                // Try minimal initialization
                try {
                    this.setupBasicTable();
                    console.log('✅ Basic table functionality initialized');
                } catch (fallbackError) {
                    console.error('❌ Even basic table initialization failed:', fallbackError);
                }
            }
        }
        
        setupBasicTable() {
            this.table = document.getElementById('gaps-table');
            if (this.table) {
                this.allRows = Array.from(this.table.querySelectorAll('tbody tr'));
                this.filteredRows = [...this.allRows];
                console.log(`📊 Found ${this.allRows.length} table rows`);
            }
        }
        
        setupTable() {
            this.table = document.getElementById('gaps-table');
            if (!this.table) {
                console.warn('⚠️ Table not found!');
                return;
            }
            
            this.allRows = Array.from(this.table.querySelectorAll('tbody tr'));
            this.filteredRows = [...this.allRows];
            
            console.log(`📊 Found ${this.allRows.length} table rows`);
            
            // Setup row click handlers for source code modal
            this.allRows.forEach((row, index) => {
                row.addEventListener('click', (e) => {
                    if (this.isDestroyed) return;
                    this.handleRowClick(e, row);
                });
            });
            
            // Setup filename click handlers for GitHub links
            this.table.querySelectorAll('.clickable-filename').forEach(filename => {
                filename.addEventListener('click', (e) => {
                    if (this.isDestroyed) return;
                    this.handleFilenameClick(e);
                });
            });
            
            // Setup column sorting
            this.table.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', (e) => {
                    if (this.isDestroyed) return;
                    this.handleColumnSort(e, th);
                });
            });
            
            console.log('🎯 Table event handlers attached');
        }
        
        handleRowClick(e, row) {
            // Don't trigger if clicking on filename (GitHub link)
            if (e.target.classList.contains('clickable-filename')) {
                return;
            }
            
            console.log('🖱️ Row clicked:', row.dataset.fileName);
            
            // Delegate to modal manager
            if (window.modalManager && window.modalManager.showSourceCodeModal) {
                window.modalManager.showSourceCodeModal(row);
            } else {
                console.warn('⚠️ Modal manager not available');
            }
        }
        
        handleFilenameClick(e) {
            e.stopPropagation();
            const githubUrl = e.target.dataset.githubUrl;
            if (githubUrl) {
                console.log('🔗 Opening GitHub URL:', githubUrl);
                window.open(githubUrl, '_blank');
            }
        }
        
        handleColumnSort(e, th) {
            const column = th.dataset.column;
            const isMultiSort = e.shiftKey;
            
            console.log(`🔄 Sorting column: ${column}, Multi-sort: ${isMultiSort}`);
            this.toggleSort(column, isMultiSort);
        }
        
        setupPagination() {
            // Page size selector - use correct ID from HTML
            const pageSizeSelect = document.getElementById('items-per-page');
            if (pageSizeSelect) {
                pageSizeSelect.addEventListener('change', (e) => {
                    if (this.isDestroyed) return;
                    this.pageSize = e.target.value === 'all' ? this.filteredRows.length : parseInt(e.target.value);
                    this.currentPage = 1;
                    this.updateDisplay();
                    this.saveState();
                    console.log(`📄 Page size changed to: ${this.pageSize}`);
                });
            }
            
            // Pagination buttons - use correct IDs from HTML
            const paginationButtons = [
                { id: 'first-page', action: () => this.goToPage(1) },
                { id: 'prev-page', action: () => this.goToPage(this.currentPage - 1) },
                { id: 'next-page', action: () => this.goToPage(this.currentPage + 1) },
                { id: 'last-page', action: () => this.goToPage(this.totalPages) }
            ];
            
            paginationButtons.forEach(({ id, action }) => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.addEventListener('click', (e) => {
                        if (this.isDestroyed) return;
                        action();
                    });
                }
            });
            
            // Current page input - use correct ID from HTML
            const currentPageInput = document.getElementById('current-page');
            if (currentPageInput) {
                currentPageInput.addEventListener('change', (e) => {
                    if (this.isDestroyed) return;
                    const page = parseInt(e.target.value);
                    if (page >= 1 && page <= this.totalPages) {
                        this.goToPage(page);
                    }
                });
            }
            
            console.log('📄 Pagination handlers attached');
        }
        
        setupFilters() {
            // Search input
            const searchInput = document.getElementById('gap-search');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    if (this.isDestroyed) return;
                    this.searchTerm = e.target.value.toLowerCase();
                    this.currentPage = 1;
                    this.applyFilters();
                    this.saveState();
                    console.log(`🔍 Search term: ${this.searchTerm}`);
                });
            }
            
            // Filter tags
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.addEventListener('click', (e) => {
                    if (this.isDestroyed) return;
                    this.handleFilterTagClick(e);
                });
            });
            
            // Clear filters from empty state
            const clearFiltersEmptyBtn = document.getElementById('clear-filters-empty');
            if (clearFiltersEmptyBtn) {
                clearFiltersEmptyBtn.addEventListener('click', (e) => {
                    if (this.isDestroyed) return;
                    this.clearAllFilters();
                });
            }
            
            console.log('🏷️ Filter handlers attached');
        }
        
        setupCardFilters() {
            // Clickable overview cards
            document.querySelectorAll('.clickable-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (this.isDestroyed) return;
                    this.handleCardClick(e);
                });
            });
            
            console.log('📊 Card filter handlers attached');
        }
        
        setupColumnManagement() {
            // Column picker button
            const columnPickerBtn = document.getElementById('column-picker-btn');
            if (columnPickerBtn) {
                columnPickerBtn.addEventListener('click', () => {
                    if (this.isDestroyed) return;
                    this.showColumnPicker();
                });
            }
            
            // Apply columns button
            const applyColumnsBtn = document.getElementById('apply-columns-btn');
            if (applyColumnsBtn) {
                applyColumnsBtn.addEventListener('click', () => {
                    if (this.isDestroyed) return;
                    this.applyColumnVisibility();
                });
            }
            
            // Reset columns button
            const resetColumnsBtn = document.getElementById('reset-columns-btn');
            if (resetColumnsBtn) {
                resetColumnsBtn.addEventListener('click', () => {
                    if (this.isDestroyed) return;
                    this.resetColumnVisibility();
                });
            }
            
            console.log('🎛️ Column management handlers attached');
        }
        
        handleFilterTagClick(e) {
            const tag = e.target;
            const filterType = tag.dataset.filter;
            const filterValue = tag.dataset.value;
            
            console.log(`🏷️ Filter tag clicked: ${filterType}=${filterValue}`);
            
            // Handle grouped filters (priority, status) or direct filters
            const actualFilter = filterValue !== undefined ? filterValue : filterType;
            
            // Remove active class from tags in the same group
            const filterGroup = tag.closest('.filter-group');
            if (filterGroup) {
                filterGroup.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
            } else {
                // Fallback: remove from all filter tags
                document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
            }
            
            // Add active class to clicked tag
            tag.classList.add('active');
            
            this.currentFilter = actualFilter === '' ? 'all' : actualFilter;
            this.currentPage = 1;
            this.safeApplyFilters();
            this.saveState();
        }
        
        handleCardClick(e) {
            const card = e.target.closest('.clickable-card');
            if (!card) return;
            
            const filter = card.dataset.filter;
            if (filter) {
                console.log(`📊 Card clicked: ${filter}`);
                this.currentFilter = filter;
                this.currentPage = 1;
                this.updateFilterTags();
                this.safeApplyFilters();
                this.scrollToTable();
                this.saveState();
            }
        }
        
        goToPage(page) {
            if (page < 1 || page > this.totalPages) return;
            
            this.currentPage = page;
            this.updateDisplay();
            this.saveState();
            
            console.log(`📄 Navigated to page ${page}`);
        }
        
        toggleSort(column, isMultiSort) {
            // Validate sort state before making changes
            this.validateSortState();
            
            if (!isMultiSort) {
                // Single column sort - replace primary
                this.sortState.primary = {
                    column: column,
                    direction: this.sortState.primary.column === column && this.sortState.primary.direction === 'asc' ? 'desc' : 'asc'
                };
                this.sortState.secondary = { column: null, direction: 'asc' };
            } else {
                // Multi-column sort
                if (this.sortState.primary.column === column) {
                    this.sortState.primary.direction = this.sortState.primary.direction === 'asc' ? 'desc' : 'asc';
                } else if (this.sortState.secondary.column === column) {
                    this.sortState.secondary.direction = this.sortState.secondary.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortState.secondary = this.sortState.primary;
                    this.sortState.primary = { column: column, direction: 'asc' };
                }
            }
            
            this.applySorting();
            this.updateDisplay();
            this.saveState();
        }
        
        applySorting() {
            if (!this.filteredRows || this.filteredRows.length === 0) return;
            
            this.filteredRows.sort((a, b) => {
                // Primary sort
                let result = this.compareRows(a, b, this.sortState.primary.column, this.sortState.primary.direction);
                
                // Secondary sort if primary is equal
                if (result === 0 && this.sortState.secondary.column) {
                    result = this.compareRows(a, b, this.sortState.secondary.column, this.sortState.secondary.direction);
                }
                
                return result;
            });
        }
        
        compareRows(a, b, column, direction) {
            if (!column) return 0;
            
            const aVal = this.getCellValue(a, column);
            const bVal = this.getCellValue(b, column);
            
            let result = 0;
            if (aVal < bVal) result = -1;
            else if (aVal > bVal) result = 1;
            
            return direction === 'desc' ? -result : result;
        }
        
        getCellValue(row, column) {
            // Map column names to CSS classes
            const columnClassMap = {
                'file': 'col-file',
                'lines': 'col-lines', 
                'status': 'col-status',
                'priority': 'col-priority',
                'doc': 'col-doc',
                'effort': 'col-effort',
                'issues': 'col-issues'
            };
            
            const cssClass = columnClassMap[column];
            if (!cssClass) return '';
            
            const cell = row.querySelector(`td.${cssClass}`);
            if (!cell) return '';
            
            const cellText = cell.textContent.trim();
            
            // Handle different data types for proper sorting
            switch (column) {
                case 'lines':
                    // Extract numeric value from line count
                    const lineMatch = cellText.match(/[\d,]+/);
                    return lineMatch ? parseInt(lineMatch[0].replace(/,/g, '')) : 0;
                    
                case 'priority':
                    // Priority order: Critical > High > Medium > Low
                    const priorityOrder = { 'critical': 4, 'high': 3, 'medium': 2, 'low': 1 };
                    const priority = cellText.toLowerCase().replace(/[^a-z]/g, '');
                    return priorityOrder[priority] || 0;
                    
                case 'effort':
                    // Effort order: High > Medium > Low
                    const effortOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                    const effort = cellText.toLowerCase().replace(/[^a-z]/g, '');
                    return effortOrder[effort] || 0;
                    
                case 'status':
                    // Status order: Missing > Inadequate
                    const statusOrder = { 'missing': 2, 'inadequate': 1 };
                    const status = cellText.toLowerCase().replace(/[^a-z]/g, '');
                    return statusOrder[status] || 0;
                    
                case 'issues':
                    // Count number of issues (extract number from text like "3 issues")
                    const issueMatch = cellText.match(/(\d+)/);
                    return issueMatch ? parseInt(issueMatch[1]) : 0;
                    
                default:
                    // For file names and docs, use alphabetical sorting
                    return cellText.toLowerCase();
            }
        }
        
        updateDisplay() {
            if (this.isDestroyed) return;
            
            try {
                // Calculate pagination
                this.totalPages = Math.ceil(this.filteredRows.length / this.pageSize);
                if (this.currentPage > this.totalPages) {
                    this.currentPage = Math.max(1, this.totalPages);
                }
                
                // Check if we need to show empty state
                const emptyState = document.getElementById('empty-state');
                const table = document.getElementById('gaps-table');
                const paginationContainer = document.querySelector('.pagination-container');
                
                if (this.filteredRows.length === 0) {
                    // Show empty state, hide table and pagination
                    if (emptyState) emptyState.style.display = 'block';
                    if (table) table.style.display = 'none';
                    if (paginationContainer) paginationContainer.style.display = 'none';
                    
                    console.log('📭 No records found - showing empty state');
                } else {
                    // Show table and pagination, hide empty state
                    if (emptyState) emptyState.style.display = 'none';
                    if (table) table.style.display = 'table';
                    if (paginationContainer) paginationContainer.style.display = 'flex';
                    
                    // First, reorder the DOM to match the sorted filteredRows
                    this.reorderTableRows();
                    
                    // Then show/hide rows based on pagination
                    this.allRows.forEach(row => row.style.display = 'none');
                    
                    const startIndex = (this.currentPage - 1) * this.pageSize;
                    const endIndex = startIndex + this.pageSize;
                    
                    this.filteredRows.slice(startIndex, endIndex).forEach(row => {
                        row.style.display = '';
                    });
                    
                    console.log(`📊 Display updated - Page ${this.currentPage}/${this.totalPages}, showing ${Math.min(this.pageSize, this.filteredRows.length - startIndex)} rows`);
                }
                
                // Update pagination info
                this.updatePaginationInfo();
                this.updatePaginationButtons();
                this.safeUpdateSortIndicators();
                
            } catch (error) {
                console.error('❌ Error updating display:', error);
            }
        }
        
        updatePaginationInfo() {
            const startIndex = (this.currentPage - 1) * this.pageSize;
            const endIndex = Math.min(startIndex + this.pageSize, this.filteredRows.length);
            
            // Update showing start/end/total elements
            const showingStart = document.getElementById('showing-start');
            const showingEnd = document.getElementById('showing-end');
            const showingTotal = document.getElementById('showing-total');
            
            if (showingStart) showingStart.textContent = startIndex + 1;
            if (showingEnd) showingEnd.textContent = endIndex;
            if (showingTotal) showingTotal.textContent = this.filteredRows.length;
            
            console.log(`📊 Pagination info updated: ${startIndex + 1}-${endIndex} of ${this.filteredRows.length}`);
        }
        
        updatePaginationButtons() {
            const buttons = [
                { ids: ['first-page'], condition: this.currentPage <= 1 },
                { ids: ['prev-page'], condition: this.currentPage <= 1 },
                { ids: ['next-page'], condition: this.currentPage >= this.totalPages },
                { ids: ['last-page'], condition: this.currentPage >= this.totalPages }
            ];
            
            buttons.forEach(({ ids, condition }) => {
                ids.forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) {
                        btn.disabled = condition;
                    }
                });
            });
            
            // Update current page input
            const currentPageInput = document.getElementById('current-page');
            if (currentPageInput) {
                currentPageInput.value = this.currentPage;
                currentPageInput.max = this.totalPages;
            }
        }
        
        safeUpdateSortIndicators() {
            try {
                this.updateSortIndicators();
            } catch (error) {
                console.error('❌ Error updating sort indicators:', error);
                // Reset sort state and try again
                this.sortState = this.createSafeSortState();
                try {
                    this.updateSortIndicators();
                } catch (secondError) {
                    console.error('❌ Even safe sort indicators failed:', secondError);
                }
            }
        }
        
        updateSortIndicators() {
            // Ultra defensive programming - ensure everything exists
            if (!this.table) return;
            
            // Validate sort state before accessing it
            this.validateSortState();
            
            // Clear all sort indicators
            const sortableHeaders = this.table.querySelectorAll('th.sortable');
            sortableHeaders.forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc', 'sort-primary', 'sort-secondary');
            });
            
            // Add primary sort indicator
            if (this.sortState.primary && this.sortState.primary.column) {
                const primaryTh = this.table.querySelector(`th[data-column="${this.sortState.primary.column}"]`);
                if (primaryTh) {
                    primaryTh.classList.add('sort-primary');
                    primaryTh.classList.add(this.sortState.primary.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            }
            
            // Add secondary sort indicator
            if (this.sortState.secondary && this.sortState.secondary.column) {
                const secondaryTh = this.table.querySelector(`th[data-column="${this.sortState.secondary.column}"]`);
                if (secondaryTh) {
                    secondaryTh.classList.add('sort-secondary');
                    secondaryTh.classList.add(this.sortState.secondary.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            }
        }
        
        reorderTableRows() {
            if (!this.table || !this.filteredRows.length) return;
            
            const tbody = this.table.querySelector('tbody');
            if (!tbody) return;
            
            // Create a document fragment to efficiently reorder the DOM
            const fragment = document.createDocumentFragment();
            
            // Add filtered rows to fragment in sorted order
            this.filteredRows.forEach(row => {
                fragment.appendChild(row);
            });
            
            // Add any non-filtered rows (hidden) to the end
            this.allRows.forEach(row => {
                if (!this.filteredRows.includes(row)) {
                    fragment.appendChild(row);
                }
            });
            
            // Replace tbody content with reordered rows
            tbody.appendChild(fragment);
            
            console.log(`🔄 Table rows reordered - ${this.filteredRows.length} filtered rows in sorted order`);
        }
        
        showColumnPicker() {
            // Delegate to modal manager
            if (window.modalManager && window.modalManager.showColumnPicker) {
                window.modalManager.showColumnPicker();
            } else {
                console.warn('⚠️ Modal manager not available');
            }
        }
        
        safeApplyFilters() {
            try {
                this.applyFilters();
            } catch (error) {
                console.error('❌ Error applying filters:', error);
                // Reset to safe state
                this.currentFilter = 'all';
                this.searchTerm = '';
                this.filteredRows = [...this.allRows];
                this.updateDisplay();
            }
        }
        
        applyFilters() {
            if (this.isDestroyed) return;
            
            this.filteredRows = this.allRows.filter(row => {
                // Search filter
                if (this.searchTerm) {
                    const searchText = row.textContent.toLowerCase();
                    if (!searchText.includes(this.searchTerm)) {
                        return false;
                    }
                }
                
                // Priority/status filter
                if (this.currentFilter !== 'all') {
                    const priority = row.dataset.priority;
                    const status = row.dataset.status; // Using data-status instead of data-gap-type
                    
                    if (this.currentFilter === 'missing' && status !== 'missing') return false;
                    if (this.currentFilter === 'inadequate' && status !== 'inadequate') return false;
                    if (['critical', 'high', 'medium', 'low'].includes(this.currentFilter) && priority !== this.currentFilter) return false;
                }
                
                return true;
            });
            
            this.currentPage = 1;
            this.updateDisplay();
        }
        
        clearAllFilters() {
            if (this.isDestroyed) return;
            
            console.log('🧹 Clearing all filters');
            
            // Reset filter state
            this.currentFilter = 'all';
            this.searchTerm = '';
            this.currentPage = 1;
            
            // Reset search input
            const searchInput = document.getElementById('gap-search');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Reset filter tags
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.classList.remove('active');
            });
            
            // Activate "All" filter tags
            document.querySelectorAll('.filter-tag[data-value=""]').forEach(tag => {
                tag.classList.add('active');
            });
            
            // Apply filters (will show all items)
            this.applyFilters();
            this.saveState();
        }
        
        updateFilterTags() {
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.classList.toggle('active', tag.dataset.filter === this.currentFilter);
            });
        }
        
        scrollToTable() {
            const tableContainer = document.querySelector('.gaps-analysis-section');
            if (tableContainer) {
                tableContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        // State management - ultra defensive
        loadPersistedState() {
            try {
                const savedState = localStorage.getItem(this.storageKey);
                if (savedState) {
                    const state = JSON.parse(savedState);
                    
                    this.currentPage = state.currentPage || 1;
                    this.pageSize = state.pageSize || 50;
                    this.currentFilter = state.currentFilter || 'all';
                    this.searchTerm = state.searchTerm || '';
                    this.columnWidths = state.columnWidths || {};
                    this.hiddenColumns = new Set(state.hiddenColumns || ['type']);
                    
                    // Ultra defensive sort state restoration
                    if (state.sortState && typeof state.sortState === 'object') {
                        this.sortState = this.createSafeSortState();
                        
                        // Restore primary sort
                        if (state.sortState.primary && typeof state.sortState.primary === 'object') {
                            this.sortState.primary = {
                                column: state.sortState.primary.column || null,
                                direction: ['asc', 'desc'].includes(state.sortState.primary.direction) ? state.sortState.primary.direction : 'asc'
                            };
                        }
                        
                        // Restore secondary sort
                        if (state.sortState.secondary && typeof state.sortState.secondary === 'object') {
                            this.sortState.secondary = {
                                column: state.sortState.secondary.column || null,
                                direction: ['asc', 'desc'].includes(state.sortState.secondary.direction) ? state.sortState.secondary.direction : 'asc'
                            };
                        }
                    } else {
                        this.sortState = this.createSafeSortState();
                    }
                    
                    console.log('📊 Table state restored from localStorage');
                }
            } catch (e) {
                console.warn('⚠️ Failed to load persisted state:', e);
                // Reset to safe defaults
                this.sortState = this.createSafeSortState();
                this.hiddenColumns = new Set(['type']);
                this.currentFilter = 'all';
                this.searchTerm = '';
                this.currentPage = 1;
            }
        }
        
        saveState() {
            if (this.isDestroyed) return;
            
            try {
                // Validate sort state before saving
                this.validateSortState();
                
                const state = {
                    currentPage: this.currentPage,
                    pageSize: this.pageSize,
                    sortState: this.sortState,
                    currentFilter: this.currentFilter,
                    searchTerm: this.searchTerm,
                    columnWidths: this.columnWidths,
                    hiddenColumns: Array.from(this.hiddenColumns)
                };
                
                localStorage.setItem(this.storageKey, JSON.stringify(state));
            } catch (e) {
                console.warn('⚠️ Failed to save state:', e);
            }
        }
        
        applyColumnVisibility() {
            // Apply column visibility changes
            Object.keys(this.columnVisibility || {}).forEach(columnId => {
                this.updateColumnVisibility(columnId, this.columnVisibility[columnId]);
            });
            
            this.updateDisplay();
            
            // Close modal
            if (window.modalManager) {
                window.modalManager.closeModal();
            }
        }
        
        resetColumnVisibility() {
            this.hiddenColumns = new Set(['type']);
            this.updateDisplay();
            this.saveState();
        }
        
        updateColumnVisibility(columnId, visible) {
            if (visible) {
                this.hiddenColumns.delete(columnId);
            } else {
                this.hiddenColumns.add(columnId);
            }
            
            // Update column display
            const columnCells = this.table.querySelectorAll(`th[data-column="${columnId}"], td[data-column="${columnId}"]`);
            columnCells.forEach(cell => {
                cell.style.display = visible ? '' : 'none';
            });
        }
        
        // Cleanup
        destroy() {
            this.isDestroyed = true;
            this.isInitialized = false;
            this.table = null;
            this.allRows = [];
            this.filteredRows = [];
            this.sortState = this.createSafeSortState();
        }
    }
    
    
    
    // Main Application Controller - FIXED VERSION
    class DocumentationCoverageApp {
        constructor() {
            this.components = {};
            this.initialized = false;
            this.isDestroyed = false;
            this.init();
        }
        
        init() {
            console.log('🚀 Initializing Documentation Coverage Report App...');
            
            // Wait for DOM to be ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => this.initializeApp());
            } else {
                this.initializeApp();
            }
        }
        
        initializeApp() {
            if (this.isDestroyed) return;
            
            console.log('🔧 Starting component initialization...');
            
            // Initialize core components
            this.initializeGlobalErrorHandling();
            this.initializeSyntaxHighlighting();
            this.initializeUtilities();
            this.initializeTheme();
            this.initializeTimestamps();
            this.initializeKeyboardShortcuts();
            this.initializeModals();
            this.initializeTable();
            
            this.initialized = true;
            console.log('✅ Documentation Coverage Report App initialized successfully!');
            console.log('🎯 All interactive features are now active');
        }
        
        initializeGlobalErrorHandling() {
            this.setupGlobalErrorHandling();
        }
        
        initializeSyntaxHighlighting() {
            try {
                // Initialize highlight.js if available
                if (typeof window.hljs !== 'undefined') {
                    window.hljs.configure({
                        languages: ['typescript', 'javascript', 'python', 'css', 'json', 'html'],
                        ignoreUnescapedHTML: true
                    });
                    console.log('✨ Syntax highlighting initialized successfully');
                } else {
                    console.warn('⚠️ Highlight.js not available');
                }
            } catch (error) {
                console.warn('⚠️ Failed to initialize syntax highlighting:', error);
            }
        }
        
        initializeUtilities() {
            try {
                if (typeof UtilityManager !== 'undefined') {
                    this.components.utilityManager = new UtilityManager();
                    console.log('✅ Utility manager initialized');
                } else {
                    console.log('ℹ️ Utility manager not available');
                }
            } catch (error) {
                console.warn('⚠️ Failed to initialize utilities:', error);
            }
        }
        
        initializeTheme() {
            try {
                if (typeof ThemeManager !== 'undefined') {
                    this.components.themeManager = new ThemeManager();
                    console.log('✅ Theme manager initialized');
                } else {
                    console.log('ℹ️ Theme manager not available');
                }
            } catch (error) {
                console.warn('⚠️ Failed to initialize theme manager:', error);
            }
        }
        
        initializeTimestamps() {
            try {
                if (typeof TimestampManager !== 'undefined') {
                    this.components.timestampManager = new TimestampManager();
                    console.log('✅ Timestamp manager initialized');
                } else {
                    console.log('ℹ️ Timestamp manager not available');
                }
            } catch (error) {
                console.warn('⚠️ Failed to initialize timestamp manager:', error);
            }
        }
        
        initializeKeyboardShortcuts() {
            try {
                if (typeof KeyboardManager !== 'undefined') {
                    this.components.keyboardManager = new KeyboardManager();
                    console.log('✅ Keyboard manager initialized');
                } else {
                    console.log('ℹ️ Keyboard manager not available');
                }
            } catch (error) {
                console.warn('⚠️ Failed to initialize keyboard manager:', error);
            }
        }
        
        initializeModals() {
            try {
                // Modal manager initializes itself, just ensure it's available
                if (window.modalManager) {
                    this.components.modalManager = window.modalManager;
                    console.log('✅ Modal manager ready');
                } else {
                    console.warn('⚠️ Modal manager not available');
                }
                
            } catch (error) {
                console.warn('⚠️ Failed to initialize modal components:', error);
            }
        }
        
        initializeTable() {
            try {
                if (typeof EnhancedTableManager !== 'undefined') {
                    this.components.tableManager = new EnhancedTableManager();
                    console.log('✅ Table manager initialized');
                } else {
                    console.log('ℹ️ Table manager not available');
                }
            } catch (error) {
                console.warn('⚠️ Failed to initialize table manager:', error);
            }
        }
        
        setupGlobalErrorHandling() {
            window.addEventListener('error', (event) => {
                console.error('🚨 Global error caught:', event.error);
                // Don't prevent default behavior, just log
            });
            
            window.addEventListener('unhandledrejection', (event) => {
                console.error('🚨 Unhandled promise rejection:', event.reason);
                // Don't prevent default behavior, just log
            });
        }
        
        destroy() {
            this.isDestroyed = true;
            
            // Clean up all components
            Object.values(this.components).forEach(component => {
                if (component && typeof component.destroy === 'function') {
                    component.destroy();
                }
            });
            
            this.components = {};
            this.initialized = false;
        }
    }
    
    // Global initialization function
    function initializeDocsCoverageApp() {
        // Clean up any existing instance
        if (window.docsCoverageApp) {
            window.docsCoverageApp.destroy();
        }
        
        // Create new instance
        window.docsCoverageApp = new DocumentationCoverageApp();
    }
    
    // Auto-initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeDocsCoverageApp);
    } else {
        initializeDocsCoverageApp();
    }
    
    </script>

</body>
</html>